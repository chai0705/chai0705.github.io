<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>è§„çŸ©</title>
    <url>/2024/12/31/%E8%A7%84%E7%9F%A9/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="3e3763a290f064e5e390ec3a08291e57840bfb1f18137bc70c8661fce258b3f7">b3ce3877181dba7d2dc822c297e3a5e461a588a800d045df3c29113d12bf7cbbb7d0f7661783787c364a123d51c9fbf700082b8c18d8f9e529d57580720f57be8970ca695dc7fbf44a86a874ba1e45b1ee1c2e39ee3b3f5eef2eb21a2a574136ace8821ae5f04c462bc469942411a6763087c3520426f068d9b4d1e7a67aa8fd50cb8809d71a2895d47ddc2cef1ebc35a989bf96ceb363de24fe779f1e2e355d99d847884ed2f20d283657dc072bf44b0b5b3740a2d8277f69a855487eab439895752bdd95d5eb6a2ef7cdbce14358f2bb033f365d0d294bf9d713a9be51135eb878e7e702cb789a845614ad43a6a8746992a19fa8d9b6b2e8fd858e1795394634ad399de144af701c89b04cb4b6b92d73212d804825d9e6d45550d9c74a2820048aa59f4d9b5fa746d958ef06dc77f999bb5df7482f9878f5f5714ea3affe3c013370c68d6a5359baa4006da7f4da5de60ca7ebf4a7eb07bc15c370f7c3bd53c4ac332d64038310f16a6e0503a30d076fb4583c6d484da4d10ff308fd86eb46dec5abf79747ad37336afdfb3864c0e0c7935a4635925520ae6c7767ff26a6f5589fe93f48489884bb24040d155bba2a11c6de44331bafea06cd0d4791a85b032724dba0bc427e99caefce918086e1734f72dd5f9144800b9592752de48d5c68a227ac7ddb12dfa0025dbdcab1b3442f9ad09884d5483274365ff8f3082a95ac0db2d0d77a1b1911bee05b866a16dfc0d98485311c36b995d1ed8159bfbc156b9aeb373b5cd20346afb5daa0596b8cf784427ce049361febcafa45d77618921b107b5ad17f3bf903fe052dbbc6403ae9d5d9c26a9e3a864d74f559ee2aae05968364ad08b3567385c057e07bc7a7807e365ea32867ebc41a13cf7928c28b1cf81ac962ec721756270fb0210dbc6a5678f9a79b37ed8687b5581f04a77dc45f4eb41ce2710f215dd2aa5a00b58e285e8e5c41d860c75a753cfd750d90a44614a5455f30d47b31cbaa27f7d266c636ee8a0c64420268ac1e5962bec4b635bcaac278667c02c9b90940eb9c714ebd82c52b92bd47d134336bbf8a2014b6f06b02a57396744e2a725148f404b5e4a98203ccfe0885946ec4d45a15a68c6abaae3ec7f38044192d7170115f6797b16cd6fec59c41d7aac9faab62e181bda97499bb8ee738175198682687d8a451b5b65e77f8e8d7c3a0aef7a22d420d813d6f945a255ceaa6f3ae3cde3c39c59df768457768c2652caf065676992600c232182fe123e1aeab316148998b96705930069f77483a391349b5558d1171c1bd834de9e9b9e5a6b18b5bbdd66983f3f8b0e1f4a8b8c2050b596b2d575fcd91cae422c235736fca9b43b512c895fcb779816155fc9354c0e73bba9f6a6c7a8b78813e82dd857db7e0abb423ea5959918a56804915bd6c6c441a353b114059180930d7dba8f63c3c27d49722d1828155ae1d358abd8282e362ec0ec74e1bf1444e350386c0634fee982650aac9862e60880a951e0adb42d845669e905f669e2871818bf5a610dc0b0fd611d8fd67aca621da8c5f6bfe32658664b725c28c9e14ad92acec09c89780a51397684aa786bb06cea9cf8c8244f9f3f56fa55555e9ee244006f9722341a148fa27599a987813c7ffc8dec1face492686a7bcbfac4355ef573b333c405888644281f273cc4d8816c14c2b1b268d63e234fedae4d674763c5f1d02836573322b82178dced7939a4d8a356e43948dbcae2aefcb82a440f0fda116f8cc00e2a00761e23dc0799328d7e5f6da21ffdd06d25ae401cc74ed0dde3f2c35a708abe6d9679cc18f8e5b2ca3665fd5f7654de77c6e43b25e2d5f5b490c77a28c1145dfca28570598c070835a2cf118305417ba9824fa8066a7ca0463cb37e45d81db2f622536761000f64047ea8a7e875fdc2a3b87d8de375ecbb9b7a5d0c8afe57aa869906e1d1d1a8b112161c5c8a0f358467d31efd5924607b038389d10598322ca0cabc462100e2bc8602becd552e512d698fc072386e24477374e26d1a1c5cfa0e36234c747c1e0e12ca23b542259b10c8ca340fde8794bf0c80281edb0b64818bae2d7ba0fdf56314db36754a5cb1799a8e6fe39ab0b6a1aaf98c29aa1da000f9ef7fe3d55dba8670218b8b355b3ded5587b21817973a7e870596581af297bf90a37168b5a6354e17418c1f92b0f2e1155867e75e21b634998b8a1a60b4acb7f96601ddc336a550c4957f3b9d3dca107e044cbd0f3406b2daf6ee1a6d9379126ef3ba31d2675ddcd8298021aa719f1c13af33eb5be720442be12e79e9a589a0ecaa7ee2a9ebea39a52c8d49ef663c8081637bc9481a0b4da9a6ae94eb67d3af4db1f1144b659f5a424a0eebeed9e9e6b4665aebd142ed81d8fe33ace072890c26d57b94b1795b933718f6c90eb8a848d5b2fc65c28e41e494880f29e1e56878b237c86fc29427893e730cf1d742d875011c70b9b5700fba942437ec5874299641e8110f77a3b0daff38b0383ef7445e3c641cbfdd46834c2a8eba2a71cd0db2685e47e0caaea8990871b34c8f830fd240f4b1e5edd199737a85bd144cd85736ba5ba697f0f5d5750e32057a7b2d9e1a81aeeff62d7f7f7772ce88aa9735f7174f0af197f0014017865a684f7497b6f4e2d16c03042f46606f34f73b7701c409c1dceb3c53f4658a6bcd00813b49ae1b985f4e613756710df8a6cdd749693f392707bbed6a6f24c50992c8337b9aea62ce576373f602bff78fcce02c963ffa92c830f1a33ad2923bfa5c8c7445451908b94fd87dc30fa7c55d24b9830585c32ece2b667b2837b1c0b7afa3dd8171b91bbcc4e3918dbb8953605a2f8b4a40dd2b3583b8a13372ee2ec9d1c36d8817d574b674fd9ab5a6dd31e1bd72c4c82f0f13084938d0c3701f09b1569c63ed5679f8e74e3116eae2ed6b81c45b3ec0fdab6d157a7742d252e8aef13241be1bdc6c93ae3eeb8890ee9eacc4314445338179b85e94609a54f1cd6baa66c4592e8e5314d5bbc01740659d29d40a4102076ccb31e52df688273eb3948a9f4e43f2ed46830e1cebb1cf36282d80f1993179a56b54870b0e81956c6dac8d909f2a49d0cd48a42f5e98c412e693d39d6e5d71b9b887831bdc060a1a350bcf96e52eefa417bcee773bd357ba56011897d5f2bfda71785eda0e9096efa72b4402c62b32d4912904245cac8fb8e07720a0dd289b8c81a24d2ad4aa7782e5600b4101f09ddba9c4c34b6a01d2e211bbd17b62676e341157476b41f061a52e9f7d79f6774abe6a0ffd82ea65dbb0d88d0ce460f2560b60df35a519dc34268d919c211bd2cff950a3ba7e69e40a07c7e878496538fc2a954e7daa2e1c4c14280983066ce348365a74f609553da073e9d3fb3afc34ca65cf0859c6bda8aae5d0b463cc46c51b9dcc6bc48778354848129183d2eac1a882f53b6cff94d33a23ebbee33b22f01c26649f5691268cdb9bb7a98a3e3ec20b294c546a142be79aa783218b8ea64631a5b52013e11b3404b556a25a13ec94b27e7fbda90db9e546213ce5caf91f5185dffbef141ae5abb636f5089c0297175dc7d46c578f212fa20ea1dd6b4b2f71deef2cb85e5461dc952edd94ef75d41e180d86d53985507e3c1a537747b6dae5e582bf563a7d3432c4b7812cd477700d80b0d5ad7f1803736e847a87a58c7e60b8c41ee3331c53441f4f0c95b17b34361ab22ae4aa783a5febf6f6115c3286045f8bdcaf7d4a553a7bf3479e526de3ba7731976b4715394ef71b5729878a5c64a0c1e95154475d04d406b267c54536da52c317724fe8eef2bd3d407dbc8ec5ed29347d2c42d13414b99b6ebda6968cb7e7dbb713a9d3340bab42d1c7fc8c5da01f9f3f1a55a27523cb6c4c958cc51323d9117c28dfab4bce2006daf5f9977a07b19c89f7474a63b0e4ccbdb96480013563e841b48519dfb1ed491405f53084b900ddb79ebbf23c8c0a954bc999b9863e41e61087996dab8f053f632036645917e04156d4b804df8c4d10e304df0a00230bc553a2fa8fa3273e609230e5237b2bc01a5725c254e68d84be877b74c979396dbe47308349cda456df11f28c53cbeb9384ea5bb117aa420c9936f7d86056cc9710142d94740753edb97503fd10a4ac8c13246d9d5167a0d79384befac8ca925abb768837a973d40643d0113ed833a2b71320686a150368e1d9f94fa5ef6646eef4bed29914bc3b69836481033d69eb311dd4b3ba29777c925d96ef6cc7ebbf8d8c7ef63a460e1083e57687939b0934aef3efb0ed746eb742a5126a30c79e175dd0952adba07fcedb310d6f794b4f06bd094c370188a7c0676cc2d8f35d3bf8e4b14ea0e5f796031e7aa6819c50a1c1bc8aadaeb0604d09d6e634bc45d4c271dfa4d9263edd65531e7d78b3b863ad97f49bb7ad1d8638b46690729d15524442f5d4a205d9a122a152ae4501292ddb1b0af3b2a10409fd62259fa484175bfad4bd5ddb8c114d417fbbfd3da2f679a8cbe3bc5039f9eeda91e20fecf0e08c41b5985843f6c82ddef1c06bbbc73e5c23cc26d8dd173defdf3052a119c104a85a8b240029fee44fb3113dbf068e14b138141de9654cada62941306b429370108b5228c58e7c7ed6428ed8a849fd2269bc120096c1fe5b5c1223cc1fa119fad3ecc28b61ad20fcb0a490e83bc7e4756e31d0af1697dbfd57377407ebf426444c01ab1df372d2d0933d29d1caac61ac5e4a505fc66cffc22a458be0aeba4f5bc38d4495f3fe9786a0f5045c025e9f6a98af8d3eef7814fa0bd4a7e10cf261c8df1fb36d70ac76b1075a015020ccd0e2d5e4641628231ba2086acc01f57a339380037ec0fd1c255753a04f749bea1322489a16f1d2970afbed155acd3553cfed3d9eaa19902289e121517a6a428a97beb3bbc81060d79ffed1aaa54bea3cc8bf65cd5c7d35ad881e83743b7896ebc07aeca169111882761b20d576d3cbce0d7c4f703852b7d84258a43ad62ae549d50a95e861a13a56ef4fd75432cbf28e1f8363f0847b84a69835433619be5cd1eb32434d92bb2df482325038e9fee64ad434638781e88bccfea2abac820f253f9eb8597d3fc27b16e2682720d5a27c72fd7f54d6dcc4f1072c5bc0ed71dcedbe24afe999734c2f1456ca1859d017e4c77813ae7e7c7bdf1631d7c4c25291119f5e822da60ab730ff0fdd1bef3ecde0edb84bd88f0767902b6b92bdaa899796596a293234ed40b1204713839572f7a1b86629eec11f06f72560e226293935529cad66a96ae122e9900d591c3153f6441f48e3379011e8688c928a2e4d71ff1dfad473eb9bd313fc6daeccd0e3a51a5b61f14eff7cbbd1b07d04c1ae04d4dd3e7c8f5d8c4d6c039316bf0053377ab857ca3036b8ea931cc81bce9f5c11822eb8d9880df54f3de65aba448c88cdac717529bc88f1537248bb568d9e5cf6ee2e2a6947a353bf7e01d807ab7ebe2dad45acbfa08a03abf0880289eccea9d1587f7a1879d145d63dafd639aa1c915972f07f3eaa73a347f69a1316bac5e8956fc9be6e6398a8aa7ea5b864a62a66ecf90c29652204176e6f92a9b4fb2cd09de64ce6c99e86df5a5005dcb014326d7db87151a6eb43e911ec80c0730caed84994f5ab35d77c86286ad84930218644141a5227563c0269f4fd012599803902101f86633188c1c3ea0ee39d8ddbd38774ac32605709a2e7f6956604829c2f3e909f82d97fe22a4420989f98acca051bb9502c701457f2cc0a3b6cc66009d51b8fa48c6033b42602e7533e2e621c77670e3400b06d04fbd9edff2e8711fcebae5b127f63fb04ff71ba4571167779f31c35d5d1316caf252b6ed2b79c302072a1bee0cb0f3dc66f223d2f5dee19ae3d9d04b61f1970deaa5713f1d355d6df6cb9893a1ae005595a04772f7e6a228403dfcf6ed26412073b2901a10e26e58bc6f81b7920450ab392eef33561f6b260ee8233ff8658574d1ce260654671fbd3754d138f381a612e94f65fa5c202f4637e30f7dde5625b18e347b9326c3311cd4d4bb12a0fc052b8f92893f4bb8f9b6d09de1a8d31149ba6768f168d90904b2e3fcdb54855d2998a025adfb767f69dd58b4480e0f204d4be23230e2df21d6ebed16d14e234337773bcab00b7c3f7805aa0eb4dbe24bf5aa801cd69535fdb4cbdd695e4fd247117909036dffa8b68c779acee58aaafb06eff0c875baa8d123b3bfc1cf7a4fd58ea4625be9789e4b8e6b43c0b4b37c87b195937bd98c4e949af7e383c8918d1feded5d84627f7650f814e33911ade91df9f21708182cabf2ddc90c1c0d0367e1d494f153256eac784c7f0d61e59a06c3f9e18d4668accf013050bf3cfc671d4fa26feffcf6e8ea4045766f89803dc57b3ad0b7a9afe0c048ba89db7d99f49e3ba046f541ffa1e8dccdd73172264d44f82fde2a81427412b9a74d06ccd5e7c5deac5ee357127917164e224345995dd969b7220eaa3dbdad62723dd8db25626708b56aec95ea64c18f0a953d52e4abb249759c39fee7f1fe5b01ad04db5b12d1e4e66fb6998b83688f01c515e5680ad4b8f79e798d43224788cd9bb8b5a431b2547156b15b87c5b554206ed0ba92a966cc9cb31c7c3543b38111aa160329eac396a8b882c183ee1e556703bf14d9ad271219700becef08685f9eb3b6ac3ba1a0b575db99a698d39d72b386ca249103223d6fe702cdcca6b898b9845273ff9de65e59781aa36fc1095fd9790198a9e7e46e618f5feb74e5af1ba88f54539f448081e6a21ee878868087b3d79618847fb93d8a7891ef7f480074082850822017d75db8ee7ab5defd65f26512b6f689fcccfabdc85d35e567b9b37dcb62392f5c75cbd8219188bb38a9e836fcfe0ea74ad49df9cf55bfd54a9e36bb9f68354a616e6038f229f60cf0533fc87f4918ef3fb20a2e5b8940f89af26dbf358eaef5131d556289987ccb89c6b028f4cbdc8dacbc47251e8f3e4dec06e66d0c1c0aad7caa262b081ace07ad6579bdd6428854b46b200c42788350c400b5a89588c70dd9c64f1273263062b3859c90960183d7179288b7aa182db62b787c2070dad38ad933cdcdca46aef3bd6d806231578d7aa06361af4f6a39b84818aa5505c6ffa9b726a193168dea90490ebec57438d60685b011fdab594a236af5c177bd5b6ecf0a001c43156a5a2b3c596cc4b80bf836096232393053cbfa03b4df25f1c92f5763baa3ee7a44fdd07b06cb9db7cb43614e7498ecfe3de42c323fe29037f59f40d856d7c413175b7aa5a5856522aeef7b518a4099ab175a28fd47c11e14fd9b8af3757800d83f6337febe05c32e39df75fe4fcc682b5f25942f69a0fa3a2d7a47b61586052bf3a157fa991969773db214f30e84ab593ae6335d9dff1c791e28633367054e6cf86e8cbc86539ec5796d71ebfcee6dcbc8984ceb479a09d62513e1d3beae5fe4019b9278705614b911ba84360da7332629028a550c6a69d12a4a832fb47b6fc097a5bb55b1ffe62d2727a1ba74efe2bae52227c0c30afa27ce512c0737b4accca331130eb87c7e218e5a383fbdc553a30924565dfec83430df46f7ac515b13626bc9366e21a5aaf9daa7f2bfa507012811ddabbfd66e78f30dc4087e435981c3f6719fbaf702ada3daa45553995f5ab8fefc2f8bcbe968790686122c3482f8752c673562fcc43c4be3f5f1c29fb5a1ae44b05f24b119b53d190977266266c04d8a638c51237faeec3b8f72982438fb5b115681f0a421c662d22c9c4c1067aa86ce781ce79b358374790eef3dc94d120990bfdf25bd230db9ce693cb97748c0311b3d7625fe9b7f4314e4effd2abdfc88d3f81dc2928c44af286cc2cc29112126b3cb41605b94d75a128f50ef83e8f233cad144faa05e381ab702719e95b0b8e8d3f86cb1d962e2272936e84fd3c905e0d61e4294fe97053d2c8e49b6714c569594c2ffc4806fb37b63abc65781886e436d102a5e3ba7545c79f8dd2dd6bf65d1a52ace1176fc228b059ce93e0addd5e373593f119d7f5dd1d9dc689b448c6fe6023204ec7e2dc704c645da4ba2e9d500e78e619ec934d9e6f0ebc5aad1bb70e37996489118d7c1e572a6e74d2c9e7912f25888c5924d27c6ae0079be75525c88d0acff628fb2f13bfaadddf56a667497a653bc325fc7f937b25c047f0e9679b83d5eddd67c458566d8dae431ea66af49b4c9bfd6978846cd10331ec44cf6796e42804cca3cdd8510cd750de8b9b46351376cc47187e999a710a171474e19cdedd1fbbf033a9db2e62b4ed4bbba172cdeb16fa18652055daa79fe032a39ffb07abfc6720752525df9c9b9f6d1bd657b4fae905f7751ac88c6ea3c6554df9406115931d597ff03a4f467880e5723f1acb82bc99f3f68883e53da5435e024abb6317b41cd5e5aa9e7027ef0a06f00d6eda431432caeafa5f34d8bebc590bfe26e3ebb84c4b4010fc9157e1f232fb6bb08580bf6b45acfee05874de45b6342d5a32a9aa8d56c736869cb1c86ed63083156ce3abb096c887036c19cb6edb7cb2569d787768aad57b4b79667f74411a07b7b05755a404709b0b0b21dc17f3a1b88721429bd9f3d8d5d49eae29750a2b761bbc4507f9a597b84c7a6b2b1de4c9d776ba3bc0405499cbc58a212c605eb8e15982256364a8ee3995572e00b1ff8192c0f5076c46f976c28e10d9f1655105340ce935b2325860a7aa163a026c67da03b5c91bef034ebdbdbc688f7dfe22ada1fc11aa9164145d223c3ddce8bab6f84ca8a8cc88e113e7559ef7fba3287c05c441464ab52e6c55ebdd40efe22fdcc6d497f7b9bf9aee8a2acd43399fcbcfffab3bc4565599d3d02b8c17b50eefe8aea5a2942a6c689d5ba076bb643950426aff132b8be02e432fcd39a9fa283a86a8f2b7c9103f2b44aa044129268c13c81b23f26db4a3703d0ddfa48a846af0e422cdcdcd71ef548de8e582134640fa1ef7582295cb286b5a0c5acedbb2965f2f4a36ce8a3c690b8d553c040369a03631f766e39c0e6fc70f364117b36132f8044a24c5e31b5dabecfa7d9c4a986282da87c8bdfe55d674f261d5d6453c6999ebceb404f1df93c4cba52b68bdb625fa02b33c20d2f6315d3bbafbad4549dfb79f7e9eb2674d13d8586c645fb40ee0bc97ec24e2615d88091db1f8a0b9f7d8439bc90897cfdf57c7bfb41cb8a594653a9759dd4180c71d7d7a9caa5a1b7d302619733cde8fcd5f574b1cf1b58cacdb959f2cc76a760d76f300854378b6b0e861937e63415a9079f3191cdafb70f289d88515829df854e48d0a90dfc5805117c1a7dda17ca344be9be4e9eb2bb4c6509507caecedb3cc44f5a3702e0217360d85d68854b99abbcf6f9b63cb56b48fd8b3295693f08e1626964b4f596ec3d6073846631b447222d498d3e9fc90de90669637a56c37b46f1f2dc9dd0c04b228b0a76112ed8cd44e18d53159a6a713882c9cd9841031d8d28191fc6eeea8c308c883b4e0168ec9238ca3425be2e90fd25d28239842ee7e67d329f722a533ec9c3e03a070548ed46d1c7063924e3447675643bad2339f1c8f360ee8a795a6dac26fb54f5c47f9a42bc72965e9bd55d2026527022cebac10a7554efa08bcc8ef024f9c8a3674156e119786f712f9e6844c4887dbd4442d47a5d5d94ceb251fa467f130e9cb1e72749122af85e9a2724d450869621c563bc64ca6d938e89adfa8f8f118949279cdd0864f0a98824b0f9e14787e805184274fafa8116222c5d637004686f51c900b221eb4858f1947d6f68e325ba283f55df1dc43ceaae208c8a51964d3f437a2b00b7269a350d2926de7c00e98ebb47721ea5541415831d62232db0e7659e1640291a4ce544c74efcec38038b76ed00217c1e1213f5237df7a2e6e22fde6ec21102c926decc0cd474da69bf4b23ac4895e522413cb203fb5d9cc9062afe75d06c3f3a5e6437f7cf2c209d6898ba7f0455a8d0195fac88a1c0ebaef301320264a25fb52100a61404b6f80ccfeeeed46cdd3be34f751fa622f7f94d90eca3313abeb53a2643699d775045f9912b3a25e9e9cc2ea6242c812f438eefbc5b0b8c4e50b57a0656e76fbc8c1c</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">éç¤¼å‹¿è§†</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>ç”Ÿæ´»</category>
      </categories>
  </entry>
  <entry>
    <title>åæ€</title>
    <url>/2024/12/31/%E5%8F%8D%E6%80%9D/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="c896c47d4d348ed3c78062e94a6ba5ad62f850e69291cde9882cd8a72bd3e8d9">b3ce3877181dba7d2dc822c297e3a5e461a588a800d045df3c29113d12bf7cbbb7d0f7661783787c364a123d51c9fbf700082b8c18d8f9e529d57580720f57be8970ca695dc7fbf44a86a874ba1e45b1ee1c2e39ee3b3f5eef2eb21a2a574136ace8821ae5f04c462bc469942411a6763087c3520426f068d9b4d1e7a67aa8fd50cb8809d71a2895d47ddc2cef1ebc35a989bf96ceb363de24fe779f1e2e355d99d847884ed2f20d283657dc072bf44b0b5b3740a2d8277f69a855487eab439895752bdd95d5eb6a2ef7cdbce14358f2f2ade8410983d5ad6c19c9c6b5e69a2dcca7ec9bf413b1d93bfb356d37c58953835709068b373f14e22916b4beb6dce4382fed7a7b5bbdc8d0166cb84a30a5bf5db0ceff2f8ccce4ed0d7f55e1f97c8cd59ca0208131e64889cbfe4ac3408d3e392c14c34d4b3256d1288818fb9159c79a7dcfd8c59d3f348ef37c8a3c73b780e3e20ad5ae5496faba153095fba287eb193cadc7074f6e6d50bc8592a4cfa4a61ddb9d50a67fd68bbe5e4e873ebe5215ec71232165f3f889283a50dd910db76658628c80849e1d7b00467818aa4ac071326df985459a11f43f26633ca7cd0a0c19e2ca418d6cca4ac550a4c3d6256721fe734003ad457fb170e43372e54152dcd00a09d68d36243992c896d8e1694cf9201bbda481a557e1a03e5017a9c3d193fe5081c900906f131df0693bbaa1147c49993acd2e295333814c5097bb89178af7a480f48e1078cac1d5fb7bdd864b600ab736f3efa5e9ed5ed22e5c5df0d82b7fd91caf17874ab166397cc652355083953c7dc9c6381d1a531d7a153ebbf3a8ac424842b41850a48b562e5b06e1a6b76defd26b7d6e9ee55c65f3064bb9f411644fd65b6aef1583bb21a1318fb4103c48bff71df102efab2e201a4ef2860992a4863548eda6d5fa805f3577199d9638b4d9b3c695954a42e0e31ef2a3edee710b184ac084b4430295e5f0faed0687c9335e0a39c2286d1aebb7a906ba041c57f406b32a6698f1accc51858265b5024fa711ebbfac1f8b43758655649ca0d2a143aa79180538d077a5d8cec09f786858c1557b4b35228bbaf36ffe2eb87522588a018a27104b5e9b20554bad2e57024eefce28a46847447a34fe38ea73131c082741643b659287b6d4e0574b64fbe116b636b65e663eff131aaa140e516ac3f88bcd3334e4448ed791e9ac56f24d08cb7bb9692be2c0ac91b03380af3172f53a287895c421a3f8abe502fa0cac956ed9d03126b683d15d24bef714fbeb250b04691a7d171eeb08d15fac530afa932b94ec5cf4449e32b20cd36b42ae81d2ec13043465bdac5f1514074df0d4c9fb49478335628b84773aadc6e13c7d808a41b3889a53f31e2fdb99b5b67d23fd699c849d2c6505b2b8b92179ed3f995ef0549774e1e7f2f6c0bce9386491ed1fc60278aadf94a8fabdf8828feb2ee6adb2107307af74fc3d11354df975a7f1b13317440024bf131fc8575e8275aa8888973e69c580125ac8739ec7a7949e9d27b572de695151ab21b9c4977e152d9448c5c704776afe3df27681e568a708e6bc9f5ae44e1438cbbe9506ed5b9948764778dcf133af0993def46d2603845fbe3209898950b04f2b693deb8156e9fa2bd48942d52fce157176479e0f87141a23c467c2ddf82187bcc8bed4cda64bc90c5f1e4ea18d2d22d8a2fb0ca8170fb640e6003a2de6e0c91a4402d19abe7983f5159272a920b9b1ac06357edc16164dfb7bfe931269e2f1918e3bb4f9560816612803090343ae9f0e28e239a7faf9b0c5c1c48a94daab0a0ff9b461dc6d1812290207c3d6891e9a649e15d0a98bc3feb1dc4d8e6156a1c9f93729b6377fd08ef187bdedf1cd9a9381f506f42cf19956d28ebd2def67ad065b818e124013f640a5e86e265d25122908e2f52eca52d5983d1ada734dd29bb87e20280090f3ee7854931f572e649d387dff288d3d703bdcd0e3dd63b7e25e0e2c634191a4985c6e9f8f94b56c8b60e6a2d6caa3ce2391a36430de0eeb94261495424b071b5008cdcc2da577e6416307921178c7dd0f3462257f727c10b0c076e1c9c762e1428423cfc9b34c9e89697ec27dc1037887e07c375c39dc71d8ef5fb896deafb5fe38190885c5a9b7b9930d9157307397ff3037df60d14a46a8a30e1a8dbbf1aecdddb5513765b8758576e7483682d7775346deb09e2da861b9afceef7efb7a3420f8682abccf93fcc96a9b8b27d7781cbae5bfee141d53f74f7f980213bada83100d9711c5911c44d1200152019c3b5329097c7a12efeffae93cfa0c08ae342eebc6cfb927c1172c54df50e7a2abcb0cffef364f57a61e53d05a15dedd4402b0d9097505132ca9f0fa90082f67908ccfa8733a8e5ce6ad8357e6bc09539baa6a6c7cd1f70a2f9ad780cdcecb95126e0dea3346399cf6fc96caa5f61e3ed73c35da3f43f704c164e27aac00daf8b10e1d8c808bc454b28223df48dd05f0ebcac82c4df3774598778f8016f2c0278448401d64fe346f2d090ada058b863a773537b6556e4097941a729e34ac8c6fa10631a3d541e1a288580ab75fbcd8a1834c6ab93f5cfb77903734a2aaa23d61ce1518f7b2b2c845e406205b5cb42eea077c759b109b7d1b132280a816ea72817a07a7b39a3434f1f5918d676137a53e483a631ecc5921f2b8d3a09b40cf85cd45ca56546fcd15148bd185992aa084026c0a42a4e5495cc3d6fa3eae3c307fa013232ffbf324d0008456c3f4626f8a750fc15530a74b5d142186a34e9c596d0c353640c404676e713ab533b6662b20bdcdf662faf3026251771f1c76720b1cc58063dcfcdbbe2b94e70ec29c16cdc045edb6295873b51c1b57cbdaeb54b1994c157468e96d40ec5648e5476529a3fa035a010ddc73cc476f9de7c95480be9e140a3d21685b456be4e1f7cf1e033d29a15f50d8bdb010dc63ff6a3c9ffaec7bb0b8bad15172e56dbee234c6f02fed1ec9b0b1887d18e73c2f634d6fb0a58fba06b20fcec3daa3d434aa73f06aabdb846165f3513a7050bbb7d8911034583486d714988595d236fc30eeddb695f73c86224a0ecfc5d25e24ba499b5499cdce152911e6642024aeadab86588991b2d7651a0d7771383a245ee52ce8cde38ffb902bc67b1fc62831e18dc9df988905438baaf7d2c1a5296c25e6a8473f33d7ac807be367c764b5ca38a44877c5cd9ba0fd7c862c82fa7c4d58fd241ac91a23e52ec036938ecc47188182d4fc4e564874ca96be35f7fc373670872d6b8912abb43fafa2f8a4a28a6298794b6e1ecec742ff4dceb56eec24053b36721f9f62dd4563e2c6cbaaabc4055f9cce653712bf892a7e558bffdbde5877f29e6697e24bc467d2a756c90a78a187eb444db4c3735f237254603bf66b970c88b33d2266720c50307814385b6cc389dc82b1541056bf43edab0a8ceb1e8248c1b576a9ed69ca459cb1acd6adcab027628ccf10db0f3929ec12c283ce6b236cd3d4781024e7636d63284508baa50b3c974a362905fbe1140c9ded23c27d3f6028e41271ffbb7d9515fd416972fb4e4ec276f96e86c4872eab1748180292da701edbbbfa4940aaf410a22661bdc908afd7c24c67e732c4d7d2c2d3f5359848775ed62e51983dfd53b706094322383e8f4b99d09ac963eec3db78c24c5ed75ecf0f836caf9d890325f7e713b07d9f18f8dad105d05642abd91fb433959e3419f4c318928cc5e2055f90dc763efe559a4238f1c3e5ed07533ef570708668d046e4fe4c08ffa6f757414107311794b55f958ff8de9a810c6de5c31ceaa84b195625854f23c474130d00f2799e6e6d2c6f770d0de2d222aa0b2a1226c208d0ffcb0d77ed6a6ecc9180f0ca2a4e39cc5b94e11662e899c80453da4a70325ca77c48a65c7c1f6c6bd5f654115f59dfced826babb637bca04d553a71440aed095073822a27e762a1aacac45509476443a82616683d9391a55b2d92e7a8c6db0c846690c718a1d0349fc386e26f2eb4505a77910fd7942cd39b2c9097704b83be647c56be8796f0faaa584297cc7483eead3cb202c8b14bef0e0afdfa2cb8764f87f602ada9bd4c7cd8d10330b965e82c6b8e5f2dd8dadf2b16196ba69db4286366665d01373a4bcc887691fc26a5087b07d51e6e0b4ca7dfd4cbd3ef3ed26ec950fb6c4202d4efa266488c1dcaa8c4a2cdf681d2846c35a0f2721a2c6938e69c48c82572d50f86a1896a3b90cb6cf4d716b2780be7ddf9bc61fd5f72d28e20e73c6f4214201600d7b706b4783b00dc18492dad32ba8c07da75d5200cea5b55a16cb134c59c31f8ee1b9874a8efbc0f0dee81a0aefec5939a1eb5615c63850f24672b030ded04056c44d87792fd7afd740dcbb7e64771ad8a51186d71350739aa03d4c19d8cc5daf142a6c2135afa868dfb59c4073599bdb9f88c463db55374ff2c5e186e39849b720e0a84ed10d8f23170e30dc7b3816f2852549dcf94e684f8185ac22518e65bb979a0b4e398bb9da131d9f8fef1ee81de03beab29ea6eef1a75fcfc8b6ca8da418b0fa5ff4a15bd181c5fda8e8c75ca85fa8698c2b8dcef5398f3215176d66485c4d2793819ccea41bea9e11c1ddd2093039a0bb4e82b0dfe826a9ee3b14f0ce9a2ada8c761e2dec7eeba8589c8bb49fca1b68c9658126a1200999d3f04fa02bcbed924fde1dac4a8f2b01e0cf428434cbd520e4cfa296d21bb07abb5f9bcfa29c0794cfa5f2e9ad61952a476c9f86f6eacae45bccb3da48cbc4f4ce09ebaa1a6ac839dd8271816897d137b9e0538279589f299bf5c3bb631a3e3abb738ffea6769aac83b58e0b3e6abb1dbb64dd18a75041443eee00d87d322db36aa3dda89822c6e1c621d7d01e197e566b2f5a0874ee1b5950c3c2aab099f31ebd6a7c8df877bcf141f5b9388d7c4efd7e73c5688338664d180d339666204d18afc446a4af85e1b9e3cd37f68bf38dcd708a009ca853312ec6e4bf070fc0e6daf5c06d58b1af080d25c1a6949b4c83abd02f07dfff0038ffd5e85bd6c5f118ea6cfed79317cd801891e90b6d656281828354661e3b7b2e26f8afe244d947cfb5a46a5a0df4b81f79be6f3603d4e46e9b6eace6c5fc7805a2d1f62c690471ea023892ceaff5e94ebed3ad9f6873befbd62dc34b3bc2de49c17a3d0627fbcf9525b0d1113e370d840ce2a5ab8fd71053349d78264e70c4ab2c91d43b7b9e58fa54559a4e78548b06e482cd34bca642bcbef167e511a668d262d8ba8dac9a6b600a34df2d8cd03b1e97731f9c8dec8bbd0b02055a286230d2ce847781b755e306afa4861e8cb3a71e5fd8624116cc4aca9fd6a868a041f0b57134542b77720815546b2e547f15a36b7297b6be46b222d6894e0df47a0e741971b4a9db5d738d5bee7dfd8e5e8b9cab70bfb2d9d9a166d0fe90dad2837453bb097715bf056dd08f0bd5643ed25cde09e04bec88afc7c1d8849285a19fc37df0246e9c641e49c3186a564b35d79e92636066b706cc8f0034667183fbb9489296d876334fbbe394094f9786abc1a242ef2cd6833a70d2e761554a4a387053037b1acf716d063398aaa8f065d2a0650ed1393e671373ae251f81cbba204c1506580f5e55ab2a063881f271d5f3a894a9d38c3a30e63d5fab33f8230e42b50304a400b36bc700a3c380411952f70bb64974d7521da50ee50419f65abb26cabc28ab27f3eae57e392ea529ef8443c79d60fa0f35795ecacc01cfe6842806ea4ba978f19cbfacf18acdc41bc549c1332c8543ae9321813d3cfb80097d2cc2c441eb1732bfc80e615385f9f8c7394f46464901a342570759ca59b3d9cee2d0d2c7fb69bf07cc0f782e3074ee488369be80df7fe01f43c7aa941705d7594249745a1b8952dff6224336e0a3a611ec7f09b323f6b5888f696c88d69be57fd0e1206bbb48bca6151c1d898eda9def55022b86c22b3055ce9e1c359f96e00c169c31bf191feb5aecabfaaf74fcad8d0b19135c6bcbf6d615eb8058d8ba1498254841a55d26d1b73bad75c618666e99b5527272e6626106dc97ff0c511ed36167a4f40746df4e1adbdadfee60f2bf020a6e247ed1886e3c3a03e329cc1c6cb518fd86f991e03258a0289889fbe720c0079a75ce44f72ef52f1556c1de30baab42d246ffe4b067a75b55eb0f26470626c7592117c0c6d11779a0a821f69574b845af73bec7f53ec689969dd37bbd2cbde4e7cfaefc8acaa2365daa1f22d8a06e4804836915ce491f9bb3dec1683344e6cb87a07022bbafc92cf4c7c0985aec75f647f98865a68ee9ef8ebfb900d044be3a1289ca6dcd5f1334952ccfdcb917535c2caf2db86f630e7adf2c5b5d8871573881119bf98822348838e13a8d71d33ad2a2b46a078684bd7cee51a710626473d9acdaffe4cd84ff49ca08a9eaa2123c23fab6180dc96df2519da569533ca5142b837a4abd03424623d1bd1b68b3840f5d53099bbcfde566cd568a1973dea77f4c38120ea92f2d26d19140ad0a910fd387856260c18aa3a176516acbc6f1a124e5430e94579d264942edf819b09d70fce0cdca449a60f15eeac7e39dee0f10ed5bf06309e7c1eb4fb7ecc054dba6d2bb8f6e85c469c5d42675f2edc2555e4b54dc0e9571f78d10d1180bf5c9ddc5b687307823a0b4185c648f38249c7bf1dfa2dcaea06edae28f18c7c5e5ae7b4f6d6cd0272bb58cc8d7cf5f37c467bdd4ec59eb56586f24cf81e197a563e2c4f302f9624d285fe8ef37a2fb0f93f58b2d6b7ffe1d0368b182f4520c4ba47e3bc0bf4deba7bef228d0c149dc972da8c938ba19647f1fffeb389a88fbf6ca2a267992be36adfa1c3ea75545a12bac71e0cb03f6703f77cdcebc77cab92036e4ed42e341ab80c18b9e47a9e0162ecf6a017479e71170280dc1f8405d64f7c0a82b8dbe3be12c970e6291abce0e7fcaf78431aa341f98b417c4b57658ff5d5632c4d0f281e5d8aaa13050ecd94f776b6bf7ad3d8b61d4b7f22d87e8a55cbc48c219bb92b2a19d9dca5527c5d0d3885848fa120c2891106ec085fc35e7e1a831ad75b6d61ffbd98a1c6f40a6b37d6ab0bf966b1dd2834e73c90b9b70b01b5e9c3dd3442a9bae815afda891392bcc136a012bef77691c68134c80908ad2257d0b74e9a65bcc1692c965200ed5863b0b7303c27d932463105193ad3d2089e7d26b71719f33cc50f56f9bf9fc3c7dbbfd4df9ddf55b437e75191cce87f80eecb361843bd737d618fc652eae1e73b027f486ac99c9ef20eb442deb5b3537289f1b5732835f35d5e0f4ad0548deec124df2fd485f5da7991a496ab40db0e19e44c049bfd3f0ee09681c0e388a8537969622c67739847d590ae2f9fbad50c72eeec8a732324f5652536afb587b48022393d0ed5d0669123d1239c0230625645117a72a63e19287306e124d1e6660dbf9bdd255d4b9947533394d6c0c12728effd540c9fc9f94cecf52942405707edda37312fd78452847414005a297afe2a1dca2d8fe57293b553371ac4ade4c6e38fa21dda29352cbe7f364b91747292a5c446b9018918b0961ce884a8fd1ce24ffa4bf7ee59bebe5af578d5a112391150412ad10753d49f951540ed0072a4709d085f3998e2bf8ffa24c7f330551015b4b3f44b97c09b41910b5258809088b35b087beaf15752f4e122251782db36f26867fa199bae966ad676bf1e020399f530f6cd0491fc371201002b79b7478855ebb5e260e3efd6be88237058e4afbdda36f2a2bf71d1ea0e940f1b4e741524f24e64198c4064144f5f0b13ad01e476ba48606a4e1959694a1aabe1bdc52bd582db49783ed0232d78bc643c9dc35d60680c0170aab1ba8ba3a8c3740c8fa798a0e6816f2c4efcb42308140d0483a167f16e39a59fb790344435c84d9b4fba93b2c435677b1db0357d66999b2d055343e43a45195ae278b87a53b57e59aa24251667fe39cbb7707771230081377a40f27b81d5e8292cbee6acbf799c3eb88ded9d1fdf6199b37b6b258c057fe48ee5fc28c566c0b2a00d596bfde34fd56c089dc42e04fd9349660bdc02e5b19771e928b2fabf3810eda8537f284bc539a34e104466b6eb0f997e3c7b038ece559e9ba49abc1b4ac86ae7e40f66c5c4298b581afe003502ad938b09d3793f96caced75b8fcb3ed2b056888caf01af4c09ece150279b466587f318323812fc6e22998df3676b967599e8144a4691995540510eea3474400060675c72ce54e4b4b70ebda2329b8cf8590ff96757d6974a6a96a8335e32497af1e7ac36fa69699a1abb34b9e761453d1621159822753097da078e580b0b034db9025d5ddf1bde7279ff80460077c328c9e2df624cab07d4c0a7eceacbee8c2611e13738dda3600e137a55c0d4e66cfdc29c59eb8d165a19cb4a60ed7ee019af688ad391f89cdefe8aee71b1e6c47471134f5d63c0c09f98ded08bd8690daf83339fc29589d83355ceb182be6447da86776d2523d4ad88269778cba0e8f795c950a24eff15fe94d12b08010775005b1b655e6d35059a70c08b4e2512a0df51d0d932a1f7d1b6b5aac28926f14fd37904c524ebbe21ad0cd05839ee582b5aa5b255e755c1fe4ba9a69709ae54877563716099276ba58384ab3b521ca6e45fed885116657fe7570e0d232062d5f1fb83951612dfcb50bd4319ff9e37a599f1d334e7ae083cd1f6e838a30f652d6c2c12660f22259cfd2ad66100dd7bf1af298f39f612b1971194a4a411208a2ad613be8b5f9d71468492d2df1c8525161a5e98b87dae913c814730e60bfee1bfeaf0da12df44f29dcf2b6190c77a9f84de7492c3d6fc091ce88712e53ef2543d99130786992766333c5ced1f060dba3a83458c3e3f4be103ff6929f6a199401bcbe65e6adb988d9365a9db714edf54c42c65c7a6da2dba608805e8e56add576fa4c1707d90732869439140328dae319ab48090e974166256b288f920aea23c90f7223b3076fb2400d283cb4824e748bbf7ab4f49c7101c7fb4ae26728194d6b2bb1dfcdcec4594c44f02cddf3297db54ac622f45ebb70b42057474870e787f4845c7ba92053714e763102a3a8b7e7801d80afcbb69de11ec32b59bec83151e7e64769023c7f9a69ecc09b8d9d0270d701dfdb86783e7d2700c3adaa08424659019cc2e9e069ba79ae1c0abbbdce275a36c4418b24fc4c95f40e961a6b5fc4f40d4c7fd486908e3941aecb1e7845baa6ef3a013ef04922604c6cfb8bfa4aecf8d9ea0511380962a9683d21937a4ca7970128c1055c615bfcd8eb16a02038dd2e5573b652c909782f177e56a79f0bbddf35e55d262d39a1c6485065692ec4c447ad4de283e7e46ce58948eae5ce28ac953f0e83bf73f92724ea2708b2280333850b93e7fe40041629dc39f7c3e51fe65a9a6d502c18e3e7eec225decfb639e667c69f3fab46ab1c34fe7c60d3a51f6f580b7098407ff2e2c0759cd6994e780eca0cdd91efd05cfff1b2ce5ad6a0feb8b65fa2131698ae4d94318d8bb44d2b93ffd805cdcfca2a8fd6facebf8c47cbec69308972acc7ac94565e1d30f217bbbf6356c18619b4d777eb6d88c9479c7a46e145ca70a937721713bdb0aec0b1def7004e954d68d00c84e5477ce2dbc78acc5e53225b9341754e0099a70ab8d7aac5c89c0cb21fb63352e64a25e60a5376a645ef60a51d35c1f279c36185543939fbeefb11015615cc605617e95ab47dd8d5241608afd97e899af3b80b9842a5b8d1cf02e50e477728cefc583086e410b5888f329e6cc6f389a23617b37f3bba68735d0d0927825ee920f3f0f7a3911a22c91dedeecd9724ccd0abadbf92ee5b5685138535e95df3b4309ad875e41e72cec6fce8d560fe3010b93a6f4f4cb6cd4955bcb97ffb9a31d38a0c2165abe7a15516d6f23a5c80eeda5efd5b75e0c51ea71cd6bf54de838572d2ec3d331dadf888a8e14585b27127a31ac10706a7aec9dbe20a02a81f4567fcec13d3f12cdcd52c221b1187362fa15afb5d6fd9328db71f2d2d3da7fed874391fd672b8f626d7c81c458e08ba0b2740c02ac93735b241056a81a6196e75ed6b03d2e15771d3f4d0bfebcdf478781aa7c843d1fb7cb29f01f1e31558649325c072efb9e69d79d298aa6c22b537ad15ef1080b71c83a9779e9778a519898a2cc0d865fb09395390c7f1fc98db7dd0ec0256e7988ab56ba62a2fccc2f742b02b13712b1f75bea78c6d4056e7fcf0943df8520a1120cac75211037cfa6c5300c49af1bf3d2c7c105fed4d0828037d75148cdf75b656453ccfb690dc59e12bebdad18198daf7a1bb020124918de065e24f7c300c90e1d563917a7582b1fdbd4d11f6615485531aace356927d4ddb3e4f69efd548623fdcd21239696e8912f7436a51edd74bf29c506655a3b4afb01c1487a763cf32f2576ac99a6d4978b12f4b97d1c87b485e91de57ad7ae3e1cdf31d85cf0c81571c382e7437066f93057b5a618b53c911b98d8e4341428586d0b4adcff12cf20c1fd095e303e10a2d204cc402d924c710dbc836a4b918215a9016ab9e193906c6b0f551a9d9d3d66f96747fbd5e82d8a8a142e1e9bb63c899c7b94af2a9510f2b95d30021d1be0c505c1dd197c47cb2637d5ac7b7ddc04194f963cf30abc61c3934d23c16281a02866b6fd91754f1a6ea1a9978d43683624574f4fee0ccd2fd98bbfcf7b376c12111427ab42c1ca6c83fd7c599ecd7d3bd046825929b4563d726a075466cf23473728b9a7882e0d94b427a4738f620b0acd6911134014317447a0b4812cd3820f1ade999456043aa957a9c943a26b11b9108e7cfa9a2c83e70293ac11ebb61b744d7c414f769e465893d62a2138ac40e18cad41ae418ab40f4dbbcf3c12a44e6275c09d1ec9e480acd6fdcd39a310bb580d5c8da03b0ecd4c17ae293e8ad9c0d9e2884223e4838aea6f9998aba5953ea0cab0266c1cba33881814f0f1d7ed1ee5c66a0e5538207e5e97867977e23b6290b637a4a894ff60cc78bf42fc5ba731e12362ff0d85dddd8955a3cfe39400ee5bf90a016c74e616a31b229d2d1abe8ad584854cbaaec1e339256fd6264c6ad02d179c72e33656b75a162a6cb7e90b76791f0273bc4576e79a98f81758597d0564831e396d6208afa56d637583192b01bf60d2f008d20f5424f01cb4cfe152e3cb0b61be2030409b41671f247d9a352b737d99a284fa3038a043ef6eaaa8e12163ce3af5bcf4363af81d0aa77f0fb774a499bbf3cd972eb5c26bcb5e160f9c30f44653bec42a768c41bd01c2df06aa5facd94f33a317c4fffed7e3a473c43669d1b95a4074c1368106d812f5608335a15847d97113b7d68855abb0bdbdaf270d0f97e0682f7f1e01f061cfbebecabd400743fa3d0b18f6b449d1e128478966ad84d906fecdbd43c2e144c9dd8bb71cd4927b5a79f7712c9f05e3dbee16a2d7afbd83f8e695ad866190f9791f9026adb3b45fa8d7c914cb21c0090da038167dc6b2c1a0323ee8c57317b4f4f269b661cd0093a5cca8ca0344e20f94e408b32548eeca315c94bdf7c30402db41665b1ce46c3c98dd0b06a9a46229becd9a25222b42b8c5ffc7fd0404d32bf91905e6a57cf5eaf9020246d107e8d6b84224ea6204bf7f65cde2d517d46e30a6016cfcf59ae661ee115470bd4f0f5075730ecf9267462a56337d41216fd2f5c5612e5dcc1922c00a556559defc6f9f6e55e0d5b0297c230a42d11d93aa75e2c1218fcc582959842481b8a01aac8d11180b8aaa80881bd5bbf77fb44c2481d6ba74fcbc5e075d8d88a4e1f13012a63464a11fd69ea3f15428483c325003e9f4ae1200c28ca674c515935ee7476e792f998fef93e3c155e95d39fd1431c2977352cc33fd535a50327813f8c59872265e0f8fbc1c0b3e7726b5a82a006d4dd342eb33d518e47279bf064d56625d06704c949379a3c83efd936b48fb8c486f829ed86598fe81af917ac7ee22deb65ad5399a4859e74752340f142d3bab18ae9701f2d1421c4a3d4046a7f3fff18725a7b2b41e65eccae5c4e64c4a16bbfcd7bf658fe601293236373a2f312277d1ec6d68a9b8587ee7db7725d423e7dc7727c0b870f977168d81853680ef2f3ec14e63b1308ca2ac053d356f84c814d9a6e91eba7a6e1fe9b1f1a0637028d06f52b96bd47f22ff34b6c17be43b72d51e804bd310fc9adb1f9a7e06769e816e46677103ebdb3737c45f0a79a4e42f4be49be4714c2df6743c6190d283d96cc9486786c172ad585db1dca666342ba50b61bec9fea4ab396420781b8ed10e29016b09fbac38f2030b243885ef79b49ec4eca62f296db535ab310a8c6b1a3d62485cf03ef9d70c2d53a92f5402ddfba974b1b842762e785dff15d5680ed899e49507e348452d34cc7366ff1852fc503afaf7da49426f0dd57f5fb7d1d65880bfdfe000263831541e80f151e5528f2381c62ed15ae6dbb12a892d6b93311f202e2036e73be3d7a76d19d3cda7024838303088d8fb734b4b000227e3c0917d4b839cb8c691e28b018d8511b31b568ee71accd298894ce81aeefcb1273fdc4a6b393cf018d9f6c277c0ac22e774f650aa87bef3bab78663e9784a199cfb3533b4d353c2a7bdab9ae588d4f2a187602a4ed11701cd648b7865983fcd15107cd81b7f231cad446a46635b44db65155512da9ecdee595dc886d770eddde5ac089a2943bab693e1869199aed68e6ad6525a3c0d798f28b7ea9ceab5bfa97e9c2825df4910f39c4cab6d368251f9543f8fcfe8e131425ff3bc2881bc4eaabb300480f2035433c1b4f042590f28f2c6055b60f55c6d84efcdd1997f779d76165d4fa1cc2826f13decdc00dcba7c3cc5816a7cb3a0d869c4dbd5131f0d92dbde682ea81bf90c5ba35809cc460094062f350b9c162d20ac947aa35256c9b2ffe796452116d1389dc75a4e422f35a94ccac14d5cd5278cd2a579a2d780b78b14a7ea896cc20706a2c3eb79aa4d0b450eb54e3bc0a0c8a84bc44d23bf914ea50d65965f03bed7aa92a7d936c11190230ca30608ac6579f544fce8427c8b376b5c8b2aa94272ff9f73b3c8b484833aed89a09210bd39010bec1629a112a2a53832195467d59cf613d4d33bc251aa0db8ea31f2e7b3ae2999cfb546d00719b155732a25566d4ac9786aeea839fe221de4be90837279da94391aa922a182f66c0fb131c643b046895701ff60cf732772a3540bc646e55cde24b9b8e5f3126f5961eb09683c2a98b8c5fa8428d618f16d7098955bdf1bd134ceb69108616cd83d1e0921e6ff213848a51feb440fbe786b029524707334c82e3b79ec78631f468185723a487d763d755d6dcb4863c5357f341cebaa886319d5c691e32148841d8acdf739123d87089869e248af28f85ea744994914c3c21c5cdd9c7d9b5f5fa212af54f1d0de62d317df3296436476894455cd20537d7036e877e1fe6b5e149c1d487162d0e6938c40f5e1cf6058bfa09c4220bf2fdfd4f295170b19dced592ed88570c1982dd3a9b35fedf3f7fff8895ed1f4a87a9a6aa5723210c7140b0cc062b8c5754c37b2bc0d0752f0025c3ea3b273b8633b2d57b6d7d9886c3a796fdd6a101733eb266d53dbdcf90fe09bde824cafdbf212b29c9c09ff63e34181fa41a643e8663018308d8c219b8d6fda38ec0f74ddae8efcb6a6c5010c6e9f22994690351884302a3ae5ca93eb11bddfac300ee29a3909d28bac9c152cffc3ca8150672ce05ce5af306e5added39c896afd2dfb1fd0eba1cb8456a31689076c5e91b793495e42ae6a73f2e0d5f6ffc73158f4314a3056dab31482daf2abfc7e09e2bdca1e5bbe73c3e523a0d8f06070bf0dfaf4fca97e353cf25b4d3ae29b175f2afddac243469891239ba8a6edb73ad2f2d069d07775980a9da0950e1600a9459da8c7d1674356331aaff8fdf532191b1dd9cbd00ce3dd5233f0e8dddd3019d8791695bdfbf2c67b2fade6fa9a82c9566e83f57ced7b8a7ad21c9385c60a663aecd9be030e889a3fecd7ca17874282d3f5ebcaa42e12aae2f6f920ca6e41b2aa9f1b9064032b6691586d07c781a418afcc107922a3e61769075e8e760d78ca69ef30de65070ee6e8093bede891116fd72a2081fb7240dd63e13f998e96773828ddfe2120a482180691703c829497212239e9323877139dfa5b58ea96c27572e0a2cb52d07d5bb267f722d4b4d55c38ac1ee406a0ec4abe4d5757fa74e44b35a6a29170d5581ed6aba7fe922c27b25739bdf19a740b65c2f2e405d4b811ac997b1b58cf871ce96b155cc7e72210669d9d6e188888ddd309f2c7a824623b1855f482f0eec3dd6d8bf032da8fb421a5ae84b12f51e1141f0a72ef4076619b5768c633a8dc973fed1d53a6ffac74618ed6157e4ec894270a4e59abf6855f05fd2e6a0219dbebeb93176c658af99c9a98d6cb62d2a48b8cfea276b88856f2b4e293cc66b330a2b2f2175406c3d4ec9a2d388e3c43fb0be632dd812a1cd0fa437dfdc43af672eab4796d04f278f9b0659519892fe344d960b61819063855cda9808e6ea4322924d3dc365d349688ba7156d63b1cfb49a07abdb5ed987be4cfbe5e23f14e7c0a948af1e501f220e3202aad5e90738ac5dcd8dd703dd95b620565f37309d5dfa0f247fb5034e78a11fdd0d8ee22a4e6c1765ec61042719f3990621442a2a5f618015a30237059a845f868b1e694612c7d2304bbf92edff3cc25661434a162ddff5a96600ec276c834bc57c5a5a4059cebc899b1bec6e350c22cee417bf198ceef41e55e314ced21f7f09f67db4d3e4e10dc41a1695e1f938ba708d2926bf615687069dc33145e6f6d18d8b41185315cc72b3e3f3770677f375e5f40c56f2948fdbe1815b3c4f68ba873f6d9445520c505ee432e44d982c8fb60e4c0869907e2889dcd5449667ebef56db279b5fb4eaf515c0d2683efa868ee76b0646a970cc3528dd568f40ed7f7ff5103f1fe3745e49fe168737c79b5b1845071af6af6c6bf65db3985cd0ccda75cbf53f4e033d803258cf644ecb4223daff9da7503d90393cc03765b9f2e57a3aa394a5bcf33e1f4bdb05812b09943647cb857eb0692e33037304c7927d8acc2b925193455f064cd47c67008bbb0082560858013400c155004e0fe642c11dfa6aefc023996ddffd3bd6c124ba9cce162107ec3f1d26837d607a984eab43b4394fea5412d94dc7568cba12c6d16ceee8190a9fedd5f291211adb621d90008cbb040f81c13745354391ffc64fd793d3864f52e3f41fc0508c7077b10d39b8c4a2309e13136a7cb092855739a4e0a6ffb3f624ba43b137224ff7cb112e4e4ee8d1b20f50c65a66cf324e31a23e4624afbc30b560d88b10f4f36a399001f8406381c3dbe3b42d7891cc69a1430b20a5bbcffd590f47f15fbd7c9f89d14b63d6c48c76c30d609e1e98bc659d0b90ea4edfed36d2763964178f27b53fcd0533cfa707c24a67ec6d36a8618dec200577f12e15ac5b9ef8f03fa344a16437ef7501bf37751fd0d35ea4584bbba9d13c385abb80eda2d8c70c70977099b3f286c69d675b8e10cb5d597a1a560a2088bcbcd7afbf9ef0df9c4cd4cd35a32c9a60fdab98492e9c1a62d8c5dc251bb9b8c3a22b737d2598e4e9ad177805e282e9c4cd513bdaecda2de3699ea3f63a71063a43779bc03d4b625fc033dcc5b309d1ea790de32139684c43215bda15bbb8e35c72f72b996945c24237061abbf771c9e5cadd30c64206ad96804aaadcde7e4eab99fbf0860b365d9592b2bf4978dd023febe18d899160f40d27586b23d76687249b1f2e43dd7bc39e135066951c2814b4a462d4ef8855a3c44ca274a99f28e852a2683f980a1252117731d67936a4bdd3528b2f9f3d18baf6a3509ea29d502785aa115000a186b564548d3e34102aae92302eaf467e9b8cad98a69e30a68d66fe9be0b997e1caf463387d9f3af9063847bee7c4af102825530391819089808a56ee5d22ca27ead18b7a58c2372b9c435c2aa578f336266243f456a60a81bccdc47dfeecd28118237e0e4275cea225e59f6b01c17f291456056a1036a219a98a9ce6f4c0fa0ce61b6e6ebc7c739c32cddd5317b261eb29ddac107b05328939ef6db7eb72493f9aeabe0ebce5a47a63617f1f9661b4f0d94d962b310ddfc099f4dff57ac1a19b53a620cc777599b29285b0026771deb75b03bc1ace5bbde19b641f9fd0b4f839f59dbd93eb7ef7b1e76ca066fccdc7704ae4bef889b374bdd94d045bff84d13f6284f47a2b649d7cf8b51f33c6d86aee2cdd838d81c288f1d1c4b4f3cf06be22e7e1ec81ff48aba7473d2d05a138d97d92aaf067d7ebe2a3beea5014a0e6fb442538be8ff1edbd6cb24b990a07127f89ba654725e557c9736a86aeb9f9091deac517e4159f7b85887abd9e929584e6df3cb6258989e5c5beb2d113f792cb25ad7771aceead0e743fed0f17027cf6d9e2ad45088489897f2483c4ac4c99b5526d8d75c7392dae0b0314522ad46cfbb072f07ac469ca2d2c53efba2547700d0da8cc61aa89e223449149f875d13a3f109f3125ea174303eaeedde10b717661603b4eff3d46842a0f55422c421f3ad46bd7cca05f3ec5829e729c1ef137de71d7eb66810fc1b09aa1a55c5d054f79fde6efd6f79fb0f7175de37b6f8815d1a21f52436b5f9e9b0df6d23e8f5ae814ab5cfeed31e845d5985b07fc9a9e8411a4d8f3dc1c7e5f728adbda4c48e031e23ee532f4319c229bfbd295c3a0f69603b5fc029b475fb3a3e55c5099c2f0ca4ef5dc42bbd3c86a4baa1c309bd6a32e93751668280b8a0d4b8dcccc8c3b75895ebc1296914847d1634ec8781bac7761388ba2edc348ca2c0e4fa63f0486575e5cb775724bbd736bd8ed3a2a96a16ea54c5e8237082cfcda03c9dd703d7154568467e271c16b9cb0f6bdfcc28665693994778f652288376b844d9962e75f08e6ff50f7402ae6a37f57b3147b39fbaa9a64156fed6c8caea05bec4f2ea3c5adf1f460987ab7ea9bcac711926ba86e2dd2fae13ad4bb44a741fbd2e32da2b8a0838e7c53bb3690e208952dabf6dfb5ffaf1df9a8a4d6d6126e1fe4854d5abe2a60813e4580983edd582bfa456c75f7910ab64efc595f5282a55e404b9bcf0e1799c716f1628b15a268428731297054a5bd35a50275ec29d522bf7d285c0899a8d0d7c42060f343638c7f6373bc57a3fd9e2f15dbf821415d9b12e5a6ac6c680114280ca6d5916308fd64b694069ff15deaf7983c12f9967a65fc8cdd258439998d36a448c1ff68c25e0b45a16811700dff52902825c032aa5cf3653fe741cdd345af11d422348e921d96b8f1818a3f3e48dd906a8db56364c4a6572ae370d305cf66f55c265abf65078707ec18cd419e8473f3bcfa339806d9b32086f2c766d8c10842ea7bf56c883d0859f88cd4b1e47462a1c86630b81b72b8b00a319870679e5de8c38df46cfde8d9bdd081293955ea91d22d98f8c4113482ab728807060db3fe3531bfc2c605f646e977e5b836e5dca814bd2596a3bb2c30932db1969fd816e547fb61a22637dac87e297cb539b07475862bdc4c85bc778ac9ca82293a0fa02bd951f81faafe58a3119404a99b9ea807a506f742d306d498a257293b24e58eefb24a3104c41bc993b9fa83c99d69ac94fb5dc9b75d2d0ce8bf3e7133d201e6a68c1da23a80fd073ff27231c8fff96de7f9d715f2edb979be5b16747b3e320b76626a536980776e273432610e304ee343e0b7209c81c8721fcb54a2eaccd3b4622334d601a32a76895c86e6996bce0c164bd4254698e37f7168aa062b113f52ede3e449eca5a0cf3e82f6b302bd343e32abb513f15f9fba101b5d49eb1d098d8a1b919af80755bd3eaeb5e86a3ff2071ea961f19bb544d7df7487e76bf9e2aef991233d40669c9d32f2e496d390d0b9d1d201abe5f0448cc520cd6a08f783147721a05f9a0ec21f813b9da95db8ccc67167a48863fe6d6409fec50e35fa4563a933c38c03eb2fa4484bbd382dc7117b062c148971479c2e3ac06cc94fc04a8b28de56539c6dbb002415ab9502fa2caaafacdecbbfc2ea997d692b22ee510da0a8e399fbc98a1127f56ef4e3a2575e2863db9889e14d011f29847e1950fd252bb830e68e1f49a28ace5fb2d0a9bf7172be4c9e8287d12070695280c5717ff66737804e166399a77b464f76c6f6fbdeb80ea02af77768bdadbd9a5d87838736bec70af5ad62249daef8f5183b2683fdba744b7680250446290068ab68d886b753a0793021bf02a8257e6c2bd90013d1809ece679f167bc7ac3533f1b5fd638bd15cfd4d8bb3e689cdb5065bb149e9ac7c71d93ee49cd7ec9e1dfc2ab729d9f4c1d565c9f9a4682fac809df4f5dbfad006afcaa37ffab8e8b4f828732d52cc15d990af4b3ee00b326aabde3866b6de818d069bb7fd5c3c253c675298231b1f18c3edff34cf3601ddaf8af0af8b78ccee5d9ef569c2deb3009033e09708d69a91eb7fddc11083c68c9137977e6bbbec7f15a5efd5a6ccfc3023d0359415a2e521a2c8d03c159948be8cd31b78b99995081bf07ca13a617871c779120d3c3c698f6b474a25cd84cbc062e701761cb901246bacf5175b4f2f5b357b652d188ee89a1e0600408b85128f81d4192b3e64e34f70e55512fb37b3dc27139cdf38604d96c526f70186118f3fa803feeee3f23a197377cff22c6a59b8b900a476b330e2db4aa4102a1d2758da13b327e4d674af9a9f0d370ac2fd892d1f13410e0a40b69efa728b5e38065f596366cde1500479e0d9682d055c0d0dc6318e81421133ad1ab32f26eedd94f557d50c1a34aaa431ff896fcce7b1621cb2dbca33fb846ae3b954a2c005a135fa272d6b317f3b5f62e4a56311bb2b7467741f08e3aa466aff2e149be4b6b30c09fd4954ba5824508fe189c186d0e1a7e06c9a0964d5adde90b92315df15ea35734421f779b5239c6125b53e1cdef83b922acdaf888ac6cb512ffbcf9495d84ea886c5335f54f4681ca6ad9f5cb4ba5f8bee0d4e00f519a5b98540bbef01f5119378fb0e1559f441b3eaf77355ed1012353a9b6518c47d4edd002052cc46e11b9ca7aea465dca64ed244de0f1bde24967b35d73e12d1c95458f93a3530b9763d7611f042430b481fc0c3c3b1088eee1069715074edaa4b0dfc94ce44ee08ef5d4bfa5f0b4a803d1b9e9dc5b53ae793d118334ab513dcb7ddbc7ff96121ca1de59590e6118c81c2e9370149fb50dc2b5ce25f1b6c9057b09c017b78c95e302f066a078a790b7dfa3dbc14ed5be660ab0c5959cbdbc5f610a82cb42f904d923702f07ff3e528402af8dcd8b715ddb341c4be27a722391e2291b86600189b710889df150f1b898eed4a25ab682dad9fa6812804edde9ee7c1b85c0ed93c3aa5a0d2bf5f890fc4d833745e58c8dc2afe342a1bf0ad5058072e6dcc998362f463996c220f1fbaa607be83e609a9091f2cdf30b1500272013ed2cf524e7647e54034525ea5ed518bdef0c613f2c3067a5ec9dab8ff857743be385a66eb9688fad932699b0b41a2db873030fa5d90770fb81418221fac015ee4d185001e5b185e324a3c94d0c55541be4703bf68c9461f1cee8750221b1528752456e15485bf5393435dbd13119a4ed00c9f9943d4b5514f732aeed32bbe7e7c12a0a0e37e91ef719feb5d4283a2891581148efcd170e69a0631ea907eac0d4f60d3446a91224e9bf482ee10d401512b7c4405d53fa08d09b7c5c763674f87f08bae7bc60dccf</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">éç¤¼å‹¿è§†</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>ç”Ÿæ´»</category>
      </categories>
  </entry>
  <entry>
    <title>åµŒå…¥å¼Cè¯­è¨€çš„è‡ªæˆ‘ä¿®å…»</title>
    <url>/2023/12/11/23%20%E5%B5%8C%E5%85%A5%E5%BC%8FC%E8%AF%AD%E8%A8%80%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>â€‹	å…ˆè¯´ä¸€ä¸‹å‰ææ¡ä»¶ï¼Œ</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
  </entry>
  <entry>
    <title>tabbyçš„ä½¿ç”¨</title>
    <url>/2023/12/10/22%20tabby%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>â€‹	å…ˆè¯´ä¸€ä¸‹å‰ææ¡ä»¶ï¼Œæœ¬æ¥æˆ‘å…¶å®æŒºä¸çˆ±ç”¨ç»ˆç«¯çš„ï¼Œå°±ç®—ä½¿ç”¨ç»ˆç«¯ä¹Ÿæ˜¯ç”¨mobaxtermï¼Œåªèƒ½è¯´è¿™ä¸ªè½¯ä»¶å¾ˆæ˜¯å¼ºå¤§ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç»™æˆ‘ä¸€ç§ç»™ç»éªŒçš„æ„Ÿè§‰ï¼Œå½“ç„¶è‚¯å®šæ¯”ä¹‹å‰çš„è¶…çº§ç»ˆç«¯å¼ºå¾—å¤šï¼Œä½†è¿˜æ˜¯ä¸èƒ½ç»™æˆ‘ä¸€ä¸ªååˆ†æƒ³ç”¨çš„æ„Ÿè§‰ï¼Œè€Œè¿™ä¸ªtabbyçš„è½¯ä»¶å°±ä¸ä¸€æ ·ï¼Œç®€æ´è€Œä¸”çœ‹èµ·æ¥å¾ˆå¥½ç”¨ï¼Œä»–çš„åˆ†å±ã€é¢œè‰²ã€èƒŒæ™¯æ’ä»¶ç­‰ç­‰ä¸€ç³»åˆ—çš„æ“ä½œéƒ½è®©æˆ‘å¾ˆæ˜¯å–œæ¬¢ï¼Œæ‰€ä»¥ä¸‹é¢å°±ç®€å•çš„è®²è§£ä¸€ä¸‹tabbyçš„ä½¿ç”¨ã€‚</p>
<h1 id="1-Tabbyç®€ä»‹"><a href="#1-Tabbyç®€ä»‹" class="headerlink" title="1.Tabbyç®€ä»‹"></a>1.Tabbyç®€ä»‹</h1><p> ğŸ€ Tabbyæ˜¯ä¸€ä¸ªæ— é™å¯å®šåˆ¶çš„è·¨å¹³å°ç»ˆç«¯åº”ç”¨ç¨‹åºï¼Œé€‚ç”¨äºlocal shellsã€serialã€SSHå’ŒTelnetçš„è¿æ¥ã€‚<br> ğŸ Tabbyæ˜¯åŸºäºTypeScriptå¼€å‘çš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼Œå¯ç”¨äºLinuxã€Windowså’ŒMac OSç³»ç»Ÿã€‚</p>
<p>ğŸŒº Tabby (å‰èº«æ˜¯ Terminus) æ˜¯ä¸€ä¸ªå¯é«˜åº¦é…ç½®çš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨å’Œ SSH æˆ–ä¸²å£å®¢æˆ·ç«¯ï¼Œæ”¯æŒ Windowsï¼ŒmacOS å’Œ Linux</p>
<ul>
<li>é›†æˆ SSHï¼ŒTelnet å®¢æˆ·ç«¯å’Œè¿æ¥ç®¡ç†å™¨</li>
<li>é›†æˆä¸²è¡Œç»ˆç«¯</li>
<li>å®šåˆ¶ä¸»é¢˜å’Œé…è‰²æ–¹æ¡ˆ</li>
<li>å®Œå…¨å¯é…ç½®çš„å¿«æ·é”®å’Œå¤šé”®å¿«æ·é”®</li>
<li>åˆ†ä½“å¼çª—æ ¼</li>
<li>è‡ªåŠ¨ä¿å­˜æ ‡ç­¾é¡µ</li>
<li>æ”¯æŒ PowerShellï¼ˆå’Œ PS Coreï¼‰ã€WSLã€Git-Bashã€Cygwinã€MSYS2ã€Cmder å’Œ CMD</li>
<li>åœ¨ SSH ä¼šè¯ä¸­é€šè¿‡ Zmodem è¿›è¡Œç›´æ¥æ–‡ä»¶ä¼ è¾“</li>
<li>å®Œæ•´çš„ Unicode æ”¯æŒï¼ŒåŒ…æ‹¬åŒè§’å­—ç¬¦</li>
<li>ä¸ä¼šå› å¿«é€Ÿçš„è¾“å‡ºè€Œå¡ä½</li>
<li>Windows ä¸Šèˆ’é€‚çš„ shell ä½“éªŒï¼ŒåŒ…æ‹¬ tab è‡ªåŠ¨è¡¥å…¨ï¼ˆé€šè¿‡ Clinkï¼‰</li>
<li>ä¸º SSH secrets å’Œè®¾ç½®é›†æˆäº†åŠ å¯†å®¹å™¨</li>
<li>SSHã€SFTP å’Œ Telnet å®¢æˆ·ç«¯å¯ç”¨ä½œ Web åº”ç”¨ï¼ˆä¹Ÿå¯æ‰˜ç®¡ï¼‰</li>
</ul>
<h1 id="2-tabbyçš„å®‰è£…"><a href="#2-tabbyçš„å®‰è£…" class="headerlink" title="2.tabbyçš„å®‰è£…"></a>2.tabbyçš„å®‰è£…</h1><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/Eugeny/tabby/releases/tag/v1.0.205">https://github.com/Eugeny/tabby/releases/tag/v1.0.205</a></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101539329.png" alt="image-20231210153958212"></p>
<p>â€‹	æœ‰windows macoså’Œlinuxå¤šç§ç±»å‹çš„å®‰è£…åŒ…ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬å¤šç§æ¶æ„çš„ï¼Œæˆ‘è¿™é‡Œè¦åœ¨windowsä¸Šè¿›è¡Œä½¿ç”¨ï¼Œæ‰€ä»¥ä¸‹è½½äº†windowdçš„exeæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ª<a href="https://github.com/Eugeny/tabby/releases/download/v1.0.205/tabby-1.0.205-setup-x64.exe">tabby-1.0.205-setup-x64.exe</a>ï¼Œä¸‹è½½å®Œæˆä¹‹åè¿›è¡Œå®‰è£…ã€‚å®‰è£…å®Œæˆä¹‹åæ‰“å¼€è¯¥è½¯ä»¶</p>
<p>â€‹	ç”±äºæˆ‘è¦å†™markdownï¼Œæ‰€ä»¥æˆ‘æŠŠä¹‹å‰ä¸‹è½½çš„åˆ æ‰äº†ï¼Œä½†æ˜¯å®ƒä»æ—§ä¿å­˜äº†æˆ‘ä¹‹å‰çš„é…ç½®ï¼Œæ‰€ä»¥é™¤äº†åˆ æ‰è½¯ä»¶ä¹‹å¤–è¿˜éœ€è¦å»åˆ æ‰Cç›˜çš„é…ç½®æ–‡ä»¶ï¼šC:\Users\Administrator\AppData\Roamingã€‚</p>
<p>â€‹	ç¬¬ä¸€æ¬¡å¯åŠ¨å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101557259.png" alt="image-20231210155713230"></p>
<p>â€‹	è¿™é‡Œçš„è¯­è¨€å¯ä»¥é€‰æ‹©ä¸­æ–‡ï¼Œé€‰æ‹©ä¹‹åå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101557342.png" alt="image-20231210155753314"></p>
<p>â€‹	è€Œä¸”æˆ‘æ¯”è¾ƒå–œæ¬¢é»‘è‰²çš„ç»ˆç«¯ï¼Œæ‰€ä»¥å°±ä¿æŒé»˜è®¤çš„é»‘è‰²çš„é…è‰²æ–¹æ¡ˆäº†ã€‚å…³é—­é€€å‡ºä¹‹åè¿›å…¥è½¯ä»¶ç•Œé¢å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101558826.png" alt="image-20231210155851798"></p>
<p>â€‹	è‡³æ­¤ï¼Œå…³äºtabbyçš„å®‰è£…å°±å®Œæˆäº†ã€‚</p>
<h1 id="3-tabbyå¿«æ·é”®çš„ä¿®æ”¹"><a href="#3-tabbyå¿«æ·é”®çš„ä¿®æ”¹" class="headerlink" title="3.tabbyå¿«æ·é”®çš„ä¿®æ”¹"></a>3.tabbyå¿«æ·é”®çš„ä¿®æ”¹</h1><p>åˆ é™¤æ˜¾ç¤ºé…ç½®é€‰æ‹©å™¨ ctrl+shift+eï¼Œå› ä¸ºæˆ‘æƒ³è¦è®©è¯¥å¿«æ·é”®æ”¹ä¸ºå‘å³åˆ†å‰²çª—æ ¼ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101601528.png" alt="image-20231210160101515"></p>
<p>ç„¶åå°†ctrl+shiftçš„å¿«æ·æŒ‰é”®ä¹Ÿåˆ é™¤æ‰ï¼Œ</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101602643.png" alt="image-20231210160223634"></p>
<p>è¿™é‡Œçš„å…³é—­æ ‡ç­¾ä¸ºctrl+shift+wï¼Œæˆ‘è®¤ä¸ºä¸æ–¹ä¾¿ï¼Œç”±äºæˆ‘ç»å¸¸å°†è¯¥å¿«æ·æŒ‰é”®è®¾ç½®ä¸ºå…³é—­å•ä¸€çš„çª—æ ¼ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿåˆ é™¤æ‰</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101605559.png" alt="image-20231210160540547"></p>
<p>å°†å‘å³æ‹†åˆ†çª—æ ¼è®¾ç½®ä¸ºctrl+shift+eï¼Œå°†å‘ä¸‹æ‹†åˆ†çª—æ ¼è®¾ç½®ä¸ºctrl+shift+o</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101607090.png" alt="image-20231210160745073"></p>
<p>å°†å…³é—­å·²èšç„¦çš„çª—æ ¼è®¾ç½®ä¸ºctrl+shift+w</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101608034.png" alt="image-20231210160817023"></p>
<p>æœ€ååœ¨å†™å‡ ä¸ªå¥½ç”¨çš„å¿«æ·æŒ‰é”®</p>
<p>1.ctrl+shift+å·¦å³æŒ‰é”®å¯ä»¥åˆ‡æ¢ä¸åŒçš„&#x3D;&#x3D;æ ‡ç­¾é¡µ&#x3D;&#x3D;</p>
<p>2.alt+æ•°å­—æŒ‰é”®ä¹Ÿå¯ä»¥åˆ‡æ¢ä¸åŒçš„&#x3D;&#x3D;æ ‡ç­¾é¡µ&#x3D;&#x3D;</p>
<p>3.ctrl+alt +ä¸Šä¸‹å·¦å³å¯ä»¥åˆ‡æ¢ä¸åŒçš„&#x3D;&#x3D;çª—æ ¼&#x3D;&#x3D;</p>
<p>&#x3D;&#x3D;ä¸Šé¢è¿™äº›ç¡®å®ä¸é”™å¯ä»¥è®©æˆ‘è§£æ”¾åŒæ‰‹ï¼Œä¸éœ€è¦æ‡‚é¼ æ ‡ï¼Œåªéœ€è¦é”®ç›˜å³å¯&#x3D;&#x3D;</p>
<p>4.å½“çª—æ ¼è¿›è¡Œæ‹†åˆ†ä¹‹åï¼Œå¯ä»¥é€šè¿‡ctrl+alt+å›è½¦æœ€å¤§åŒ–å½“å‰çš„&#x3D;&#x3D;çª—æ ¼&#x3D;&#x3D;</p>
<p>5.ctrl+alt+t å¯ä»¥åˆ‡æ¢å½“å‰&#x3D;&#x3D;çª—æ ¼&#x3D;&#x3D;çš„é…ç½®ï¼ˆ&#x3D;&#x3D;æœ¬æ¥ä¸çŸ¥é“æ˜¯åšå•¥çš„åæ¥æ‰çŸ¥é“ï¼Œä½†è¿˜æŒºå¥½ç”¨&#x3D;&#x3D;ï¼‰</p>
<p>6.ctrl+shift+. å¯ä»¥å°†å½“å‰çš„çª—æ ¼ä¿®æ”¹ä¸ºå•ç‹¬çš„&#x3D;&#x3D;æ ‡ç­¾é¡µ&#x3D;&#x3D;</p>
<p>7.ctrl+shift+ï¼Œ å°†æ‰€æœ‰çš„&#x3D;&#x3D;æ ‡ç­¾é¡µ&#x3D;&#x3D;åˆå¹¶åˆ°å½“å‰é¡µ</p>
<p>å¯ä»¥çœ‹åˆ°è·Ÿctrl+shiftæœ‰å…³çš„éƒ½æ˜¯æ ‡ç­¾é¡µï¼Œè€Œè·Ÿçª—æ ¼æœ‰å…³çš„éƒ½æ˜¯ctrl+altï¼Œåæ­£ctrlæ˜¯ä¸èƒ½å°‘çš„ï¼Œè€Œæ˜¯çª—æ ¼è¿˜æ˜¯æ ‡ç­¾å°±è¦æ ¹æ®shiftå’Œaltæ¥å†³å®šäº†ã€‚</p>
<h1 id="4-ä¸²å£çš„è¿æ¥"><a href="#4-ä¸²å£çš„è¿æ¥" class="headerlink" title="4.ä¸²å£çš„è¿æ¥"></a>4.ä¸²å£çš„è¿æ¥</h1><p>â€‹	ç‚¹å‡»å³ä¸Šè§’çš„é½¿è½®æŒ‰é’®æˆ–è€…æ ‡ç­¾é¡µå³ä¾§çš„æŒ‰é’®éƒ½å¯ä»¥è¿›è¡Œé…ç½®ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101634986.png" alt="image-20231210163447978"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101634116.png" alt="image-20231210163454106"></p>
<p>â€‹	æˆ‘è¿™é‡Œæ˜¯ä¸²å£5ï¼Œç‚¹å‡»ä¹‹åå¯ä»¥é€‰æ‹©æ³¢ç‰¹ç‡ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©115200ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101635089.png" alt="image-20231210163551067"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101636546.png" alt="image-20231210163634527"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101636210.png" alt="image-20231210163642195"></p>
<p>å¦‚æœæ˜¯ä»é½¿è½®è®¾ç½®æ‰“å¼€ï¼Œåˆ™éœ€è¦å…ˆç‚¹å‡»é…ç½®å’Œè¿æ¥ï¼Œå†é€‰æ‹©ä¸²å£5ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101637283.png" alt="image-20231210163734239"></p>
<h1 id="5-sshçš„è¿æ¥"><a href="#5-sshçš„è¿æ¥" class="headerlink" title="5.sshçš„è¿æ¥"></a>5.sshçš„è¿æ¥</h1><p>â€‹	å¦‚æœä»…ä»…åªæ˜¯ä¸Šé¢çš„ä¸²å£åŠŸèƒ½ï¼Œè¿˜å¹¶ä¸èƒ½å¸å¼•æˆ‘ï¼Œæ›´é‡è¦çš„æ˜¯è¿™ä¸ªsshåŠŸèƒ½ï¼ŒsshåŠŸèƒ½å› ä¸ºè¦é…ç½®IPå’Œå¯†ç ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ç‚¹å‡»ï¼Œéœ€è¦ä»é…ç½®å’Œè¿æ¥ä¸­ï¼Œç‚¹å‡»sshå³ä¾§å°ç®­å¤´ä¸­çš„å…‹éš†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101640012.png" alt="image-20231210163959998"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101640130.png" alt="image-20231210164012101"></p>
<p>â€‹	ç„¶åä»¥æ­¤è¾“å…¥åç§°ï¼Œè¿æ¥çš„ä¸»æœºipå³å¯ï¼Œæˆ‘è¿™é‡Œè¿æ¥çš„æ˜¯ipä¸º192.168.1.84çš„ubuntu20ï¼Œæˆ‘ä»¬ä¸€èˆ¬æƒ…å†µä¸‹åŠ è½½æ™®é€šç”¨æˆ·ï¼Œå°±ä¸è¦ä½¿ç”¨rootç”¨æˆ·äº†ï¼Œè®¾ç½®å®Œæˆå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101642173.png" alt="image-20231210164206146"></p>
<p>â€‹	è€Œsshçš„è‰²å½©æˆ‘æ›´å–œæ¬¢è¿™ä¸ªåå«Argonautçš„ï¼Œçœ‹ç€è¿˜æŒºå¥½çš„ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101653467.png" alt="image-20231210165346454">	</p>
<p>â€‹	ç„¶åç‚¹å‡»ä¿å­˜ï¼Œå¯ä»¥å‘ç°åˆšåˆšé…ç½®çš„sshå·²ç»åœ¨æœªå‘½åçš„ç»„å†…äº†ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101642152.png" alt="image-20231210164253114"></p>
<p>â€‹	ç„¶åç‚¹å‡»ç®­å¤´è¿›è¡Œè¿æ¥å³å¯ï¼Œè¿æ¥æˆåŠŸå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101646500.png" alt="image-20231210164609480"></p>
<h1 id="6-å­—ä½“è®¾ç½®"><a href="#6-å­—ä½“è®¾ç½®" class="headerlink" title="6.å­—ä½“è®¾ç½®"></a>6.å­—ä½“è®¾ç½®</h1><p>â€‹	ç°åœ¨çš„å­—ä½“ç‰¹åˆ«å°ï¼Œè€Œä¸”é¢œè‰²ä¹Ÿå¹¶ä¸æ˜¯å¾ˆå¥½çœ‹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ä¸­çš„å¤–è§‚è¿›è¡Œä¿®æ”¹ï¼Œè¿›å…¥ä¹‹åå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101648741.png" alt="image-20231210164841697"></p>
<p>è¿™é‡Œçš„å­—ä½“æˆ‘å–œæ¬¢è®¾ç½®ä¸ºCascadia Code SemiBoldï¼Œè€Œå­—ä½“å¤§å°è®¾ç½®ä¸º20å³å¯</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101656358.png" alt="image-20231210165607329"></p>
<p>â€‹	æœ€åçš„æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101656926.png" alt="image-20231210165653910"></p>
<p>â€‹	å¯¹æ¯”åº¦é²œè‰³ï¼Œè®©äººçœ‹ç€å°±èµå¿ƒæ‚¦ç›®ï¼Œå·¥ä½œæ›´åŠ æœ‰åŠ¨åŠ›ï¼Œå“ˆå“ˆã€‚</p>
<h1 id="7-å¥½ç”¨çš„æ’ä»¶"><a href="#7-å¥½ç”¨çš„æ’ä»¶" class="headerlink" title="7.å¥½ç”¨çš„æ’ä»¶"></a>7.å¥½ç”¨çš„æ’ä»¶</h1><h2 id="7-1-background"><a href="#7-1-background" class="headerlink" title="7.1 background"></a>7.1 background</h2><p>â€‹	é‡ç‚¹æ¥äº†ï¼Œè¿™ä¸ªæ˜¯æˆ‘æœ€æœ€æœ€æœ€æ¨èçš„ä¸€ä¸ªæ’ä»¶äº†ï¼Œå½“ä½ çš„ç»ˆç«¯èƒŒåæ˜¯ä¸€ä¸ªå°å§å§çš„æ—¶å€™ï¼Œä½ æ˜¯ä¸æ˜¯æƒ³è¦å¤šçœ‹ä¼šå„¿ï¼Œè¿™æ ·ä½ è¿æ‘¸é±¼çš„æ—¶é—´éƒ½ä¼šå°‘å¾ˆå¤šï¼Œè€Œä¸”è¿˜èƒ½é€‚å½“çš„æ”¾æ¾ä¸€ä¸‹ï¼Œæå¤§çš„æé«˜åˆ°äº†å·¥ä½œæ•ˆç‡ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101659617.png" alt="image-20231210165947584"></p>
<p>â€‹	è·å–ä¹‹åéœ€è¦é‡å¯è½¯ä»¶ï¼Œåœ¨èœå•ä¸­ä¼šå¤šå‡ºä¸€ä¸ªèƒŒæ™¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101700953.png" alt="image-20231210170052921"></p>
<p>â€‹	é¦–å…ˆå¯ç”¨èƒŒæ™¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101701772.png" alt="image-20231210170120756"></p>
<p>â€‹	ç„¶åé€‰æ‹©ä¸€ä¸ªä½ å–œæ¬¢çš„å›¾ç‰‡ï¼Œæˆ‘è¿™é‡Œå½“ç„¶æ˜¯ç¥é‡Œå‡Œåäº†&#x3D;&#x3D;æˆ‘æ˜¯ç¥é‡Œå‡Œåçš„ç‹—&#x3D;&#x3D;ï¼Œä¿®æ”¹å®Œä¹‹åæ˜¯è¿™ä¸ªæ ·å­</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101702859.png" alt="image-20231210170251409"></p>
<p>â€‹	ä½†è¿™ä¹Ÿå¤ªæ‹›æ‘‡äº†ï¼Œè¿™æ—¶å€™ä¸‹é¢çš„é€‰é¡¹å°±æœ‰ç”¨äº†ï¼Œå°†èƒŒæ™¯ä¸é€æ˜åº¦è®¾ç½®ä¸º6æˆ–è€…7è¿™ä¸ªæ ·å­ï¼Œæˆ‘æµ‹è¯•æœ€ä¸ºåˆé€‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101704726.png" alt="image-20231210170443701"></p>
<p>â€‹	æœ€åçš„æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101705347.png" alt="image-20231210170508231"></p>
<p>â€‹	&#x3D;&#x3D;å˜¿å˜¿æ˜¯ä¸æ˜¯æ„Ÿè§‰è¿˜ä¸é”™&#x3D;&#x3D;</p>
<p>æˆ‘å‘ç°æ¯æ¬¡é‡æ–°å¯åŠ¨tabbyçš„æ—¶å€™éƒ½ä¼šè‡ªåŠ¨æ‰“å¼€ä¸€ä¸ª windowsçš„tabbyï¼Œæˆ‘æ„Ÿè§‰å¥½çƒ¦ï¼Œå¯ä»¥åœ¨èœå•æ ä¸­æ‰¾åˆ°ç»ˆç«¯å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101709443.png" alt="image-20231210170926400"></p>
<p>ç„¶åå–æ¶ˆä¸‹é¢çš„è¿™ä¸ªå³å¯</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101709459.png" alt="image-20231210170905398"></p>
<h2 id="7-2-trzsz"><a href="#7-2-trzsz" class="headerlink" title="7.2.trzsz"></a>7.2.trzsz</h2><p>â€‹	é»˜è®¤æƒ…å†µä¸‹å¯ä»¥é€šè¿‡è¿™é‡Œå³ä¸Šè§’çš„sftpè¿›è¡Œæ–‡ä»¶çš„ä¼ è¾“ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œåªèƒ½ä¸Šä¼ æ–‡ä»¶ï¼Œä½†æ˜¯ä¸èƒ½ä¸Šä¼ æ–‡ä»¶å¤¹ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101712233.png" alt="image-20231210171255099"></p>
<p>â€‹	è€Œtrzszæ’ä»¶å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101713340.png" alt="image-20231210171347327"></p>
<p>å®‰è£…ä¹‹åé‡å¯tabbyï¼Œæµ‹è¯•å‘ç°ä»æ—§ä¸è¡Œï¼Œä½†æˆ‘çœ‹githubæœ‰äººè¯´è¿™ä¸ªé—®é¢˜å‘€ï¼Œå°±å¾ˆå¥‡æ€ªï¼Œç®—äº†ä¼ è¾“æ–‡ä»¶ä¸è¡Œè¿˜èƒ½æ¥å—ï¼Œå°±å…ˆè¿™æ ·å§ã€‚</p>
<h2 id="7-3-highlight"><a href="#7-3-highlight" class="headerlink" title="7.3 highlight"></a>7.3 highlight</h2><p>ä»åå­—å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªé«˜äº®çš„æ’ä»¶ï¼Œæœ‰æ—¶å€™çš„ä¸€äº›é”™è¯¯ä¿¡æ¯æ˜¯éœ€è¦æŸ¥çœ‹çš„ï¼Œæˆ–è€…è°ƒè¯•çš„æ—¶å€™éœ€è¦æ•è·åˆ°ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œæ‰€ä»¥è¿™ä¸ªé«˜äº®æ’ä»¶è¿˜æ˜¯å¾ˆé‡è¦çš„ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101719770.png" alt="image-20231210171941753"></p>
<p>å®‰è£…å®Œæˆé‡å¯ï¼Œå¯ä»¥çœ‹åˆ°å¤šå‡ºæ¥äº†ä¸€ä¸ªé«˜äº®çš„å›¾æ ‡å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101720547.png" alt="image-20231210172013491"></p>
<p>ç„¶åç‚¹å‡»å¯åŠ¨å³å¯ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101720063.png" alt="image-20231210172048815"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101720552.png" alt="image-20231210172058507"></p>
<p>â€‹	é»˜è®¤å·²ç»ç»™ä½ å†™å¥½äº†ä¸€äº›å…³é”®å­—ï¼Œè‡ªå·±ä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œæ·»åŠ ã€‚</p>
<h2 id="7-4-save-output"><a href="#7-4-save-output" class="headerlink" title="7.4 save-output"></a>7.4 save-output</h2><p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101723396.png" alt="image-20231210172326381"></p>
<p>â€‹	æœ‰æ—¶å€™éœ€è¦ä¿å­˜ç»ˆç«¯çš„è¾“å‡ºï¼Œé»˜è®¤æƒ…å†µä¸‹è¯¥ç»ˆç«¯è½¯ä»¶æ˜¯æ²¡æœ‰ä¿å­˜çš„åŠŸèƒ½çš„ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…ä¸€ä¸ªåä¸ºsave-outputçš„æ’ä»¶ã€‚</p>
<p>â€‹	å®‰è£…å®Œæˆä¹‹åä¼šåœ¨èœå•æ ä¸­å¤šå‡ºæ¥ä¸€ä¸ªåä¸ºsave-outputçš„æŒ‰é’®å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101726132.png" alt="image-20231210172632938"></p>
<p>â€‹	è®¾ç½®ä¸ºonä¹‹åè®¾ç½®è¦å­˜å‚¨çš„è·¯å¾„å³å¯ã€‚ç„¶åéšæ„æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ã€‚æŒ‰å³é”®ä¹‹åå¯ä»¥å‘ç°ä¼šæœ‰ä¸€ä¸ªsave-output to fileçš„é€‰é¡¹</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101727627.png" alt="image-20231210172727612"></p>
<p>ç‚¹å‡»ä¿å­˜å³å¯</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101728088.png" alt="image-20231210172814048"></p>
<p>åœ¨å¯¹åº”çš„æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°æ‰“å°ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101728121.png" alt="image-20231210172857106"></p>
<p>â€‹	åˆ°è¿™é‡Œï¼Œå…³äºtabbyçš„ç®€å•è®¾ç½®å’Œä½¿ç”¨å°±ä»‹ç»å®Œæˆäº†ï¼Œä¸‹é¢è¯´ä¸€ä¸‹æ„Ÿå—å§ï¼Œæˆ‘ä¹‹å‰å…¶å®å¹¶ä¸æ˜¯å¾ˆå–œæ¬¢è¿™äº›åä¸½èŠ±å“¨çš„ä¸œè¥¿ï¼Œæ„Ÿè§‰ç®€ç®€å•å•èƒ½ç”¨å°±å¥½äº†ï¼Œä½†éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå‘ç°æœ‰äº›ä¸œè¥¿å¹¶ä¸æ˜¯ä½ æƒ³çš„é‚£æ ·çš„ï¼Œä¸€ä¸ªå¥½ç”¨çš„å·¥å…·ç¡®å®èƒ½ç»™äººå¸¦æ¥ä¸ä¸€æ ·çš„ä½“éªŒï¼Œæœ€åç¥çœ‹åˆ°è¿™é‡Œçš„å°ä¼™ä¼´ï¼Œäº‹äº‹é¡ºå¿ƒã€‚</p>
<p>â€‹	ä¸ºäº†æ–¹ä¾¿æˆ‘çš„åç»­ä½¿ç”¨ï¼Œæˆ‘å°†ç›¸åº”çš„é…ç½®è¿›è¡Œäº†æ‰“åŒ…ï¼Œä»¥åå¦‚æœæ¢ç”µè„‘äº†åªéœ€è¦å°†ä¸‹é¢ç½‘ç›˜çš„èµ„æ–™æ”¾åˆ°C:\Users\Administrator\AppData\Roamingç›®å½•ä¸‹è§£å‹å³å¯ã€‚</p>
<p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1EBBtEmSY9SCBeIlB5YVoWQ">https://pan.baidu.com/s/1EBBtEmSY9SCBeIlB5YVoWQ</a><br>æå–ç ï¼šbs5v<br>â€“æ¥è‡ªç™¾åº¦ç½‘ç›˜è¶…çº§ä¼šå‘˜V6çš„åˆ†äº«</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
  </entry>
  <entry>
    <title>gitçš„å­¦ä¹ </title>
    <url>/2023/12/10/22%20git%E7%9A%84%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>â€‹	å‰ææ¡ä»¶ï¼Œå…ˆæ¥è¯´ä¸€ä¸‹æœªä»€ä¹ˆè¦å­¦ä¹ gitå§ï¼Œç›®å‰å…ˆä¸è€ƒè™‘è¿œç¨‹gitå’Œgithubï¼Œæˆ‘ç›®å‰åªæ˜¯æƒ³è¦åœ¨Linuxç¯å¢ƒä¸‹è¿›è¡Œgitçš„ä½¿ç”¨ï¼Œè¯´ä¸€ä¸ªæœ€ç®€å•çš„ç›®çš„ï¼Œæˆ‘æƒ³è®©æˆ‘çš„Linuxç›®å½•ç”¨åˆ°ä»€ä¹ˆå°±æ˜¾ç¤ºä»€ä¹ˆï¼Œè€Œä¸”å…¶ä»–çš„æ–‡ä»¶ä¹Ÿä¼šè¿›è¡Œå­˜æ¡£ï¼Œå½“æˆ‘éœ€è¦è¿™ä¸ªé¡¹ç›®çš„æ—¶å€™å°±åˆ‡æ¢åˆ°è¿™ä¸ªåˆ†æ”¯è¿›è¡Œå¼€å‘ï¼Œè€Œä¸æ˜¯åƒæˆ‘ç°åœ¨è¿™ä¸ªæ ·å­ï¼Œè¿˜è¦ä¿å­˜ï¼Œåˆ é™¤ç­‰ç­‰ï¼Œè¿™æ ·æˆ‘ä¹Ÿèƒ½çŸ¥é“æˆ‘éƒ½åšäº†å“ªäº›çš„ä¿®æ”¹ï¼Œç›®å‰çš„éœ€æ±‚å°±è¿™æ ·ï¼Œå­¦ä¹ å»ã€‚</p>
<h1 id="1-gitçš„å®‰è£…"><a href="#1-gitçš„å®‰è£…" class="headerlink" title="1.gitçš„å®‰è£…"></a>1.gitçš„å®‰è£…</h1><p>â€‹	å…³äºgitçš„ä»‹ç»å°±ä¸å†å¤šè¯´äº†ï¼Œlinusçš„ä¸°åŠŸä¼Ÿç»©ï¼Œä¸€ç›´æ˜¯æˆ‘çš„æŒ‡è·¯æ˜ç¯ï¼Œä¹Ÿæ˜¯æˆ‘ä¸ºä¹‹ä¸æ–­åŠªåŠ›çš„æ–¹å‘ï¼Œ è¿‡å¤šçš„å°±ä¸å†å¤šè¯´ã€‚</p>
<p>å®‰è£…éœ€è¦çš„æ’ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install libcurl4-gnutls-dev libexpat1-dev gettext libz-dev libssl-dev git</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101036140.png" alt="image-20231210103658547"></p>
<p>å®‰è£…å®Œæˆä¹‹åæŸ¥çœ‹gitçš„ç‰ˆæœ¬ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git --version</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101038851.png" alt="image-20231210103828814"></p>
<h1 id="2-gitçš„é…ç½®"><a href="#2-gitçš„é…ç½®" class="headerlink" title="2. gitçš„é…ç½®"></a>2. gitçš„é…ç½®</h1><p>é…ç½®ä¸ªäººçš„ç”¨æˆ·åå’Œç”µå­é‚®ç®±</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --global user.name &quot;chai&quot;</span><br><span class="line">git config --global user.email &quot;1361382269@qq.com&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101040420.png" alt="image-20231210104002380"></p>
<p>æŸ¥çœ‹é…ç½®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --list --global</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101040757.png" alt="image-20231210104018710"></p>
<p>é…ç½®ä¹Ÿå¯ä»¥åœ¨ ~&#x2F;.gitconfig æˆ– &#x2F;etc&#x2F;gitconfig çœ‹åˆ°è¿™é‡ŒåŠ ä¸Š â€“global æ˜¯å…¨å±€çš„é…ç½®ï¼Œ å¦‚æœæƒ³è¦åœ¨æŸä¸ªç‰¹å®šçš„é…ç½®ä¸­ä½¿ç”¨å•ç‹¬çš„é…ç½®å°±å°†â€“globalå»æ‰</p>
<p>è®¾ç½®é¢œè‰²å·®å¼‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --global color.ui true</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®gitå‘½ä»¤è¡¥å…¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://github.com/markgandolfo/git-bash-completion/blob/master/git-completion.bash</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101105829.png" alt="image-20231210110546532"></p>
<p>â€‹	ç„¶åå°†</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mv git-completion.bash /usr/bin/</span><br><span class="line">sudo echo source /usr/bin/git-completion.bash &gt;&gt; /home/topeet/.bashrc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rootçš„é…ç½®æ–‡ä»¶éœ€è¦æƒé™ï¼Œsudoä¸é¡¶ç”¨ï¼Œæ‰€ä»¥è¦æ¢åˆ°rootç”¨æˆ·</span></span><br><span class="line">sudo echo source /usr/bin/git-completion.bash &gt;&gt; /root/.bashrc</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101110920.png" alt="image-20231210111049872"></p>
<p>ç°åœ¨gitå°±å¯ä»¥æ­£å¸¸çš„è¿›è¡Œå‘½ä»¤çš„æç¤ºäº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101111447.png" alt="image-20231210111136282"></p>
<p>&#x3D;&#x3D;é»˜è®¤æƒ…å†µä¸‹sshè¿æ¥æ˜¯ä¸èƒ½ç¿»å¢™çš„ï¼ŒåŸå› æ˜¯ä¸€äº›ç¯å¢ƒå˜é‡çš„é—®é¢˜ï¼Œæ‰€ä»¥å°±éœ€è¦æ‰‹åŠ¨å¯¼å…¥ä¸€ä¸‹ä¸‹é¢çš„ä¸Šç½‘çš„ç¯å¢ƒå˜é‡&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export ftp_proxy=http://127.0.0.1:8889/</span><br><span class="line">export https_proxy=http://127.0.0.1:8889/</span><br><span class="line">export FTP_PROXY=http://127.0.0.1:8889/</span><br><span class="line">export HTTPS_PROXY=http://127.0.0.1:8889/</span><br><span class="line">export HTTP_PROXY=http://127.0.0.1:8889/</span><br><span class="line">export http_proxy=http://127.0.0.1:8889/</span><br></pre></td></tr></table></figure>

<p>ç›®å‰è¿˜ä¸æƒ³ç”¨ç äº‘å’Œgithubæ‰€ä»¥è¿™é‡Œçš„sshé…ç½®å°±å…ˆä¸é…ç½®</p>
<h1 id="3-git-åŸºç¡€ç†è®º"><a href="#3-git-åŸºç¡€ç†è®º" class="headerlink" title="3.git åŸºç¡€ç†è®º"></a>3.git åŸºç¡€ç†è®º</h1><p>â€‹	æˆ‘å…¶å®æ—©å°±å­¦ä¹ è¿‡äº†ä¸€égitäº†ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰ç”¨èµ·æ¥ï¼Œå…³äºç†è®ºè¿™é‡Œä¹Ÿç®—æ˜¯å­¦ä¹ è¿‡äº†ï¼Œè€Œgitçš„æ ¸å¿ƒå‘½ä»¤ä¹Ÿå°±åœ¨è¿™ä¸ªåœ°æ–¹ã€‚æˆ‘è¿™é‡Œå°±ä¸å¤åˆ¶äº†ï¼Œå‡­å€Ÿæˆ‘çš„è®°å¿†å¤è¿°ä¸€ä¸‹ã€‚</p>
<p>â€‹	gitæœ‰ä¸‰ä¸ªå·¥ä½œåŒºåŸŸï¼Œåˆ†åˆ«ä¸ºå·¥ä½œç›®å½•ï¼ˆworking directoryï¼‰ã€æš‚å­˜åŒºï¼ˆstage&#x2F;indexï¼‰å’Œèµ„æºåº“ï¼ˆrepositoryï¼‰ï¼Œè€ŒåŸåˆ›gitä»“åº“è¿™é‡Œå…ˆä¸ç®¡ï¼Œä»¥åå†è¯´ï¼Œå¤§æ¦‚æ˜¯é•¿è¿™ä¸ªæ ·å­ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101117006.png" alt="image-20231210111712990"></p>
<p>åŠ ä¸Šå„ç§å‘½ä»¤çš„åˆ‡æ¢ï¼Œé•¿è¿™ä¸ªæ ·å­ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101117699.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>Workspace:å·¥ä½œåŒºï¼Œå°±æ˜¯å¹³æ—¶å­˜æ”¾é¡¹ç›®ä»£ç çš„åœ°æ–¹</p>
<p>Index&#x2F;Stage:æš‚å­˜åŒºï¼Œç”¨äºä¸´æ—¶å­˜æ”¾ä½ çš„æ”¹åŠ¨ï¼Œäº‹å®ä¸Šå®ƒæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä¿å­˜å³å°†æäº¤çš„åˆ—è¡¨ä¿¡æ¯</p>
<p>local Repository:ä»“åº“åŒºï¼ˆæˆ–æœ¬åœ°ä»“åº“ï¼‰ï¼Œå°±æ˜¯å®‰å…¨å­˜æ”¾æ•°æ®çš„ä½ç½®ï¼Œè¿™é‡Œæœ‰ä½ æäº¤åˆ°æ‰€æœ‰ç‰ˆæœ¬çš„æ•°æ®ï¼Œå…¶ä¸­HEADæŒ‡å‘æœ€æ–°æ”¾å…¥ä»“åº“çš„ç‰ˆæœ¬</p>
<p>Remote Repository:è¿œç¨‹ä»“åº“ï¼Œæ‰˜ç®¡ä»£ç çš„æœåŠ¡å™¨ï¼Œå¯ä»¥ç®€å•çš„è®¤ä¸ºæ˜¯ä½ é¡¹ç›®ç»„ä¸­çš„ä¸€å°ç”µè„‘ç”¨äºè¿œç¨‹æ•°æ®äº¤æ¢</p>
<h1 id="4-gitå·¥ä½œæµç¨‹"><a href="#4-gitå·¥ä½œæµç¨‹" class="headerlink" title="4.gitå·¥ä½œæµç¨‹"></a>4.gitå·¥ä½œæµç¨‹</h1><p>gitçš„å·¥ä½œæµç¨‹ä¸€èˆ¬æ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li><p>åœ¨å·¥ä½œä¸­æ·»åŠ ï¼Œä¿®æ”¹æ–‡ä»¶</p>
</li>
<li><p>å°†éœ€è¦è¿›è¡Œçš„ç‰ˆæœ¬ç®¡ç†çš„æ–‡ä»¶æ”¾å…¥æš‚å­˜åŒºåŸŸ</p>
</li>
<li><p>å°†æš‚å­˜åŒºåŸŸæ–‡ä»¶æäº¤åˆ°gitä»“åº“</p>
<p>å› æ­¤ï¼Œgitç®¡ç†çš„æ–‡ä»¶æœ‰ä¸‰ç§çŠ¶æ€ï¼šå·²ä¿®æ”¹ï¼ˆmodifiedï¼‰,å·²æš‚å­˜ï¼ˆstagedï¼‰,å·²æäº¤ï¼ˆcommittedï¼‰</p>
</li>
</ol>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101131377.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="5-Gité¡¹ç›®æ­å»º"><a href="#5-Gité¡¹ç›®æ­å»º" class="headerlink" title="5.Gité¡¹ç›®æ­å»º"></a>5.Gité¡¹ç›®æ­å»º</h1><p>å·¥ä½œç›®å½•ï¼ˆWorkSpaceï¼‰ä¸€èˆ¬å°±æ˜¯ä½ å¸Œæœ›Gitå¸®åŠ©ä½ ç®¡ç†çš„æ–‡ä»¶å¤¹ï¼Œå¯ä»¥æ˜¯ä½ çš„é¡¹ç›®ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç©ºç›®å½•ï¼Œå»ºè®®ä¸è¦æœ‰ä¸­æ–‡ã€‚</p>
<p>æ—¥å¸¸ä½¿ç”¨åªéœ€è¦è®°ä½ä¸‹å›¾6ä¸ªå‘½ä»¤ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101137263.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>å»ºç«‹ä¸€ä¸ªgitä»“åº“</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101139420.png" alt="image-20231210113938373"></p>
<p>æ‰§è¡Œä¸‡å‘½ä»¤åå¯ä»¥çœ‹åˆ°ï¼Œä»…ä»…åœ¨é¡¹ç›®ç›®å½•å¤šå‡ºäº†ä¸€ä¸ª.gitç›®å½•ï¼ˆæ³¨æ„è¿™ä¸ªé»˜è®¤æ˜¯éšè—çš„æ–‡ä»¶å¤¹ï¼Œéœ€è¦æ‰‹åŠ¨åœ¨æŸ¥çœ‹é€‰é¡¹é‡Œé¢å»æ‰éšè—çš„æ–‡ä»¶æ‰èƒ½æ˜¾ç¤ºï¼‰ï¼Œå…³äºç‰ˆæœ¬ç­‰æ‰€æœ‰ä¿¡æ¯éƒ½åœ¨è¿™ä¸ªç›®å½•é‡Œé¢</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101140306.png" alt="image-20231210114003052"></p>
<p>gitæ–‡ä»¶æ“ä½œ</p>
<p>ç‰ˆæœ¬æ§åˆ¶å°±æ˜¯å¯¹æ–‡ä»¶çš„ç‰ˆæœ¬æ§åˆ¶ï¼Œè¦å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œæäº¤ç­‰æ“ä½œï¼Œé¦–å…ˆè¦çŸ¥é“æ–‡ä»¶å½“å‰ä»€ä¹ˆçŠ¶æ€ï¼Œä¸ç„¶å¯èƒ½ä¼šæäº¤äº†ç°åœ¨è¿˜ä¸æƒ³æäº¤çš„æ–‡ä»¶ï¼Œæˆ–è€…è¦æäº¤çš„æ–‡ä»¶æ²¡æäº¤ä¸Šã€‚</p>
<p>â€‹	(1):Untracked:æœªè·Ÿè¸ªï¼Œæ­¤æ–‡ä»¶åœ¨æ–‡ä»¶å¤¹ä¸­ï¼Œä½†å¹¶æ²¡æœ‰åŠ å…¥åˆ°gitä»“åº“ï¼Œä¸å‚ä¸ç‰ˆæœ¬æ§åˆ¶.é€šè¿‡git add çŠ¶æ€å˜ä¸ºStaged.</p>
<p>â€‹	(2):Unmodify:æ–‡ä»¶å·²ç»å…¥åº“ï¼Œæœªä¿®æ”¹ï¼Œå³ç‰ˆæœ¬åº“ä¸­çš„æ–‡ä»¶å¿«ç…§å†…å®¹ä¸æ–‡ä»¶å¤¹å®Œå…¨ä¸€è‡´.è¿™ç§ç±»å‹çš„æ–‡ä»¶æœ‰ä¸¤ç§å»å¤„ï¼Œå¦‚æœå®ƒè¢«ä¿®æ”¹ï¼Œè€Œå˜ä¸ºModified.å¦‚æœä½¿ç”¨git rm ç§»å‡ºç‰ˆæœ¬åº“ï¼Œåˆ™æˆä¸ºUntrackedæ–‡ä»¶.</p>
<p>â€‹	(3):Modified:æ–‡ä»¶å·²ä¿®æ”¹ï¼Œä»…ä»…æ˜¯ä¿®æ”¹ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œå…¶ä»–çš„æ“ä½œ.è¿™ä¸ªæ–‡ä»¶ä¹Ÿæœ‰ä¸¤ä¸ªå»å¤„ï¼Œé€šè¿‡git addå¯è¿›å…¥æš‚å­˜stagedçŠ¶æ€ï¼Œä½¿ç”¨git </p>
<p>checkoutï¼Œåˆ™ä¸¢å¼ƒä¿®æ”¹è¿‡ï¼Œè¿”å›unmodifyçŠ¶æ€ï¼Œè¿™ä¸ªgit checkoutå³ä»åº“ä¸­å–å‡ºæ–‡ä»¶ï¼Œè¦†ç›–å½“å‰ä¿®æ”¹ï¼</p>
<p>â€‹	(4):Stagedï¼šæš‚å­˜çŠ¶æ€ï¼Œæ‰§è¡Œgit commitåˆ™å°†ä¿®æ”¹åŒæ­¥åˆ°åº“ä¸­ï¼Œè¿™æ—¶åº“ä¸­çš„æ–‡ä»¶å’Œæœ¬åœ°æ–‡ä»¶åˆå˜ä¸ºä¸€è‡´ï¼Œæ–‡ä»¶ä¸ºUnmodifyçŠ¶æ€.æ‰§è¡Œgit </p>
<p>reset </p>
<p>æŸ¥çœ‹åˆ¶å®šæ–‡ä»¶çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git status [æ–‡ä»¶å]</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101145780.png" alt="image-20231210114548647"></p>
<p>æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101146553.png" alt="image-20231210114602428"></p>
<p>æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒº</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git add . </span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101147341.png" alt="image-20231210114733202"></p>
<p>â€‹	è¿™é‡Œä¹Ÿä»…ä»…åªæ˜¯å°†å·¥ä½œåŒºä¸Šä¼ åˆ°äº†æš‚å­˜åŒºï¼Œå¯ä»¥çœ‹åˆ°statuså·²ç»å˜ä¸ºäº†ç»¿è‰²ã€‚</p>
<p>æäº¤æš‚å­˜åŒºä¸­çš„å†…å®¹åˆ°æœ¬åœ°ä»“åº“ -m:æäº¤çš„ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git commit -m &quot;ä¿¡æ¯&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101148098.png" alt="image-20231210114849962"></p>
<p>å¯ä»¥çœ‹åˆ°git statusçš„çŠ¶æ€ä¹Ÿå·²ç»æ›´æ–°äº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101149264.png" alt="image-20231210114917210"></p>
<h1 id="6-å¿½ç•¥æ–‡ä»¶"><a href="#6-å¿½ç•¥æ–‡ä»¶" class="headerlink" title="6.å¿½ç•¥æ–‡ä»¶"></a>6.å¿½ç•¥æ–‡ä»¶</h1><p>æœ‰äº›æ—¶å€™æˆ‘ä»¬ä¸æƒ³æŠŠæŸäº›æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶ä¸­ï¼Œæ¯”å¦‚æ•°æ®åº“æ–‡ä»¶ï¼Œä¸´æ—¶æ–‡ä»¶ï¼Œè®¾è®¡æ–‡ä»¶ç­‰</p>
<p>åœ¨ä¸»ç›®å½•ä¸‹å»ºç«‹â€œ.gitignoreâ€æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶æœ‰å¦‚ä¸‹è§„åˆ™ï¼š</p>
<p>1.å¿½ç•¥æ–‡ä»¶ä¸­çš„ç©ºè¡Œæˆ–ä»¥äº•å·ï¼ˆ# ï¼‰å¼€å§‹çš„è¡Œå°†ä¼šè¢«å¿½ç•¥ã€‚</p>
<p>2.å¯ä»¥ä½¿ç”¨Linuxé€šé…ç¬¦ã€‚ä¾‹å¦‚âˆ¶æ˜Ÿå·(*)ä»£è¡¨ä»»æ„å¤šä¸ªå­—ç¬¦ï¼Œé—®å·(ï¹–)ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ï¼Œæ–¹æ‹¬å·([abc] )ä»£è¡¨å¯é€‰å­—ç¬¦èŒƒå›´ï¼Œå¤§æ‹¬å·( {string1,string2â€¦â€¦})ä»£è¡¨å¯é€‰çš„å­—ç¬¦ä¸²ç­‰ã€‚</p>
<p>3.å¦‚æœåç§°çš„æœ€å‰é¢æœ‰ä¸€ä¸ªæ„Ÿå¹å·( !)ï¼Œè¡¨ç¤ºä¾‹å¤–è§„åˆ™ï¼Œå°†ä¸è¢«å¿½ç•¥ã€‚</p>
<p>4.å¦‚æœåç§°çš„æœ€å‰é¢æ˜¯ä¸€ä¸ªè·¯å¾„åˆ†éš”ç¬¦(&#x2F; )ï¼Œè¡¨ç¤ºè¦å¿½ç•¥çš„æ–‡ä»¶åœ¨æ­¤ç›®å½•ä¸‹ï¼Œè€Œå­ç›®å½•ä¸­çš„æ–‡ä»¶ä¸å¿½ç•¥ã€‚</p>
<p>5.å¦‚æœåç§°çš„æœ€åé¢æ˜¯ä¸€ä¸ªè·¯å¾„åˆ†éš”ç¬¦(&#x2F; )ï¼Œè¡¨ç¤ºè¦å¿½ç•¥çš„æ˜¯æ­¤ç›®å½•ä¸‹è¯¥åç§°çš„å­ç›®å½•ï¼Œè€Œéæ–‡ä»¶ï¼ˆé»˜è®¤æ–‡ä»¶æˆ–ç›®å½•éƒ½å¿½ç•¥ï¼‰ã€‚</p>
<p>ä¾‹å¦‚ä»¥ä¸‹è¿™äº›å®ä¾‹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*.txt   #å¿½ç•¥æ‰€æœ‰çš„.txtç»“å°¾çš„æ–‡ä»¶</span><br><span class="line">ï¼lib.txt  #ä½†lib.txté™¤å¤–</span><br><span class="line">/temp  #è¿›å¿½ç•¥é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„TODOæ–‡ä»¶ï¼Œä¸åŒ…æ‹¬å…¶ä»–ç›®å½•temp</span><br><span class="line">bulid/  #å¿½ç•¥bulidç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</span><br><span class="line">doc/*.txt #ä¼šå¿½ç•¥doc/notes.txt ä½†æ˜¯ä¸åŒ…æ‹¬doc/sever/arch.txt</span><br></pre></td></tr></table></figure>

<h1 id="7-æŸ¥çœ‹æ—¥å¿—ä»¥åŠæ¢å¤ç‰ˆæœ¬"><a href="#7-æŸ¥çœ‹æ—¥å¿—ä»¥åŠæ¢å¤ç‰ˆæœ¬" class="headerlink" title="7.æŸ¥çœ‹æ—¥å¿—ä»¥åŠæ¢å¤ç‰ˆæœ¬"></a>7.æŸ¥çœ‹æ—¥å¿—ä»¥åŠæ¢å¤ç‰ˆæœ¬</h1><p>åœ¨ç¬¬5å°èŠ‚å·²ç»è¿›è¡Œäº†ç¬¬ä¸€æ¬¡çš„æäº¤ï¼Œç„¶åæˆ‘è¿›è¡Œç¬¬äºŒæ¬¡çš„æäº¤</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101153879.png" alt="image-20231210115334834"></p>
<p>ä¸Šé¢æ˜¯è¿›è¡Œçš„ä¿®æ”¹ï¼Œæ¥ä¸‹æ¥è¿›è¡Œæäº¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101154938.png" alt="image-20231210115438817"></p>
<p>ç„¶åè¿›è¡Œæäº¤çš„æŸ¥çœ‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git log</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101155808.png" alt="image-20231210115527651"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸¤ä¸ªæäº¤ï¼Œç°åœ¨æŒ‡å‘çš„æ˜¯ç¬¬äºŒæ¬¡æäº¤ï¼Œè€Œç›®å‰çš„æƒ…å†µæ˜¯è¿™æ ·çš„ï¼Œè¿™ä¸€æ¬¡çš„æäº¤æ˜¯é”™è¯¯çš„æˆ‘ä¸æƒ³è¦äº†ï¼Œæˆ‘æƒ³å›é€€åˆ°ç¬¬ä¸€æ¬¡çš„æäº¤ï¼Œå¯ä»¥ä½¿ç”¨git resetè¿›è¡Œå›å¤</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git reset [å“ˆå¸Œå€¼]</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101157577.png" alt="image-20231210115707464"></p>
<p>ç„¶åæŸ¥çœ‹æäº¤çš„çŠ¶æ€å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101158910.png" alt="image-20231210115820807"></p>
<p>ä½†æ˜¯ä»æ—§éœ€è¦æ‰‹åŠ¨åˆ é™¤æ‰è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101159755.png" alt="image-20231210115912689"></p>
<h1 id="8-åˆ†æ”¯æ“ä½œ"><a href="#8-åˆ†æ”¯æ“ä½œ" class="headerlink" title="8.åˆ†æ”¯æ“ä½œ"></a>8.åˆ†æ”¯æ“ä½œ</h1><p>åˆ†æ”¯æ˜¯Gitä½¿ç”¨è¿‡ç¨‹ä¸­éå¸¸é‡è¦çš„æ¦‚å¿µã€‚ä½¿ç”¨åˆ†æ”¯æ„å‘³ç€ä½ å¯ä»¥æŠŠä½ çš„å·¥ä½œä»å¼€å‘ä¸»çº¿ä¸Šåˆ†ç¦»å¼€æ¥ï¼Œä»¥å…å½±å“å¼€å‘ä¸»çº¿ã€‚åŒä¸€ä¸ªä»“åº“å¯ä»¥æœ‰å¤šä¸ªåˆ†æ”¯,å„ä¸ªåˆ†æ”¯ç›¸äº’ç‹¬ç«‹,äº’ä¸å¹²æ‰°ã€‚é€šè¿‡git initå‘½ä»¤åˆ›å»ºæœ¬åœ°ä»“åº“æ—¶é»˜è®¤ä¼šåˆ›å»º- -ä¸ªmasteråˆ†æ”¯ã€‚</p>
<p>â€‹	&#x3D;&#x3D;ä¹‹å‰è¿˜æ˜¯ä¸æ‡‚ï¼Œå¯¹äºåˆ†æ”¯æœ‰äº†ä¸ä¸€æ ·çš„æƒ³æ³•ï¼Œåˆ†æ”¯å¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„ï¼Œè€Œæ˜¯ä¸€ä¸ªå½“å‰å†…å®¹çš„åˆ†æ”¯&#x3D;&#x3D;</p>
<p>æŸ¥çœ‹åˆ†æ”¯ï¼š</p>
<p>ï¼ˆ1ï¼‰åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git branch</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101201065.png" alt="image-20231210120127025"></p>
<p>åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åˆ†æ”¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git branch -r</span><br></pre></td></tr></table></figure>

<p>åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git branch -a</span><br></pre></td></tr></table></figure>

<p>æˆ‘è¿™é‡Œå¹¶æ²¡æœ‰æ¶‰åŠåˆ°è¿œç¨‹åˆ†æ”¯ï¼Œæ‰€ä»¥ä¹Ÿå°±å…ˆä¸ç”¨ç®¡ã€‚</p>
<p>ï¼ˆ2ï¼‰åˆ›å»ºåˆ†æ”¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git branch name</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101205974.png" alt="image-20231210120516908"></p>
<p>ï¼ˆ3ï¼‰åˆ é™¤åˆ†æ”¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git branch -d name</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101205187.png" alt="image-20231210120535123"></p>
<p>ï¼ˆ4ï¼‰åˆ†æ”¯åˆ‡æ¢</p>
<p>é¦–å…ˆåœ¨ä¸»åˆ†æ”¯åˆ›å»ºäº†ä¸€ä¸ªmarkdownæµ‹è¯•æ–‡ä»¶ï¼Œå¹¶ä¸”æäº¤</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101210757.png" alt="image-20231210121055669"></p>
<p>ç„¶ååˆ›å»ºå¦ä¸€ä¸ªåˆ†æ”¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git branch test</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101212631.png" alt="image-20231210121207568"></p>
<p>åˆ‡æ¢åˆ°æ–°åˆ›å»ºçš„åˆ†æ”¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git checkout name</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå…³äºåˆ†æ”¯çš„è¿˜æ˜¯ä¸å¤ªæ‡‚ï¼Œè¿™é‡Œåº”è¯¥æ˜¯è¦çœ‹ä¸€çœ‹è§†é¢‘ã€‚ç°åœ¨æ‡‚äº†ï¼Œåˆ†æ”¯çš„åç§°æ‰çœŸæ­£çš„æ‡‚å¾—äº†ã€‚</p>
<p>ï¼ˆ5ï¼‰åˆ†æ”¯åˆå¹¶</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101501055.png" alt="image-20231210150127690"></p>
<p>å¯ä»¥çœ‹åˆ°ç›®å‰headé¢†å…ˆäº†masterä¸€ä¸ªæäº¤ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œåˆ†æ”¯åˆå¹¶ï¼Œå°†åˆ†æ”¯ä¸Šçš„ä¿®æ”¹è¿›è¡Œåˆå¹¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git merge test</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312101502556.png" alt="image-20231210150257210">					å¯ä»¥çœ‹åˆ°headå’Œmasterå·²ç»æ˜¯åŒä¸€ä¸ªåˆ†æ”¯äº†ã€‚</p>
<p>9.scpå‘½ä»¤çš„å­¦ä¹ </p>
<p><code>scp</code>ï¼ˆSecure Copyï¼‰å‘½ä»¤ç”¨äºåœ¨æœ¬åœ°ä¸»æœºå’Œè¿œç¨‹ä¸»æœºä¹‹é—´è¿›è¡Œæ–‡ä»¶ä¼ è¾“ã€‚å®ƒä½¿ç”¨SSHåè®®è¿›è¡Œå®‰å…¨çš„æ–‡ä»¶ä¼ è¾“ã€‚</p>
<p><code>scp</code>å‘½ä»¤çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scp [é€‰é¡¹] æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>æºæ–‡ä»¶</code>æ˜¯è¦ä¼ è¾“çš„æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ï¼Œ<code>ç›®æ ‡æ–‡ä»¶</code>æ˜¯ä¼ è¾“åˆ°çš„ç›®æ ‡ä½ç½®çš„è·¯å¾„ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„<code>scp</code>å‘½ä»¤é€‰é¡¹ï¼š</p>
<ul>
<li><code>-r</code>ï¼šé€’å½’å¤åˆ¶æ•´ä¸ªç›®å½•ã€‚</li>
<li><code>-P &lt;port&gt;</code>ï¼šæŒ‡å®šSSHç«¯å£å·ã€‚</li>
<li><code>-i &lt;identity_file&gt;</code>ï¼šæŒ‡å®šç”¨äºèº«ä»½éªŒè¯çš„ç§é’¥æ–‡ä»¶ã€‚</li>
<li><code>-v</code>ï¼šæ˜¾ç¤ºè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ã€‚</li>
<li><code>-C</code>ï¼šå¼€å¯å‹ç¼©ä¼ è¾“ã€‚</li>
</ul>
<p>ä¸‹é¢æ˜¯å‡ ä¸ªç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>scp</code>å‘½ä»¤ï¼š</p>
<ol>
<li><p>ä»æœ¬åœ°ä¸»æœºå¤åˆ¶æ–‡ä»¶åˆ°è¿œç¨‹ä¸»æœºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scp /path/to/local/file user@remote:/path/to/destination/</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä»è¿œç¨‹ä¸»æœºå¤åˆ¶æ–‡ä»¶åˆ°æœ¬åœ°ä¸»æœºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scp user@remote:/path/to/remote/file /path/to/destination/</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä»æœ¬åœ°ä¸»æœºå¤åˆ¶æ•´ä¸ªç›®å½•åˆ°è¿œç¨‹ä¸»æœºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scp -r /path/to/local/directory user@remote:/path/to/destination/</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä»è¿œç¨‹ä¸»æœºå¤åˆ¶æ•´ä¸ªç›®å½•åˆ°æœ¬åœ°ä¸»æœºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scp -r user@remote:/path/to/remote/directory /path/to/destination/</span><br></pre></td></tr></table></figure></li>
</ol>
<p>è¿™äº›ç¤ºä¾‹ä¸­çš„<code>user</code>æ˜¯è¿œç¨‹ä¸»æœºä¸Šçš„ç”¨æˆ·åï¼Œ<code>remote</code>æ˜¯è¿œç¨‹ä¸»æœºçš„åœ°å€ï¼ˆå¯ä»¥æ˜¯IPåœ°å€æˆ–åŸŸåï¼‰ï¼Œ<code>/path/to/</code>æ˜¯æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
  </entry>
  <entry>
    <title>opencvçš„å­¦ä¹ </title>
    <url>/2023/12/09/11-opencv%E7%9A%84%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&#x3D;&#x3D;å¤šå¥½çš„å‘¨æ—¥å‘€ï¼Œç©äº†ä¸€åŠæ€»è¦å­¦ä¹ ä¸€åŠï¼Œä½ è¯´å¯¹å§&#x3D;&#x3D;</p>
<p>RGAæ˜¯æˆ‘æ€»æƒ³è¦è¦å­¦ä¹ çš„ä¸€ä¸ªä¸œè¥¿ï¼Œåªæ˜¯ä¸€ç›´æ²¡æœ‰æœºä¼šï¼Œå¥½å§ï¼Œè¿˜æ˜¯æˆ‘è‡ªå·±çš„é—®é¢˜~</p>
<p>RGAæ˜¯ä¸€ä¸ªç¡¬ä»¶ï¼Œä»–æ˜¯ç”¨æ¥åŠ é€Ÿ2dçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºç”»çº¿ç­‰2dæ“ä½œæœ‰å¾ˆå¥½çš„åŠ é€Ÿä½œç”¨ï¼Œè€Œæˆ‘æ˜¯åœ¨å“ªäº›æ—¶å€™è§åˆ°çš„RGAçš„å‘¢ï¼Œæ˜¯åœ¨opencvé‡Œé¢ï¼Œå…·ä½“RKæ˜¯æ€æ ·ç”¨çš„å‘¢ï¼Œæˆ‘å¿˜è®°äº†ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆæ¥é‡æ–°å­¦ä¹ ä¸€ä¸‹opencvï¼Œä¹Ÿä¸ç”¨å¤šå­¦ï¼Œåªéœ€è¦å­¦ä¹ windowså’ŒLinuxé‡Œé¢opencvçš„é…ç½®å³å¯ã€‚</p>
<h1 id="1-windows-opencvçš„é…ç½®"><a href="#1-windows-opencvçš„é…ç½®" class="headerlink" title="1 windows opencvçš„é…ç½®"></a>1 windows opencvçš„é…ç½®</h1><p><a href="https://blog.csdn.net/qq_45022687/article/details/120241068?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170117660416800222888362%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=170117660416800222888362&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-120241068-null-null.142%5Ev96%5Epc_search_result_base2&utm_term=vscode%20opencv&spm=1018.2226.3001.4187">çœ‹æ ·å­æœ€å¥½çš„ä¸€ä¸ªé“¾æ¥</a><br>ä¸‹é¢æ˜¯æˆ‘æ ¹æ®æ•™ç¨‹æ¥æ„å»ºçš„æ­¥éª¤ã€‚</p>
<h2 id="1-1-è½¯ä»¶å‡†å¤‡"><a href="#1-1-è½¯ä»¶å‡†å¤‡" class="headerlink" title="1.1 è½¯ä»¶å‡†å¤‡"></a>1.1 è½¯ä»¶å‡†å¤‡</h2><p><a href="https://so.csdn.net/so/search?q=MinGw&spm=1001.2101.3001.7020">MinGw</a>ï¼šç‰ˆæœ¬ï¼š8.1.0-release-posix-seh-rt_v6-rev0</p>
<p>Cmakeï¼šç‰ˆæœ¬ï¼š3.20.2</p>
<p><a href="https://so.csdn.net/so/search?q=Opencv&spm=1001.2101.3001.7020">Opencv</a>ï¼šç‰ˆæœ¬ï¼š4.5.2</p>
<p>å…¶ä¸­Cmakeå’Œopencvæˆ‘å½“ç„¶çŸ¥é“æ˜¯ä»€ä¹ˆï¼Œcmakeæ˜¯ç”¨æ¥ç¼–è¯‘oepcnvçš„ï¼Œè€Œmingwæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>MinGWï¼ˆMinimalist GNU for Windowsï¼‰æ˜¯ä¸€ä¸ªç”¨äºåœ¨Windowsæ“ä½œç³»ç»Ÿä¸Šè¿›è¡Œå¼€å‘çš„å¼€æºè½¯ä»¶å¼€å‘å·¥å…·é›†åˆã€‚å®ƒæä¾›äº†ä¸€ç»„GNUå·¥å…·å’Œåº“ï¼ŒåŒ…æ‹¬GCCç¼–è¯‘å™¨ã€GNUè°ƒè¯•å™¨ï¼ˆGDBï¼‰ã€GNUæ„å»ºå·¥å…·ï¼ˆMakeï¼‰ç­‰ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨Windowsç¯å¢ƒä¸‹ç¼–è¯‘å’Œè¿è¡ŒCã€C++ç­‰ç¨‹åºã€‚</p>
<p>MinGWçš„ç›®æ ‡æ˜¯ä¸ºWindowsæä¾›ä¸€ä¸ªç®€æ´ã€è½»é‡çº§çš„å¼€å‘ç¯å¢ƒï¼Œä»¥ä¾¿å¼€å‘è€…èƒ½å¤Ÿåœ¨Windowsä¸Šè¿›è¡ŒåŸºäºGNUå·¥å…·çš„è½¯ä»¶å¼€å‘ï¼Œè€Œæ— éœ€ä¾èµ–äºMicrosoft Visual Studioç­‰å¤§å‹å¼€å‘å·¥å…·ã€‚</p>
<p>MinGWåŸºäºGNUå·¥å…·é“¾ï¼Œå› æ­¤å®ƒæ”¯æŒæ ‡å‡†çš„GNUç¼–ç¨‹å·¥å…·å’Œåº“ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿç¼–å†™å’Œæ„å»ºè·¨å¹³å°çš„åº”ç”¨ç¨‹åºã€‚é€šè¿‡MinGWï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨GCCç¼–è¯‘å™¨åœ¨Windowsä¸Šç¼–è¯‘å’Œæ„å»ºå‘½ä»¤è¡Œç¨‹åºã€åº“æ–‡ä»¶æˆ–è€…è·¨å¹³å°çš„åº”ç”¨ç¨‹åºã€‚</p>
<p>æ­¤å¤–ï¼ŒMinGWè¿˜æœ‰ä¸€ä¸ªå˜ç§ç‰ˆæœ¬å«åšMinGW-w64ï¼Œå®ƒæä¾›äº†å¯¹64ä½Windowsç³»ç»Ÿçš„æ”¯æŒï¼Œå¹¶ä¸”åœ¨ä¸€äº›æ–¹é¢è¿›è¡Œäº†æ”¹è¿›å’Œæ‰©å±•ã€‚</p>
<p>&#x3D;&#x3D;ä¸Šé¢æ˜¯äººå·¥æ™ºèƒ½å¾—åˆ°çš„ï¼Œæˆ‘ç›®å‰å°±ç®€å•çš„å°†å®ƒç†è§£ä¸ºåœ¨windowsä¸Šçš„ä¸€ä¸ªGCCå·¥å…·é“¾å§&#x3D;&#x3D;</p>
<h2 id="1-2-è½¯ä»¶çš„ä¸‹è½½"><a href="#1-2-è½¯ä»¶çš„ä¸‹è½½" class="headerlink" title="1.2 è½¯ä»¶çš„ä¸‹è½½"></a>1.2 è½¯ä»¶çš„ä¸‹è½½</h2><h3 id="1-2-1-MinGwä¸‹è½½"><a href="#1-2-1-MinGwä¸‹è½½" class="headerlink" title="1.2.1 MinGwä¸‹è½½"></a>1.2.1 MinGwä¸‹è½½</h3><p><a href="https://sourceforge.net/projects/mingw-w64/files/mingw-w64/">mingw</a></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282124974.png" alt="image-20231128212412942"></p>
<ul>
<li><code>x86_64</code>: è¡¨ç¤º64ä½x86æ¶æ„ã€‚</li>
<li><code>i686</code>: è¡¨ç¤º32ä½x86æ¶æ„ï¼ˆä¹Ÿç§°ä¸ºx86æˆ–IA-32ï¼‰ã€‚</li>
<li><code>posix</code>: è¡¨ç¤ºé‡‡ç”¨POSIXæ ‡å‡†çš„æ“ä½œç³»ç»Ÿæ¥å£ã€‚</li>
<li><code>win32</code>: è¡¨ç¤ºåŸºäºWindowsæ“ä½œç³»ç»Ÿçš„æ¥å£ã€‚</li>
</ul>
<p>å¯¹äºå¼‚å¸¸å¤„ç†ï¼ˆException Handlingï¼‰æ–¹å¼ï¼š</p>
<ul>
<li><code>sjlj</code>ï¼ˆSet Jump&#x2F;Long Jumpï¼‰ï¼šä½¿ç”¨åŸºäºsetjmp&#x2F;longjmpå‡½æ•°çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚</li>
<li><code>seh</code>ï¼ˆStructured Exception Handlingï¼‰ï¼šä½¿ç”¨Windowsç»“æ„åŒ–å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚</li>
</ul>
<p>å¯¹äºè°ƒè¯•ä¿¡æ¯ï¼ˆDebug Informationï¼‰æ–¹å¼ï¼š</p>
<ul>
<li><code>dwarf</code>ï¼šä½¿ç”¨DWARFè°ƒè¯•æ ¼å¼ã€‚</li>
<li><code>sjlj</code> å’Œ <code>seh</code> ä¸æ¶‰åŠè°ƒè¯•ä¿¡æ¯ã€‚</li>
</ul>
<p>è§£å‹è¯¥è½¯ä»¶åŒ…ä¹‹åå¾—åˆ°ming64çš„æ–‡ä»¶å¤¹ï¼Œæˆ‘å°†å®ƒæ”¾åˆ°äº†Dç›˜çš„æ ¹ç›®å½•</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282142004.png" alt="image-20231128214221986"></p>
<p>éšåå°†â€œ&#x3D;&#x3D;D:\mingw64\bin&#x3D;&#x3D;â€è¿™ä¸ªåœ°å€åŠ å…¥ç¯å¢ƒå˜é‡ï¼Œæ³¨ï¼šwin+q æœç´¢ç¯å¢ƒå˜é‡å¯ä»¥å¿«é€Ÿæ‰“å¼€ç¯å¢ƒé…ç½®ï¼Œå¯¹Pathè¿›è¡Œé…ç½®å³å¯ï¼Œä¹‹å‰è¿™é‡Œå¯¹æˆ‘è¿˜æŒºå›°éš¾çš„ï¼Œå¦‚æœç°åœ¨è¿˜ä¸æ‡‚ï¼Œé‚£å°±æ˜¯ä½ çš„é—®é¢˜äº†ã€‚æœ€åé€šè¿‡â€œ&#x3D;&#x3D;g++ -v&#x3D;&#x3D;â€æ¥è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯æˆåŠŸå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282153126.png" alt="image-20231128215324105"></p>
<h3 id="1-2-2-Cmakeä¸‹è½½"><a href="#1-2-2-Cmakeä¸‹è½½" class="headerlink" title="1.2.2 Cmakeä¸‹è½½"></a>1.2.2 Cmakeä¸‹è½½</h3><p><a href="https://cmake.org/files/">cmakeä¸‹è½½åœ°å€</a></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282133808.png" alt="image-20231128213309747"></p>
<p>è¿™é‡Œç›´æ¥é€‰ç”¨æœ€æ–°çš„ç‰ˆæœ¬<a href="https://cmake.org/files/v3.28/">3.28</a>ï¼ŒåŒç†è·Ÿä¸Šé¢çš„mingwä¸€æ ·ï¼Œä»¥åŒæ ·çš„æ–¹æ³•è®¾ç½®cmakeï¼Œè§£å‹ä¹‹åçš„åå­—ä¸ºcmake-3.28.0-rc5-windows-x86_64ï¼Œä¹Ÿæ”¾åˆ°Dç›˜ä¸‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282155794.png" alt="image-20231128215506778"></p>
<p>å…·ä½“è¦æ·»åŠ çš„è·¯å¾„ä¸ºD:\cmake-3.28.0-rc5-windows-x86_64\binï¼Œä¹Ÿè¦åŠ å…¥Pathï¼Œç„¶åæµ‹è¯•å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake --version</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282156434.png" alt="image-20231128215641421"></p>
<h3 id="1-2-3-Opencvä¸‹è½½"><a href="#1-2-3-Opencvä¸‹è½½" class="headerlink" title="1.2.3 Opencvä¸‹è½½"></a>1.2.3 Opencvä¸‹è½½</h3><p><a href="https://opencv.org/releases/">opencv</a></p>
<p>è¿™é‡Œä¹Ÿç›´æ¥ä¸‹windowsçš„æœ€æ–°ç‰ˆ4.8</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282139382.png" alt="image-20231128213946356"></p>
<p>opencvä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œopencvè™½ç„¶æ˜¯ä¸€ä¸ªexeæ–‡ä»¶ï¼Œå®é™…ä¹Ÿæ˜¯è§£åŒ…çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œè§£åŒ…å®Œæˆå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282158637.png" alt="image-20231128215855620"></p>
<h2 id="1-3-ç¼–è¯‘"><a href="#1-3-ç¼–è¯‘" class="headerlink" title="1.3 ç¼–è¯‘"></a>1.3 ç¼–è¯‘</h2><p>OpenCVæ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„è®¡ç®—æœºè§†è§‰åº“ï¼Œå®ƒæä¾›äº†å„ç§å›¾åƒå’Œè§†é¢‘å¤„ç†åŠŸèƒ½ï¼Œç”¨äºå¼€å‘è®¡ç®—æœºè§†è§‰åº”ç”¨ç¨‹åºã€‚åœ¨Windowsæ“ä½œç³»ç»Ÿä¸Šï¼ŒåŸç”Ÿæ”¯æŒVisual Studioï¼ˆVSï¼‰ä½œä¸ºå¼€å‘ç¯å¢ƒï¼Œå¯ä»¥ç›´æ¥åœ¨VSä¸­ä½¿ç”¨OpenCVã€‚</p>
<p>ç„¶è€Œï¼ŒVisual Studioè¿‡äºåºå¤§å’Œç¬¨é‡ï¼Œä¸å¤ªæ–¹ä¾¿ä½¿ç”¨ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒVisual Studio Codeï¼ˆVSCodeï¼‰æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ä»£ç ç¼–è¾‘å™¨ï¼Œå…·æœ‰è‰¯å¥½çš„å¯å®šåˆ¶æ€§å’Œæ‰©å±•æ€§ã€‚å› æ­¤ï¼Œä»–ä»¬é€‰æ‹©ä½¿ç”¨VSCodeä½œä¸ºå¼€å‘ç¯å¢ƒæ¥é…ç½®OpenCVã€‚</p>
<p>åœ¨ä½¿ç”¨VSCodeé…ç½®OpenCVæ—¶ï¼Œæœ‰ä¸€ä¸ªé‡è¦çš„å‰æï¼Œé‚£å°±æ˜¯æˆ‘ä»¬éœ€è¦å°†OpenCVçš„æºä»£ç è¿›è¡Œç¼–è¯‘ã€‚ç¼–è¯‘æ˜¯å°†æºä»£ç è½¬æ¢ä¸ºå¯æ‰§è¡Œç¨‹åºæˆ–åº“çš„è¿‡ç¨‹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨CMakeä½œä¸ºæ„å»ºå·¥å…·æ¥ç®¡ç†ç¼–è¯‘è¿‡ç¨‹ã€‚</p>
<h3 id="1-3-1ã€cmake-gui"><a href="#1-3-1ã€cmake-gui" class="headerlink" title="1.3.1ã€cmake-gui"></a>1.3.1ã€cmake-gui</h3><p>æ‰¾åˆ°cmakeæ–‡ä»¶å¤¹ä¸‹çš„biné‡Œçš„cmake-gui æ–‡ä»¶ï¼Œå¯åŠ¨ã€‚<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282204857.png" alt="image-20231128220416838"></p>
<p>Where is the source code: è¿™é‡Œä½¿ç”¨opencvç›®å½•ä¸‹çš„sourceç›®å½•</p>
<p>Where to build the binaries: è¿™é‡Œæ˜¯ç¼–è¯‘åçš„æ–‡ä»¶çš„æ”¾ç½®ç›®å½•</p>
<p>é…ç½®å®Œæˆå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282205939.png" alt="image-20231128220536920"></p>
<p>ç‚¹å‡»configureä¹‹åä¸€ç‚¹ä¸èƒ½é€‰é”™ï¼Œé€‰æ‹©å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282206498.png" alt="image-20231128220629482"></p>
<p>æ¥ä¸‹æ¥ç¼–è¯‘å™¨çš„é€‰æ‹©ï¼Œåˆ†åˆ«é€‰æ‹©gccå’Œg++ï¼Œé€‰æ‹©å®Œæˆå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282207767.png" alt="image-20231128220726753"></p>
<p>ç„¶åå¼€å§‹é…ç½®ï¼Œç­‰å¾…é…ç½®å®Œæˆï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282207571.png" alt="image-20231128220750554"></p>
<p>åœ¨æ‰§è¡Œå®Œåï¼ŒæŠŠå…³äºpythonçš„éƒ½ç»™å–æ¶ˆå‹¾é€‰ã€‚å‹¾é€‰BUILD_opencv_worldï¼ŒWITH_OPENGLå’ŒBUILD_EXAMPLESï¼Œä¸å‹¾é€‰WITH_IPPã€WITH_MSMFå’ŒENABLE_PRECOMPILED_HEADERSï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼ŒCPU_DISPATCHé€‰ç©ºï¼Œç„¶åç»§ç»­Generalã€‚</p>
<p>é…ç½®å®Œæˆå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282224674.png" alt="image-20231128222444655"></p>
<p>åˆ°è¿™é‡Œï¼Œè¯¥é…ç½®çš„ä¹Ÿéƒ½å®Œæˆäº†ï¼Œéœ€è¦å»ç”¨ç¼–è¯‘ç”Ÿæˆã€‚</p>
<h3 id="1-3-2-ç¼–è¯‘"><a href="#1-3-2-ç¼–è¯‘" class="headerlink" title="1.3.2 ç¼–è¯‘"></a>1.3.2 ç¼–è¯‘</h3><p>D:\opencv\build\x64\mingw<br>æ‰§è¡Œå‘½ä»¤: </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">minGW32-make -j 32</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282226079.png" alt="image-20231128222621959"></p>
<p>é—®é¢˜1ï¼š</p>
<p>å»æ‰WITH_DIRECTX,WITH_OPENCL_D3D11_NVé€‰é¡¹-ä»£è¡¨äº†windowsä¸‹directxçš„ä½¿ç”¨ä»¥åŠd3dåŠŸèƒ½ï¼Œç¼–è¯‘ä¼šå‡ºé”™ï¼Œåº”è¯¥æ˜¯éœ€è¦windowsç›¸å…³æ”¯æŒ</p>
<p>é—®é¢˜2ï¼š<br>å»æ‰ test java python</p>
<p>é—®é¢˜3ï¼š<br>å»æ‰OPENCV_GENERATE_SETUPVARS</p>
<p>è‡³æ­¤ï¼Œç¼–è¯‘æˆåŠŸï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311282242616.png" alt="image-20231128224242594"></p>
<h3 id="1-3-3-å®‰è£…"><a href="#1-3-3-å®‰è£…" class="headerlink" title="1.3.3 å®‰è£…"></a>1.3.3 å®‰è£…</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">minGW32-make install</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311290724934.png" alt="image-20231129072435906"></p>
<p>ç„¶åæˆ‘ä»¬ç»§ç»­æ·»åŠ ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼š<br>ç¬¬ä¸€ä¸ªpathæ˜¯ï¼šD:\opencv\build\x64\vc16\bin<br>ç¬¬äºŒä¸ªpathæ˜¯ï¼šD:\opencv\build\x64\mingw\bin</p>
<p>ç„¶åéšä¾¿æ‰“å¼€ä¸€ä¸ªshellç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æµ‹è¯•å³å¯ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311290727554.png" alt="image-20231129072736532"></p>
<h2 id="1-4-vscodeé…ç½®"><a href="#1-4-vscodeé…ç½®" class="headerlink" title="1.4 vscodeé…ç½®"></a>1.4 vscodeé…ç½®</h2><p>æœ€ç»ˆæ•ˆæœ</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311292053680.png" alt="image-20231129205332655"></p>
<p>launch.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;opencv debuge&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cppdbg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;\\Debugger\\$&#123;fileBasenameNoExtension&#125;.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">//ä¸Šé¢è¿™ä¸ªDebuggeræ˜¯æˆ‘è‡ªå·±å®šä¹‰çš„ï¼Œä¸ºäº†æ–¹ä¾¿æ”¾ç½®ç”Ÿæˆçš„exeæ–‡ä»¶</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;stopAtEntry&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span> <span class="comment">//è¿™é‡Œå¦‚æœä¸º falseï¼Œåˆ™è¯´æ˜è°ƒè¯•ç›´æ¥è¿è¡Œã€‚ï¼ˆåä¹‹åˆ™åœæ­¢ï¼‰</span></span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;environment&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;externalConsole&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="comment">//æ˜¯å¦è°ƒç”¨å¤–éƒ¨cmd</span></span><br><span class="line">            <span class="attr">&quot;MIMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;miDebuggerPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;D:\\mingw64\\bin\\gdb.exe&quot;</span><span class="punctuation">,</span><span class="comment">//è‡ªå·±è¿›è¡Œè®¾ç½®</span></span><br><span class="line">            <span class="attr">&quot;setupCommands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¸º gdb å¯ç”¨æ•´é½æ‰“å°&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-enable-pretty-printing&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ignoreFailures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;preLaunchTask&quot;</span><span class="punctuation">:</span> <span class="string">&quot;opencv3.5.2&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>c_cpp_properties.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;win&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;includePath&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;$&#123;workspaceFolder&#125;/**&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;D:/opencv/build/x64/mingw/install/include&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;D:/opencv/build/x64/mingw/install/include/opencv2&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;defines&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;compilerPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;D:/mingw64/bin/g++.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cStandard&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c11&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cppStandard&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c++17&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;intelliSenseMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;default&#125;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>tasks.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tasks&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shell&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;opencv3.5.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;D:/mingw64/bin/g++.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-g&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;$&#123;file&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-o&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;$&#123;workspaceFolder&#125;\\Debugger\\$&#123;fileBasenameNoExtension&#125;.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="comment">//ä¸Šé¢è¿™ä¸ªDebuggeræ˜¯æˆ‘è‡ªå·±å®šä¹‰çš„ï¼Œä¸ºäº†æ–¹ä¾¿æ”¾ç½®ç”Ÿæˆçš„exeæ–‡ä»¶</span></span><br><span class="line">                <span class="string">&quot;D:/opencv/build/x64/mingw/bin/libopencv_world480.dll&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-I&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;D:/opencv/build/x64/mingw/install/include&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-I&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;D:/opencv/build/x64/mingw/install/include/opencv2&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;D:/mingw64/bin&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;problemMatcher&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;$gcc&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;build&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;isDefault&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>æµ‹è¯•ä¾‹ç¨‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">VideoCapture <span class="title">cap</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    Mat img;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cap &gt;&gt; img;</span><br><span class="line">        <span class="keyword">if</span> (img.<span class="built_in">empty</span>())</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="built_in">namedWindow</span>(<span class="string">&quot;img&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">        <span class="built_in">imshow</span>(<span class="string">&quot;img&quot;</span>, img);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">27</span> == <span class="built_in">waitKey</span>(<span class="number">20</span>))</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="2-VS-opencvçš„é…ç½®"><a href="#2-VS-opencvçš„é…ç½®" class="headerlink" title="2 VS opencvçš„é…ç½®"></a>2 VS opencvçš„é…ç½®</h1><h2 id="2-1-å®‰è£…vs"><a href="#2-1-å®‰è£…vs" class="headerlink" title="2.1 å®‰è£…vs"></a>2.1 å®‰è£…vs</h2><p>â€‹	ä¸Šé¢æ˜¯VS codeé…ç½®opencväº‹å®ä¸Šï¼Œå¯ä»¥ç›´æ¥é€šè¿‡vsæ¥é…ç½®ï¼Œä¸Šé¢ä¹Ÿç®—æ˜¯èµ°äº†å¼¯è·¯äº†ã€‚</p>
<p><a href="https://visualstudio.microsoft.com/zh-hans/">VS å®˜ç½‘</a></p>
<p>â€‹	ç­‰å¾…å®‰è£…å®Œæˆï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311292102072.png" alt="image-20231129210245054"> </p>
<p>å®‰è£…ç¨‹åºä¸‹è½½å®‰è£…éªŒè¯å®Œæ¯•ï¼Œå°†ä¼šæç¤ºè¿›å…¥è¿™ä¸ªç•Œé¢</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311292106854.png" alt="image-20231129210632825"></p>
<p>é€‰æ‹©C++çš„æ¡Œé¢å¼€å‘å’ŒVisual Studio æ‰©å±•å¼€å‘ï¼Œç„¶åæ›´æ”¹å®‰è£…ä½ç½®ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311292108111.png" alt="image-20231129210813082"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311292108494.png" alt="image-20231129210828463"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311292107884.png" alt="image-20231129210742854"></p>
<h2 id="2-2-å®‰è£…opencv"><a href="#2-2-å®‰è£…opencv" class="headerlink" title="2.2 å®‰è£…opencv"></a>2.2 å®‰è£…opencv</h2><p>â€‹	åœ¨ç¬¬ä¸€å°èŠ‚å·²ç»è®²è§£è¿‡ï¼Œå°±ä¸å†è®²äº†</p>
<h2 id="2-3-é…ç½®VSCODE"><a href="#2-3-é…ç½®VSCODE" class="headerlink" title="2.3 é…ç½®VSCODE"></a>2.3 é…ç½®VSCODE</h2><p>â€‹	å…¶å®ä¹Ÿå°±é‚£å‡ æ­¥ï¼Œæ²¡å•¥å¥½å†™çš„ï¼Œæˆ‘ç•™ä¸ª<a href="https://blog.csdn.net/weixin_54583016/article/details/121424060?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170126271516800186526751%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=170126271516800186526751&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-121424060-null-null.142%5Ev96%5Epc_search_result_base2&utm_term=vs%20opencv&spm=1018.2226.3001.4187">é“¾æ¥</a>å§</p>
<p>æµ‹è¯•å®Œæˆå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311292150244.png" alt="image-20231129215026178"></p>
<p>â€‹	æ—¢ç„¶opencvä¸­å·²ç»åœ¨ubuntuæä¾›çš„åº“ä¸­äº†ï¼Œé‚£ä¸ºä»€ä¹ˆäººä»¬æ›´å¤šçš„è¿˜æ˜¯è‡ªå·±ç¼–è¯‘opencvå†ä½¿ç”¨å‘¢ï¼Œå°±æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116812.png" alt="image-20231017205544904"></p>
<p>æƒ³ç”¨ä¸€äº›åº“ï¼Œç„¶è€Œå‘ç°ubuntuè‡ªå¸¦çš„opencvæ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œè¿™æ—¶å€™å°±è¦è‡ªå·±ç¼–è¯‘opencväº†ã€‚</p>
<h1 id="3-oepncvæºç çš„ç¼–è¯‘ï¼ˆLinuxï¼‰"><a href="#3-oepncvæºç çš„ç¼–è¯‘ï¼ˆLinuxï¼‰" class="headerlink" title="3 oepncvæºç çš„ç¼–è¯‘ï¼ˆLinuxï¼‰"></a>3 oepncvæºç çš„ç¼–è¯‘ï¼ˆLinuxï¼‰</h1><h2 id="1-æ‹‰å–opencvæºç "><a href="#1-æ‹‰å–opencvæºç " class="headerlink" title="1.æ‹‰å–opencvæºç "></a>1.æ‹‰å–opencvæºç </h2><p>opencvåœ°å€ <strong><a href="https://opencv.org/releases/">https://opencv.org/releases/</a></strong></p>
<p><a href="https://github.com/opencv/opencv">https://github.com/opencv/opencv</a></p>
<p>opencv-contrib é“¾æ¥<a href="https://github.com/opencv/opencv_contrib">https://github.com/opencv/opencv_contrib</a></p>
<p>OpenCV (Open Source Computer Vision Library) æ˜¯ä¸€ä¸ªå¼€æºè®¡ç®—æœºè§†è§‰å’Œå›¾åƒå¤„ç†åº“ï¼Œæä¾›äº†ä¸€ç³»åˆ—ç”¨äºå¤„ç†å›¾åƒå’Œè§†é¢‘çš„å‡½æ•°å’Œå·¥å…·ã€‚OpenCV-contribï¼ˆOpenCV contributionsï¼‰æ˜¯å¯¹OpenCVçš„æ‰©å±•å’Œè¡¥å……ï¼ŒåŒ…å«äº†ä¸€äº›é¢å¤–çš„æ¨¡å—å’ŒåŠŸèƒ½ï¼Œä»¥å¢å¼ºOpenCVçš„åŠŸèƒ½å’Œåº”ç”¨èŒƒå›´ã€‚</p>
<p>OpenCV-contribæ¨¡å—æ˜¯ç”±OpenCVç¤¾åŒºçš„å¼€å‘äººå‘˜å’Œè´¡çŒ®è€…åˆ›å»ºå’Œç»´æŠ¤çš„ï¼Œå®ƒæä¾›äº†è®¸å¤šå®ç”¨çš„åŠŸèƒ½ã€ç®—æ³•å’Œå·¥å…·ï¼Œç”¨äºè®¡ç®—æœºè§†è§‰ã€å›¾åƒå¤„ç†ã€ç›®æ ‡æ£€æµ‹ã€æœºå™¨å­¦ä¹ ç­‰é¢†åŸŸçš„åº”ç”¨ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„OpenCV-contribæ¨¡å—åŠå…¶åŠŸèƒ½ï¼š</p>
<ol>
<li><strong>aruco</strong>ï¼šæä¾›äº†ç”¨äºæ£€æµ‹å’Œè·Ÿè¸ªArUcoæ ‡è®°çš„å‡½æ•°å’Œç±»ã€‚ArUcoæ ‡è®°æ˜¯ä¸€ç§ç”¨äºå¢å¼ºç°å®å’Œç›¸æœºå§¿æ€ä¼°è®¡çš„äºŒç»´æ¡ç ã€‚</li>
<li><strong>bgsegm</strong>ï¼šåŒ…å«äº†ä¸€äº›èƒŒæ™¯åˆ†å‰²ç®—æ³•çš„å®ç°ï¼Œç”¨äºä»è§†é¢‘ä¸­æå–å‰æ™¯å¯¹è±¡ã€‚è¿™äº›ç®—æ³•å¯ä»¥ç”¨äºè¿åŠ¨æ£€æµ‹ã€ç›®æ ‡è·Ÿè¸ªç­‰ä»»åŠ¡ã€‚</li>
<li><strong>bioinspired</strong>ï¼šå®ç°äº†ä¸€äº›ç”Ÿç‰©å¯å‘å¼çš„å›¾åƒå¤„ç†ç®—æ³•ï¼ŒåŒ…æ‹¬è§†ç½‘è†œæ¨¡å‹ã€å…‰æµä¼°è®¡ç­‰ã€‚è¿™äº›ç®—æ³•å—åˆ°ç”Ÿç‰©è§†è§‰ç³»ç»Ÿçš„å¯å‘ï¼Œç”¨äºæ¨¡æ‹Ÿäººçœ¼çš„æ„ŸçŸ¥æœºåˆ¶ã€‚</li>
<li><strong>dnn</strong>ï¼šæä¾›äº†æ·±åº¦å­¦ä¹ çš„æ”¯æŒï¼ŒåŒ…æ‹¬åŠ è½½å’Œè¿è¡ŒåŸºäºæ·±åº¦å­¦ä¹ æ¨¡å‹çš„å›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹å’Œå›¾åƒåˆ†å‰²ç­‰ä»»åŠ¡ã€‚</li>
<li><strong>face</strong>ï¼šåŒ…å«äº†äººè„¸æ£€æµ‹ã€äººè„¸è¯†åˆ«å’Œäººè„¸ç‰¹å¾ç‚¹æ£€æµ‹ç­‰ç›¸å…³åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½å¯ä»¥ç”¨äºäººè„¸åˆ†æã€äººè„¸è¯†åˆ«å’Œè¡¨æƒ…è¯†åˆ«ç­‰åº”ç”¨ã€‚</li>
<li><strong>text</strong>ï¼šæä¾›äº†æ–‡æœ¬æ£€æµ‹å’Œè¯†åˆ«çš„åŠŸèƒ½ï¼Œå¯ä»¥ç”¨äºåœºæ™¯æ–‡æœ¬æ£€æµ‹ã€OCRï¼ˆå…‰å­¦å­—ç¬¦è¯†åˆ«ï¼‰ç­‰ä»»åŠ¡ã€‚</li>
<li><strong>xfeatures2d</strong>ï¼šæ‰©å±•äº†OpenCVçš„ç‰¹å¾æ£€æµ‹å’Œæè¿°å­æ¨¡å—ï¼Œæä¾›äº†ä¸€äº›é¢å¤–çš„ç‰¹å¾æ£€æµ‹ç®—æ³•å’Œæè¿°å­ç®—æ³•ï¼Œå¦‚SURFã€SIFTç­‰ã€‚</li>
</ol>
<p>é™¤äº†ä¸Šè¿°æ¨¡å—ï¼ŒOpenCV-contribè¿˜åŒ…æ‹¬å…¶ä»–ä¸€äº›æ¨¡å—å’ŒåŠŸèƒ½ï¼Œå¦‚å…‰å­¦æµã€ç»“æ„å…‰ã€ä¸‰ç»´é‡å»ºã€å›¾åƒåˆ†å‰²ç­‰ã€‚è¿™äº›æ¨¡å—å’ŒåŠŸèƒ½å¯ä»¥é€šè¿‡ä¸‹è½½å’Œç¼–è¯‘OpenCV-contribåº“æ¥ä½¿ç”¨ã€‚</p>
<p>åœ¨è¿™é‡Œå°±åªæ˜¯ç¼–è¯‘opencvæºç äº†ï¼Œä¹Ÿå°±ä¸å†æ·»åŠ opencv-contribï¼Œç›®å‰æ˜¯ç”¨ä¸åˆ°çš„ã€‚</p>
<p>å…‹éš†opencvæºç </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/opencv/opencv</span><br></pre></td></tr></table></figure>

<p>githubçš„ä»“åº“æºç å¤ªå¤§äº†ï¼Œè¿˜æ˜¯ç›´æ¥ä»å®˜ç½‘ä¸‹è½½å§~ï¼Œè¿™é‡Œä¸‹è½½æœ€æ–°çš„opencv4.8 ï¼Œæ‹·è´åˆ°ubuntuä¹‹ä¸Šç„¶åè§£å‹ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116816.png" alt="image-20231017210921130"></p>
<p>åœ¨ç¼–è¯‘ä¹‹å‰è¿˜éœ€è¦å…ˆå®‰è£…ä¸€äº›ä¾èµ–</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install build-essential </span><br><span class="line"></span><br><span class="line">sudo apt-get install cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev</span><br><span class="line"></span><br><span class="line">sudo apt-get install python-dev-is-python2 python-numpy libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev  libdc1394-22-dev</span><br><span class="line"></span><br><span class="line">pip3 install numpy</span><br><span class="line"> </span><br><span class="line">sudo update-alternatives --install /usr/bin/python python /usr/bin/python2 100</span><br><span class="line">sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 150</span><br></pre></td></tr></table></figure>

<h2 id="2-æºç ç¼–è¯‘ï¼ˆPCï¼‰"><a href="#2-æºç ç¼–è¯‘ï¼ˆPCï¼‰" class="headerlink" title="2.æºç ç¼–è¯‘ï¼ˆPCï¼‰"></a>2.æºç ç¼–è¯‘ï¼ˆPCï¼‰</h2><p>ç„¶ååœ¨opencvæºç ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªbuildç›®å½•è¿›è¡Œå·¥ç¨‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir build</span><br><span class="line">cd build</span><br></pre></td></tr></table></figure>

<p>æ„å»ºå‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>(1) æ„å»ºé™æ€åº“</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake -D  CMAKE_INSTALL_PREFIX=/usr/local \</span><br><span class="line">-D CMAKE_BUILD_TYPE=Release \</span><br><span class="line">-D OPENCV_GENERATE_PKGCONFIG=ON \</span><br><span class="line">-D WITH_QUIRC=ON  \</span><br><span class="line">-D OPENCV_ENABLE_NONFREE=True \</span><br><span class="line">-D OPENCV_GENERATE_PKGCONFIG=YES \</span><br><span class="line">-D WITH_OPENGL=ON \</span><br><span class="line">-D ENABLE_CXX11=1 \</span><br><span class="line">-D WITH_OPENMP=ON \</span><br><span class="line">-D WITH_1394=OFF \</span><br><span class="line">-D INSTALL_C_EXAMPLES=OFF \</span><br><span class="line">-D BUILD_EXAMPLES=OFF \</span><br><span class="line">-D PYTHON_DEFAULT_EXECUTABLE=/usr/bin/python3 \</span><br><span class="line">-D BUILD_opencv_python3=yes \</span><br><span class="line">-D BUILD_opencv_python2=no \</span><br><span class="line">-D PYTHON3_EXECUTABLE=/usr/bin/python3 \</span><br><span class="line">-D PYTHON3_INCLUDE_DIR=/usr/include/python3.8 \</span><br><span class="line">-D PYTHON3_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython3.8.so \</span><br><span class="line">-D PYTHON3_NUMPY_INCLUDE_DIRS=/usr/local/lib/python3.8/dist-packages/numpy/core/include/ \</span><br><span class="line">-D BUILD_SHARED_LIBS=OFF \</span><br><span class="line">..</span><br></pre></td></tr></table></figure>



<p>(2)æ„å»ºåŠ¨æ€åº“</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake -D CMAKE_INSTALL_PREFIX=/usr/local \</span><br><span class="line">-D CMAKE_BUILD_TYPE=Release \</span><br><span class="line">-D OPENCV_GENERATE_PKGCONFIG=ON \</span><br><span class="line">-D WITH_QUIRC=ON  \</span><br><span class="line">-D OPENCV_ENABLE_NONFREE=True \</span><br><span class="line">-D OPENCV_GENERATE_PKGCONFIG=YES \</span><br><span class="line">-D WITH_OPENGL=ON \</span><br><span class="line">-D ENABLE_CXX11=1 \</span><br><span class="line">-D WITH_OPENMP=ON \</span><br><span class="line">-D WITH_1394=OFF \</span><br><span class="line">-D INSTALL_C_EXAMPLES=OFF \</span><br><span class="line">-D BUILD_EXAMPLES=OFF \</span><br><span class="line">-D PYTHON_DEFAULT_EXECUTABLE=/usr/bin/python3 \</span><br><span class="line">-D BUILD_opencv_python3=yes \</span><br><span class="line">-D BUILD_opencv_python2=no \</span><br><span class="line">-D PYTHON3_EXECUTABLE=/usr/bin/python3 \</span><br><span class="line">-D PYTHON3_INCLUDE_DIR=/usr/include/python3.8 \</span><br><span class="line">-D PYTHON3_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython3.8.so \</span><br><span class="line">-D PYTHON3_NUMPY_INCLUDE_DIRS=/usr/local/lib/python3.8/dist-packages/numpy/core/include/ \</span><br><span class="line">..</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-D CMAKE_INSTALL_PREFIX=/usr/local</code>: æŒ‡å®šå®‰è£…ç›®å½•ä¸º<code>/usr/local</code>ï¼Œç”Ÿæˆçš„åº“å’Œå¯æ‰§è¡Œæ–‡ä»¶å°†å®‰è£…åˆ°è¯¥ç›®å½•ä¸‹ã€‚</li>
<li><code>-D CMAKE_BUILD_TYPE=Release</code>: æŒ‡å®šæ„å»ºç±»å‹ä¸ºâ€Releaseâ€ï¼Œè¿™æ„å‘³ç€ç”Ÿæˆçš„åº“å°†è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶ä¸”ä¸åŒ…å«è°ƒè¯•ä¿¡æ¯ã€‚</li>
<li><code>-D OPENCV_GENERATE_PKGCONFIG=ON</code>: ç”Ÿæˆç”¨äº<code>pkg-config</code>çš„OpenCVé…ç½®æ–‡ä»¶ï¼Œè¿™æ ·å…¶ä»–ç¨‹åºå¯ä»¥ä½¿ç”¨<code>pkg-config</code>æ¥æŸ¥æ‰¾å’Œé“¾æ¥OpenCVåº“ã€‚</li>
<li><code>-D WITH_QUIRC=ON</code>: å¯ç”¨QUIRCæ”¯æŒï¼ŒQUIRCæ˜¯ç”¨äºè§£ç äºŒç»´æ¡ç ï¼ˆå¦‚QRç ï¼‰çš„åº“ã€‚é€šè¿‡è¿™ä¸ªå‚æ•°ï¼Œç¼–è¯‘ç”Ÿæˆçš„OpenCVåº“å°†åŒ…å«QUIRCåŠŸèƒ½ã€‚</li>
<li><code>-D OPENCV_ENABLE_NONFREE=True</code>: å¯ç”¨éå…è´¹æ¨¡å—ï¼Œè¿™äº›æ¨¡å—å¯èƒ½åŒ…å«å—é™åˆ¶çš„åŠŸèƒ½ï¼Œéœ€è¦è´­ä¹°æˆ–è·å–è®¸å¯è¯æ‰èƒ½ä½¿ç”¨ã€‚</li>
<li><code>-D OPENCV_GENERATE_PKGCONFIG=YES</code>: ç”Ÿæˆç”¨äº<code>pkg-config</code>çš„OpenCVé…ç½®æ–‡ä»¶ï¼Œè¿™æ ·å…¶ä»–ç¨‹åºå¯ä»¥ä½¿ç”¨<code>pkg-config</code>æ¥æŸ¥æ‰¾å’Œé“¾æ¥OpenCVåº“ã€‚</li>
<li><code>-D WITH_OPENGL=ON</code>: å¯ç”¨OpenGLæ”¯æŒï¼Œç”¨äºä¸OpenGLç›¸å…³çš„åŠŸèƒ½ã€‚</li>
<li><code>-D ENABLE_CXX11=1</code>: å¯ç”¨C++11æ ‡å‡†æ”¯æŒã€‚</li>
<li><code>-D WITH_OPENMP=ON</code>: å¯ç”¨OpenMPå¤šçº¿ç¨‹æ”¯æŒã€‚</li>
<li><code>-D WITH_1394=OFF</code>: ç¦ç”¨IEEE 1394ï¼ˆFireWireï¼‰æ”¯æŒã€‚</li>
<li><code>-D INSTALL_C_EXAMPLES=OFF</code>: ç¦ç”¨Cè¯­è¨€ç¤ºä¾‹çš„å®‰è£…ã€‚</li>
<li><code>-D BUILD_EXAMPLES=OFF</code>: ç¦ç”¨æ„å»ºç¤ºä¾‹ç¨‹åºã€‚</li>
<li><code>-D PYTHON_DEFAULT_EXECUTABLE=/usr/bin/python3</code>: æŒ‡å®šé»˜è®¤çš„Pythonè§£é‡Šå™¨è·¯å¾„ä¸º<code>/usr/bin/python3</code>ï¼Œè¿™å°†ç”¨äºä¸Pythonç›¸å…³çš„æ„å»ºå’Œå®‰è£…æ“ä½œ</li>
<li><code>-D BUILD_opencv_python3=yes</code>: å¯ç”¨æ„å»ºOpenCVçš„Python 3ç»‘å®šã€‚</li>
<li><code>-D BUILD_opencv_python2=no</code>: ç¦ç”¨æ„å»ºOpenCVçš„Python 2ç»‘å®šã€‚</li>
<li><code>-D PYTHON3_EXECUTABLE=/usr/bin/python3</code>: æŒ‡å®šPython 3è§£é‡Šå™¨çš„è·¯å¾„ä¸º<code>/usr/bin/python3</code>ã€‚</li>
<li><code>-D PYTHON3_INCLUDE_DIR=/usr/include/python3.8</code>: æŒ‡å®šPython 3çš„å¤´æ–‡ä»¶ç›®å½•çš„è·¯å¾„ä¸º<code>/usr/include/python3.8</code>ï¼Œè¿™é‡Œéœ€è¦æä¾›Python 3çš„å¼€å‘åŒ…è·¯å¾„ï¼Œå…·ä½“ç‰ˆæœ¬å·å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚</li>
<li><code>-D PYTHON3_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython3.8.so</code>: æŒ‡å®šPython 3çš„åº“æ–‡ä»¶è·¯å¾„ä¸º<code>/usr/lib/x86_64-linux-gnu/libpython3.8.so</code>ï¼Œè¿™é‡Œéœ€è¦æä¾›Python 3çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶è·¯å¾„ï¼Œå…·ä½“è·¯å¾„å’Œæ–‡ä»¶åå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚</li>
<li><code>-D PYTHON_DEFAULT_EXECUTABLE=/usr/bin/python3</code>: æŒ‡å®šé»˜è®¤çš„Pythonè§£é‡Šå™¨è·¯å¾„ä¸º<code>/usr/bin/python3</code>ï¼Œè¿™å°†ç”¨äºä¸Pythonç›¸å…³çš„æ„å»ºå’Œå®‰è£…æ“ä½œã€‚<code>-D PYTHON_DEFAULT_EXECUTABLE=/usr/bin/python3</code>: æŒ‡å®šé»˜è®¤çš„Pythonè§£é‡Šå™¨è·¯å¾„ä¸º<code>/usr/bin/python3</code>ï¼Œè¿™å°†ç”¨äºä¸Pythonç›¸å…³çš„æ„å»ºå’Œå®‰è£…æ“ä½œã€‚</li>
</ul>
<p>&#x3D;&#x3D;æ³¨æ„ï¼šåœ¨CMakeä¸­ï¼Œä½¿ç”¨-Då‚æ•°æ¥å®šä¹‰å˜é‡ã€‚æ¯ä¸ªå‚æ•°å¼€å¤´çš„-Dè¡¨ç¤ºè¦å®šä¹‰ä¸€ä¸ªCMakeå˜é‡ï¼Œå¹¶ä¸ºå…¶èµ‹äºˆç‰¹å®šçš„å€¼&#x3D;&#x3D;</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116804.png" alt="image-20231017221820208"></p>
<p>ç„¶åè¿›è¡Œç¼–è¯‘å®‰è£…</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make -j32</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>

<p>æˆ‘è¿™ç”µè„‘è¿˜æ˜¯å¾ˆå¿«çš„ï¼Œä¸¤åˆ†é’Ÿå§ä¹Ÿå°±ï¼Œè¿˜æ˜¯å®¶é‡Œçš„ç”µè„‘å¥½å‘€</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116859.png" alt="image-20231017212507239"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116801.png" alt="image-20231017221754400"></p>
<p>â€‹	æœ€åæ‹·è´å’Œé“¾æ¥pythonåº“ï¼ˆ&#x3D;&#x3D;è¿™ä¸€æ­¥å¿…é¡»åšï¼Œå¦åˆ™åœ¨ä½¿ç”¨çš„æ—¶å€™ä¼šæ‰¾ä¸åˆ°cv2è¿™ä¸ªæ¨¡å—&#x3D;&#x3D;ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp lib/python3/cv2.cpython-38-x86_64-linux-gnu.so /usr/local/lib/python3.8/dist-packages/</span><br><span class="line">sudo ln -s  /usr/local/lib/python3.8/dist-packages/cv2.cpython-38-x86_64-linux-gnu.so  /usr/lib/python3/dist-packages/cv2.so</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116808.png" alt="image-20231017222605454"></p>
<p>ç„¶åè¿›è¡Œç®€å•çš„æµ‹è¯•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line">cv2.__version__</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116273.png" alt="image-20231017222821948"></p>
<p>ç„¶åæµ‹è¯•ä¸€ä¸ªopencvçš„C++ç¨‹åº</p>
<p>é¦–å…ˆåˆ›å»ºä¸‰ä¸ªç›®å½•build  install  src</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir -p build  install  src</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116304.png" alt="image-20231017225840415"></p>
<p>ç„¶ååœ¨srcç›®å½•ä¸‹åˆ›å»ºæµ‹è¯•ä¾‹ç¨‹demo.cpp,ç„¶åå‘è¯¥æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ç¨‹åºï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/core/core.hpp&quot;</span>                                                                               </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/highgui/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgproc/imgproc.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">VideoCapture <span class="title">capture</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!capture.<span class="built_in">isOpened</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ— æ³•æ‰“å¼€æ‘„åƒå¤´ï¼Œåˆ™è¾“å‡ºæç¤ºä¿¡æ¯</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;æ— æ³•æ‰“å¼€æ‘„åƒå¤´&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> time0 = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(<span class="built_in">getTickCount</span>()); <span class="comment">// è·å–å¼€å§‹æ—¶é—´</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ä»æ‘„åƒå¤´æ•è·å¸§</span></span><br><span class="line">        Mat frame;</span><br><span class="line">        capture &gt;&gt; frame;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæ•è·åˆ°å¸§ï¼Œåˆ™æ˜¾ç¤ºå®ƒ</span></span><br><span class="line">        <span class="keyword">if</span> (!frame.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cvtColor</span>(frame, frame, COLOR_RGB2BGR);</span><br><span class="line">            <span class="type">double</span> time1 = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(<span class="built_in">getTickCount</span>()); <span class="comment">// è·å–ç»“æŸæ—¶é—´</span></span><br><span class="line">            <span class="type">double</span> fps = <span class="built_in">getTickFrequency</span>() / (time1 - time0); <span class="comment">// è®¡ç®—å®æ—¶å¸§ç‡</span></span><br><span class="line">            time0 = time1; <span class="comment">// æ›´æ–°å¼€å§‹æ—¶é—´</span></span><br><span class="line">            <span class="built_in">putText</span>(frame, <span class="string">&quot;FPS: &quot;</span> + <span class="built_in">to_string</span>(fps), <span class="built_in">Point</span>(<span class="number">10</span>, <span class="number">30</span>), FONT_HERSHEY_SIMPLEX, <span class="number">1</span>, <span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>); <span class="comment">// åœ¨å›¾åƒä¸Šæ˜¾ç¤ºå¸§ç‡</span></span><br><span class="line">            <span class="built_in">imshow</span>(<span class="string">&quot;MIPI Camera&quot;</span>, frame);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŒ‰ä¸‹&#x27;q&#x27;é”®é€€å‡ºå¾ªç¯</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">waitKey</span>(<span class="number">1</span>) == <span class="string">&#x27;q&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾èµ„æºå¹¶å…³é—­çª—å£</span></span><br><span class="line">    capture.<span class="built_in">release</span>();</span><br><span class="line">    <span class="built_in">destroyAllWindows</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååˆ›å»ºcmakeçš„é…ç½®æ–‡ä»¶CMakeLists.txtï¼Œæ·»åŠ å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.4</span>.<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®é¡¹ç›®åç§°ä¸º opencv_demo</span></span><br><span class="line"><span class="keyword">project</span>(opencv_demo)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½® C++ æ ‡å‡†ä¸º 11ï¼Œå¹¶ä¸”è¦æ±‚ç¼–è¯‘å™¨æ”¯æŒè¯¥æ ‡å‡†</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾å¹¶å¼•å…¥ OpenCV</span></span><br><span class="line"><span class="keyword">find_package</span>(OpenCV REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶ opencv_demoï¼Œæºæ–‡ä»¶ä¸º src/demo.cpp</span></span><br><span class="line"><span class="keyword">add_executable</span>(opencv_demo</span><br><span class="line">        src/demo.cpp</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é“¾æ¥ OpenCV åº“</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(opencv_demo</span><br><span class="line">  <span class="variable">$&#123;OpenCV_LIBS&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å®‰è£…ç›®å½•ä¸º ./install/æ“ä½œç³»ç»Ÿå</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_INSTALL_PREFIX <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/<span class="keyword">install</span>/<span class="variable">$&#123;CMAKE_SYSTEM_NAME&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶ opencv_demo åˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line"><span class="keyword">install</span>(TARGETS opencv_demo DESTINATION ./)</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿›å…¥buildç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè¿›è¡Œé…ç½®ã€ç¼–è¯‘å’Œå®‰è£…ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd build/</span><br><span class="line">cmake ../</span><br><span class="line">make </span><br><span class="line">make install </span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116295.png" alt="image-20231017230355394"></p>
<p>åœ¨install&#x2F;Linuxç›®å½•ä¸‹å°±ç”Ÿæˆäº†æµ‹è¯•APP opencv_demo<img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116215.png" alt="image-20231017230415584"></p>
<p>ç„¶åæ¥ä¸€ä¸ªæ‘„åƒå¤´è¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•åŠŸèƒ½æ­£å¸¸ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116448.png" alt="image-20231017231044428"></p>
<p>è‡³æ­¤ï¼Œopencvåœ¨PCæœºçš„ç¼–è¯‘å°±å®Œæˆäº†ã€‚</p>
<h2 id="3-äº¤å‰ç¼–è¯‘ï¼ˆqemuï¼‰"><a href="#3-äº¤å‰ç¼–è¯‘ï¼ˆqemuï¼‰" class="headerlink" title="3.äº¤å‰ç¼–è¯‘ï¼ˆqemuï¼‰"></a>3.äº¤å‰ç¼–è¯‘ï¼ˆqemuï¼‰</h2><p>ä¸Šé¢ç¼–è¯‘çš„å…¶å®éƒ½æ˜¯åœ¨X86ä¸Šç¼–è¯‘çš„ä¸€äº›ä¸ªç‰ˆæœ¬ï¼Œè€Œè¿™é‡Œå°†ç¼–è¯‘å¼€å‘æ¿çš„ç‰ˆæœ¬ï¼Œæœ¬æ¥æƒ³çš„æ˜¯äº¤å‰ç¼–è¯‘å‘€ï¼Œå¯æ˜¯åæ¥æˆ‘ä¸€æƒ³ï¼Œæˆ‘æœ‰qemuå‘€ï¼Œæˆ‘è¿˜äº¤å‰ç¼–è¯‘å•¥å‘€ï¼Œå®Œå…¨ä¸éœ€è¦å‘€ï¼Œå®Œå…¨å¿˜è®°äº†qemuè¿˜æœ‰è¿™ä¸ª~ã€‚</p>
<p>é¦–å…ˆè§£å‹ä¸€ä¸‹å¼€å‘æ¿ubuntu20çš„æºç ï¼Œè§£å‹å®Œæˆå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116328.png" alt="image-20231018220418904"></p>
<p>â€‹	ç„¶ååˆ›å»ºä¸€ä¸ªåä¸ºmount.shçš„æŒ‚è½½è„šæœ¬ï¼Œè¯¥è„šæœ¬çš„ä½œç”¨æ˜¯æŒ‚è½½ubuntuå¹¶qemu</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">function mnt() &#123;</span><br><span class="line">    echo &quot;MOUNTING&quot;</span><br><span class="line">    sudo mount -t proc /proc $&#123;2&#125;proc</span><br><span class="line">    sudo mount -t sysfs /sys $&#123;2&#125;sys</span><br><span class="line">    sudo mount -o bind /dev $&#123;2&#125;dev</span><br><span class="line">    sudo mount -B /dev/pts $&#123;2&#125;dev/pts</span><br><span class="line"></span><br><span class="line">    sudo chroot $&#123;2&#125; /bin/sh</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function umnt() &#123;</span><br><span class="line">    echo &quot;UNMOUNTING&quot;</span><br><span class="line">    sudo umount $&#123;2&#125;proc</span><br><span class="line">    sudo umount $&#123;2&#125;sys</span><br><span class="line">    sudo umount $&#123;2&#125;dev/pts</span><br><span class="line">    sudo umount $&#123;2&#125;dev</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if [ &quot;$1&quot; == &quot;-m&quot; ] &amp;&amp; [ -n &quot;$2&quot; ] ;</span><br><span class="line">then</span><br><span class="line">    mnt $1 $2</span><br><span class="line">elif [ &quot;$1&quot; == &quot;-u&quot; ] &amp;&amp; [ -n &quot;$2&quot; ];</span><br><span class="line">then</span><br><span class="line">    umnt $1 $2</span><br><span class="line">else</span><br><span class="line">    echo &quot;&quot;</span><br><span class="line">    echo &quot;Either 1&#x27;st, 2&#x27;nd or both parameters were missing&quot;</span><br><span class="line">    echo &quot;&quot;</span><br><span class="line">    echo &quot;1&#x27;st parameter can be one of these: -m(mount) OR -u(umount)&quot;</span><br><span class="line">    echo &quot;2&#x27;nd parameter is the full path of rootfs directory(with trailing &#x27;/&#x27;)&quot;</span><br><span class="line">    echo &quot;&quot;</span><br><span class="line">    echo &quot;For example: ch-mount -m /media/sdcard/&quot;</span><br><span class="line">    echo &quot;&quot;</span><br><span class="line">    echo 1st parameter : $&#123;1&#125;</span><br><span class="line">    echo 2nd parameter : $&#123;2&#125;</span><br><span class="line">fi</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116667.png" alt="image-20231018220519930"></p>
<p>ç„¶åè¿™æ ·è¿›è¡ŒæŒ‚è½½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./mount.sh -m ubuntu/</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116729.png" alt="image-20231018220618193"></p>
<p>æˆ‘è¿™é‡Œé¦–å…ˆæ›´æ–°äº†ä¸€ä¸‹è½¯ä»¶æºï¼Œç„¶åå°±æ˜¯å®‰è£…ä¸€äº›ä¾èµ–ï¼Œå°±è·Ÿä¸Šé¢åœ¨PCä¸Šå®‰è£…ä¾èµ–çš„æ–¹æ³•ç›¸åŒã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install build-essential </span><br><span class="line"></span><br><span class="line">sudo apt-get install cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev</span><br><span class="line"></span><br><span class="line">sudo apt-get install python-dev-is-python2 python-numpy libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev  libdc1394-22-dev</span><br><span class="line"></span><br><span class="line">pip3 install numpy</span><br><span class="line"> </span><br><span class="line">sudo update-alternatives --install /usr/bin/python python /usr/bin/python2 100</span><br><span class="line">sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 150</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°†opencvæºç æ‹·è´åˆ°qumuçš„uubntuç›®å½•ä¸‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116797.png" alt="image-20231018220935063"></p>
<p>ç„¶åè¿›è¡Œopencvæºç çš„è§£å‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">unzip opencv-4.8.0.zip</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨opencvæºç ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªbuildç›®å½•è¿›è¡Œå·¥ç¨‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir build</span><br><span class="line">cd build</span><br></pre></td></tr></table></figure>

<p>æ„å»ºå‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>(1) æ„å»ºé™æ€åº“</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake -D  CMAKE_INSTALL_PREFIX=../install \</span><br><span class="line">-D CMAKE_BUILD_TYPE=Release \</span><br><span class="line">-D OPENCV_GENERATE_PKGCONFIG=ON \</span><br><span class="line">-D WITH_QUIRC=ON  \</span><br><span class="line">-D OPENCV_ENABLE_NONFREE=True \</span><br><span class="line">-D OPENCV_GENERATE_PKGCONFIG=YES \</span><br><span class="line">-D WITH_OPENGL=ON \</span><br><span class="line">-D ENABLE_CXX11=1 \</span><br><span class="line">-D WITH_OPENMP=ON \</span><br><span class="line">-D WITH_1394=OFF \</span><br><span class="line">-D INSTALL_C_EXAMPLES=OFF \</span><br><span class="line">-D BUILD_EXAMPLES=OFF \</span><br><span class="line">-D PYTHON_DEFAULT_EXECUTABLE=/usr/bin/python3 \</span><br><span class="line">-D BUILD_opencv_python3=yes \</span><br><span class="line">-D BUILD_opencv_python2=no \</span><br><span class="line">-D PYTHON3_EXECUTABLE=/usr/bin/python3 \</span><br><span class="line">-D PYTHON3_INCLUDE_DIR=/usr/include/python3.8 \</span><br><span class="line">-D PYTHON3_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython3.8.so \</span><br><span class="line">-D PYTHON3_NUMPY_INCLUDE_DIRS=/usr/local/lib/python3.8/dist-packages/numpy/core/include/ \</span><br><span class="line">-D BUILD_SHARED_LIBS=OFF \</span><br><span class="line">..</span><br></pre></td></tr></table></figure>

<p>ç”±äºè¿™é‡Œåªæ˜¯æƒ³è¦å¾—åˆ°ä»–çš„åº“ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸å®‰è£…åˆ°usr&#x2F;localç›®å½•ä¸‹äº†</p>
<p>(2)æ„å»ºåŠ¨æ€åº“</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake -D CMAKE_INSTALL_PREFIX=../install \</span><br><span class="line">-D CMAKE_BUILD_TYPE=Release \</span><br><span class="line">-D OPENCV_GENERATE_PKGCONFIG=ON \</span><br><span class="line">-D WITH_QUIRC=ON  \</span><br><span class="line">-D OPENCV_ENABLE_NONFREE=True \</span><br><span class="line">-D OPENCV_GENERATE_PKGCONFIG=YES \</span><br><span class="line">-D WITH_OPENGL=ON \</span><br><span class="line">-D ENABLE_CXX11=1 \</span><br><span class="line">-D WITH_OPENMP=ON \</span><br><span class="line">-D WITH_1394=OFF \</span><br><span class="line">-D INSTALL_C_EXAMPLES=OFF \</span><br><span class="line">-D BUILD_EXAMPLES=OFF \</span><br><span class="line">-D PYTHON_DEFAULT_EXECUTABLE=/usr/bin/python3 \</span><br><span class="line">-D BUILD_opencv_python3=yes \</span><br><span class="line">-D BUILD_opencv_python2=no \</span><br><span class="line">-D PYTHON3_EXECUTABLE=/usr/bin/python3 \</span><br><span class="line">-D PYTHON3_INCLUDE_DIR=/usr/include/python3.8 \</span><br><span class="line">-D PYTHON3_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython3.8.so \</span><br><span class="line">-D PYTHON3_NUMPY_INCLUDE_DIRS=/usr/local/lib/python3.8/dist-packages/numpy/core/include/ \</span><br><span class="line">..</span><br></pre></td></tr></table></figure>

<p>ç”±äºè¿™é‡Œåªæ˜¯æƒ³è¦å¾—åˆ°ä»–çš„åº“ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸å®‰è£…åˆ°usr&#x2F;localç›®å½•ä¸‹äº†</p>
<ul>
<li><code>-D CMAKE_INSTALL_PREFIX=/usr/local</code>: æŒ‡å®šå®‰è£…ç›®å½•ä¸º<code>/usr/local</code>ï¼Œç”Ÿæˆçš„åº“å’Œå¯æ‰§è¡Œæ–‡ä»¶å°†å®‰è£…åˆ°è¯¥ç›®å½•ä¸‹ã€‚</li>
<li><code>-D CMAKE_BUILD_TYPE=Release</code>: æŒ‡å®šæ„å»ºç±»å‹ä¸ºâ€Releaseâ€ï¼Œè¿™æ„å‘³ç€ç”Ÿæˆçš„åº“å°†è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶ä¸”ä¸åŒ…å«è°ƒè¯•ä¿¡æ¯ã€‚</li>
<li><code>-D OPENCV_GENERATE_PKGCONFIG=ON</code>: ç”Ÿæˆç”¨äº<code>pkg-config</code>çš„OpenCVé…ç½®æ–‡ä»¶ï¼Œè¿™æ ·å…¶ä»–ç¨‹åºå¯ä»¥ä½¿ç”¨<code>pkg-config</code>æ¥æŸ¥æ‰¾å’Œé“¾æ¥OpenCVåº“ã€‚</li>
<li><code>-D WITH_QUIRC=ON</code>: å¯ç”¨QUIRCæ”¯æŒï¼ŒQUIRCæ˜¯ç”¨äºè§£ç äºŒç»´æ¡ç ï¼ˆå¦‚QRç ï¼‰çš„åº“ã€‚é€šè¿‡è¿™ä¸ªå‚æ•°ï¼Œç¼–è¯‘ç”Ÿæˆçš„OpenCVåº“å°†åŒ…å«QUIRCåŠŸèƒ½ã€‚</li>
<li><code>-D OPENCV_ENABLE_NONFREE=True</code>: å¯ç”¨éå…è´¹æ¨¡å—ï¼Œè¿™äº›æ¨¡å—å¯èƒ½åŒ…å«å—é™åˆ¶çš„åŠŸèƒ½ï¼Œéœ€è¦è´­ä¹°æˆ–è·å–è®¸å¯è¯æ‰èƒ½ä½¿ç”¨ã€‚</li>
<li><code>-D OPENCV_GENERATE_PKGCONFIG=YES</code>: ç”Ÿæˆç”¨äº<code>pkg-config</code>çš„OpenCVé…ç½®æ–‡ä»¶ï¼Œè¿™æ ·å…¶ä»–ç¨‹åºå¯ä»¥ä½¿ç”¨<code>pkg-config</code>æ¥æŸ¥æ‰¾å’Œé“¾æ¥OpenCVåº“ã€‚</li>
<li><code>-D WITH_OPENGL=ON</code>: å¯ç”¨OpenGLæ”¯æŒï¼Œç”¨äºä¸OpenGLç›¸å…³çš„åŠŸèƒ½ã€‚</li>
<li><code>-D ENABLE_CXX11=1</code>: å¯ç”¨C++11æ ‡å‡†æ”¯æŒã€‚</li>
<li><code>-D WITH_OPENMP=ON</code>: å¯ç”¨OpenMPå¤šçº¿ç¨‹æ”¯æŒã€‚</li>
<li><code>-D WITH_1394=OFF</code>: ç¦ç”¨IEEE 1394ï¼ˆFireWireï¼‰æ”¯æŒã€‚</li>
<li><code>-D INSTALL_C_EXAMPLES=OFF</code>: ç¦ç”¨Cè¯­è¨€ç¤ºä¾‹çš„å®‰è£…ã€‚</li>
<li><code>-D BUILD_EXAMPLES=OFF</code>: ç¦ç”¨æ„å»ºç¤ºä¾‹ç¨‹åºã€‚</li>
<li><code>-D PYTHON_DEFAULT_EXECUTABLE=/usr/bin/python3</code>: æŒ‡å®šé»˜è®¤çš„Pythonè§£é‡Šå™¨è·¯å¾„ä¸º<code>/usr/bin/python3</code>ï¼Œè¿™å°†ç”¨äºä¸Pythonç›¸å…³çš„æ„å»ºå’Œå®‰è£…æ“ä½œ</li>
<li><code>-D BUILD_opencv_python3=yes</code>: å¯ç”¨æ„å»ºOpenCVçš„Python 3ç»‘å®šã€‚</li>
<li><code>-D BUILD_opencv_python2=no</code>: ç¦ç”¨æ„å»ºOpenCVçš„Python 2ç»‘å®šã€‚</li>
<li><code>-D PYTHON3_EXECUTABLE=/usr/bin/python3</code>: æŒ‡å®šPython 3è§£é‡Šå™¨çš„è·¯å¾„ä¸º<code>/usr/bin/python3</code>ã€‚</li>
<li><code>-D PYTHON3_INCLUDE_DIR=/usr/include/python3.8</code>: æŒ‡å®šPython 3çš„å¤´æ–‡ä»¶ç›®å½•çš„è·¯å¾„ä¸º<code>/usr/include/python3.8</code>ï¼Œè¿™é‡Œéœ€è¦æä¾›Python 3çš„å¼€å‘åŒ…è·¯å¾„ï¼Œå…·ä½“ç‰ˆæœ¬å·å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚</li>
<li><code>-D PYTHON3_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython3.8.so</code>: æŒ‡å®šPython 3çš„åº“æ–‡ä»¶è·¯å¾„ä¸º<code>/usr/lib/x86_64-linux-gnu/libpython3.8.so</code>ï¼Œè¿™é‡Œéœ€è¦æä¾›Python 3çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶è·¯å¾„ï¼Œå…·ä½“è·¯å¾„å’Œæ–‡ä»¶åå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚</li>
<li><code>-D PYTHON_DEFAULT_EXECUTABLE=/usr/bin/python3</code>: æŒ‡å®šé»˜è®¤çš„Pythonè§£é‡Šå™¨è·¯å¾„ä¸º<code>/usr/bin/python3</code>ï¼Œè¿™å°†ç”¨äºä¸Pythonç›¸å…³çš„æ„å»ºå’Œå®‰è£…æ“ä½œã€‚<code>-D PYTHON_DEFAULT_EXECUTABLE=/usr/bin/python3</code>: æŒ‡å®šé»˜è®¤çš„Pythonè§£é‡Šå™¨è·¯å¾„ä¸º<code>/usr/bin/python3</code>ï¼Œè¿™å°†ç”¨äºä¸Pythonç›¸å…³çš„æ„å»ºå’Œå®‰è£…æ“ä½œã€‚</li>
</ul>
<p>&#x3D;&#x3D;æ³¨æ„ï¼šåœ¨CMakeä¸­ï¼Œä½¿ç”¨-Då‚æ•°æ¥å®šä¹‰å˜é‡ã€‚æ¯ä¸ªå‚æ•°å¼€å¤´çš„-Dè¡¨ç¤ºè¦å®šä¹‰ä¸€ä¸ªCMakeå˜é‡ï¼Œå¹¶ä¸ºå…¶èµ‹äºˆç‰¹å®šçš„å€¼&#x3D;&#x3D;</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116906.png" alt="image-20231018221553413"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">make -j32</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶æ˜¯qemuï¼Œä½†æ˜¯ç”¨çš„ä»æ—§æ˜¯PCçš„CPUï¼Œä½†æ˜¯è¿™ä¸ªé€Ÿåº¦æ˜¯çœŸçš„æ…¢å‘€ï¼Œä½†æˆ‘çœ‹CPUéƒ½è·‘æ»¡äº†å‘€~~ç«Ÿç„¶æäº†ä¸‰ååˆ†é’Ÿ~</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116875.png" alt="image-20231018225750952"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116200.png" alt="image-20231018225848736"></p>
<p>â€‹	æœ€åæ‹·è´å’Œé“¾æ¥pythonåº“ï¼ˆ&#x3D;&#x3D;è¿™ä¸€æ­¥å¿…é¡»åšï¼Œå¦åˆ™åœ¨ä½¿ç”¨çš„æ—¶å€™ä¼šæ‰¾ä¸åˆ°cv2è¿™ä¸ªæ¨¡å—&#x3D;&#x3D;ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cp lib/python3/cv2.cpython-38-aarch64-linux-gnu.so ../install/lib/python3.8/site-packages/</span><br><span class="line">ln -s  /usr/local/lib/python3.8/dist-packages/cv2.cpython-38-aarch64-linux-gnu.so  /usr/lib/python3/dist-packages/cv2.so</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116808.png" alt="image-20231017222605454"></p>
<p>ç„¶åè¿›è¡Œç®€å•çš„æµ‹è¯•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python</span><br><span class="line"></span><br><span class="line">import cv2</span><br><span class="line">cv2.__version__</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116273.png" alt="image-20231017222821948"></p>
<p>ç„¶åæµ‹è¯•ä¸€ä¸ªopencvçš„C++ç¨‹åº</p>
<p>é¦–å…ˆåˆ›å»ºä¸‰ä¸ªç›®å½•build  install  src</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir -p build  install  src</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116304.png" alt="image-20231017225840415"></p>
<p>ç„¶ååœ¨srcç›®å½•ä¸‹åˆ›å»ºæµ‹è¯•ä¾‹ç¨‹demo.cpp,ç„¶åå‘è¯¥æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ç¨‹åºï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/core/core.hpp&quot;</span>                                                                               </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/highgui/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgproc/imgproc.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">VideoCapture <span class="title">capture</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!capture.<span class="built_in">isOpened</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ— æ³•æ‰“å¼€æ‘„åƒå¤´ï¼Œåˆ™è¾“å‡ºæç¤ºä¿¡æ¯</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;æ— æ³•æ‰“å¼€æ‘„åƒå¤´&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> time0 = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(<span class="built_in">getTickCount</span>()); <span class="comment">// è·å–å¼€å§‹æ—¶é—´</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ä»æ‘„åƒå¤´æ•è·å¸§</span></span><br><span class="line">        Mat frame;</span><br><span class="line">        capture &gt;&gt; frame;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæ•è·åˆ°å¸§ï¼Œåˆ™æ˜¾ç¤ºå®ƒ</span></span><br><span class="line">        <span class="keyword">if</span> (!frame.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cvtColor</span>(frame, frame, COLOR_RGB2BGR);</span><br><span class="line">            <span class="type">double</span> time1 = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(<span class="built_in">getTickCount</span>()); <span class="comment">// è·å–ç»“æŸæ—¶é—´</span></span><br><span class="line">            <span class="type">double</span> fps = <span class="built_in">getTickFrequency</span>() / (time1 - time0); <span class="comment">// è®¡ç®—å®æ—¶å¸§ç‡</span></span><br><span class="line">            time0 = time1; <span class="comment">// æ›´æ–°å¼€å§‹æ—¶é—´</span></span><br><span class="line">            <span class="built_in">putText</span>(frame, <span class="string">&quot;FPS: &quot;</span> + <span class="built_in">to_string</span>(fps), <span class="built_in">Point</span>(<span class="number">10</span>, <span class="number">30</span>), FONT_HERSHEY_SIMPLEX, <span class="number">1</span>, <span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>); <span class="comment">// åœ¨å›¾åƒä¸Šæ˜¾ç¤ºå¸§ç‡</span></span><br><span class="line">            <span class="built_in">imshow</span>(<span class="string">&quot;MIPI Camera&quot;</span>, frame);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŒ‰ä¸‹&#x27;q&#x27;é”®é€€å‡ºå¾ªç¯</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">waitKey</span>(<span class="number">1</span>) == <span class="string">&#x27;q&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾èµ„æºå¹¶å…³é—­çª—å£</span></span><br><span class="line">    capture.<span class="built_in">release</span>();</span><br><span class="line">    <span class="built_in">destroyAllWindows</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååˆ›å»ºcmakeçš„é…ç½®æ–‡ä»¶CMakeLists.txtï¼Œæ·»åŠ å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.4</span>.<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®é¡¹ç›®åç§°ä¸º opencv_demo</span></span><br><span class="line"><span class="keyword">project</span>(opencv_demo)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½® C++ æ ‡å‡†ä¸º 11ï¼Œå¹¶ä¸”è¦æ±‚ç¼–è¯‘å™¨æ”¯æŒè¯¥æ ‡å‡†</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾å¹¶å¼•å…¥ OpenCV</span></span><br><span class="line"><span class="keyword">find_package</span>(OpenCV REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶ opencv_demoï¼Œæºæ–‡ä»¶ä¸º src/demo.cpp</span></span><br><span class="line"><span class="keyword">add_executable</span>(opencv_demo</span><br><span class="line">        src/demo.cpp</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é“¾æ¥ OpenCV åº“</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(opencv_demo</span><br><span class="line">  <span class="variable">$&#123;OpenCV_LIBS&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å®‰è£…ç›®å½•ä¸º ./install/æ“ä½œç³»ç»Ÿå</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_INSTALL_PREFIX <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/<span class="keyword">install</span>/<span class="variable">$&#123;CMAKE_SYSTEM_NAME&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶ opencv_demo åˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line"><span class="keyword">install</span>(TARGETS opencv_demo DESTINATION ./)</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿›å…¥buildç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè¿›è¡Œé…ç½®ã€ç¼–è¯‘å’Œå®‰è£…ä¸‰ä¸ªæ­¥éª¤ï¼ˆ&#x3D;&#x3D;è¿™é‡Œç”±äºæˆ‘æ˜¯å°†opencvçš„åº“å’Œå¤´æ–‡ä»¶ç­‰æ”¾åˆ°äº†ä¸Šä¸€çº§çš„installç›®å½•ï¼Œæ‰€ä»¥è¿™é‡Œå¯èƒ½è¦ä¿®æ”¹ä¸€ä¸‹CmakeListsï¼Œä½†ä¹Ÿè¿˜å¥½&#x3D;&#x3D;ï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd build/</span><br><span class="line">cmake ../</span><br><span class="line">make </span><br><span class="line">make install </span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042116295.png" alt="image-20231017230355394"></p>
<p>è‡³æ­¤ï¼Œopencv qemuç¼–è¯‘å°±å®Œæˆäº†ã€‚</p>
<h1 id="4-vscode-é…ç½®python"><a href="#4-vscode-é…ç½®python" class="headerlink" title="4.vscode é…ç½®python"></a>4.vscode é…ç½®python</h1><h2 id="4-1-ä¸‹è½½VScode"><a href="#4-1-ä¸‹è½½VScode" class="headerlink" title="4.1.ä¸‹è½½VScode"></a>4.1.ä¸‹è½½VScode</h2><p><a href="https://code.visualstudio.com/">é™„ä¸Šå®˜ç½‘åœ°å€ï¼šVisual Studio Code - Code Editing. Redefined</a></p>
<h2 id="4-2-åœ¨vså®‰è£…pythonæ’ä»¶"><a href="#4-2-åœ¨vså®‰è£…pythonæ’ä»¶" class="headerlink" title="4.2.åœ¨vså®‰è£…pythonæ’ä»¶"></a>4.2.åœ¨<a href="https://so.csdn.net/so/search?q=vs%E5%AE%89%E8%A3%85&spm=1001.2101.3001.7020">vså®‰è£…</a>pythonæ’ä»¶</h2><p>è¿™ä¸ªå¾ˆç®€å•ï¼Œæˆ‘å°±ä¸å†æˆªå›¾äº†ã€‚</p>
<h2 id="4-3-é…ç½®pythonç¯å¢ƒ"><a href="#4-3-é…ç½®pythonç¯å¢ƒ" class="headerlink" title="4.3.é…ç½®pythonç¯å¢ƒ"></a>4.3.é…ç½®pythonç¯å¢ƒ</h2><p><a href="https://www.python.org/">pythonå®˜ç½‘ï¼šWelcome to Python.org</a></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312050734569.png" alt="image-20231205073415526"></p>
<p>è™½ç„¶å·²ç»åˆ°äº†3.12çš„ç‰ˆæœ¬ï¼Œä½†è¿™ä¸ªéšæ„äº†ï¼Œæˆ‘è®¤ä¸ºæ— æ‰€è°“ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312050739764.png" alt="image-20231205073900729"></p>
<p>ç„¶åæ‰“å¼€ä¸€ä¸ªshellç»ˆç«¯ï¼Œå‘ç°è¿è¡Œpythonä¹‹åæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312050739725.png" alt="image-20231205073953699"></p>
<p>ç„¶åå®‰è£…ä¸¤ä¸ªåŒ…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install flake8 yapf -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>

<p>flake8ä¼šæ£€æŸ¥ç¼–å†™ä»£ç æ—¶çš„ä¸è§„èŒƒçš„åœ°æ–¹å’Œè¯­æ³•é”™è¯¯ã€‚</p>
<p>yapfæ˜¯ä¸€ä¸ªä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œå¯ä»¥ä¸€é”®ç¾åŒ–ä»£ç ã€‚<strong>Shift + Alt + Fä¸€é”®ç¾åŒ–ä»£ç </strong></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312050743881.png" alt="image-20231205074300847"></p>
<p>ä¸€å®šè¦åœ¨pythonç›®å½•ä¸‹æ‰å¯ä»¥ï¼Œéš¾é“æˆ‘éœ€è¦å†æ·»åŠ ä¸€ä¸‹è·¯å¾„å—ï¼Œå¾ˆå¥‡æ€ªåæ­£~~ã€‚</p>
<h3 id="4-4é€‰æ‹©pythonè§£é‡Šå™¨"><a href="#4-4é€‰æ‹©pythonè§£é‡Šå™¨" class="headerlink" title="4.4é€‰æ‹©pythonè§£é‡Šå™¨"></a>4.4é€‰æ‹©pythonè§£é‡Šå™¨</h3><p>æ‰“å¼€VScodeï¼Œç‚¹å‡»å·¦ä¸Šè§’ï¼Œæ–‡ä»¶-&gt;é¦–é€‰é¡¹-&gt;è®¾ç½®</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312052129421.png" alt="image-20231205212927391"></p>
<p>ç„¶åæ‰“å¼€ç•Œé¢å³ä¸Šè§’çš„ç®­å¤´çº¸å¼ è¿™å°±æ˜¯jsonè®¾ç½®</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312052131657.png" alt="image-20231205213107628"></p>
<p>ç„¶åå°†ä¸‹é¢ä»£ç æ›¿æ¢é‡Œé¢çš„å†…å®¹ï¼Œç¬¬ä¸€è¡Œå³ä¸ºpythonæ‰€åœ¨è·¯å¾„ã€‚è®°å¾—åœ¨è·¯å¾„å¤šåŠ  \ </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;python.PYTHONPATH&quot;</span><span class="punctuation">:</span><span class="string">&quot;D:\\Python\\Python312&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;python.linting.flake8Enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;editor.formatOnSave&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;python.formatting.provider&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yapf&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;python.formatting.yapfArgs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;--style=&#123;based_on_style: pep8, indent_width: 4&#125;&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;python.linting.flake8Args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;--max-line-length=248&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;python.linting.pylintEnabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;explorer.confirmDelete&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;[python]&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;editor.formatOnType&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åä¿å­˜å³å¯ï¼Œå°±å¯ä»¥åœ¨pythonæ–‡ä»¶ä¸­ä½¿ç”¨<strong>Shift + Alt + F</strong>æ¥æ ¼å¼åŒ–ä½ çš„ä»£ç å•¦ã€‚</p>
<p>æµ‹è¯•å¯ç”¨ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312052135998.png" alt="image-20231205213520975"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312052135954.png" alt="image-20231205213527919"></p>
<h1 id="5-windows-c-ç¯å¢ƒçš„é…ç½®"><a href="#5-windows-c-ç¯å¢ƒçš„é…ç½®" class="headerlink" title="5 windows c++ç¯å¢ƒçš„é…ç½®"></a>5 windows c++ç¯å¢ƒçš„é…ç½®</h1><h2 id="5-1-Visual-Studio-Codeç›¸å…³ä¿¡æ¯"><a href="#5-1-Visual-Studio-Codeç›¸å…³ä¿¡æ¯" class="headerlink" title="5.1 Visual Studio Codeç›¸å…³ä¿¡æ¯"></a>5.1 Visual Studio Codeç›¸å…³ä¿¡æ¯</h2><ul>
<li>Visual Studio Code ä¸‹è½½åœ°å€ï¼š<a href="https://code.visualstudio.com/download">https://code.visualstudio.com/download</a></li>
<li>VS Codeå»ºè®®å®‰è£…æ’ä»¶åˆ—è¡¨ï¼š<ul>
<li>ä¸­æ–‡èœå•ï¼š<ul>
<li>MS-CEINTL.vscode-language-pack-zh-hans</li>
</ul>
</li>
<li>SSHè¿œç¨‹å¼€å‘ï¼š<ul>
<li>ms-vscode-remote.remote-ssh</li>
<li>ms-vscode-remote.remote-ssh-edit</li>
<li>ms-vscode.remote-explorer</li>
</ul>
</li>
<li>C++å¼€å‘<ul>
<li>ms-vscode.cpptools</li>
</ul>
</li>
<li>ä»£ç è¡¥å…¨<ul>
<li>TabNine.tabnine-vscode</li>
<li>GitHub.copilot</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="5-2ä¸‹è½½å®‰è£…g"><a href="#5-2ä¸‹è½½å®‰è£…g" class="headerlink" title="5.2ä¸‹è½½å®‰è£…g++"></a>5.2ä¸‹è½½å®‰è£…g++</h2><p>&#x3D;&#x3D;å…·ä½“å¯ä»¥çœ‹1.2.1å°èŠ‚&#x3D;&#x3D;</p>
<h2 id="5-3é…ç½®è°ƒè¯•åŠŸèƒ½"><a href="#5-3é…ç½®è°ƒè¯•åŠŸèƒ½" class="headerlink" title="5.3é…ç½®è°ƒè¯•åŠŸèƒ½"></a>5.3é…ç½®è°ƒè¯•åŠŸèƒ½</h2><p>é¦–å…ˆå¤§å®¶åœ¨ä¸€ä¸ªä½ å¸Œæœ›çš„ä½ç½®å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œéšæ„èµ·åå°±å¯ä»¥ï¼ˆæ³¨æ„ä¸å¯ä»¥ç”¨ä¸­æ–‡ï¼ï¼‰ï¼Œä»¥åçš„C&#x2F;C++ä»£ç æ–‡ä»¶éƒ½è¦æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œæ‰å¯ä»¥æ­£å¸¸è°ƒè¯•ã€‚</p>
<p>ç„¶åè¿›å…¥VSCode,ç‚¹å‡»Open Folderæˆ–è€…ç‚¹å‡»å·¦ä¸Šè§’File -&gt; Open Folderï¼Œç„¶åæ‰“å¼€åˆšåˆšå»ºçš„æ–‡ä»¶å¤¹ï¼Œé€‰æ‹©ä¿¡ä»»çˆ¶çº§æ–‡ä»¶å¤¹ç‚¹å‡»è¿™ä¸ªå›¾æ ‡æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå‘½åä¸º.vscodeï¼ˆæ³¨æ„å¿…é¡»æ˜¯è¿™ä¸ªåå­—ï¼ï¼‰</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312052146527.png" alt="image-20231205214658480"></p>
<p>åˆ›å»ºå®Œæˆåå†ç‚¹å‡»è¿™ä¸ªå›¾æ ‡æ–°å»ºå››ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶ååˆ†åˆ«æ˜¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//c_cpp_properties.json</span><br><span class="line">//launch.json</span><br><span class="line">//settings.json</span><br><span class="line">//tasks.json</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312052148993.png" alt="image-20231205214844970"></p>
<p>æ¥ä¸‹æ¥å¤åˆ¶ç²˜è´´è¿™å››ä¸ªæ–‡ä»¶çš„å†…å®¹ </p>
<p>é¦–å…ˆæ˜¯c_cpp_properties.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Win64&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;includePath&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;$&#123;workspaceFolder&#125;/**&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;defines&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;_DEBUG&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;UNICODE&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;_UNICODE&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;windowsSdkVersion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.0.18362.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;compilerPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;D:/mingw64/bin/gcc.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cStandard&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c17&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cppStandard&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c++17&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;intelliSenseMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gcc-x64&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>


<p>æ³¨æ„compilerPathè¿™ä¸€é¡¹è¦æŠŠè·¯å¾„æ”¹æˆåˆšæ‰g++çš„å®‰è£…è·¯å¾„ï¼šæ‰¾åˆ°åˆšåˆšçš„å®‰è£…æ–‡ä»¶å¤¹-&gt;MinGW-&gt;bin-&gt;g++,exe ,ç„¶åå¤åˆ¶æˆ–è€…æ‰‹åŠ¨æŠŠg++.exeçš„è·¯å¾„æ•²ä¸Šå»ï¼Œæ ¼å¼è¦è·Ÿä¸Šé¢ä»£ç æ®µä¸€æ ·</p>
<p>ç„¶åæ˜¯launch.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(gdb) Launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cppdbg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;fileDirname&#125;\\$&#123;fileBasenameNoExtension&#125;.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;stopAtEntry&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceRoot&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;environment&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;externalConsole&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;MIMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;miDebuggerPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;D:\\mingw64\\bin\\gdb.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;preLaunchTask&quot;</span><span class="punctuation">:</span> <span class="string">&quot;g++&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;setupCommands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Enable pretty-printing for gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-enable-pretty-printing&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ignoreFailures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>


<p>æ³¨æ„miDebuggerPathè¿™ä¸€é¡¹ä¹Ÿè¦æŠŠè·¯å¾„æ”¹æˆåˆšæ‰g++çš„å®‰è£…è·¯å¾„ï¼šæ‰¾åˆ°åˆšåˆšçš„å®‰è£…æ–‡ä»¶å¤¹-&gt;MinGW-&gt;bin-&gt;gdb,exe ,ç„¶åå¤åˆ¶æˆ–è€…æ‰‹åŠ¨æŠŠgdb.exeçš„è·¯å¾„æ•²ä¸Šå»ï¼Œæ ¼å¼è¦è·Ÿä¸Šé¢ä»£ç æ®µä¸€æ ·</p>
<p> æ¥ä¸‹æ¥æ˜¯settings.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;files.associations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;*.py&quot;</span><span class="punctuation">:</span> <span class="string">&quot;python&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;iostream&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*.tcc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;string&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;unordered_map&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ostream&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;new&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;typeinfo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deque&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;initializer_list&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;iosfwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fstream&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sstream&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;map&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;stdio.h&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;algorithm&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;atomic&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;bit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cctype&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;clocale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cmath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;compare&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;concepts&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cstddef&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cstdint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cstdio&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cstdlib&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cstring&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ctime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cwchar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;exception&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ios&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;istream&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;iterator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;limits&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;memory&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;random&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;set&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;stack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;stdexcept&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;streambuf&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;system_error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tuple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type_traits&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;utility&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;xfacet&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;xiosbase&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;xlocale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;xlocinfo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;xlocnum&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;xmemory&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;xstddef&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;xstring&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;xtr1common&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;xtree&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;xutility&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;stdlib.h&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;string.h&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;editor.suggest.snippetsPreventQuickSuggestions&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;aiXcoder.showTrayIcon&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>


<p> æœ€åæ˜¯tasks.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tasks&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;g++&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;g++&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;-g&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;$&#123;file&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-o&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;$&#123;fileDirname&#125;/$&#123;fileBasenameNoExtension&#125;.exe&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;problemMatcher&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;owner&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fileLocation&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;relative&quot;</span><span class="punctuation">,</span> <span class="string">&quot;$&#123;workspaceRoot&#125;&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pattern&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;regexp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^(.*):(\\d+):(\\d+):\\s+(warning|error):\\s+(.*)$&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;file&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;line&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;column&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;severity&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;build&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;isDefault&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span> </span><br></pre></td></tr></table></figure>

<p>ä¿å­˜è¿™å››ä¸ªæ–‡ä»¶å°±é…ç½®å®Œæˆäº†ï¼</p>
<p>å†æ¬¡å¼ºè°ƒï¼šä»¥åçš„C&#x2F;C++ä»£ç æ–‡ä»¶å¿…é¡»æ”¾åœ¨è¿™ä¸ªCodeæ–‡ä»¶å¤¹é‡Œï¼Œæˆ–è€…è¯´æœ‰.vscodeæ–‡ä»¶å¤¹çš„æ–‡ä»¶å¤¹é‡Œï¼Œå¦‚æœè°ƒè¯•æ”¾åœ¨å…¶ä»–ä½ç½®çš„ä»£ç æ–‡ä»¶ä¼šæŠ¥é”™ï¼</p>
<p>æµ‹è¯•å®Œæˆå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312052214005.png" alt="image-20231205221434929"></p>
<h1 id="6-opencvçš„å­¦ä¹ "><a href="#6-opencvçš„å­¦ä¹ " class="headerlink" title="6.opencvçš„å­¦ä¹ "></a>6.opencvçš„å­¦ä¹ </h1><h2 id="6-1-è¯»å–å›¾ç‰‡å¹¶æ˜¾ç¤º"><a href="#6-1-è¯»å–å›¾ç‰‡å¹¶æ˜¾ç¤º" class="headerlink" title="6.1 è¯»å–å›¾ç‰‡å¹¶æ˜¾ç¤º"></a>6.1 è¯»å–å›¾ç‰‡å¹¶æ˜¾ç¤º</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å›¾ç‰‡çš„è¯»å–å’Œæ˜¾ç¤º</span></span><br><span class="line"><span class="comment">// å¯¼å…¥opencvå¤´æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/opencv.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è¯»å–å›¾ç‰‡ï¼Œmatæ˜¯matrixçš„ç¼©å†™ï¼Œæ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œç±»ä¼¼ä¸numpy ndarray</span></span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;E:\\05_opencv\\work\\src\\cat.jpg&quot;</span>);</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦è¯»å–æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> (image.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æ— æ³•è¯»å–å›¾ç‰‡ &quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰“å°å›¾ç‰‡é«˜åº¦å’Œå®½åº¦</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;å›¾ç‰‡é«˜åº¦: &quot;</span> &lt;&lt; image.rows &lt;&lt; <span class="string">&quot; å®½åº¦: &quot;</span> &lt;&lt; image.cols &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°å›¾ç‰‡data</span></span><br><span class="line">    <span class="comment">// ä»¥Numpyçš„æ–¹å¼æ‰“å°</span></span><br><span class="line">    <span class="comment">// std::cout &lt;&lt; &quot;å›¾ç‰‡data: &quot; &lt;&lt; cv::format(image, cv::Formatter::FMT_NUMPY) &lt;&lt; std::endl;</span></span><br><span class="line">    <span class="comment">// ä»¥python listçš„æ–¹å¼æ‰“å°</span></span><br><span class="line">    <span class="comment">// std::cout &lt;&lt; &quot;å›¾ç‰‡data: &quot; &lt;&lt; cv::format(image, cv::Formatter::FMT_PYTHON) &lt;&lt; std::endl;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªç°åº¦å›¾</span></span><br><span class="line">    cv::Mat gray;</span><br><span class="line">    <span class="comment">// è½¬æ¢ä¸ºç°åº¦å›¾</span></span><br><span class="line">    cv::<span class="built_in">cvtColor</span>(image, gray, cv::COLOR_BGR2GRAY);</span><br><span class="line">    <span class="comment">// ä¿å­˜</span></span><br><span class="line">    cv::<span class="built_in">imwrite</span>(<span class="string">&quot;gray.jpg&quot;</span>, gray);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¾ç¤º</span></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;åŸå›¾&quot;</span>, image);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;ç°åº¦å›¾&quot;</span>, gray);</span><br><span class="line">    <span class="comment">// ç­‰å¾…æŒ‰é”®</span></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡åˆ°çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œç¬¬9è¡Œçš„è·¯å¾„é—®é¢˜ï¼Œåœ¨windowsç›®å½•ä¸‹å¿…é¡»è¦ä½¿ç”¨ä¸¤ä¸ª\ä¸çŸ¥é“è¿™æ˜¯ä¸ºå•¥</p>
<p>åœ¨Windowsç›®å½•ä¸­ï¼Œåæ–œæ  <code>\</code> æ˜¯ç”¨ä½œè·¯å¾„åˆ†éš”ç¬¦ã€‚ç„¶è€Œï¼Œåæ–œæ åœ¨C++ä¸­è¢«ç”¨ä½œè½¬ä¹‰å­—ç¬¦ï¼Œç”¨äºè¡¨ç¤ºç‰¹æ®Šå­—ç¬¦åºåˆ—ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³åœ¨å­—ç¬¦ä¸²ä¸­ä½¿ç”¨åæ–œæ ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦ï¼Œæ‚¨éœ€è¦ä½¿ç”¨åŒåæ–œæ  <code>\\</code> æ¥è¡¨ç¤ºä¸€ä¸ªå•ç‹¬çš„åæ–œæ ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºä¸€ä¸ªåæ–œæ  <code>\</code> è¡¨ç¤ºä¸€ä¸ªè½¬ä¹‰å­—ç¬¦çš„å¼€å§‹ï¼Œä¾‹å¦‚ <code>\n</code> è¡¨ç¤ºæ¢è¡Œç¬¦ã€‚ä¸ºäº†åœ¨å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºä¸€ä¸ªåæ–œæ å­—ç¬¦æœ¬èº«ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ä¸¤ä¸ªè¿ç»­çš„åæ–œæ  <code>\\</code> æ¥è½¬ä¹‰å®ƒï¼Œå‘Šè¯‰ç¼–è¯‘å™¨å®ƒæ˜¯ä¸€ä¸ªæ™®é€šçš„åæ–œæ å­—ç¬¦ã€‚</p>
<p>æ²¡æœ‰è‡ªåŠ¨è¡¥å…¨ï¼Œé‡æ–°ç¡®å®šä¸€ä¸‹æ’ä»¶ï¼š<br>1)ã€C&#x2F;C++ï¼Œè¿™ä¸ªè‚¯å®šæ˜¯å¿…é¡»çš„ã€‚</p>
<p>2)ã€C&#x2F;C++ Snippetsï¼Œå³ C&#x2F;C++é‡ç”¨ä»£ç å—ã€‚</p>
<p>3)ã€C&#x2F;C++ Advanced Lint,å³ C&#x2F;C++é™æ€æ£€æµ‹ ã€‚</p>
<p>4)ã€Code Runnerï¼Œå³ä»£ç è¿è¡Œã€‚</p>
<p>5)ã€Include AutoCompleteï¼Œå³è‡ªåŠ¨å¤´æ–‡ä»¶åŒ…å«ã€‚</p>
<p>6)ã€Rainbow Bracketsï¼Œå½©è™¹èŠ±æ‹¬å·ï¼Œæœ‰åŠ©äºé˜…è¯»ä»£ç ã€‚</p>
<p>7)ã€One Dark Proï¼ŒVSCode çš„ä¸»é¢˜ã€‚</p>
<p>8)ã€GBKtoUTF8ï¼Œå°† GBK è½¬æ¢ä¸º UTF8ã€‚ </p>
<p>9)ã€ARMï¼Œå³æ”¯æŒ ARM æ±‡ç¼–è¯­æ³•é«˜äº®æ˜¾ç¤ºã€‚</p>
<p>10)ã€Chinese(Simplified)ï¼Œå³ä¸­æ–‡ç¯å¢ƒã€‚</p>
<p>11)ã€vscode-iconsï¼ŒVSCode å›¾æ ‡æ’ä»¶ï¼Œä¸»è¦æ˜¯èµ„æºç®¡ç†å™¨ä¸‹å„ä¸ªæ–‡ä»¶å¤¹çš„å›¾æ ‡ã€‚</p>
<p>12)ã€compareitï¼Œæ¯”è¾ƒæ’ä»¶ï¼Œå¯ä»¥ç”¨äºæ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶çš„å·®å¼‚ã€‚</p>
<p>13)ã€DeviceTreeï¼Œè®¾å¤‡æ ‘è¯­æ³•æ’ä»¶ã€‚</p>
<p>14)ã€CMake Tools Cmake å·¥å…·</p>
<p>&#x3D;&#x3D;è¿˜æ˜¯ä¸èƒ½è¡¥å…¨ï¼Œä¸çŸ¥é“ä¸ºå•¥windowsçš„ç¯å¢ƒä¼šè¿™æ ·ï¼Œè¿™æ ·ä¸‹å»å¯ä¸è¡Œï¼Œé—®é¢˜è¯¥è§£å†³çš„å½“ç„¶è¿˜æ˜¯è¦è§£å†³çš„ï¼Œé‡åˆ°é—®é¢˜è§£å†³é—®é¢˜&#x3D;&#x3D;</p>
<p>ä¸Šé¢è¿™ä¸ªæ¡ˆä¾‹æœ‰ä»¥ä¸‹å‡ ä¸ªé‡ç‚¹æˆ‘æ¥å›é¡¾ä¸€ä¸‹</p>
<ol>
<li>å¤´æ–‡ä»¶</li>
</ol>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨c++å’Œopencvéƒ½ä¼šåŒ…å«ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªå¤´æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯&lt;opencv2&#x2F;opencv.hpp&gt;å’Œ<iostream>è¿™ä¸¤ä¸ªå¤´æ–‡ä»¶ã€‚</p>
<p>&lt;opencv&#x2F;opencv.hpp&gt;ä¸­åŒ…å«äº†ä¸€äº›opencvä¸­çš„å¸¸ç”¨å‡½æ•°ï¼Œå°±æ¯”å¦‚imreadã€imwriteã€imshowã€waitkeyã€cvtColorç­‰ç­‰ï¼Œè€Œ<iostream>ä¸­å­˜æ”¾çš„æ˜¯c++ä¸­çš„ä¸€äº›å¸¸ç”¨å‡½æ•°ï¼Œå°±æ¯”å¦‚coutè¾“å‡ºç­‰ç­‰ã€‚</p>
<ol start="2">
<li>å·¥ä½œåŒºusing namespace</li>
</ol>
<p>å¦‚æœæ˜¯æˆ‘ä¸€èˆ¬å†™Cè¯­è¨€çš„è¯ï¼Œæˆ‘éƒ½ä¼šå†™ä¸Šå·¥ä½œåŒºï¼Œä½†æ˜¯è€å¸ˆç»™çš„è¿™äº›ç¤ºä¾‹ä»£ç å¹¶æ²¡æœ‰ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨çš„å°±æ¯”å¦‚cv::imread() std::coutè¿™äº›ï¼Œéƒ½æ˜¯åœ¨å‰åŠ ä¸Šå·¥ä½œå»ï¼Œç„¶åå†å¼•ç”¨çš„ï¼Œè¿™æ ·çš„å¥½å¤„åº”è¯¥æ˜¯é˜²æ­¢æ··ä¹±å¼•ç”¨ï¼Œç›®å‰æˆ‘è¿˜æ²¡é‡åˆ°è¿™ä¸ªæƒ…å†µï¼Œè¿™ä¸ªä»¥åå†è¯´ã€‚</p>
<ol start="3">
<li><p>opencvå›¾åƒçš„æ ¼å¼Mat</p>
<p>æ²¡è®°é”™çš„è¯è¿™ä¸ªMatæ ¼å¼ç”¨æ¥å­˜æ”¾çš„æ˜¯RGBä¸‰åŸè‰²æ¯ä¸ªåƒç´ çš„å€¼</p>
</li>
<li><p>ç›¸å…³å‡½æ•°çš„ä½¿ç”¨</p>
</li>
</ol>
<p>cv::imread ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦è¯»å–å›¾ç‰‡çš„è·¯å¾„ã€ç¬¬äºŒä¸ªå‚æ•°ä¸ºflagæ ‡å¿—ä½æˆ‘è®°å¾—æ˜¯0 1 -1ï¼Œè¿™ä¸‰ä¸ªæœ€å¸¸ç”¨ï¼Œå…¶ä¸­0ä»£è¡¨ç°åº¦å€¼ï¼Œ1ä»£è¡¨å½©è‰²ã€‚</p>
<p>cv::imwrite è¿™ä¸ªæ˜¯ç”¨æ¥å†™å…¥çš„ï¼Œå…¶å®è·Ÿè¯»å–çš„ä½¿ç”¨æ–¹æ³•ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦ä¿å­˜çš„å›¾ç‰‡åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå›¾ç‰‡çš„æ•°æ®ï¼Œæ²¡æœ‰æ•°æ®ä½ åªä¿å­˜åå­—é‚£è‚¯å®šä¸è¡Œå‘€ã€‚</p>
<p>cv::imshow ä»åå­—å¯ä»¥çœ‹å‡ºæ¥è¿™æ˜¯å›¾ç‰‡çš„å±•ç¤ºï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå±•ç¤ºå›¾ç‰‡çš„æ¡†çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå›¾ç‰‡æ•°æ®ï¼ŒåŒç†ï¼Œä½ åªæ˜¾ç¤ºæ¡†çš„åç§°ï¼Œä½†æ˜¯æ²¡æœ‰æ•°æ®æ‹¿ä»€ä¹ˆä¹Ÿæ˜¾ç¤ºä¸å‡ºæ¥å‘€ï¼Œæˆ‘è¯´çš„å¯¹å—.</p>
<p>cv::cvtColor è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥è¿›è¡Œé¢œè‰²é€šé“è½¬æ¢çš„ï¼Œå°±æ¯”å¦‚ä»RGBè½¬æ¢ä¸ºBGRç­‰ç­‰ï¼Œä½ å¯ä»¥æ€è€ƒä¸€ä¸‹åº”è¯¥æœ‰å‡ ä¸ªå‚æ•°ï¼Œä½ çœ‹è¦è½¬æ¢è‚¯å®šè¦æœ‰ä¸€ä¸ªåŸå§‹æ•°æ®å¯¹å§ï¼Œç„¶åè‚¯å®šæœ‰ä¸€ä¸ªè¾“å‡ºæ•°æ®å¯¹å§ï¼Œæœ€åå¿…ç„¶è¦æœ‰ä¸€ä¸ªå¦‚ä½•è½¬æ¢å¯¹å§ï¼Œæ‰€ä»¥å¿…è¦å¡«å†™çš„æ˜¯ä¸‰ä¸ªå‚æ•°ã€‚</p>
<p>æœ€åæ˜¯cv::waitKey(0)è¿™ä¸ªå‡½æ•°çš„æ„ä¹‰æ˜¯è®©å›¾ç‰‡ä¸€ç›´æ˜¾ç¤ºï¼Œç›´åˆ°æŒ‰ä¸‹ä¸€ä¸ªæŒ‰é”®ã€‚</p>
<h2 id="6-2-è¯»å–è§†é¢‘å¹¶æ˜¾ç¤º"><a href="#6-2-è¯»å–è§†é¢‘å¹¶æ˜¾ç¤º" class="headerlink" title="6.2 è¯»å–è§†é¢‘å¹¶æ˜¾ç¤º"></a>6.2 è¯»å–è§†é¢‘å¹¶æ˜¾ç¤º</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥opencv åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥gflags åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;gflags/gflags.h&gt;</span></span></span><br><span class="line"><span class="comment">// å®šä¹‰å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line"><span class="built_in">DEFINE_string</span>(video, <span class="string">&quot;./media/dog.mp4&quot;</span>, <span class="string">&quot;Input video&quot;</span>); <span class="comment">// è§†é¢‘è·¯å¾„</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è§£æå‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line">    gflags::<span class="built_in">ParseCommandLineFlags</span>(&amp;argc, &amp;argv, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// è¯»å–è§†é¢‘ï¼šåˆ›å»ºäº†ä¸€ä¸ªVideoCaptureå¯¹è±¡ï¼Œå‚æ•°ä¸ºè§†é¢‘è·¯å¾„</span></span><br><span class="line">    <span class="function">cv::VideoCapture <span class="title">capture</span><span class="params">(FLAGS_video)</span></span>;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­è§†é¢‘æ˜¯å¦è¯»å–æˆåŠŸï¼Œè¿”å›trueè¡¨ç¤ºæˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> (!capture.<span class="built_in">isOpened</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æ— æ³•è¯»å–è§†é¢‘: &quot;</span> &lt;&lt; FLAGS_video &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¯»å–è§†é¢‘å¸§ï¼Œä½¿ç”¨Matç±»å‹çš„frameå­˜å‚¨è¿”å›çš„å¸§</span></span><br><span class="line">    cv::Mat frame;</span><br><span class="line">    <span class="comment">// ç°åº¦å›¾</span></span><br><span class="line">    cv::Mat gray_frame;</span><br><span class="line">    <span class="comment">// å¾ªç¯è¯»å–è§†é¢‘å¸§</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è¯»å–è§†é¢‘å¸§ï¼Œä½¿ç”¨ &gt;&gt; è¿ç®—ç¬¦æˆ–è€…read()å‡½æ•°ï¼Œä»–çš„å‚æ•°æ˜¯è¿”å›çš„å¸§</span></span><br><span class="line">        capture.<span class="built_in">read</span>(frame);</span><br><span class="line">        <span class="comment">// capture &gt;&gt; frame;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦è¯»å–æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span> (frame.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;æ–‡ä»¶è¯»å–å®Œæ¯•&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è½¬æˆç°åº¦å›¾</span></span><br><span class="line">        cv::<span class="built_in">cvtColor</span>(frame, gray_frame, cv::COLOR_BGR2GRAY);</span><br><span class="line">        <span class="comment">// æ˜¾ç¤ºè§†é¢‘å¸§</span></span><br><span class="line">        cv::<span class="built_in">imshow</span>(<span class="string">&quot;raw frame&quot;</span>, frame);</span><br><span class="line">        cv::<span class="built_in">imshow</span>(<span class="string">&quot;gray frame&quot;</span>, gray_frame);</span><br><span class="line">        <span class="comment">// ç­‰å¾…æŒ‰é”®ï¼Œå»¶è¿Ÿ30msï¼Œå¦åˆ™è§†é¢‘æ’­æ”¾å¤ªå¿«</span></span><br><span class="line">        <span class="type">int</span> k = cv::<span class="built_in">waitKey</span>(<span class="number">30</span>);</span><br><span class="line">        <span class="comment">// æŒ‰ä¸‹ESCé”®é€€å‡º</span></span><br><span class="line">        <span class="keyword">if</span> (k == <span class="number">27</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;é€€å‡º&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹1ï¼šVideoCaptureç±»</p>
<p>â€‹	å°±è·Ÿä¸Šä¸€ä¸ªå°èŠ‚è®²è§£çš„Matä¸€æ ·ï¼Œå¯ä»¥çœ‹åˆ°VideoCaptureçš„ç¬¬ä¸€ä¸ªå­—æ¯ä¹Ÿå¤§å†™äº†ï¼Œæ‰€ä»¥ä»–ä¹Ÿæ˜¯ä¸€ä¸ªopencvä¸­çš„ç±»å‹ï¼Œç”¨æ¥å­˜æ”¾æ•è·åˆ°çš„è§†é¢‘ï¼Œ<code>cv::VideoCapture</code> ç±»çš„æ„é€ å‡½æ•°å¯ä»¥æ¥å—ä¸åŒçš„å‚æ•°æ¥æŒ‡å®šè¦æ‰“å¼€çš„è§†é¢‘æºï¼š</p>
<p>1.é€šè¿‡è®¾å¤‡ç´¢å¼•ï¼šæ‚¨å¯ä»¥ä¼ é€’ä¸€ä¸ªæ•´æ•°å€¼ä½œä¸ºè®¾å¤‡ç´¢å¼•æ¥æŒ‡å®šè¦æ‰“å¼€çš„æ‘„åƒå¤´è®¾å¤‡ã€‚ä¾‹å¦‚ï¼Œ<code>0</code> è¡¨ç¤ºé»˜è®¤çš„æ‘„åƒå¤´è®¾å¤‡ï¼Œ<code>1</code> è¡¨ç¤ºç¬¬äºŒä¸ªæ‘„åƒå¤´è®¾å¤‡ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cv::VideoCapture cap(0); // æ‰“å¼€é»˜è®¤çš„æ‘„åƒå¤´è®¾å¤‡</span><br></pre></td></tr></table></figure>

<p>2.é€šè¿‡è§†é¢‘æ–‡ä»¶è·¯å¾„ï¼šæ‚¨å¯ä»¥ä¼ é€’ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œè¡¨ç¤ºè¦æ‰“å¼€çš„è§†é¢‘æ–‡ä»¶çš„è·¯å¾„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cv::VideoCapture cap(&quot;video.mp4&quot;); // æ‰“å¼€åä¸º &quot;video.mp4&quot; çš„è§†é¢‘æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<p>ä¸€æ—¦åˆ›å»ºäº† <code>cv::VideoCapture</code> å¯¹è±¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>read()</code> æ–¹æ³•æ¥è¿ç»­è¯»å–è§†é¢‘å¸§ã€‚<code>read()</code> æ–¹æ³•å°†è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºæ˜¯å¦æˆåŠŸè¯»å–äº†ä¸€å¸§å›¾åƒã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">cv::Mat frame;</span><br><span class="line"><span class="keyword">while</span> (cap.<span class="built_in">read</span>(frame)) &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†å½“å‰å¸§</span></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;Video&quot;</span>, frame);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…æŒ‰é”®é€€å‡º</span></span><br><span class="line">    <span class="keyword">if</span> (cv::<span class="built_in">waitKey</span>(<span class="number">1</span>) == <span class="string">&#x27;q&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
  </entry>
  <entry>
    <title>ubuntuå’Œdebianæº</title>
    <url>/2023/12/03/20%20ubuntu%E5%92%8Cdebian%E6%BA%90/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ubuntu20</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deb https://repo.huaweicloud.com/ubuntu-ports/ focal main restricted universe multiverse</span><br><span class="line">deb-src https://repo.huaweicloud.com/ubuntu-ports/ focal main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://repo.huaweicloud.com/ubuntu-ports/ focal-security main restricted universe multiverse</span><br><span class="line">deb-src https://repo.huaweicloud.com/ubuntu-ports/ focal-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://repo.huaweicloud.com/ubuntu-ports/ focal-updates main restricted universe multiverse</span><br><span class="line">deb-src https://repo.huaweicloud.com/ubuntu-ports/ focal-updates main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://repo.huaweicloud.com/ubuntu-ports/ focal-backports main restricted universe multiverse</span><br><span class="line">deb-src https://repo.huaweicloud.com/ubuntu-ports/ focal-backports main restricted universe multiverse</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Not recommended</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deb https://repo.huaweicloud.com/ubuntu-ports/ focal-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deb-src https://repo.huaweicloud.com/ubuntu-ports/ focal-proposed main restricted universe multiverse</span></span><br></pre></td></tr></table></figure>

<p>ubuntu22</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deb https://repo.huaweicloud.com/ubuntu-ports/ jammy main restricted universe multiverse</span><br><span class="line">deb-src https://repo.huaweicloud.com/ubuntu-ports/ jammy main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://repo.huaweicloud.com/ubuntu-ports/ jammy-updates main restricted universe multiverse</span><br><span class="line">deb-src https://repo.huaweicloud.com/ubuntu-ports/ jammy-updates main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://repo.huaweicloud.com/ubuntu-ports/ jammy-backports main restricted universe multiverse</span><br><span class="line">deb-src https://repo.huaweicloud.com/ubuntu-ports/ jammy-backports main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://repo.huaweicloud.com/ubuntu-ports/ jammy-security main restricted universe multiverse</span><br><span class="line">deb-src https://repo.huaweicloud.com/ubuntu-ports/ jammy-security main restricted universe multiverse</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Not recommended</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deb http://ports.ubuntu.com/ubuntu-ports/ jammy-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deb-src http://ports.ubuntu.com/ubuntu-ports/ jammy-proposed main restricted universe multiverse</span></span><br></pre></td></tr></table></figure>

<p>debian10</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deb https://mirrors.huaweicloud.com/repository/debian/ buster main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free</span><br><span class="line">deb https://mirrors.huaweicloud.com/repository/debian/ buster-updates main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free</span><br><span class="line">deb https://mirrors.huaweicloud.com/repository/debian/ buster-backports main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free</span><br><span class="line">deb https://mirrors.huaweicloud.com/repository/debian-security buster/updates main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free</span><br></pre></td></tr></table></figure>

<p>debian11</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deb https://mirrors.huaweicloud.com/debian/ bullseye main non-free contrib</span><br><span class="line">deb-src https://mirrors.huaweicloud.com/debian/ bullseye main non-free contrib</span><br><span class="line">deb https://mirrors.huaweicloud.com/debian-security/ bullseye-security main</span><br><span class="line">deb-src https://mirrors.huaweicloud.com/debian-security/ bullseye-security main</span><br><span class="line">deb https://mirrors.huaweicloud.com/debian/ bullseye-updates main non-free contrib</span><br><span class="line">deb-src https://mirrors.huaweicloud.com/debian/ bullseye-updates main non-free contrib</span><br><span class="line">deb https://mirrors.huaweicloud.com/debian/ bullseye-backports main non-free contrib</span><br><span class="line">deb-src https://mirrors.huaweicloud.com/debian/ bullseye-backports main non-free contrib</span><br></pre></td></tr></table></figure>

<p>debian12</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deb https://mirrors.huaweicloud.com/debian/ bookworm main non-free non-free-firmware contrib </span><br><span class="line">deb-src https://mirrors.huaweicloud.com/debian/ bookworm main non-free non-free-firmware contrib</span><br><span class="line">deb https://mirrors.huaweicloud.com/debian-security/ bookworm-security main </span><br><span class="line">deb-src https://mirrors.huaweicloud.com/debian-security/ bookworm-security main </span><br><span class="line">deb https://mirrors.huaweicloud.com/debian/ bookworm-updates main non-free non-free-firmware contrib </span><br><span class="line">deb-src https://mirrors.huaweicloud.com/debian/ bookworm-updates main non-free non-free-firmware contrib </span><br><span class="line">deb https://mirrors.huaweicloud.com/debian/ bookworm-backports main non-free non-free-firmware contrib </span><br><span class="line">deb-src https://mirrors.huaweicloud.com/debian/ bookworm-backports main non-free non-free-firmware contrib </span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ç‘èŠ¯å¾®</category>
      </categories>
  </entry>
  <entry>
    <title>shellè„šæœ¬å­¦ä¹ </title>
    <url>/2023/12/02/19%20shell%E8%84%9A%E6%9C%AC%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä¸€ã€shell-å…¥é—¨ç®€ä»‹"><a href="#ä¸€ã€shell-å…¥é—¨ç®€ä»‹" class="headerlink" title="ä¸€ã€shell å…¥é—¨ç®€ä»‹"></a>ä¸€ã€shell å…¥é—¨ç®€ä»‹</h1><h2 id="1-1-ä»€ä¹ˆæ˜¯shell"><a href="#1-1-ä»€ä¹ˆæ˜¯shell" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯shell"></a>1.1 ä»€ä¹ˆæ˜¯shell</h2><p><strong>ä»€ä¹ˆæ˜¯shell</strong></p>
<p>ç½‘ä¸Šæœ‰å¾ˆå¤šshell çš„æ¦‚å¿µä»‹ç»ï¼Œå…¶å®éƒ½å¾ˆå®˜æ–¹åŒ–ï¼Œå¦‚æœä½ å¯¹linux å‘½ä»¤å¾ˆç†Ÿæ‚‰ï¼Œé‚£ä¹ˆç¼–å†™shell å°±ä¸æ˜¯ä¸€ä¸ªéš¾äº‹ï¼Œshell æœ¬è´¨ä¸Šæ˜¯ linux å‘½ä»¤ï¼Œä¸€æ¡ä¸€æ¡å‘½ä»¤ç»„åˆåœ¨ä¸€èµ·ï¼Œå®ç°æŸä¸€ä¸ªç›®çš„ï¼Œå°±å˜æˆäº†shellè„šæœ¬ã€‚å®ƒä»ä¸€å®šç¨‹åº¦ä¸Š å‡è½»äº†å·¥ä½œé‡ï¼Œæé«˜äº†å·¥ä½œæ•ˆç‡ã€‚</p>
<p><strong>å®˜æ–¹åŒ–çš„shell ä»‹ç»</strong></p>
<p>Shellï¼ˆä¹Ÿç§°ä¸ºå‘½ä»¤è¡Œè§£é‡Šå™¨æˆ–å‘½ä»¤è¡Œå¤–å£³ï¼‰æ˜¯è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸­æä¾›ä¸ç”¨æˆ·äº¤äº’çš„ä¸€ç§ç”¨æˆ·ç•Œé¢ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡é”®å…¥æ–‡æœ¬å‘½ä»¤æ¥ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œé€šä¿¡å’Œæ§åˆ¶ã€‚Shellæ¥å—ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤å¹¶å°†å…¶è§£é‡Šä¸ºæ“ä½œç³»ç»Ÿå¯ä»¥ç†è§£å’Œæ‰§è¡Œçš„æŒ‡ä»¤ã€‚</p>
<p>Shellæ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šå™¨ï¼Œå®ƒå¯ä»¥è§£é‡Šå’Œæ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ã€‚å®ƒæä¾›äº†ä¸€ç§æ–¹å¼ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿç›´æ¥ä¸è®¡ç®—æœºçš„æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œè€Œæ— éœ€ä¾èµ–å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰æˆ–å…¶ä»–å¯è§†åŒ–å·¥å…·ã€‚</p>
<p>Shellçš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ol>
<li>å‘½ä»¤æ‰§è¡Œï¼šShellæ¥å—ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™æ“ä½œç³»ç»Ÿæ‰§è¡Œã€‚è¿™äº›å‘½ä»¤å¯ä»¥æ˜¯æ“ä½œæ–‡ä»¶ã€ç®¡ç†è¿›ç¨‹ã€æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€ç¼–è¯‘ä»£ç ç­‰ã€‚</li>
<li>ç¯å¢ƒæ§åˆ¶ï¼šShellå¯ä»¥è®¾ç½®å’Œç®¡ç†æ“ä½œç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ã€è·¯å¾„å’Œå…¶ä»–ç³»ç»Ÿé…ç½®ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨Shellæ¥è‡ªå®šä¹‰å…¶å·¥ä½œç¯å¢ƒå’Œè¡Œä¸ºã€‚</li>
<li>è„šæœ¬ç¼–å†™ï¼šShellæä¾›äº†ä¸€ç§è„šæœ¬ç¼–å†™çš„èƒ½åŠ›ï¼Œç”¨æˆ·å¯ä»¥ç¼–å†™ä¸€ç³»åˆ—çš„å‘½ä»¤å’Œæ“ä½œï¼Œä»¥ä¾¿è‡ªåŠ¨åŒ–ä»»åŠ¡ã€æ‰¹å¤„ç†å¤„ç†æ•°æ®ã€æ‰§è¡Œå¤æ‚çš„æ“ä½œæµç¨‹ç­‰ã€‚</li>
<li>è¾“å…¥&#x2F;è¾“å‡ºé‡å®šå‘ï¼šShellå…è®¸ç”¨æˆ·å°†å‘½ä»¤çš„è¾“å…¥å’Œè¾“å‡ºé‡å®šå‘åˆ°ä¸åŒçš„æ–‡ä»¶æˆ–è®¾å¤‡ã€‚è¿™ä½¿å¾—ç”¨æˆ·å¯ä»¥é€šè¿‡ç®¡é“ï¼ˆpipeï¼‰å’Œé‡å®šå‘ï¼ˆredirectionï¼‰ç­‰æŠ€æœ¯ï¼Œå°†ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºå¦ä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥ï¼Œæˆ–å°†è¾“å‡ºä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚</li>
</ol>
<p><strong>å¸¸è§çš„shell æœ‰å“ªäº›</strong></p>
<pre><code>Bourne Shellï¼ˆ/usr/bin/shæˆ–/bin/shï¼‰
Bourne Again Shellï¼ˆ/bin/bashï¼‰
C Shellï¼ˆ/usr/bin/cshï¼‰
K Shellï¼ˆ/usr/bin/kshï¼‰
Shell for Rootï¼ˆ/sbin/shï¼‰
</code></pre>
<p>æœ€å¸¸ç”¨çš„shellæ˜¯Bashï¼Œä¹Ÿå°±æ˜¯Bourne Again Shellã€‚Bashç”±äºæ˜“ç”¨å’Œå…è´¹ï¼Œåœ¨æ—¥å¸¸å·¥ä½œä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œä¹Ÿæ˜¯å¤§å¤šæ•°Linuxæ“ä½œç³»ç»Ÿé»˜è®¤çš„Shellç¯å¢ƒã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042108406.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h2 id="1-2-shell-ç¼–ç¨‹æ³¨æ„äº‹é¡¹"><a href="#1-2-shell-ç¼–ç¨‹æ³¨æ„äº‹é¡¹" class="headerlink" title="1.2 shell ç¼–ç¨‹æ³¨æ„äº‹é¡¹"></a>1.2 shell ç¼–ç¨‹æ³¨æ„äº‹é¡¹</h2><p>å½“è¿›è¡ŒShellç¼–ç¨‹æ—¶ï¼Œæœ‰ä¸€äº›æ³¨æ„äº‹é¡¹éœ€è¦æ³¨æ„ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„Shellç¼–ç¨‹æ³¨æ„äº‹é¡¹ï¼š</p>
<ol>
<li>Shellè„šæœ¬å‘½åï¼šShellè„šæœ¬çš„æ–‡ä»¶åé€šå¸¸åº”è¯¥ä½¿ç”¨è‹±æ–‡ï¼Œå¯ä»¥ä½¿ç”¨å¤§å†™æˆ–å°å†™å­—æ¯ï¼Œå¹¶ä»¥<code>.sh</code>ä½œä¸ºåç¼€ã€‚é¿å…ä½¿ç”¨ç‰¹æ®Šç¬¦å·å’Œç©ºæ ¼ï¼Œä»¥ç¡®ä¿è„šæœ¬çš„å¯è¯»æ€§å’Œå¯æ‰§è¡Œæ€§ã€‚ä¸ºäº†æ¸…æ™°æ˜äº†ï¼Œå»ºè®®åœ¨å‘½åä¸­ä½“ç°è„šæœ¬çš„åŠŸèƒ½å’Œç”¨é€”ã€‚</li>
<li>è„šæœ¬æ–‡ä»¶çš„é¦–è¡Œï¼šShellè„šæœ¬æ–‡ä»¶çš„é¦–è¡Œåº”è¯¥ä»¥<code>#!/bin/bash</code>å¼€å¤´ï¼Œè¿™æ˜¯æŒ‡å®šè„šæœ¬ä½¿ç”¨çš„Shellè§£é‡Šå™¨ä¸ºBashçš„çº¦å®šå†™æ³•ã€‚è¿™æ ·æ“ä½œç³»ç»Ÿä¼šæ ¹æ®è¯¥è¡ŒæŒ‡å®šçš„è§£é‡Šå™¨æ¥æ‰§è¡Œè„šæœ¬ã€‚</li>
<li>å˜é‡å‘½åï¼šå½“åœ¨Shellè„šæœ¬ä¸­å£°æ˜å˜é‡æ—¶ï¼Œéœ€è¦éµå¾ªä¸€äº›è§„åˆ™ã€‚å˜é‡åä¸èƒ½ä»¥æ•°å­—æˆ–ç‰¹æ®Šç¬¦å·å¼€å¤´ï¼Œä½†å¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿ã€‚å˜é‡åæœ€å¥½ä½¿ç”¨æœ‰æ„ä¹‰çš„ã€æè¿°æ€§çš„å‘½åï¼Œä»¥ä¾¿åœ¨ä»£ç ä¸­å¯ä»¥æ¸…æ™°åœ°ç†è§£å’Œä½¿ç”¨è¿™äº›å˜é‡ã€‚é¿å…ä½¿ç”¨ç ´æŠ˜å· <code>-</code>ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šä¸Shellçš„å‚æ•°ä¼ é€’è¯­æ³•äº§ç”Ÿå†²çªã€‚</li>
<li>å¼•ç”¨å˜é‡ï¼šåœ¨ä½¿ç”¨å˜é‡æ—¶ï¼Œæœ€å¥½å°†å˜é‡ç”¨åŒå¼•å· <code>&quot;</code> åŒ…å›´èµ·æ¥ï¼Œä»¥é¿å…ç”±äºå˜é‡å€¼ä¸­çš„ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦è€Œå¯¼è‡´çš„æ„å¤–è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨<code>&quot;$variable&quot;</code>è€Œä¸æ˜¯<code>$variable</code>ã€‚</li>
<li>æ–‡ä»¶æƒé™ï¼šåœ¨ä½¿ç”¨Shellè„šæœ¬æ—¶ï¼Œè¦æ³¨æ„ç»™äºˆè„šæœ¬æ–‡ä»¶æ‰§è¡Œæƒé™ã€‚å¯ä»¥ä½¿ç”¨<code>chmod</code>å‘½ä»¤æ¥ä¿®æ”¹æ–‡ä»¶æƒé™ï¼Œä½¿å…¶å¯æ‰§è¡Œï¼Œä¾‹å¦‚ï¼š<code>chmod +x script.sh</code>ã€‚</li>
<li>é”™è¯¯å¤„ç†ï¼šä¸ºäº†ç¼–å†™å¥å£®çš„Shellè„šæœ¬ï¼Œåº”è¯¥è€ƒè™‘é”™è¯¯å¤„ç†å’Œé”™è¯¯æ¶ˆæ¯çš„è¾“å‡ºã€‚å¯ä»¥ä½¿ç”¨æ¡ä»¶è¯­å¥å’Œé”™è¯¯å¤„ç†æœºåˆ¶æ¥æ•è·å’Œå¤„ç†è„šæœ¬ä¸­å¯èƒ½å‡ºç°çš„é”™è¯¯æƒ…å†µã€‚</li>
<li>æ³¨é‡Šï¼šä½¿ç”¨æ³¨é‡Šæ¥è§£é‡Šä»£ç çš„ä½œç”¨å’Œé€»è¾‘ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€‚åœ¨Shellè„šæœ¬ä¸­ä½¿ç”¨<code>#</code>ç¬¦å·å¼€å¤´çš„è¡Œè¢«è§†ä¸ºæ³¨é‡Šï¼Œä¸ä¼šè¢«æ‰§è¡Œã€‚</li>
<li>è°ƒè¯•ï¼šåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>echo</code>å‘½ä»¤è¾“å‡ºå˜é‡å€¼æˆ–è°ƒè¯•ä¿¡æ¯ï¼Œä»¥å¸®åŠ©è·Ÿè¸ªä»£ç æ‰§è¡Œè·¯å¾„å’Œè°ƒè¯•æ½œåœ¨é—®é¢˜ã€‚</li>
</ol>
<h2 id="1-3-ç¬¬ä¸€ä¸ªshell-è„šæœ¬-hello-world"><a href="#1-3-ç¬¬ä¸€ä¸ªshell-è„šæœ¬-hello-world" class="headerlink" title="1.3 ç¬¬ä¸€ä¸ªshell è„šæœ¬ hello world"></a>1.3 ç¬¬ä¸€ä¸ªshell è„šæœ¬ hello world</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªHelloword.sh æ–‡ä»¶</span></span><br><span class="line">topeet@ubuntu:~/shell$ touch Helloword.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¾‘Helloword.sh æ–‡ä»¶</span></span><br><span class="line">topeet@ubuntu:~/shell$ vim Helloword.sh</span><br><span class="line">topeet@ubuntu:~/shell$ ll Helloword.sh</span><br><span class="line">-rw-rw-r-- 1 topeet topeet 31 Dec  3 20:44 Helloword.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">èµ‹äºˆæ‰§è¡Œæƒé™</span></span><br><span class="line">topeet@ubuntu:~/shell$ chmod o+x Helloword.sh</span><br><span class="line">topeet@ubuntu:~/shell$ ./Helloword.sh</span><br><span class="line">-bash: ./Helloword.sh: Permission denied</span><br><span class="line">topeet@ubuntu:~/shell$ ls</span><br><span class="line">Helloword.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿è¡Œhelloword.sh è„šæœ¬</span></span><br><span class="line">topeet@ubuntu:~/shell$ sudo ./Helloword.sh</span><br><span class="line">[sudo] password for topeet: </span><br><span class="line">hello world</span><br><span class="line">topeet@ubuntu:~/shell$ </span><br></pre></td></tr></table></figure>

<h1 id="äºŒã€shell-ç¯å¢ƒå˜é‡è®²è§£"><a href="#äºŒã€shell-ç¯å¢ƒå˜é‡è®²è§£" class="headerlink" title="äºŒã€shell ç¯å¢ƒå˜é‡è®²è§£"></a>äºŒã€shell ç¯å¢ƒå˜é‡è®²è§£</h1><h2 id="2-1-shell-å˜é‡è¯¦è§£"><a href="#2-1-shell-å˜é‡è¯¦è§£" class="headerlink" title="2.1 shell å˜é‡è¯¦è§£"></a>2.1 shell å˜é‡è¯¦è§£</h2><p>å˜é‡æ˜¯åœ¨Shellç¼–ç¨‹ä¸­ç”¨äºå­˜å‚¨æ•°æ®çš„ä¸€ç§æœºåˆ¶ã€‚å®ƒä»¬å…è®¸æˆ‘ä»¬å°†å€¼èµ‹ç»™ä¸€ä¸ªåç§°ï¼Œå¹¶åœ¨è„šæœ¬ä¸­å¼•ç”¨è¯¥åç§°æ¥è·å–æˆ–ä¿®æ”¹å­˜å‚¨çš„å€¼ã€‚å˜é‡å¯ä»¥å­˜å‚¨å„ç§ç±»å‹çš„æ•°æ®ï¼Œä¾‹å¦‚æ–‡æœ¬ã€æ•°å­—ã€æ–‡ä»¶è·¯å¾„ç­‰ã€‚</p>
<p>åœ¨Shellç¼–ç¨‹ä¸­ï¼Œå¸¸è§çš„å˜é‡åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ç±»å‹ï¼š</p>
<ol>
<li>ç³»ç»Ÿå˜é‡ï¼šç³»ç»Ÿå˜é‡æ˜¯ç”±Shellç¨‹åºæˆ–æ“ä½œç³»ç»Ÿé¢„å…ˆå®šä¹‰çš„å˜é‡ï¼Œç”¨äºæä¾›æœ‰å…³ç³»ç»Ÿç¯å¢ƒå’Œé…ç½®çš„ä¿¡æ¯ã€‚è¿™äº›å˜é‡é€šå¸¸ä»¥å¤§å†™å­—æ¯å‘½åï¼Œä¾‹å¦‚<code>PATH</code>ã€<code>HOME</code>ç­‰ã€‚ç³»ç»Ÿå˜é‡çš„å€¼å¯ä»¥åœ¨Shellè„šæœ¬ä¸­è¯»å–å’Œä½¿ç”¨ï¼Œä½†é€šå¸¸ä¸å…è®¸æ›´æ”¹ã€‚</li>
<li>ç¯å¢ƒå˜é‡ï¼šç¯å¢ƒå˜é‡æ˜¯ç”¨æˆ·å®šä¹‰çš„å˜é‡ï¼Œå®ƒä»¬åœ¨æ•´ä¸ªShellä¼šè¯ä¸­æŒä¹…å­˜åœ¨ï¼Œå¹¶å¯ä»¥åœ¨ä¸åŒçš„Shellè„šæœ¬ä¹‹é—´å…±äº«ã€‚ç¯å¢ƒå˜é‡çš„å€¼å¯ä»¥åœ¨Shellè„šæœ¬ä¸­è¯»å–ã€ä¿®æ”¹å’Œè®¾ç½®ã€‚å¸¸è§çš„ç¯å¢ƒå˜é‡åŒ…æ‹¬<code>USER</code>ã€<code>LANG</code>ã€<code>PWD</code>ç­‰ã€‚å¯ä»¥ä½¿ç”¨<code>export</code>å‘½ä»¤å°†ç”¨æˆ·å˜é‡å¯¼å‡ºä¸ºç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚<code>export MY_VAR=value</code>ã€‚</li>
<li>ç”¨æˆ·å˜é‡ï¼šç”¨æˆ·å˜é‡æ˜¯åœ¨Shellè„šæœ¬ä¸­ç”±ç”¨æˆ·è‡ªè¡Œå®šä¹‰çš„å˜é‡ã€‚å®ƒä»¬ç”¨äºå­˜å‚¨ä¸´æ—¶æ•°æ®ã€ä¸­é—´ç»“æœæˆ–ç”¨æˆ·è‡ªå®šä¹‰é…ç½®ã€‚ç”¨æˆ·å˜é‡çš„åç§°ç”±ç”¨æˆ·è‡ªè¡ŒæŒ‡å®šï¼Œéµå¾ªå˜é‡å‘½åè§„åˆ™ã€‚ç”¨æˆ·å˜é‡çš„å€¼å¯ä»¥åœ¨Shellè„šæœ¬ä¸­è¿›è¡Œèµ‹å€¼å’Œä¿®æ”¹ï¼Œå¹¶åœ¨éœ€è¦æ—¶è¿›è¡Œå¼•ç”¨ã€‚ä¾‹å¦‚ï¼Œ<code>name=&quot;John&quot;</code>å®šä¹‰äº†ä¸€ä¸ªåä¸º<code>name</code>çš„ç”¨æˆ·å˜é‡ï¼Œå¹¶å°†å…¶èµ‹å€¼ä¸º<code>John</code>ã€‚</li>
</ol>
<p>åœ¨Shellç¼–ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ¥æ“ä½œå˜é‡ï¼š</p>
<ul>
<li>èµ‹å€¼ï¼šä½¿ç”¨ç­‰å·ï¼ˆ&#x3D;ï¼‰å°†å€¼èµ‹ç»™å˜é‡ï¼Œä¾‹å¦‚<code>var=value</code>ã€‚</li>
<li>å¼•ç”¨ï¼šåœ¨è„šæœ¬ä¸­ä½¿ç”¨<code>$</code>ç¬¦å·åŠ ä¸Šå˜é‡åæ¥å¼•ç”¨å˜é‡çš„å€¼ï¼Œä¾‹å¦‚<code>echo $var</code>å°†æ‰“å°å‡ºå˜é‡<code>var</code>çš„å€¼ã€‚</li>
<li>ä¿®æ”¹ï¼šé€šè¿‡é‡æ–°èµ‹å€¼æ¥ä¿®æ”¹å˜é‡çš„å€¼ï¼Œä¾‹å¦‚<code>var=new_value</code>ã€‚</li>
<li>åˆ é™¤ï¼šä½¿ç”¨<code>unset</code>å‘½ä»¤æ¥åˆ é™¤å˜é‡ï¼Œä¾‹å¦‚<code>unset var</code>ä¼šå°†å˜é‡<code>var</code>ä»å†…å­˜ä¸­åˆ é™¤ã€‚</li>
<li>ç‰¹æ®Šå˜é‡ï¼šShellè¿˜æä¾›äº†ä¸€äº›ç‰¹æ®Šçš„ç³»ç»Ÿå˜é‡ï¼Œå¦‚<code>$HOME</code>è¡¨ç¤ºå½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•ï¼Œ<code>$PWD</code>è¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼Œ<code>$PATH</code>è¡¨ç¤ºå¯æ‰§è¡Œç¨‹åºçš„æœç´¢è·¯å¾„ç­‰ã€‚</li>
</ul>
<h2 id="2-2-shell-ç³»ç»Ÿå˜é‡-ä»‹ç»"><a href="#2-2-shell-ç³»ç»Ÿå˜é‡-ä»‹ç»" class="headerlink" title="2.2 shell ç³»ç»Ÿå˜é‡ ä»‹ç»"></a>2.2 shell ç³»ç»Ÿå˜é‡ ä»‹ç»</h2><p>ç³»ç»Ÿå˜é‡åœ¨Shellç¼–ç¨‹ä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ï¼Œç”¨äºæä¾›å…³äºè„šæœ¬æ‰§è¡Œç¯å¢ƒå’Œå‚æ•°çš„ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯å¸¸è§çš„ç³»ç»Ÿå˜é‡åŠå…¶è¯¦ç»†ä»‹ç»ï¼š</p>
<ol>
<li><code>$0</code>: å½“å‰è„šæœ¬çš„åç§°ã€‚å®ƒä¿å­˜äº†å½“å‰æ­£åœ¨æ‰§è¡Œçš„Shellè„šæœ¬çš„æ–‡ä»¶åã€‚å¯ä»¥é€šè¿‡<code>$0</code>æ¥è·å–è„šæœ¬æ–‡ä»¶çš„åç§°ï¼ŒåŒ…æ‹¬è·¯å¾„ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</li>
<li><code>$n</code>: å½“å‰è„šæœ¬çš„ç¬¬nä¸ªå‚æ•°ã€‚<code>n</code>çš„å–å€¼èŒƒå›´ä¸º1åˆ°9ï¼Œç”¨äºè·å–è„šæœ¬åœ¨æ‰§è¡Œæ—¶ä¼ é€’çš„å‘½ä»¤è¡Œå‚æ•°ã€‚ä¾‹å¦‚ï¼Œ<code>$1</code>è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ<code>$2</code>è¡¨ç¤ºç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li>
<li><code>$*</code>: å½“å‰è„šæœ¬çš„æ‰€æœ‰å‚æ•°ï¼ˆä¸åŒ…æ‹¬ç¨‹åºæœ¬èº«ï¼‰ã€‚å®ƒè¡¨ç¤ºæ‰€æœ‰ä¼ é€’ç»™è„šæœ¬çš„å‘½ä»¤è¡Œå‚æ•°çš„åˆ—è¡¨ã€‚å¯ä»¥ä½¿ç”¨<code>$*</code>æ¥è·å–æ‰€æœ‰å‚æ•°çš„å­—ç¬¦ä¸²ï¼Œå‚æ•°ä¹‹é—´ä½¿ç”¨ç©ºæ ¼åˆ†éš”ã€‚</li>
<li><code>$#</code>: å½“å‰è„šæœ¬çš„å‚æ•°ä¸ªæ•°ï¼ˆä¸åŒ…æ‹¬ç¨‹åºæœ¬èº«ï¼‰ã€‚å®ƒè¡¨ç¤ºä¼ é€’ç»™è„šæœ¬çš„å‘½ä»¤è¡Œå‚æ•°çš„æ•°é‡ã€‚å¯ä»¥ä½¿ç”¨<code>$#</code>æ¥è·å–å‚æ•°çš„ä¸ªæ•°ã€‚</li>
<li><code>$?</code>: å‰ä¸€ä¸ªå‘½ä»¤æˆ–ç¨‹åºæ‰§è¡Œå®Œåçš„çŠ¶æ€ã€‚å®ƒä¿å­˜äº†ä¸Šä¸€ä¸ªå‘½ä»¤æˆ–ç¨‹åºæ‰§è¡Œå®Œæ¯•åçš„è¿”å›çŠ¶æ€ç ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿”å›0è¡¨ç¤ºæ‰§è¡ŒæˆåŠŸï¼Œéé›¶å€¼è¡¨ç¤ºæ‰§è¡Œå¤±è´¥ã€‚å¯ä»¥é€šè¿‡æ£€æŸ¥<code>$?</code>çš„å€¼æ¥åˆ¤æ–­å‰ä¸€ä¸ªå‘½ä»¤æˆ–ç¨‹åºæ˜¯å¦æˆåŠŸæ‰§è¡Œã€‚</li>
<li><code>$$</code>: ç¨‹åºæœ¬èº«çš„PIDå·ï¼ˆè¿›ç¨‹IDï¼‰ã€‚å®ƒä¿å­˜äº†å½“å‰Shellè„šæœ¬æˆ–ç¨‹åºçš„è¿›ç¨‹IDã€‚å¯ä»¥ä½¿ç”¨<code>$$</code>æ¥è·å–å½“å‰è„šæœ¬çš„è¿›ç¨‹IDã€‚</li>
</ol>
<h2 id="2-3-shell-ç¯å¢ƒå˜é‡ä»‹ç»"><a href="#2-3-shell-ç¯å¢ƒå˜é‡ä»‹ç»" class="headerlink" title="2.3  shell ç¯å¢ƒå˜é‡ä»‹ç»"></a>2.3  shell ç¯å¢ƒå˜é‡ä»‹ç»</h2><p>ç¯å¢ƒå˜é‡åœ¨Shellç¼–ç¨‹ä¸­èµ·ç€é‡è¦çš„ä½œç”¨ï¼Œå®ƒä»¬æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„å˜é‡ï¼Œç”¨äºè®¾ç½®å’Œå­˜å‚¨ä¸Shellä¼šè¯å’Œç¨‹åºæ‰§è¡Œç¯å¢ƒç›¸å…³çš„ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯å¸¸è§çš„ç¯å¢ƒå˜é‡åŠå…¶è¯¦ç»†ä»‹ç»ï¼š</p>
<ol>
<li><code>PATH</code>: å‘½ä»¤æ‰€ç¤ºè·¯å¾„ï¼Œä»¥å†’å·ä¸ºåˆ†éš”ã€‚å®ƒæ˜¯ä¸€ä¸ªåŒ…å«å¯æ‰§è¡Œç¨‹åºçš„æœç´¢è·¯å¾„çš„åˆ—è¡¨ã€‚å½“åœ¨Shellä¸­æ‰§è¡Œä¸€ä¸ªå‘½ä»¤æ—¶ï¼Œä¼šæ ¹æ®<code>PATH</code>å˜é‡ä¸­æ‰€åˆ—å‡ºçš„è·¯å¾„ä¾æ¬¡æœç´¢å‘½ä»¤çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚å¦‚æœå‘½ä»¤åœ¨<code>PATH</code>ä¸­çš„æŸä¸ªè·¯å¾„ä¸‹æ‰¾åˆ°ï¼Œåˆ™å¯ä»¥ç›´æ¥æ‰§è¡Œã€‚</li>
<li><code>HOME</code>: æ‰“å°ç”¨æˆ·å®¶ç›®å½•ã€‚å®ƒä¿å­˜äº†å½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•è·¯å¾„ã€‚è®¸å¤šç¨‹åºä¼šä½¿ç”¨<code>HOME</code>å˜é‡æ¥ç¡®å®šç”¨æˆ·çš„ä¸ªäººæ–‡ä»¶å’Œé…ç½®å­˜æ”¾çš„ä½ç½®ã€‚</li>
<li><code>SHELL</code>: æ˜¾ç¤ºå½“å‰Shellç±»å‹ã€‚å®ƒä¿å­˜äº†å½“å‰æ­£åœ¨ä½¿ç”¨çš„Shellçš„ç±»å‹ï¼Œä¾‹å¦‚<code>/bin/bash</code>è¡¨ç¤ºBash Shellï¼Œ<code>/bin/sh</code>è¡¨ç¤ºBourne Shellç­‰ã€‚</li>
<li><code>USER</code>: æ‰“å°å½“å‰ç”¨æˆ·åã€‚å®ƒä¿å­˜äº†å½“å‰ç™»å½•ç”¨æˆ·çš„ç”¨æˆ·åã€‚</li>
<li><code>ID</code>: æ‰“å°å½“å‰ç”¨æˆ·IDä¿¡æ¯ã€‚å®ƒåŒ…å«äº†å½“å‰ç”¨æˆ·çš„ç”¨æˆ·IDï¼ˆUIDï¼‰ã€ç»„IDï¼ˆGIDï¼‰ç­‰ç›¸å…³ä¿¡æ¯ã€‚</li>
<li><code>PWD</code>: æ˜¾ç¤ºå½“å‰æ‰€åœ¨è·¯å¾„ã€‚å®ƒä¿å­˜äº†å½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„ï¼Œå³Shellå½“å‰æ‰€åœ¨çš„è·¯å¾„ã€‚</li>
<li><code>TERM</code>: æ‰“å°å½“å‰ç»ˆç«¯ç±»å‹ã€‚å®ƒä¿å­˜äº†å½“å‰ç»ˆç«¯çš„ç±»å‹æˆ–ç»ˆç«¯ä»¿çœŸå™¨çš„åç§°ã€‚</li>
<li><code>HOSTNAME</code>: æ˜¾ç¤ºå½“å‰ä¸»æœºåã€‚å®ƒä¿å­˜äº†å½“å‰ä¸»æœºçš„åç§°ã€‚</li>
<li><code>PS1</code>: å®šä¹‰ä¸»æœºå‘½ä»¤æç¤ºç¬¦ã€‚å®ƒç”¨äºè®¾ç½®Shellå‘½ä»¤è¡Œçš„æç¤ºç¬¦ï¼Œå¯ä»¥è‡ªå®šä¹‰æç¤ºç¬¦çš„æ ¼å¼å’Œå†…å®¹ã€‚</li>
<li><code>HISTSIZE</code>: å†å²å‘½ä»¤å¤§å°ã€‚å®ƒç¡®å®šäº†Shellå†å²è®°å½•ä¸­ä¿å­˜çš„å‘½ä»¤çš„æ•°é‡ã€‚å¯ä»¥é€šè¿‡è®¾ç½®<code>HISTSIZE</code>å˜é‡æ¥è°ƒæ•´å†å²å‘½ä»¤çš„å¤§å°ã€‚</li>
<li><code>RANDOM</code>: éšæœºç”Ÿæˆä¸€ä¸ª0è‡³32767çš„æ•´æ•°ã€‚å®ƒä¿å­˜äº†ä¸€ä¸ªéšæœºç”Ÿæˆçš„æ•´æ•°ï¼Œå¯ä»¥ç”¨äºåœ¨Shellè„šæœ¬ä¸­ç”Ÿæˆéšæœºæ•°ã€‚</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“å°å½“å‰è„šæœ¬çš„åç§°</span></span><br><span class="line">echo &quot;å½“å‰è„šæœ¬çš„åç§°ï¼š$0&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“å°ä½ç½®å‚æ•°çš„æ•°é‡å’Œåˆ—è¡¨</span></span><br><span class="line">echo &quot;ä½ç½®å‚æ•°çš„æ•°é‡ï¼š$#&quot;</span><br><span class="line">echo &quot;ä½ç½®å‚æ•°çš„åˆ—è¡¨ï¼ˆä½œä¸ºå•ä¸ªå­—ç¬¦ä¸²ï¼‰ï¼š$*&quot;</span><br><span class="line">echo &quot;ä½ç½®å‚æ•°çš„åˆ—è¡¨ï¼ˆä½œä¸ºå¤šä¸ªç‹¬ç«‹å­—ç¬¦ä¸²ï¼‰ï¼š$@&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“å°ä¸Šä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€</span></span><br><span class="line">echo &quot;ä¸Šä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼š$?&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“å°å½“å‰è¿›ç¨‹çš„ ID å’Œåå°è¿›ç¨‹çš„ ID</span></span><br><span class="line">echo &quot;å½“å‰è„šæœ¬çš„è¿›ç¨‹ IDï¼š$$&quot;</span><br><span class="line">sleep 5 &amp;</span><br><span class="line">echo &quot;åå°è¿›ç¨‹çš„ IDï¼š$!&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“å°å½“å‰ç”¨æˆ·çš„ç”¨æˆ·åå’Œä¸»ç›®å½•è·¯å¾„</span></span><br><span class="line">echo &quot;å½“å‰ç”¨æˆ·çš„ç”¨æˆ·åï¼š$USER&quot;</span><br><span class="line">echo &quot;å½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•è·¯å¾„ï¼š$HOME&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“å°å¯æ‰§è¡Œæ–‡ä»¶çš„æœç´¢è·¯å¾„å’Œå½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„</span></span><br><span class="line">echo &quot;å¯æ‰§è¡Œæ–‡ä»¶çš„æœç´¢è·¯å¾„ï¼š$PATH&quot;</span><br><span class="line">echo &quot;å½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„ï¼š$PWD&quot;</span><br><span class="line">echo &quot;ä¸Šä¸€ä¸ªå·¥ä½œç›®å½•çš„è·¯å¾„ï¼š$OLDPWD&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“å°ç»™å®šè·¯å¾„çš„æ–‡ä»¶åå’Œç›®å½•éƒ¨åˆ†</span></span><br><span class="line">path=&quot;/path/to/somefile.txt&quot;</span><br><span class="line">echo &quot;ç»™å®šè·¯å¾„çš„æ–‡ä»¶åéƒ¨åˆ†ï¼š$(basename $path)&quot;</span><br><span class="line">echo &quot;ç»™å®šè·¯å¾„çš„ç›®å½•éƒ¨åˆ†ï¼š$(dirname $path)&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“å°æ­£åœ¨æ‰§è¡Œçš„å½“å‰è¡Œçš„è¡Œå·å’Œå½“å‰æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°çš„åç§°</span></span><br><span class="line">echo &quot;æ­£åœ¨æ‰§è¡Œçš„å½“å‰è¡Œçš„è¡Œå·ï¼š$LINENO&quot;</span><br><span class="line">echo &quot;å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°çš„åç§°ï¼š$FUNCNAME&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“å° Bash ç‰ˆæœ¬å·å’Œéšæœºæ•´æ•°</span></span><br><span class="line">echo &quot;Bash ç‰ˆæœ¬å·ï¼š$BASH_VERSION&quot;</span><br><span class="line">echo &quot;éšæœºæ•´æ•°ï¼š$RANDOM&quot;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">COPY./01_special_variables.sh  111 222 333</span><br><span class="line">COPYå½“å‰è„šæœ¬çš„åç§°ï¼š./01_special_variables.sh</span><br><span class="line">ä½ç½®å‚æ•°çš„æ•°é‡ï¼š3</span><br><span class="line">ä½ç½®å‚æ•°çš„åˆ—è¡¨ï¼ˆä½œä¸ºå•ä¸ªå­—ç¬¦ä¸²ï¼‰ï¼š111 222 333</span><br><span class="line">ä½ç½®å‚æ•°çš„åˆ—è¡¨ï¼ˆä½œä¸ºå¤šä¸ªç‹¬ç«‹å­—ç¬¦ä¸²ï¼‰ï¼š111 222 333</span><br><span class="line">ä¸Šä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼š0</span><br><span class="line">å½“å‰è„šæœ¬çš„è¿›ç¨‹ IDï¼š77749</span><br><span class="line">åå°è¿›ç¨‹çš„ IDï¼š77750</span><br><span class="line">å½“å‰ç”¨æˆ·çš„ç”¨æˆ·åï¼štopeet</span><br><span class="line">å½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•è·¯å¾„ï¼š/home/topeet</span><br><span class="line">å¯æ‰§è¡Œæ–‡ä»¶çš„æœç´¢è·¯å¾„ï¼š/home/topeet/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin</span><br><span class="line">å½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„ï¼š/home/topeet/shell</span><br><span class="line">ä¸Šä¸€ä¸ªå·¥ä½œç›®å½•çš„è·¯å¾„ï¼š/home/topeet</span><br><span class="line">ç»™å®šè·¯å¾„çš„æ–‡ä»¶åéƒ¨åˆ†ï¼šsomefile.txt</span><br><span class="line">ç»™å®šè·¯å¾„çš„ç›®å½•éƒ¨åˆ†ï¼š/path/to</span><br><span class="line">æ­£åœ¨æ‰§è¡Œçš„å½“å‰è¡Œçš„è¡Œå·ï¼š34</span><br><span class="line">å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°çš„åç§°ï¼š</span><br><span class="line">Bash ç‰ˆæœ¬å·ï¼š5.0.17(1)-release</span><br><span class="line">éšæœºæ•´æ•°ï¼š2591</span><br></pre></td></tr></table></figure>

<h2 id="2-4-shell-ç”¨æˆ·ç¯å¢ƒå˜é‡-ä»‹ç»"><a href="#2-4-shell-ç”¨æˆ·ç¯å¢ƒå˜é‡-ä»‹ç»" class="headerlink" title="2.4 shell ç”¨æˆ·ç¯å¢ƒå˜é‡ ä»‹ç»"></a>2.4 shell ç”¨æˆ·ç¯å¢ƒå˜é‡ ä»‹ç»</h2><h3 id="2-4-1-è‡ªå®šä¹‰shellç¯å¢ƒå˜é‡"><a href="#2-4-1-è‡ªå®šä¹‰shellç¯å¢ƒå˜é‡" class="headerlink" title="2.4.1 è‡ªå®šä¹‰shellç¯å¢ƒå˜é‡"></a>2.4.1 è‡ªå®šä¹‰shellç¯å¢ƒå˜é‡</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¸¸è§çš„å˜é‡ä¹‹ä¸‰ç”¨æˆ·å˜é‡ï¼Œç”¨æˆ·å˜é‡åˆç§°ä¸ºå±€éƒ¨å˜é‡ï¼Œä¸»è¦ç”¨åœ¨Shellè„šæœ¬å†…éƒ¨æˆ–è€…ä¸´æ—¶å±€éƒ¨ä½¿ç”¨ï¼Œç³»ç»Ÿå˜é‡è¯¦è§£å¦‚ä¸‹ï¼š</span></span><br><span class="line">a=rivers 				       è‡ªå®šä¹‰å˜é‡Aï¼›</span><br><span class="line">Httpd_sort=httpd-2.4.6-97.tar  è‡ªå®šä¹‰å˜é‡N_SOFTï¼›</span><br><span class="line">BACK_DIR=/data/backup/         è‡ªå®šä¹‰å˜é‡BACK_DIRï¼›</span><br><span class="line">IPaddress=10.0.0.1			   è‡ªå®šä¹‰å˜é‡IP1ï¼›</span><br></pre></td></tr></table></figure>

<h3 id="2-4-2-shell-ä¸­å½©è‰²è¾“å‡º-helloworld"><a href="#2-4-2-shell-ä¸­å½©è‰²è¾“å‡º-helloworld" class="headerlink" title="2.4.2 shell ä¸­å½©è‰²è¾“å‡º helloworld"></a>2.4.2 shell ä¸­å½©è‰²è¾“å‡º helloworld</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This is <span class="built_in">echo</span> color shell</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">by author rivers 2021.09-23</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å­—ä½“é¢œè‰²</span></span><br><span class="line">for i in &#123;31..37&#125;; do</span><br><span class="line">echo -e &quot;\033[$i;40mHello world!\033[0m&quot;</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">èƒŒæ™¯é¢œè‰²</span></span><br><span class="line">for i in &#123;41..47&#125;; do</span><br><span class="line">echo -e &quot;\033[47;$&#123;i&#125;mHello world!\033[0m&quot;</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¾ç¤ºæ–¹å¼</span></span><br><span class="line">for i in &#123;1..8&#125;; do</span><br><span class="line">echo -e &quot;\033[$i;31;40mHello world!\033[0m&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042108748.png" alt="image-20231204125418612"></p>
<h1 id="ä¸‰ã€shell-ç¼–ç¨‹æµç¨‹æ§åˆ¶è¯­å¥"><a href="#ä¸‰ã€shell-ç¼–ç¨‹æµç¨‹æ§åˆ¶è¯­å¥" class="headerlink" title="ä¸‰ã€shell ç¼–ç¨‹æµç¨‹æ§åˆ¶è¯­å¥"></a>ä¸‰ã€shell ç¼–ç¨‹æµç¨‹æ§åˆ¶è¯­å¥</h1><h2 id="3-1-if-æ¡ä»¶è¯­å¥ä»‹ç»"><a href="#3-1-if-æ¡ä»¶è¯­å¥ä»‹ç»" class="headerlink" title="3.1 if æ¡ä»¶è¯­å¥ä»‹ç»"></a>3.1 if æ¡ä»¶è¯­å¥ä»‹ç»</h2><h3 id="3-1-1-å¸¸ç”¨çš„å•-åŒåˆ†æ”¯"><a href="#3-1-1-å¸¸ç”¨çš„å•-åŒåˆ†æ”¯" class="headerlink" title="3.1.1 å¸¸ç”¨çš„å•&#x2F;åŒåˆ†æ”¯"></a>3.1.1 å¸¸ç”¨çš„å•&#x2F;åŒåˆ†æ”¯</h3><ul>
<li><p><strong>if æ¡ä»¶è¯­å¥</strong></p>
</li>
<li><p>æ¡ä»¶åˆ¤æ–­è¯­å¥ï¼ˆifè¯­å¥ï¼‰æ˜¯Shellç¼–ç¨‹ä¸­ç”¨äºæ ¹æ®æ¡ä»¶æ‰§è¡Œä¸åŒä»£ç å—çš„ç»“æ„ã€‚ifè¯­å¥é€šå¸¸ä»¥<code>if</code>å¼€å¤´ï¼Œä»¥<code>fi</code>ç»“å°¾ï¼Œå¯ä»¥åŒ…å«<code>else</code>å’Œ<code>elif</code>ï¼ˆelse ifçš„ç¼©å†™ï¼‰æ¥å®ç°å¤šæ¡ä»¶åˆ¤æ–­ã€‚ä¸‹é¢æ˜¯å¯¹ä¸åŒç±»å‹çš„ifè¯­å¥è¿›è¡Œè¯¦ç»†çš„è®²è§£ï¼š</p>
<ol>
<li>å•åˆ†æ”¯è¯­å¥ï¼ˆæ¯”è¾ƒå¤§å°ï¼‰:</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if [ æ¡ä»¶è¡¨è¾¾å¼ ]; then</span><br><span class="line">    è¯­å¥1</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>åœ¨å•åˆ†æ”¯è¯­å¥ä¸­ï¼Œæ ¹æ®æ¡ä»¶è¡¨è¾¾å¼çš„ç»“æœï¼ˆçœŸæˆ–å‡ï¼‰ï¼Œå¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œåˆ™æ‰§è¡Œè¯­å¥1ï¼Œå¦åˆ™è·³è¿‡æ•´ä¸ªifè¯­å¥ã€‚</p>
<ol>
<li>åŒåˆ†æ”¯ifè¯­å¥:</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if [ è¡¨è¾¾å¼ ]; then</span><br><span class="line">    è¯­å¥1</span><br><span class="line">else</span><br><span class="line">    è¯­å¥2</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>åœ¨åŒåˆ†æ”¯ifè¯­å¥ä¸­ï¼Œæ ¹æ®è¡¨è¾¾å¼çš„ç»“æœï¼Œå¦‚æœè¡¨è¾¾å¼ä¸ºçœŸï¼Œåˆ™æ‰§è¡Œè¯­å¥1ï¼›å¦‚æœè¡¨è¾¾å¼ä¸ºå‡ï¼Œåˆ™æ‰§è¡Œè¯­å¥2ã€‚</p>
<ol>
<li>å¤šæ”¯æ¡ä»¶è¯­å¥ï¼ˆåˆ¤æ–­æˆç»©ï¼‰:</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if [ è¡¨è¾¾å¼1 ]; then</span><br><span class="line">    è¯­å¥1</span><br><span class="line">elif [ è¡¨è¾¾å¼2 ]; then</span><br><span class="line">    è¯­å¥2</span><br><span class="line">elif [ è¡¨è¾¾å¼3 ]; then</span><br><span class="line">    è¯­å¥3</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>åœ¨å¤šæ”¯æ¡ä»¶è¯­å¥ä¸­ï¼Œæ ¹æ®æ¯ä¸ªè¡¨è¾¾å¼çš„ç»“æœï¼ŒæŒ‰ç…§é¡ºåºä¾æ¬¡åˆ¤æ–­æ¡ä»¶ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„è¯­å¥ã€‚å¦‚æœè¡¨è¾¾å¼1ä¸ºçœŸï¼Œåˆ™æ‰§è¡Œè¯­å¥1ï¼›å¦‚æœè¡¨è¾¾å¼1ä¸ºå‡ä¸”è¡¨è¾¾å¼2ä¸ºçœŸï¼Œåˆ™æ‰§è¡Œè¯­å¥2ï¼›å¦‚æœè¡¨è¾¾å¼1å’Œè¡¨è¾¾å¼2éƒ½ä¸ºå‡ä¸”è¡¨è¾¾å¼3ä¸ºçœŸï¼Œåˆ™æ‰§è¡Œè¯­å¥3ã€‚å¦‚æœæ‰€æœ‰æ¡ä»¶éƒ½ä¸ºå‡ï¼Œåˆ™è·³è¿‡æ•´ä¸ªifè¯­å¥ã€‚</p>
<p>åœ¨ifè¯­å¥ä¸­ï¼Œæ¡ä»¶è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨å„ç§æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆå¦‚<code>-eq</code>ã€<code>-ne</code>ã€<code>-lt</code>ã€<code>-gt</code>ç­‰ï¼‰æ¥æ¯”è¾ƒæ•°å­—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆå¦‚<code>=</code>ã€<code>!=</code>ã€<code>-z</code>ã€<code>-n</code>ç­‰ï¼‰æ¥æ¯”è¾ƒå­—ç¬¦ä¸²ã€‚å¯ä»¥ä½¿ç”¨é€»è¾‘è¿ç®—ç¬¦ï¼ˆå¦‚<code>&amp;&amp;</code>ã€<code>||</code>ï¼‰ç»„åˆå¤šä¸ªæ¡ä»¶ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œifè¯­å¥ä¸­çš„è¯­å¥å—å¯ä»¥æ˜¯å•ä¸ªå‘½ä»¤ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒ…å«å¤šä¸ªå‘½ä»¤çš„ä»£ç å—ã€‚åœ¨ä»£ç å—ä¸­ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„éœ€è¦çš„Shellå‘½ä»¤å’Œé€»è¾‘ã€‚</p>
<p>é€šè¿‡ä½¿ç”¨æ¡ä»¶åˆ¤æ–­è¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒçš„æ¡ä»¶æ‰§è¡Œä¸åŒçš„ä»£ç é€»è¾‘ï¼Œå®ç°ç¨‹åºçš„æµç¨‹æ§åˆ¶å’Œæ¡ä»¶åˆ†æ”¯ã€‚å®ƒåœ¨Shellè„šæœ¬ä¸­éå¸¸å¸¸ç”¨ï¼Œå¯ç”¨äºæ§åˆ¶ç¨‹åºçš„é€»è¾‘æµç¨‹ã€å¤„ç†ä¸åŒçš„é”™è¯¯æƒ…å†µã€æ ¹æ®æ¡ä»¶æ‰§è¡Œä¸åŒçš„æ“ä½œç­‰ã€‚</p>
</li>
</ul>
<h3 id="3-1-2-if-å¸¸è§åˆ¤æ–­é€»è¾‘è¿ç®—ç¬¦è¯¦è§£"><a href="#3-1-2-if-å¸¸è§åˆ¤æ–­é€»è¾‘è¿ç®—ç¬¦è¯¦è§£" class="headerlink" title="3.1.2 if å¸¸è§åˆ¤æ–­é€»è¾‘è¿ç®—ç¬¦è¯¦è§£"></a>3.1.2 if å¸¸è§åˆ¤æ–­é€»è¾‘è¿ç®—ç¬¦è¯¦è§£</h3><ul>
<li><code>-f</code>ï¼šåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚ä¾‹å¦‚ï¼Œ<code>if [ -f filename ]</code>ä¼šæ£€æŸ¥<code>filename</code>æ˜¯å¦ä¸ºä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶ã€‚</li>
<li><code>-d</code>ï¼šåˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚ä¾‹å¦‚ï¼Œ<code>if [ -d dir ]</code>ä¼šæ£€æŸ¥<code>dir</code>æ˜¯å¦ä¸ºä¸€ä¸ªå­˜åœ¨çš„ç›®å½•ã€‚</li>
<li><code>-eq</code>ï¼šç­‰äºï¼Œç”¨äºæ•´æ•°æ¯”è¾ƒã€‚ä¾‹å¦‚ï¼Œ<code>if [ &quot;$a&quot; -eq &quot;$b&quot; ]</code>ä¼šåˆ¤æ–­å˜é‡<code>a</code>å’Œ<code>b</code>æ˜¯å¦ç›¸ç­‰ã€‚</li>
<li><code>-ne</code>ï¼šä¸ç­‰äºï¼Œç”¨äºæ•´æ•°æ¯”è¾ƒã€‚ä¾‹å¦‚ï¼Œ<code>if [ &quot;$a&quot; -ne &quot;$b&quot; ]</code>ä¼šåˆ¤æ–­å˜é‡<code>a</code>å’Œ<code>b</code>æ˜¯å¦ä¸ç›¸ç­‰ã€‚</li>
<li><code>-lt</code>ï¼šå°äºï¼Œç”¨äºæ•´æ•°æ¯”è¾ƒã€‚ä¾‹å¦‚ï¼Œ<code>if [ &quot;$a&quot; -lt &quot;$b&quot; ]</code>ä¼šåˆ¤æ–­å˜é‡<code>a</code>æ˜¯å¦å°äº<code>b</code>ã€‚</li>
<li><code>-gt</code>ï¼šå¤§äºï¼Œç”¨äºæ•´æ•°æ¯”è¾ƒã€‚ä¾‹å¦‚ï¼Œ<code>if [ &quot;$a&quot; -gt &quot;$b&quot; ]</code>ä¼šåˆ¤æ–­å˜é‡<code>a</code>æ˜¯å¦å¤§äº<code>b</code>ã€‚</li>
<li><code>-le</code>ï¼šå°äºæˆ–ç­‰äºï¼Œç”¨äºæ•´æ•°æ¯”è¾ƒã€‚ä¾‹å¦‚ï¼Œ<code>if [ &quot;$a&quot; -le &quot;$b&quot; ]</code>ä¼šåˆ¤æ–­å˜é‡<code>a</code>æ˜¯å¦å°äºç­‰äº<code>b</code>ã€‚</li>
<li><code>-ge</code>ï¼šå¤§äºæˆ–ç­‰äºï¼Œç”¨äºæ•´æ•°æ¯”è¾ƒã€‚ä¾‹å¦‚ï¼Œ<code>if [ &quot;$a&quot; -ge &quot;$b&quot; ]</code>ä¼šåˆ¤æ–­å˜é‡<code>a</code>æ˜¯å¦å¤§äºç­‰äº<code>b</code>ã€‚</li>
<li><code>-a</code>ï¼šé€»è¾‘ä¸ï¼Œè¡¨ç¤ºåŒæ–¹éƒ½æˆç«‹ã€‚ä¾‹å¦‚ï¼Œ<code>if [ condition1 -a condition2 ]</code>ä¼šæ£€æŸ¥<code>condition1</code>å’Œ<code>condition2</code>æ˜¯å¦åŒæ—¶æˆç«‹ã€‚</li>
<li><code>-o</code>ï¼šé€»è¾‘æˆ–ï¼Œè¡¨ç¤ºå•æ–¹æˆç«‹ã€‚ä¾‹å¦‚ï¼Œ<code>if [ condition1 -o condition2 ]</code>ä¼šæ£€æŸ¥<code>condition1</code>å’Œ<code>condition2</code>æ˜¯å¦æœ‰ä¸€ä¸ªæˆç«‹ã€‚</li>
<li><code>-z</code>ï¼šç©ºå­—ç¬¦ä¸²ï¼Œåˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºã€‚ä¾‹å¦‚ï¼Œ<code>if [ -z &quot;$string&quot; ]</code>ä¼šåˆ¤æ–­å˜é‡<code>string</code>æ˜¯å¦ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</li>
<li><code>-x</code>ï¼šæ˜¯å¦å…·æœ‰å¯æ‰§è¡Œæƒé™ï¼Œåˆ¤æ–­æ–‡ä»¶æ˜¯å¦æœ‰å¯æ‰§è¡Œæƒé™ã€‚ä¾‹å¦‚ï¼Œ<code>if [ -x filename ]</code>ä¼šåˆ¤æ–­<code>filename</code>æ˜¯å¦å…·æœ‰å¯æ‰§è¡Œæƒé™ã€‚</li>
<li><code>||</code>ï¼šé€»è¾‘æˆ–ï¼Œè¡¨ç¤ºå•æ–¹æˆç«‹ã€‚ä¾‹å¦‚ï¼Œ<code>command1 || command2</code>ä¼šæ‰§è¡Œ<code>command1</code>ï¼Œå¦‚æœ<code>command1</code>æ‰§è¡Œå¤±è´¥ï¼Œåˆ™æ‰§è¡Œ<code>command2</code>ã€‚</li>
<li><code>&amp;&amp;</code>ï¼šé€»è¾‘ä¸ï¼Œè¡¨ç¤ºåŒæ–¹éƒ½æˆç«‹ã€‚ä¾‹å¦‚ï¼Œ<code>command1 &amp;&amp; command2</code>ä¼šæ‰§è¡Œ<code>command1</code>ï¼Œå¦‚æœ<code>command1</code>æ‰§è¡ŒæˆåŠŸï¼Œåˆ™æ‰§è¡Œ<code>command2</code>ã€‚</li>
</ul>
<h3 id="3-1-3-ä½¿ç”¨å•åˆ†æ”¯è¯­å¥åˆ¤æ–­crond-è¿›ç¨‹æ˜¯å¦åœ¨è¿è¡Œâ€”æ¡ˆä¾‹"><a href="#3-1-3-ä½¿ç”¨å•åˆ†æ”¯è¯­å¥åˆ¤æ–­crond-è¿›ç¨‹æ˜¯å¦åœ¨è¿è¡Œâ€”æ¡ˆä¾‹" class="headerlink" title="3.1.3 ä½¿ç”¨å•åˆ†æ”¯è¯­å¥åˆ¤æ–­crond è¿›ç¨‹æ˜¯å¦åœ¨è¿è¡Œâ€”æ¡ˆä¾‹"></a>3.1.3 ä½¿ç”¨å•åˆ†æ”¯è¯­å¥åˆ¤æ–­crond è¿›ç¨‹æ˜¯å¦åœ¨è¿è¡Œâ€”æ¡ˆä¾‹</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">this is check crond</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">by author rivers on 2021-9.23</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®šä¹‰ä¸€ä¸ªå˜é‡å</span></span><br><span class="line">name=crond</span><br><span class="line">num=$(ps -ef|grep $name|grep -vc grep)</span><br><span class="line">if [ $num -eq 1 ];then</span><br><span class="line">    echo &quot;$num running!&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;$num is not running!&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h3 id="3-1-4-åˆ¤æ–­ç³»ç»Ÿç›®å½•æ˜¯å¦å­˜åœ¨-â€”æ¡ˆä¾‹"><a href="#3-1-4-åˆ¤æ–­ç³»ç»Ÿç›®å½•æ˜¯å¦å­˜åœ¨-â€”æ¡ˆä¾‹" class="headerlink" title="3.1.4 åˆ¤æ–­ç³»ç»Ÿç›®å½•æ˜¯å¦å­˜åœ¨ â€”æ¡ˆä¾‹"></a>3.1.4 åˆ¤æ–­ç³»ç»Ÿç›®å½•æ˜¯å¦å­˜åœ¨ â€”æ¡ˆä¾‹</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">this is check directory</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">by author rivers on 2021-9.27</span> </span><br><span class="line"> if  [  !  -d  /data/rivers  -a  !  -d  /tmp/rivers  ]ï¼›then</span><br><span class="line"> mkdir  -p  /data/rivers  f</span><br><span class="line"> i</span><br></pre></td></tr></table></figure>

<h3 id="3-1-5-å¤šä¸ªæ¡ä»¶åˆ¤æ–­å­¦ç”Ÿåˆ†æ•°ç­‰çº§-â€”-æ¡ˆä¾‹"><a href="#3-1-5-å¤šä¸ªæ¡ä»¶åˆ¤æ–­å­¦ç”Ÿåˆ†æ•°ç­‰çº§-â€”-æ¡ˆä¾‹" class="headerlink" title="3.1.5 å¤šä¸ªæ¡ä»¶åˆ¤æ–­å­¦ç”Ÿåˆ†æ•°ç­‰çº§ â€” æ¡ˆä¾‹"></a>3.1.5 å¤šä¸ªæ¡ä»¶åˆ¤æ–­å­¦ç”Ÿåˆ†æ•°ç­‰çº§ â€” æ¡ˆä¾‹</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">if</span> è¯­å¥å¯ä»¥ç›´æ¥å¯¹å‘½ä»¤çŠ¶æ€è¿›è¡Œåˆ¤æ–­ï¼Œå°±çœå»äº†è·å–$?è¿™ä¸€æ­¥ï¼</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">å¦‚æœç¬¬ä¸€ä¸ªæ¡ä»¶ç¬¦åˆå°±ä¸å†å‘ä¸‹åŒ¹é…</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">this check grade shell</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">by author rivers on 2021-09-27</span></span><br><span class="line">  </span><br><span class="line">  grade=$1</span><br><span class="line">  if [ $grade -gt 90 ];then</span><br><span class="line">    echo &quot;Is&#x27;s very good!&quot;</span><br><span class="line">  elif [ $grade -gt 70 ];then</span><br><span class="line">    echo &quot;Is&#x27;s is good!&quot;</span><br><span class="line">  </span><br><span class="line">  elif [ $grade -ge 60 ];then</span><br><span class="line">    echo &quot;pass&quot;</span><br><span class="line">  </span><br><span class="line">  else</span><br><span class="line">    echo &quot;no pass&quot;</span><br><span class="line">  fi</span><br></pre></td></tr></table></figure>

<h2 id="3-2-for-å¾ªç¯è¯­å¥ä»‹ç»"><a href="#3-2-for-å¾ªç¯è¯­å¥ä»‹ç»" class="headerlink" title="3.2 for å¾ªç¯è¯­å¥ä»‹ç»"></a>3.2 for å¾ªç¯è¯­å¥ä»‹ç»</h2><p>Shellè„šæœ¬ä¸­çš„<code>for</code>å¾ªç¯è¯­å¥ã€‚å®ƒçš„ä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for name [ in [ word ... ] ] ; do</span><br><span class="line">  list</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…å¯ä»¥å†™æˆï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for å˜é‡å in å–å€¼åˆ—è¡¨; do</span><br><span class="line">  è¯­å¥ 1</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯å¯¹è¿™ä¸ª<code>for</code>å¾ªç¯è¯­å¥çš„è¯¦ç»†ä»‹ç»ï¼š</p>
<ul>
<li><code>name</code>æˆ–<code>å˜é‡å</code>ï¼šå¾ªç¯å˜é‡çš„åç§°ï¼Œå¯ä»¥æ˜¯ä»»æ„åˆæ³•çš„å˜é‡åã€‚åœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£ä¸­ï¼Œè¯¥å˜é‡å°†è¢«èµ‹äºˆ<code>å–å€¼åˆ—è¡¨</code>ä¸­çš„ä¸€ä¸ªå€¼ã€‚</li>
<li><code>in</code>ï¼šå…³é”®å­—ï¼Œç”¨äºæŒ‡å®š<code>å–å€¼åˆ—è¡¨</code>çš„å¼€å§‹ã€‚</li>
<li><code>word</code>æˆ–<code>å–å€¼åˆ—è¡¨</code>ï¼šä¸€ä¸ªæˆ–å¤šä¸ªå€¼ï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚è¿™äº›å€¼å°†ä¾æ¬¡èµ‹ç»™å¾ªç¯å˜é‡ï¼Œå¾ªç¯å°†é’ˆå¯¹æ¯ä¸ªå€¼æ‰§è¡Œä¸€æ¬¡ã€‚</li>
<li><code>list</code>æˆ–<code>è¯­å¥ 1</code>ï¼šåœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£ä¸­æ‰§è¡Œçš„å‘½ä»¤åˆ—è¡¨ã€‚å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„å‘½ä»¤å’Œè¯­å¥ã€‚</li>
</ul>
<p><code>for</code>å¾ªç¯çš„å·¥ä½œåŸç†æ˜¯ï¼Œåœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£æ—¶ï¼Œå°†<code>å–å€¼åˆ—è¡¨</code>ä¸­çš„ä¸€ä¸ªå€¼èµ‹ç»™å¾ªç¯å˜é‡ï¼Œç„¶åæ‰§è¡Œ<code>list</code>ä¸­çš„å‘½ä»¤åˆ—è¡¨ã€‚æ¯æ¬¡è¿­ä»£å®Œæˆåï¼Œå¾ªç¯å˜é‡å°†æ›´æ–°ä¸º<code>å–å€¼åˆ—è¡¨</code>ä¸­çš„ä¸‹ä¸€ä¸ªå€¼ï¼Œç›´åˆ°æ‰€æœ‰çš„å€¼éƒ½è¢«å¤„ç†å®Œæ¯•ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜<code>for</code>å¾ªç¯çš„ä½¿ç”¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for fruit in apple banana cherry</span><br><span class="line">do</span><br><span class="line">  echo &quot;I like $fruit&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œå¾ªç¯å˜é‡<code>fruit</code>ä¾æ¬¡è¢«èµ‹å€¼ä¸º<code>apple</code>ã€<code>banana</code>å’Œ<code>cherry</code>ï¼Œç„¶åæ‰§è¡Œ<code>echo</code>è¯­å¥æ‰“å°å‡ºç›¸åº”çš„ç»“æœã€‚å¾ªç¯å°†é‡å¤æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°å¤„ç†å®Œæ‰€æœ‰çš„å€¼ã€‚</p>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">I like apple</span><br><span class="line">I like banana</span><br><span class="line">I like cherry</span><br></pre></td></tr></table></figure>

<p><code>for</code>å¾ªç¯åœ¨Shellè„šæœ¬ä¸­ç»å¸¸ç”¨äºéå†æ•°ç»„ã€æ–‡ä»¶åˆ—è¡¨æˆ–æŒ‡å®šçš„å–å€¼èŒƒå›´ï¼Œå¹¶å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚å®ƒæä¾›äº†ä¸€ç§æ–¹ä¾¿ä¸”ç®€æ´çš„æ–¹å¼æ¥å¤„ç†é‡å¤çš„ä»»åŠ¡ã€‚</p>
<h2 id="3-3-while-å¾ªç¯è¯­å¥ä»‹ç»"><a href="#3-3-while-å¾ªç¯è¯­å¥ä»‹ç»" class="headerlink" title="3.3 while å¾ªç¯è¯­å¥ä»‹ç»"></a>3.3 while å¾ªç¯è¯­å¥ä»‹ç»</h2><p><code>while</code>å¾ªç¯è¯­å¥æ˜¯Shellè„šæœ¬ä¸­ç”¨äºé‡å¤æ‰§è¡Œä¸€ç»„å‘½ä»¤æˆ–è¯­å¥çš„ä¸€ç§å¾ªç¯ç»“æ„ã€‚å®ƒçš„ä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">while è¡¨è¾¾å¼</span><br><span class="line">do</span><br><span class="line">  è¯­å¥1</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯å¯¹<code>while</code>å¾ªç¯è¯­å¥çš„è¯¦ç»†ä»‹ç»ï¼š</p>
<ul>
<li><code>è¡¨è¾¾å¼</code>ï¼šä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦ç»§ç»­æ‰§è¡Œå¾ªç¯ã€‚å¦‚æœè¡¨è¾¾å¼çš„å€¼ä¸ºçœŸï¼ˆéé›¶ï¼‰ï¼Œåˆ™å¾ªç¯ä¼šä¸€ç›´æ‰§è¡Œï¼›å¦‚æœè¡¨è¾¾å¼çš„å€¼ä¸ºå‡ï¼ˆé›¶ï¼‰ï¼Œåˆ™å¾ªç¯ç»“æŸã€‚</li>
<li><code>è¯­å¥1</code>ï¼šåœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£ä¸­æ‰§è¡Œçš„å‘½ä»¤åˆ—è¡¨ã€‚å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„å‘½ä»¤å’Œè¯­å¥ã€‚</li>
</ul>
<p><code>while</code>å¾ªç¯çš„å·¥ä½œåŸç†æ˜¯ï¼Œé¦–å…ˆå¯¹<code>è¡¨è¾¾å¼</code>è¿›è¡Œæ±‚å€¼ï¼Œå¦‚æœè¡¨è¾¾å¼çš„å€¼ä¸ºçœŸï¼Œåˆ™æ‰§è¡Œ<code>è¯­å¥1</code>ä¸­çš„å‘½ä»¤åˆ—è¡¨ã€‚æ‰§è¡Œå®Œ<code>è¯­å¥1</code>åï¼Œå†æ¬¡å¯¹<code>è¡¨è¾¾å¼</code>è¿›è¡Œæ±‚å€¼ï¼Œå¦‚æœä»ç„¶ä¸ºçœŸï¼Œåˆ™ç»§ç»­æ‰§è¡Œ<code>è¯­å¥1</code>ï¼Œä»¥æ­¤ç±»æ¨ã€‚ç›´åˆ°<code>è¡¨è¾¾å¼</code>çš„å€¼ä¸ºå‡æ—¶ï¼Œå¾ªç¯ç»“æŸï¼Œç¨‹åºå°†è·³å‡ºå¾ªç¯å¹¶ç»§ç»­æ‰§è¡Œå¾ªç¯ä¹‹åçš„ä»£ç ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜<code>while</code>å¾ªç¯çš„ä½¿ç”¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">count=0</span><br><span class="line">while [ $count -lt 5 ]</span><br><span class="line">do</span><br><span class="line">  echo &quot;Count: $count&quot;</span><br><span class="line">  count=$((count+1))</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œ<code>count</code>å˜é‡åˆå§‹å€¼ä¸º0ã€‚<code>while</code>å¾ªç¯ä¼šåˆ¤æ–­<code>$count -lt 5</code>çš„æ¡ä»¶è¡¨è¾¾å¼ï¼Œå¦‚æœä¸ºçœŸï¼Œåˆ™æ‰§è¡Œ<code>echo</code>è¯­å¥æ‰“å°å‡ºå½“å‰çš„<code>count</code>å€¼ï¼Œå¹¶å°†<code>count</code>çš„å€¼é€’å¢1ã€‚å¾ªç¯å°†é‡å¤æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°<code>count</code>çš„å€¼å¤§äºç­‰äº5æ—¶ï¼Œå¾ªç¯ç»“æŸã€‚</p>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Count: 0</span><br><span class="line">Count: 1</span><br><span class="line">Count: 2</span><br><span class="line">Count: 3</span><br><span class="line">Count: 4</span><br></pre></td></tr></table></figure>

<p><code>while</code>å¾ªç¯å¯ç”¨äºå¯¹æ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼Œå¹¶åœ¨æ»¡è¶³æ¡ä»¶æ—¶åå¤æ‰§è¡Œä¸€ç»„å‘½ä»¤æˆ–è¯­å¥ã€‚å®ƒæä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼æ¥å¤„ç†éœ€è¦é‡å¤æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç›´åˆ°æ»¡è¶³æŸä¸ªæ¡ä»¶æ‰åœæ­¢å¾ªç¯ã€‚</p>
<h3 id="3-3-1-breakå’Œcontinue"><a href="#3-3-1-breakå’Œcontinue" class="headerlink" title="3.3.1 breakå’Œcontinue"></a>3.3.1 breakå’Œcontinue</h3><p><code>break</code>å’Œ<code>continue</code>æ˜¯åœ¨å¾ªç¯ä¸­ä½¿ç”¨çš„æ§åˆ¶è¯­å¥ï¼Œå¯ä»¥å¯¹å¾ªç¯çš„æ‰§è¡Œè¿›è¡Œæ§åˆ¶ã€‚</p>
<ul>
<li><code>break</code>è¯­å¥ç”¨äºç»ˆæ­¢å½“å‰æ‰€åœ¨çš„å¾ªç¯ï¼Œè·³å‡ºå¾ªç¯ä½“ï¼Œç»§ç»­æ‰§è¡Œå¾ªç¯ä¹‹åçš„ä»£ç ã€‚å®ƒé€šå¸¸ç”¨äºæ»¡è¶³æŸä¸ªæ¡ä»¶æ—¶æå‰ç»“æŸå¾ªç¯ã€‚åœ¨ç¤ºä¾‹1ä¸­çš„ä»£ç ä¸­ï¼Œå½“<code>$N</code>çš„å€¼ç­‰äº5æ—¶ï¼Œæ‰§è¡Œäº†<code>break</code>è¯­å¥ï¼Œç»ˆæ­¢äº†<code>while</code>å¾ªç¯çš„æ‰§è¡Œã€‚</li>
<li><code>continue</code>è¯­å¥ç”¨äºè·³è¿‡å½“å‰å¾ªç¯è¿­ä»£çš„å‰©ä½™ä»£ç ï¼Œç›´æ¥è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯è¿­ä»£ã€‚å®ƒé€šå¸¸ç”¨äºåœ¨ç‰¹å®šæƒ…å†µä¸‹è·³è¿‡æŸäº›å¾ªç¯è¿­ä»£ã€‚åœ¨ç¤ºä¾‹2ä¸­çš„ä»£ç ä¸­ï¼Œå½“<code>$N</code>çš„å€¼ç­‰äº3æ—¶ï¼Œæ‰§è¡Œäº†<code>continue</code>è¯­å¥ï¼Œè·³è¿‡äº†<code>echo</code>è¯­å¥ï¼Œç›´æ¥è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯è¿­ä»£ã€‚</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨<code>break</code>å’Œ<code>continue</code>è¯­å¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">i=0</span><br><span class="line">while ((i&lt;=100))</span><br><span class="line">do</span><br><span class="line">    if ((i % 2 == 0))</span><br><span class="line">    then</span><br><span class="line">        i=$((i+1))</span><br><span class="line">        continue</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    if ((i &gt; 50))</span><br><span class="line">    then</span><br><span class="line">        break</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    echo $i</span><br><span class="line">    i=$((i+1))</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå¾ªç¯ä»0åˆ°100æ‰“å°æ•°å­—ã€‚ä½¿ç”¨äº†<code>continue</code>è¯­å¥æ¥è·³è¿‡å¶æ•°ï¼Œä½¿ç”¨äº†<code>break</code>è¯­å¥æ¥ç»ˆæ­¢å¾ªç¯å½“æ•°å­—å¤§äº50æ—¶ã€‚è¾“å‡ºç»“æœä¸º1åˆ°49çš„å¥‡æ•°ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<ul>
<li><code>break</code>ç”¨äºç»ˆæ­¢å½“å‰å¾ªç¯ï¼Œå¹¶è·³å‡ºå¾ªç¯ä½“ã€‚</li>
<li><code>continue</code>ç”¨äºè·³è¿‡å½“å‰å¾ªç¯è¿­ä»£çš„å‰©ä½™ä»£ç ï¼Œç›´æ¥è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯è¿­ä»£ã€‚</li>
</ul>
<h3 id="3-3-2-Whileå¾ªç¯æ±‚1-100çš„æ€»å’Œ-â€”æ¡ˆä¾‹"><a href="#3-3-2-Whileå¾ªç¯æ±‚1-100çš„æ€»å’Œ-â€”æ¡ˆä¾‹" class="headerlink" title="3.3.2  Whileå¾ªç¯æ±‚1-100çš„æ€»å’Œ â€”æ¡ˆä¾‹"></a>3.3.2  Whileå¾ªç¯æ±‚1-100çš„æ€»å’Œ â€”æ¡ˆä¾‹</h3><p>è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨<code>while</code>å¾ªç¯æ±‚è§£1åˆ°100çš„æ€»å’Œçš„æ¡ˆä¾‹ã€‚åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ä¸ªå˜é‡<code>i</code>å’Œ<code>j</code>ï¼Œå…¶ä¸­<code>i</code>ç”¨äºå¾ªç¯è®¡æ•°ï¼Œ<code>j</code>ç”¨äºå­˜å‚¨æ±‚å’Œçš„ç»“æœã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">by author rivers on 2021-9-27</span></span><br><span class="line"></span><br><span class="line">j=0</span><br><span class="line">i=1</span><br><span class="line">while ((i&lt;=100))</span><br><span class="line">do</span><br><span class="line">    j=$((j+i))</span><br><span class="line">    ((i++))</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo $j</span><br></pre></td></tr></table></figure>

<p>åœ¨å¾ªç¯å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å°†å˜é‡<code>j</code>åˆå§‹åŒ–ä¸º0ï¼Œå˜é‡<code>i</code>åˆå§‹åŒ–ä¸º1ã€‚ç„¶åï¼Œä½¿ç”¨<code>while</code>å¾ªç¯æ¥è¿­ä»£ä»1åˆ°100çš„æ‰€æœ‰æ•°å­—ã€‚</p>
<p>åœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬å°†å½“å‰çš„æ•°å€¼<code>i</code>åŠ åˆ°å˜é‡<code>j</code>ä¸Šï¼Œä»¥ç´¯ç§¯æ±‚å’Œçš„ç»“æœã€‚ç„¶åï¼Œé€šè¿‡é€’å¢<code>i</code>çš„å€¼æ¥æ›´æ–°å¾ªç¯è®¡æ•°ã€‚</p>
<p>å½“<code>i</code>çš„å€¼å¤§äº100æ—¶ï¼Œå¾ªç¯ç»ˆæ­¢ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨<code>echo</code>è¯­å¥è¾“å‡ºæ±‚å’Œçš„ç»“æœ<code>j</code>ã€‚</p>
<p>è¿è¡Œè¯¥è„šæœ¬ï¼Œå°†ä¼šè¾“å‡º1åˆ°100çš„æ€»å’Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">5050</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œé€šè¿‡ä½¿ç”¨<code>while</code>å¾ªç¯å’Œç´¯åŠ æ“ä½œï¼Œæˆ‘ä»¬æˆåŠŸæ±‚å¾—äº†1åˆ°100çš„æ€»å’Œã€‚</p>
<h3 id="3-3-3-æ¯10ç§’å¾ªç¯åˆ¤æ–­ä¸€æ¬¡-hbsç”¨æˆ·æ˜¯å¦ç™»å½•ç³»ç»Ÿ"><a href="#3-3-3-æ¯10ç§’å¾ªç¯åˆ¤æ–­ä¸€æ¬¡-hbsç”¨æˆ·æ˜¯å¦ç™»å½•ç³»ç»Ÿ" class="headerlink" title="3.3.3 æ¯10ç§’å¾ªç¯åˆ¤æ–­ä¸€æ¬¡ hbsç”¨æˆ·æ˜¯å¦ç™»å½•ç³»ç»Ÿ"></a>3.3.3 æ¯10ç§’å¾ªç¯åˆ¤æ–­ä¸€æ¬¡ hbsç”¨æˆ·æ˜¯å¦ç™»å½•ç³»ç»Ÿ</h3><p>è¿™æ˜¯ä¸€ä¸ªæ¯10ç§’å¾ªç¯åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ç³»ç»Ÿçš„æ¡ˆä¾‹ã€‚åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªæ— é™å¾ªç¯<code>while true</code>æ¥è¿›è¡Œå¾ªç¯åˆ¤æ–­ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Check File to change.</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">By author rivers 2021-9-27</span></span><br><span class="line"></span><br><span class="line">USERS=&quot;hbs&quot;</span><br><span class="line">while true</span><br><span class="line">do</span><br><span class="line">    echo &quot;The Time is `date +%F-%T`&quot;</span><br><span class="line">    sleep 10</span><br><span class="line">    NUM=`who|grep &quot;$USERS&quot;|wc -l`</span><br><span class="line">    if [[ $NUM -ge 1 ]];then</span><br><span class="line">        echo &quot;The $USERS is login in system.&quot;</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>åœ¨å¾ªç¯å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å°†è¦æ£€æŸ¥çš„ç”¨æˆ·åå®šä¹‰ä¸ºå˜é‡<code>USERS</code>ï¼Œè¿™é‡Œè®¾ç½®ä¸ºâ€hbsâ€ï¼Œå¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹ã€‚</p>
<p>ç„¶åï¼Œä½¿ç”¨<code>while true</code>æ¥åˆ›å»ºä¸€ä¸ªæ— é™å¾ªç¯ï¼Œè¡¨ç¤ºæ¯10ç§’è¿›è¡Œä¸€æ¬¡åˆ¤æ–­ã€‚</p>
<p>åœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨<code>date</code>å‘½ä»¤è¾“å‡ºå½“å‰æ—¶é—´ã€‚</p>
<p>ç„¶åï¼Œé€šè¿‡<code>who</code>å‘½ä»¤è·å–å½“å‰ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨<code>grep</code>å‘½ä»¤è¿‡æ»¤å‡ºåŒ…å«æŒ‡å®šç”¨æˆ·åçš„è¡Œã€‚ä½¿ç”¨<code>wc -l</code>å‘½ä»¤ç»Ÿè®¡æ»¡è¶³æ¡ä»¶çš„è¡Œæ•°ï¼Œå°†ç»“æœä¿å­˜åœ¨å˜é‡<code>NUM</code>ä¸­ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¡ä»¶è¯­å¥<code>if</code>åˆ¤æ–­<code>NUM</code>æ˜¯å¦å¤§äºç­‰äº1ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¾“å‡ºç›¸åº”çš„æç¤ºä¿¡æ¯ï¼Œè¡¨ç¤ºè¯¥ç”¨æˆ·å·²ç™»å½•ç³»ç»Ÿã€‚</p>
<p>æœ€åï¼Œä½¿ç”¨<code>sleep 10</code>å‘½ä»¤ä½¿è„šæœ¬æš‚åœ10ç§’ï¼Œç„¶åç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚</p>
<p>è¿è¡Œè¯¥è„šæœ¬ï¼Œå°†ä¼šæ¯10ç§’åˆ¤æ–­ä¸€æ¬¡ç”¨æˆ·â€hbsâ€æ˜¯å¦ç™»å½•ç³»ç»Ÿï¼Œå¹¶åœ¨ç™»å½•æ—¶è¾“å‡ºç›¸åº”çš„æç¤ºä¿¡æ¯ã€‚</p>
<h2 id="3-4-case-é€‰æ‹©è¯­å¥ä»‹ç»"><a href="#3-4-case-é€‰æ‹©è¯­å¥ä»‹ç»" class="headerlink" title="3.4 case é€‰æ‹©è¯­å¥ä»‹ç»"></a>3.4 case é€‰æ‹©è¯­å¥ä»‹ç»</h2><p>Caseé€‰æ‹©è¯­å¥æ˜¯ä¸€ç§ç”¨äºå¯¹å¤šä¸ªé€‰æ‹©æ¡ä»¶è¿›è¡ŒåŒ¹é…è¾“å‡ºçš„è¯­å¥ã€‚å®ƒç±»ä¼¼äºif-elifè¯­å¥ç»“æ„ï¼Œé€šå¸¸åœ¨è„šæœ¬ä¸­ç”¨äºæ ¹æ®è¾“å…¥å‚æ•°çš„ä¸åŒæƒ…å†µæ‰“å°è¾“å‡ºç»“æœå’Œå†…å®¹ã€‚</p>
<p>Caseé€‰æ‹©è¯­å¥çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">case æ¨¡å¼å in</span><br><span class="line">  æ¨¡å¼1)</span><br><span class="line">    å‘½ä»¤1</span><br><span class="line">    ;;</span><br><span class="line">  æ¨¡å¼2)</span><br><span class="line">    å‘½ä»¤2</span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    ä¸ç¬¦åˆä»¥ä¸Šæ¨¡å¼æ—¶æ‰§è¡Œçš„å‘½ä»¤</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªè¯­æ³•æ ¼å¼ä¸­ï¼Œ<code>æ¨¡å¼å</code>æ˜¯è¦åŒ¹é…çš„å€¼æˆ–è¡¨è¾¾å¼ï¼Œå¯ä»¥æ˜¯å˜é‡æˆ–å¸¸é‡ã€‚</p>
<p>æ¯ä¸ªæ¨¡å¼ä½¿ç”¨åœ†æ‹¬å·<code>(</code>å’Œ<code>)</code>æ‹¬èµ·æ¥ï¼Œå¹¶ä»¥åŒå†’å·<code>;;</code>ç»“æŸã€‚åœ¨æ¯ä¸ªæ¨¡å¼ä¸‹é¢ï¼Œå¯ä»¥å†™å…¥ç›¸åº”çš„å‘½ä»¤ã€‚</p>
<p>å½“<code>æ¨¡å¼å</code>ä¸æŸä¸ªæ¨¡å¼åŒ¹é…æ—¶ï¼Œå¯¹åº”çš„å‘½ä»¤å°†è¢«æ‰§è¡Œã€‚å¦‚æœæ²¡æœ‰åŒ¹é…ä»»ä½•æ¨¡å¼ï¼Œå°†æ‰§è¡Œ<code>*)</code>ä¸‹çš„å‘½ä»¤ï¼Œå®ƒè¡¨ç¤ºä¸ç¬¦åˆä»¥ä¸Šæ¨¡å¼æ—¶è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†Caseé€‰æ‹©è¯­å¥çš„ç”¨æ³•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">fruit=&quot;apple&quot;</span><br><span class="line"></span><br><span class="line">case $fruit in</span><br><span class="line">  &quot;apple&quot;)</span><br><span class="line">    echo &quot;Selected fruit: Apple&quot;</span><br><span class="line">    ;;</span><br><span class="line">  &quot;banana&quot;)</span><br><span class="line">    echo &quot;Selected fruit: Banana&quot;</span><br><span class="line">    ;;</span><br><span class="line">  &quot;orange&quot;)</span><br><span class="line">    echo &quot;Selected fruit: Orange&quot;</span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    echo &quot;Unknown fruit&quot;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå˜é‡<code>fruit</code>ï¼Œå¹¶å°†å…¶å€¼è®¾ç½®ä¸ºâ€appleâ€ã€‚</p>
<p>ç„¶åï¼Œä½¿ç”¨Caseé€‰æ‹©è¯­å¥æ¥åŒ¹é…<code>fruit</code>çš„å€¼ã€‚å¦‚æœ<code>fruit</code>çš„å€¼ä¸æŸä¸ªæ¨¡å¼åŒ¹é…ï¼Œå°†æ‰§è¡Œç›¸åº”çš„å‘½ä»¤ã€‚</p>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>fruit</code>çš„å€¼ä¸ºâ€appleâ€ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªæ¨¡å¼è¢«åŒ¹é…ï¼Œå‘½ä»¤<code>echo &quot;Selected fruit: Apple&quot;</code>å°†è¢«æ‰§è¡Œï¼Œè¾“å‡ºâ€Selected fruit: Appleâ€ã€‚</p>
<p>å¦‚æœå°†<code>fruit</code>çš„å€¼æ”¹ä¸ºâ€bananaâ€ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªæ¨¡å¼å°†è¢«åŒ¹é…ï¼Œè¾“å‡ºç»“æœå°†æ˜¯â€Selected fruit: Bananaâ€ã€‚</p>
<p>å¦‚æœ<code>fruit</code>çš„å€¼ä¸åŒ¹é…ä»»ä½•æ¨¡å¼ï¼Œå°†æ‰§è¡Œ<code>*)</code>ä¸‹çš„å‘½ä»¤ï¼Œè¾“å‡ºâ€Unknown fruitâ€ã€‚</p>
<h2 id="3-5-Selecté€‰æ‹©è¯­å¥"><a href="#3-5-Selecté€‰æ‹©è¯­å¥" class="headerlink" title="3.5 Selecté€‰æ‹©è¯­å¥"></a>3.5 Selecté€‰æ‹©è¯­å¥</h2><p>Selecté€‰æ‹©è¯­å¥æ˜¯ä¸€ç§ç±»ä¼¼äºforå¾ªç¯çš„è¯­å¥ï¼Œç”¨äºåˆ›å»ºé€‰æ‹©èœå•ã€‚å®ƒé€šå¸¸ä¸PS3ç»“åˆä½¿ç”¨ï¼Œç”¨äºæ‰“å°èœå•çš„è¾“å‡ºä¿¡æ¯ã€‚</p>
<p>Selecté€‰æ‹©è¯­å¥çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">select å˜é‡å in è¡¨è¾¾å¼</span><br><span class="line">do</span><br><span class="line">  è¯­å¥</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªè¯­æ³•æ ¼å¼ä¸­ï¼Œ<code>å˜é‡å</code>ç”¨äºä¿å­˜ç”¨æˆ·é€‰æ‹©çš„å€¼ã€‚<code>è¡¨è¾¾å¼</code>å¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€æ•°ç»„æˆ–å‘½ä»¤çš„è¾“å‡ºç»“æœã€‚</p>
<p>åœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£ä¸­ï¼Œä¼šæ‰“å°å‡ºä¸€ä¸ªå¸¦æœ‰é€‰æ‹©ç´¢å¼•çš„èœå•ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®æç¤ºé€‰æ‹©å…¶ä¸­ä¸€ä¸ªé€‰é¡¹ã€‚</p>
<p>å½“ç”¨æˆ·è¿›è¡Œé€‰æ‹©åï¼Œé€‰æ‹©çš„å€¼å°†ä¼šä¿å­˜åœ¨<code>å˜é‡å</code>ä¸­ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„è¯­å¥ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†Selecté€‰æ‹©è¯­å¥çš„ç”¨æ³•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">by author rivers on 2021-9-27</span></span><br><span class="line"></span><br><span class="line">PS3=&quot;Select a number: &quot;</span><br><span class="line">while true; do</span><br><span class="line">  select mysql_version in 5.1 5.6 quit;</span><br><span class="line">  do</span><br><span class="line">    case $mysql_version in</span><br><span class="line">      5.1)</span><br><span class="line">        echo &quot;mysql 5.1&quot;</span><br><span class="line">        break</span><br><span class="line">        ;;</span><br><span class="line">      5.6)</span><br><span class="line">        echo &quot;mysql 5.6&quot;</span><br><span class="line">        break</span><br><span class="line">        ;;</span><br><span class="line">      quit)</span><br><span class="line">        exit</span><br><span class="line">        ;;</span><br><span class="line">      *)</span><br><span class="line">        echo &quot;Input error, Please enter again!&quot;</span><br><span class="line">        break</span><br><span class="line">    esac</span><br><span class="line">  done</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªPS3å˜é‡ï¼Œç”¨äºæç¤ºç”¨æˆ·é€‰æ‹©ä¸€ä¸ªæ•°å­—ã€‚</p>
<p>ç„¶åï¼Œä½¿ç”¨selecté€‰æ‹©è¯­å¥åˆ›å»ºäº†ä¸€ä¸ªèœå•ï¼Œèœå•é€‰é¡¹æ˜¯â€5.1â€ã€â€5.6â€å’Œâ€quitâ€ã€‚</p>
<p>åœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£ä¸­ï¼Œä¼šæ‰“å°å‡ºèœå•ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·çš„é€‰æ‹©ã€‚</p>
<p>æ ¹æ®ç”¨æˆ·çš„é€‰æ‹©ï¼Œä½¿ç”¨caseé€‰æ‹©è¯­å¥æ‰§è¡Œç›¸åº”çš„å‘½ä»¤ã€‚å¦‚æœé€‰æ‹©äº†â€5.1â€ï¼Œåˆ™è¾“å‡ºâ€mysql 5.1â€ï¼›å¦‚æœé€‰æ‹©äº†â€5.6â€ï¼Œåˆ™è¾“å‡ºâ€mysql 5.6â€ï¼›å¦‚æœé€‰æ‹©äº†â€quitâ€ï¼Œåˆ™é€€å‡ºè„šæœ¬ï¼›å¦‚æœé€‰æ‹©äº†å…¶ä»–å€¼ï¼Œè¾“å‡ºâ€Input error, Please enter again!â€ã€‚</p>
<h2 id="3-6-Shellå‡½æ•°"><a href="#3-6-Shellå‡½æ•°" class="headerlink" title="3.6 Shellå‡½æ•°"></a>3.6 Shellå‡½æ•°</h2><p>Shellå‡½æ•°æ˜¯ä¸€ç»„å‘½ä»¤æˆ–è¯­å¥çš„å¯é‡ç”¨å—ï¼Œå¯ä»¥åœ¨Shellè„šæœ¬ä¸­å®šä¹‰ä¸€æ¬¡ï¼Œç„¶åéšæ—¶è°ƒç”¨ï¼Œé¿å…äº†é‡å¤ç¼–å†™ç›¸åŒçš„ä»£ç å—ã€‚å‡½æ•°çš„è¯­æ³•æ ¼å¼æ˜¯ä»¥â€function name()â€å¼€å§‹ï¼Œä»¥â€}â€ç»“æŸã€‚</p>
<p>åœ¨Shellç¼–ç¨‹ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹æ— æ³•å°†å‚æ•°ä¼ é€’ç»™å‡½æ•°çš„æ‹¬å·å†…éƒ¨ï¼Œè€Œæ˜¯é€šè¿‡è°ƒç”¨å‡½æ•°åç§°æ—¶ä¼ é€’å‚æ•°ï¼Œä¾‹å¦‚â€func arg1 arg2â€ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹çš„Shellè„šæœ¬ï¼Œå…¶ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸ºâ€funcâ€çš„å‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨è®¡ç®—äº†ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œå¹¶ä½¿ç”¨â€returnâ€è¯­å¥è¿”å›è¯¥å€¼ã€‚ç„¶åï¼Œè°ƒç”¨è¯¥å‡½æ•°å¹¶æ‰“å°è¿”å›çš„å€¼ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">func() &#123;</span><br><span class="line">    VAR=$((1+1))</span><br><span class="line">    return $VAR</span><br><span class="line">    echo &quot;This is a function.&quot;</span><br><span class="line">&#125;</span><br><span class="line">func</span><br><span class="line">echo $?</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¿è¡Œâ€bash test.shâ€å‘½ä»¤ï¼Œå°†æ‰§è¡Œä¸Šè¿°è„šæœ¬ï¼Œè°ƒç”¨â€funcâ€å‡½æ•°ï¼Œå¹¶æ‰“å°è¿”å›çš„å€¼ã€‚</p>
<h2 id="3-7-shellæ•°ç»„"><a href="#3-7-shellæ•°ç»„" class="headerlink" title="3.7 shellæ•°ç»„"></a>3.7 shellæ•°ç»„</h2><p>åœ¨Shellç¼–ç¨‹ä¸­ï¼Œæ•°ç»„æ˜¯ä¸€ç»„æŒ‰ç…§ç‰¹å®šé¡ºåºæ’åˆ—çš„ç›¸åŒç±»å‹å…ƒç´ çš„é›†åˆã€‚ä»¥ä¸‹æ˜¯å…³äºæ•°ç»„çš„ä¸€äº›å¸¸è§ç”¨æ³•å’Œè¯­æ³•ï¼š</p>
<ol>
<li>åˆå§‹åŒ–æ•°ç»„ï¼š<ul>
<li>ä½¿ç”¨å°æ‹¬å·å°†å…ƒç´ æ‹¬èµ·æ¥ï¼Œå¹¶ä½¿ç”¨ç©ºæ ¼åˆ†éš”å…ƒç´ ã€‚</li>
<li>æ ¼å¼ï¼šarray&#x3D;(å…ƒç´ 1 å…ƒç´ 2 å…ƒç´ 3 â€¦)</li>
<li>ä¾‹å¦‚ï¼šarray&#x3D;(â€œaâ€ â€œbâ€ â€œcâ€)ï¼Œè¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«å…ƒç´  â€œaâ€ã€â€bâ€ å’Œ â€œcâ€ çš„æ•°ç»„ã€‚</li>
</ul>
</li>
<li>æ–°å»ºæ•°ç»„å¹¶æ·»åŠ å…ƒç´ ï¼š<ul>
<li>ä½¿ç”¨ä¸‹æ ‡æ¥ä¸ºæ•°ç»„åˆ†é…å…ƒç´ ã€‚</li>
<li>æ ¼å¼ï¼šarray[ä¸‹æ ‡]&#x3D;å…ƒç´ </li>
<li>ä¾‹å¦‚ï¼šarray[0]&#x3D;â€aâ€ï¼Œarray[1]&#x3D;â€bâ€ï¼Œarray[2]&#x3D;â€câ€ï¼Œè¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«å…ƒç´  â€œaâ€ã€â€bâ€ å’Œ â€œcâ€ çš„æ•°ç»„ã€‚</li>
</ul>
</li>
<li>å°†å‘½ä»¤è¾“å‡ºä½œä¸ºæ•°ç»„å…ƒç´ ï¼š<ul>
<li>ä½¿ç”¨å‘½ä»¤çš„è¾“å‡ºç»“æœä½œä¸ºæ•°ç»„çš„å…ƒç´ ã€‚</li>
<li>æ ¼å¼ï¼šarray&#x3D;($(command))</li>
<li>ä¾‹å¦‚ï¼šarray&#x3D;($(ls))ï¼Œè¿™æ ·å°±å°† â€œlsâ€ å‘½ä»¤çš„è¾“å‡ºç»“æœä½œä¸ºæ•°ç»„çš„å…ƒç´ ã€‚</li>
</ul>
</li>
</ol>
<p>è¯·æ³¨æ„ï¼Œæ•°ç»„çš„ä¸‹æ ‡ä»0å¼€å§‹è®¡æ•°ã€‚å¯ä»¥ä½¿ç”¨ä¸‹æ ‡æ¥è®¿é—®æ•°ç»„çš„å…ƒç´ ï¼Œä¾‹å¦‚ ${array[0]} è¡¨ç¤ºæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨æ•°ç»„ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">array=(&quot;a&quot; &quot;b&quot; &quot;c&quot;)  # ä½¿ç”¨å°æ‹¬å·åˆå§‹åŒ–æ•°ç»„</span><br><span class="line">echo &quot;æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼š$&#123;array[0]&#125;&quot;</span><br><span class="line">echo &quot;æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼š$&#123;array[1]&#125;&quot;</span><br><span class="line">echo &quot;æ•°ç»„çš„ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼š$&#123;array[2]&#125;&quot;</span><br><span class="line"></span><br><span class="line">new_array=()  # æ–°å»ºä¸€ä¸ªç©ºæ•°ç»„</span><br><span class="line">new_array[0]=&quot;x&quot;  # æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ </span><br><span class="line">new_array[1]=&quot;y&quot;  # æ·»åŠ ç¬¬äºŒä¸ªå…ƒç´ </span><br><span class="line">new_array[2]=&quot;z&quot;  # æ·»åŠ ç¬¬ä¸‰ä¸ªå…ƒç´ </span><br><span class="line">echo &quot;æ–°æ•°ç»„çš„å…ƒç´ ï¼š$&#123;new_array[@]&#125;&quot;</span><br><span class="line"></span><br><span class="line">command_output=($(ls))  # å°† ls å‘½ä»¤çš„è¾“å‡ºä½œä¸ºæ•°ç»„å…ƒç´ </span><br><span class="line">echo &quot;å‘½ä»¤è¾“å‡ºä½œä¸ºæ•°ç»„å…ƒç´ ï¼š$&#123;command_output[@]&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¿è¡Œä¸Šè¿°è„šæœ¬ï¼Œæ‚¨å°†çœ‹åˆ°è¾“å‡ºç»“æœæ˜¾ç¤ºäº†æ•°ç»„çš„å…ƒç´ å’Œå‘½ä»¤è¾“å‡ºä½œä¸ºæ•°ç»„å…ƒç´ çš„æƒ…å†µã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
  </entry>
  <entry>
    <title>é¦™æ©™æ´¾æ–‡ä»¶ç³»ç»Ÿæ„å»ºè„šæœ¬åˆ†æ</title>
    <url>/2023/12/02/16-%E9%A6%99%E6%A9%99%E6%B4%BE%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ€ä¹ˆè¯´å‘¢ï¼Œå¥½å®¹æ˜“èƒ½é™ä¸‹å¿ƒæ¥æ¥åˆ†æä¸€ä¸‹ï¼Œå€’æ„Ÿè§‰ä¹Ÿæ˜¯ä¸é”™çš„ï¼Œè¿™ä¸‰ä¸ªæœˆæ¥ä¹Ÿç®—æ˜¯åˆå­¦ä¹ åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œå¸Œæœ›é‡æ–°æ¥ä¸€éèƒ½è®©æˆ‘æœ‰æ‰€æ”¶è·ã€‚</p>
<h1 id="1-build-sh-åˆ†æ"><a href="#1-build-sh-åˆ†æ" class="headerlink" title="1.build.sh åˆ†æ"></a>1.build.sh åˆ†æ</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ¹ç›®å½•åœ°å€</span></span><br><span class="line">SRC=&quot;$(dirname &quot;$(realpath &quot;$&#123;BASH_SOURCE[0]&#125;&quot;)&quot;)&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">check <span class="keyword">for</span> whitespace <span class="keyword">in</span> <span class="variable">$&#123;SRC&#125;</span> and <span class="built_in">exit</span> <span class="keyword">for</span> safety reasons</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥å˜é‡ <span class="variable">$&#123;SRC&#125;</span> æ˜¯å¦åŒ…å«ç©ºç™½å­—ç¬¦</span></span><br><span class="line">grep -q &quot;[[:space:]]&quot; &lt;&lt;&lt;&quot;$&#123;SRC&#125;&quot; &amp;&amp; &#123; echo &quot;\&quot;$&#123;SRC&#125;\&quot; contains whitespace. Not supported. Aborting.&quot; &gt;&amp;2 ; exit 1 ; &#125;</span><br><span class="line"></span><br><span class="line">cd &quot;$&#123;SRC&#125;&quot; || exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™ä¸ªå˜é‡æ²¡æœ‰ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥</span></span><br><span class="line">if [[ &quot;$&#123;ORANGEPI_ENABLE_CALL_TRACING&#125;&quot; == &quot;yes&quot; ]]; then</span><br><span class="line">	set -T # inherit return/debug traps</span><br><span class="line">	mkdir -p &quot;$&#123;SRC&#125;&quot;/output/debug</span><br><span class="line">	echo -n &quot;&quot; &gt; &quot;$&#123;SRC&#125;&quot;/output/debug/calls.txt</span><br><span class="line">	trap &#x27;echo &quot;$&#123;BASH_LINENO[@]&#125;|$&#123;BASH_SOURCE[@]&#125;|$&#123;FUNCNAME[@]&#125;&quot; &gt;&gt; $&#123;SRC&#125;/output/debug/calls.txt ;&#x27; RETURN</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™ä¸ªgeneral.sh è„šæœ¬æ˜¯æœ‰çš„ï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œï¼Œä¸‹ä¸€ä¸ªå°èŠ‚å°±æ˜¯ä»–çš„è®²è§£ï¼Œå…³äºè¿™ä¸ªæ–‡ä»¶åªæ˜¯å®šä¹‰äº†ä¸€äº›å‡½æ•°ï¼Œå®é™…ä¸Šæ²¡æœ‰è¦æ‰§è¡Œçš„</span></span><br><span class="line">if [[ -f &quot;$&#123;SRC&#125;&quot;/scripts/general.sh ]]; then</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">shellcheck <span class="built_in">source</span>=scripts/general.sh</span></span><br><span class="line">	source &quot;$&#123;SRC&#125;&quot;/scripts/general.sh</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line"></span><br><span class="line">	echo &quot;Error: missing build directory structure&quot;</span><br><span class="line">	echo &quot;Please clone the full repository by https://github.com/orangepi-xunlong/orangepi-build&quot;</span><br><span class="line">	exit 255</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Add the variables needed at the beginning of the path</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ä¼ å…¥çš„å‚æ•°å¹¶è®¾ç½®ç›¸åº”çš„å˜é‡ï¼Œæˆ‘è¿™é‡Œå¹¶æ²¡æœ‰ä¼ å…¥å˜é‡ï¼Œè€Œæ˜¯ç›´æ¥çš„build.sh</span></span><br><span class="line">check_args ()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">for p in &quot;$@&quot;; do</span><br><span class="line"></span><br><span class="line">	case &quot;$&#123;p%=*&#125;&quot; in</span><br><span class="line">		LIB_TAG)</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">Take a variable <span class="keyword">if</span> the branch exists locally</span></span><br><span class="line">			if [ &quot;$&#123;p#*=&#125;&quot; == &quot;$(git branch | \</span><br><span class="line">				gawk -v b=&quot;$&#123;p#*=&#125;&quot; &#x27;&#123;if ( $NF == b ) &#123;print $NF&#125;&#125;&#x27;)&quot; ]; then</span><br><span class="line">				echo -e &quot;[\e[0;35m warn \x1B[0m] Setting $p&quot;</span><br><span class="line">				eval &quot;$p&quot;</span><br><span class="line">			else</span><br><span class="line">				echo -e &quot;[\e[0;35m warn \x1B[0m] Skip $p setting as LIB_TAG=\&quot;\&quot;&quot;</span><br><span class="line">				eval LIB_TAG=&quot;&quot;</span><br><span class="line">			fi</span><br><span class="line">			;;</span><br><span class="line">	esac</span><br><span class="line"></span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰€ä»¥è¿™é‡Œå¹¶æ²¡æœ‰å€¼</span></span><br><span class="line">check_args &quot;$@&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ›´æ–°æºä»£ç ï¼Œä¸ç”¨ç†è§£</span></span><br><span class="line">update_src() &#123;</span><br><span class="line"></span><br><span class="line">	cd &quot;$&#123;SRC&#125;&quot; || exit</span><br><span class="line">	if [[ ! -f &quot;$&#123;SRC&#125;&quot;/.ignore_changes ]]; then</span><br><span class="line">		echo -e &quot;[\e[0;32m o.k. \x1B[0m] This script will try to update&quot;</span><br><span class="line"></span><br><span class="line">		CHANGED_FILES=$(git diff --name-only)</span><br><span class="line">		if [[ -n &quot;$&#123;CHANGED_FILES&#125;&quot; ]]; then</span><br><span class="line">			echo -e &quot;[\e[0;35m warn \x1B[0m] Can&#x27;t update since you made changes to: \e[0;32m\n$&#123;CHANGED_FILES&#125;\x1B[0m&quot;</span><br><span class="line">			while true; do</span><br><span class="line">				echo -e &quot;Press \e[0;33m&lt;Ctrl-C&gt;\x1B[0m or \e[0;33mexit\x1B[0m to abort compilation&quot;\</span><br><span class="line">				&quot;, \e[0;33m&lt;Enter&gt;\x1B[0m to ignore and continue, \e[0;33mdiff\x1B[0m to display changes&quot;</span><br><span class="line">				read -r</span><br><span class="line">				if [[ &quot;$&#123;REPLY&#125;&quot; == &quot;diff&quot; ]]; then</span><br><span class="line">					git diff</span><br><span class="line">				elif [[ &quot;$&#123;REPLY&#125;&quot; == &quot;exit&quot; ]]; then</span><br><span class="line">					exit 1</span><br><span class="line">				elif [[ &quot;$&#123;REPLY&#125;&quot; == &quot;&quot; ]]; then</span><br><span class="line">					break</span><br><span class="line">				else</span><br><span class="line">					echo &quot;Unknown command!&quot;</span><br><span class="line">				fi</span><br><span class="line">			done</span><br><span class="line">		elif [[ $(git branch | grep &quot;*&quot; | awk &#x27;&#123;print $2&#125;&#x27;) != &quot;$&#123;LIB_TAG&#125;&quot; &amp;&amp; -n &quot;$&#123;LIB_TAG&#125;&quot; ]]; then</span><br><span class="line">			git checkout &quot;$&#123;LIB_TAG:-master&#125;&quot;</span><br><span class="line">			git pull</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶,é‡å®šå‘</span></span><br><span class="line">TMPFILE=$(mktemp)</span><br><span class="line">chmod 644 &quot;$&#123;TMPFILE&#125;&quot;</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	echo SRC=&quot;$SRC&quot;</span><br><span class="line">	echo LIB_TAG=&quot;$LIB_TAG&quot;</span><br><span class="line">	declare -f update_src</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;update_src&quot;</span></span></span><br><span class="line"></span><br><span class="line">&#125;  &gt; &quot;$TMPFILE&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">do</span> not update/checkout git with root privileges to messup files onwership.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">due to <span class="keyword">in</span> docker/VM, we can<span class="string">&#x27;t su to a normal user, so do not update/checkout git.</span></span></span><br><span class="line">if [[ $(systemd-detect-virt) == &#x27;none&#x27; ]]; then</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$&#123;EUID&#125;&quot; == &quot;0&quot; ]]; then</span><br><span class="line">		su &quot;$(stat --format=%U &quot;$&#123;SRC&#125;&quot;/.git)&quot; -c &quot;bash $&#123;TMPFILE&#125;&quot;</span><br><span class="line">	else</span><br><span class="line">		bash &quot;$&#123;TMPFILE&#125;&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rm &quot;$&#123;TMPFILE&#125;&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [[ &quot;$&#123;EUID&#125;&quot; == &quot;0&quot; ]] || [[ &quot;$&#123;1&#125;&quot; == &quot;vagrant&quot; ]]; then</span><br><span class="line">	:</span><br><span class="line">elif [[ &quot;$&#123;1&#125;&quot; == docker || &quot;$&#123;1&#125;&quot; == dockerpurge || &quot;$&#123;1&#125;&quot; == docker-shell ]] &amp;&amp; grep -q &quot;$(whoami)&quot; &lt;(getent group docker); then</span><br><span class="line">	:</span><br><span class="line">else</span><br><span class="line">	display_alert &quot;This script requires root privileges, trying to use sudo&quot; &quot;&quot; &quot;wrn&quot;</span><br><span class="line">	sudo &quot;$&#123;SRC&#125;/build.sh&quot; &quot;$@&quot;</span><br><span class="line">	exit $?</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ &quot;$OFFLINE_WORK&quot; == &quot;yes&quot; ]; then</span><br><span class="line"></span><br><span class="line">	echo -e &quot;\n&quot;</span><br><span class="line">	display_alert &quot;* &quot; &quot;You are working offline.&quot;</span><br><span class="line">	display_alert &quot;* &quot; &quot;Sources, time and host will not be checked&quot;</span><br><span class="line">	echo -e &quot;\n&quot;</span><br><span class="line">	sleep 3s</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">check and install the basic utilities here</span></span></span><br><span class="line">	prepare_host_basic</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Check for Vagrant</span></span></span><br><span class="line">if [[ &quot;$&#123;1&#125;&quot; == vagrant &amp;&amp; -z &quot;$(command -v vagrant)&quot; ]]; then</span><br><span class="line">	display_alert &quot;Vagrant not installed.&quot; &quot;Installing&quot;</span><br><span class="line">	sudo apt-get update</span><br><span class="line">	sudo apt-get install -y vagrant virtualbox</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Purge Orange Pi Docker images</span></span></span><br><span class="line">if [[ &quot;$&#123;1&#125;&quot; == dockerpurge &amp;&amp; -f /etc/debian_version ]]; then</span><br><span class="line">	display_alert &quot;Purging Orange Pi Docker containers&quot; &quot;&quot; &quot;wrn&quot;</span><br><span class="line">	docker container ls -a | grep orangepi | awk &#x27;&#123;print $1&#125;&#x27; | xargs docker container rm &amp;&gt; /dev/null</span><br><span class="line">	docker image ls | grep orangepi | awk &#x27;&#123;print $3&#125;&#x27; | xargs docker image rm &amp;&gt; /dev/null</span><br><span class="line">	shift</span><br><span class="line">	set -- &quot;docker&quot; &quot;$@&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Docker shell</span></span></span><br><span class="line">if [[ &quot;$&#123;1&#125;&quot; == docker-shell ]]; then</span><br><span class="line">	shift</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">shellcheck disable=SC2034</span></span></span><br><span class="line">	SHELL_ONLY=yes</span><br><span class="line">	set -- &quot;docker&quot; &quot;$@&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Install Docker if not there but wanted. We cover only Debian based distro install. On other distros, manual Docker install is needed</span></span></span><br><span class="line">if [[ &quot;$&#123;1&#125;&quot; == docker &amp;&amp; -f /etc/debian_version &amp;&amp; -z &quot;$(command -v docker)&quot; ]]; then</span><br><span class="line"></span><br><span class="line">	DOCKER_BINARY=&quot;docker-ce&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">add exception for Ubuntu Focal until Docker provides dedicated binary</span></span></span><br><span class="line">	codename=$(cat /etc/os-release | grep VERSION_CODENAME | cut -d&quot;=&quot; -f2)</span><br><span class="line">	codeid=$(cat /etc/os-release | grep ^NAME | cut -d&quot;=&quot; -f2 | awk &#x27;&#123;print tolower($0)&#125;&#x27; | tr -d &#x27;&quot;&#x27; | awk &#x27;&#123;print $1&#125;&#x27;)</span><br><span class="line">	[[ &quot;$&#123;codename&#125;&quot; == &quot;debbie&quot; ]] &amp;&amp; codename=&quot;buster&quot; &amp;&amp; codeid=&quot;debian&quot;</span><br><span class="line">	[[ &quot;$&#123;codename&#125;&quot; == &quot;ulyana&quot; || &quot;$&#123;codename&#125;&quot; == &quot;jammy&quot; ]] &amp;&amp; codename=&quot;focal&quot; &amp;&amp; codeid=&quot;ubuntu&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">different binaries for some. TBD. Need to check for all others</span></span></span><br><span class="line">	[[ &quot;$&#123;codename&#125;&quot; =~ focal|hirsute ]] &amp;&amp; DOCKER_BINARY=&quot;docker containerd docker.io&quot;</span><br><span class="line"></span><br><span class="line">	display_alert &quot;Docker not installed.&quot; &quot;Installing&quot; &quot;Info&quot;</span><br><span class="line">	sudo bash -c &quot;echo \&quot;deb [arch=$(dpkg --print-architecture)] https://download.docker.com/linux/$&#123;codeid&#125; $&#123;codename&#125; stable\&quot; &gt; /etc/apt/sources.list.d/docker.list&quot;</span><br><span class="line"></span><br><span class="line">	sudo bash -c &quot;curl -fsSL \&quot;https://download.docker.com/linux/$&#123;codeid&#125;/gpg\&quot; | apt-key add -qq - &gt; /dev/null 2&gt;&amp;1 &quot;</span><br><span class="line">	export DEBIAN_FRONTEND=noninteractive</span><br><span class="line">	sudo apt-get update</span><br><span class="line">	sudo apt-get install -y -qq --no-install-recommends $&#123;DOCKER_BINARY&#125;</span><br><span class="line">	display_alert &quot;Add yourself to docker group to avoid root privileges&quot; &quot;&quot; &quot;wrn&quot;</span><br><span class="line">	&quot;$&#123;SRC&#125;/build.sh&quot; &quot;$@&quot;</span><br><span class="line">	exit $?</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ä¸Šé¢éƒ½æ˜¯å…³äºdockerçš„ï¼Œå¯ä»¥å…ˆä¸ç”¨ç†è§£</span></span></span><br><span class="line"></span><br><span class="line">EXTER=&quot;$&#123;SRC&#125;/external&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Create userpatches directory if not exists</span></span></span><br><span class="line">mkdir -p &quot;$&#123;SRC&#125;&quot;/userpatches</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Create example configs if none found in userpatches</span></span></span><br><span class="line">if ! ls &quot;$&#123;SRC&#125;&quot;/userpatches/&#123;config-example.conf,config-docker.conf,config-vagrant.conf&#125; 1&gt; /dev/null 2&gt;&amp;1; then</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Migrate old configs</span></span></span><br><span class="line">	if ls &quot;$&#123;SRC&#125;&quot;/*.conf 1&gt; /dev/null 2&gt;&amp;1; then</span><br><span class="line">		display_alert &quot;Migrate config files to userpatches directory&quot; &quot;all *.conf&quot; &quot;info&quot;</span><br><span class="line">                cp &quot;$&#123;SRC&#125;&quot;/*.conf &quot;$&#123;SRC&#125;&quot;/userpatches  || exit 1</span><br><span class="line">		rm &quot;$&#123;SRC&#125;&quot;/*.conf</span><br><span class="line">		[[ ! -L &quot;$&#123;SRC&#125;&quot;/userpatches/config-example.conf ]] &amp;&amp; ln -fs config-example.conf &quot;$&#123;SRC&#125;&quot;/userpatches/config-default.conf || exit 1</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	display_alert &quot;Create example config file using template&quot; &quot;config-default.conf&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Create example config</span></span></span><br><span class="line">	if [[ ! -f &quot;$&#123;SRC&#125;&quot;/userpatches/config-example.conf ]]; then</span><br><span class="line">		cp &quot;$&#123;EXTER&#125;&quot;/config/templates/config-example.conf &quot;$&#123;SRC&#125;&quot;/userpatches/config-example.conf || exit 1</span><br><span class="line">                ln -fs config-example.conf &quot;$&#123;SRC&#125;&quot;/userpatches/config-default.conf || exit 1</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Create Docker config</span></span></span><br><span class="line">	if [[ ! -f &quot;$&#123;SRC&#125;&quot;/userpatches/config-docker.conf ]]; then</span><br><span class="line">		cp &quot;$&#123;EXTER&#125;&quot;/config/templates/config-docker.conf &quot;$&#123;SRC&#125;&quot;/userpatches/config-docker.conf || exit 1</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Create Docker file</span></span></span><br><span class="line">        if [[ ! -f &quot;$&#123;SRC&#125;&quot;/userpatches/Dockerfile ]]; then</span><br><span class="line">                cp &quot;$&#123;EXTER&#125;&quot;/config/templates/Dockerfile &quot;$&#123;SRC&#125;&quot;/userpatches/Dockerfile || exit 1</span><br><span class="line">        fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Create Vagrant config</span></span></span><br><span class="line">	if [[ ! -f &quot;$&#123;SRC&#125;&quot;/userpatches/config-vagrant.conf ]]; then</span><br><span class="line">	        cp &quot;$&#123;EXTER&#125;&quot;/config/templates/config-vagrant.conf &quot;$&#123;SRC&#125;&quot;/userpatches/config-vagrant.conf || exit 1</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Create Vagrant file</span></span></span><br><span class="line">	if [[ ! -f &quot;$&#123;SRC&#125;&quot;/userpatches/Vagrantfile ]]; then</span><br><span class="line">		cp &quot;$&#123;EXTER&#125;&quot;/config/templates/Vagrantfile &quot;$&#123;SRC&#125;&quot;/userpatches/Vagrantfile || exit 1</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ -z &quot;$&#123;CONFIG&#125;&quot; &amp;&amp; -n &quot;$1&quot; &amp;&amp; -f &quot;$&#123;SRC&#125;/userpatches/config-$1.conf&quot; ]]; then</span><br><span class="line">	CONFIG=&quot;userpatches/config-$1.conf&quot;</span><br><span class="line">	shift</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">usind default if custom not found</span></span></span><br><span class="line">if [[ -z &quot;$&#123;CONFIG&#125;&quot; &amp;&amp; -f &quot;$&#123;SRC&#125;/userpatches/config-default.conf&quot; ]]; then</span><br><span class="line">	CONFIG=&quot;userpatches/config-default.conf&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">source build configuration file</span></span></span><br><span class="line">CONFIG_FILE=&quot;$(realpath &quot;$&#123;CONFIG&#125;&quot;)&quot;</span><br><span class="line"></span><br><span class="line">if [[ ! -f &quot;$&#123;CONFIG_FILE&#125;&quot; ]]; then</span><br><span class="line">	display_alert &quot;Config file does not exist&quot; &quot;$&#123;CONFIG&#125;&quot; &quot;error&quot;</span><br><span class="line">	exit 254</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">CONFIG_PATH=$(dirname &quot;$&#123;CONFIG_FILE&#125;&quot;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Source the extensions manager library at this point, before sourcing the config.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">This allows early calls to enable_extension(), but initialization proper is done later.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">shellcheck source=scripts/extensions.sh</span></span></span><br><span class="line">source &quot;$&#123;SRC&#125;&quot;/scripts/extensions.sh</span><br><span class="line"></span><br><span class="line">display_alert &quot;Using config file&quot; &quot;$&#123;CONFIG_FILE&#125;&quot; &quot;info&quot;</span><br><span class="line">pushd &quot;$&#123;CONFIG_PATH&#125;&quot; &gt; /dev/null || exit</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">shellcheck source=/dev/null</span></span></span><br><span class="line">source &quot;$&#123;CONFIG_FILE&#125;&quot;</span><br><span class="line">popd &gt; /dev/null || exit</span><br><span class="line"></span><br><span class="line">[[ -z &quot;$&#123;USERPATCHES_PATH&#125;&quot; ]] &amp;&amp; USERPATCHES_PATH=&quot;$&#123;CONFIG_PATH&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Script parameters handling</span></span></span><br><span class="line">while [[ &quot;$&#123;1&#125;&quot; == *=* ]]; do</span><br><span class="line"></span><br><span class="line">	parameter=$&#123;1%%=*&#125;</span><br><span class="line">	value=$&#123;1##*=&#125;</span><br><span class="line">	shift</span><br><span class="line">	display_alert &quot;Command line: setting $parameter to&quot; &quot;$&#123;value:-(empty)&#125;&quot; &quot;info&quot;</span><br><span class="line">	eval &quot;$parameter=\&quot;$value\&quot;&quot;</span><br><span class="line"></span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [[ &quot;$&#123;BUILD_ALL&#125;&quot; == &quot;yes&quot; || &quot;$&#123;BUILD_ALL&#125;&quot; == &quot;demo&quot; ]]; then</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">shellcheck source=scripts/build-all-ng.sh</span></span></span><br><span class="line">	source &quot;$&#123;SRC&#125;&quot;/scripts/build-all-ng.sh</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">shellcheck source=scripts/main.sh</span></span></span><br><span class="line">	source &quot;$&#123;SRC&#125;&quot;/scripts/main.sh</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å…¶å®ä¸Šé¢å¯¹æˆ‘æœ‰ç”¨çš„ä¹Ÿå°±æ˜¯general.shè„šæœ¬å’Œmain.shï¼Œgeneralè„šæœ¬æ˜¯ä¸€äº›ç”¨äºçš„å‡½æ•°ï¼Œè€Œmain,shæ˜¯æœ€é‡è¦çš„ï¼Œåœ¨ç¬¬ä¸‰ä¸ªç« èŠ‚ä¼šè¿›è¡Œè®²è§£ã€‚</p>
<h1 id="2-general-shåˆ†æ"><a href="#2-general-shåˆ†æ" class="headerlink" title="2.general.shåˆ†æ"></a>2.general.shåˆ†æ</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Functions:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">cleaning æ¸…ç†æ“ä½œ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">exit_with_error è¾“å‡ºé”™è¯¯å¹¶é€€å‡º</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">get_package_list_hash è·å–è½¯ä»¶åŒ…åˆ—è¡¨çš„å“ˆå¸Œå€¼ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">create_sources_list åˆ›å»ºæºåˆ—è¡¨</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">clean_up_git æ¸…ç† Git ç›¸å…³æ“ä½œ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">waiter_local_git ç­‰å¾…æœ¬åœ° Git æ“ä½œå®Œæˆ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">fetch_from_repo ã€‚ä»ä»“åº“è·å–æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">improved_gitæ”¹è¿›çš„ Git æ“ä½œã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">display_alert æ˜¾ç¤ºè­¦å‘Šã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">fingerprint_image ç”Ÿæˆå›¾åƒæŒ‡çº¹</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">distro_menu æ˜¾ç¤ºå‘è¡Œç‰ˆèœå•</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">addtorepo å°†è½¯ä»¶åŒ…æ·»åŠ åˆ°ä»“åº“</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">repo-remove-old-packages ä»ä»“åº“ä¸­ç§»é™¤æ—§çš„è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">wait_for_package_manager ç­‰å¾…è½¯ä»¶åŒ…ç®¡ç†å™¨å®Œæˆæ“ä½œ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">install_pkg_deb å®‰è£… deb è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">prepare_host_basic å‡†å¤‡åŸºæœ¬ä¸»æœºç¯å¢ƒ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">prepare_host å‡†å¤‡ä¸»æœºç¯å¢ƒ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">webseed ä½¿ç”¨ Webseed ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">download_and_verify ä¸‹è½½å¹¶éªŒè¯æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">show_developer_warning æ˜¾ç¤ºå¼€å‘è€…è­¦å‘Šä¿¡æ¯</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">show_checklist_variables æ˜¾ç¤ºæ¸…å•å˜é‡</span></span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Copyright (c) 2015 Igor Pecovnik, igor.pecovnik@gma**.com</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This file is licensed under the terms of the GNU General Public</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">License version 2. This program is licensed <span class="string">&quot;as is&quot;</span> without any</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">warranty of any kind, whether express or implied.</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Functions:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">cleaning æ¸…ç†æ“ä½œ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">exit_with_error è¾“å‡ºé”™è¯¯å¹¶é€€å‡º</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">get_package_list_hash è·å–è½¯ä»¶åŒ…åˆ—è¡¨çš„å“ˆå¸Œå€¼ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">create_sources_list åˆ›å»ºæºåˆ—è¡¨</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">clean_up_git æ¸…ç† Git ç›¸å…³æ“ä½œ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">waiter_local_git ç­‰å¾…æœ¬åœ° Git æ“ä½œå®Œæˆ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">fetch_from_repo ã€‚ä»ä»“åº“è·å–æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">improved_gitæ”¹è¿›çš„ Git æ“ä½œã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">display_alert æ˜¾ç¤ºè­¦å‘Šã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">fingerprint_image ç”Ÿæˆå›¾åƒæŒ‡çº¹</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">distro_menu æ˜¾ç¤ºå‘è¡Œç‰ˆèœå•</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">addtorepo å°†è½¯ä»¶åŒ…æ·»åŠ åˆ°ä»“åº“</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">repo-remove-old-packages ä»ä»“åº“ä¸­ç§»é™¤æ—§çš„è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">wait_for_package_manager ç­‰å¾…è½¯ä»¶åŒ…ç®¡ç†å™¨å®Œæˆæ“ä½œ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">install_pkg_deb å®‰è£… deb è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">prepare_host_basic å‡†å¤‡åŸºæœ¬ä¸»æœºç¯å¢ƒ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">prepare_host å‡†å¤‡ä¸»æœºç¯å¢ƒ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">webseed ä½¿ç”¨ Webseed ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">download_and_verify ä¸‹è½½å¹¶éªŒè¯æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">show_developer_warning æ˜¾ç¤ºå¼€å‘è€…è­¦å‘Šä¿¡æ¯</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">show_checklist_variables æ˜¾ç¤ºæ¸…å•å˜é‡</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">cleaning &lt;target&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># target: what to clean</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;make&quot;</span> - <span class="string">&quot;make clean&quot;</span> <span class="keyword">for</span> selected kernel and u-boot</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;debs&quot;</span> - delete output/debs <span class="keyword">for</span> board&amp;branch</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;ubootdebs&quot;</span> - delete output/debs <span class="keyword">for</span> uboot&amp;board&amp;branch</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;alldebs&quot;</span> - delete output/debs</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;cache&quot;</span> - delete output/cache</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;oldcache&quot;</span> - remove old output/cache</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;images&quot;</span> - delete output/images</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;sources&quot;</span> - delete output/sources</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span></span><br><span class="line">cleaning()</span><br><span class="line">&#123;</span><br><span class="line">	case $1 in</span><br><span class="line">		debs) # delete $&#123;DEB_STORAGE&#125; for current branch and family</span><br><span class="line">		if [[ -d &quot;$&#123;DEB_STORAGE&#125;&quot; ]]; then</span><br><span class="line">			display_alert &quot;Cleaning $&#123;DEB_STORAGE&#125; for&quot; &quot;$BOARD $BRANCH&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">easier than dealing with variable expansion and escaping dashes <span class="keyword">in</span> file names</span></span><br><span class="line">			find &quot;$&#123;DEB_STORAGE&#125;&quot; -name &quot;$&#123;CHOSEN_UBOOT&#125;_*.deb&quot; -delete</span><br><span class="line">			find &quot;$&#123;DEB_STORAGE&#125;&quot; \( -name &quot;$&#123;CHOSEN_KERNEL&#125;_*.deb&quot; -o \</span><br><span class="line">				-name &quot;orangepi-*.deb&quot; -o \</span><br><span class="line">				-name &quot;plymouth-theme-orangepi_*.deb&quot; -o \</span><br><span class="line">				-name &quot;$&#123;CHOSEN_KERNEL/image/dtb&#125;_*.deb&quot; -o \</span><br><span class="line">				-name &quot;$&#123;CHOSEN_KERNEL/image/headers&#125;_*.deb&quot; -o \</span><br><span class="line">				-name &quot;$&#123;CHOSEN_KERNEL/image/source&#125;_*.deb&quot; -o \</span><br><span class="line">				-name &quot;$&#123;CHOSEN_KERNEL/image/firmware-image&#125;_*.deb&quot; \) -delete</span><br><span class="line">			[[ -n $RELEASE ]] &amp;&amp; rm -f &quot;$&#123;DEB_STORAGE&#125;/$&#123;RELEASE&#125;/$&#123;CHOSEN_ROOTFS&#125;&quot;_*.deb</span><br><span class="line">			[[ -n $RELEASE ]] &amp;&amp; rm -f &quot;$&#123;DEB_STORAGE&#125;/$&#123;RELEASE&#125;/orangepi-desktop-$&#123;RELEASE&#125;&quot;_*.deb</span><br><span class="line">		fi</span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">		ubootdebs) # delete $&#123;DEB_STORAGE&#125; for uboot, current branch and family</span><br><span class="line">		if [[ -d &quot;$&#123;DEB_STORAGE&#125;&quot; ]]; then</span><br><span class="line">			display_alert &quot;Cleaning $&#123;DEB_STORAGE&#125; for u-boot&quot; &quot;$BOARD $BRANCH&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">easier than dealing with variable expansion and escaping dashes <span class="keyword">in</span> file names</span></span><br><span class="line">			find &quot;$&#123;DEB_STORAGE&#125;&quot; -name &quot;$&#123;CHOSEN_UBOOT&#125;_*.deb&quot; -delete</span><br><span class="line">		fi</span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">		extras) # delete $&#123;DEB_STORAGE&#125;/extra/$RELEASE for all architectures</span><br><span class="line">		if [[ -n $RELEASE &amp;&amp; -d $&#123;DEB_STORAGE&#125;/extra/$RELEASE ]]; then</span><br><span class="line">			display_alert &quot;Cleaning $&#123;DEB_STORAGE&#125;/extra for&quot; &quot;$RELEASE&quot; &quot;info&quot;</span><br><span class="line">			rm -rf &quot;$&#123;DEB_STORAGE&#125;/extra/$&#123;RELEASE&#125;&quot;</span><br><span class="line">		fi</span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">		alldebs) # delete output/debs</span><br><span class="line">		[[ -d &quot;$&#123;DEB_STORAGE&#125;&quot; ]] &amp;&amp; display_alert &quot;Cleaning&quot; &quot;$&#123;DEB_STORAGE&#125;&quot; &quot;info&quot; &amp;&amp; rm -rf &quot;$&#123;DEB_STORAGE&#125;&quot;/*</span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">		cache) # delete output/cache</span><br><span class="line">		[[ -d $EXTER/cache/rootfs ]] &amp;&amp; display_alert &quot;Cleaning&quot; &quot;rootfs cache (all)&quot; &quot;info&quot; &amp;&amp; find $EXTER/cache/rootfs -type f -delete</span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">		images) # delete output/images</span><br><span class="line">		[[ -d &quot;$&#123;DEST&#125;&quot;/images ]] &amp;&amp; display_alert &quot;Cleaning&quot; &quot;output/images&quot; &quot;info&quot; &amp;&amp; rm -rf &quot;$&#123;DEST&#125;&quot;/images/*</span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">		sources) # delete output/sources and output/buildpkg</span><br><span class="line">		[[ -d $EXTER/cache/sources ]] &amp;&amp; display_alert &quot;Cleaning&quot; &quot;sources&quot; &quot;info&quot; &amp;&amp; rm -rf $EXTER/cache/sources/* &quot;$&#123;DEST&#125;&quot;/buildpkg/*</span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">		oldcache) # remove old `cache/rootfs` except for the newest 8 files</span><br><span class="line">		if [[ -d $EXTER/cache/rootfs &amp;&amp; $(ls -1 $EXTER/cache/rootfs/*.lz4 2&gt; /dev/null | wc -l) -gt &quot;$&#123;ROOTFS_CACHE_MAX&#125;&quot; ]]; then</span><br><span class="line">			display_alert &quot;Cleaning&quot; &quot;rootfs cache (old)&quot; &quot;info&quot;</span><br><span class="line">			(cd $EXTER/cache/rootfs; ls -t *.lz4 | sed -e &quot;1,$&#123;ROOTFS_CACHE_MAX&#125;d&quot; | xargs -d &#x27;\n&#x27; rm -f)</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">Remove signatures <span class="keyword">if</span> they are present. We use them <span class="keyword">for</span> internal purpose</span></span><br><span class="line">			(cd $EXTER/cache/rootfs; ls -t *.asc | sed -e &quot;1,$&#123;ROOTFS_CACHE_MAX&#125;d&quot; | xargs -d &#x27;\n&#x27; rm -f)</span><br><span class="line">		fi</span><br><span class="line">		;;</span><br><span class="line">	esac</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">exit_with_error &lt;message&gt; &lt;highlight&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># a way to terminate build process</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">with verbose error message</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span></span><br><span class="line">exit_with_error()</span><br><span class="line">&#123;</span><br><span class="line">	local _file</span><br><span class="line">	local _line=$&#123;BASH_LINENO[0]&#125;</span><br><span class="line">	local _function=$&#123;FUNCNAME[1]&#125;</span><br><span class="line">	local _description=$1</span><br><span class="line">	local _highlight=$2</span><br><span class="line">	_file=$(basename &quot;$&#123;BASH_SOURCE[1]&#125;&quot;)</span><br><span class="line">	local stacktrace=&quot;$(get_extension_hook_stracktrace &quot;$&#123;BASH_SOURCE[*]&#125;&quot; &quot;$&#123;BASH_LINENO[*]&#125;&quot;)&quot;</span><br><span class="line"></span><br><span class="line">	display_alert &quot;ERROR in function $_function&quot; &quot;$stacktrace&quot; &quot;err&quot;</span><br><span class="line">	display_alert &quot;$_description&quot; &quot;$_highlight&quot; &quot;err&quot;</span><br><span class="line">	display_alert &quot;Process terminated&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$&#123;ERROR_DEBUG_SHELL&#125;&quot; == &quot;yes&quot; ]]; then</span><br><span class="line">		display_alert &quot;MOUNT&quot; &quot;$&#123;MOUNT&#125;&quot; &quot;err&quot;</span><br><span class="line">		display_alert &quot;SDCARD&quot; &quot;$&#123;SDCARD&#125;&quot; &quot;err&quot;</span><br><span class="line">		display_alert &quot;Here&#x27;s a shell.&quot; &quot;debug it&quot; &quot;err&quot;</span><br><span class="line">		bash &lt; /dev/tty || true</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">TODO: execute run_after_build here?</span></span><br><span class="line">	overlayfs_wrapper &quot;cleanup&quot;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">unlock loop device access <span class="keyword">in</span> <span class="keyword">case</span> of starvation</span></span><br><span class="line">	exec &#123;FD&#125;&gt;/var/lock/orangepi-debootstrap-losetup</span><br><span class="line">	flock -u &quot;$&#123;FD&#125;&quot;</span><br><span class="line"></span><br><span class="line">	exit 255</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">get_package_list_hash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># returns md5 hash for current package list and rootfs cache version</span></span></span><br><span class="line"></span><br><span class="line">get_package_list_hash()</span><br><span class="line">&#123;</span><br><span class="line">	local package_arr exclude_arr</span><br><span class="line">	local list_content</span><br><span class="line">	read -ra package_arr &lt;&lt;&lt; &quot;$&#123;DEBOOTSTRAP_LIST&#125; $&#123;PACKAGE_LIST&#125;&quot;</span><br><span class="line">	read -ra exclude_arr &lt;&lt;&lt; &quot;$&#123;PACKAGE_LIST_EXCLUDE&#125;&quot;</span><br><span class="line">	( ( printf &quot;%s\n&quot; &quot;$&#123;package_arr[@]&#125;&quot;; printf -- &quot;-%s\n&quot; &quot;$&#123;exclude_arr[@]&#125;&quot; ) | sort -u; echo &quot;$&#123;1&#125;&quot; ) \</span><br><span class="line">		| md5sum | cut -d&#x27; &#x27; -f 1</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">create_sources_list &lt;release&gt; &lt;basedir&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># &lt;release&gt;: buster|bullseye|bookworm|bionic|focal|jammy|hirsute|sid</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&lt;basedir&gt;: path to root directory</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">create_sources_list()</span></span><br><span class="line">&#123;</span><br><span class="line">	local release=$1</span><br><span class="line">	local basedir=$2</span><br><span class="line">	[[ -z $basedir ]] &amp;&amp; exit_with_error &quot;No basedir passed to create_sources_list&quot;</span><br><span class="line"></span><br><span class="line">	case $release in</span><br><span class="line">	stretch|buster)</span><br><span class="line">	cat &lt;&lt;-EOF &gt; &quot;$&#123;basedir&#125;&quot;/etc/apt/sources.list</span><br><span class="line">	deb http://$&#123;DEBIAN_MIRROR&#125; $release main contrib non-free</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;DEBIAN_MIRROR&#125;</span> <span class="variable">$release</span> main contrib non-free</span></span><br><span class="line"></span><br><span class="line">	deb http://$&#123;DEBIAN_MIRROR&#125; $&#123;release&#125;-updates main contrib non-free</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;DEBIAN_MIRROR&#125;</span> <span class="variable">$&#123;release&#125;</span>-updates main contrib non-free</span></span><br><span class="line"></span><br><span class="line">	deb http://$&#123;DEBIAN_MIRROR&#125; $&#123;release&#125;-backports main contrib non-free</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;DEBIAN_MIRROR&#125;</span> <span class="variable">$&#123;release&#125;</span>-backports main contrib non-free</span></span><br><span class="line"></span><br><span class="line">	deb http://$&#123;DEBIAN_SECURTY&#125; $&#123;release&#125;/updates main contrib non-free</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;DEBIAN_SECURTY&#125;</span> <span class="variable">$&#123;release&#125;</span>/updates main contrib non-free</span></span><br><span class="line">	EOF</span><br><span class="line">	;;</span><br><span class="line"></span><br><span class="line">	bullseye)</span><br><span class="line">	cat &lt;&lt;-EOF &gt; &quot;$&#123;basedir&#125;&quot;/etc/apt/sources.list</span><br><span class="line">	deb https://$&#123;DEBIAN_MIRROR&#125; $release main contrib non-free</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src https://<span class="variable">$&#123;DEBIAN_MIRROR&#125;</span> <span class="variable">$release</span> main contrib non-free</span></span><br><span class="line"></span><br><span class="line">	deb https://$&#123;DEBIAN_MIRROR&#125; $&#123;release&#125;-updates main contrib non-free</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src https://<span class="variable">$&#123;DEBIAN_MIRROR&#125;</span> <span class="variable">$&#123;release&#125;</span>-updates main contrib non-free</span></span><br><span class="line"></span><br><span class="line">	deb https://$&#123;DEBIAN_MIRROR&#125; $&#123;release&#125;-backports main contrib non-free</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src https://<span class="variable">$&#123;DEBIAN_MIRROR&#125;</span> <span class="variable">$&#123;release&#125;</span>-backports main contrib non-free</span></span><br><span class="line"></span><br><span class="line">	deb https://$&#123;DEBIAN_SECURTY&#125; $&#123;release&#125;-security main contrib non-free</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src https://<span class="variable">$&#123;DEBIAN_SECURTY&#125;</span> <span class="variable">$&#123;release&#125;</span>-security main contrib non-free</span></span><br><span class="line">	EOF</span><br><span class="line">	;;</span><br><span class="line"></span><br><span class="line">	bookworm)</span><br><span class="line">	cat &lt;&lt;- EOF &gt; &quot;$&#123;basedir&#125;&quot;/etc/apt/sources.list</span><br><span class="line">	deb http://$&#123;DEBIAN_MIRROR&#125; $release main contrib non-free non-free-firmware</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;DEBIAN_MIRROR&#125;</span> <span class="variable">$release</span> main contrib non-free non-free-firmware</span></span><br><span class="line"></span><br><span class="line">	deb http://$&#123;DEBIAN_MIRROR&#125; $&#123;release&#125;-updates main contrib non-free non-free-firmware</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;DEBIAN_MIRROR&#125;</span> <span class="variable">$&#123;release&#125;</span>-updates main contrib non-free non-free-firmware</span></span><br><span class="line"></span><br><span class="line">	deb http://$&#123;DEBIAN_MIRROR&#125; $&#123;release&#125;-backports main contrib non-free non-free-firmware</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;DEBIAN_MIRROR&#125;</span> <span class="variable">$&#123;release&#125;</span>-backports main contrib non-free non-free-firmware</span></span><br><span class="line"></span><br><span class="line">	deb http://$&#123;DEBIAN_SECURTY&#125; $&#123;release&#125;-security main contrib non-free non-free-firmware</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;DEBIAN_SECURTY&#125;</span> <span class="variable">$&#123;release&#125;</span>-security main contrib non-free non-free-firmware</span></span><br><span class="line">	EOF</span><br><span class="line">	;;</span><br><span class="line"></span><br><span class="line">	sid) # sid is permanent unstable development and has no such thing as updates or security</span><br><span class="line">	cat &lt;&lt;- EOF &gt; &quot;$&#123;basedir&#125;&quot;/etc/apt/sources.list</span><br><span class="line">	deb http://$&#123;DEBIAN_MIRROR&#125; $release main contrib non-free non-free-firmware</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;DEBIAN_MIRROR&#125;</span> <span class="variable">$release</span> main contrib non-free non-free-firmware</span></span><br><span class="line"></span><br><span class="line">	deb http://$&#123;DEBIAN_MIRROR&#125; unstable main contrib non-free non-free-firmware</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;DEBIAN_MIRROR&#125;</span> unstable main contrib non-free non-free-firmware</span></span><br><span class="line">	EOF</span><br><span class="line">	;;</span><br><span class="line"></span><br><span class="line">	xenial|bionic|focal|hirsute|impish|jammy)</span><br><span class="line">	cat &lt;&lt;-EOF &gt; &quot;$&#123;basedir&#125;&quot;/etc/apt/sources.list</span><br><span class="line">	deb http://$&#123;UBUNTU_MIRROR&#125; $release main restricted universe multiverse</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;UBUNTU_MIRROR&#125;</span> <span class="variable">$release</span> main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">	deb http://$&#123;UBUNTU_MIRROR&#125; $&#123;release&#125;-security main restricted universe multiverse</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;UBUNTU_MIRROR&#125;</span> <span class="variable">$&#123;release&#125;</span>-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">	deb http://$&#123;UBUNTU_MIRROR&#125; $&#123;release&#125;-updates main restricted universe multiverse</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;UBUNTU_MIRROR&#125;</span> <span class="variable">$&#123;release&#125;</span>-updates main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">	deb http://$&#123;UBUNTU_MIRROR&#125; $&#123;release&#125;-backports main restricted universe multiverse</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;UBUNTU_MIRROR&#125;</span> <span class="variable">$&#123;release&#125;</span>-backports main restricted universe multiverse</span></span><br><span class="line">	EOF</span><br><span class="line">	;;</span><br><span class="line"></span><br><span class="line">	raspi)</span><br><span class="line">	cat &lt;&lt;-EOF &gt; &quot;$&#123;basedir&#125;&quot;/etc/apt/sources.list</span><br><span class="line">	deb http://$&#123;DEBIAN_MIRROR&#125; bullseye main contrib non-free</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;DEBIAN_MIRROR&#125;</span> bullseye main contrib non-free</span></span><br><span class="line"></span><br><span class="line">	deb http://$&#123;DEBIAN_MIRROR&#125; bullseye-updates main contrib non-free</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;DEBIAN_MIRROR&#125;</span> bullseye-updates main contrib non-free</span></span><br><span class="line"></span><br><span class="line">	deb http://$&#123;DEBIAN_MIRROR&#125; bullseye-backports main contrib non-free</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;DEBIAN_MIRROR&#125;</span> bullseye-backports main contrib non-free</span></span><br><span class="line"></span><br><span class="line">	deb http://$&#123;DEBIAN_SECURTY&#125; bullseye-security main contrib non-free</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://<span class="variable">$&#123;DEBIAN_SECURTY&#125;</span> bullseye-security main contrib non-free</span></span><br><span class="line">	EOF</span><br><span class="line"></span><br><span class="line">	cat &lt;&lt;-EOF &gt; &quot;$&#123;basedir&#125;&quot;/etc/apt/sources.list.d/raspi.list</span><br><span class="line">	deb http://$&#123;RASPI_MIRROR&#125; bullseye main</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Uncomment line below <span class="keyword">then</span> <span class="string">&#x27;apt-get update&#x27;</span> to <span class="built_in">enable</span> <span class="string">&#x27;apt-get source&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">deb-src http://archive.raspberrypi.org/debian/ bullseye main</span></span><br><span class="line">	EOF</span><br><span class="line"></span><br><span class="line">	if [ -n &quot;$APT_PROXY&quot; ]; then</span><br><span class="line">		install -m 644 files/51cache &quot;$&#123;APT_PROXY&#125;/etc/apt/apt.conf.d/51cache&quot;</span><br><span class="line">		sed &quot;$&#123;basedir&#125;/etc/apt/apt.conf.d/51cache&quot; -i -e &quot;s|APT_PROXY|$&#123;APT_PROXY&#125;|&quot;</span><br><span class="line">	else</span><br><span class="line">		rm -f &quot;$&#123;basedir&#125;/etc/apt/apt.conf.d/51cache&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	cat $&#123;EXTER&#125;/packages/raspi/stage0/00-configure-apt/files/raspberrypi.gpg.key | gpg --dearmor &gt; &quot;$&#123;basedir&#125;/raspberrypi-archive-stable.gpg&quot;</span><br><span class="line">	install -m 644 &quot;$&#123;basedir&#125;/raspberrypi-archive-stable.gpg&quot; &quot;$&#123;basedir&#125;/etc/apt/trusted.gpg.d/&quot;</span><br><span class="line">	;;</span><br><span class="line">	esac</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">stage: add armbian repository and install key</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="keyword">if</span> [[ <span class="variable">$DOWNLOAD_MIRROR</span> == <span class="string">&quot;china&quot;</span> ]]; <span class="keyword">then</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">	<span class="built_in">echo</span> <span class="string">&quot;deb https://mirrors.tuna.tsinghua.edu.cn/armbian <span class="variable">$RELEASE</span> main <span class="variable">$&#123;RELEASE&#125;</span>-utils <span class="variable">$&#123;RELEASE&#125;</span>-desktop&quot;</span> &gt; <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/etc/apt/sources.list.d/armbian.list</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="keyword">elif</span> [[ <span class="variable">$DOWNLOAD_MIRROR</span> == <span class="string">&quot;bfsu&quot;</span> ]]; <span class="keyword">then</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">   <span class="built_in">echo</span> <span class="string">&quot;deb http://mirrors.bfsu.edu.cn/armbian <span class="variable">$RELEASE</span> main <span class="variable">$&#123;RELEASE&#125;</span>-utils <span class="variable">$&#123;RELEASE&#125;</span>-desktop&quot;</span> &gt; <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/etc/apt/sources.list.d/armbian.list</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="keyword">else</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">	<span class="built_in">echo</span> <span class="string">&quot;deb http://&quot;</span>$([[ <span class="variable">$BETA</span> == <span class="built_in">yes</span> ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;beta&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;apt&quot;</span> )<span class="string">&quot;.armbian.com <span class="variable">$RELEASE</span> main <span class="variable">$&#123;RELEASE&#125;</span>-utils <span class="variable">$&#123;RELEASE&#125;</span>-desktop&quot;</span> &gt; <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/etc/apt/sources.list.d/armbian.list</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="keyword">fi</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">replace <span class="built_in">local</span> package server <span class="keyword">if</span> defined. Suitable <span class="keyword">for</span> development</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">[[ -n <span class="variable">$LOCAL_MIRROR</span> ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;deb http://<span class="variable">$LOCAL_MIRROR</span> <span class="variable">$RELEASE</span> main <span class="variable">$&#123;RELEASE&#125;</span>-utils <span class="variable">$&#123;RELEASE&#125;</span>-desktop&quot;</span> &gt; <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/etc/apt/sources.list.d/armbian.list</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">display_alert <span class="string">&quot;Adding Armbian repository and authentication key&quot;</span> <span class="string">&quot;/etc/apt/sources.list.d/armbian.list&quot;</span> <span class="string">&quot;info&quot;</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="built_in">cp</span> <span class="string">&quot;<span class="variable">$&#123;EXTER&#125;</span>&quot;</span>/config/armbian.key <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="built_in">chroot</span> <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span> /bin/bash -c <span class="string">&quot;cat armbian.key | apt-key add - &gt; /dev/null 2&gt;&amp;1&quot;</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="built_in">rm</span> <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/armbian.key</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This function retries Git operations to avoid failure in case remote is borked</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">If the git team needs to call a remote server, use this <span class="keyword">function</span>.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">improved_git()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	local realgit=$(command -v git)</span><br><span class="line">	local retries=3</span><br><span class="line">	local delay=10</span><br><span class="line">	local count=1</span><br><span class="line">	while [ $count -lt $retries ]; do</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">realgit <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span></span><br><span class="line">		if [[ $? -eq 0 || -f .git/index.lock ]]; then</span><br><span class="line">			retries=0</span><br><span class="line">			break</span><br><span class="line">		fi</span><br><span class="line">	let count=$count+1</span><br><span class="line">	sleep $delay</span><br><span class="line">	done</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">clean_up_git ()</span><br><span class="line">&#123;</span><br><span class="line">	local target_dir=$1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Files that are not tracked by git and were added</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">when the patch was applied must be removed.</span></span><br><span class="line">	git -C $target_dir clean -qdf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Return the files that are tracked by git to the initial state.</span></span><br><span class="line">	git -C $target_dir checkout -qf HEAD</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">used : waiter_local_git arg1=<span class="string">&#x27;value&#x27;</span> arg2:<span class="string">&#x27;value&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">		 waiter_local_git \</span></span><br><span class="line"><span class="language-bash"><span class="comment">#			url=&#x27;https://github.com/megous/linux&#x27; \</span></span></span><br><span class="line"><span class="language-bash"><span class="comment">#			name=&#x27;megous&#x27; \</span></span></span><br><span class="line"><span class="language-bash"><span class="comment">#			dir=&#x27;linux-mainline/5.14&#x27; \</span></span></span><br><span class="line"><span class="language-bash"><span class="comment">#			branch=&#x27;orange-pi-5.14&#x27; \</span></span></span><br><span class="line"><span class="language-bash"><span class="comment">#			obj=&lt;tag|commit&gt; or tag:$tag ...</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">An optional parameter <span class="keyword">for</span> switching to a git object such as a tag, commit,</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or a specific branch. The object must exist <span class="keyword">in</span> the <span class="built_in">local</span> repository.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This optional parameter takes precedence. If it is specified, <span class="keyword">then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the commit state corresponding to the specified git object will be extracted</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">to the working directory. Otherwise, the commit corresponding to the top of</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the branch will be extracted.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The settings <span class="keyword">for</span> the kernel variables of the original kernel</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">VAR_SHALLOW_ORIGINAL=var_origin_kernel must be <span class="keyword">in</span> the main script</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">before calling the <span class="keyword">function</span></span></span><br><span class="line">waiter_local_git ()</span><br><span class="line">&#123;</span><br><span class="line">	for arg in $@;do</span><br><span class="line"></span><br><span class="line">		case $arg in</span><br><span class="line">			url=*|https://*|git://*)	eval &quot;local url=$&#123;arg/url=/&#125;&quot;</span><br><span class="line">				;;</span><br><span class="line">			dir=*|/*/*/*)	eval &quot;local dir=$&#123;arg/dir=/&#125;&quot;</span><br><span class="line">				;;</span><br><span class="line">			*=*|*:*)	eval &quot;local $&#123;arg/:/=&#125;&quot;</span><br><span class="line">				;;</span><br><span class="line">		esac</span><br><span class="line"></span><br><span class="line">	done</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Required variables cannot be empty.</span></span><br><span class="line">	for var in url name dir branch; do</span><br><span class="line">		[ &quot;$&#123;var#*=&#125;&quot; == &quot;&quot; ] &amp;&amp; exit_with_error &quot;Error in configuration&quot;</span><br><span class="line">	done</span><br><span class="line"></span><br><span class="line">	local reachability</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">The <span class="string">&#x27;offline&#x27;</span> variable must always be <span class="built_in">set</span> to <span class="string">&#x27;true&#x27;</span> or <span class="string">&#x27;false&#x27;</span></span></span><br><span class="line">	if [ &quot;$OFFLINE_WORK&quot; == &quot;yes&quot; ]; then</span><br><span class="line">		local offline=true</span><br><span class="line">	else</span><br><span class="line">		local offline=false</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	local work_dir=&quot;$(realpath $&#123;EXTER&#125;/cache/sources)/$dir&quot;</span><br><span class="line">	mkdir -p $work_dir</span><br><span class="line">	cd $work_dir || exit_with_error</span><br><span class="line"></span><br><span class="line">	display_alert &quot;Checking git sources&quot; &quot;$dir $url$name/$branch&quot; &quot;info&quot;</span><br><span class="line"></span><br><span class="line">	if [ &quot;$(git rev-parse --git-dir 2&gt;/dev/null)&quot; != &quot;.git&quot; ]; then</span><br><span class="line">		git init -q .</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">Run <span class="keyword">in</span> the sub shell to avoid mixing environment variables.</span></span><br><span class="line">		if [ -n &quot;$VAR_SHALLOW_ORIGINAL&quot; ]; then</span><br><span class="line">			(</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash">VAR_SHALLOW_ORIGINAL</span></span><br><span class="line"></span><br><span class="line">			display_alert &quot;Add original git sources&quot; &quot;$dir $name/$branch&quot; &quot;info&quot;</span><br><span class="line">			if [ &quot;$(improved_git ls-remote -h $url $branch | \</span><br><span class="line">				awk -F&#x27;/&#x27; &#x27;&#123;if (NR == 1) print $NF&#125;&#x27;)&quot; != &quot;$branch&quot; ];then</span><br><span class="line">				display_alert &quot;Bad $branch for $url in $VAR_SHALLOW_ORIGINAL&quot;</span><br><span class="line">				exit 177</span><br><span class="line">			fi</span><br><span class="line"></span><br><span class="line">			git remote add -t $branch $name $url</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">Handle an exception <span class="keyword">if</span> the initial tag is the top of the branch</span></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">As v5.16 == HEAD</span></span><br><span class="line">			if [ &quot;$&#123;start_tag&#125;.1&quot; == &quot;$(improved_git ls-remote -t $url $&#123;start_tag&#125;.1 | \</span><br><span class="line">					awk -F&#x27;/&#x27; &#x27;&#123; print $NF &#125;&#x27;)&quot; ]</span><br><span class="line">			then</span><br><span class="line">				improved_git fetch --shallow-exclude=$start_tag $name</span><br><span class="line">			else</span><br><span class="line">				improved_git fetch --depth 1 $name</span><br><span class="line">			fi</span><br><span class="line">			improved_git fetch --deepen=1 $name</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">For a shallow <span class="built_in">clone</span>, this works quickly and saves space.</span></span><br><span class="line">			git gc</span><br><span class="line">			)</span><br><span class="line"></span><br><span class="line">			[ &quot;$?&quot; == &quot;177&quot; ] &amp;&amp; exit</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	files_for_clean=&quot;$(git status -s | wc -l)&quot;</span><br><span class="line">	if [ &quot;$files_for_clean&quot; != &quot;0&quot; ];then</span><br><span class="line">		display_alert &quot; Cleaning .... &quot; &quot;$files_for_clean files&quot;</span><br><span class="line">		clean_up_git $work_dir</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [ &quot;$name&quot; != &quot;$(git remote show | grep $name)&quot; ];then</span><br><span class="line">		git remote add -t $branch $name $url</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if ! $offline; then</span><br><span class="line">		for t_name in $(git remote show);do</span><br><span class="line">			improved_git fetch $t_name</span><br><span class="line">		done</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">When switching, we use the concept of only <span class="string">&quot;detached branch&quot;</span>. Therefore,</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">we extract the <span class="built_in">hash</span> from the tag, the branch name, or from the <span class="built_in">hash</span> itself.</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">This serves as a check of the reachability of the extraction.</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">We <span class="keyword">do</span> not use variables that characterize the current state of the git,</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">such as `HEAD` and `FETCH_HEAD`.</span></span><br><span class="line">	reachability=false</span><br><span class="line">	for var in obj tag commit branch;do</span><br><span class="line">		eval pval=\$$var</span><br><span class="line"></span><br><span class="line">		if [ -n &quot;$pval&quot; ] &amp;&amp; [ &quot;$pval&quot; != *HEAD ]; then</span><br><span class="line">			case $var in</span><br><span class="line">				obj|tag|commit) obj=$pval ;;</span><br><span class="line">				branch) obj=$&#123;name&#125;/$branch ;;</span><br><span class="line">			esac</span><br><span class="line"></span><br><span class="line">			if  t_hash=$(git rev-parse $obj 2&gt;/dev/null);then</span><br><span class="line">				reachability=true</span><br><span class="line">				break</span><br><span class="line">			else</span><br><span class="line">				display_alert &quot;Variable $var=$obj unreachable for extraction&quot;</span><br><span class="line">			fi</span><br><span class="line">		fi</span><br><span class="line">	done</span><br><span class="line"></span><br><span class="line">	if $reachability &amp;&amp; [ &quot;$t_hash&quot; != &quot;$(git rev-parse @ 2&gt;/dev/null)&quot; ];then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">Switch <span class="string">&quot;detached branch&quot;</span> as <span class="built_in">hash</span></span></span><br><span class="line">		display_alert &quot;Switch $obj = $t_hash&quot;</span><br><span class="line">		git checkout -qf $t_hash</span><br><span class="line">	else</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">the working directory corresponds to the target commit,</span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">nothing needs to be <span class="keyword">done</span></span></span><br><span class="line">		display_alert &quot;Up to date&quot;</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">fetch_from_repo &lt;url&gt; &lt;directory&gt; &lt;ref&gt; &lt;ref_subdir&gt;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&lt;url&gt;: remote repository URL</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&lt;directory&gt;: <span class="built_in">local</span> directory; subdir <span class="keyword">for</span> branch/tag will be created</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&lt;ref&gt;:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	branch:name</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	tag:name</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	<span class="built_in">head</span>(*)</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	commit:<span class="built_in">hash</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># *: Implies ref_subdir=no</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># &lt;ref_subdir&gt;: &quot;yes&quot; to create subdirectory for tag or branch name</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">fetch_from_repo()</span></span><br><span class="line">&#123;</span><br><span class="line">	local url=$1</span><br><span class="line">	local dir=$2</span><br><span class="line">	local ref=$3</span><br><span class="line">	local ref_subdir=$4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Set GitHub mirror before anything <span class="keyword">else</span> touches <span class="variable">$url</span></span></span><br><span class="line">	url=$&#123;url//&#x27;https://github.com/&#x27;/$GITHUB_SOURCE&#x27;/&#x27;&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">The <span class="string">&#x27;offline&#x27;</span> variable must always be <span class="built_in">set</span> to <span class="string">&#x27;true&#x27;</span> or <span class="string">&#x27;false&#x27;</span></span></span><br><span class="line">	if [ &quot;$OFFLINE_WORK&quot; == &quot;yes&quot; ]; then</span><br><span class="line">		local offline=true</span><br><span class="line">	else</span><br><span class="line">		local offline=false</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	[[ -z $ref || ( $ref != tag:* &amp;&amp; $ref != branch:* &amp;&amp; $ref != head &amp;&amp; $ref != commit:* ) ]] &amp;&amp; exit_with_error &quot;Error in configuration&quot;</span><br><span class="line">	local ref_type=$&#123;ref%%:*&#125;</span><br><span class="line">	if [[ $ref_type == head ]]; then</span><br><span class="line">		local ref_name=HEAD</span><br><span class="line">	else</span><br><span class="line">		local ref_name=$&#123;ref##*:&#125;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	display_alert &quot;Checking git sources&quot; &quot;$dir $ref_name&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">get default remote branch name without cloning</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="built_in">local</span> ref_name=$(git ls-remote --symref <span class="variable">$url</span> HEAD | grep -o <span class="string">&#x27;refs/heads/\S*&#x27;</span> | sed <span class="string">&#x27;s%refs/heads/%%&#x27;</span>)</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="keyword">for</span> git:// protocol comparing hashes of <span class="string">&quot;git ls-remote -h <span class="variable">$url</span>&quot;</span> and <span class="string">&quot;git ls-remote --symref <span class="variable">$url</span> HEAD&quot;</span> is needed</span></span><br><span class="line"></span><br><span class="line">	if [[ $ref_subdir == yes ]]; then</span><br><span class="line">		local workdir=$dir/$ref_name</span><br><span class="line">	else</span><br><span class="line">		local workdir=$dir</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	mkdir -p &quot;$&#123;workdir&#125;&quot; 2&gt;/dev/null || \</span><br><span class="line">		exit_with_error &quot;No path or no write permission&quot; &quot;$&#123;workdir&#125;&quot;</span><br><span class="line"></span><br><span class="line">	cd &quot;$&#123;workdir&#125;&quot; || exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">check <span class="keyword">if</span> existing remote URL <span class="keyword">for</span> the repo or branch does not match current one</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">may not be supported by older git versions</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"> Check the folder as a git repository.</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"> Then the target URL matches the <span class="built_in">local</span> URL.</span></span><br><span class="line"></span><br><span class="line">	if [[ &quot;$(git rev-parse --git-dir 2&gt;/dev/null)&quot; == &quot;.git&quot; &amp;&amp; \</span><br><span class="line">		  &quot;$url&quot; != *&quot;$(git remote get-url origin | sed &#x27;s/^.*@//&#x27; | sed &#x27;s/^.*\/\///&#x27; 2&gt;/dev/null)&quot; ]]; then</span><br><span class="line">		display_alert &quot;Remote URL does not match, removing existing local copy&quot;</span><br><span class="line">		rm -rf .git ./*</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$(git rev-parse --git-dir 2&gt;/dev/null)&quot; != &quot;.git&quot; ]]; then</span><br><span class="line">		display_alert &quot;Creating local copy&quot;</span><br><span class="line">		git init -q .</span><br><span class="line">		git remote add origin &quot;$&#123;url&#125;&quot;</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">Here you need to upload from a new address</span></span><br><span class="line">		offline=false</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	local changed=false</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">when we work offline we simply <span class="built_in">return</span> the sources to their original state</span></span><br><span class="line">	if ! $offline; then</span><br><span class="line">		local local_hash</span><br><span class="line">		local_hash=$(git rev-parse @ 2&gt;/dev/null)</span><br><span class="line"></span><br><span class="line">		case $ref_type in</span><br><span class="line">			branch)</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">TODO: grep refs/heads/<span class="variable">$name</span></span></span><br><span class="line">			local remote_hash</span><br><span class="line">			remote_hash=$(improved_git ls-remote -h &quot;$&#123;url&#125;&quot; &quot;$ref_name&quot; | head -1 | cut -f1)</span><br><span class="line">			[[ -z $local_hash || &quot;$&#123;local_hash&#125;&quot; != &quot;$&#123;remote_hash&#125;&quot; ]] &amp;&amp; changed=true</span><br><span class="line">			;;</span><br><span class="line"></span><br><span class="line">			tag)</span><br><span class="line">			local remote_hash</span><br><span class="line">			remote_hash=$(improved_git ls-remote -t &quot;$&#123;url&#125;&quot; &quot;$ref_name&quot; | cut -f1)</span><br><span class="line">			if [[ -z $local_hash || &quot;$&#123;local_hash&#125;&quot; != &quot;$&#123;remote_hash&#125;&quot; ]]; then</span><br><span class="line">				remote_hash=$(improved_git ls-remote -t &quot;$&#123;url&#125;&quot; &quot;$ref_name^&#123;&#125;&quot; | cut -f1)</span><br><span class="line">				[[ -z $remote_hash || &quot;$&#123;local_hash&#125;&quot; != &quot;$&#123;remote_hash&#125;&quot; ]] &amp;&amp; changed=true</span><br><span class="line">			fi</span><br><span class="line">			;;</span><br><span class="line"></span><br><span class="line">			head)</span><br><span class="line">			local remote_hash</span><br><span class="line">			remote_hash=$(improved_git ls-remote &quot;$&#123;url&#125;&quot; HEAD | cut -f1)</span><br><span class="line">			[[ -z $local_hash || &quot;$&#123;local_hash&#125;&quot; != &quot;$&#123;remote_hash&#125;&quot; ]] &amp;&amp; changed=true</span><br><span class="line">			;;</span><br><span class="line"></span><br><span class="line">			commit)</span><br><span class="line">			[[ -z $local_hash || $local_hash == &quot;@&quot; ]] &amp;&amp; changed=true</span><br><span class="line">			;;</span><br><span class="line">		esac</span><br><span class="line"></span><br><span class="line">	fi # offline</span><br><span class="line"></span><br><span class="line">	if [[ $changed == true ]]; then</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">remote was updated, fetch and check out updates</span></span><br><span class="line">		display_alert &quot;Fetching updates&quot;</span><br><span class="line">		case $ref_type in</span><br><span class="line">			branch) improved_git fetch --depth 200 origin &quot;$&#123;ref_name&#125;&quot; ;;</span><br><span class="line">			tag) improved_git fetch --depth 200 origin tags/&quot;$&#123;ref_name&#125;&quot; ;;</span><br><span class="line">			head) improved_git fetch --depth 200 origin HEAD ;;</span><br><span class="line">		esac</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">commit <span class="built_in">type</span> needs support <span class="keyword">for</span> older git servers that doesn<span class="string">&#x27;t support fetching id directly</span></span></span><br><span class="line">		if [[ $ref_type == commit ]]; then</span><br><span class="line"></span><br><span class="line">			improved_git fetch --depth 200 origin &quot;$&#123;ref_name&#125;&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">cover old type</span></span></span><br><span class="line">			if [[ $? -ne 0 ]]; then</span><br><span class="line"></span><br><span class="line">				display_alert &quot;Commit checkout not supported on this repository. Doing full clone.&quot; &quot;&quot; &quot;wrn&quot;</span><br><span class="line">				improved_git pull</span><br><span class="line">				git checkout -fq &quot;$&#123;ref_name&#125;&quot;</span><br><span class="line">				display_alert &quot;Checkout out to&quot; &quot;$(git --no-pager log -2 --pretty=format:&quot;$ad%s [%an]&quot; | head -1)&quot; &quot;info&quot;</span><br><span class="line"></span><br><span class="line">			else</span><br><span class="line"></span><br><span class="line">				display_alert &quot;Checking out&quot;</span><br><span class="line">				git checkout -f -q FETCH_HEAD</span><br><span class="line">				git clean -qdf</span><br><span class="line"></span><br><span class="line">			fi</span><br><span class="line">		else</span><br><span class="line"></span><br><span class="line">			display_alert &quot;Checking out&quot;</span><br><span class="line">			git checkout -f -q FETCH_HEAD</span><br><span class="line">			git clean -qdf</span><br><span class="line"></span><br><span class="line">		fi</span><br><span class="line">	elif [[ -n $(git status -uno --porcelain --ignore-submodules=all) ]]; then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">working directory is not clean</span></span></span><br><span class="line">		display_alert &quot; Cleaning .... &quot; &quot;$(git status -s | wc -l) files&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">Return the files that are tracked by git to the initial state.</span></span></span><br><span class="line">		git checkout -f -q HEAD</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">Files that are not tracked by git and were added</span></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">when the patch was applied must be removed.</span></span></span><br><span class="line">		git clean -qdf</span><br><span class="line">	else</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">working directory is clean, nothing to do</span></span></span><br><span class="line">		display_alert &quot;Up to date&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ -f .gitmodules ]]; then</span><br><span class="line">		display_alert &quot;Updating submodules&quot; &quot;&quot; &quot;ext&quot;</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">FML: http://stackoverflow.com/a/17692710</span></span></span><br><span class="line">		for i in $(git config -f .gitmodules --get-regexp path | awk &#x27;&#123; print $2 &#125;&#x27;); do</span><br><span class="line">			cd &quot;$&#123;workdir&#125;&quot; || exit</span><br><span class="line">			local surl sref</span><br><span class="line">			surl=$(git config -f .gitmodules --get &quot;submodule.$i.url&quot;)</span><br><span class="line">			sref=$(git config -f .gitmodules --get &quot;submodule.$i.branch&quot;)</span><br><span class="line">			if [[ -n $sref ]]; then</span><br><span class="line">				sref=&quot;branch:$sref&quot;</span><br><span class="line">			else</span><br><span class="line">				sref=&quot;head&quot;</span><br><span class="line">			fi</span><br><span class="line">			fetch_from_repo &quot;$surl&quot; &quot;$workdir/$i&quot; &quot;$sref&quot;</span><br><span class="line">		done</span><br><span class="line">	fi</span><br><span class="line">&#125; #############################################################################</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">--------------------------------------------------------------------------------------------------------------------------------</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Let&#x27;</span>s have unique way of displaying alerts</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line">display_alert()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="built_in">log</span> <span class="keyword">function</span> parameters to install.log</span></span><br><span class="line">	[[ -n &quot;$&#123;DEST&#125;&quot; ]] &amp;&amp; echo &quot;Displaying message: $@&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/output.log</span><br><span class="line"></span><br><span class="line">	local tmp=&quot;&quot;</span><br><span class="line">	[[ -n $2 ]] &amp;&amp; tmp=&quot;[\e[0;33m $2 \x1B[0m]&quot;</span><br><span class="line"></span><br><span class="line">	case $3 in</span><br><span class="line">		err)</span><br><span class="line">		echo -e &quot;[\e[0;31m error \x1B[0m] $1 $tmp&quot;</span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">		wrn)</span><br><span class="line">		echo -e &quot;[\e[0;35m warn \x1B[0m] $1 $tmp&quot;</span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">		ext)</span><br><span class="line">		echo -e &quot;[\e[0;32m o.k. \x1B[0m] \e[1;32m$1\x1B[0m $tmp&quot;</span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">		info)</span><br><span class="line">		echo -e &quot;[\e[0;32m o.k. \x1B[0m] $1 $tmp&quot;</span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">		*)</span><br><span class="line">		echo -e &quot;[\e[0;32m .... \x1B[0m] $1 $tmp&quot;</span><br><span class="line">		;;</span><br><span class="line">	esac</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">fingerprint_image &lt;out_txt_file&gt; [image_filename]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Saving build summary to the image</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line">fingerprint_image()</span><br><span class="line">&#123;</span><br><span class="line">	cat &lt;&lt;-EOF &gt; &quot;$&#123;1&#125;&quot;</span><br><span class="line">	--------------------------------------------------------------------------------</span><br><span class="line">	Title:			$&#123;VENDOR&#125; $REVISION $&#123;BOARD^&#125; $DISTRIBUTION $RELEASE $BRANCH</span><br><span class="line">	Kernel:			Linux $VER</span><br><span class="line">	Build date:		$(date +&#x27;%d.%m.%Y&#x27;)</span><br><span class="line">	Maintainer:		$MAINTAINER &lt;$MAINTAINERMAIL&gt;</span><br><span class="line">	Sources: 		https://github.com/orangepi-xunlong/orangepi-build</span><br><span class="line">	Support: 		http://www.orangepi.org/</span><br><span class="line">	EOF</span><br><span class="line"></span><br><span class="line">	if [ -n &quot;$2&quot; ]; then</span><br><span class="line">		cat &lt;&lt;-EOF &gt;&gt; &quot;$&#123;1&#125;&quot;</span><br><span class="line">		--------------------------------------------------------------------------------</span><br><span class="line">		Partitioning configuration: $IMAGE_PARTITION_TABLE offset: $OFFSET</span><br><span class="line">		Boot partition type: $&#123;BOOTFS_TYPE:-(none)&#125; $&#123;BOOTSIZE:+&quot;($&#123;BOOTSIZE&#125; MB)&quot;&#125;</span><br><span class="line">		Root partition type: $ROOTFS_TYPE $&#123;FIXED_IMAGE_SIZE:+&quot;($&#123;FIXED_IMAGE_SIZE&#125; MB)&quot;&#125;</span><br><span class="line"></span><br><span class="line">		CPU configuration: $CPUMIN - $CPUMAX with $GOVERNOR</span><br><span class="line">		--------------------------------------------------------------------------------</span><br><span class="line">		Verify GPG signature:</span><br><span class="line">		gpg --verify $2.img.asc</span><br><span class="line"></span><br><span class="line">		Verify image file integrity:</span><br><span class="line">		sha256sum --check $2.img.sha</span><br><span class="line"></span><br><span class="line">		Prepare SD card (four methodes):</span><br><span class="line">		zcat $2.img.gz | pv | dd of=/dev/sdX bs=1M</span><br><span class="line">		dd if=$2.img of=/dev/sdX bs=1M</span><br><span class="line">		balena-etcher $2.img.gz -d /dev/sdX</span><br><span class="line">		balena-etcher $2.img -d /dev/sdX</span><br><span class="line">		EOF</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	cat &lt;&lt;-EOF &gt;&gt; &quot;$&#123;1&#125;&quot;</span><br><span class="line">	--------------------------------------------------------------------------------</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">(<span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$&#123;SRC&#125;</span>&quot;</span>/LICENSE)</span></span><br><span class="line">	--------------------------------------------------------------------------------</span><br><span class="line">	EOF</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Create kernel boot logo from packages/blobs/splash/logo.png and packages/blobs/splash/spinner.gif (animated)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">and place to the file /lib/firmware/bootsplash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line">function boot_logo ()</span><br><span class="line">&#123;</span><br><span class="line">display_alert &quot;Building kernel splash logo&quot; &quot;$RELEASE&quot; &quot;info&quot;</span><br><span class="line"></span><br><span class="line">	LOGO=$&#123;EXTER&#125;/packages/blobs/splash/logo.png</span><br><span class="line">	LOGO_WIDTH=$(identify $LOGO | cut -d &quot; &quot; -f 3 | cut -d x -f 1)</span><br><span class="line">	LOGO_HEIGHT=$(identify $LOGO | cut -d &quot; &quot; -f 3 | cut -d x -f 2)</span><br><span class="line">	THROBBER=$&#123;EXTER&#125;/packages/blobs/splash/spinner.gif</span><br><span class="line">	THROBBER_WIDTH=$(identify $THROBBER | head -1 | cut -d &quot; &quot; -f 3 | cut -d x -f 1)</span><br><span class="line">	THROBBER_HEIGHT=$(identify $THROBBER | head -1 | cut -d &quot; &quot; -f 3 | cut -d x -f 2)</span><br><span class="line">	convert -alpha remove -background &quot;#000000&quot;	$LOGO &quot;$&#123;SDCARD&#125;&quot;/tmp/logo.rgb</span><br><span class="line">	convert -alpha remove -background &quot;#000000&quot; $THROBBER &quot;$&#123;SDCARD&#125;&quot;/tmp/throbber%02d.rgb</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">&#123;EXTER&#125;/packages/blobs/splash/bootsplash-packer \</span></span><br><span class="line"><span class="language-bash">	--bg_red 0x00 \</span></span><br><span class="line"><span class="language-bash">	--bg_green 0x00 \</span></span><br><span class="line"><span class="language-bash">	--bg_blue 0x00 \</span></span><br><span class="line"><span class="language-bash">	--frame_ms 48 \</span></span><br><span class="line"><span class="language-bash">	--picture \</span></span><br><span class="line"><span class="language-bash">	--pic_width <span class="variable">$LOGO_WIDTH</span> \</span></span><br><span class="line"><span class="language-bash">	--pic_height <span class="variable">$LOGO_HEIGHT</span> \</span></span><br><span class="line"><span class="language-bash">	--pic_position 0 \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/logo.rgb \</span></span><br><span class="line"><span class="language-bash">	--picture \</span></span><br><span class="line"><span class="language-bash">	--pic_width <span class="variable">$THROBBER_WIDTH</span> \</span></span><br><span class="line"><span class="language-bash">	--pic_height <span class="variable">$THROBBER_HEIGHT</span> \</span></span><br><span class="line"><span class="language-bash">	--pic_position 0x05 \</span></span><br><span class="line"><span class="language-bash">	--pic_position_offset 200 \</span></span><br><span class="line"><span class="language-bash">	--pic_anim_type 1 \</span></span><br><span class="line"><span class="language-bash">	--pic_anim_loop 0 \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber00.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber01.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber02.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber03.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber04.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber05.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber06.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber07.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber08.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber09.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber10.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber11.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber12.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber13.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber14.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber15.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber16.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber17.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber18.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber19.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber20.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber21.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber22.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber23.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber24.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber25.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber26.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber27.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber28.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber29.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber30.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber31.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber32.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber33.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber34.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber35.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber36.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber37.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber38.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber39.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber40.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber41.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber42.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber43.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber44.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber45.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber46.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber47.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber48.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber49.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber50.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber51.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber52.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber53.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber54.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber55.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber56.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber57.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber58.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber59.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber60.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber61.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber62.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber63.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber64.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber65.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber66.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber67.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber68.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber69.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber70.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber71.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber72.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber73.rgb \</span></span><br><span class="line"><span class="language-bash">	--blob <span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/tmp/throbber74.rgb \</span></span><br><span class="line"><span class="language-bash">	<span class="string">&quot;<span class="variable">$&#123;SDCARD&#125;</span>&quot;</span>/lib/firmware/bootsplash.orangepi &gt;/dev/null 2&gt;&amp;1</span></span><br><span class="line">	if [[ $BOOT_LOGO == yes || $BOOT_LOGO == desktop &amp;&amp; $BUILD_DESKTOP == yes &amp;&amp; $RELEASE != buster ]]; then</span><br><span class="line">		[[ -f &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt ]] &amp;&amp;	grep -q &#x27;^bootlogo&#x27; &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt &amp;&amp; \</span><br><span class="line">		sed -i &#x27;s/^bootlogo.*/bootlogo=true/&#x27; &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt || echo &#x27;bootlogo=true&#x27; &gt;&gt; &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt</span><br><span class="line">		[[ -f &quot;$&#123;SDCARD&#125;&quot;/boot/boot.ini ]] &amp;&amp;	sed -i &#x27;s/^setenv bootlogo.*/setenv bootlogo &quot;true&quot;/&#x27; &quot;$&#123;SDCARD&#125;&quot;/boot/boot.ini</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="built_in">enable</span> additional services</span></span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl --no-reload enable bootsplash-ask-password-console.path &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl --no-reload enable bootsplash-hide-when-booted.service &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl --no-reload enable bootsplash-show-on-shutdown.service &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DISTRIBUTIONS_DESC_DIR=&quot;external/config/distributions&quot;</span><br><span class="line"></span><br><span class="line">function distro_menu ()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">create a <span class="keyword">select</span> menu <span class="keyword">for</span> choosing a distribution based EXPERT status</span></span><br><span class="line"></span><br><span class="line">	local distrib_dir=&quot;$&#123;1&#125;&quot;</span><br><span class="line"></span><br><span class="line">	if [[ -d &quot;$&#123;distrib_dir&#125;&quot; &amp;&amp; -f &quot;$&#123;distrib_dir&#125;/support&quot; ]]; then</span><br><span class="line">		local support_level=&quot;$(cat &quot;$&#123;distrib_dir&#125;/support&quot;)&quot;</span><br><span class="line">		if [[ &quot;$&#123;support_level&#125;&quot; != &quot;supported&quot; &amp;&amp; $EXPERT != &quot;yes&quot; ]]; then</span><br><span class="line">			:</span><br><span class="line">		else</span><br><span class="line">			local distro_codename=&quot;$(basename &quot;$&#123;distrib_dir&#125;&quot;)&quot;</span><br><span class="line">			local distro_fullname=&quot;$(cat &quot;$&#123;distrib_dir&#125;/name&quot;)&quot;</span><br><span class="line">			local expert_infos=&quot;&quot;</span><br><span class="line">			[[ $EXPERT == &quot;yes&quot; ]] &amp;&amp; expert_infos=&quot;($&#123;support_level&#125;)&quot;</span><br><span class="line"></span><br><span class="line">			if [[ &quot;$&#123;BRANCH&#125;&quot; == &quot;legacy&quot; ]]; then</span><br><span class="line">				DISTRIB_TYPE=&quot;$&#123;DISTRIB_TYPE_LEGACY&#125;&quot;</span><br><span class="line">				[[ -z &quot;$&#123;DISTRIB_TYPE_LEGACY&#125;&quot; ]] &amp;&amp; DISTRIB_TYPE=&quot;buster bionic focal&quot;</span><br><span class="line">			elif [[ &quot;$&#123;BRANCH&#125;&quot; == &quot;current&quot; ]]; then</span><br><span class="line">				DISTRIB_TYPE=&quot;$&#123;DISTRIB_TYPE_CURRENT&#125;&quot;</span><br><span class="line">				[[ -z &quot;$&#123;DISTRIB_TYPE_CURRENT&#125;&quot; ]] &amp;&amp; DISTRIB_TYPE=&quot;bullseye bookworm focal jammy&quot;</span><br><span class="line">			elif [[ &quot;$&#123;BRANCH&#125;&quot; == &quot;next&quot; ]]; then</span><br><span class="line">				if [[ -n &quot;$&#123;DISTRIB_TYPE_NEXT&#125;&quot; ]]; then</span><br><span class="line">					DISTRIB_TYPE=&quot;$&#123;DISTRIB_TYPE_NEXT&#125;&quot;</span><br><span class="line">				else</span><br><span class="line">					DISTRIB_TYPE=&quot;$&#123;DISTRIB_TYPE_CURRENT&#125;&quot;</span><br><span class="line">					[[ -z &quot;$&#123;DISTRIB_TYPE_CURRENT&#125;&quot; ]] &amp;&amp; DISTRIB_TYPE=&quot;bullseye bookworm focal jammy&quot;</span><br><span class="line">				fi</span><br><span class="line">			fi</span><br><span class="line"></span><br><span class="line">			if [[ &quot;$&#123;DISTRIB_TYPE&#125;&quot; =~ &quot;$&#123;distro_codename&#125;&quot; ]]; then</span><br><span class="line">				options+=(&quot;$&#123;distro_codename&#125;&quot; &quot;$&#123;distro_fullname&#125; $&#123;expert_infos&#125;&quot;)</span><br><span class="line">			fi</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function distros_options() &#123;</span><br><span class="line">	for distrib_dir in &quot;$&#123;DISTRIBUTIONS_DESC_DIR&#125;/&quot;*; do</span><br><span class="line">		distro_menu &quot;$&#123;distrib_dir&#125;&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function set_distribution_status() &#123;</span><br><span class="line"></span><br><span class="line">	local distro_support_desc_filepath=&quot;$&#123;SRC&#125;/$&#123;DISTRIBUTIONS_DESC_DIR&#125;/$&#123;RELEASE&#125;/support&quot;</span><br><span class="line">	if [[ ! -f &quot;$&#123;distro_support_desc_filepath&#125;&quot; ]]; then</span><br><span class="line">		exit_with_error &quot;Distribution $&#123;distribution_name&#125; does not exist&quot;</span><br><span class="line">	else</span><br><span class="line">		DISTRIBUTION_STATUS=&quot;$(cat &quot;$&#123;distro_support_desc_filepath&#125;&quot;)&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	[[ &quot;$&#123;DISTRIBUTION_STATUS&#125;&quot; != &quot;supported&quot; ]] &amp;&amp; [[ &quot;$&#123;EXPERT&#125;&quot; != &quot;yes&quot; ]] &amp;&amp; exit_with_error &quot;Orange Pi $&#123;RELEASE&#125; is unsupported and, therefore, only available to experts (EXPERT=yes)&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">adding_packages()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">add deb files to repository <span class="keyword">if</span> they are not already there</span></span><br><span class="line"></span><br><span class="line">	display_alert &quot;Checking and adding to repository $release&quot; &quot;$3&quot; &quot;ext&quot;</span><br><span class="line">	for f in &quot;$&#123;DEB_STORAGE&#125;$&#123;2&#125;&quot;/*.deb</span><br><span class="line">	do</span><br><span class="line">		local name version arch</span><br><span class="line">		name=$(dpkg-deb -I &quot;$&#123;f&#125;&quot; | grep Package | awk &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">		version=$(dpkg-deb -I &quot;$&#123;f&#125;&quot; | grep Version | awk &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">		arch=$(dpkg-deb -I &quot;$&#123;f&#125;&quot; | grep Architecture | awk &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">add <span class="keyword">if</span> not already there</span></span><br><span class="line">		aptly repo search -architectures=&quot;$&#123;arch&#125;&quot; -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;1&#125;&quot; &#x27;Name (% &#x27;$&#123;name&#125;&#x27;), $Version (=&#x27;$&#123;version&#125;&#x27;), $Architecture (=&#x27;$&#123;arch&#125;&#x27;)&#x27; &amp;&gt;/dev/null</span><br><span class="line">		if [[ $? -ne 0 ]]; then</span><br><span class="line">			display_alert &quot;Adding $&#123;1&#125;&quot; &quot;$name&quot; &quot;info&quot;</span><br><span class="line">			aptly repo add -force-replace=true -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;1&#125;&quot; &quot;$&#123;f&#125;&quot; &amp;&gt;/dev/null</span><br><span class="line">		fi</span><br><span class="line">	done</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">addtorepo()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">create repository</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">parameter <span class="string">&quot;remove&quot;</span> dumps all and creates new</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">parameter <span class="string">&quot;delete&quot;</span> remove incoming directory <span class="keyword">if</span> publishing is succesful</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">function</span>: cycle trough distributions</span></span><br><span class="line"></span><br><span class="line">	local distributions=(&quot;stretch&quot; &quot;bionic&quot; &quot;buster&quot; &quot;bullseye&quot; &quot;bookworm&quot; &quot;focal&quot; &quot;hirsute&quot; &quot;jammy&quot; &quot;sid&quot;)</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="built_in">local</span> distributions=($(grep -rw config/distributions/*/ -e <span class="string">&#x27;supported&#x27;</span> | <span class="built_in">cut</span> -d<span class="string">&quot;/&quot;</span> -f3))</span></span><br><span class="line">	local errors=0</span><br><span class="line"></span><br><span class="line">	for release in &quot;$&#123;distributions[@]&#125;&quot;; do</span><br><span class="line"></span><br><span class="line">		local forceoverwrite=&quot;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="built_in">let</span><span class="string">&#x27;s drop from publish if exits</span></span></span><br><span class="line">		if [[ -n $(aptly publish list -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; -raw | awk &#x27;&#123;print $(NF)&#125;&#x27; | grep &quot;$&#123;release&#125;&quot;) ]]; then</span><br><span class="line">			aptly publish drop -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;release&#125;&quot; &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">create local repository if not exist</span></span></span><br><span class="line">		if [[ -z $(aptly repo list -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; -raw | awk &#x27;&#123;print $(NF)&#125;&#x27; | grep &quot;$&#123;release&#125;&quot;) ]]; then</span><br><span class="line">			display_alert &quot;Creating section&quot; &quot;main&quot; &quot;info&quot;</span><br><span class="line">			aptly repo create -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; -distribution=&quot;$&#123;release&#125;&quot; -component=&quot;main&quot; \</span><br><span class="line">			-comment=&quot;Armbian main repository&quot; &quot;$&#123;release&#125;&quot; &gt;/dev/null</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		if [[ -z $(aptly repo list -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; -raw | awk &#x27;&#123;print $(NF)&#125;&#x27; | grep &quot;^utils&quot;) ]]; then</span><br><span class="line">			aptly repo create -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; -distribution=&quot;$&#123;release&#125;&quot; -component=&quot;utils&quot; \</span><br><span class="line">			-comment=&quot;Armbian utilities (backwards compatibility)&quot; utils &gt;/dev/null</span><br><span class="line">		fi</span><br><span class="line">		if [[ -z $(aptly repo list -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; -raw | awk &#x27;&#123;print $(NF)&#125;&#x27; | grep &quot;$&#123;release&#125;-utils&quot;) ]]; then</span><br><span class="line">			aptly repo create -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; -distribution=&quot;$&#123;release&#125;&quot; -component=&quot;$&#123;release&#125;-utils&quot; \</span><br><span class="line">			-comment=&quot;Armbian $&#123;release&#125; utilities&quot; &quot;$&#123;release&#125;-utils&quot; &gt;/dev/null</span><br><span class="line">		fi</span><br><span class="line">		if [[ -z $(aptly repo list -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; -raw | awk &#x27;&#123;print $(NF)&#125;&#x27; | grep &quot;$&#123;release&#125;-desktop&quot;) ]]; then</span><br><span class="line">			aptly repo create -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; -distribution=&quot;$&#123;release&#125;&quot; -component=&quot;$&#123;release&#125;-desktop&quot; \</span><br><span class="line">			-comment=&quot;Armbian $&#123;release&#125; desktop&quot; &quot;$&#123;release&#125;-desktop&quot; &gt;/dev/null</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">adding main</span></span></span><br><span class="line">		if find &quot;$&#123;DEB_STORAGE&#125;&quot;/ -maxdepth 1 -type f -name &quot;*.deb&quot; 2&gt;/dev/null | grep -q .; then</span><br><span class="line">			adding_packages &quot;$release&quot; &quot;&quot; &quot;main&quot;</span><br><span class="line">		else</span><br><span class="line">			aptly repo add -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;release&#125;&quot; &quot;$&#123;SCRIPTPATH&#125;config/templates/example.deb&quot; &gt;/dev/null</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		local COMPONENTS=&quot;main&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">adding main distribution packages</span></span></span><br><span class="line">		if find &quot;$&#123;DEB_STORAGE&#125;/$&#123;release&#125;&quot; -maxdepth 1 -type f -name &quot;*.deb&quot; 2&gt;/dev/null | grep -q .; then</span><br><span class="line">			adding_packages &quot;$&#123;release&#125;-utils&quot; &quot;/$&#123;release&#125;&quot; &quot;release packages&quot;</span><br><span class="line">		else</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">workaround - add dummy package to not trigger error</span></span></span><br><span class="line">			aptly repo add -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;release&#125;&quot; &quot;$&#123;SCRIPTPATH&#125;config/templates/example.deb&quot; &gt;/dev/null</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">adding release-specific utils</span></span></span><br><span class="line">		if find &quot;$&#123;DEB_STORAGE&#125;/extra/$&#123;release&#125;-utils&quot; -maxdepth 1 -type f -name &quot;*.deb&quot; 2&gt;/dev/null | grep -q .; then</span><br><span class="line">			adding_packages &quot;$&#123;release&#125;-utils&quot; &quot;/extra/$&#123;release&#125;-utils&quot; &quot;release utils&quot;</span><br><span class="line">		else</span><br><span class="line">			aptly repo add -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;release&#125;-utils&quot; &quot;$&#123;SCRIPTPATH&#125;config/templates/example.deb&quot; &gt;/dev/null</span><br><span class="line">		fi</span><br><span class="line">		COMPONENTS=&quot;$&#123;COMPONENTS&#125; $&#123;release&#125;-utils&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">adding desktop</span></span></span><br><span class="line">		if find &quot;$&#123;DEB_STORAGE&#125;/extra/$&#123;release&#125;-desktop&quot; -maxdepth 1 -type f -name &quot;*.deb&quot; 2&gt;/dev/null | grep -q .; then</span><br><span class="line">			adding_packages &quot;$&#123;release&#125;-desktop&quot; &quot;/extra/$&#123;release&#125;-desktop&quot; &quot;desktop&quot;</span><br><span class="line">		else</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">workaround - add dummy package to not trigger error</span></span></span><br><span class="line">			aptly repo add -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;release&#125;-desktop&quot; &quot;$&#123;SCRIPTPATH&#125;config/templates/example.deb&quot; &gt;/dev/null</span><br><span class="line">		fi</span><br><span class="line">		COMPONENTS=&quot;$&#123;COMPONENTS&#125; $&#123;release&#125;-desktop&quot;</span><br><span class="line"></span><br><span class="line">		local mainnum utilnum desknum</span><br><span class="line">		mainnum=$(aptly repo show -with-packages -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;release&#125;&quot; | grep &quot;Number of packages&quot; | awk &#x27;&#123;print $NF&#125;&#x27;)</span><br><span class="line">		utilnum=$(aptly repo show -with-packages -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;release&#125;-desktop&quot; | grep &quot;Number of packages&quot; | awk &#x27;&#123;print $NF&#125;&#x27;)</span><br><span class="line">		desknum=$(aptly repo show -with-packages -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;release&#125;-utils&quot; | grep &quot;Number of packages&quot; | awk &#x27;&#123;print $NF&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">		if [ $mainnum -gt 0 ] &amp;&amp; [ $utilnum -gt 0 ] &amp;&amp; [ $desknum -gt 0 ]; then</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">publish</span></span></span><br><span class="line">			aptly publish \</span><br><span class="line">			-acquire-by-hash \</span><br><span class="line">			-passphrase=&quot;$&#123;GPG_PASS&#125;&quot; \</span><br><span class="line">			-origin=&quot;Armbian&quot; \</span><br><span class="line">			-label=&quot;Armbian&quot; \</span><br><span class="line">			-config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; \</span><br><span class="line">			-component=&quot;$&#123;COMPONENTS// /,&#125;&quot; \</span><br><span class="line">			-distribution=&quot;$&#123;release&#125;&quot; repo &quot;$&#123;release&#125;&quot; $&#123;COMPONENTS//main/&#125; &gt;/dev/null</span><br><span class="line"></span><br><span class="line">			if [[ $? -ne 0 ]]; then</span><br><span class="line">				display_alert &quot;Publishing failed&quot; &quot;$&#123;release&#125;&quot; &quot;err&quot;</span><br><span class="line">				errors=$((errors+1))</span><br><span class="line">				exit 0</span><br><span class="line">			fi</span><br><span class="line">		else</span><br><span class="line">			errors=$((errors+1))</span><br><span class="line">			local err_txt=&quot;: All components must be present: main, utils and desktop for first build&quot;</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">	done</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">cleanup</span></span></span><br><span class="line">	display_alert &quot;Cleaning repository&quot; &quot;$&#123;DEB_STORAGE&#125;&quot; &quot;info&quot;</span><br><span class="line">	aptly db cleanup -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">display what we have</span></span></span><br><span class="line">	echo &quot;&quot;</span><br><span class="line">	display_alert &quot;List of local repos&quot; &quot;local&quot; &quot;info&quot;</span><br><span class="line">	(aptly repo list -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot;) | grep -E packages</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">remove debs if no errors found</span></span></span><br><span class="line">	if [[ $errors -eq 0 ]]; then</span><br><span class="line">		if [[ &quot;$2&quot; == &quot;delete&quot; ]]; then</span><br><span class="line">			display_alert &quot;Purging incoming debs&quot; &quot;all&quot; &quot;ext&quot;</span><br><span class="line">			find &quot;$&#123;DEB_STORAGE&#125;&quot; -name &quot;*.deb&quot; -type f -delete</span><br><span class="line">		fi</span><br><span class="line">	else</span><br><span class="line">		display_alert &quot;There were some problems $err_txt&quot; &quot;leaving incoming directory intact&quot; &quot;err&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">repo-manipulate()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">repository manipulation</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;show&quot; displays packages in each repository</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;server&quot; serve repository - useful for local diagnostics</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;unique&quot; manually select which package should be removed from all repositories</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;update&quot; search for new files in output/debs* to add them to repository</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;purge&quot; leave only last 5 versions</span></span></span><br><span class="line"></span><br><span class="line">	local DISTROS=(&quot;stretch&quot; &quot;bionic&quot; &quot;buster&quot; &quot;bullseye&quot; &quot;bookworm&quot; &quot;focal&quot; &quot;hirsute&quot; &quot;jammy&quot; &quot;sid&quot;)</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">local DISTROS=($(grep -rw config/distributions/*/ -e &#x27;</span>supported<span class="string">&#x27; | cut -d&quot;/&quot; -f3))</span></span></span><br><span class="line"></span><br><span class="line">	case $@ in</span><br><span class="line"></span><br><span class="line">		serve)</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">display repository content</span></span></span><br><span class="line">			display_alert &quot;Serving content&quot; &quot;common utils&quot; &quot;ext&quot;</span><br><span class="line">			aptly serve -listen=$(ip -f inet addr | grep -Po &#x27;inet \K[\d.]+&#x27; | grep -v 127.0.0.1 | head -1):80 -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot;</span><br><span class="line">			exit 0</span><br><span class="line">			;;</span><br><span class="line"></span><br><span class="line">		show)</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">display repository content</span></span></span><br><span class="line">			for release in &quot;$&#123;DISTROS[@]&#125;&quot;; do</span><br><span class="line">				display_alert &quot;Displaying repository contents for&quot; &quot;$release&quot; &quot;ext&quot;</span><br><span class="line">				aptly repo show -with-packages -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;release&#125;&quot; | tail -n +7</span><br><span class="line">				aptly repo show -with-packages -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;release&#125;-desktop&quot; | tail -n +7</span><br><span class="line">			done</span><br><span class="line">			display_alert &quot;Displaying repository contents for&quot; &quot;common utils&quot; &quot;ext&quot;</span><br><span class="line">			aptly repo show -with-packages -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; utils | tail -n +7</span><br><span class="line">			echo &quot;done.&quot;</span><br><span class="line">			exit 0</span><br><span class="line">			;;</span><br><span class="line"></span><br><span class="line">		unique)</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">which package should be removed from all repositories</span></span></span><br><span class="line">			IFS=$&#x27;\n&#x27;</span><br><span class="line">			while true; do</span><br><span class="line">				LIST=()</span><br><span class="line">				for release in &quot;$&#123;DISTROS[@]&#125;&quot;; do</span><br><span class="line">					LIST+=( $(aptly repo show -with-packages -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;release&#125;&quot; | tail -n +7) )</span><br><span class="line">					LIST+=( $(aptly repo show -with-packages -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;release&#125;-desktop&quot; | tail -n +7) )</span><br><span class="line">				done</span><br><span class="line">				LIST+=( $(aptly repo show -with-packages -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; utils | tail -n +7) )</span><br><span class="line">				LIST=( $(echo &quot;$&#123;LIST[@]&#125;&quot; | tr &#x27; &#x27; &#x27;\n&#x27; | sort -u))</span><br><span class="line">				new_list=()</span><br><span class="line">				# create a human readable menu</span><br><span class="line">				for ((n=0;n&lt;$(($&#123;#LIST[@]&#125;));n++));</span><br><span class="line">				do</span><br><span class="line">					new_list+=( &quot;$&#123;LIST[$n]&#125;&quot; )</span><br><span class="line">					new_list+=( &quot;&quot; )</span><br><span class="line">				done</span><br><span class="line">				LIST=(&quot;$&#123;new_list[@]&#125;&quot;)</span><br><span class="line">				LIST_LENGTH=$(($&#123;#LIST[@]&#125;/2));</span><br><span class="line">				exec 3&gt;&amp;1</span><br><span class="line">				TARGET_VERSION=$(dialog --cancel-label &quot;Cancel&quot; --backtitle &quot;BACKTITLE&quot; --no-collapse --title &quot;Remove packages from repositories&quot; --clear --menu &quot;Delete&quot; $((9+$&#123;LIST_LENGTH&#125;)) 82 65 &quot;$&#123;LIST[@]&#125;&quot; 2&gt;&amp;1 1&gt;&amp;3)</span><br><span class="line">				exitstatus=$?;</span><br><span class="line">				exec 3&gt;&amp;-</span><br><span class="line">				if [[ $exitstatus -eq 0 ]]; then</span><br><span class="line">					for release in &quot;$&#123;DISTROS[@]&#125;&quot;; do</span><br><span class="line">						aptly repo remove -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot;  &quot;$&#123;release&#125;&quot; &quot;$TARGET_VERSION&quot;</span><br><span class="line">						aptly repo remove -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot;  &quot;$&#123;release&#125;-desktop&quot; &quot;$TARGET_VERSION&quot;</span><br><span class="line">					done</span><br><span class="line">					aptly repo remove -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;utils&quot; &quot;$TARGET_VERSION&quot;</span><br><span class="line">				else</span><br><span class="line">					exit 1</span><br><span class="line">				fi</span><br><span class="line">				aptly db cleanup -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">			done</span><br><span class="line">			;;</span><br><span class="line"></span><br><span class="line">		update)</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">display full help test</span></span></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">run repository update</span></span></span><br><span class="line">			addtorepo &quot;update&quot; &quot;&quot;</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">add a key to repo</span></span></span><br><span class="line">			cp &quot;$&#123;SCRIPTPATH&#125;&quot;config/armbian.key &quot;$&#123;REPO_STORAGE&#125;&quot;/public/</span><br><span class="line">			exit 0</span><br><span class="line">			;;</span><br><span class="line"></span><br><span class="line">		purge)</span><br><span class="line">			for release in &quot;$&#123;DISTROS[@]&#125;&quot;; do</span><br><span class="line">				repo-remove-old-packages &quot;$release&quot; &quot;armhf&quot; &quot;5&quot;</span><br><span class="line">				repo-remove-old-packages &quot;$release&quot; &quot;arm64&quot; &quot;5&quot;</span><br><span class="line">				repo-remove-old-packages &quot;$release&quot; &quot;amd64&quot; &quot;5&quot;</span><br><span class="line">				repo-remove-old-packages &quot;$release&quot; &quot;all&quot; &quot;5&quot;</span><br><span class="line">				aptly -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; -passphrase=&quot;$&#123;GPG_PASS&#125;&quot; publish update &quot;$&#123;release&#125;&quot; &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">			done</span><br><span class="line">			exit 0</span><br><span class="line">			;;</span><br><span class="line"></span><br><span class="line">                purgeedge)</span><br><span class="line">                        for release in &quot;$&#123;DISTROS[@]&#125;&quot;; do</span><br><span class="line">				repo-remove-old-packages &quot;$release&quot; &quot;armhf&quot; &quot;3&quot; &quot;edge&quot;</span><br><span class="line">				repo-remove-old-packages &quot;$release&quot; &quot;arm64&quot; &quot;3&quot; &quot;edge&quot;</span><br><span class="line">				repo-remove-old-packages &quot;$release&quot; &quot;amd64&quot; &quot;3&quot; &quot;edge&quot;</span><br><span class="line">				repo-remove-old-packages &quot;$release&quot; &quot;all&quot; &quot;3&quot; &quot;edge&quot;</span><br><span class="line">				aptly -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; -passphrase=&quot;$&#123;GPG_PASS&#125;&quot; publish update &quot;$&#123;release&#125;&quot; &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">                        done</span><br><span class="line">                        exit 0</span><br><span class="line">                        ;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		purgesource)</span><br><span class="line">			for release in &quot;$&#123;DISTROS[@]&#125;&quot;; do</span><br><span class="line">				aptly repo remove -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;release&#125;&quot; &#x27;Name (% *-source*)&#x27;</span><br><span class="line">				aptly -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; -passphrase=&quot;$&#123;GPG_PASS&#125;&quot; publish update &quot;$&#123;release&#125;&quot;  &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">			done</span><br><span class="line">			aptly db cleanup -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">			exit 0</span><br><span class="line">			;;</span><br><span class="line">		*)</span><br><span class="line"></span><br><span class="line">			echo -e &quot;Usage: repository show | serve | unique | create | update | purge | purgesource\n&quot;</span><br><span class="line">			echo -e &quot;\n show           = display repository content&quot;</span><br><span class="line">			echo -e &quot;\n serve          = publish your repositories on current server over HTTP&quot;</span><br><span class="line">			echo -e &quot;\n unique         = manually select which package should be removed from all repositories&quot;</span><br><span class="line">			echo -e &quot;\n update         = updating repository&quot;</span><br><span class="line">			echo -e &quot;\n purge          = removes all but last 5 versions&quot;</span><br><span class="line">			echo -e &quot;\n purgeedge      = removes all but last 3 edge versions&quot;</span><br><span class="line">			echo -e &quot;\n purgesource    = removes all sources\n\n&quot;</span><br><span class="line">			exit 0</span><br><span class="line">			;;</span><br><span class="line"></span><br><span class="line">	esac</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Removes old packages in the received repo</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># $1: Repository</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">$2: Architecture</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">$3: Amount of packages to keep</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">$4: Additional search pattern</span></span></span><br><span class="line">repo-remove-old-packages() &#123;</span><br><span class="line">	local repo=$1</span><br><span class="line">	local arch=$2</span><br><span class="line">	local keep=$3</span><br><span class="line">	for pkg in $(aptly repo search -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;repo&#125;&quot; &quot;Architecture ($arch)&quot; | grep -v &quot;ERROR: no results&quot; | sort -t &#x27;.&#x27; -nk4 | grep -e &quot;$4&quot;); do</span><br><span class="line">		local pkg_name</span><br><span class="line">		count=0</span><br><span class="line">		pkg_name=$(echo &quot;$&#123;pkg&#125;&quot; | cut -d_ -f1)</span><br><span class="line">		for subpkg in $(aptly repo search -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;repo&#125;&quot; &quot;Name ($pkg_name)&quot;  | grep -v &quot;ERROR: no results&quot; | sort -rt &#x27;.&#x27; -nk4); do</span><br><span class="line">			((count+=1))</span><br><span class="line">			if [[ $count -gt $keep ]]; then</span><br><span class="line">			pkg_version=$(echo &quot;$&#123;subpkg&#125;&quot; | cut -d_ -f2)</span><br><span class="line">			aptly repo remove -config=&quot;$&#123;SCRIPTPATH&#125;config/$&#123;REPO_CONFIG&#125;&quot; &quot;$&#123;repo&#125;&quot; &quot;Name ($pkg_name), Version (= $pkg_version)&quot;</span><br><span class="line">			fi</span><br><span class="line">		done</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">wait_for_package_manager</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># * installation will break if we try to install when package manager is running</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">wait_for_package_manager()</span></span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">exit if package manager is running in the back</span></span></span><br><span class="line">	while true; do</span><br><span class="line">		if [[ &quot;$(fuser /var/lib/dpkg/lock 2&gt;/dev/null; echo $?)&quot; != 1 &amp;&amp; &quot;$(fuser /var/lib/dpkg/lock-frontend 2&gt;/dev/null; echo $?)&quot; != 1 ]]; then</span><br><span class="line">				display_alert &quot;Package manager is running in the background.&quot; &quot;Please wait! Retrying in 30 sec&quot; &quot;wrn&quot;</span><br><span class="line">				sleep 30</span><br><span class="line">			else</span><br><span class="line">				break</span><br><span class="line">		fi</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Installing debian packages in the orangepi build system.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">The function accepts four optional parameters:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">autoupdate - If the installation list is not empty then update first.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">upgrade, clean - the same name for apt</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">verbose - detailed log for the function</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># list=&quot;pkg1 pkg2 pkg3 pkgbadname pkg-1.0 | pkg-2.0 pkg5 (&gt;= 9)&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">install_pkg_deb upgrade verbose $list</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">or</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">install_pkg_deb autoupdate $list</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># If the package has a bad name, we will see it in the log file.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">If there is an LOG_OUTPUT_FILE variable and it has a value as</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the full real path to the log file, then all the information will be there.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The LOG_OUTPUT_FILE variable must be defined in the calling function</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">before calling the install_pkg_deb function and unset after.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">install_pkg_deb ()</span></span></span><br><span class="line">&#123;</span><br><span class="line">	local list=&quot;&quot;</span><br><span class="line">	local log_file</span><br><span class="line">	local for_install</span><br><span class="line">	local need_autoup=false</span><br><span class="line">	local need_upgrade=false</span><br><span class="line">	local need_clean=false</span><br><span class="line">	local need_verbose=false</span><br><span class="line">	local _line=$&#123;BASH_LINENO[0]&#125;</span><br><span class="line">	local _function=$&#123;FUNCNAME[1]&#125;</span><br><span class="line">	local _file=$(basename &quot;$&#123;BASH_SOURCE[1]&#125;&quot;)</span><br><span class="line">	local tmp_file=$(mktemp /tmp/install_log_XXXXX)</span><br><span class="line">	export DEBIAN_FRONTEND=noninteractive</span><br><span class="line"></span><br><span class="line">	list=$(</span><br><span class="line">	for p in $*;do</span><br><span class="line">		case $p in</span><br><span class="line">			autoupdate) need_autoup=true; continue ;;</span><br><span class="line">			upgrade) need_upgrade=true; continue ;;</span><br><span class="line">			clean) need_clean=true; continue ;;</span><br><span class="line">			verbose) need_verbose=true; continue ;;</span><br><span class="line">			\||\(*|*\)) continue ;;</span><br><span class="line">		esac</span><br><span class="line">		echo &quot; $p&quot;</span><br><span class="line">	done</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	if [ -d $(dirname $LOG_OUTPUT_FILE) ]; then</span><br><span class="line">		log_file=$&#123;LOG_OUTPUT_FILE&#125;</span><br><span class="line">	else</span><br><span class="line">		log_file=&quot;$&#123;SRC&#125;/output/$&#123;LOG_SUBPATH&#125;/install.log&quot;</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">This is necessary first when there is no apt cache.</span></span></span><br><span class="line">	if $need_upgrade; then</span><br><span class="line">		apt-get -q update || echo &quot;apt cannot update&quot; &gt;&gt;$tmp_file</span><br><span class="line">		apt-get -y upgrade || echo &quot;apt cannot upgrade&quot; &gt;&gt;$tmp_file</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">If the package is not installed, check the latest</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">up-to-date version in the apt cache.</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Exclude bad package names and send a message to the log.</span></span></span><br><span class="line">	for_install=$(</span><br><span class="line">	for p in $list;do</span><br><span class="line">	  if $(dpkg-query -W -f &#x27;$&#123;db:Status-Abbrev&#125;&#x27; $p |&amp; awk &#x27;/ii/&#123;exit 1&#125;&#x27;);then</span><br><span class="line">		apt-cache  show $p -o APT::Cache::AllVersions=no |&amp; \</span><br><span class="line">		awk -v p=$p -v tmp_file=$tmp_file \</span><br><span class="line">		&#x27;/^Package:/&#123;print $2&#125; /^E:/&#123;print &quot;Bad package name: &quot;,p &gt;&gt;tmp_file&#125;&#x27;</span><br><span class="line">	  fi</span><br><span class="line">	done</span><br><span class="line">	)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">This information should be logged.</span></span></span><br><span class="line">	if [ -s $tmp_file ]; then</span><br><span class="line">		echo -e &quot;\nInstalling packages in function: $_function&quot; &quot;[$_file:$_line]&quot; \</span><br><span class="line"><span class="meta prompt_">		&gt;</span><span class="language-bash"><span class="string">&gt;$log_file</span></span></span><br><span class="line">		echo -e &quot;\nIncoming list:&quot; &gt;&gt;$log_file</span><br><span class="line">		printf &quot;%-30s %-30s %-30s %-30s\n&quot; $list &gt;&gt;$log_file</span><br><span class="line">		echo &quot;&quot; &gt;&gt;$log_file</span><br><span class="line">		cat $tmp_file &gt;&gt;$log_file</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [ -n &quot;$for_install&quot; ]; then</span><br><span class="line">		if $need_autoup; then</span><br><span class="line">			apt-get -q update</span><br><span class="line">			apt-get -y upgrade</span><br><span class="line">		fi</span><br><span class="line">		apt-get install -qq -y --no-install-recommends $for_install</span><br><span class="line">		echo -e &quot;\nPackages installed:&quot; &gt;&gt;$log_file</span><br><span class="line">		dpkg-query -W \</span><br><span class="line">		  -f &#x27;$&#123;binary:Package;-27&#125; $&#123;Version;-23&#125;\n&#x27; \</span><br><span class="line">		  $for_install &gt;&gt;$log_file</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">We will show the status after installation all listed</span></span></span><br><span class="line">	if $need_verbose; then</span><br><span class="line">		echo -e &quot;\nstatus after installation:&quot; &gt;&gt;$log_file</span><br><span class="line">		dpkg-query -W \</span><br><span class="line">		  -f &#x27;$&#123;binary:Package;-27&#125; $&#123;Version;-23&#125; [ $&#123;Status&#125; ]\n&#x27; \</span><br><span class="line">		  $list &gt;&gt;$log_file</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if $need_clean;then apt-get clean; fi</span><br><span class="line">	rm $tmp_file</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">prepare_host_basic</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># * installs only basic packages</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">prepare_host_basic()</span></span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">command:package1 package2 ...</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">list of commands that are neeeded:packages where this command is</span></span></span><br><span class="line">	local check_pack install_pack</span><br><span class="line">	local checklist=(</span><br><span class="line">			&quot;whiptail:whiptail&quot;</span><br><span class="line">			&quot;dialog:dialog&quot;</span><br><span class="line">			&quot;fuser:psmisc&quot;</span><br><span class="line">			&quot;getfacl:acl&quot;</span><br><span class="line">			&quot;uuid:uuid uuid-runtime&quot;</span><br><span class="line">			&quot;curl:curl&quot;</span><br><span class="line">			&quot;gpg:gnupg&quot;</span><br><span class="line">			&quot;gawk:gawk&quot;</span><br><span class="line">			&quot;git:git&quot;</span><br><span class="line">			)</span><br><span class="line"></span><br><span class="line">	for check_pack in &quot;$&#123;checklist[@]&#125;&quot;; do</span><br><span class="line">	        if ! which $&#123;check_pack%:*&#125; &gt;/dev/null; then local install_pack+=$&#123;check_pack#*:&#125;&quot; &quot;; fi</span><br><span class="line">	done</span><br><span class="line"></span><br><span class="line">	if [[ -n $install_pack ]]; then</span><br><span class="line">		display_alert &quot;Installing basic packages&quot; &quot;$install_pack&quot;</span><br><span class="line">		sudo bash -c &quot;apt-get -qq update &amp;&amp; apt-get install -qq -y --no-install-recommends $install_pack&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">prepare_host</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># * checks and installs necessary packages</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">* creates directory structure</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">* changes system settings</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">prepare_host()</span></span></span><br><span class="line">&#123;</span><br><span class="line">	display_alert &quot;Preparing&quot; &quot;host&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">The &#x27;</span>offline<span class="string">&#x27; variable must always be set to &#x27;</span><span class="literal">true</span><span class="string">&#x27; or &#x27;</span><span class="literal">false</span><span class="string">&#x27;</span></span></span><br><span class="line">	if [ &quot;$OFFLINE_WORK&quot; == &quot;yes&quot; ]; then</span><br><span class="line">		local offline=true</span><br><span class="line">	else</span><br><span class="line">		local offline=false</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">wait until package manager finishes possible system maintanace</span></span></span><br><span class="line">	wait_for_package_manager</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">fix for Locales settings</span></span></span><br><span class="line">	if ! grep -q &quot;^en_US.UT</span><br><span class="line">	-8 UTF-8&quot; /etc/locale.gen; then</span><br><span class="line">		sudo sed -i &#x27;s/# en_US.UTF-8/en_US.UTF-8/&#x27; /etc/locale.gen</span><br><span class="line">		sudo locale-gen</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	export LC_ALL=&quot;en_US.UTF-8&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">packages list for host</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">NOTE: please sync any changes here with the Dockerfile and Vagrantfile</span></span></span><br><span class="line"></span><br><span class="line">	local hostdeps=&quot;acl aptly aria2 bc binfmt-support bison btrfs-progs       \</span><br><span class="line">	build-essential  ca-certificates ccache cpio cryptsetup curl              \</span><br><span class="line">	debian-archive-keyring debian-keyring debootstrap device-tree-compiler    \</span><br><span class="line">	dialog dirmngr dosfstools dwarves f2fs-tools fakeroot flex gawk           \</span><br><span class="line">	gcc-arm-linux-gnueabihf gdisk gpg imagemagick jq kmod libbison-dev \</span><br><span class="line">	libc6-dev-armhf-cross libelf-dev libfdt-dev libfile-fcntllock-perl        \</span><br><span class="line">	libfl-dev liblz4-tool libncurses-dev libpython2.7-dev libssl-dev          \</span><br><span class="line">	libusb-1.0-0-dev linux-base locales lzop ncurses-base ncurses-term        \</span><br><span class="line">	nfs-kernel-server ntpdate p7zip-full parted patchutils pigz pixz          \</span><br><span class="line">	pkg-config pv python3-dev python3-distutils qemu-user-static rsync swig   \</span><br><span class="line">	systemd-container u-boot-tools udev unzip uuid-dev wget whiptail zip      \</span><br><span class="line">	zlib1g-dev&quot;</span><br><span class="line"></span><br><span class="line">  if [[ $(dpkg --print-architecture) == amd64 ]]; then</span><br><span class="line"></span><br><span class="line">	hostdeps+=&quot; distcc lib32ncurses-dev lib32stdc++6 libc6-i386&quot;</span><br><span class="line">	grep -q i386 &lt;(dpkg --print-foreign-architectures) || dpkg --add-architecture i386</span><br><span class="line"></span><br><span class="line">  elif [[ $(dpkg --print-architecture) == arm64 ]]; then</span><br><span class="line"></span><br><span class="line">	hostdeps+=&quot; gcc-arm-linux-gnueabi gcc-arm-none-eabi libc6 libc6-amd64-cross qemu&quot;</span><br><span class="line"></span><br><span class="line">  else</span><br><span class="line"></span><br><span class="line">	display_alert &quot;Please read documentation to set up proper compilation environment&quot;</span><br><span class="line">	display_alert &quot;https://www.armbian.com/using-armbian-tools/&quot;</span><br><span class="line">	exit_with_error &quot;Running this tool on non x86_64 build host is not supported&quot;</span><br><span class="line"></span><br><span class="line">  fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Add support for Ubuntu 20.04, 21.04 and Mint 20.x</span></span></span><br><span class="line">	if [[ $HOSTRELEASE =~ ^(focal|hirsute|jammy|ulyana|ulyssa|bullseye|bookworm|uma)$ ]]; then</span><br><span class="line">		hostdeps+=&quot; python2 python3&quot;</span><br><span class="line">		ln -fs /usr/bin/python2.7 /usr/bin/python2</span><br><span class="line">		ln -fs /usr/bin/python2.7 /usr/bin/python</span><br><span class="line">	else</span><br><span class="line">		hostdeps+=&quot; python libpython-dev&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	display_alert &quot;Build host OS release&quot; &quot;$&#123;HOSTRELEASE:-(unknown)&#125;&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Ubuntu 21.04.x (Hirsute) x86_64 is the only fully supported host OS release</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Using Docker/VirtualBox/Vagrant is the only supported way to run the build script on other Linux distributions</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">	# NO_HOST_RELEASE_CHECK overrides the check for a supported host system</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Disable host OS check at your own risk. Any issues reported with unsupported releases will be closed without discussion</span></span></span><br><span class="line">	if [[ -z $HOSTRELEASE || &quot;focal jammy&quot; != *&quot;$HOSTRELEASE&quot;* ]]; then</span><br><span class="line">		if [[ $NO_HOST_RELEASE_CHECK == yes ]]; then</span><br><span class="line">			display_alert &quot;You are running on an unsupported system&quot; &quot;$&#123;HOSTRELEASE:-(unknown)&#125;&quot; &quot;wrn&quot;</span><br><span class="line">			display_alert &quot;Do not report any errors, warnings or other issues encountered beyond this point&quot; &quot;&quot; &quot;wrn&quot;</span><br><span class="line">		else</span><br><span class="line">			exit_with_error &quot;It seems you ignore documentation and run an unsupported build system: $&#123;HOSTRELEASE:-(unknown)&#125;&quot;</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if grep -qE &quot;(Microsoft|WSL)&quot; /proc/version; then</span><br><span class="line">		if [ -f /.dockerenv ]; then</span><br><span class="line">			display_alert &quot;Building images using Docker on WSL2 may fail&quot; &quot;&quot; &quot;wrn&quot;</span><br><span class="line">		else</span><br><span class="line">			exit_with_error &quot;Windows subsystem for Linux is not a supported build environment&quot;</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if systemd-detect-virt -q -c; then</span><br><span class="line">		display_alert &quot;Running in container&quot; &quot;$(systemd-detect-virt)&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">disable apt-cacher unless NO_APT_CACHER=no is not specified explicitly</span></span></span><br><span class="line">		if [[ $NO_APT_CACHER != no ]]; then</span><br><span class="line">			display_alert &quot;apt-cacher is disabled in containers, set NO_APT_CACHER=no to override&quot; &quot;&quot; &quot;wrn&quot;</span><br><span class="line">			NO_APT_CACHER=yes</span><br><span class="line">		fi</span><br><span class="line">		CONTAINER_COMPAT=yes</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">trying to use nested containers is not a good idea, so don&#x27;</span>t permit EXTERNAL_NEW=compile</span></span><br><span class="line">		if [[ $EXTERNAL_NEW == compile ]]; then</span><br><span class="line">			display_alert &quot;EXTERNAL_NEW=compile is not available when running in container, setting to prebuilt&quot; &quot;&quot; &quot;wrn&quot;</span><br><span class="line">			EXTERNAL_NEW=prebuilt</span><br><span class="line">		fi</span><br><span class="line">		SYNC_CLOCK=no</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Skip verification <span class="keyword">if</span> you are working offline</span></span><br><span class="line">	if ! $offline; then</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">warning: apt-cacher-ng will fail <span class="keyword">if</span> installed and used both on host and <span class="keyword">in</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">container/chroot environment with shared network</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="built_in">set</span> NO_APT_CACHER=<span class="built_in">yes</span> to prevent installation errors <span class="keyword">in</span> such <span class="keyword">case</span></span></span><br><span class="line">	if [[ $NO_APT_CACHER != yes ]]; then hostdeps+=&quot; apt-cacher-ng&quot;; fi</span><br><span class="line"></span><br><span class="line">	export EXTRA_BUILD_DEPS=&quot;&quot;</span><br><span class="line">	call_extension_method &quot;add_host_dependencies&quot; &lt;&lt;- &#x27;ADD_HOST_DEPENDENCIES&#x27;</span><br><span class="line">	*run before installing host dependencies*</span><br><span class="line">	you can add packages to install, space separated, to $&#123;EXTRA_BUILD_DEPS&#125; here.</span><br><span class="line">	ADD_HOST_DEPENDENCIES</span><br><span class="line"></span><br><span class="line">	if [ -n &quot;$&#123;EXTRA_BUILD_DEPS&#125;&quot; ]; then hostdeps+=&quot; $&#123;EXTRA_BUILD_DEPS&#125;&quot;; fi</span><br><span class="line"></span><br><span class="line">	display_alert &quot;Installing build dependencies&quot;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">don<span class="string">&#x27;t prompt for apt cacher selection</span></span></span><br><span class="line">	sudo echo &quot;apt-cacher-ng    apt-cacher-ng/tunnelenable      boolean false&quot; | sudo debconf-set-selections</span><br><span class="line"></span><br><span class="line">	LOG_OUTPUT_FILE=&quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/hostdeps.log</span><br><span class="line">	install_pkg_deb &quot;autoupdate $hostdeps&quot;</span><br><span class="line">	unset LOG_OUTPUT_FILE</span><br><span class="line"></span><br><span class="line">	update-ccache-symlinks</span><br><span class="line"></span><br><span class="line">	export FINAL_HOST_DEPS=&quot;$hostdeps $&#123;EXTRA_BUILD_DEPS&#125;&quot;</span><br><span class="line">	call_extension_method &quot;host_dependencies_ready&quot; &lt;&lt;- &#x27;HOST_DEPENDENCIES_READY&#x27;</span><br><span class="line">	*run after all host dependencies are installed*</span><br><span class="line">	At this point we can read `$&#123;FINAL_HOST_DEPS&#125;`, but changing won&#x27;t have any effect.</span><br><span class="line">	All the dependencies, including the default/core deps and the ones added via `$&#123;EXTRA_BUILD_DEPS&#125;`</span><br><span class="line">	are installed at this point. The system clock has not yet been synced.</span><br><span class="line">	HOST_DEPENDENCIES_READY</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">sync clock</span></span></span><br><span class="line">	if [[ $SYNC_CLOCK != no ]]; then</span><br><span class="line">		display_alert &quot;Syncing clock&quot; &quot;$&#123;NTP_SERVER:-pool.ntp.org&#125;&quot; &quot;info&quot;</span><br><span class="line">		ntpdate -s &quot;$&#123;NTP_SERVER:-pool.ntp.org&#125;&quot;</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">create directory structure</span></span></span><br><span class="line">	mkdir -p $SRC/output $EXTER/cache $USERPATCHES_PATH</span><br><span class="line">	if [[ -n $SUDO_USER ]]; then</span><br><span class="line">		chgrp --quiet sudo cache output &quot;$&#123;USERPATCHES_PATH&#125;&quot;</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">SGID bit on cache/sources breaks kernel dpkg packaging</span></span></span><br><span class="line">		chmod --quiet g+w,g+s output &quot;$&#123;USERPATCHES_PATH&#125;&quot;</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">fix existing permissions</span></span></span><br><span class="line">		find &quot;$&#123;SRC&#125;&quot;/output &quot;$&#123;USERPATCHES_PATH&#125;&quot; -type d ! -group sudo -exec chgrp --quiet sudo &#123;&#125; \;</span><br><span class="line">		find &quot;$&#123;SRC&#125;&quot;/output &quot;$&#123;USERPATCHES_PATH&#125;&quot; -type d ! -perm -g+w,g+s -exec chmod --quiet g+w,g+s &#123;&#125; \;</span><br><span class="line">	fi</span><br><span class="line">	mkdir -p $DEST/debs/&#123;extra,u-boot&#125;  $DEST/&#123;config,debug,patch,images&#125; $USERPATCHES_PATH/overlay $EXTER/cache/&#123;debs,sources,hash&#125; $SRC/toolchains  $SRC/.tmp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">build aarch64</span></span></span><br><span class="line">	if [[ $(dpkg --print-architecture) == amd64 ]]; then</span><br><span class="line">		if [[ &quot;$&#123;SKIP_EXTERNAL_TOOLCHAINS&#125;&quot; != &quot;yes&quot; ]]; then</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">bind mount toolchain if defined</span></span></span><br><span class="line">			if [[ -d &quot;$&#123;ARMBIAN_CACHE_TOOLCHAIN_PATH&#125;&quot; ]]; then</span><br><span class="line">				mountpoint -q &quot;$&#123;SRC&#125;&quot;/cache/toolchain &amp;&amp; umount -l &quot;$&#123;SRC&#125;&quot;/cache/toolchain</span><br><span class="line">				mount --bind &quot;$&#123;ARMBIAN_CACHE_TOOLCHAIN_PATH&#125;&quot; &quot;$&#123;SRC&#125;&quot;/cache/toolchain</span><br><span class="line">			fi</span><br><span class="line"></span><br><span class="line">			display_alert &quot;Checking for external GCC compilers&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">download external Linaro compiler and missing special dependencies since they are needed for certain sources</span></span></span><br><span class="line"></span><br><span class="line">		local toolchains=(</span><br><span class="line">			&quot;gcc-linaro-aarch64-none-elf-4.8-2013.11_linux.tar.xz&quot;</span><br><span class="line">			&quot;gcc-linaro-arm-none-eabi-4.8-2014.04_linux.tar.xz&quot;</span><br><span class="line">			&quot;gcc-linaro-arm-linux-gnueabihf-4.8-2014.04_linux.tar.xz&quot;</span><br><span class="line">			&quot;gcc-linaro-4.9.4-2017.01-x86_64_arm-linux-gnueabi.tar.xz&quot;</span><br><span class="line">			&quot;gcc-linaro-4.9.4-2017.01-x86_64_aarch64-linux-gnu.tar.xz&quot;</span><br><span class="line">			&quot;gcc-linaro-5.5.0-2017.10-x86_64_arm-linux-gnueabihf.tar.xz&quot;</span><br><span class="line">			&quot;gcc-linaro-7.4.1-2019.02-x86_64_arm-linux-gnueabi.tar.xz&quot;</span><br><span class="line">			&quot;gcc-linaro-7.4.1-2019.02-x86_64_aarch64-linux-gnu.tar.xz&quot;</span><br><span class="line">			&quot;gcc-arm-9.2-2019.12-x86_64-arm-none-linux-gnueabihf.tar.xz&quot;</span><br><span class="line">			&quot;gcc-arm-9.2-2019.12-x86_64-aarch64-none-linux-gnu.tar.xz&quot;</span><br><span class="line">			&quot;gcc-arm-11.2-2022.02-x86_64-arm-none-linux-gnueabihf.tar.xz&quot;</span><br><span class="line">			&quot;gcc-arm-11.2-2022.02-x86_64-aarch64-none-linux-gnu.tar.xz&quot;</span><br><span class="line">			)</span><br><span class="line"></span><br><span class="line">		USE_TORRENT_STATUS=$&#123;USE_TORRENT&#125;</span><br><span class="line">		USE_TORRENT=&quot;no&quot;</span><br><span class="line">		for toolchain in $&#123;toolchains[@]&#125;; do</span><br><span class="line">			download_and_verify &quot;_toolchain&quot; &quot;$&#123;toolchain##*/&#125;&quot;</span><br><span class="line">		done</span><br><span class="line">		USE_TORRENT=$&#123;USE_TORRENT_STATUS&#125;</span><br><span class="line"></span><br><span class="line">		rm -rf $SRC/toolchains/*.tar.xz*</span><br><span class="line">		local existing_dirs=( $(ls -1 $SRC/toolchains) )</span><br><span class="line">		for dir in $&#123;existing_dirs[@]&#125;; do</span><br><span class="line">			local found=no</span><br><span class="line">			for toolchain in $&#123;toolchains[@]&#125;; do</span><br><span class="line">				local filename=$&#123;toolchain##*/&#125;</span><br><span class="line">				local dirname=$&#123;filename//.tar.xz&#125;</span><br><span class="line">				[[ $dir == $dirname ]] &amp;&amp; found=yes</span><br><span class="line">			done</span><br><span class="line">			if [[ $found == no ]]; then</span><br><span class="line">				display_alert &quot;Removing obsolete toolchain&quot; &quot;$dir&quot;</span><br><span class="line">				rm -rf $SRC/toolchains/$dir</span><br><span class="line">			fi</span><br><span class="line">		done</span><br><span class="line">			else</span><br><span class="line">				display_alert &quot;Ignoring toolchains&quot; &quot;SKIP_EXTERNAL_TOOLCHAINS: $&#123;SKIP_EXTERNAL_TOOLCHAINS&#125;&quot; &quot;info&quot;</span><br><span class="line">			fi</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">	fi # check offline</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">enable arm binary format so that the cross-architecture chroot environment will work</span></span></span><br><span class="line">	if [[ $BUILD_OPT == &quot;image&quot; || $BUILD_OPT == &quot;rootfs&quot; ]]; then</span><br><span class="line">		modprobe -q binfmt_misc</span><br><span class="line">		mountpoint -q /proc/sys/fs/binfmt_misc/ || mount binfmt_misc -t binfmt_misc /proc/sys/fs/binfmt_misc</span><br><span class="line">		if [[ &quot;$(arch)&quot; != &quot;aarch64&quot; ]]; then</span><br><span class="line">			test -e /proc/sys/fs/binfmt_misc/qemu-arm || update-binfmts --enable qemu-arm</span><br><span class="line">			test -e /proc/sys/fs/binfmt_misc/qemu-aarch64 || update-binfmts --enable qemu-aarch64</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	[[ ! -f &quot;$&#123;USERPATCHES_PATH&#125;&quot;/customize-image.sh ]] &amp;&amp; cp &quot;$&#123;EXTER&#125;&quot;/config/templates/customize-image.sh.template &quot;$&#123;USERPATCHES_PATH&#125;&quot;/customize-image.sh</span><br><span class="line"></span><br><span class="line">	if [[ ! -f &quot;$&#123;USERPATCHES_PATH&#125;&quot;/README ]]; then</span><br><span class="line">		rm -f &quot;$&#123;USERPATCHES_PATH&#125;&quot;/readme.txt</span><br><span class="line">		echo &#x27;Please read documentation about customizing build configuration&#x27; &gt; &quot;$&#123;USERPATCHES_PATH&#125;&quot;/README</span><br><span class="line">		echo &#x27;https:/www.orangepi.org&#x27; &gt;&gt; &quot;$&#123;USERPATCHES_PATH&#125;&quot;/README</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">create patches directory structure under USERPATCHES_PATH</span></span></span><br><span class="line">		find $EXTER/patch -maxdepth 2 -type d ! -name . | sed &quot;s%/.*patch%/$USERPATCHES_PATH%&quot; | xargs mkdir -p</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">check free space (basic)</span></span></span><br><span class="line">	local freespace=$(findmnt --target &quot;$&#123;SRC&#125;&quot; -n -o AVAIL -b 2&gt;/dev/null) # in bytes</span><br><span class="line">	if [[ -n $freespace &amp;&amp; $(( $freespace / 1073741824 )) -lt 10 ]]; then</span><br><span class="line">		display_alert &quot;Low free space left&quot; &quot;$(( $freespace / 1073741824 )) GiB&quot; &quot;wrn&quot;</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">pause here since dialog-based menu will hide this message otherwise</span></span></span><br><span class="line">		echo -e &quot;Press \e[0;33m&lt;Ctrl-C&gt;\x1B[0m to abort compilation, \e[0;33m&lt;Enter&gt;\x1B[0m to ignore and continue&quot;</span><br><span class="line">		read</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function webseed ()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">list of mirrors that host our files</span></span></span><br><span class="line">	unset text</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Hardcoded to EU mirrors since</span></span></span><br><span class="line">	local CCODE=$(curl -s redirect.armbian.com/geoip | jq &#x27;.continent.code&#x27; -r)</span><br><span class="line">	WEBSEED=($(curl -s https://redirect.armbian.com/mirrors | jq -r &#x27;.&#x27;$&#123;CCODE&#125;&#x27; | .[] | values&#x27;))</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">aria2 simply split chunks based on sources count not depending on download speed</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">when selecting china mirrors, use only China mirror, others are very slow there</span></span></span><br><span class="line">	if [[ $DOWNLOAD_MIRROR == china ]]; then</span><br><span class="line">		WEBSEED=(</span><br><span class="line">		https://mirrors.tuna.tsinghua.edu.cn/armbian-releases/</span><br><span class="line">		)</span><br><span class="line">	elif [[ $DOWNLOAD_MIRROR == bfsu ]]; then</span><br><span class="line">		WEBSEED=(</span><br><span class="line">		https://mirrors.bfsu.edu.cn/armbian-releases/</span><br><span class="line">		)</span><br><span class="line">	fi</span><br><span class="line">	for toolchain in $&#123;WEBSEED[@]&#125;; do</span><br><span class="line">		text=&quot;$&#123;text&#125; $&#123;toolchain&#125;$&#123;1&#125;&quot;</span><br><span class="line">	done</span><br><span class="line">	text=&quot;$&#123;text:1&#125;&quot;</span><br><span class="line">	echo &quot;$&#123;text&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">download_and_verify()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	local remotedir=$1</span><br><span class="line">	local filename=$2</span><br><span class="line">	local localdir=$SRC/toolchains</span><br><span class="line">	local dirname=$&#123;filename//.tar.xz&#125;</span><br><span class="line"></span><br><span class="line">        if [[ $DOWNLOAD_MIRROR == china ]]; then</span><br><span class="line">			local server=&quot;https://mirrors.tuna.tsinghua.edu.cn/armbian-releases/&quot;</span><br><span class="line">		elif [[ $DOWNLOAD_MIRROR == bfsu ]]; then</span><br><span class="line">			local server=&quot;https://mirrors.bfsu.edu.cn/armbian-releases/&quot;</span><br><span class="line">		else</span><br><span class="line">			local server=$&#123;ARMBIAN_MIRROR&#125;</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">	if [[ -f $&#123;localdir&#125;/$&#123;dirname&#125;/.download-complete ]]; then</span><br><span class="line">		return</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">switch to china mirror if US timeouts</span></span></span><br><span class="line">	timeout 10 curl --head --fail --silent $&#123;server&#125;$&#123;remotedir&#125;/$&#123;filename&#125; 2&gt;&amp;1 &gt;/dev/null</span><br><span class="line">	if [[ $? -ne 7 &amp;&amp; $? -ne 22 &amp;&amp; $? -ne 0 ]]; then</span><br><span class="line">		display_alert &quot;Timeout from $server&quot; &quot;retrying&quot; &quot;info&quot;</span><br><span class="line">		server=&quot;https://mirrors.tuna.tsinghua.edu.cn/armbian-releases/&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">switch to another china mirror if tuna timeouts</span></span></span><br><span class="line">		timeout 10 curl --head --fail --silent $&#123;server&#125;$&#123;remotedir&#125;/$&#123;filename&#125; 2&gt;&amp;1 &gt;/dev/null</span><br><span class="line">		if [[ $? -ne 7 &amp;&amp; $? -ne 22 &amp;&amp; $? -ne 0 ]]; then</span><br><span class="line">			display_alert &quot;Timeout from $server&quot; &quot;retrying&quot; &quot;info&quot;</span><br><span class="line">			server=&quot;https://mirrors.bfsu.edu.cn/armbian-releases/&quot;</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">check if file exists on remote server before running aria2 downloader</span></span></span><br><span class="line">	[[ ! `timeout 10 curl --head --fail --silent $&#123;server&#125;$&#123;remotedir&#125;/$&#123;filename&#125;` ]] &amp;&amp; return</span><br><span class="line"></span><br><span class="line">	cd &quot;$&#123;localdir&#125;&quot; || exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">use local control file</span></span></span><br><span class="line">	if [[ -f &quot;$&#123;EXTER&#125;&quot;/config/torrents/$&#123;filename&#125;.asc ]]; then</span><br><span class="line">		local torrent=&quot;$&#123;EXTER&#125;&quot;/config/torrents/$&#123;filename&#125;.torrent</span><br><span class="line">		ln -sf &quot;$&#123;EXTER&#125;/config/torrents/$&#123;filename&#125;.asc&quot; &quot;$&#123;localdir&#125;/$&#123;filename&#125;.asc&quot;</span><br><span class="line">	elif [[ ! `timeout 10 curl --head --fail --silent &quot;$&#123;server&#125;$&#123;remotedir&#125;/$&#123;filename&#125;.asc&quot;` ]]; then</span><br><span class="line">		return</span><br><span class="line">	else</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">download control file</span></span></span><br><span class="line">		local torrent=$&#123;server&#125;$remotedir/$&#123;filename&#125;.torrent</span><br><span class="line">		aria2c --download-result=hide --disable-ipv6=true --summary-interval=0 --console-log-level=error --auto-file-renaming=false \</span><br><span class="line">		--continue=false --allow-overwrite=true --dir=&quot;$&#123;localdir&#125;&quot; $&#123;server&#125;$&#123;remotedir&#125;/$&#123;filename&#125;.asc $(webseed &quot;$remotedir/$&#123;filename&#125;.asc&quot;) -o &quot;$&#123;filename&#125;.asc&quot;</span><br><span class="line">		[[ $? -ne 0 ]] &amp;&amp; display_alert &quot;Failed to download control file&quot; &quot;&quot; &quot;wrn&quot;</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">download torrent first</span></span></span><br><span class="line">	if [[ $&#123;USE_TORRENT&#125; == &quot;yes&quot; ]]; then</span><br><span class="line"></span><br><span class="line">		display_alert &quot;downloading using torrent network&quot; &quot;$filename&quot;</span><br><span class="line">		local ariatorrent=&quot;--summary-interval=0 --auto-save-interval=0 --seed-time=0 --bt-stop-timeout=120 --console-log-level=error \</span><br><span class="line">		--allow-overwrite=true --download-result=hide --rpc-save-upload-metadata=false --auto-file-renaming=false \</span><br><span class="line">		--file-allocation=trunc --continue=true $&#123;torrent&#125; \</span><br><span class="line">		--dht-file-path=$EXTER/cache/.aria2/dht.dat --disable-ipv6=true --stderr --follow-torrent=mem --dir=$&#123;localdir&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">exception. It throws error if dht.dat file does not exists. Error suppress needed only at first download.</span></span></span><br><span class="line">		if [[ -f $EXTER/cache/.aria2/dht.dat ]]; then</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">shellcheck disable=SC2086</span></span></span><br><span class="line">			aria2c $&#123;ariatorrent&#125;</span><br><span class="line">		else</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">shellcheck disable=SC2035</span></span></span><br><span class="line">			aria2c $&#123;ariatorrent&#125; &amp;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/torrent.log</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">mark complete</span></span></span><br><span class="line">		[[ $? -eq 0 ]] &amp;&amp; touch &quot;$&#123;localdir&#125;/$&#123;filename&#125;.complete&quot;</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">direct download if torrent fails</span></span></span><br><span class="line">	if [[ ! -f &quot;$&#123;localdir&#125;/$&#123;filename&#125;.complete&quot; ]]; then</span><br><span class="line">		if [[ ! `timeout 10 curl --head --fail --silent $&#123;server&#125;$&#123;remotedir&#125;/$&#123;filename&#125; 2&gt;&amp;1 &gt;/dev/null` ]]; then</span><br><span class="line">			display_alert &quot;downloading using http(s) network&quot; &quot;$filename&quot;</span><br><span class="line">			aria2c --download-result=hide --rpc-save-upload-metadata=false --console-log-level=error \</span><br><span class="line">			--dht-file-path=&quot;$&#123;SRC&#125;&quot;/cache/.aria2/dht.dat --disable-ipv6=true --summary-interval=0 --auto-file-renaming=false --dir=&quot;$&#123;localdir&#125;&quot; $&#123;server&#125;$&#123;remotedir&#125;/$&#123;filename&#125; $(webseed &quot;$&#123;remotedir&#125;/$&#123;filename&#125;&quot;) -o &quot;$&#123;filename&#125;&quot;</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">mark complete</span></span></span><br><span class="line">			[[ $? -eq 0 ]] &amp;&amp; touch &quot;$&#123;localdir&#125;/$&#123;filename&#125;.complete&quot; &amp;&amp; echo &quot;&quot;</span><br><span class="line"></span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ -f $&#123;localdir&#125;/$&#123;filename&#125;.asc ]]; then</span><br><span class="line"></span><br><span class="line">		if grep -q &#x27;BEGIN PGP SIGNATURE&#x27; &quot;$&#123;localdir&#125;/$&#123;filename&#125;.asc&quot;; then</span><br><span class="line"></span><br><span class="line">			if [[ ! -d $EXTER/cache/.gpg ]]; then</span><br><span class="line">				mkdir -p $EXTER/cache/.gpg</span><br><span class="line">				chmod 700 $EXTER/cache/.gpg</span><br><span class="line">				touch $EXTER/cache/.gpg/gpg.conf</span><br><span class="line">				chmod 600 $EXTER/cache/.gpg/gpg.conf</span><br><span class="line">			fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">Verify archives with Linaro and Armbian GPG keys</span></span></span><br><span class="line"></span><br><span class="line">			if [ x&quot;&quot; != x&quot;$&#123;http_proxy&#125;&quot; ]; then</span><br><span class="line">				(gpg --homedir &quot;$&#123;EXTER&#125;&quot;/cache/.gpg --no-permission-warning --list-keys 8F427EAF &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/output.log 2&gt;&amp;1\</span><br><span class="line">				 || gpg --homedir &quot;$&#123;EXTER&#125;&quot;/cache/.gpg --no-permission-warning \</span><br><span class="line">				--keyserver hkp://keyserver.ubuntu.com:80 --keyserver-options http-proxy=&quot;$&#123;http_proxy&#125;&quot; \</span><br><span class="line">				--recv-keys 8F427EAF &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/output.log 2&gt;&amp;1)</span><br><span class="line"></span><br><span class="line">				(gpg --homedir &quot;$&#123;EXTER&#125;&quot;/cache/.gpg --no-permission-warning --list-keys 9F0E78D5 &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/output.log 2&gt;&amp;1\</span><br><span class="line">				|| gpg --homedir &quot;$&#123;EXTER&#125;&quot;/cache/.gpg --no-permission-warning \</span><br><span class="line">				--keyserver hkp://keyserver.ubuntu.com:80 --keyserver-options http-proxy=&quot;$&#123;http_proxy&#125;&quot; \</span><br><span class="line">				--recv-keys 9F0E78D5 &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/output.log 2&gt;&amp;1)</span><br><span class="line">			else</span><br><span class="line">				(gpg --homedir &quot;$&#123;EXTER&#125;&quot;/cache/.gpg --no-permission-warning --list-keys 8F427EAF &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/output.log 2&gt;&amp;1\</span><br><span class="line">				 || gpg --homedir &quot;$&#123;EXTER&#125;&quot;/cache/.gpg --no-permission-warning \</span><br><span class="line">				--keyserver hkp://keyserver.ubuntu.com:80 \</span><br><span class="line">				--recv-keys 8F427EAF &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/output.log 2&gt;&amp;1)</span><br><span class="line"></span><br><span class="line">				(gpg --homedir &quot;$&#123;EXTER&#125;&quot;/cache/.gpg --no-permission-warning --list-keys 9F0E78D5 &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/output.log 2&gt;&amp;1\</span><br><span class="line">				|| gpg --homedir &quot;$&#123;EXTER&#125;&quot;/cache/.gpg --no-permission-warning \</span><br><span class="line">				--keyserver hkp://keyserver.ubuntu.com:80 \</span><br><span class="line">				--recv-keys 9F0E78D5 &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/output.log 2&gt;&amp;1)</span><br><span class="line">			fi</span><br><span class="line"></span><br><span class="line">			gpg --homedir &quot;$&#123;EXTER&#125;&quot;/cache/.gpg --no-permission-warning --verify \</span><br><span class="line">			--trust-model always -q &quot;$&#123;localdir&#125;/$&#123;filename&#125;.asc&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/output.log 2&gt;&amp;1</span><br><span class="line">			[[ $&#123;PIPESTATUS[0]&#125; -eq 0 ]] &amp;&amp; verified=true &amp;&amp; display_alert &quot;Verified&quot; &quot;PGP&quot; &quot;info&quot;</span><br><span class="line"></span><br><span class="line">		else</span><br><span class="line"></span><br><span class="line">			md5sum -c --status &quot;$&#123;localdir&#125;/$&#123;filename&#125;.asc&quot; &amp;&amp; verified=true &amp;&amp; display_alert &quot;Verified&quot; &quot;MD5&quot; &quot;info&quot;</span><br><span class="line"></span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		if [[ $verified == true ]]; then</span><br><span class="line">			if [[ &quot;$&#123;filename:(-6)&#125;&quot; == &quot;tar.xz&quot; ]]; then</span><br><span class="line"></span><br><span class="line">				display_alert &quot;decompressing&quot;</span><br><span class="line">				pv -p -b -r -c -N &quot;[ .... ] $&#123;filename&#125;&quot; &quot;$&#123;filename&#125;&quot; | xz -dc | tar xp --xattrs --no-same-owner --overwrite</span><br><span class="line">				[[ $? -eq 0 ]] &amp;&amp; touch &quot;$&#123;localdir&#125;/$&#123;dirname&#125;/.download-complete&quot;</span><br><span class="line">			fi</span><br><span class="line">		else</span><br><span class="line">			exit_with_error &quot;verification failed&quot;</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">show_developer_warning()</span><br><span class="line">&#123;</span><br><span class="line">	local temp_rc</span><br><span class="line">	temp_rc=$(mktemp)</span><br><span class="line">	cat &lt;&lt;-&#x27;EOF&#x27; &gt; &quot;$&#123;temp_rc&#125;&quot;</span><br><span class="line">	screen_color = (WHITE,RED,ON)</span><br><span class="line">	EOF</span><br><span class="line">	local warn_text=&quot;You are switching to the \Z1EXPERT MODE\Zn</span><br><span class="line"></span><br><span class="line">	This allows building experimental configurations that are provided</span><br><span class="line">	\Z1AS IS\Zn to developers and expert users,</span><br><span class="line">	\Z1WITHOUT ANY RESPONSIBILITIES\Zn from the Armbian team:</span><br><span class="line"></span><br><span class="line">	- You are using these configurations \Z1AT YOUR OWN RISK\Zn</span><br><span class="line">	- Bug reports related to the dev kernel, CSC, WIP and EOS boards</span><br><span class="line">	\Z1will be closed without a discussion\Zn</span><br><span class="line">	- Forum posts related to dev kernel, CSC, WIP and EOS boards</span><br><span class="line">	should be created in the \Z2\&quot;Community forums\&quot;\Zn section</span><br><span class="line">	&quot;</span><br><span class="line">	DIALOGRC=$temp_rc dialog --title &quot;Expert mode warning&quot; --backtitle &quot;$&#123;backtitle&#125;&quot; --colors --defaultno --no-label &quot;I do not agree&quot; \</span><br><span class="line">		--yes-label &quot;I understand and agree&quot; --yesno &quot;$warn_text&quot; &quot;$&#123;TTY_Y&#125;&quot; &quot;$&#123;TTY_X&#125;&quot;</span><br><span class="line">	[[ $? -ne 0 ]] &amp;&amp; exit_with_error &quot;Error switching to the expert mode&quot;</span><br><span class="line">	SHOW_WARNING=no</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">is a formatted output of the values of variables</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">from the list at the place of the function call.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The LOG_OUTPUT_FILE variable must be defined in the calling function</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">before calling the `show_checklist_variables` function and unset after.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">show_checklist_variables ()</span></span></span><br><span class="line">&#123;</span><br><span class="line">	local checklist=$*</span><br><span class="line">	local var pval</span><br><span class="line">	local log_file=$&#123;LOG_OUTPUT_FILE:-&quot;$&#123;SRC&#125;&quot;/output/$&#123;LOG_SUBPATH&#125;/trash.log&#125;</span><br><span class="line">	local _line=$&#123;BASH_LINENO[0]&#125;</span><br><span class="line">	local _function=$&#123;FUNCNAME[1]&#125;</span><br><span class="line">	local _file=$(basename &quot;$&#123;BASH_SOURCE[1]&#125;&quot;)</span><br><span class="line"></span><br><span class="line">	echo -e &quot;Show variables in function: $_function&quot; &quot;[$_file:$_line]\n&quot; &gt;&gt;$log_file</span><br><span class="line"></span><br><span class="line">	for var in $checklist;do</span><br><span class="line">		eval pval=\$$var</span><br><span class="line">		echo -e &quot;\n$var =:&quot; &gt;&gt;$log_file</span><br><span class="line">		if [ $(echo &quot;$pval&quot; | awk -F&quot;/&quot; &#x27;&#123;print NF&#125;&#x27;) -ge 4 ];then</span><br><span class="line">			printf &quot;%s\n&quot; $pval &gt;&gt;$log_file</span><br><span class="line">		else</span><br><span class="line">			printf &quot;%-30s %-30s %-30s %-30s\n&quot; $pval &gt;&gt;$log_file</span><br><span class="line">		fi</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">install_wiringop()</span><br><span class="line">&#123;</span><br><span class="line">	install_deb_chroot &quot;$EXTER/cache/debs/arm64/wiringpi_2.51.deb&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;apt-mark hold wiringpi&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">	if [[ $&#123;IGNORE_UPDATES&#125; != yes ]]; then</span><br><span class="line"></span><br><span class="line">		fetch_from_repo &quot;https://github.com/orangepi-xunlong/wiringOP.git&quot; &quot;$&#123;EXTER&#125;/cache/sources/wiringOP&quot; &quot;branch:next&quot; &quot;yes&quot;</span><br><span class="line">		fetch_from_repo &quot;https://github.com/orangepi-xunlong/wiringOP-Python.git&quot; &quot;$&#123;EXTER&#125;/cache/sources/wiringOP-Python&quot; &quot;branch:next&quot; &quot;yes&quot;</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	cp $&#123;EXTER&#125;/cache/sources/wiringOP/next $&#123;SDCARD&#125;/usr/src/wiringOP -rfa</span><br><span class="line">	cp $&#123;EXTER&#125;/cache/sources/wiringOP-Python/next $&#123;SDCARD&#125;/usr/src/wiringOP-Python -rfa</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">install_docker() &#123;</span><br><span class="line"></span><br><span class="line">	[[ $install_docker != yes ]] &amp;&amp; return</span><br><span class="line"></span><br><span class="line">	display_alert &quot;Installing&quot; &quot;docker&quot; &quot;info&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;apt-get install -y -qq apt-transport-https ca-certificates curl gnupg2 software-properties-common &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line"></span><br><span class="line">	case $&#123;RELEASE&#125; in</span><br><span class="line">		buster|bullseye|bookworm)</span><br><span class="line">		distributor_id=&quot;debian&quot;</span><br><span class="line">		;;</span><br><span class="line">		xenial|bionic|focal|jammy)</span><br><span class="line">		distributor_id=&quot;ubuntu&quot;</span><br><span class="line">		;;</span><br><span class="line">	esac</span><br><span class="line"></span><br><span class="line">	if [[ $&#123;SELECTED_CONFIGURATION&#125; == desktop ]]; then</span><br><span class="line">		mirror_url=https://repo.huaweicloud.com</span><br><span class="line">	else</span><br><span class="line">		mirror_url=https://mirrors.aliyun.com</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;curl -fsSL $&#123;mirror_url&#125;/docker-ce/linux/$&#123;distributor_id&#125;/gpg | apt-key add -&quot;</span><br><span class="line">	echo &quot;deb [arch=$&#123;ARCH&#125;] $&#123;mirror_url&#125;/docker-ce/linux/$&#123;distributor_id&#125; $&#123;RELEASE&#125; stable&quot; &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/apt/sources.list.d/docker.list</span><br><span class="line"></span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;apt-get update&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;apt-get install -y -qq docker-ce docker-ce-cli containerd.io&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;sudo groupadd docker&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;sudo usermod -aG docker $&#123;OPI_USERNAME&#125;&quot;</span><br><span class="line"></span><br><span class="line">	run_on_sdcard &quot;systemctl --no-reload disable docker.service&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="3-main-shåˆ†æ"><a href="#3-main-shåˆ†æ" class="headerlink" title="3.main.shåˆ†æ"></a>3.main.shåˆ†æ</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Copyright (c) 2013-2021 Igor Pecovnik, igor.pecovnik@gma**.com</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This file is licensed under the terms of the GNU General Public</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">License version 2. This program is licensed <span class="string">&quot;as is&quot;</span> without any</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">warranty of any kind, whether express or implied.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Main program</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‡½æ•°ï¼Œæ¸…ç†åˆ—è¡¨ä¸­çš„ç©ºç™½å­—ç¬¦ã€‚</span></span><br><span class="line">cleanup_list() &#123;</span><br><span class="line">	local varname=&quot;$&#123;1&#125;&quot;</span><br><span class="line">	local list_to_clean=&quot;$&#123;!varname&#125;&quot;</span><br><span class="line">	list_to_clean=&quot;$&#123;list_to_clean#&quot;$&#123;list_to_clean%%[![:space:]]*&#125;&quot;&#125;&quot;</span><br><span class="line">	list_to_clean=&quot;$&#123;list_to_clean%&quot;$&#123;list_to_clean##*[![:space:]]&#125;&quot;&#125;&quot;</span><br><span class="line">	echo $&#123;list_to_clean&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸èƒ½æ˜¯ç›´æ¥æ‰§è¡Œmain.sh,è€Œæ˜¯è¦é—´æ¥æ‰§è¡Œ</span></span><br><span class="line">if [[ $(basename &quot;$0&quot;) == main.sh ]]; then</span><br><span class="line"></span><br><span class="line">	echo &quot;Please use build.sh to start the build process&quot;</span><br><span class="line">	exit 255</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">default <span class="built_in">umask</span> <span class="keyword">for</span> root is 022 so parent directories won<span class="string">&#x27;t be group writeable without this</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">this is used instead of making the chmod in prepare_host() recursive</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">é€šè¿‡ä¿®æ”¹æ ¹ç”¨æˆ·çš„ umask å€¼ï¼Œå¯ä»¥ç¡®ä¿åœ¨åˆ›å»ºæ–°çš„çˆ¶ç›®å½•æ—¶ï¼Œç»„æˆå‘˜å…·æœ‰å†™æƒé™ï¼Œè€Œä¸éœ€è¦è¿›è¡Œé€’å½’çš„æƒé™æ›´æ”¹æ“ä½œã€‚</span></span></span><br><span class="line">umask 002</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">destination è®¾ç½®è¾“å‡ºç›®å½•</span></span></span><br><span class="line">if [ -d &quot;$CONFIG_PATH/output&quot; ]; then</span><br><span class="line">	DEST=&quot;$&#123;CONFIG_PATH&#125;&quot;/output</span><br><span class="line">else</span><br><span class="line">	DEST=&quot;$&#123;SRC&#125;&quot;/output</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">è®¾ç½®ç‰ˆæœ¬å·</span></span></span><br><span class="line">[[ -z $REVISION ]] &amp;&amp; REVISION=&quot;3.0.8&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">è®¾ç½®ntpæ—¶é—´</span></span></span><br><span class="line">[[ $DOWNLOAD_MIRROR == &quot;china&quot; ]] &amp;&amp; NTP_SERVER=&quot;cn.pool.ntp.org&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">å¼€å§‹ç»˜åˆ¶èŠ‚ç›®</span></span></span><br><span class="line">if [[ $BUILD_ALL != &quot;yes&quot; ]]; then</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">override stty size</span></span></span><br><span class="line">	[[ -n $COLUMNS ]] &amp;&amp; stty cols $COLUMNS</span><br><span class="line">	[[ -n $LINES ]] &amp;&amp; stty rows $LINES</span><br><span class="line">	TTY_X=$(($(stty size | awk &#x27;&#123;print $2&#125;&#x27;)-6)) 			# determine terminal width</span><br><span class="line">	TTY_Y=$(($(stty size | awk &#x27;&#123;print $1&#125;&#x27;)-6)) 			# determine terminal height</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">We&#x27;</span>ll use this title on all menus</span></span><br><span class="line">backtitle=&quot;Orange Pi building script, http://www.orangepi.org&quot; </span><br><span class="line">titlestr=&quot;Choose an option&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Warnings mitigation</span></span><br><span class="line">[[ -z $LANGUAGE ]] &amp;&amp; export LANGUAGE=&quot;en_US:en&quot;            # set to english if not set</span><br><span class="line">[[ -z $CONSOLE_CHAR ]] &amp;&amp; export CONSOLE_CHAR=&quot;UTF-8&quot;       # set console to UTF-8 if not set</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Libraries include</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shellcheck <span class="built_in">source</span>=debootstrap.sh</span></span><br><span class="line">source &quot;$&#123;SRC&#125;&quot;/scripts/debootstrap.sh	# system specific install ç³»ç»Ÿç‰¹å®šçš„å®‰è£…è„šæœ¬ã€‚</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shellcheck <span class="built_in">source</span>=image-helpers.sh</span></span><br><span class="line">source &quot;$&#123;SRC&#125;&quot;/scripts/image-helpers.sh	# helpers for OS image building  ç”¨äºæ“ä½œç³»ç»Ÿé•œåƒæ„å»ºçš„è¾…åŠ©å‡½æ•°è„šæœ¬</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shellcheck <span class="built_in">source</span>=distributions.sh</span></span><br><span class="line">source &quot;$&#123;SRC&#125;&quot;/scripts/distributions.sh	# system specific install ç³»ç»Ÿç‰¹å®šçš„å®‰è£…è„šæœ¬</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shellcheck <span class="built_in">source</span>=desktop.sh</span></span><br><span class="line">source &quot;$&#123;SRC&#125;&quot;/scripts/desktop.sh		# desktop specific install  æ¡Œé¢ç¯å¢ƒç‰¹å®šçš„å®‰è£…è„šæœ¬</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shellcheck <span class="built_in">source</span>=compilation.sh</span></span><br><span class="line">source &quot;$&#123;SRC&#125;&quot;/scripts/compilation.sh	# patching and compilation of kernel, uboot, ATF è¡¥ä¸å’Œç¼–è¯‘å†…æ ¸ã€ubootã€ATFï¼ˆArm Trusted Firmwareï¼‰çš„è„šæœ¬</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shellcheck <span class="built_in">source</span>=compilation-prepare.sh</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">source</span> <span class="string">&quot;<span class="variable">$&#123;SRC&#125;</span>&quot;</span>/scripts/compilation-prepare.sh	<span class="comment"># drivers that are not upstreamed éä¸Šæ¸¸é©±åŠ¨ç¨‹åºçš„è„šæœ¬ã€‚</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shellcheck <span class="built_in">source</span>=makeboarddeb.sh</span></span><br><span class="line">source &quot;$&#123;SRC&#125;&quot;/scripts/makeboarddeb.sh		# board support package ç”¨äºæ„å»ºæ¿çº§æ”¯æŒè½¯ä»¶åŒ…çš„è„šæœ¬</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shellcheck <span class="built_in">source</span>=general.sh</span></span><br><span class="line">source &quot;$&#123;SRC&#125;&quot;/scripts/general.sh		# general functions  é€šç”¨å‡½æ•°è„šæœ¬</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shellcheck <span class="built_in">source</span>=chroot-buildpackages.sh</span></span><br><span class="line">source &quot;$&#123;SRC&#125;&quot;/scripts/chroot-buildpackages.sh	# chroot packages building  åœ¨ chroot ç¯å¢ƒä¸­æ„å»ºè½¯ä»¶åŒ…çš„è„šæœ¬</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shellcheck <span class="built_in">source</span>=pack.sh</span></span><br><span class="line">source &quot;$&#123;SRC&#125;&quot;/scripts/pack-uboot.sh  æ‰“åŒ… uboot çš„è„šæœ¬</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">set</span> <span class="built_in">log</span> path</span></span><br><span class="line">LOG_SUBPATH=$&#123;LOG_SUBPATH:=debug&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">compress and remove old logs</span></span><br><span class="line">mkdir -p &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;</span><br><span class="line">(cd &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125; &amp;&amp; tar -czf logs-&quot;$(&lt;timestamp)&quot;.tgz ./*.log) &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">rm -f &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/*.log &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">date +&quot;%d_%m_%Y-%H_%M_%S&quot; &gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/timestamp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">delete compressed logs older than 7 days</span></span><br><span class="line">(cd &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125; &amp;&amp; find . -name &#x27;*.tgz&#x27; -mtime +7 -delete) &gt; /dev/null</span><br><span class="line"></span><br><span class="line">if [[ $PROGRESS_DISPLAY == none ]]; then</span><br><span class="line"></span><br><span class="line">	OUTPUT_VERYSILENT=yes</span><br><span class="line"></span><br><span class="line">elif [[ $PROGRESS_DISPLAY == dialog ]]; then</span><br><span class="line"></span><br><span class="line">	OUTPUT_DIALOG=yes</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $PROGRESS_LOG_TO_FILE != yes ]]; then unset PROGRESS_LOG_TO_FILE; fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SHOW_WARNING=yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [[ $USE_CCACHE != no ]]; then</span><br><span class="line"></span><br><span class="line">	CCACHE=ccache</span><br><span class="line">	export PATH=&quot;/usr/lib/ccache:$PATH&quot;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">private ccache directory to avoid permission issues when using build script with <span class="string">&quot;sudo&quot;</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">see https://ccache.samba.org/manual.html<span class="comment">#_sharing_a_cache for alternative solution</span></span></span><br><span class="line">	[[ $PRIVATE_CCACHE == yes ]] &amp;&amp; export CCACHE_DIR=$EXTER/cache/ccache</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line"></span><br><span class="line">	CCACHE=&quot;&quot;</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [[ -n $REPOSITORY_UPDATE ]]; then</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="keyword">select</span> stable/beta configuration</span></span><br><span class="line">		if [[ $BETA == yes ]]; then</span><br><span class="line">				DEB_STORAGE=$DEST/debs-beta</span><br><span class="line">				REPO_STORAGE=$DEST/repository-beta</span><br><span class="line">				REPO_CONFIG=&quot;aptly-beta.conf&quot;</span><br><span class="line">		else</span><br><span class="line">				DEB_STORAGE=$DEST/debs</span><br><span class="line">				REPO_STORAGE=$DEST/repository</span><br><span class="line">				REPO_CONFIG=&quot;aptly.conf&quot;</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">For user override</span></span><br><span class="line">		if [[ -f &quot;$&#123;USERPATCHES_PATH&#125;&quot;/lib.config ]]; then</span><br><span class="line">				display_alert &quot;Using user configuration override&quot; &quot;userpatches/lib.config&quot; &quot;info&quot;</span><br><span class="line">			source &quot;$&#123;USERPATCHES_PATH&#125;&quot;/lib.config</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		repo-manipulate &quot;$REPOSITORY_UPDATE&quot;</span><br><span class="line">		exit</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªé€‰é¡¹æ•°ç»„ optionsï¼Œå¹¶ä¸ºæ¯ä¸ªé€‰é¡¹æ·»åŠ æ ‡ç­¾å’Œæè¿° ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œä¹‹åè¿›å…¥çš„ç¬¬ä¸€ä¸ªç•Œé¢ï¼Œæœ‰4ä¸ªé€‰æ‹©ï¼Œuboot å†…æ ¸ æ–‡ä»¶ç³»ç»Ÿå’Œå®Œæ•´é•œåƒï¼Œæœ€åä¿å­˜åˆ°BUILD_OPT</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">if</span> BUILD_OPT, KERNEL_CONFIGURE, BOARD, BRANCH or RELEASE are not <span class="built_in">set</span>, display selection menu</span></span><br><span class="line">if [[ -z $BUILD_OPT ]]; then</span><br><span class="line"></span><br><span class="line">	options+=(&quot;u-boot&quot;	 &quot;U-boot package&quot;)</span><br><span class="line">	options+=(&quot;kernel&quot;	 &quot;Kernel package&quot;)</span><br><span class="line">	options+=(&quot;rootfs&quot;	 &quot;Rootfs and all deb packages&quot;)</span><br><span class="line">	options+=(&quot;image&quot;	 &quot;Full OS image for flashing&quot;)</span><br><span class="line"></span><br><span class="line">	menustr=&quot;Compile image | rootfs | kernel | u-boot&quot;</span><br><span class="line">	BUILD_OPT=$(whiptail --title &quot;$&#123;titlestr&#125;&quot; --backtitle &quot;$&#123;backtitle&#125;&quot; --notags \</span><br><span class="line">			  --menu &quot;$&#123;menustr&#125;&quot; &quot;$&#123;TTY_Y&#125;&quot; &quot;$&#123;TTY_X&#125;&quot; $((TTY_Y - 8))  \</span><br><span class="line">			  --cancel-button Exit --ok-button Select &quot;$&#123;options[@]&#125;&quot; \</span><br><span class="line">			  3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class="line"></span><br><span class="line">	unset options</span><br><span class="line">	[[ -z $BUILD_OPT ]] &amp;&amp; exit_with_error &quot;No option selected&quot;</span><br><span class="line">	[[ $BUILD_OPT == rootfs ]] &amp;&amp; ROOT_FS_CREATE_ONLY=&quot;yes&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å†…æ ¸çš„é€‰æ‹©ï¼Œä¸¤ä¸ªé€‰æ‹©ï¼Œæœ€åä¿å­˜åˆ°KERNEL_CONFIGURE</span></span><br><span class="line">if [[ $&#123;BUILD_OPT&#125; =~ kernel|image ]]; then</span><br><span class="line"></span><br><span class="line">	if [[ -z $KERNEL_CONFIGURE ]]; then</span><br><span class="line"></span><br><span class="line">		options+=(&quot;no&quot; &quot;Do not change the kernel configuration&quot;)</span><br><span class="line">		options+=(&quot;yes&quot; &quot;Show a kernel configuration menu before compilation&quot;)</span><br><span class="line"></span><br><span class="line">		menustr=&quot;Select the kernel configuration.&quot;</span><br><span class="line">		KERNEL_CONFIGURE=$(whiptail --title &quot;$&#123;titlestr&#125;&quot; --backtitle &quot;$backtitle&quot; --notags \</span><br><span class="line">						 --menu &quot;$&#123;menustr&#125;&quot; $TTY_Y $TTY_X $((TTY_Y - 8)) \</span><br><span class="line">						 --cancel-button Exit --ok-button Select &quot;$&#123;options[@]&#125;&quot; \</span><br><span class="line">						 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class="line"></span><br><span class="line">		unset options</span><br><span class="line">		[[ -z $KERNEL_CONFIGURE ]] &amp;&amp; exit_with_error &quot;No option selected&quot;</span><br><span class="line">	fi</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¿å­çš„é€‰æ‹©ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©orangepi5bï¼Œæœ€åä¿å­˜åˆ°BOARDå˜é‡ä¸­</span></span><br><span class="line">if [[ -z $BOARD ]]; then</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepir1&quot;</span>			<span class="string">&quot;Allwinner H2+ quad core 256MB RAM WiFi SPI 2xETH&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepizero&quot;</span>		<span class="string">&quot;Allwinner H2+ quad core 256MB/512MB RAM WiFi SPI&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepipc&quot;</span>			<span class="string">&quot;Allwinner H3 quad core 1GB RAM&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepipcplus&quot;</span>		<span class="string">&quot;Allwinner H3 quad core 1GB RAM WiFi eMMC&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepione&quot;</span>			<span class="string">&quot;Allwinner H3 quad core 512MB RAM&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepilite&quot;</span>		<span class="string">&quot;Allwinner H3 quad core 512MB RAM WiFi&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepiplus&quot;</span>		<span class="string">&quot;Allwinner H3 quad core 1GB/2GB RAM WiFi GBE eMMC&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepiplus2e&quot;</span>		<span class="string">&quot;Allwinner H3 quad core 2GB RAM WiFi GBE eMMC&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepizeroplus2h3&quot;</span> 	<span class="string">&quot;Allwinner H3 quad core 512MB RAM WiFi/BT eMMC&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepipch5&quot;</span>                <span class="string">&quot;Allwinner H5 quad core 1GB RAM&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepipc2&quot;</span>			<span class="string">&quot;Allwinner H5 quad core 1GB RAM GBE SPI&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepioneh5&quot;</span>               <span class="string">&quot;Allwinner H5 quad core 512MB/1GB RAM&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepiprime&quot;</span>		<span class="string">&quot;Allwinner H5 quad core 2GB RAM GBE WiFi/BT&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepizeroplus&quot;</span>		<span class="string">&quot;Allwinner H5 quad core 512MB RAM GBE WiFi SPI&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepizeroplus2h5&quot;</span>		<span class="string">&quot;Allwinner H5 quad core 512MB RAM WiFi/BT eMMC&quot;</span>)</span></span><br><span class="line">	options+=(&quot;orangepi3&quot;			&quot;Allwinner H6 quad core 1GB/2GB RAM GBE WiFi/BT eMMC USB3&quot;)</span><br><span class="line">	options+=(&quot;orangepi3-lts&quot;		&quot;Allwinner H6 quad core 2GB RAM GBE WiFi/BT-AW859A eMMC USB3&quot;)</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepilite2&quot;</span>		<span class="string">&quot;Allwinner H6 quad core 1GB RAM WiFi/BT USB3&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepioneplus&quot;</span>		<span class="string">&quot;Allwinner H6 quad core 1GB RAM GBE&quot;</span>)</span></span><br><span class="line">	options+=(&quot;orangepizero2&quot;		&quot;Allwinner H616 quad core 512MB/1GB RAM WiFi/BT GBE SPI&quot;)</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepizero2-b&quot;</span>		<span class="string">&quot;Allwinner H616 quad core 512MB/1GB RAM WiFi/BT GBE SPI&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepizero2-lts&quot;</span>           <span class="string">&quot;Allwinner H616 quad core 1.5GB RAM WiFi/BT GBE SPI&quot;</span>)</span></span><br><span class="line">	options+=(&quot;orangepizero3&quot;		&quot;Allwinner H618 quad core 1GB/1.5GB/2GB/4GB RAM WiFi/BT GBE SPI&quot;)</span><br><span class="line">	options+=(&quot;orangepizero2w&quot;		&quot;Allwinner H618 quad core 1GB/1.5GB/2GB/4GB RAM WiFi/BT SPI&quot;)</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepir1b&quot;</span>			<span class="string">&quot;Allwinner H618 quad core 1.5GB/2GB/4GB RAM WiFi/BT GBE SPI&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepi400&quot;</span>			<span class="string">&quot;Allwinner H616 quad core 4GB RAM WiFi/BT GBE eMMC VGA&quot;</span>)</span></span><br><span class="line">	options+=(&quot;orangepi4&quot;                   &quot;Rockchip  RK3399 hexa core 4GB RAM GBE eMMC USB3 USB-C WiFi/BT&quot;)</span><br><span class="line">	options+=(&quot;orangepi4-lts&quot;                 &quot;Rockchip  RK3399 hexa core 4GB RAM GBE eMMC USB3 USB-C WiFi/BT&quot;)</span><br><span class="line">	options+=(&quot;orangepi800&quot;                 &quot;Rockchip  RK3399 hexa core 4GB RAM GBE eMMC USB3 USB-C WiFi/BT VGA&quot;)</span><br><span class="line">	options+=(&quot;orangepi5&quot;                 &quot;Rockchip  RK3588S octa core 4-16GB RAM GBE USB3 USB-C NVMe&quot;)</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepicm5&quot;</span>                 <span class="string">&quot;Rockchip  RK3588S octa core 4-16GB RAM GBE USB3 USB-C&quot;</span>)</span></span><br><span class="line">	options+=(&quot;orangepi5b&quot;                 &quot;Rockchip  RK3588S octa core 4-16GB RAM GBE USB3 USB-C WiFi/BT eMMC&quot;)</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepitab&quot;</span>                 <span class="string">&quot;Rockchip  RK3588S octa core 4-16GB RAM USB-C WiFi/BT NVMe&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepi900&quot;</span>                 <span class="string">&quot;Rockchip  RK3588 octa core 4-16GB RAM 2.5GBE USB3 USB-C WiFi/BT NVMe&quot;</span>)</span></span><br><span class="line">	options+=(&quot;orangepi5plus&quot;                 &quot;Rockchip  RK3588 octa core 4-32GB RAM 2.5GBE USB3 USB-C WiFi/BT NVMe eMMC&quot;)</span><br><span class="line">	options+=(&quot;orangepicm4&quot;                 &quot;Rockchip  RK3566 quad core 2-8GB RAM GBE eMMC USB3 NvMe WiFi/BT&quot;)</span><br><span class="line">	options+=(&quot;orangepi3b&quot;                  &quot;Rockchip  RK3566 quad core 2-8GB RAM GBE eMMC USB3 NvMe WiFi/BT&quot;)</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">options+=(<span class="string">&quot;orangepir1plus&quot;</span>              <span class="string">&quot;Rockchip  RK3328 quad core 1GB RAM 2xGBE USB2 SPI&quot;</span>)</span></span><br><span class="line"></span><br><span class="line">	menustr=&quot;Please choose a Board.&quot;</span><br><span class="line">	BOARD=$(whiptail --title &quot;$&#123;titlestr&#125;&quot; --backtitle &quot;$&#123;backtitle&#125;&quot; \</span><br><span class="line">			  --menu &quot;$&#123;menustr&#125;&quot; &quot;$&#123;TTY_Y&#125;&quot; &quot;$&#123;TTY_X&#125;&quot; $((TTY_Y - 8))  \</span><br><span class="line">			  --cancel-button Exit --ok-button Select &quot;$&#123;options[@]&#125;&quot; \</span><br><span class="line">			  3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class="line"></span><br><span class="line">	unset options</span><br><span class="line">	[[ -z $BOARD ]] &amp;&amp; exit_with_error &quot;No option selected&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">BOARD_TYPE=&quot;conf&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shellcheck <span class="built_in">source</span>=/dev/null</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">external/config/boards/orangepi5b.confï¼Œç±»ä¼¼äºç‘èŠ¯å¾®çš„ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼Œ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Rockchip RK3588s SoC</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">BOARD_NAME=<span class="string">&quot;Orange Pi 5B&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">BOARDFAMILY=<span class="string">&quot;rockchip-rk3588&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">BOOTCONFIG=<span class="string">&quot;orangepi_5b_defconfig&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">KERNEL_TARGET=<span class="string">&quot;legacy&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">BOOT_LOGO=<span class="string">&quot;desktop&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">BOOT_FDT_FILE=<span class="string">&quot;rockchip/rk3588s-orangepi-5b.dtb&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">BOOT_SCENARIO=<span class="string">&quot;spl-blobs&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">IMAGE_PARTITION_TABLE=<span class="string">&quot;gpt&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">BOOT_SUPPORT_SPI=<span class="string">&quot;yes&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SKIP_BOOTSPLASH=<span class="string">&quot;yes&quot;</span> <span class="comment"># Skip boot splash patch, conflicts with CONFIG_VT=yes</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">DISTRIB_TYPE_LEGACY=<span class="string">&quot;bullseye bookworm bionic focal jammy&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">BOOTFS_TYPE=<span class="string">&quot;fat&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">REVISION=<span class="string">&quot;1.0.8&quot;</span></span></span><br><span class="line"></span><br><span class="line">source &quot;$&#123;EXTER&#125;/config/boards/$&#123;BOARD&#125;.$&#123;BOARD_TYPE&#125;&quot;</span><br><span class="line">LINUXFAMILY=&quot;$&#123;BOARDFAMILY&#125;&quot;</span><br><span class="line"></span><br><span class="line">[[ -z $KERNEL_TARGET ]] &amp;&amp; exit_with_error &quot;Board configuration does not define valid kernel config&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™ä¸ªæ²¡æœ‰è¿›å…¥ï¼Œè·³è¿‡</span></span><br><span class="line">if [[ -z $BRANCH ]]; then</span><br><span class="line"></span><br><span class="line">	options=()</span><br><span class="line">	[[ $KERNEL_TARGET == *current* ]] &amp;&amp; options+=(&quot;current&quot; &quot;Recommended. Come with best support&quot;)</span><br><span class="line">	[[ $KERNEL_TARGET == *legacy* ]] &amp;&amp; options+=(&quot;legacy&quot; &quot;Old stable / Legacy&quot;)</span><br><span class="line">	[[ $KERNEL_TARGET == *next* ]] &amp;&amp; options+=(&quot;next&quot; &quot;Use the latest kernel&quot;)</span><br><span class="line"></span><br><span class="line">	menustr=&quot;Select the target kernel branch\nExact kernel versions depend on selected board&quot;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="keyword">do</span> not display selection dialog <span class="keyword">if</span> only one kernel branch is available</span></span><br><span class="line">	if [[ &quot;$&#123;#options[@]&#125;&quot; == 2 ]]; then</span><br><span class="line">		BRANCH=&quot;$&#123;options[0]&#125;&quot;</span><br><span class="line">	else</span><br><span class="line">		BRANCH=$(whiptail --title &quot;$&#123;titlestr&#125;&quot; --backtitle &quot;$&#123;backtitle&#125;&quot; \</span><br><span class="line">				  --menu &quot;$&#123;menustr&#125;&quot; &quot;$&#123;TTY_Y&#125;&quot; &quot;$&#123;TTY_X&#125;&quot; $((TTY_Y - 8))  \</span><br><span class="line">				  --cancel-button Exit --ok-button Select &quot;$&#123;options[@]&#125;&quot; \</span><br><span class="line">				  3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class="line">	fi</span><br><span class="line">	unset options</span><br><span class="line">	[[ -z $BRANCH ]] &amp;&amp; exit_with_error &quot;No kernel branch selected&quot;</span><br><span class="line">	[[ $BRANCH == dev &amp;&amp; $SHOW_WARNING == yes ]] &amp;&amp; show_developer_warning</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™é‡Œæ²¡è¿›å…¥</span></span><br><span class="line">if [[ -z $&#123;MEM_TYPE&#125; &amp;&amp; $&#123;BOARD&#125; =~ orangepizero3|orangepir1b|orangepizero2w &amp;&amp; $&#123;BUILD_OPT&#125; =~ u-boot|image &amp;&amp; $&#123;BRANCH&#125; == next ]]; then</span><br><span class="line"></span><br><span class="line">	options+=(&quot;1500MB&quot;    &quot;1.5 GB Memory&quot;)</span><br><span class="line">	options+=(&quot;Others&quot;    &quot;1/2/4 GB Memory&quot;)</span><br><span class="line"></span><br><span class="line">	menustr=&quot;Please choose memory size for $&#123;BOARD&#125;.&quot;</span><br><span class="line">	MEM_TYPE=$(whiptail --title &quot;$&#123;titlestr&#125;&quot; --backtitle &quot;$&#123;backtitle&#125;&quot; \</span><br><span class="line">			  --menu &quot;$&#123;menustr&#125;&quot; &quot;$&#123;TTY_Y&#125;&quot; &quot;$&#123;TTY_X&#125;&quot; $((TTY_Y - 8))  \</span><br><span class="line">			  --cancel-button Exit --ok-button Select &quot;$&#123;options[@]&#125;&quot; \</span><br><span class="line">			  3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class="line"></span><br><span class="line">	unset options</span><br><span class="line">	[[ -z $MEM_TYPE ]] &amp;&amp; exit_with_error &quot;No option selected&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™é‡Œä¹Ÿæ²¡è¿›å…¥</span></span><br><span class="line">if [[ $BUILD_OPT =~ rootfs|image &amp;&amp; -z $RELEASE ]]; then</span><br><span class="line"></span><br><span class="line">	options=()</span><br><span class="line"></span><br><span class="line">	distros_options</span><br><span class="line"></span><br><span class="line">	menustr=&quot;Select the target OS release package base&quot;</span><br><span class="line">	RELEASE=$(whiptail --title &quot;Choose a release package base&quot; --backtitle &quot;$&#123;backtitle&#125;&quot; \</span><br><span class="line">			  --menu &quot;$&#123;menustr&#125;&quot; &quot;$&#123;TTY_Y&#125;&quot; &quot;$&#123;TTY_X&#125;&quot; $((TTY_Y - 8))  \</span><br><span class="line">			  --cancel-button Exit --ok-button Select &quot;$&#123;options[@]&#125;&quot; \</span><br><span class="line">			  3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;options : <span class="variable">$&#123;options&#125;</span>&quot;</span></span></span><br><span class="line">	[[ -z $RELEASE ]] &amp;&amp; exit_with_error &quot;No release selected&quot;</span><br><span class="line"></span><br><span class="line">	unset options</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é€‰æ‹©æ¡Œé¢ç«¯è¿˜æ˜¯æœåŠ¡å™¨ç«¯ï¼Œä¿å­˜åˆ°BUILD_DESKTOPå˜é‡ä¸­</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">don<span class="string">&#x27;t show desktop option if we choose minimal build</span></span></span><br><span class="line">[[ $BUILD_MINIMAL == yes ]] &amp;&amp; BUILD_DESKTOP=no</span><br><span class="line"></span><br><span class="line">if [[ $BUILD_OPT =~ rootfs|image &amp;&amp; -z $BUILD_DESKTOP ]]; then</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">read distribution support status which is written to the orangepi-release file</span></span></span><br><span class="line">	set_distribution_status</span><br><span class="line"></span><br><span class="line">	options=()</span><br><span class="line">	options+=(&quot;no&quot; &quot;Image with console interface (server)&quot;)</span><br><span class="line">	options+=(&quot;yes&quot; &quot;Image with desktop environment&quot;)</span><br><span class="line"></span><br><span class="line">	menustr=&quot;Select the target image type&quot;</span><br><span class="line">	BUILD_DESKTOP=$(whiptail --title &quot;Choose image type&quot; --backtitle &quot;$&#123;backtitle&#125;&quot; \</span><br><span class="line">			  --menu &quot;$&#123;menustr&#125;&quot; &quot;$&#123;TTY_Y&#125;&quot; &quot;$&#123;TTY_X&#125;&quot; $((TTY_Y - 8))  \</span><br><span class="line">			  --cancel-button Exit --ok-button Select &quot;$&#123;options[@]&#125;&quot; \</span><br><span class="line">			  3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class="line">	unset options</span><br><span class="line">	[[ -z $BUILD_DESKTOP ]] &amp;&amp; exit_with_error &quot;No option selected&quot;</span><br><span class="line">	if [[ $&#123;BUILD_DESKTOP&#125; == &quot;yes&quot; ]]; then</span><br><span class="line">		BUILD_MINIMAL=no</span><br><span class="line">		SELECTED_CONFIGURATION=&quot;desktop&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">æœåŠ¡ç«¯çš„é€‰æ‹©ï¼Œæˆ‘è¿™é‡Œä¸ä¼šè¿›å…¥</span></span></span><br><span class="line">if [[ $BUILD_OPT =~ rootfs|image &amp;&amp; $BUILD_DESKTOP == no &amp;&amp; -z $BUILD_MINIMAL ]]; then</span><br><span class="line"></span><br><span class="line">	options=()</span><br><span class="line">	options+=(&quot;no&quot; &quot;Standard image with console interface&quot;)</span><br><span class="line">	options+=(&quot;yes&quot; &quot;Minimal image with console interface&quot;)</span><br><span class="line">	menustr=&quot;Select the target image type&quot;</span><br><span class="line">	BUILD_MINIMAL=$(whiptail --title &quot;Choose image type&quot; --backtitle &quot;$&#123;backtitle&#125;&quot; \</span><br><span class="line">			  --menu &quot;$&#123;menustr&#125;&quot; &quot;$&#123;TTY_Y&#125;&quot; &quot;$&#123;TTY_X&#125;&quot; $((TTY_Y - 8))  \</span><br><span class="line">			  --cancel-button Exit --ok-button Select &quot;$&#123;options[@]&#125;&quot; \</span><br><span class="line">			  3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class="line">	unset options</span><br><span class="line">	[[ -z $BUILD_MINIMAL ]] &amp;&amp; exit_with_error &quot;No option selected&quot;</span><br><span class="line">	if [[ $BUILD_MINIMAL == &quot;yes&quot; ]]; then</span><br><span class="line">		SELECTED_CONFIGURATION=&quot;cli_minimal&quot;</span><br><span class="line">	else</span><br><span class="line">		SELECTED_CONFIGURATION=&quot;cli_standard&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">prevent conflicting setup</span></span></span><br><span class="line">if [[ $BUILD_DESKTOP == &quot;yes&quot; ]]; then</span><br><span class="line">	BUILD_MINIMAL=no</span><br><span class="line">	SELECTED_CONFIGURATION=&quot;desktop&quot;</span><br><span class="line">elif [[ $BUILD_MINIMAL != &quot;yes&quot; || -z &quot;$&#123;BUILD_MINIMAL&#125;&quot; ]]; then</span><br><span class="line">	BUILD_MINIMAL=no # Just in case BUILD_MINIMAL is not defined</span><br><span class="line">	BUILD_DESKTOP=no</span><br><span class="line">	SELECTED_CONFIGURATION=&quot;cli_standard&quot;</span><br><span class="line">elif [[ $BUILD_MINIMAL == &quot;yes&quot; ]]; then</span><br><span class="line">	BUILD_DESKTOP=no</span><br><span class="line">	SELECTED_CONFIGURATION=&quot;cli_minimal&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">[[ $&#123;KERNEL_CONFIGURE&#125; == prebuilt ]] &amp;&amp; [[ -z $&#123;REPOSITORY_INSTALL&#125; ]] &amp;&amp; \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">#REPOSITORY_INSTALL=&quot;u-boot,kernel,bsp,orangepi-zsh,orangepi-config,orangepi-firmware$&#123;BUILD_DESKTOP:+,orangepi-desktop&#125;&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">shellcheck source=configuration.sh</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">è¿™ä¸ªè„šæœ¬å¯èƒ½æœ‰é—®é¢˜ï¼Œå…·ä½“çœ‹ä¸€ä¸‹ï¼Œä¹Ÿæ˜¯ä¸€äº›é…ç½®ï¼Œ</span></span></span><br><span class="line">source &quot;$&#123;SRC&#125;&quot;/scripts/configuration.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">optimize build time with 100% CPU usage</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">è·å–CPUæœ€å¤§çš„çº¿ç¨‹æ•°</span></span></span><br><span class="line">CPUS=$(grep -c &#x27;processor&#x27; /proc/cpuinfo)</span><br><span class="line">if [[ $USEALLCORES != no ]]; then</span><br><span class="line"></span><br><span class="line">	CTHREADS=&quot;-j$((CPUS + CPUS/2))&quot;</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line"></span><br><span class="line">	CTHREADS=&quot;-j1&quot;</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">call_extension_method &quot;post_determine_cthreads&quot; &quot;config_post_determine_cthreads&quot; &lt;&lt; &#x27;POST_DETERMINE_CTHREADS&#x27;</span><br><span class="line">*give config a chance modify CTHREADS programatically. A build server may work better with hyperthreads-1 for example.*</span><br><span class="line">Called early, before any compilation work starts.</span><br><span class="line">POST_DETERMINE_CTHREADS</span><br><span class="line"></span><br><span class="line">if [[ $BETA == yes ]]; then</span><br><span class="line">	IMAGE_TYPE=nightly</span><br><span class="line">elif [[ $BETA != &quot;yes&quot; &amp;&amp; $BUILD_ALL == yes &amp;&amp; -n $GPG_PASS ]]; then</span><br><span class="line">	IMAGE_TYPE=stable</span><br><span class="line">else</span><br><span class="line">	IMAGE_TYPE=user-built</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">branch2dir() &#123;</span><br><span class="line">	[[ &quot;$&#123;1&#125;&quot; == &quot;head&quot; ]] &amp;&amp; echo &quot;HEAD&quot; || echo &quot;$&#123;1##*:&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOTSOURCEDIR=&quot;$&#123;BOOTDIR&#125;/$(branch2dir &quot;$&#123;BOOTBRANCH&#125;&quot;)&quot;</span><br><span class="line">LINUXSOURCEDIR=&quot;$&#123;KERNELDIR&#125;/$(branch2dir &quot;$&#123;KERNELBRANCH&#125;&quot;)&quot;</span><br><span class="line">[[ -n $ATFSOURCE ]] &amp;&amp; ATFSOURCEDIR=&quot;$&#123;ATFDIR&#125;/$(branch2dir &quot;$&#123;ATFBRANCH&#125;&quot;)&quot;</span><br><span class="line"></span><br><span class="line">BSP_CLI_PACKAGE_NAME=&quot;orangepi-bsp-cli-$&#123;BOARD&#125;&quot;</span><br><span class="line">BSP_CLI_PACKAGE_FULLNAME=&quot;$&#123;BSP_CLI_PACKAGE_NAME&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;&quot;</span><br><span class="line">BSP_DESKTOP_PACKAGE_NAME=&quot;orangepi-bsp-desktop-$&#123;BOARD&#125;&quot;</span><br><span class="line">BSP_DESKTOP_PACKAGE_FULLNAME=&quot;$&#123;BSP_DESKTOP_PACKAGE_NAME&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;&quot;</span><br><span class="line"></span><br><span class="line">CHOSEN_UBOOT=linux-u-boot-$&#123;BRANCH&#125;-$&#123;BOARD&#125;</span><br><span class="line">CHOSEN_KERNEL=linux-image-$&#123;BRANCH&#125;-$&#123;LINUXFAMILY&#125;</span><br><span class="line">CHOSEN_ROOTFS=$&#123;BSP_CLI_PACKAGE_NAME&#125;</span><br><span class="line">CHOSEN_DESKTOP=orangepi-$&#123;RELEASE&#125;-desktop-$&#123;DESKTOP_ENVIRONMENT&#125;</span><br><span class="line">CHOSEN_KSRC=linux-source-$&#123;BRANCH&#125;-$&#123;LINUXFAMILY&#125;</span><br><span class="line"></span><br><span class="line">do_default() &#123;</span><br><span class="line"></span><br><span class="line">start=$(date +%s)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Check and install dependencies, directory structure and settings</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">The OFFLINE_WORK variable inside the function</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ä¸‹è½½ç¼–è¯‘å™¨ç­‰ä»¥åŠä¸€äº›ç¯å¢ƒä¾èµ–</span></span></span><br><span class="line">prepare_host</span><br><span class="line"></span><br><span class="line">[[ &quot;$&#123;JUST_INIT&#125;&quot; == &quot;yes&quot; ]] &amp;&amp; exit 0</span><br><span class="line"></span><br><span class="line">[[ $CLEAN_LEVEL == *sources* ]] &amp;&amp; cleaning &quot;sources&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">fetch_from_repo &lt;url&gt; &lt;dir&gt; &lt;ref&gt; &lt;subdir_flag&gt;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ignore updates help on building all images - for internal purposes</span></span></span><br><span class="line">if [[ $&#123;IGNORE_UPDATES&#125; != yes ]]; then</span><br><span class="line"></span><br><span class="line">	display_alert &quot;Downloading sources&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">åŒæ­¥ubootå’Œå†…æ ¸</span></span></span><br><span class="line">	[[ $BUILD_OPT =~ u-boot|image ]] &amp;&amp; fetch_from_repo &quot;$BOOTSOURCE&quot; &quot;$BOOTDIR&quot; &quot;$BOOTBRANCH&quot; &quot;yes&quot;</span><br><span class="line">	[[ $BUILD_OPT =~ kernel|image ]] &amp;&amp; fetch_from_repo &quot;$KERNELSOURCE&quot; &quot;$KERNELDIR&quot; &quot;$KERNELBRANCH&quot; &quot;yes&quot;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">åŒæ­¥atfa</span></span></span><br><span class="line">	if [[ -n $&#123;ATFSOURCE&#125; ]]; then</span><br><span class="line"></span><br><span class="line">		[[ $&#123;BUILD_OPT&#125; =~ u-boot|image ]] &amp;&amp; fetch_from_repo &quot;$ATFSOURCE&quot; &quot;$&#123;EXTER&#125;/cache/sources/$ATFDIR&quot; &quot;$ATFBRANCH&quot; &quot;yes&quot;</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ $&#123;BOARD&#125; =~ orangepi4|orangepi4-lts|orangepi800 &amp;&amp; $BRANCH == legacy ]]; then</span><br><span class="line"></span><br><span class="line">		[[ $BUILD_OPT =~ image ]] &amp;&amp; fetch_from_repo &quot;https://github.com/orangepi-xunlong/rk3399_gst_xserver_libs.git&quot; &quot;$&#123;EXTER&#125;/cache/sources/rk3399_gst_xserver_libs&quot; &quot;branch:main&quot;</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ $&#123;BOARD&#125; =~ orangepi4|orangepi4-lts|orangepi800 &amp;&amp; $RELEASE =~ focal|buster|bullseye|bookworm ]]; then</span><br><span class="line"></span><br><span class="line">		[[ $&#123;BUILD_OPT&#125; == image ]] &amp;&amp; fetch_from_repo &quot;https://github.com/orangepi-xunlong/rk-rootfs-build.git&quot; &quot;$&#123;EXTER&#125;/cache/sources/rk-rootfs-build-$&#123;RELEASE&#125;&quot; &quot;branch:rk-rootfs-build-$&#123;RELEASE&#125;&quot;</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">åŒæ­¥3588çš„package</span></span></span><br><span class="line">	if [[ $&#123;BOARDFAMILY&#125; == &quot;rockchip-rk3588&quot; &amp;&amp; $RELEASE =~ bullseye|bookworm|focal|jammy|raspi ]]; then</span><br><span class="line"></span><br><span class="line">		[[ $&#123;BUILD_OPT&#125; == image ]] &amp;&amp; fetch_from_repo &quot;https://github.com/orangepi-xunlong/rk-rootfs-build.git&quot; &quot;$&#123;EXTER&#125;/cache/sources/rk3588_packages_$&#123;RELEASE&#125;&quot; &quot;branch:rk3588_packages_$&#123;RELEASE&#125;&quot;</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ $&#123;BOARDFAMILY&#125; == &quot;rockchip-rk356x&quot; &amp;&amp; $RELEASE =~ bullseye|focal|jammy|raspi ]]; then</span><br><span class="line"></span><br><span class="line">		[[ $&#123;BUILD_OPT&#125; == image ]] &amp;&amp; fetch_from_repo &quot;https://github.com/orangepi-xunlong/rk-rootfs-build.git&quot; &quot;$&#123;EXTER&#125;/cache/sources/rk356x_packages&quot; &quot;branch:rk356x_packages&quot;</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ $&#123;BOARD&#125; =~ orangepi3|orangepi3-lts &amp;&amp; $RELEASE =~ bullseye &amp;&amp; $BRANCH == current ]]; then</span><br><span class="line"></span><br><span class="line">		[[ $&#123;BUILD_OPT&#125; == image ]] &amp;&amp; fetch_from_repo &quot;https://github.com/orangepi-xunlong/rk-rootfs-build.git&quot; &quot;$&#123;EXTER&#125;/cache/sources/ffmpeg_kodi_$&#123;RELEASE&#125;&quot; &quot;branch:ffmpeg_kodi_$&#123;RELEASE&#125;&quot;</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ $&#123;BOARD&#125; =~ orangepi4|orangepi4-lts|orangepi800 &amp;&amp; $RELEASE =~ jammy &amp;&amp; $BRANCH == next ]]; then</span><br><span class="line"></span><br><span class="line">		[[ $&#123;BUILD_OPT&#125; == image ]] &amp;&amp; fetch_from_repo &quot;https://github.com/orangepi-xunlong/rk-rootfs-build.git&quot; &quot;$&#123;EXTER&#125;/cache/sources/ffmpeg_kodi_$&#123;RELEASE&#125;&quot; &quot;branch:ffmpeg_kodi_$&#123;RELEASE&#125;&quot;</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	call_extension_method &quot;fetch_sources_tools&quot;  &lt;&lt;- &#x27;FETCH_SOURCES_TOOLS&#x27;</span><br><span class="line">	*fetch host-side sources needed for tools and build*</span><br><span class="line">	Run early to fetch_from_repo or otherwise obtain sources for needed tools.</span><br><span class="line">	FETCH_SOURCES_TOOLS</span><br><span class="line"></span><br><span class="line">	call_extension_method &quot;build_host_tools&quot;  &lt;&lt;- &#x27;BUILD_HOST_TOOLS&#x27;</span><br><span class="line">	*build needed tools for the build, host-side*</span><br><span class="line">	After sources are fetched, build host-side tools needed for the build.</span><br><span class="line">	BUILD_HOST_TOOLS</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">for option in $(tr &#x27;,&#x27; &#x27; &#x27; &lt;&lt;&lt; &quot;$CLEAN_LEVEL&quot;); do</span><br><span class="line">	[[ $option != sources ]] &amp;&amp; cleaning &quot;$option&quot;</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Compile u-boot if packed .deb does not exist or use the one from Orange Pi</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ç¼–è¯‘uboot</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ç¼–è¯‘TF-a</span></span></span><br><span class="line">if [[ $BUILD_OPT == u-boot || $BUILD_OPT == image ]]; then</span><br><span class="line"></span><br><span class="line">	if [[ ! -f &quot;$&#123;DEB_STORAGE&#125;&quot;/u-boot/$&#123;CHOSEN_UBOOT&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb ]]; then</span><br><span class="line"></span><br><span class="line">		[[ -n &quot;$&#123;ATFSOURCE&#125;&quot; &amp;&amp; &quot;$&#123;REPOSITORY_INSTALL&#125;&quot; != *u-boot* ]] &amp;&amp; compile_atf</span><br><span class="line">		</span><br><span class="line">		[[ $&#123;REPOSITORY_INSTALL&#125; != *u-boot* ]] &amp;&amp; compile_uboot</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ $BUILD_OPT == &quot;u-boot&quot; ]]; then</span><br><span class="line">		unset BUILD_MINIMAL BUILD_DESKTOP COMPRESS_OUTPUTIMAGE</span><br><span class="line">		display_alert &quot;U-boot build done&quot; &quot;@host&quot; &quot;info&quot;</span><br><span class="line">		display_alert &quot;Target directory&quot; &quot;$&#123;DEB_STORAGE&#125;/u-boot&quot; &quot;info&quot;</span><br><span class="line">		display_alert &quot;File name&quot; &quot;$&#123;CHOSEN_UBOOT&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot; &quot;info&quot;</span><br><span class="line">	fi</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ç¼–è¯‘å†…æ ¸</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Compile kernel if packed .deb does not exist or use the one from Orange Pi</span></span></span><br><span class="line">if [[ $BUILD_OPT == kernel || $BUILD_OPT == image ]]; then</span><br><span class="line"></span><br><span class="line">	if [[ ! -f $&#123;DEB_STORAGE&#125;/$&#123;CHOSEN_KERNEL&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb ]]; then </span><br><span class="line"></span><br><span class="line">		KDEB_CHANGELOG_DIST=$RELEASE</span><br><span class="line">		[[ &quot;$&#123;REPOSITORY_INSTALL&#125;&quot; != *kernel* ]] &amp;&amp; compile_kernel</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ $BUILD_OPT == &quot;kernel&quot; ]]; then</span><br><span class="line">		unset BUILD_MINIMAL BUILD_DESKTOP COMPRESS_OUTPUTIMAGE</span><br><span class="line">		display_alert &quot;Kernel build done&quot; &quot;@host&quot; &quot;info&quot;</span><br><span class="line">		display_alert &quot;Target directory&quot; &quot;$&#123;DEB_STORAGE&#125;/&quot; &quot;info&quot;</span><br><span class="line">		display_alert &quot;File name&quot; &quot;$&#123;CHOSEN_KERNEL&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot; &quot;info&quot;</span><br><span class="line">	fi</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ç¼–è¯‘æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™é‡Œæ˜¯æœ€é‡è¦çš„</span></span></span><br><span class="line">if [[ $BUILD_OPT == rootfs || $BUILD_OPT == image ]]; then</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Compile orangepi-config if packed .deb does not exist or use the one from Orange Pi</span></span></span><br><span class="line">	if [[ ! -f $&#123;DEB_STORAGE&#125;/orangepi-config_$&#123;REVISION&#125;_all.deb ]]; then</span><br><span class="line">	</span><br><span class="line">		[[ &quot;$&#123;REPOSITORY_INSTALL&#125;&quot; != *orangepi-config* ]] &amp;&amp; compile_orangepi-config</span><br><span class="line">	fi </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Compile orangepi-zsh if packed .deb does not exist or use the one from repository</span></span></span><br><span class="line">	if [[ ! -f $&#123;DEB_STORAGE&#125;/orangepi-zsh_$&#123;REVISION&#125;_all.deb ]]; then</span><br><span class="line"></span><br><span class="line">	        [[ &quot;$&#123;REPOSITORY_INSTALL&#125;&quot; != *orangepi-zsh* ]] &amp;&amp; compile_orangepi-zsh</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Compile plymouth-theme-orangepi if packed .deb does not exist or use the one from repository</span></span></span><br><span class="line">	if [[ ! -f $&#123;DEB_STORAGE&#125;/plymouth-theme-orangepi_$&#123;REVISION&#125;_all.deb ]]; then</span><br><span class="line"></span><br><span class="line">		[[ &quot;$&#123;REPOSITORY_INSTALL&#125;&quot; != *plymouth-theme-orangepi* ]] &amp;&amp; compile_plymouth-theme-orangepi</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Compile orangepi-firmware if packed .deb does not exist or use the one from repository</span></span></span><br><span class="line">	if [[ &quot;$&#123;REPOSITORY_INSTALL&#125;&quot; != *orangepi-firmware* ]]; then</span><br><span class="line"></span><br><span class="line">		if ! ls &quot;$&#123;DEB_STORAGE&#125;/orangepi-firmware_$&#123;REVISION&#125;_all.deb&quot; 1&gt; /dev/null 2&gt;&amp;1; then</span><br><span class="line"></span><br><span class="line">			FULL=&quot;&quot;</span><br><span class="line">			REPLACE=&quot;-full&quot;</span><br><span class="line">			compile_firmware</span><br><span class="line"></span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"><span class="string">if ! ls &quot;$&#123;DEB_STORAGE&#125;/orangepi-firmware-full_$&#123;REVISION&#125;_all.deb&quot; 1&gt; /dev/null 2&gt;&amp;1; then</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			#</span><span class="language-bash"><span class="string">FULL=&quot;-full&quot;</span></span></span><br><span class="line"><span class="meta prompt_">			#</span><span class="language-bash"><span class="string">REPLACE=&quot;&quot;</span></span></span><br><span class="line"><span class="meta prompt_">			#</span><span class="language-bash"><span class="string">compile_firmware</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"><span class="string">fi</span></span></span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	overlayfs_wrapper &quot;cleanup&quot;</span><br><span class="line"><span class="meta prompt_">	</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">create board support package</span></span></span><br><span class="line">	[[ -n $RELEASE &amp;&amp; ! -f $&#123;DEB_STORAGE&#125;/$RELEASE/$&#123;BSP_CLI_PACKAGE_FULLNAME&#125;.deb ]] &amp;&amp; create_board_package</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">create desktop package</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">[[ -n $RELEASE &amp;&amp; $DESKTOP_ENVIRONMENT &amp;&amp; ! -f $&#123;DEB_STORAGE&#125;/$RELEASE/$&#123;CHOSEN_DESKTOP&#125;_$&#123;REVISION&#125;_all.deb ]] &amp;&amp; create_desktop_package</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">[[ -n $RELEASE &amp;&amp; $DESKTOP_ENVIRONMENT &amp;&amp; ! -f $&#123;DEB_STORAGE&#125;/$&#123;RELEASE&#125;/$&#123;BSP_DESKTOP_PACKAGE_FULLNAME&#125;.deb ]] &amp;&amp; create_bsp_desktop_package</span></span></span><br><span class="line">	[[ -n $RELEASE &amp;&amp; $DESKTOP_ENVIRONMENT ]] &amp;&amp; create_desktop_package</span><br><span class="line">	[[ -n $RELEASE &amp;&amp; $DESKTOP_ENVIRONMENT ]] &amp;&amp; create_bsp_desktop_package</span><br><span class="line"><span class="meta prompt_">	</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">build additional packages</span></span></span><br><span class="line">	[[ $EXTERNAL_NEW == compile ]] &amp;&amp; chroot_build_packages</span><br><span class="line">	</span><br><span class="line">	[[ $BSP_BUILD != yes ]] &amp;&amp; debootstrap_ng</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">hook for function to run after build, i.e. to change owner of $SRC</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">NOTE: this will run only if there were no errors during build process</span></span></span><br><span class="line">[[ $(type -t run_after_build) == function ]] &amp;&amp; run_after_build || true</span><br><span class="line"></span><br><span class="line">end=$(date +%s)</span><br><span class="line">runtime=$(((end-start)/60))</span><br><span class="line">display_alert &quot;Runtime&quot; &quot;$runtime min&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Make it easy to repeat build by displaying build options used</span></span></span><br><span class="line">[ &quot;$(systemd-detect-virt)&quot; == &#x27;docker&#x27; ] &amp;&amp; BUILD_CONFIG=&#x27;docker&#x27;</span><br><span class="line"></span><br><span class="line">display_alert &quot;Repeat Build Options&quot; &quot;sudo ./build.sh $&#123;BUILD_CONFIG&#125; BOARD=$&#123;BOARD&#125; BRANCH=$&#123;BRANCH&#125; \</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="string">([[ -n $BUILD_OPT ]] &amp;&amp; echo &quot;BUILD_OPT=$&#123;BUILD_OPT&#125; &quot;)\</span></span></span><br><span class="line"><span class="string"><span class="language-bash">$([[ -n $RELEASE ]] &amp;&amp; echo &quot;RELEASE=$&#123;RELEASE&#125; &quot;)\</span></span></span><br><span class="line"><span class="string"><span class="language-bash">$([[ -n $BUILD_MINIMAL ]] &amp;&amp; echo &quot;BUILD_MINIMAL=$&#123;BUILD_MINIMAL&#125; &quot;)\</span></span></span><br><span class="line"><span class="string"><span class="language-bash">$([[ -n $BUILD_DESKTOP ]] &amp;&amp; echo &quot;BUILD_DESKTOP=$&#123;BUILD_DESKTOP&#125; &quot;)\</span></span></span><br><span class="line"><span class="string"><span class="language-bash">$([[ -n $KERNEL_CONFIGURE ]] &amp;&amp; echo &quot;KERNEL_CONFIGURE=$&#123;KERNEL_CONFIGURE&#125; &quot;)\</span></span></span><br><span class="line"><span class="string"><span class="language-bash">$([[ -n $DESKTOP_ENVIRONMENT ]] &amp;&amp; echo &quot;DESKTOP_ENVIRONMENT=$&#123;DESKTOP_ENVIRONMENT&#125; &quot;)\</span></span></span><br><span class="line"><span class="string"><span class="language-bash">$([[ -n $DESKTOP_ENVIRONMENT_CONFIG_NAME  ]] &amp;&amp; echo &quot;DESKTOP_ENVIRONMENT_CONFIG_NAME=$&#123;DESKTOP_ENVIRONMENT_CONFIG_NAME&#125; &quot;)\</span></span></span><br><span class="line"><span class="string"><span class="language-bash">$([[ -n $DESKTOP_APPGROUPS_SELECTED ]] &amp;&amp; echo &quot;DESKTOP_APPGROUPS_SELECTED=\&quot;$&#123;DESKTOP_APPGROUPS_SELECTED&#125;\&quot; &quot;)\</span></span></span><br><span class="line"><span class="string"><span class="language-bash">$([[ -n $DESKTOP_APT_FLAGS_SELECTED ]] &amp;&amp; echo &quot;DESKTOP_APT_FLAGS_SELECTED=\&quot;$&#123;DESKTOP_APT_FLAGS_SELECTED&#125;\&quot; &quot;)\</span></span></span><br><span class="line"><span class="string"><span class="language-bash">$([[ -n $COMPRESS_OUTPUTIMAGE ]] &amp;&amp; echo &quot;COMPRESS_OUTPUTIMAGE=$&#123;COMPRESS_OUTPUTIMAGE&#125; &quot;)\</span></span></span><br><span class="line"><span class="string"><span class="language-bash">&quot; &quot;ext&quot;</span></span></span><br><span class="line"></span><br><span class="line">&#125; # end of do_default()</span><br><span class="line"></span><br><span class="line">if [[ -z $1 ]]; then</span><br><span class="line">	do_default</span><br><span class="line">else</span><br><span class="line">	eval &quot;$@&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="4-configuration-shåˆ†æ"><a href="#4-configuration-shåˆ†æ" class="headerlink" title="4.configuration.shåˆ†æ"></a>4.configuration.shåˆ†æ</h1><p>çœ‹æ ·å­æ˜¯é…ç½®ä¸€äº›ç¯å¢ƒå˜é‡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Copyright (c) 2013-2021 Igor Pecovnik, igor.pecovnik@gma**.com</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This file is licensed under the terms of the GNU General Public</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">License version 2. This program is licensed <span class="string">&quot;as is&quot;</span> without any</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">warranty of any kind, whether express or implied.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[[ -z $VENDOR ]] &amp;&amp; VENDOR=&quot;Orange Pi&quot;</span><br><span class="line">[[ -z $ROOTPWD ]] &amp;&amp; ROOTPWD=&quot;orangepi&quot; # Must be changed @first login</span><br><span class="line">[[ -z $OPI_USERNAME ]] &amp;&amp; OPI_USERNAME=&quot;orangepi&quot; </span><br><span class="line">[[ -z $OPI_PWD ]] &amp;&amp; OPI_PWD=&quot;orangepi&quot; </span><br><span class="line">[[ -z $MAINTAINER ]] &amp;&amp; MAINTAINER=&quot;Orange Pi&quot; # deb signature</span><br><span class="line">[[ -z $MAINTAINERMAIL ]] &amp;&amp; MAINTAINERMAIL=&quot;leeboby@aliyun.com&quot; # deb signature</span><br><span class="line">[[ -z $DEB_COMPRESS ]] &amp;&amp; DEB_COMPRESS=&quot;xz&quot; # compress .debs with XZ by default. Use &#x27;none&#x27; for faster/larger builds</span><br><span class="line">TZDATA=$(cat /etc/timezone) # Timezone for target is taken from host or defined here.</span><br><span class="line">USEALLCORES=yes # Use all CPU cores for compiling</span><br><span class="line">HOSTRELEASE=$(cat /etc/os-release | grep VERSION_CODENAME | cut -d&quot;=&quot; -f2)</span><br><span class="line">[[ -z $HOSTRELEASE ]] &amp;&amp; HOSTRELEASE=$(cut -d&#x27;/&#x27; -f1 /etc/debian_version)</span><br><span class="line">[[ -z $EXIT_PATCHING_ERROR ]] &amp;&amp; EXIT_PATCHING_ERROR=&quot;&quot; # exit patching if failed</span><br><span class="line">[[ -z $HOST ]] &amp;&amp; HOST=&quot;$BOARD&quot; # set hostname to the board</span><br><span class="line">[[ -z $CHINA_DOWNLOAD_MIRROR ]] &amp;&amp; CHINA_DOWNLOAD_MIRROR=huawei</span><br><span class="line">cd &quot;$&#123;SRC&#125;&quot; || exit</span><br><span class="line">[[ -z &quot;$&#123;ROOTFSCACHE_VERSION&#125;&quot; ]] &amp;&amp; ROOTFSCACHE_VERSION=11</span><br><span class="line">[[ -z &quot;$&#123;CHROOT_CACHE_VERSION&#125;&quot; ]] &amp;&amp; CHROOT_CACHE_VERSION=7</span><br><span class="line">[[ -z $PLYMOUTH ]] &amp;&amp; PLYMOUTH=&quot;yes&quot;</span><br><span class="line"></span><br><span class="line">cd $&#123;SRC&#125;/scripts</span><br><span class="line">BUILD_REPOSITORY_URL=$(improved_git remote get-url $(improved_git remote 2&gt;/dev/null | grep origin) 2&gt;/dev/null)</span><br><span class="line">BUILD_REPOSITORY_COMMIT=$(improved_git describe --match=d_e_a_d_b_e_e_f --always --dirty 2&gt;/dev/null)</span><br><span class="line">ROOTFS_CACHE_MAX=200 # max number of rootfs cache, older ones will be cleaned up</span><br><span class="line"></span><br><span class="line">DEB_STORAGE=$DEST/debs</span><br><span class="line">DEB_ORANGEPI=$EXTER/cache/debs</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">TODO: fixed name can<span class="string">&#x27;t be used for parallel image building</span></span></span><br><span class="line">ROOT_MAPPER=&quot;orangepi-root&quot;</span><br><span class="line">[[ -z $ROOTFS_TYPE ]] &amp;&amp; ROOTFS_TYPE=ext4 # default rootfs type is ext4</span><br><span class="line">[[ &quot;ext4 f2fs btrfs xfs nfs fel&quot; != *$ROOTFS_TYPE* ]] &amp;&amp; exit_with_error &quot;Unknown rootfs type&quot; &quot;$ROOTFS_TYPE&quot;</span><br><span class="line"></span><br><span class="line">[[ -z $BTRFS_COMPRESSION ]] &amp;&amp; BTRFS_COMPRESSION=zlib # default btrfs filesystem compression method is zlib</span><br><span class="line">[[ ! $BTRFS_COMPRESSION =~ zlib|lzo|zstd|none ]] &amp;&amp; exit_with_error &quot;Unknown btrfs compression method&quot; &quot;$BTRFS_COMPRESSION&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Fixed image size is in 1M dd blocks (MiB)</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">to get size of block device /dev/sdX execute as root:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">echo $(( $(blockdev --getsize64 /dev/sdX) / 1024 / 1024 ))</span></span></span><br><span class="line">[[ &quot;f2fs&quot; == *$ROOTFS_TYPE* &amp;&amp; -z $FIXED_IMAGE_SIZE ]] &amp;&amp; exit_with_error &quot;Please define FIXED_IMAGE_SIZE&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">a passphrase is mandatory if rootfs encryption is enabled</span></span></span><br><span class="line">if [[ $CRYPTROOT_ENABLE == yes &amp;&amp; -z $CRYPTROOT_PASSPHRASE ]]; then</span><br><span class="line">	exit_with_error &quot;Root encryption is enabled but CRYPTROOT_PASSPHRASE is not set&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">small SD card with kernel, boot script and .dtb/.bin files</span></span></span><br><span class="line">[[ $ROOTFS_TYPE == nfs ]] &amp;&amp; FIXED_IMAGE_SIZE=64</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Since we are having too many options for mirror management,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">then here is yet another mirror related option.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Respecting user&#x27;</span>s override <span class="keyword">in</span> <span class="keyword">case</span> a mirror is unreachable.</span></span><br><span class="line">case $REGIONAL_MIRROR in</span><br><span class="line">	china)</span><br><span class="line">		[[ -z $USE_MAINLINE_GOOGLE_MIRROR ]] &amp;&amp; [[ -z $MAINLINE_MIRROR ]] &amp;&amp; MAINLINE_MIRROR=tuna</span><br><span class="line">		[[ -z $USE_GITHUB_UBOOT_MIRROR ]] &amp;&amp; [[ -z $UBOOT_MIRROR ]] &amp;&amp; UBOOT_MIRROR=gitee</span><br><span class="line">		[[ -z $GITHUB_MIRROR ]] &amp;&amp; GITHUB_MIRROR=gitclone</span><br><span class="line">		[[ -z $DOWNLOAD_MIRROR ]] &amp;&amp; DOWNLOAD_MIRROR=china</span><br><span class="line">		;;</span><br><span class="line">	*)</span><br><span class="line">		;;</span><br><span class="line">esac</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">used by multiple sources - reduce code duplication</span></span><br><span class="line">[[ $USE_MAINLINE_GOOGLE_MIRROR == yes ]] &amp;&amp; MAINLINE_MIRROR=google</span><br><span class="line"></span><br><span class="line">case $MAINLINE_MIRROR in</span><br><span class="line">	google)</span><br><span class="line">		MAINLINE_KERNEL_SOURCE=&#x27;https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux-stable&#x27;</span><br><span class="line">		MAINLINE_FIRMWARE_SOURCE=&#x27;https://kernel.googlesource.com/pub/scm/linux/kernel/git/firmware/linux-firmware.git&#x27;</span><br><span class="line">		;;</span><br><span class="line">	tuna)</span><br><span class="line">		MAINLINE_KERNEL_SOURCE=&#x27;https://mirrors.tuna.tsinghua.edu.cn/git/linux-stable.git&#x27;</span><br><span class="line">		MAINLINE_FIRMWARE_SOURCE=&#x27;https://mirrors.tuna.tsinghua.edu.cn/git/linux-firmware.git&#x27;</span><br><span class="line">		;;</span><br><span class="line">	bfsu)</span><br><span class="line">		MAINLINE_KERNEL_SOURCE=&#x27;https://mirrors.bfsu.edu.cn/git/linux-stable.git&#x27;</span><br><span class="line">		MAINLINE_FIRMWARE_SOURCE=&#x27;https://mirrors.bfsu.edu.cn/git/linux-firmware.git&#x27;</span><br><span class="line">		;;</span><br><span class="line">	*)</span><br><span class="line">		MAINLINE_KERNEL_SOURCE=&#x27;git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git&#x27;</span><br><span class="line">		MAINLINE_FIRMWARE_SOURCE=&#x27;git://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git&#x27;</span><br><span class="line">		;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">MAINLINE_KERNEL_DIR=&quot;$SRC/kernel&quot;</span><br><span class="line"></span><br><span class="line">[[ $USE_GITHUB_UBOOT_MIRROR == yes ]] &amp;&amp; UBOOT_MIRROR=github</span><br><span class="line"></span><br><span class="line">case $UBOOT_MIRROR in</span><br><span class="line">	gitee)</span><br><span class="line">		MAINLINE_UBOOT_SOURCE=&#x27;https://github.com/orangepi-xunlong/u-boot-orangepi.git&#x27;</span><br><span class="line">		;;</span><br><span class="line">	github)</span><br><span class="line">		MAINLINE_UBOOT_SOURCE=&#x27;https://github.com/orangepi-xunlong/u-boot-orangepi.git&#x27;</span><br><span class="line">		;;</span><br><span class="line">	*)</span><br><span class="line">		MAINLINE_UBOOT_SOURCE=&#x27;https://source.denx.de/u-boot/u-boot.git&#x27;</span><br><span class="line">		;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">MAINLINE_UBOOT_DIR=&quot;$SRC/u-boot&quot;</span><br><span class="line"></span><br><span class="line">case $GITHUB_MIRROR in</span><br><span class="line">	fastgit)</span><br><span class="line">		GITHUB_SOURCE=&#x27;https://hub.fastgit.xyz&#x27;</span><br><span class="line">		;;</span><br><span class="line">	gitclone)</span><br><span class="line">		GITHUB_SOURCE=&#x27;https://gitclone.com/github.com&#x27;</span><br><span class="line">		;;</span><br><span class="line">	*)</span><br><span class="line">		GITHUB_SOURCE=&#x27;https://github.com&#x27;</span><br><span class="line">		;;</span><br><span class="line">esac</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Let<span class="string">&#x27;s set default data if not defined in board configuration above</span></span></span><br><span class="line">[[ -z $OFFSET ]] &amp;&amp; OFFSET=4 # offset to 1st partition (we use 4MiB boundaries by default)</span><br><span class="line">ARCH=armhf</span><br><span class="line">KERNEL_IMAGE_TYPE=zImage</span><br><span class="line">CAN_BUILD_STRETCH=yes</span><br><span class="line">ATF_COMPILE=yes</span><br><span class="line">[[ -z $CRYPTROOT_SSH_UNLOCK ]] &amp;&amp; CRYPTROOT_SSH_UNLOCK=yes</span><br><span class="line">[[ -z $CRYPTROOT_SSH_UNLOCK_PORT ]] &amp;&amp; CRYPTROOT_SSH_UNLOCK_PORT=2022</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Default to pdkdf2, this used to be the default with cryptroot &lt;= 2.0, however</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">cryptroot 2.1 changed that to Argon2i. Argon2i is a memory intensive</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">algorithm which doesn&#x27;</span>t play well with SBCs (need 1GiB RAM by default !)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https://gitlab.com/cryptsetup/cryptsetup/-/issues/372</span></span><br><span class="line">[[ -z $CRYPTROOT_PARAMETERS ]] &amp;&amp; CRYPTROOT_PARAMETERS=&quot;--pbkdf pbkdf2&quot;</span><br><span class="line">[[ -z $WIREGUARD ]] &amp;&amp; WIREGUARD=&quot;no&quot;</span><br><span class="line">[[ -z $EXTRAWIFI ]] &amp;&amp; EXTRAWIFI=&quot;yes&quot;</span><br><span class="line">[[ -z $SKIP_BOOTSPLASH ]] &amp;&amp; SKIP_BOOTSPLASH=&quot;no&quot;</span><br><span class="line">[[ -z $AUFS ]] &amp;&amp; AUFS=&quot;yes&quot;</span><br><span class="line">[[ -z $IMAGE_PARTITION_TABLE ]] &amp;&amp; IMAGE_PARTITION_TABLE=&quot;msdos&quot;</span><br><span class="line">[[ -z $EXTRA_BSP_NAME ]] &amp;&amp; EXTRA_BSP_NAME=&quot;&quot;</span><br><span class="line">[[ -z $EXTRA_ROOTFS_MIB_SIZE ]] &amp;&amp; EXTRA_ROOTFS_MIB_SIZE=0</span><br><span class="line">[[ -z $BUILD_KSRC ]] &amp;&amp; BUILD_KSRC=&quot;no&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">single ext4 partition is the default and preferred configuration</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">BOOTFS_TYPE=<span class="string">&#x27;&#x27;</span></span></span><br><span class="line">[[ ! -f $&#123;EXTER&#125;/config/sources/families/$LINUXFAMILY.conf ]] &amp;&amp; \</span><br><span class="line">	exit_with_error &quot;Sources configuration not found&quot; &quot;$LINUXFAMILY&quot;</span><br><span class="line"></span><br><span class="line">source &quot;$&#123;EXTER&#125;/config/sources/families/$&#123;LINUXFAMILY&#125;.conf&quot;</span><br><span class="line"></span><br><span class="line">if [[ -f $USERPATCHES_PATH/sources/families/$LINUXFAMILY.conf ]]; then</span><br><span class="line">	display_alert &quot;Adding user provided $LINUXFAMILY overrides&quot;</span><br><span class="line">	source &quot;$USERPATCHES_PATH/sources/families/$&#123;LINUXFAMILY&#125;.conf&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">load architecture defaults</span></span><br><span class="line">source &quot;$&#123;EXTER&#125;/config/sources/$&#123;ARCH&#125;.conf&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Extensions: at this point we&#x27;ve sourced all the config files that will be used,</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#             and (hopefully) not yet invoked any extension methods. So this is the perfect</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#             place to initialize the extension manager. It will create functions</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#             like the &#x27;post_family_config&#x27; that is invoked below.</span></span></span><br><span class="line">initialize_extension_manager</span><br><span class="line"></span><br><span class="line">call_extension_method &quot;post_family_config&quot; &quot;config_tweaks_post_family_config&quot; &lt;&lt; &#x27;POST_FAMILY_CONFIG&#x27;</span><br><span class="line">*give the config a chance to override the family/arch defaults*</span><br><span class="line">This hook is called after the family configuration (`sources/families/xxx.conf`) is sourced.</span><br><span class="line">Since the family can override values from the user configuration and the board configuration,</span><br><span class="line">it is often used to in turn override those.</span><br><span class="line">POST_FAMILY_CONFIG</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Myy : Menu configuration <span class="keyword">for</span> choosing desktop configurations</span></span><br><span class="line"></span><br><span class="line">show_menu() &#123;</span><br><span class="line">	provided_title=$1</span><br><span class="line">	provided_backtitle=$2</span><br><span class="line">	provided_menuname=$3</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Myy : I don<span class="string">&#x27;t know why there&#x27;</span>s a TTY_Y - 8...</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;Provided title : <span class="variable">$provided_title</span>&quot;</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;Provided backtitle : <span class="variable">$provided_backtitle</span>&quot;</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;Provided menuname : <span class="variable">$provided_menuname</span>&quot;</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;Provided options : &quot;</span> <span class="string">&quot;<span class="variable">$&#123;@:4&#125;</span>&quot;</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;TTY X: <span class="variable">$TTY_X</span> Y: <span class="variable">$TTY_Y</span>&quot;</span></span></span><br><span class="line">	whiptail --title &quot;$&#123;provided_title&#125;&quot; --backtitle &quot;$&#123;provided_backtitle&#125;&quot; --notags \</span><br><span class="line">                          --menu &quot;$&#123;provided_menuname&#125;&quot; &quot;$&#123;TTY_Y&#125;&quot; &quot;$&#123;TTY_X&#125;&quot; $((TTY_Y - 8))  \</span><br><span class="line">			  &quot;$&#123;@:4&#125;&quot; \</span><br><span class="line">			  3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Myy : FIXME Factorize</span></span><br><span class="line">show_select_menu() &#123;</span><br><span class="line">	provided_title=$1</span><br><span class="line">	provided_backtitle=$2</span><br><span class="line">	provided_menuname=$3</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">dialog --stdout --title <span class="string">&quot;<span class="variable">$&#123;provided_title&#125;</span>&quot;</span> --backtitle <span class="string">&quot;<span class="variable">$&#123;provided_backtitle&#125;</span>&quot;</span> \</span></span><br><span class="line"><span class="language-bash">	<span class="comment">#--checklist &quot;$&#123;provided_menuname&#125;&quot; $TTY_Y $TTY_X $((TTY_Y - 8)) &quot;$&#123;@:4&#125;&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">whiptail --separate-output --title <span class="string">&quot;<span class="variable">$&#123;provided_title&#125;</span>&quot;</span> --backtitle <span class="string">&quot;<span class="variable">$&#123;provided_backtitle&#125;</span>&quot;</span> \</span></span><br><span class="line"><span class="language-bash">	<span class="comment">#                  --checklist &quot;$&#123;provided_menuname&#125;&quot; &quot;$&#123;TTY_Y&#125;&quot; &quot;$&#123;TTY_X&#125;&quot; $((TTY_Y - 8))  \</span></span></span><br><span class="line"><span class="language-bash">	<span class="comment">#		  &quot;$&#123;@:4&#125;&quot; \</span></span></span><br><span class="line"><span class="language-bash">	<span class="comment">#		  3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3</span></span></span><br><span class="line"></span><br><span class="line">	whiptail --title &quot;$&#123;provided_title&#125;&quot; --backtitle &quot;$&#123;provided_backtitle&#125;&quot; \</span><br><span class="line">	                  --checklist &quot;$&#123;provided_menuname&#125;&quot; &quot;$&#123;TTY_Y&#125;&quot; &quot;$&#123;TTY_X&#125;&quot; $((TTY_Y - 8))  \</span><br><span class="line">			  &quot;$&#123;@:4&#125;&quot; \</span><br><span class="line">			  3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Myy : Once we got a list of selected <span class="built_in">groups</span>, parse the PACKAGE_LIST inside configuration.sh</span></span><br><span class="line"></span><br><span class="line">DESKTOP_ELEMENTS_DIR=&quot;$&#123;EXTER&#125;/config/desktop/$&#123;RELEASE&#125;&quot;</span><br><span class="line">DESKTOP_CONFIGS_DIR=&quot;$&#123;DESKTOP_ELEMENTS_DIR&#125;/environments&quot;</span><br><span class="line">DESKTOP_CONFIG_PREFIX=&quot;config_&quot;</span><br><span class="line">DESKTOP_APPGROUPS_DIR=&quot;$&#123;DESKTOP_ELEMENTS_DIR&#125;/appgroups&quot;</span><br><span class="line"></span><br><span class="line">desktop_element_available_for_arch() &#123;</span><br><span class="line">	local desktop_element_path=&quot;$&#123;1&#125;&quot;</span><br><span class="line">	local targeted_arch=&quot;$&#123;2&#125;&quot;</span><br><span class="line"></span><br><span class="line">	local arch_limitation_file=&quot;$&#123;1&#125;/only_for&quot;</span><br><span class="line"></span><br><span class="line">	echo &quot;Checking if $&#123;desktop_element_path&#125; is available for $&#123;targeted_arch&#125; in $&#123;arch_limitation_file&#125;&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/output.log</span><br><span class="line">	if [[ -f &quot;$&#123;arch_limitation_file&#125;&quot; ]]; then</span><br><span class="line">		grep -- &quot;$&#123;targeted_arch&#125;&quot; &quot;$&#123;arch_limitation_file&#125;&quot; &gt; /dev/null</span><br><span class="line">		return $?</span><br><span class="line">	else</span><br><span class="line">		return 0</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">desktop_element_supported() &#123;</span><br><span class="line"></span><br><span class="line">	local desktop_element_path=&quot;$&#123;1&#125;&quot;</span><br><span class="line"></span><br><span class="line">	local support_level_filepath=&quot;$&#123;desktop_element_path&#125;/support&quot;</span><br><span class="line">	if [[ -f &quot;$&#123;support_level_filepath&#125;&quot; ]]; then</span><br><span class="line">		local support_level=&quot;$(cat &quot;$&#123;support_level_filepath&#125;&quot;)&quot;</span><br><span class="line">		if [[ &quot;$&#123;support_level&#125;&quot; != &quot;supported&quot; &amp;&amp; &quot;$&#123;EXPERT&#125;&quot; != &quot;yes&quot; ]]; then</span><br><span class="line">			return 65</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		desktop_element_available_for_arch &quot;$&#123;desktop_element_path&#125;&quot; &quot;$&#123;ARCH&#125;&quot;</span><br><span class="line">		if [[ $? -ne 0 ]]; then</span><br><span class="line">			return 66</span><br><span class="line">		fi</span><br><span class="line">	else</span><br><span class="line">		return 64</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	return 0</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if [[ $BUILD_DESKTOP == &quot;yes&quot; &amp;&amp; -z $DESKTOP_ENVIRONMENT ]]; then</span><br><span class="line"></span><br><span class="line">	desktop_environments_prepare_menu() &#123;</span><br><span class="line">		for desktop_env_dir in &quot;$&#123;DESKTOP_CONFIGS_DIR&#125;/&quot;*; do</span><br><span class="line">			local desktop_env_name=$(basename $&#123;desktop_env_dir&#125;)</span><br><span class="line">			local expert_infos=&quot;&quot;</span><br><span class="line">			[[ &quot;$&#123;EXPERT&#125;&quot; == &quot;yes&quot; ]] &amp;&amp; expert_infos=&quot;[$(cat &quot;$&#123;desktop_env_dir&#125;/support&quot; 2&gt; /dev/null)]&quot;</span><br><span class="line">			desktop_element_supported &quot;$&#123;desktop_env_dir&#125;&quot; &quot;$&#123;ARCH&#125;&quot; &amp;&amp; options+=(&quot;$&#123;desktop_env_name&#125;&quot; &quot;$&#123;desktop_env_name^&#125; desktop environment $&#123;expert_infos&#125;&quot;)</span><br><span class="line">		done</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	options=()</span><br><span class="line">	desktop_environments_prepare_menu</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$&#123;options[0]&#125;&quot; == &quot;&quot; ]]; then</span><br><span class="line">		exit_with_error &quot;No desktop environment seems to be available for your board $&#123;BOARD&#125; (ARCH : $&#123;ARCH&#125; - EXPERT : $&#123;EXPERT&#125;)&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	DESKTOP_ENVIRONMENT=$(show_menu &quot;Choose a desktop environment&quot; &quot;$backtitle&quot; &quot;Select the default desktop environment to bundle with this image&quot; &quot;$&#123;options[@]&#125;&quot;)</span><br><span class="line"></span><br><span class="line">	unset options</span><br><span class="line"></span><br><span class="line">	if [[ -z &quot;$&#123;DESKTOP_ENVIRONMENT&#125;&quot; ]]; then</span><br><span class="line">		exit_with_error &quot;No desktop environment selected...&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $BUILD_DESKTOP == &quot;yes&quot; ]]; then</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Expected environment variables :</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">- options</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">- ARCH</span></span><br><span class="line"></span><br><span class="line">	desktop_environment_check_if_valid() &#123;</span><br><span class="line"></span><br><span class="line">		local error_msg=&quot;&quot;</span><br><span class="line">		desktop_element_supported &quot;$&#123;DESKTOP_ENVIRONMENT_DIRPATH&#125;&quot; &quot;$&#123;ARCH&#125;&quot;</span><br><span class="line">		local retval=$?</span><br><span class="line"></span><br><span class="line">		if [[ $&#123;retval&#125; == 0 ]]; then</span><br><span class="line">			return</span><br><span class="line">		elif [[ $&#123;retval&#125; == 64 ]]; then</span><br><span class="line">			error_msg+=&quot;Either the desktop environment $&#123;DESKTOP_ENVIRONMENT&#125; does not exist &quot;</span><br><span class="line">			error_msg+=&quot;or the file $&#123;DESKTOP_ENVIRONMENT_DIRPATH&#125;/support is missing&quot;</span><br><span class="line">		elif [[ $&#123;retval&#125; == 65 ]]; then</span><br><span class="line">			error_msg+=&quot;Only experts can build an image with the desktop environment \&quot;$&#123;DESKTOP_ENVIRONMENT&#125;\&quot;, since the Armbian team won&#x27;t offer any support for it (EXPERT=$&#123;EXPERT&#125;)&quot;</span><br><span class="line">		elif [[ $&#123;retval&#125; == 66 ]]; then</span><br><span class="line">			error_msg+=&quot;The desktop environment \&quot;$&#123;DESKTOP_ENVIRONMENT&#125;\&quot; has no packages for your targeted board architecture (BOARD=$&#123;BOARD&#125; ARCH=$&#123;ARCH&#125;). &quot;</span><br><span class="line">			error_msg+=&quot;The supported boards architectures are : &quot;</span><br><span class="line">			error_msg+=&quot;$(cat &quot;$&#123;DESKTOP_ENVIRONMENT_DIRPATH&#125;/only_for&quot;)&quot;</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">supress error when cache is rebuilding</span></span><br><span class="line">		[[ -n &quot;$ROOT_FS_CREATE_ONLY&quot; ]] &amp;&amp; exit 0</span><br><span class="line"></span><br><span class="line">		exit_with_error &quot;$&#123;error_msg&#125;&quot;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	DESKTOP_ENVIRONMENT_DIRPATH=&quot;$&#123;DESKTOP_CONFIGS_DIR&#125;/$&#123;DESKTOP_ENVIRONMENT&#125;&quot;</span><br><span class="line"></span><br><span class="line">	desktop_environment_check_if_valid</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $BUILD_DESKTOP == &quot;yes&quot; &amp;&amp; -z $DESKTOP_ENVIRONMENT_CONFIG_NAME ]]; then</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">FIXME Check <span class="keyword">for</span> empty folders, just <span class="keyword">in</span> <span class="keyword">case</span> the current maintainer</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">messed up</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Note, we could also ignore it and don<span class="string">&#x27;t show anything in the previous</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">menu, but that hides information and make debugging harder, which I</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">don&#x27;</span>t like. Adding desktop environments as a maintainer is not a</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">trivial nor common task.</span></span><br><span class="line"></span><br><span class="line">	options=()</span><br><span class="line">	for configuration in &quot;$&#123;DESKTOP_ENVIRONMENT_DIRPATH&#125;/$&#123;DESKTOP_CONFIG_PREFIX&#125;&quot;*; do</span><br><span class="line">		config_filename=$(basename $&#123;configuration&#125;)</span><br><span class="line">		config_name=$&#123;config_filename#&quot;$&#123;DESKTOP_CONFIG_PREFIX&#125;&quot;&#125;</span><br><span class="line">		options+=(&quot;$&#123;config_filename&#125;&quot; &quot;$&#123;config_name&#125; configuration&quot;)</span><br><span class="line">	done</span><br><span class="line"></span><br><span class="line">	DESKTOP_ENVIRONMENT_CONFIG_NAME=$(show_menu &quot;Choose the desktop environment config&quot; &quot;$backtitle&quot; &quot;Select the configuration for this environment.\nThese are sourced from $&#123;desktop_environment_config_dir&#125;&quot; &quot;$&#123;options[@]&#125;&quot;)</span><br><span class="line">	unset options</span><br><span class="line"></span><br><span class="line">	if [[ -z $DESKTOP_ENVIRONMENT_CONFIG_NAME ]]; then</span><br><span class="line">		exit_with_error &quot;No desktop configuration selected... Do you really want a desktop environment ?&quot;</span><br><span class="line">	fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $BUILD_DESKTOP == &quot;yes&quot; ]]; then</span><br><span class="line">	DESKTOP_ENVIRONMENT_PACKAGE_LIST_DIRPATH=&quot;$&#123;DESKTOP_ENVIRONMENT_DIRPATH&#125;/$&#123;DESKTOP_ENVIRONMENT_CONFIG_NAME&#125;&quot;</span><br><span class="line">	DESKTOP_ENVIRONMENT_PACKAGE_LIST_FILEPATH=&quot;$&#123;DESKTOP_ENVIRONMENT_PACKAGE_LIST_DIRPATH&#125;/packages&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;-z <span class="variable">$&#123;VAR+x&#125;</span>&quot;</span> allows to check <span class="keyword">for</span> <span class="built_in">unset</span> variable</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Technically, someone might want to build a desktop with no additional</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">appgroups.</span></span><br><span class="line">if [[ $BUILD_DESKTOP == &quot;yes&quot; &amp;&amp; -z $&#123;DESKTOP_APPGROUPS_SELECTED+x&#125; &amp;&amp; $&#123;RELEASE&#125; != &quot;raspi&quot; ]]; then</span><br><span class="line"></span><br><span class="line">	options=()</span><br><span class="line">	for appgroup_path in &quot;$&#123;DESKTOP_APPGROUPS_DIR&#125;/&quot;*; do</span><br><span class="line">		appgroup=&quot;$(basename &quot;$&#123;appgroup_path&#125;&quot;)&quot;</span><br><span class="line">		options+=(&quot;$&#123;appgroup&#125;&quot; &quot;$&#123;appgroup^&#125;&quot; off)</span><br><span class="line">	done</span><br><span class="line"></span><br><span class="line">	DESKTOP_APPGROUPS_SELECTED=$(\</span><br><span class="line">		show_select_menu \</span><br><span class="line">		&quot;Choose desktop softwares to add&quot; \</span><br><span class="line">		&quot;$backtitle&quot; \</span><br><span class="line">		&quot;Select which kind of softwares you&#x27;d like to add to your build&quot; \</span><br><span class="line">		&quot;$&#123;options[@]&#125;&quot;)</span><br><span class="line"></span><br><span class="line">	DESKTOP_APPGROUPS_SELECTED=$&#123;DESKTOP_APPGROUPS_SELECTED//\&quot;/&#125;</span><br><span class="line"></span><br><span class="line">	unset options</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">exit_with_error <span class="string">&#x27;Testing&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Expected variables</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">- aggregated_content</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">- potential_paths</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">- separator</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Write to variables :</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">- aggregated_content</span></span><br><span class="line">aggregate_content() &#123;</span><br><span class="line">	LOG_OUTPUT_FILE=&quot;$&#123;SRC&#125;/output/$&#123;LOG_SUBPATH&#125;/potential-paths.log&quot;</span><br><span class="line">	echo -e &quot;Potential paths :&quot; &gt;&gt; &quot;$&#123;LOG_OUTPUT_FILE&#125;&quot;</span><br><span class="line">	show_checklist_variables potential_paths</span><br><span class="line">	for filepath in $&#123;potential_paths&#125;; do</span><br><span class="line">		if [[ -f &quot;$&#123;filepath&#125;&quot; ]]; then</span><br><span class="line">			echo -e &quot;$&#123;filepath/&quot;$EXTER&quot;\//&#125; yes&quot; &gt;&gt; &quot;$&#123;LOG_OUTPUT_FILE&#125;&quot;</span><br><span class="line">			aggregated_content+=$(cat &quot;$&#123;filepath&#125;&quot;)</span><br><span class="line">			aggregated_content+=&quot;$&#123;separator&#125;&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">		<span class="keyword">else</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">			<span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;filepath/&quot;$EXTER&quot;\//&#125;</span> no\n&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$&#123;LOG_OUTPUT_FILE&#125;</span>&quot;</span></span></span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">	done</span><br><span class="line">	echo &quot;&quot; &gt;&gt; &quot;$&#123;LOG_OUTPUT_FILE&#125;&quot;</span><br><span class="line">	unset LOG_OUTPUT_FILE</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">set</span> unique mounting directory</span></span><br><span class="line">MOUNT_UUID=$(uuidgen)</span><br><span class="line">SDCARD=&quot;$&#123;SRC&#125;/.tmp/rootfs-$&#123;MOUNT_UUID&#125;&quot;</span><br><span class="line">MOUNT=&quot;$&#123;SRC&#125;/.tmp/mount-$&#123;MOUNT_UUID&#125;&quot;</span><br><span class="line">DESTIMG=&quot;$&#123;SRC&#125;/.tmp/image-$&#123;MOUNT_UUID&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dropbear needs to be configured differently</span></span><br><span class="line">[[ $CRYPTROOT_ENABLE == yes &amp;&amp; $RELEASE == xenial ]] &amp;&amp; exit_with_error &quot;Encrypted rootfs is not supported in Xenial&quot;</span><br><span class="line">[[ $RELEASE == stretch &amp;&amp; $CAN_BUILD_STRETCH != yes ]] &amp;&amp; exit_with_error &quot;Building Debian Stretch images with selected kernel is not supported&quot;</span><br><span class="line">[[ $RELEASE == bionic &amp;&amp; $CAN_BUILD_STRETCH != yes ]] &amp;&amp; exit_with_error &quot;Building Ubuntu Bionic images with selected kernel is not supported&quot;</span><br><span class="line">[[ $RELEASE == hirsute &amp;&amp; $HOSTRELEASE == focal ]] &amp;&amp; exit_with_error &quot;Building Ubuntu Hirsute images requires Hirsute build host. Please upgrade your host or select a different target OS&quot;</span><br><span class="line"></span><br><span class="line">[[ -n $ATFSOURCE &amp;&amp; -z $ATF_USE_GCC ]] &amp;&amp; exit_with_error &quot;Error in configuration: ATF_USE_GCC is unset&quot;</span><br><span class="line">[[ -z $UBOOT_USE_GCC ]] &amp;&amp; exit_with_error &quot;Error in configuration: UBOOT_USE_GCC is unset&quot;</span><br><span class="line">[[ -z $KERNEL_USE_GCC ]] &amp;&amp; exit_with_error &quot;Error in configuration: KERNEL_USE_GCC is unset&quot;</span><br><span class="line"></span><br><span class="line">BOOTCONFIG_VAR_NAME=BOOTCONFIG_$&#123;BRANCH^^&#125;</span><br><span class="line">[[ -n $&#123;!BOOTCONFIG_VAR_NAME&#125; ]] &amp;&amp; BOOTCONFIG=$&#123;!BOOTCONFIG_VAR_NAME&#125;</span><br><span class="line">[[ -z $LINUXCONFIG ]] &amp;&amp; LINUXCONFIG=&quot;linux-$&#123;LINUXFAMILY&#125;-$&#123;BRANCH&#125;&quot;</span><br><span class="line">[[ -z $BOOTPATCHDIR ]] &amp;&amp; BOOTPATCHDIR=&quot;u-boot-$LINUXFAMILY&quot;</span><br><span class="line">[[ -z $ATFPATCHDIR ]] &amp;&amp; ATFPATCHDIR=&quot;atf-$LINUXFAMILY&quot;</span><br><span class="line">[[ -z $KERNELPATCHDIR ]] &amp;&amp; KERNELPATCHDIR=&quot;$LINUXFAMILY-$BRANCH&quot;</span><br><span class="line"></span><br><span class="line">if [[ &quot;$RELEASE&quot; =~ ^(xenial|bionic|focal|hirsute|impish|jammy)$ ]]; then</span><br><span class="line">		DISTRIBUTION=&quot;Ubuntu&quot;</span><br><span class="line">elif [[ &quot;$RELEASE&quot; == raspi ]]; then</span><br><span class="line">		DISTRIBUTION=&quot;Bullseye&quot;</span><br><span class="line">	else</span><br><span class="line">		DISTRIBUTION=&quot;Debian&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">CLI_CONFIG_PATH=&quot;$&#123;EXTER&#125;/config/cli/$&#123;RELEASE&#125;&quot;</span><br><span class="line">DEBOOTSTRAP_CONFIG_PATH=&quot;$&#123;CLI_CONFIG_PATH&#125;/debootstrap&quot;</span><br><span class="line"></span><br><span class="line">if [[ $? != 0 ]]; then</span><br><span class="line">	exit_with_error &quot;The desktop environment $&#123;DESKTOP_ENVIRONMENT&#125; is not available for your architecture $&#123;ARCH&#125;&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">AGGREGATION_SEARCH_ROOT_ABSOLUTE_DIRS=&quot;</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;EXTER&#125;/config</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;EXTER&#125;/config/optional/_any_board/_config</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;EXTER&#125;/config/optional/architectures/<span class="variable">$&#123;ARCH&#125;</span>/_config</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;EXTER&#125;/config/optional/families/<span class="variable">$&#123;LINUXFAMILY&#125;</span>/_config</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;EXTER&#125;/config/optional/boards/<span class="variable">$&#123;BOARD&#125;</span>/_config</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;USERPATCHES_PATH&#125;</span></span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line">DEBOOTSTRAP_SEARCH_RELATIVE_DIRS=&quot;</span><br><span class="line">cli/_all_distributions/debootstrap</span><br><span class="line"><span class="meta prompt_">cli/$</span><span class="language-bash">&#123;RELEASE&#125;/debootstrap</span></span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line">CLI_SEARCH_RELATIVE_DIRS=&quot;</span><br><span class="line">cli/_all_distributions/main</span><br><span class="line"><span class="meta prompt_">cli/$</span><span class="language-bash">&#123;RELEASE&#125;/main</span></span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line">PACKAGES_SEARCH_ROOT_ABSOLUTE_DIRS=&quot;</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;EXTER&#125;/packages</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;EXTER&#125;/config/optional/_any_board/_packages</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;EXTER&#125;/config/optional/architectures/<span class="variable">$&#123;ARCH&#125;</span>/_packages</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;EXTER&#125;/config/optional/families/<span class="variable">$&#123;LINUXFAMILY&#125;</span>/_packages</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;EXTER&#125;/config/optional/boards/<span class="variable">$&#123;BOARD&#125;</span>/_packages</span></span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line">DESKTOP_ENVIRONMENTS_SEARCH_RELATIVE_DIRS=&quot;</span><br><span class="line">desktop/_all_distributions/environments/_all_environments</span><br><span class="line"><span class="meta prompt_">desktop/_all_distributions/environments/$</span><span class="language-bash">&#123;DESKTOP_ENVIRONMENT&#125;</span></span><br><span class="line"><span class="meta prompt_">desktop/_all_distributions/environments/$</span><span class="language-bash">&#123;DESKTOP_ENVIRONMENT&#125;/<span class="variable">$&#123;DESKTOP_ENVIRONMENT_CONFIG_NAME&#125;</span></span></span><br><span class="line"><span class="meta prompt_">desktop/$</span><span class="language-bash">&#123;RELEASE&#125;/environments/_all_environments</span></span><br><span class="line"><span class="meta prompt_">desktop/$</span><span class="language-bash">&#123;RELEASE&#125;/environments/<span class="variable">$&#123;DESKTOP_ENVIRONMENT&#125;</span></span></span><br><span class="line"><span class="meta prompt_">desktop/$</span><span class="language-bash">&#123;RELEASE&#125;/environments/<span class="variable">$&#123;DESKTOP_ENVIRONMENT&#125;</span>/<span class="variable">$&#123;DESKTOP_ENVIRONMENT_CONFIG_NAME&#125;</span></span></span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line">DESKTOP_APPGROUPS_SEARCH_RELATIVE_DIRS=&quot;</span><br><span class="line">desktop/_all_distributions/appgroups</span><br><span class="line"><span class="meta prompt_">desktop/_all_distributions/environments/$</span><span class="language-bash">&#123;DESKTOP_ENVIRONMENT&#125;/appgroups</span></span><br><span class="line"><span class="meta prompt_">desktop/$</span><span class="language-bash">&#123;RELEASE&#125;/appgroups</span></span><br><span class="line"><span class="meta prompt_">desktop/$</span><span class="language-bash">&#123;RELEASE&#125;/environments/<span class="variable">$&#123;DESKTOP_ENVIRONMENT&#125;</span>/appgroups</span></span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line">get_all_potential_paths() &#123;</span><br><span class="line">	local root_dirs=&quot;$&#123;AGGREGATION_SEARCH_ROOT_ABSOLUTE_DIRS&#125;&quot;</span><br><span class="line">	local rel_dirs=&quot;$&#123;1&#125;&quot;</span><br><span class="line">	local sub_dirs=&quot;$&#123;2&#125;&quot;</span><br><span class="line">	local looked_up_subpath=&quot;$&#123;3&#125;&quot;</span><br><span class="line">	for root_dir in $&#123;root_dirs&#125;; do</span><br><span class="line">		for rel_dir in $&#123;rel_dirs&#125;; do</span><br><span class="line">			for sub_dir in $&#123;sub_dirs&#125;; do</span><br><span class="line">				potential_paths+=&quot;$&#123;root_dir&#125;/$&#123;rel_dir&#125;/$&#123;sub_dir&#125;/$&#123;looked_up_subpath&#125; &quot;</span><br><span class="line">			done</span><br><span class="line">		done</span><br><span class="line">	done</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="keyword">for</span> ppath <span class="keyword">in</span> <span class="variable">$&#123;potential_paths&#125;</span>; <span class="keyword">do</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"> 	<span class="built_in">echo</span> <span class="string">&quot;Checking for <span class="variable">$&#123;ppath&#125;</span>&quot;</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"> 	<span class="keyword">if</span> [[ -f <span class="string">&quot;<span class="variable">$&#123;ppath&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"> 		<span class="built_in">echo</span> <span class="string">&quot;OK !|&quot;</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"> 	<span class="keyword">else</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"> 		<span class="built_in">echo</span> <span class="string">&quot;Nope|&quot;</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"> 	<span class="keyword">fi</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="keyword">done</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Environment variables expected :</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">- aggregated_content</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Arguments :</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. File to look up <span class="keyword">in</span> each directory</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. The separator to add between each concatenated file</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. Relative directories paths added to <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4. Relative directories paths added to <span class="variable">$&#123;4&#125;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># The function will basically generate a list of potential paths by</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">generating all the potential paths combinations leading to the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">looked up file</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="variable">$&#123;AGGREGATION_SEARCH_ROOT_ABSOLUTE_DIRS&#125;</span>/<span class="variable">$&#123;3&#125;</span>/<span class="variable">$&#123;4&#125;</span>/<span class="variable">$&#123;1&#125;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Then it will concatenate the content of all the available files</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">into <span class="variable">$&#123;aggregated_content&#125;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># TODO :</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="variable">$&#123;4&#125;</span> could be removed by just adding the appropriate paths to <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dynamically <span class="keyword">for</span> each <span class="keyword">case</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">(debootstrap, cli, desktop environments, desktop appgroups, ...)</span></span><br><span class="line"></span><br><span class="line">aggregate_all_root_rel_sub() &#123;</span><br><span class="line">	local separator=&quot;$&#123;2&#125;&quot;</span><br><span class="line"></span><br><span class="line">	local potential_paths=&quot;&quot;</span><br><span class="line">	get_all_potential_paths &quot;$&#123;3&#125;&quot; &quot;$&#123;4&#125;&quot; &quot;$&#123;1&#125;&quot;</span><br><span class="line"></span><br><span class="line">	aggregate_content</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">aggregate_all_debootstrap() &#123;</span><br><span class="line">	local sub_dirs_to_check=&quot;. &quot;</span><br><span class="line">	if [[ ! -z &quot;$&#123;SELECTED_CONFIGURATION+x&#125;&quot; ]]; then</span><br><span class="line">		sub_dirs_to_check+=&quot;config_$&#123;SELECTED_CONFIGURATION&#125;&quot;</span><br><span class="line">	fi</span><br><span class="line">	aggregate_all_root_rel_sub &quot;$&#123;1&#125;&quot; &quot;$&#123;2&#125;&quot; &quot;$&#123;DEBOOTSTRAP_SEARCH_RELATIVE_DIRS&#125;&quot; &quot;$&#123;sub_dirs_to_check&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">aggregate_all_cli() &#123;</span><br><span class="line">	local sub_dirs_to_check=&quot;. &quot;</span><br><span class="line">	if [[ ! -z &quot;$&#123;SELECTED_CONFIGURATION+x&#125;&quot; ]]; then</span><br><span class="line">		sub_dirs_to_check+=&quot;config_$&#123;SELECTED_CONFIGURATION&#125;&quot;</span><br><span class="line">	fi</span><br><span class="line">	aggregate_all_root_rel_sub &quot;$&#123;1&#125;&quot; &quot;$&#123;2&#125;&quot; &quot;$&#123;CLI_SEARCH_RELATIVE_DIRS&#125;&quot; &quot;$&#123;sub_dirs_to_check&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">aggregate_all_desktop() &#123;</span><br><span class="line">	aggregate_all_root_rel_sub &quot;$&#123;1&#125;&quot; &quot;$&#123;2&#125;&quot; &quot;$&#123;DESKTOP_ENVIRONMENTS_SEARCH_RELATIVE_DIRS&#125;&quot; &quot;.&quot;</span><br><span class="line">	aggregate_all_root_rel_sub &quot;$&#123;1&#125;&quot; &quot;$&#123;2&#125;&quot; &quot;$&#123;DESKTOP_APPGROUPS_SEARCH_RELATIVE_DIRS&#125;&quot; &quot;$&#123;DESKTOP_APPGROUPS_SELECTED&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">one_line() &#123;</span><br><span class="line">	local aggregate_func_name=&quot;$&#123;1&#125;&quot;</span><br><span class="line">	local aggregated_content=&quot;&quot;</span><br><span class="line">	shift 1</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">aggregate_func_name <span class="string">&quot;<span class="variable">$&#123;@&#125;</span>&quot;</span></span></span><br><span class="line">	cleanup_list aggregated_content</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DEBOOTSTRAP_LIST=&quot;$(one_line aggregate_all_debootstrap &quot;packages&quot; &quot; &quot;)&quot;</span><br><span class="line">DEBOOTSTRAP_COMPONENTS=&quot;$(one_line aggregate_all_debootstrap &quot;components&quot; &quot; &quot;)&quot;</span><br><span class="line">DEBOOTSTRAP_COMPONENTS=&quot;$&#123;DEBOOTSTRAP_COMPONENTS// /,&#125;&quot;</span><br><span class="line">PACKAGE_LIST=&quot;$(one_line aggregate_all_cli &quot;packages&quot; &quot; &quot;)&quot;</span><br><span class="line">PACKAGE_LIST_ADDITIONAL=&quot;$(one_line aggregate_all_cli &quot;packages.additional&quot; &quot; &quot;)&quot;</span><br><span class="line"></span><br><span class="line">LOG_OUTPUT_FILE=&quot;$SRC/output/$&#123;LOG_SUBPATH&#125;/debootstrap-list.log&quot;</span><br><span class="line">show_checklist_variables &quot;DEBOOTSTRAP_LIST DEBOOTSTRAP_COMPONENTS PACKAGE_LIST PACKAGE_LIST_ADDITIONAL PACKAGE_LIST_UNINSTALL&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Dependent desktop packages</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Myy : Sources packages from file here</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Myy : FIXME Rename aggregate_all to aggregate_all_desktop</span></span><br><span class="line">if [[ $BUILD_DESKTOP == &quot;yes&quot; ]]; then</span><br><span class="line">	PACKAGE_LIST_DESKTOP+=&quot;$(one_line aggregate_all_desktop &quot;packages&quot; &quot; &quot;)&quot;</span><br><span class="line">	echo -e &quot;\nGroups selected $&#123;DESKTOP_APPGROUPS_SELECTED&#125; -&gt; PACKAGES :&quot; &gt;&gt; &quot;$&#123;LOG_OUTPUT_FILE&#125;&quot;</span><br><span class="line">	show_checklist_variables PACKAGE_LIST_DESKTOP</span><br><span class="line">fi</span><br><span class="line">unset LOG_OUTPUT_FILE</span><br><span class="line"></span><br><span class="line">DEBIAN_MIRROR=&#x27;deb.debian.org/debian&#x27;</span><br><span class="line">DEBIAN_SECURTY=&#x27;security.debian.org/&#x27;</span><br><span class="line">UBUNTU_MIRROR=&#x27;ports.ubuntu.com/&#x27;</span><br><span class="line">RASPI_MIRROR=&#x27;archive.raspberrypi.org/debian/&#x27;</span><br><span class="line"></span><br><span class="line">if [[ $DOWNLOAD_MIRROR == &quot;china&quot; ]] ; then</span><br><span class="line"></span><br><span class="line">	if [[ $&#123;CHINA_DOWNLOAD_MIRROR&#125; == tsinghua ]]; then</span><br><span class="line">		DEBIAN_MIRROR=&#x27;mirrors.tuna.tsinghua.edu.cn/debian&#x27;</span><br><span class="line">		DEBIAN_SECURTY=&#x27;mirrors.tuna.tsinghua.edu.cn/debian-security&#x27;</span><br><span class="line">		UBUNTU_MIRROR=&#x27;mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/&#x27;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ $&#123;CHINA_DOWNLOAD_MIRROR&#125; == huawei ]]; then</span><br><span class="line">		DEBIAN_MIRROR=&#x27;repo.huaweicloud.com/debian&#x27;</span><br><span class="line">		DEBIAN_SECURTY=&#x27;repo.huaweicloud.com/debian-security&#x27;</span><br><span class="line">		UBUNTU_MIRROR=&#x27;repo.huaweicloud.com/ubuntu-ports/&#x27;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	RASPI_MIRROR=&#x27;mirrors.ustc.edu.cn/archive.raspberrypi.org/debian/&#x27;</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $DOWNLOAD_MIRROR == &quot;bfsu&quot; ]] ; then</span><br><span class="line">	DEBIAN_MIRROR=&#x27;mirrors.bfsu.edu.cn/debian&#x27;</span><br><span class="line">	DEBIAN_SECURTY=&#x27;mirrors.bfsu.edu.cn/debian-security&#x27;</span><br><span class="line">	UBUNTU_MIRROR=&#x27;mirrors.bfsu.edu.cn/ubuntu-ports/&#x27;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ &quot;$&#123;ARCH&#125;&quot; == &quot;amd64&quot; ]]; then</span><br><span class="line">	UBUNTU_MIRROR=&#x27;archive.ubuntu.com/ubuntu&#x27; # ports are only for non-amd64, of course.</span><br><span class="line"></span><br><span class="line">		if [[ -n $&#123;CUSTOM_UBUNTU_MIRROR&#125; ]]; then # ubuntu redirector doesn&#x27;t work well on amd64</span><br><span class="line">			UBUNTU_MIRROR=&quot;$&#123;CUSTOM_UBUNTU_MIRROR&#125;&quot;</span><br><span class="line">		fi</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">don<span class="string">&#x27;t use mirrors that throws garbage on 404</span></span></span><br><span class="line">if [[ -z $&#123;ARMBIAN_MIRROR&#125; ]]; then</span><br><span class="line">	while true; do</span><br><span class="line"></span><br><span class="line">		ARMBIAN_MIRROR=$(wget -SO- -T 1 -t 1 https://redirect.armbian.com 2&gt;&amp;1 | egrep -i &quot;Location&quot; | awk &#x27;&#123;print $2&#125;&#x27; | head -1)</span><br><span class="line">		[[ $&#123;ARMBIAN_MIRROR&#125; != *armbian.hosthatch* ]] &amp;&amp; break</span><br><span class="line"></span><br><span class="line">	done</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">For (late) user override.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Notice: it is too late to define hook functions or add extensions in lib.config, since the extension initialization already ran by now.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">        in case the user tries to use them in lib.config, hopefully they&#x27;</span>ll be detected as <span class="string">&quot;wishful hooking&quot;</span> and the user will be wrn<span class="string">&#x27;ed.</span></span></span><br><span class="line">if [[ -f $USERPATCHES_PATH/lib.config ]]; then</span><br><span class="line">	display_alert &quot;Using user configuration override&quot; &quot;$USERPATCHES_PATH/lib.config&quot; &quot;info&quot;</span><br><span class="line">	source &quot;$USERPATCHES_PATH&quot;/lib.config</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">call_extension_method &quot;user_config&quot; &lt;&lt; &#x27;USER_CONFIG&#x27;</span><br><span class="line">*Invoke function with user override*</span><br><span class="line">Allows for overriding configuration values set anywhere else.</span><br><span class="line">It is called after sourcing the `lib.config` file if it exists,</span><br><span class="line">but before assembling any package lists.</span><br><span class="line">USER_CONFIG</span><br><span class="line"></span><br><span class="line">call_extension_method &quot;extension_prepare_config&quot; &lt;&lt; &#x27;EXTENSION_PREPARE_CONFIG&#x27;</span><br><span class="line">*allow extensions to prepare their own config, after user config is done*</span><br><span class="line">Implementors should preserve variable values pre-set, but can default values an/or validate them.</span><br><span class="line">This runs *after* user_config. Don&#x27;t change anything not coming from other variables or meant to be configured by the user.</span><br><span class="line">EXTENSION_PREPARE_CONFIG</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">apt-cacher-ng mirror configurarion</span></span></span><br><span class="line">if [[ $DISTRIBUTION == Ubuntu ]]; then</span><br><span class="line">	APT_MIRROR=$UBUNTU_MIRROR</span><br><span class="line">else</span><br><span class="line">	APT_MIRROR=$DEBIAN_MIRROR</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">[[ -n $APT_PROXY_ADDR ]] &amp;&amp; display_alert &quot;Using custom apt-cacher-ng address&quot; &quot;$APT_PROXY_ADDR&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Build final package list after possible override</span></span></span><br><span class="line">PACKAGE_LIST=&quot;$PACKAGE_LIST $PACKAGE_LIST_RELEASE $PACKAGE_LIST_ADDITIONAL&quot;</span><br><span class="line">PACKAGE_MAIN_LIST=&quot;$(cleanup_list PACKAGE_LIST)&quot;</span><br><span class="line"></span><br><span class="line">[[ $BUILD_DESKTOP == yes ]] &amp;&amp; PACKAGE_LIST=&quot;$PACKAGE_LIST $PACKAGE_LIST_DESKTOP&quot;</span><br><span class="line">PACKAGE_LIST=&quot;$(cleanup_list PACKAGE_LIST)&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">remove any packages defined in PACKAGE_LIST_RM in lib.config</span></span></span><br><span class="line">aggregated_content=&quot;$&#123;PACKAGE_LIST_RM&#125; &quot;</span><br><span class="line">aggregate_all_cli &quot;packages.remove&quot; &quot; &quot;</span><br><span class="line">aggregate_all_desktop &quot;packages.remove&quot; &quot; &quot;</span><br><span class="line">PACKAGE_LIST_RM=&quot;$(cleanup_list aggregated_content)&quot;</span><br><span class="line">unset aggregated_content</span><br><span class="line"></span><br><span class="line">aggregated_content=&quot;&quot;</span><br><span class="line">aggregate_all_cli &quot;packages.uninstall&quot; &quot; &quot;</span><br><span class="line">aggregate_all_desktop &quot;packages.uninstall&quot; &quot; &quot;</span><br><span class="line">PACKAGE_LIST_UNINSTALL=&quot;$(cleanup_list aggregated_content)&quot;</span><br><span class="line">unset aggregated_content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [[ -n $PACKAGE_LIST_RM ]]; then</span><br><span class="line">	display_alert &quot;Package remove list $&#123;PACKAGE_LIST_RM&#125;&quot;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Turns out that \b can be tricked by dashes.</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">So if you remove mesa-utils but still want to install &quot;mesa-utils-extra&quot;</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">a &quot;\b(mesa-utils)\b&quot; filter will convert &quot;mesa-utils-extra&quot; to &quot;-extra&quot;.</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">\W is not tricked by this but consumes the surrounding spaces, so we</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">replace the occurence by one space, to avoid sticking the next word to</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">the previous one after consuming the spaces.</span></span></span><br><span class="line">	DEBOOTSTRAP_LIST=$(sed -r &quot;s/\W($(tr &#x27; &#x27; &#x27;|&#x27; &lt;&lt;&lt; $&#123;PACKAGE_LIST_RM&#125;))\W/ /g&quot; &lt;&lt;&lt; &quot; $&#123;DEBOOTSTRAP_LIST&#125; &quot;)</span><br><span class="line">	PACKAGE_LIST=$(sed -r &quot;s/\W($(tr &#x27; &#x27; &#x27;|&#x27; &lt;&lt;&lt; $&#123;PACKAGE_LIST_RM&#125;))\W/ /g&quot; &lt;&lt;&lt; &quot; $&#123;PACKAGE_LIST&#125; &quot;)</span><br><span class="line">	PACKAGE_MAIN_LIST=$(sed -r &quot;s/\W($(tr &#x27; &#x27; &#x27;|&#x27; &lt;&lt;&lt; $&#123;PACKAGE_LIST_RM&#125;))\W/ /g&quot; &lt;&lt;&lt; &quot; $&#123;PACKAGE_MAIN_LIST&#125; &quot;)</span><br><span class="line">	if [[ $BUILD_DESKTOP == &quot;yes&quot; ]]; then</span><br><span class="line">		PACKAGE_LIST_DESKTOP=$(sed -r &quot;s/\W($(tr &#x27; &#x27; &#x27;|&#x27; &lt;&lt;&lt; $&#123;PACKAGE_LIST_RM&#125;))\W/ /g&quot; &lt;&lt;&lt; &quot; $&#123;PACKAGE_LIST_DESKTOP&#125; &quot;)</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">Removing double spaces... AGAIN, since we might have used a sed on them</span></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">Do not quote the variables. This would defeat the trick.</span></span></span><br><span class="line">		PACKAGE_LIST_DESKTOP=&quot;$(echo $&#123;PACKAGE_LIST_DESKTOP&#125;)&quot;</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Removing double spaces... AGAIN, since we might have used a sed on them</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Do not quote the variables. This would defeat the trick.</span></span></span><br><span class="line">	DEBOOTSTRAP_LIST=&quot;$(echo $&#123;DEBOOTSTRAP_LIST&#125;)&quot;</span><br><span class="line">	PACKAGE_LIST=&quot;$(echo $&#123;PACKAGE_LIST&#125;)&quot;</span><br><span class="line">	PACKAGE_MAIN_LIST=&quot;$(echo $&#123;PACKAGE_MAIN_LIST&#125;)&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LOG_OUTPUT_FILE=&quot;$SRC/output/$&#123;LOG_SUBPATH&#125;/debootstrap-list.log&quot;</span><br><span class="line">echo -e &quot;\nVariables after manual configuration&quot; &gt;&gt;$LOG_OUTPUT_FILE</span><br><span class="line">show_checklist_variables &quot;DEBOOTSTRAP_COMPONENTS DEBOOTSTRAP_LIST PACKAGE_LIST PACKAGE_MAIN_LIST&quot;</span><br><span class="line">unset LOG_OUTPUT_FILE</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Give the option to configure DNS server used in the chroot during the build process</span></span></span><br><span class="line">[[ -z $NAMESERVER ]] &amp;&amp; NAMESERVER=&quot;1.0.0.1&quot; # default is cloudflare alternate</span><br><span class="line"></span><br><span class="line">call_extension_method &quot;post_aggregate_packages&quot; &quot;user_config_post_aggregate_packages&quot; &lt;&lt; &#x27;POST_AGGREGATE_PACKAGES&#x27;</span><br><span class="line">*For final user override, using a function, after all aggregations are done*</span><br><span class="line">Called after aggregating all package lists, before the end of `compilation.sh`.</span><br><span class="line">Packages will still be installed after this is called, so it is the last chance</span><br><span class="line">to confirm or change any packages.</span><br><span class="line">POST_AGGREGATE_PACKAGES</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">debug</span></span></span><br><span class="line">cat &lt;&lt;-EOF &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/output.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"># BUILD SCRIPT ENVIRONMENT</span></span></span><br><span class="line"></span><br><span class="line">Repository: $REPOSITORY_URL</span><br><span class="line">Version: $REPOSITORY_COMMIT</span><br><span class="line"></span><br><span class="line">Host OS: $HOSTRELEASE</span><br><span class="line">Host arch: $(dpkg --print-architecture)</span><br><span class="line">Host system: $(uname -a)</span><br><span class="line">Virtualization type: $(systemd-detect-virt)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"># Build script directories</span></span></span><br><span class="line">Build directory is located on:</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="string">(findmnt -o TARGET,SOURCE,FSTYPE,AVAIL -T &quot;$&#123;SRC&#125;&quot;)</span></span></span><br><span class="line"></span><br><span class="line">Build directory permissions:</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="string">(getfacl -p &quot;$&#123;SRC&#125;&quot;)</span></span></span><br><span class="line"></span><br><span class="line">Temp directory permissions:</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="string">(getfacl -p &quot;$&#123;SRC&#125;&quot;/.tmp 2&gt; /dev/null)</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"># BUILD CONFIGURATION</span></span></span><br><span class="line"></span><br><span class="line">Build target:</span><br><span class="line">Board: $BOARD</span><br><span class="line">Branch: $BRANCH</span><br><span class="line">Minimal: $BUILD_MINIMAL</span><br><span class="line">Desktop: $BUILD_DESKTOP</span><br><span class="line">Desktop Environment: $DESKTOP_ENVIRONMENT</span><br><span class="line">Software groups: $DESKTOP_APPGROUPS_SELECTED</span><br><span class="line"></span><br><span class="line">Kernel configuration:</span><br><span class="line">Repository: $KERNELSOURCE</span><br><span class="line">Branch: $KERNELBRANCH</span><br><span class="line">Config file: $LINUXCONFIG</span><br><span class="line"></span><br><span class="line">U-boot configuration:</span><br><span class="line">Repository: $BOOTSOURCE</span><br><span class="line">Branch: $BOOTBRANCH</span><br><span class="line">Config file: $BOOTCONFIG</span><br><span class="line"></span><br><span class="line">Partitioning configuration: $IMAGE_PARTITION_TABLE offset: $OFFSET</span><br><span class="line">Boot partition type: $&#123;BOOTFS_TYPE:-(none)&#125; $&#123;BOOTSIZE:+&quot;($&#123;BOOTSIZE&#125; MB)&quot;&#125;</span><br><span class="line">Root partition type: $ROOTFS_TYPE $&#123;FIXED_IMAGE_SIZE:+&quot;($&#123;FIXED_IMAGE_SIZE&#125; MB)&quot;&#125;</span><br><span class="line"></span><br><span class="line">CPU configuration: $CPUMIN - $CPUMAX with $GOVERNOR</span><br><span class="line">EOF</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="5-debootstrap-ng-åˆ†æ"><a href="#5-debootstrap-ng-åˆ†æ" class="headerlink" title="5.debootstrap_ng åˆ†æ"></a>5.debootstrap_ng åˆ†æ</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Copyright (c) 2013-2021 Igor Pecovnik, igor.pecovnik@gma**.com</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This file is licensed under the terms of the GNU General Public</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">License version 2. This program is licensed <span class="string">&quot;as is&quot;</span> without any</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">warranty of any kind, whether express or implied.</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Functions:</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">debootstrap_ng</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">create_rootfs_cache</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">prepare_partitions</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">update_initramfs</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">create_image</span></span><br><span class="line"></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">debootstrap_ng</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">debootstrap_ng()</span></span><br><span class="line">&#123;</span><br><span class="line">	display_alert &quot;Starting rootfs and image building process for&quot; &quot;$&#123;BRANCH&#125; $&#123;BOARD&#125; $&#123;RELEASE&#125; $&#123;DESKTOP_APPGROUPS_SELECTED:-null&#125; $&#123;DESKTOP_ENVIRONMENT:-null&#125; $&#123;BUILD_MINIMAL&#125;&quot; &quot;info&quot;</span><br><span class="line"></span><br><span class="line">	[[ $ROOTFS_TYPE != ext4 ]] &amp;&amp; display_alert &quot;Assuming $BOARD $BRANCH kernel supports $ROOTFS_TYPE&quot; &quot;&quot; &quot;wrn&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="built_in">trap</span> to unmount stuff <span class="keyword">in</span> <span class="keyword">case</span> of error/manual interruption</span></span><br><span class="line">	trap unmount_on_exit INT TERM EXIT</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">stage: clean and create directories</span></span><br><span class="line">	rm -rf $SDCARD $MOUNT</span><br><span class="line">	mkdir -p $SDCARD $MOUNT $DEST/images $EXTER/cache/rootfs</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">stage: verify tmpfs configuration and mount</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">CLI needs ~1.5GiB, desktop - ~3.5GiB</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">calculate and <span class="built_in">set</span> tmpfs mount to use 9/10 of available RAM+SWAP</span></span><br><span class="line">	local phymem=$(( (($(awk &#x27;/MemTotal/ &#123;print $2&#125;&#x27; /proc/meminfo) + $(awk &#x27;/SwapTotal/ &#123;print $2&#125;&#x27; /proc/meminfo))) / 1024 * 9 / 10 )) # MiB</span><br><span class="line">	if [[ $BUILD_DESKTOP == yes ]]; then local tmpfs_max_size=3500; else local tmpfs_max_size=1500; fi # MiB</span><br><span class="line">	if [[ $FORCE_USE_RAMDISK == no ]]; then	local use_tmpfs=no</span><br><span class="line">	elif [[ $FORCE_USE_RAMDISK == yes || $phymem -gt $tmpfs_max_size ]]; then</span><br><span class="line">		local use_tmpfs=yes</span><br><span class="line">	fi</span><br><span class="line">	[[ -n $FORCE_TMPFS_SIZE ]] &amp;&amp; phymem=$FORCE_TMPFS_SIZE</span><br><span class="line"></span><br><span class="line">	[[ $use_tmpfs == yes ]] &amp;&amp; mount -t tmpfs -o size=$&#123;phymem&#125;M tmpfs $SDCARD</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">stage: prepare basic rootfs: unpack cache or create from scratch</span></span><br><span class="line">	create_rootfs_cache</span><br><span class="line"></span><br><span class="line">	call_extension_method &quot;pre_install_distribution_specific&quot; &quot;config_pre_install_distribution_specific&quot; &lt;&lt; &#x27;PRE_INSTALL_DISTRIBUTION_SPECIFIC&#x27;</span><br><span class="line">*give config a chance to act before install_distribution_specific*</span><br><span class="line">Called after `create_rootfs_cache` (_prepare basic rootfs: unpack cache or create from scratch_) but before `install_distribution_specific` (_install distribution and board specific applications_).</span><br><span class="line">PRE_INSTALL_DISTRIBUTION_SPECIFIC</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">stage: install kernel and u-boot packages</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">install distribution and board specific applications</span></span><br><span class="line"></span><br><span class="line">	if [[ $&#123;RELEASE&#125; == &quot;raspi&quot; ]]; then</span><br><span class="line">		install_opi_specific</span><br><span class="line">	else</span><br><span class="line">		install_distribution_specific</span><br><span class="line">		install_common</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">install locally built packages or install pre-built packages from orangepi</span></span><br><span class="line">		[[ $EXTERNAL_NEW == compile || $EXTERNAL_NEW == prebuilt ]] &amp;&amp; chroot_installpackages_local</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">[[ <span class="variable">$EXTERNAL_NEW</span> == prebuilt ]] &amp;&amp; chroot_installpackages <span class="string">&quot;yes&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">stage: user customization script</span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">NOTE: installing too many packages may fill tmpfs mount</span></span><br><span class="line">		customize_image</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">remove packages that are no longer needed. Since we have intrudoced uninstall feature, we might want to clean things that are no longer needed</span></span><br><span class="line">		display_alert &quot;No longer needed packages&quot; &quot;purge&quot; &quot;info&quot;</span><br><span class="line">		chroot $SDCARD /bin/bash -c &quot;apt-get autoremove -y&quot;  &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">create list of installed packages <span class="keyword">for</span> debug purposes</span></span><br><span class="line">		chroot $SDCARD /bin/bash -c &quot;dpkg --get-selections&quot; | grep -v deinstall | awk &#x27;&#123;print $1&#125;&#x27; | cut -f1 -d&#x27;:&#x27; &gt; $DEST/$&#123;LOG_SUBPATH&#125;/installed-packages-$&#123;RELEASE&#125;$([[ $&#123;BUILD_MINIMAL&#125; == yes ]] &amp;&amp; echo &quot;-minimal&quot;)$([[ $&#123;BUILD_DESKTOP&#125; == yes  ]] &amp;&amp; echo &quot;-desktop&quot;).list 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">clean up / prepare <span class="keyword">for</span> making the image</span></span><br><span class="line">	umount_chroot &quot;$SDCARD&quot;</span><br><span class="line">	post_debootstrap_tweaks</span><br><span class="line"></span><br><span class="line">	if [[ $ROOTFS_TYPE == fel ]]; then</span><br><span class="line">		FEL_ROOTFS=$SDCARD/</span><br><span class="line">		display_alert &quot;Starting FEL boot&quot; &quot;$BOARD&quot; &quot;info&quot;</span><br><span class="line">		source $SRC/scripts/fel-load.sh</span><br><span class="line">	else</span><br><span class="line">		prepare_partitions</span><br><span class="line">		create_image</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">stage: unmount tmpfs</span></span><br><span class="line">	umount $SDCARD 2&gt;&amp;1</span><br><span class="line">	if [[ $use_tmpfs = yes ]]; then</span><br><span class="line">		while grep -qs &quot;$SDCARD&quot; /proc/mounts</span><br><span class="line">		do</span><br><span class="line">			umount $SDCARD</span><br><span class="line">			sleep 5</span><br><span class="line">		done</span><br><span class="line">	fi</span><br><span class="line">	rm -rf $SDCARD</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">remove <span class="built_in">exit</span> <span class="built_in">trap</span></span></span><br><span class="line">	trap - INT TERM EXIT</span><br><span class="line">&#125; #############################################################################</span><br><span class="line"></span><br><span class="line">bootstrap()&#123;</span><br><span class="line">	local BOOTSTRAP_CMD=debootstrap</span><br><span class="line">	local BOOTSTRAP_ARGS=()</span><br><span class="line"></span><br><span class="line">	export CAPSH_ARG=&quot;--drop=cap_setfcap&quot;</span><br><span class="line">	export http_proxy=$&#123;APT_PROXY&#125;</span><br><span class="line"></span><br><span class="line">	BOOTSTRAP_ARGS+=(--arch arm64)</span><br><span class="line">	BOOTSTRAP_ARGS+=(--include gnupg)</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">BOOTSTRAP_ARGS+=(--components <span class="string">&quot;main,contrib,non-free&quot;</span>)</span></span><br><span class="line">	BOOTSTRAP_ARGS+=(--components &quot;main&quot;)</span><br><span class="line">	BOOTSTRAP_ARGS+=(--exclude=info)</span><br><span class="line">	BOOTSTRAP_ARGS+=(--include=ca-certificates)</span><br><span class="line">	BOOTSTRAP_ARGS+=(&quot;$@&quot;)</span><br><span class="line">	printf -v BOOTSTRAP_STR &#x27;%q &#x27; &quot;$&#123;BOOTSTRAP_ARGS[@]&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">&#123;BOOTSTRAP_CMD&#125; <span class="variable">$BOOTSTRAP_STR</span> || <span class="literal">true</span></span></span><br><span class="line">&#125;</span><br><span class="line">export -f bootstrap</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">create_rootfs_cache</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># unpacks cached rootfs for $RELEASE or creates one</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">create_rootfs_cache()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	local packages_hash=$(get_package_list_hash &quot;$ROOTFSCACHE_VERSION&quot;)</span><br><span class="line">	local cache_type=&quot;cli&quot;</span><br><span class="line">	[[ $&#123;BUILD_DESKTOP&#125; == yes ]] &amp;&amp; local cache_type=&quot;xfce-desktop&quot;</span><br><span class="line">	[[ -n $&#123;DESKTOP_ENVIRONMENT&#125; ]] &amp;&amp; local cache_type=&quot;$&#123;DESKTOP_ENVIRONMENT&#125;&quot;</span><br><span class="line">	[[ $&#123;BUILD_MINIMAL&#125; == yes ]] &amp;&amp; local cache_type=&quot;minimal&quot;</span><br><span class="line">	local cache_name=$&#123;RELEASE&#125;-$&#123;cache_type&#125;-$&#123;ARCH&#125;.$packages_hash.tar.lz4</span><br><span class="line">	local cache_fname=$&#123;EXTER&#125;/cache/rootfs/$&#123;cache_name&#125;</span><br><span class="line">	local display_name=$&#123;RELEASE&#125;-$&#123;cache_type&#125;-$&#123;ARCH&#125;.$&#123;packages_hash:0:3&#125;...$&#123;packages_hash:29&#125;.tar.lz4</span><br><span class="line"></span><br><span class="line">	if [[ -f $cache_fname &amp;&amp; &quot;$ROOT_FS_CREATE_ONLY&quot; != &quot;force&quot; ]]; then</span><br><span class="line">		local date_diff=$(( ($(date +%s) - $(stat -c %Y $cache_fname)) / 86400 ))</span><br><span class="line">		display_alert &quot;Extracting $display_name&quot; &quot;$date_diff days old&quot; &quot;info&quot;</span><br><span class="line">		pv -p -b -r -c -N &quot;[ .... ] $display_name&quot; &quot;$cache_fname&quot; | lz4 -dc | tar xp --xattrs -C $SDCARD/</span><br><span class="line">		[[ $? -ne 0 ]] &amp;&amp; rm $cache_fname &amp;&amp; exit_with_error &quot;Cache $cache_fname is corrupted and was deleted. Restart.&quot;</span><br><span class="line">		rm $SDCARD/etc/resolv.conf</span><br><span class="line">		echo &quot;nameserver $NAMESERVER&quot; &gt;&gt; $SDCARD/etc/resolv.conf</span><br><span class="line">		create_sources_list &quot;$RELEASE&quot; &quot;$SDCARD/&quot;</span><br><span class="line">	elif [[ $RELEASE == &quot;raspi&quot; ]]; then</span><br><span class="line">		display_alert &quot;local not found&quot; &quot;Creating new rootfs cache for $RELEASE&quot; &quot;info&quot;</span><br><span class="line"></span><br><span class="line">		cd $SDCARD # this will prevent error sh: 0: getcwd() failed</span><br><span class="line"></span><br><span class="line">		bootstrap bullseye &quot;$SDCARD&quot; &quot;https://mirrors.ustc.edu.cn/debian/&quot;</span><br><span class="line"></span><br><span class="line">		mount_chroot &quot;$SDCARD&quot;</span><br><span class="line"></span><br><span class="line">		display_alert &quot;Diverting&quot; &quot;initctl/start-stop-daemon&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">policy-rc.d script prevents starting or reloading services during image creation</span></span><br><span class="line">		printf &#x27;#!/bin/sh\nexit 101&#x27; &gt; $SDCARD/usr/sbin/policy-rc.d</span><br><span class="line">		LC_ALL=C LANG=C chroot $SDCARD /bin/bash -c &quot;dpkg-divert --quiet --local --rename --add /sbin/initctl&quot; &amp;&gt; /dev/null</span><br><span class="line">		LC_ALL=C LANG=C chroot $SDCARD /bin/bash -c &quot;dpkg-divert --quiet --local --rename --add /sbin/start-stop-daemon&quot; &amp;&gt; /dev/null</span><br><span class="line">		printf &#x27;#!/bin/sh\necho &quot;Warning: Fake start-stop-daemon called, doing nothing&quot;&#x27; &gt; $SDCARD/sbin/start-stop-daemon</span><br><span class="line">		printf &#x27;#!/bin/sh\necho &quot;Warning: Fake initctl called, doing nothing&quot;&#x27; &gt; $SDCARD/sbin/initctl</span><br><span class="line">		chmod 755 $SDCARD/usr/sbin/policy-rc.d</span><br><span class="line">		chmod 755 $SDCARD/sbin/initctl</span><br><span class="line">		chmod 755 $SDCARD/sbin/start-stop-daemon</span><br><span class="line"></span><br><span class="line">		install_raspi_specific</span><br><span class="line"></span><br><span class="line">		umount_chroot &quot;$SDCARD&quot;</span><br><span class="line"></span><br><span class="line">		tar cp --xattrs --directory=$SDCARD/ --exclude=&#x27;./dev/*&#x27; --exclude=&#x27;./proc/*&#x27; --exclude=&#x27;./run/*&#x27; --exclude=&#x27;./tmp/*&#x27; \</span><br><span class="line">			--exclude=&#x27;./sys/*&#x27; . | pv -p -b -r -s $(du -sb $SDCARD/ | cut -f1) -N &quot;$display_name&quot; | lz4 -5 -c &gt; $cache_fname</span><br><span class="line">	else</span><br><span class="line">		display_alert &quot;local not found&quot; &quot;Creating new rootfs cache for $RELEASE&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">stage: debootstrap base system</span></span><br><span class="line">		if [[ $NO_APT_CACHER != yes ]]; then</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">apt-cacher-ng apt-get proxy parameter</span></span><br><span class="line">			local apt_extra=&quot;-o Acquire::http::Proxy=\&quot;http://$&#123;APT_PROXY_ADDR:-localhost:3142&#125;\&quot;&quot;</span><br><span class="line">			local apt_mirror=&quot;http://$&#123;APT_PROXY_ADDR:-localhost:3142&#125;/$APT_MIRROR&quot;</span><br><span class="line">		else</span><br><span class="line">			local apt_mirror=&quot;http://$APT_MIRROR&quot;</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">fancy progress bars</span></span><br><span class="line">		[[ -z $OUTPUT_DIALOG ]] &amp;&amp; local apt_extra_progress=&quot;--show-progress -o DPKG::Progress-Fancy=1&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">Ok so <span class="keyword">for</span> <span class="built_in">eval</span>+PIPESTATUS.</span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">Try this on your bash shell:</span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">ONEVAR=<span class="string">&quot;testing&quot;</span> <span class="built_in">eval</span> <span class="string">&#x27;bash -c &quot;echo value once $ONEVAR &amp;&amp; false &amp;&amp; echo value twice $ONEVAR&quot;&#x27;</span> <span class="string">&#x27;| grep value&#x27;</span>  <span class="string">&#x27;| grep value&#x27;</span> ; <span class="built_in">echo</span> <span class="variable">$&#123;PIPESTATUS[*]&#125;</span></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">Notice how PIPESTATUS has only one element. and it is always <span class="literal">true</span>, although we failed explicitly with <span class="literal">false</span> <span class="keyword">in</span> the middle of the bash.</span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">That is because <span class="built_in">eval</span> itself is considered a single <span class="built_in">command</span>, no matter how many pipes you put <span class="keyword">in</span> there, you<span class="string">&#x27;ll get a single value, the return code of the LAST pipe.</span></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">Lets export the value of the pipe inside eval so we know outside what happened:</span></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">ONEVAR=&quot;testing&quot; eval &#x27;</span>bash -e -c <span class="string">&quot;echo value once <span class="variable">$ONEVAR</span> &amp;&amp; false &amp;&amp; echo value twice <span class="variable">$ONEVAR</span>&quot;</span><span class="string">&#x27; &#x27;</span>| grep value<span class="string">&#x27;  &#x27;</span>| grep value<span class="string">&#x27; &#x27;</span>;EVALPIPE=(<span class="variable">$&#123;PIPESTATUS[@]&#125;</span>)<span class="string">&#x27; ; echo $&#123;EVALPIPE[*]&#125;</span></span></span><br><span class="line"></span><br><span class="line">		display_alert &quot;Installing base system&quot; &quot;Stage 1/2&quot; &quot;info&quot;</span><br><span class="line">		cd $SDCARD # this will prevent error sh: 0: getcwd() failed</span><br><span class="line"></span><br><span class="line">		eval &#x27;debootstrap --variant=minbase --include=$&#123;DEBOOTSTRAP_LIST// /,&#125; $&#123;PACKAGE_LIST_EXCLUDE:+ --exclude=$&#123;PACKAGE_LIST_EXCLUDE// /,&#125;&#125; \</span><br><span class="line">			--arch=$ARCH --components=$&#123;DEBOOTSTRAP_COMPONENTS&#125; $DEBOOTSTRAP_OPTION --foreign $RELEASE $SDCARD/ $apt_mirror&#x27; \</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash"><span class="string">&#123;PROGRESS_LOG_TO_FILE:+&#x27;</span> | <span class="built_in">tee</span> -a <span class="variable">$DEST</span>/<span class="variable">$&#123;LOG_SUBPATH&#125;</span>/debootstrap.log<span class="string">&#x27;&#125; \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			$&#123;OUTPUT_DIALOG:+&#x27;</span> | dialog --backtitle <span class="string">&quot;<span class="variable">$backtitle</span>&quot;</span> --progressbox <span class="string">&quot;Debootstrap (stage 1/2)...&quot;</span> <span class="variable">$TTY_Y</span> <span class="variable">$TTY_X</span><span class="string">&#x27;&#125; \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			$&#123;OUTPUT_VERYSILENT:+&#x27;</span> &gt;/dev/null 2&gt;/dev/null<span class="string">&#x27;&#125; &#x27;</span>;EVALPIPE=(<span class="variable">$&#123;PIPESTATUS[@]&#125;</span>)<span class="string">&#x27;</span></span></span><br><span class="line"></span><br><span class="line">		[[ $&#123;EVALPIPE[0]&#125; -ne 0 || ! -f $SDCARD/debootstrap/debootstrap ]] &amp;&amp; exit_with_error &quot;Debootstrap base system for $&#123;BRANCH&#125; $&#123;BOARD&#125; $&#123;RELEASE&#125; $&#123;DESKTOP_APPGROUPS_SELECTED&#125; $&#123;DESKTOP_ENVIRONMENT&#125; $&#123;BUILD_MINIMAL&#125; first stage failed&quot;</span><br><span class="line"></span><br><span class="line">		cp /usr/bin/$QEMU_BINARY $SDCARD/usr/bin/</span><br><span class="line"></span><br><span class="line">		mkdir -p $SDCARD/usr/share/keyrings/</span><br><span class="line">		cp /usr/share/keyrings/*-archive-keyring.gpg $SDCARD/usr/share/keyrings/</span><br><span class="line"></span><br><span class="line">		display_alert &quot;Installing base system&quot; &quot;Stage 2/2&quot; &quot;info&quot;</span><br><span class="line">		eval &#x27;LC_ALL=C LANG=C chroot $SDCARD /bin/bash -e -c &quot;/debootstrap/debootstrap --second-stage&quot;&#x27; \</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash"><span class="string">&#123;PROGRESS_LOG_TO_FILE:+&#x27;</span> | <span class="built_in">tee</span> -a <span class="variable">$DEST</span>/<span class="variable">$&#123;LOG_SUBPATH&#125;</span>/debootstrap.log<span class="string">&#x27;&#125; \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			$&#123;OUTPUT_DIALOG:+&#x27;</span> | dialog --backtitle <span class="string">&quot;<span class="variable">$backtitle</span>&quot;</span> --progressbox <span class="string">&quot;Debootstrap (stage 2/2)...&quot;</span> <span class="variable">$TTY_Y</span> <span class="variable">$TTY_X</span><span class="string">&#x27;&#125; \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			$&#123;OUTPUT_VERYSILENT:+&#x27;</span> &gt;/dev/null 2&gt;/dev/null<span class="string">&#x27;&#125; &#x27;</span>;EVALPIPE=(<span class="variable">$&#123;PIPESTATUS[@]&#125;</span>)<span class="string">&#x27;</span></span></span><br><span class="line"></span><br><span class="line">		[[ $&#123;EVALPIPE[0]&#125; -ne 0 || ! -f $SDCARD/bin/bash ]] &amp;&amp; exit_with_error &quot;Debootstrap base system for $&#123;BRANCH&#125; $&#123;BOARD&#125; $&#123;RELEASE&#125; $&#123;DESKTOP_APPGROUPS_SELECTED&#125; $&#123;DESKTOP_ENVIRONMENT&#125; $&#123;BUILD_MINIMAL&#125; second stage failed&quot;</span><br><span class="line"></span><br><span class="line">		mount_chroot &quot;$SDCARD&quot;</span><br><span class="line"></span><br><span class="line">		display_alert &quot;Diverting&quot; &quot;initctl/start-stop-daemon&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">policy-rc.d script prevents starting or reloading services during image creation</span></span></span><br><span class="line">		printf &#x27;#!/bin/sh\nexit 101&#x27; &gt; $SDCARD/usr/sbin/policy-rc.d</span><br><span class="line">		LC_ALL=C LANG=C chroot $SDCARD /bin/bash -c &quot;dpkg-divert --quiet --local --rename --add /sbin/initctl&quot; &amp;&gt; /dev/null</span><br><span class="line">		LC_ALL=C LANG=C chroot $SDCARD /bin/bash -c &quot;dpkg-divert --quiet --local --rename --add /sbin/start-stop-daemon&quot; &amp;&gt; /dev/null</span><br><span class="line">		printf &#x27;#!/bin/sh\necho &quot;Warning: Fake start-stop-daemon called, doing nothing&quot;&#x27; &gt; $SDCARD/sbin/start-stop-daemon</span><br><span class="line">		printf &#x27;#!/bin/sh\necho &quot;Warning: Fake initctl called, doing nothing&quot;&#x27; &gt; $SDCARD/sbin/initctl</span><br><span class="line">		chmod 755 $SDCARD/usr/sbin/policy-rc.d</span><br><span class="line">		chmod 755 $SDCARD/sbin/initctl</span><br><span class="line">		chmod 755 $SDCARD/sbin/start-stop-daemon</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">stage: configure language and locales</span></span></span><br><span class="line">		display_alert &quot;Configuring locales&quot; &quot;$DEST_LANG&quot; &quot;info&quot;</span><br><span class="line"></span><br><span class="line">		[[ -f $SDCARD/etc/locale.gen ]] &amp;&amp; sed -i &quot;s/^# $DEST_LANG/$DEST_LANG/&quot; $SDCARD/etc/locale.gen</span><br><span class="line">		eval &#x27;LC_ALL=C LANG=C chroot $SDCARD /bin/bash -c &quot;locale-gen $DEST_LANG&quot;&#x27; $&#123;OUTPUT_VERYSILENT:+&#x27; &gt;/dev/null 2&gt;/dev/null&#x27;&#125;</span><br><span class="line">		eval &#x27;LC_ALL=C LANG=C chroot $SDCARD /bin/bash -c &quot;update-locale LANG=$DEST_LANG LANGUAGE=$DEST_LANG LC_MESSAGES=$DEST_LANG&quot;&#x27; \</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash"><span class="string">&#123;OUTPUT_VERYSILENT:+&#x27;</span> &gt;/dev/null 2&gt;/dev/null<span class="string">&#x27;&#125;</span></span></span><br><span class="line"></span><br><span class="line">		if [[ -f $SDCARD/etc/default/console-setup ]]; then</span><br><span class="line">			sed -e &#x27;s/CHARMAP=.*/CHARMAP=&quot;UTF-8&quot;/&#x27; -e &#x27;s/FONTSIZE=.*/FONTSIZE=&quot;8x16&quot;/&#x27; \</span><br><span class="line">				-e &#x27;s/CODESET=.*/CODESET=&quot;guess&quot;/&#x27; -i $SDCARD/etc/default/console-setup</span><br><span class="line">			eval &#x27;LC_ALL=C LANG=C chroot $SDCARD /bin/bash -c &quot;setupcon --save --force&quot;&#x27;</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">stage: create apt-get sources list</span></span></span><br><span class="line">		create_sources_list &quot;$RELEASE&quot; &quot;$SDCARD/&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">add armhf arhitecture to arm64, unless configured not to do so.</span></span></span><br><span class="line">		if [[ &quot;a$&#123;ARMHF_ARCH&#125;&quot; != &quot;askip&quot; ]]; then</span><br><span class="line">			[[ $ARCH == arm64 ]] &amp;&amp; eval &#x27;LC_ALL=C LANG=C chroot $SDCARD /bin/bash -c &quot;dpkg --add-architecture armhf&quot;&#x27;</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">this should fix resolvconf installation failure in some cases</span></span></span><br><span class="line">		chroot $SDCARD /bin/bash -c &#x27;echo &quot;resolvconf resolvconf/linkify-resolvconf boolean false&quot; | debconf-set-selections&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">stage: update packages list</span></span></span><br><span class="line">		display_alert &quot;Updating package list&quot; &quot;$RELEASE&quot; &quot;info&quot;</span><br><span class="line">		eval &#x27;LC_ALL=C LANG=C chroot $SDCARD /bin/bash -e -c &quot;apt-get -q -y $apt_extra update&quot;&#x27; \</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash"><span class="string">&#123;PROGRESS_LOG_TO_FILE:+&#x27;</span> | <span class="built_in">tee</span> -a <span class="variable">$DEST</span>/<span class="variable">$&#123;LOG_SUBPATH&#125;</span>/debootstrap.log<span class="string">&#x27;&#125; \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			$&#123;OUTPUT_DIALOG:+&#x27;</span> | dialog --backtitle <span class="string">&quot;<span class="variable">$backtitle</span>&quot;</span> --progressbox <span class="string">&quot;Updating package lists...&quot;</span> <span class="variable">$TTY_Y</span> <span class="variable">$TTY_X</span><span class="string">&#x27;&#125; \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			$&#123;OUTPUT_VERYSILENT:+&#x27;</span> &gt;/dev/null 2&gt;/dev/null<span class="string">&#x27;&#125; &#x27;</span>;EVALPIPE=(<span class="variable">$&#123;PIPESTATUS[@]&#125;</span>)<span class="string">&#x27;</span></span></span><br><span class="line"></span><br><span class="line">		[[ $&#123;EVALPIPE[0]&#125; -ne 0 ]] &amp;&amp; display_alert &quot;Updating package lists&quot; &quot;failed&quot; &quot;wrn&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">stage: upgrade base packages from xxx-updates and xxx-backports repository branches</span></span></span><br><span class="line">		display_alert &quot;Upgrading base packages&quot; &quot;Orange Pi&quot; &quot;info&quot;</span><br><span class="line">		eval &#x27;LC_ALL=C LANG=C chroot $SDCARD /bin/bash -e -c &quot;DEBIAN_FRONTEND=noninteractive apt-get -y -q \</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash"><span class="string">apt_extra $apt_extra_progress upgrade&quot;&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">			<span class="variable">$&#123;PROGRESS_LOG_TO_FILE:+&#x27; | tee -a $DEST/<span class="variable">$&#123;LOG_SUBPATH&#125;</span>/debootstrap.log&#x27;&#125;</span> \</span></span><br><span class="line"><span class="language-bash">			<span class="variable">$&#123;OUTPUT_DIALOG:+&#x27; | dialog --backtitle &quot;$backtitle&quot; --progressbox &quot;Upgrading base packages...&quot; $TTY_Y $TTY_X&#x27;&#125;</span> \</span></span><br><span class="line"><span class="language-bash">			<span class="variable">$&#123;OUTPUT_VERYSILENT:+&#x27; &gt;/dev/null 2&gt;/dev/null&#x27;&#125;</span> <span class="string">&#x27;;EVALPIPE=($&#123;PIPESTATUS[@]&#125;)&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">Myy: Dividing the desktop packages installation steps into multiple</span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">ones. We first install the <span class="string">&quot;ADDITIONAL_PACKAGES&quot;</span> <span class="keyword">in</span> order to get</span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">access to software-common-properties installation.</span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">THEN we add the APT sources and install the Desktop packages.</span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">TODO : Find a way to add APT sources WITHOUT software-common-properties</span></span><br><span class="line"></span><br><span class="line">		[[ $&#123;EVALPIPE[0]&#125; -ne 0 ]] &amp;&amp; display_alert &quot;Upgrading base packages&quot; &quot;failed&quot; &quot;wrn&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">stage: install additional packages</span></span><br><span class="line">		display_alert &quot;Installing the main packages for&quot; &quot;Orange Pi&quot; &quot;info&quot;</span><br><span class="line">		eval &#x27;LC_ALL=C LANG=C chroot $SDCARD /bin/bash -e -c &quot;DEBIAN_FRONTEND=noninteractive apt-get -y -q \</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash">apt_extra <span class="variable">$apt_extra_progress</span> --no-install-recommends install <span class="variable">$PACKAGE_MAIN_LIST</span><span class="string">&quot;&#x27; \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			<span class="variable">$&#123;PROGRESS_LOG_TO_FILE:+&#x27; | tee -a $DEST/<span class="variable">$&#123;LOG_SUBPATH&#125;</span>/debootstrap.log&#x27;&#125;</span> \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			<span class="variable">$&#123;OUTPUT_DIALOG:+&#x27; | dialog --backtitle &quot;$backtitle&quot; --progressbox &quot;Installing Orange Pi main packages...&quot; $TTY_Y $TTY_X&#x27;&#125;</span> \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			<span class="variable">$&#123;OUTPUT_VERYSILENT:+&#x27; &gt;/dev/null 2&gt;/dev/null&#x27;&#125;</span> &#x27;;EVALPIPE=(<span class="variable">$&#123;PIPESTATUS[@]&#125;</span>)&#x27;</span></span></span><br><span class="line"></span><br><span class="line">		[[ $&#123;PIPESTATUS[0]&#125; -ne 0 ]] &amp;&amp; exit_with_error &quot;Installation of Orange Pi main packages for $&#123;BRANCH&#125; $&#123;BOARD&#125; $&#123;RELEASE&#125; $&#123;DESKTOP_APPGROUPS_SELECTED&#125; $&#123;DESKTOP_ENVIRONMENT&#125; $&#123;BUILD_MINIMAL&#125; failed&quot;</span><br><span class="line"></span><br><span class="line">		if [[ $BUILD_DESKTOP == &quot;yes&quot; ]]; then</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">FIXME Myy : Are we keeping this only for Desktop users,</span></span></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">or should we extend this to CLI users too ?</span></span></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">There might be some clunky boards that require Debian packages from</span></span></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">specific repos...</span></span></span><br><span class="line">			display_alert &quot;Adding apt sources for Desktop packages&quot;</span><br><span class="line">			add_desktop_package_sources</span><br><span class="line"></span><br><span class="line">			local apt_desktop_install_flags=&quot;&quot;</span><br><span class="line">			if [[ ! -z $&#123;DESKTOP_APT_FLAGS_SELECTED+x&#125; ]]; then</span><br><span class="line">				for flag in $&#123;DESKTOP_APT_FLAGS_SELECTED&#125;; do</span><br><span class="line">					apt_desktop_install_flags+=&quot; --install-$&#123;flag&#125;&quot;</span><br><span class="line">				done</span><br><span class="line">			else</span><br><span class="line">				# Myy : Using the previous default option, if the variable isn&#x27;t defined</span><br><span class="line">				# And ONLY if it&#x27;s not defined !</span><br><span class="line">				apt_desktop_install_flags+=&quot; --no-install-recommends&quot;</span><br><span class="line">			fi</span><br><span class="line"></span><br><span class="line">			display_alert &quot;Installing the desktop packages for&quot; &quot;Orange Pi&quot; &quot;info&quot;</span><br><span class="line">			eval &#x27;LC_ALL=C LANG=C chroot $SDCARD /bin/bash -e -c &quot;DEBIAN_FRONTEND=noninteractive apt-get -y -q \</span><br><span class="line">				$apt_extra $apt_extra_progress install $&#123;apt_desktop_install_flags&#125; $PACKAGE_LIST_DESKTOP&quot;&#x27; \</span><br><span class="line">				$&#123;PROGRESS_LOG_TO_FILE:+&#x27; | tee -a $DEST/$&#123;LOG_SUBPATH&#125;/debootstrap.log&#x27;&#125; \</span><br><span class="line">				$&#123;OUTPUT_DIALOG:+&#x27; | dialog --backtitle &quot;$backtitle&quot; --progressbox &quot;Installing Orange Pi desktop packages...&quot; $TTY_Y $TTY_X&#x27;&#125; \</span><br><span class="line">				$&#123;OUTPUT_VERYSILENT:+&#x27; &gt;/dev/null 2&gt;/dev/null&#x27;&#125; &#x27;;EVALPIPE=($&#123;PIPESTATUS[@]&#125;)&#x27;</span><br><span class="line"></span><br><span class="line">			[[ $&#123;PIPESTATUS[0]&#125; -ne 0 ]] &amp;&amp; exit_with_error &quot;Installation of Orange Pi desktop packages for $&#123;BRANCH&#125; $&#123;BOARD&#125; $&#123;RELEASE&#125; $&#123;DESKTOP_APPGROUPS_SELECTED&#125; $&#123;DESKTOP_ENVIRONMENT&#125; $&#123;BUILD_MINIMAL&#125; failed&quot;</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">Remove packages from packages.uninstall</span></span></span><br><span class="line"></span><br><span class="line">		display_alert &quot;Uninstall packages&quot; &quot;$PACKAGE_LIST_UNINSTALL&quot; &quot;info&quot;</span><br><span class="line">		eval &#x27;LC_ALL=C LANG=C chroot $SDCARD /bin/bash -e -c &quot;DEBIAN_FRONTEND=noninteractive apt-get -y -qq \</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash"><span class="string">apt_extra <span class="variable">$apt_extra_progress</span> purge <span class="variable">$PACKAGE_LIST_UNINSTALL</span>&quot;</span><span class="string">&#x27; \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			$&#123;PROGRESS_LOG_TO_FILE:+&#x27;</span> &gt;&gt; <span class="variable">$DEST</span>/<span class="variable">$&#123;LOG_SUBPATH&#125;</span>/debootstrap.log<span class="string">&#x27;&#125; \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			$&#123;OUTPUT_DIALOG:+&#x27;</span> | dialog --backtitle <span class="string">&quot;<span class="variable">$backtitle</span>&quot;</span> --progressbox <span class="string">&quot;Removing packages.uninstall packages...&quot;</span> <span class="variable">$TTY_Y</span> <span class="variable">$TTY_X</span><span class="string">&#x27;&#125; \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			$&#123;OUTPUT_VERYSILENT:+&#x27;</span> &gt;/dev/null 2&gt;/dev/null<span class="string">&#x27;&#125; &#x27;</span>;EVALPIPE=(<span class="variable">$&#123;PIPESTATUS[@]&#125;</span>)<span class="string">&#x27;</span></span></span><br><span class="line"></span><br><span class="line">		[[ $&#123;EVALPIPE[0]&#125; -ne 0 ]] &amp;&amp; exit_with_error &quot;Installation of Orange Pi packages failed&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">stage: purge residual packages</span></span></span><br><span class="line">		display_alert &quot;Purging residual packages for&quot; &quot;Orange Pi&quot; &quot;info&quot;</span><br><span class="line">		PURGINGPACKAGES=$(chroot $SDCARD /bin/bash -c &quot;dpkg -l | grep \&quot;^rc\&quot; | awk &#x27;&#123;print \$2&#125;&#x27; | tr \&quot;\n\&quot; \&quot; \&quot;&quot;)</span><br><span class="line">		eval &#x27;LC_ALL=C LANG=C chroot $SDCARD /bin/bash -e -c &quot;DEBIAN_FRONTEND=noninteractive apt-get -y -q \</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash"><span class="string">apt_extra $apt_extra_progress remove --purge $PURGINGPACKAGES&quot;&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">			<span class="variable">$&#123;PROGRESS_LOG_TO_FILE:+&#x27; | tee -a $DEST/<span class="variable">$&#123;LOG_SUBPATH&#125;</span>/debootstrap.log&#x27;&#125;</span> \</span></span><br><span class="line"><span class="language-bash">			<span class="variable">$&#123;OUTPUT_DIALOG:+&#x27; | dialog --backtitle &quot;$backtitle&quot; --progressbox &quot;Purging residual Orange Pi packages...&quot; $TTY_Y $TTY_X&#x27;&#125;</span> \</span></span><br><span class="line"><span class="language-bash">			<span class="variable">$&#123;OUTPUT_VERYSILENT:+&#x27; &gt;/dev/null 2&gt;/dev/null&#x27;&#125;</span> <span class="string">&#x27;;EVALPIPE=($&#123;PIPESTATUS[@]&#125;)&#x27;</span></span></span><br><span class="line"></span><br><span class="line">		[[ $&#123;EVALPIPE[0]&#125; -ne 0 ]] &amp;&amp; exit_with_error &quot;Purging of residual Orange Pi packages failed&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">stage: remove downloaded packages</span></span><br><span class="line">		chroot $SDCARD /bin/bash -c &quot;apt-get -y autoremove; apt-get clean&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">DEBUG: <span class="built_in">print</span> free space</span></span><br><span class="line">		local freespace=$(LC_ALL=C df -h)</span><br><span class="line">		echo $freespace &gt;&gt; $DEST/$&#123;LOG_SUBPATH&#125;/debootstrap.log</span><br><span class="line">		display_alert &quot;Free SD cache&quot; &quot;$(echo -e &quot;$freespace&quot; | grep $SDCARD | awk &#x27;&#123;print $5&#125;&#x27;)&quot; &quot;info&quot;</span><br><span class="line">		display_alert &quot;Mount point&quot; &quot;$(echo -e &quot;$freespace&quot; | grep $MOUNT | head -1 | awk &#x27;&#123;print $5&#125;&#x27;)&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">create list of installed packages <span class="keyword">for</span> debug purposes</span></span><br><span class="line">		chroot $SDCARD /bin/bash -c &quot;dpkg --get-selections&quot; | grep -v deinstall | awk &#x27;&#123;print $1&#125;&#x27; | cut -f1 -d&#x27;:&#x27; &gt; $&#123;cache_fname&#125;.list 2&gt;&amp;1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">creating xapian index that synaptic runs faster</span></span><br><span class="line">		if [[ $BUILD_DESKTOP == yes ]]; then</span><br><span class="line">			display_alert &quot;Recreating Synaptic search index&quot; &quot;Please wait&quot; &quot;info&quot;</span><br><span class="line">			chroot $SDCARD /bin/bash -c &quot;[[ -f /usr/sbin/update-apt-xapian-index ]] &amp;&amp; /usr/sbin/update-apt-xapian-index -u&quot;</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">this is needed <span class="keyword">for</span> the build process later since resolvconf generated file <span class="keyword">in</span> /run is not saved</span></span><br><span class="line">		rm $SDCARD/etc/resolv.conf</span><br><span class="line">		echo &quot;nameserver $NAMESERVER&quot; &gt;&gt; $SDCARD/etc/resolv.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">stage: make rootfs cache archive</span></span><br><span class="line">		display_alert &quot;Ending debootstrap process and preparing cache&quot; &quot;$RELEASE&quot; &quot;info&quot;</span><br><span class="line">		sync</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">the only reason to unmount here is compression progress display</span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">based on rootfs size calculation</span></span><br><span class="line">		umount_chroot &quot;$SDCARD&quot;</span><br><span class="line"></span><br><span class="line">		tar cp --xattrs --directory=$SDCARD/ --exclude=&#x27;./dev/*&#x27; --exclude=&#x27;./proc/*&#x27; --exclude=&#x27;./run/*&#x27; --exclude=&#x27;./tmp/*&#x27; \</span><br><span class="line">			--exclude=&#x27;./sys/*&#x27; --exclude=&#x27;./home/*&#x27; --exclude=&#x27;./root/*&#x27; . | pv -p -b -r -s $(du -sb $SDCARD/ | cut -f1) -N &quot;$display_name&quot; | lz4 -5 -c &gt; $cache_fname</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">sign rootfs cache archive that it can be used <span class="keyword">for</span> web cache once. Internal purposes</span></span><br><span class="line">		if [[ -n &quot;$&#123;GPG_PASS&#125;&quot; &amp;&amp; &quot;$&#123;SUDO_USER&#125;&quot; ]]; then</span><br><span class="line">			[[ -n $&#123;SUDO_USER&#125; ]] &amp;&amp; sudo chown -R $&#123;SUDO_USER&#125;:$&#123;SUDO_USER&#125; &quot;$&#123;DEST&#125;&quot;/images/</span><br><span class="line">			echo &quot;$&#123;GPG_PASS&#125;&quot; | sudo -H -u $&#123;SUDO_USER&#125; bash -c &quot;gpg --passphrase-fd 0 --armor --detach-sign --pinentry-mode loopback --batch --yes $&#123;cache_fname&#125;&quot; || exit 1</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">needed <span class="keyword">for</span> backend to keep current only</span></span><br><span class="line">		touch $cache_fname.current</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">used <span class="keyword">for</span> internal purposes. Faster rootfs cache rebuilding</span></span><br><span class="line">	if [[ -n &quot;$ROOT_FS_CREATE_ONLY&quot; ]]; then</span><br><span class="line">		umount --lazy &quot;$SDCARD&quot;</span><br><span class="line">		rm -rf $SDCARD</span><br><span class="line"></span><br><span class="line">		display_alert &quot;Rootfs build done&quot; &quot;@host&quot; &quot;info&quot;</span><br><span class="line">		display_alert &quot;Target directory&quot; &quot;$&#123;EXTER&#125;/cache/rootfs&quot; &quot;info&quot;</span><br><span class="line">		display_alert &quot;File name&quot; &quot;$&#123;cache_name&#125;&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">remove <span class="built_in">exit</span> <span class="built_in">trap</span></span></span><br><span class="line">		trap - INT TERM EXIT</span><br><span class="line">        exit</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	mount_chroot &quot;$SDCARD&quot;</span><br><span class="line">&#125; #############################################################################</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">prepare_partitions</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># creates image file, partitions and fs</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">and mounts it to <span class="built_in">local</span> <span class="built_in">dir</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">FS-dependent stuff (boot and root fs partition types) happens here</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="function"><span class="title">prepare_partitions</span></span>() &#123;</span></span><br><span class="line">	display_alert &quot;Preparing image file for rootfs&quot; &quot;$BOARD $RELEASE&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">possible partition combinations</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">/boot: none, ext4, ext2, fat (BOOTFS_TYPE)</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">root: ext4, btrfs, f2fs, nfs (ROOTFS_TYPE)</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="built_in">declare</span> makes <span class="built_in">local</span> variables by default <span class="keyword">if</span> used inside a <span class="keyword">function</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">NOTE: mountopts string should always start with comma <span class="keyword">if</span> not empty</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">array copying <span class="keyword">in</span> old bash versions is tricky, so having filesystems as arrays</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">with attributes as keys is not a good idea</span></span><br><span class="line">	declare -A parttype mkopts mkopts_label mkfs mountopts</span><br><span class="line"></span><br><span class="line">	parttype[ext4]=ext4</span><br><span class="line">	parttype[ext2]=ext2</span><br><span class="line">	parttype[fat]=fat16</span><br><span class="line">	parttype[f2fs]=ext4 # not a copy-paste error</span><br><span class="line">	parttype[btrfs]=btrfs</span><br><span class="line">	parttype[xfs]=xfs</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">parttype[nfs] is empty</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">metadata_csum and 64bit may need to be disabled explicitly when migrating to newer supported host OS releases</span></span><br><span class="line">	if [[ $HOSTRELEASE =~ buster|bullseye|bookworm|bionic|focal|jammy|kinetic|sid ]]; then</span><br><span class="line">		mkopts[ext4]=&quot;-q -m 2 -O ^64bit,^metadata_csum&quot;</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">mkopts[fat] is empty</span></span><br><span class="line">	mkopts[ext2]=&#x27;-q&#x27;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">mkopts[f2fs] is empty</span></span><br><span class="line">	mkopts[btrfs]=&#x27;-m dup&#x27;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">mkopts[xfs] is empty</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">mkopts[nfs] is empty</span></span><br><span class="line"></span><br><span class="line">	mkopts_label[ext4]=&#x27;-L &#x27;</span><br><span class="line">	mkopts_label[ext2]=&#x27;-L &#x27;</span><br><span class="line">	mkopts_label[fat]=&#x27;-n &#x27;</span><br><span class="line">	mkopts_label[f2fs]=&#x27;-l &#x27;</span><br><span class="line">	mkopts_label[btrfs]=&#x27;-L &#x27;</span><br><span class="line">	mkopts_label[xfs]=&#x27;-L &#x27;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">mkopts_label[nfs] is empty</span></span><br><span class="line"></span><br><span class="line">	mkfs[ext4]=ext4</span><br><span class="line">	mkfs[ext2]=ext2</span><br><span class="line">	mkfs[fat]=vfat</span><br><span class="line">	mkfs[f2fs]=f2fs</span><br><span class="line">	mkfs[btrfs]=btrfs</span><br><span class="line">	mkfs[xfs]=xfs</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">mkfs[nfs] is empty</span></span><br><span class="line"></span><br><span class="line">	mountopts[ext4]=&#x27;,commit=600,errors=remount-ro&#x27;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">mountopts[ext2] is empty</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">mountopts[fat] is empty</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">mountopts[f2fs] is empty</span></span><br><span class="line">	mountopts[btrfs]=&#x27;,commit=600&#x27;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">mountopts[xfs] is empty</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">mountopts[nfs] is empty</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">default BOOTSIZE to use <span class="keyword">if</span> not specified</span></span><br><span class="line">	DEFAULT_BOOTSIZE=1024 # MiB</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">size of UEFI partition. 0 <span class="keyword">for</span> no UEFI. Don<span class="string">&#x27;t mix UEFISIZE&gt;0 and BOOTSIZE&gt;0</span></span></span><br><span class="line">	UEFISIZE=$&#123;UEFISIZE:-0&#125;</span><br><span class="line">	BIOSSIZE=$&#123;BIOSSIZE:-0&#125;</span><br><span class="line">	UEFI_MOUNT_POINT=$&#123;UEFI_MOUNT_POINT:-/boot/efi&#125;</span><br><span class="line">	UEFI_FS_LABEL=&quot;$&#123;UEFI_FS_LABEL:-opi_efi&#125;&quot;</span><br><span class="line">	ROOT_FS_LABEL=&quot;$&#123;ROOT_FS_LABEL:-opi_root&#125;&quot;</span><br><span class="line">	BOOT_FS_LABEL=&quot;$&#123;BOOT_FS_LABEL:-opi_boot&#125;&quot;</span><br><span class="line"></span><br><span class="line">	call_extension_method &quot;pre_prepare_partitions&quot; &quot;prepare_partitions_custom&quot; &lt;&lt; &#x27;PRE_PREPARE_PARTITIONS&#x27;</span><br><span class="line">*allow custom options for mkfs*</span><br><span class="line">Good time to change stuff like mkfs opts, types etc.</span><br><span class="line">PRE_PREPARE_PARTITIONS</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">stage: determine partition configuration</span></span></span><br><span class="line">	local next=1</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Check if we need UEFI partition</span></span></span><br><span class="line">	if [[ $UEFISIZE -gt 0 ]]; then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">Check if we need BIOS partition</span></span></span><br><span class="line">		[[ $BIOSSIZE -gt 0 ]] &amp;&amp; local biospart=$((next++))</span><br><span class="line">		local uefipart=$((next++))</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Check if we need boot partition</span></span></span><br><span class="line">	if [[ -n $BOOTFS_TYPE || $ROOTFS_TYPE != ext4 || $CRYPTROOT_ENABLE == yes ]]; then</span><br><span class="line">		local bootpart=$((next++))</span><br><span class="line">		local bootfs=$&#123;BOOTFS_TYPE:-ext4&#125;</span><br><span class="line">		[[ -z $BOOTSIZE || $BOOTSIZE -le 8 ]] &amp;&amp; BOOTSIZE=$&#123;DEFAULT_BOOTSIZE&#125;</span><br><span class="line">	else</span><br><span class="line">		BOOTSIZE=0</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Check if we need root partition</span></span></span><br><span class="line">	[[ $ROOTFS_TYPE != nfs ]] &amp;&amp;</span><br><span class="line">		local rootpart=$((next++))</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">stage: calculate rootfs size</span></span></span><br><span class="line">	export rootfs_size=$(du -sm $SDCARD/ | cut -f1) # MiB</span><br><span class="line">	display_alert &quot;Current rootfs size&quot; &quot;$rootfs_size MiB&quot; &quot;info&quot;</span><br><span class="line"></span><br><span class="line">	call_extension_method &quot;prepare_image_size&quot; &quot;config_prepare_image_size&quot; &lt;&lt; &#x27;PREPARE_IMAGE_SIZE&#x27;</span><br><span class="line">*allow dynamically determining the size based on the $rootfs_size*</span><br><span class="line">Called after `$&#123;rootfs_size&#125;` is known, but before `$&#123;FIXED_IMAGE_SIZE&#125;` is taken into account.</span><br><span class="line">A good spot to determine `FIXED_IMAGE_SIZE` based on `rootfs_size`.</span><br><span class="line">UEFISIZE can be set to 0 for no UEFI partition, or to a size in MiB to include one.</span><br><span class="line">Last chance to set `USE_HOOK_FOR_PARTITION`=yes and then implement create_partition_table hook_point.</span><br><span class="line">PREPARE_IMAGE_SIZE</span><br><span class="line"></span><br><span class="line">	if [[ -n $FIXED_IMAGE_SIZE &amp;&amp; $FIXED_IMAGE_SIZE =~ ^[0-9]+$ ]]; then</span><br><span class="line">		display_alert &quot;Using user-defined image size&quot; &quot;$FIXED_IMAGE_SIZE MiB&quot; &quot;info&quot;</span><br><span class="line">		local sdsize=$FIXED_IMAGE_SIZE</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">basic sanity check</span></span></span><br><span class="line">		if [[ $ROOTFS_TYPE != nfs &amp;&amp; $sdsize -lt $rootfs_size ]]; then</span><br><span class="line">			exit_with_error &quot;User defined image size is too small&quot; &quot;$sdsize &lt;= $rootfs_size&quot;</span><br><span class="line">		fi</span><br><span class="line">	else</span><br><span class="line">		local imagesize=$(($rootfs_size + $OFFSET + $BOOTSIZE + $UEFISIZE + $EXTRA_ROOTFS_MIB_SIZE)) # MiB</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">Hardcoded overhead +25% is needed for desktop images,</span></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">for CLI it could be lower. Align the size up to 4MiB</span></span></span><br><span class="line">		if [[ $BUILD_DESKTOP == yes ]]; then</span><br><span class="line">			local sdsize=$(bc -l &lt;&lt;&lt; &quot;scale=0; ((($imagesize * 1.35) / 1 + 0) / 4 + 1) * 4&quot;)</span><br><span class="line">		else</span><br><span class="line">			local sdsize=$(bc -l &lt;&lt;&lt; &quot;scale=0; ((($imagesize * 1.30) / 1 + 0) / 4 + 1) * 4&quot;)</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">stage: create blank image</span></span></span><br><span class="line">	display_alert &quot;Creating blank image for rootfs&quot; &quot;$sdsize MiB&quot; &quot;info&quot;</span><br><span class="line">	if [[ $FAST_CREATE_IMAGE == yes ]]; then</span><br><span class="line">		truncate --size=$&#123;sdsize&#125;M $&#123;SDCARD&#125;.raw # sometimes results in fs corruption, revert to previous know to work solution</span><br><span class="line">		sync</span><br><span class="line">	else</span><br><span class="line">		dd if=/dev/zero bs=1M status=none count=$sdsize | pv -p -b -r -s $(($sdsize * 1024 * 1024)) -N &quot;[ .... ] dd&quot; | dd status=none of=$&#123;SDCARD&#125;.raw</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">stage: create partition table</span></span></span><br><span class="line">	display_alert &quot;Creating partitions&quot; &quot;$&#123;bootfs:+/boot: $bootfs &#125;root: $ROOTFS_TYPE&quot; &quot;info&quot;</span><br><span class="line">	if [[ &quot;$&#123;USE_HOOK_FOR_PARTITION&#125;&quot; == &quot;yes&quot; ]]; then</span><br><span class="line">		&#123;</span><br><span class="line">			[[ &quot;$IMAGE_PARTITION_TABLE&quot; == &quot;msdos&quot; ]] &amp;&amp;</span><br><span class="line">				echo &quot;label: dos&quot; ||</span><br><span class="line">				echo &quot;label: $IMAGE_PARTITION_TABLE&quot;</span><br><span class="line">		&#125; | sfdisk $&#123;SDCARD&#125;.raw &gt;&gt; &quot;$&#123;DEST&#125;/$&#123;LOG_SUBPATH&#125;/install.log&quot; 2&gt;&amp;1 ||</span><br><span class="line">			exit_with_error &quot;Create partition table fail. Please check&quot; &quot;$&#123;DEST&#125;/$&#123;LOG_SUBPATH&#125;/install.log&quot;</span><br><span class="line"></span><br><span class="line">		call_extension_method &quot;create_partition_table&quot; &lt;&lt;- &#x27;CREATE_PARTITION_TABLE&#x27;</span><br><span class="line">			*only called when USE_HOOK_FOR_PARTITION=yes to create the complete partition table*</span><br><span class="line">			Finally, we can get our own partition table. You have to partition $&#123;SDCARD&#125;.raw</span><br><span class="line">			yourself. Good luck.</span><br><span class="line">		CREATE_PARTITION_TABLE</span><br><span class="line">	else</span><br><span class="line">		&#123;</span><br><span class="line">			[[ &quot;$IMAGE_PARTITION_TABLE&quot; == &quot;msdos&quot; ]] &amp;&amp;</span><br><span class="line">				echo &quot;label: dos&quot; ||</span><br><span class="line">				echo &quot;label: $IMAGE_PARTITION_TABLE&quot;</span><br><span class="line"></span><br><span class="line">			local next=$OFFSET</span><br><span class="line">			if [[ -n &quot;$biospart&quot; ]]; then</span><br><span class="line">				# gpt: BIOS boot</span><br><span class="line">				local type=&quot;21686148-6449-6E6F-744E-656564454649&quot;</span><br><span class="line">				echo &quot;$biospart : name=\&quot;bios\&quot;, start=$&#123;next&#125;MiB, size=$&#123;BIOSSIZE&#125;MiB, type=$&#123;type&#125;&quot;</span><br><span class="line">				local next=$(($next + $BIOSSIZE))</span><br><span class="line">			fi</span><br><span class="line">			if [[ -n &quot;$uefipart&quot; ]]; then</span><br><span class="line">				# dos: EFI (FAT-12/16/32)</span><br><span class="line">				# gpt: EFI System</span><br><span class="line">				[[ &quot;$IMAGE_PARTITION_TABLE&quot; != &quot;gpt&quot; ]] &amp;&amp;</span><br><span class="line">					local type=&quot;ef&quot; ||</span><br><span class="line">					local type=&quot;C12A7328-F81F-11D2-BA4B-00A0C93EC93B&quot;</span><br><span class="line">				echo &quot;$uefipart : name=\&quot;efi\&quot;, start=$&#123;next&#125;MiB, size=$&#123;UEFISIZE&#125;MiB, type=$&#123;type&#125;&quot;</span><br><span class="line">				local next=$(($next + $UEFISIZE))</span><br><span class="line">			fi</span><br><span class="line">			if [[ -n &quot;$bootpart&quot; ]]; then</span><br><span class="line">				# Linux extended boot</span><br><span class="line">				[[ &quot;$IMAGE_PARTITION_TABLE&quot; != &quot;gpt&quot; ]] &amp;&amp;</span><br><span class="line">					local type=&quot;ea&quot; ||</span><br><span class="line">					local type=&quot;BC13C2FF-59E6-4262-A352-B275FD6F7172&quot;</span><br><span class="line">				if [[ -n &quot;$rootpart&quot; ]]; then</span><br><span class="line">					echo &quot;$bootpart : name=\&quot;bootfs\&quot;, start=$&#123;next&#125;MiB, size=$&#123;BOOTSIZE&#125;MiB, type=$&#123;type&#125;&quot;</span><br><span class="line">					local next=$(($next + $BOOTSIZE))</span><br><span class="line">				else</span><br><span class="line">					# no `size` argument mean &quot;as much as possible&quot;</span><br><span class="line">					echo &quot;$bootpart : name=\&quot;bootfs\&quot;, start=$&#123;next&#125;MiB, type=$&#123;type&#125;&quot;</span><br><span class="line">				fi</span><br><span class="line">			fi</span><br><span class="line">			if [[ -n &quot;$rootpart&quot; ]]; then</span><br><span class="line">				# dos: Linux</span><br><span class="line">				# gpt: Linux filesystem</span><br><span class="line">				[[ &quot;$IMAGE_PARTITION_TABLE&quot; != &quot;gpt&quot; ]] &amp;&amp;</span><br><span class="line">					local type=&quot;83&quot; ||</span><br><span class="line">					local type=&quot;0FC63DAF-8483-4772-8E79-3D69D8477DE4&quot;</span><br><span class="line">				# no `size` argument mean &quot;as much as possible&quot;</span><br><span class="line">				echo &quot;$rootpart : name=\&quot;rootfs\&quot;, start=$&#123;next&#125;MiB, type=$&#123;type&#125;&quot;</span><br><span class="line">			fi</span><br><span class="line">		&#125; | sfdisk $&#123;SDCARD&#125;.raw &gt;&gt; &quot;$&#123;DEST&#125;/$&#123;LOG_SUBPATH&#125;/install.log&quot; 2&gt;&amp;1 ||</span><br><span class="line">			exit_with_error &quot;Partition fail. Please check&quot; &quot;$&#123;DEST&#125;/$&#123;LOG_SUBPATH&#125;/install.log&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	call_extension_method &quot;post_create_partitions&quot; &lt;&lt;- &#x27;POST_CREATE_PARTITIONS&#x27;</span><br><span class="line">		*called after all partitions are created, but not yet formatted*</span><br><span class="line">	POST_CREATE_PARTITIONS</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">stage: mount image</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">lock access to loop devices</span></span></span><br><span class="line">	exec &#123;FD&#125;&gt; /var/lock/orangepi-debootstrap-losetup</span><br><span class="line">	flock -x $FD</span><br><span class="line"></span><br><span class="line">	LOOP=$(losetup -f)</span><br><span class="line">	[[ -z $LOOP ]] &amp;&amp; exit_with_error &quot;Unable to find free loop device&quot;</span><br><span class="line"></span><br><span class="line">	check_loop_device &quot;$LOOP&quot;</span><br><span class="line"></span><br><span class="line">	losetup $LOOP $&#123;SDCARD&#125;.raw</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">loop device was grabbed here, unlock</span></span></span><br><span class="line">	flock -u $FD</span><br><span class="line"></span><br><span class="line">	partprobe $LOOP</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">stage: create fs, mount partitions, create fstab</span></span></span><br><span class="line">	rm -f $SDCARD/etc/fstab</span><br><span class="line">	if [[ -n $rootpart ]]; then</span><br><span class="line">		local rootdevice=&quot;$&#123;LOOP&#125;p$&#123;rootpart&#125;&quot;</span><br><span class="line"></span><br><span class="line">		if [[ $CRYPTROOT_ENABLE == yes ]]; then</span><br><span class="line">			display_alert &quot;Encrypting root partition with LUKS...&quot; &quot;cryptsetup luksFormat $rootdevice&quot; &quot;&quot;</span><br><span class="line">			echo -n $CRYPTROOT_PASSPHRASE | cryptsetup luksFormat $CRYPTROOT_PARAMETERS $rootdevice -</span><br><span class="line">			echo -n $CRYPTROOT_PASSPHRASE | cryptsetup luksOpen $rootdevice $ROOT_MAPPER -</span><br><span class="line">			display_alert &quot;Root partition encryption complete.&quot; &quot;&quot; &quot;ext&quot;</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">TODO: pass /dev/mapper to Docker</span></span></span><br><span class="line">			rootdevice=/dev/mapper/$ROOT_MAPPER # used by `mkfs` and `mount` commands</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		check_loop_device &quot;$rootdevice&quot;</span><br><span class="line">		display_alert &quot;Creating rootfs&quot; &quot;$ROOTFS_TYPE on $rootdevice&quot;</span><br><span class="line">		mkfs.$&#123;mkfs[$ROOTFS_TYPE]&#125; $&#123;mkopts[$ROOTFS_TYPE]&#125; $&#123;mkopts_label[$ROOTFS_TYPE]:+$&#123;mkopts_label[$ROOTFS_TYPE]&#125;&quot;$ROOT_FS_LABEL&quot;&#125; $rootdevice &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span><br><span class="line">		[[ $ROOTFS_TYPE == ext4 ]] &amp;&amp; tune2fs -o journal_data_writeback $rootdevice &gt; /dev/null</span><br><span class="line">		if [[ $ROOTFS_TYPE == btrfs &amp;&amp; $BTRFS_COMPRESSION != none ]]; then</span><br><span class="line">			local fscreateopt=&quot;-o compress-force=$&#123;BTRFS_COMPRESSION&#125;&quot;</span><br><span class="line">		fi</span><br><span class="line">		mount $&#123;fscreateopt&#125; $rootdevice $MOUNT/</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">create fstab (and crypttab) entry</span></span></span><br><span class="line">		if [[ $CRYPTROOT_ENABLE == yes ]]; then</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">map the LUKS container partition via its UUID to be the &#x27;</span>cryptroot<span class="string">&#x27; device</span></span></span><br><span class="line">			echo &quot;$ROOT_MAPPER UUID=$(blkid -s UUID -o value $&#123;LOOP&#125;p$&#123;rootpart&#125;) none luks&quot; &gt;&gt; $SDCARD/etc/crypttab</span><br><span class="line">			local rootfs=$rootdevice # used in fstab</span><br><span class="line">		else</span><br><span class="line">			local rootfs=&quot;UUID=$(blkid -s UUID -o value $rootdevice)&quot;</span><br><span class="line">		fi</span><br><span class="line">		echo &quot;$rootfs / $&#123;mkfs[$ROOTFS_TYPE]&#125; defaults,noatime$&#123;mountopts[$ROOTFS_TYPE]&#125; 0 1&quot; &gt;&gt; $SDCARD/etc/fstab</span><br><span class="line">	else</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">update_initramfs will fail if /lib/modules/ doesn&#x27;</span>t exist</span></span><br><span class="line">		mount --bind --make-private $SDCARD $MOUNT/</span><br><span class="line">		echo &quot;/dev/nfs / nfs defaults 0 0&quot; &gt;&gt; $SDCARD/etc/fstab</span><br><span class="line">	fi</span><br><span class="line">	if [[ -n $bootpart ]]; then</span><br><span class="line">		display_alert &quot;Creating /boot&quot; &quot;$bootfs on $&#123;LOOP&#125;p$&#123;bootpart&#125;&quot;</span><br><span class="line">		check_loop_device &quot;$&#123;LOOP&#125;p$&#123;bootpart&#125;&quot;</span><br><span class="line">		mkfs.$&#123;mkfs[$bootfs]&#125; $&#123;mkopts[$bootfs]&#125; $&#123;mkopts_label[$bootfs]:+$&#123;mkopts_label[$bootfs]&#125;&quot;$BOOT_FS_LABEL&quot;&#125; $&#123;LOOP&#125;p$&#123;bootpart&#125; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span><br><span class="line">		mkdir -p $MOUNT/boot/</span><br><span class="line">		mount $&#123;LOOP&#125;p$&#123;bootpart&#125; $MOUNT/boot/</span><br><span class="line">		echo &quot;UUID=$(blkid -s UUID -o value $&#123;LOOP&#125;p$&#123;bootpart&#125;) /boot $&#123;mkfs[$bootfs]&#125; defaults$&#123;mountopts[$bootfs]&#125; 0 2&quot; &gt;&gt; $SDCARD/etc/fstab</span><br><span class="line">	fi</span><br><span class="line">	if [[ -n $uefipart ]]; then</span><br><span class="line">		display_alert &quot;Creating EFI partition&quot; &quot;FAT32 $&#123;UEFI_MOUNT_POINT&#125; on $&#123;LOOP&#125;p$&#123;uefipart&#125; label $&#123;UEFI_FS_LABEL&#125;&quot;</span><br><span class="line">		check_loop_device &quot;$&#123;LOOP&#125;p$&#123;uefipart&#125;&quot;</span><br><span class="line">		mkfs.fat -F32 -n &quot;$&#123;UEFI_FS_LABEL&#125;&quot; $&#123;LOOP&#125;p$&#123;uefipart&#125; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/debug/install.log 2&gt;&amp;1</span><br><span class="line">		mkdir -p &quot;$&#123;MOUNT&#125;$&#123;UEFI_MOUNT_POINT&#125;&quot;</span><br><span class="line">		mount $&#123;LOOP&#125;p$&#123;uefipart&#125; &quot;$&#123;MOUNT&#125;$&#123;UEFI_MOUNT_POINT&#125;&quot;</span><br><span class="line">		echo &quot;UUID=$(blkid -s UUID -o value $&#123;LOOP&#125;p$&#123;uefipart&#125;) $&#123;UEFI_MOUNT_POINT&#125; vfat defaults 0 2&quot; &gt;&gt; $SDCARD/etc/fstab</span><br><span class="line">	fi</span><br><span class="line">	echo &quot;tmpfs /tmp tmpfs defaults,nosuid 0 0&quot; &gt;&gt; $SDCARD/etc/fstab</span><br><span class="line"></span><br><span class="line">	call_extension_method &quot;format_partitions&quot; &lt;&lt;- &#x27;FORMAT_PARTITIONS&#x27;</span><br><span class="line">		*if you created your own partitions, this would be a good time to format them*</span><br><span class="line">		The loop device is mounted, so $&#123;LOOP&#125;p1 is it&#x27;s first partition etc.</span><br><span class="line">	FORMAT_PARTITIONS</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">stage: adjust boot script or boot environment</span></span><br><span class="line">	if [[ -f $SDCARD/boot/orangepiEnv.txt ]]; then</span><br><span class="line">		if [[ $CRYPTROOT_ENABLE == yes ]]; then</span><br><span class="line">			echo &quot;rootdev=$rootdevice cryptdevice=UUID=$(blkid -s UUID -o value $&#123;LOOP&#125;p$&#123;rootpart&#125;):$ROOT_MAPPER&quot; &gt;&gt; $SDCARD/boot/orangepiEnv.txt</span><br><span class="line">		else</span><br><span class="line">			echo &quot;rootdev=$rootfs&quot; &gt;&gt; $SDCARD/boot/orangepiEnv.txt</span><br><span class="line">		fi</span><br><span class="line">		echo &quot;rootfstype=$ROOTFS_TYPE&quot; &gt;&gt; $SDCARD/boot/orangepiEnv.txt</span><br><span class="line">	elif [[ $rootpart != 1 ]] &amp;&amp; [[ $SRC_EXTLINUX != yes ]]; then</span><br><span class="line">		local bootscript_dst=$&#123;BOOTSCRIPT##*:&#125;</span><br><span class="line">		sed -i &#x27;s/mmcblk0p1/mmcblk0p2/&#x27; $SDCARD/boot/$bootscript_dst</span><br><span class="line">		sed -i -e &quot;s/rootfstype=ext4/rootfstype=$ROOTFS_TYPE/&quot; \</span><br><span class="line">			-e &quot;s/rootfstype \&quot;ext4\&quot;/rootfstype \&quot;$ROOTFS_TYPE\&quot;/&quot; $SDCARD/boot/$bootscript_dst</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="keyword">if</span> we have boot.ini = remove orangepiEnv.txt and add UUID there <span class="keyword">if</span> enabled</span></span><br><span class="line">	if [[ -f $SDCARD/boot/boot.ini ]]; then</span><br><span class="line">		sed -i -e &quot;s/rootfstype \&quot;ext4\&quot;/rootfstype \&quot;$ROOTFS_TYPE\&quot;/&quot; $SDCARD/boot/boot.ini</span><br><span class="line">		if [[ $CRYPTROOT_ENABLE == yes ]]; then</span><br><span class="line">			local rootpart=&quot;UUID=$(blkid -s UUID -o value $&#123;LOOP&#125;p$&#123;rootpart&#125;)&quot;</span><br><span class="line">			sed -i &#x27;s/^setenv rootdev .*/setenv rootdev &quot;\/dev\/mapper\/&#x27;$ROOT_MAPPER&#x27; cryptdevice=&#x27;$rootpart&#x27;:&#x27;$ROOT_MAPPER&#x27;&quot;/&#x27; $SDCARD/boot/boot.ini</span><br><span class="line">		else</span><br><span class="line">			sed -i &#x27;s/^setenv rootdev .*/setenv rootdev &quot;&#x27;$rootfs&#x27;&quot;/&#x27; $SDCARD/boot/boot.ini</span><br><span class="line">		fi</span><br><span class="line">		if [[ $LINUXFAMILY != meson64 ]]; then</span><br><span class="line">			[[ -f $SDCARD/boot/orangepiEnv.txt ]] &amp;&amp; rm $SDCARD/boot/orangepiEnv.txt</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="keyword">if</span> we have a headless device, <span class="built_in">set</span> console to DEFAULT_CONSOLE</span></span><br><span class="line">	if [[ -n $DEFAULT_CONSOLE &amp;&amp; -f $SDCARD/boot/orangepiEnv.txt ]]; then</span><br><span class="line">		if grep -lq &quot;^console=&quot; $SDCARD/boot/orangepiEnv.txt; then</span><br><span class="line">			sed -i &quot;s/^console=.*/console=$DEFAULT_CONSOLE/&quot; $SDCARD/boot/orangepiEnv.txt</span><br><span class="line">		else</span><br><span class="line">			echo &quot;console=$DEFAULT_CONSOLE&quot; &gt;&gt; $SDCARD/boot/orangepiEnv.txt</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">recompile .cmd to .scr <span class="keyword">if</span> boot.cmd exists</span></span><br><span class="line"></span><br><span class="line">	if [[ -f $SDCARD/boot/boot.cmd ]]; then</span><br><span class="line">		if [ -z $BOOTSCRIPT_OUTPUT ]; then BOOTSCRIPT_OUTPUT=boot.scr; fi</span><br><span class="line">		mkimage -C none -A arm -T script -d $SDCARD/boot/boot.cmd $SDCARD/boot/$BOOTSCRIPT_OUTPUT &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">create extlinux config</span></span><br><span class="line">	if [[ -f $SDCARD/boot/extlinux/extlinux.conf ]]; then</span><br><span class="line">		echo &quot;  append root=$rootfs $SRC_CMDLINE $MAIN_CMDLINE&quot; &gt;&gt; $SDCARD/boot/extlinux/extlinux.conf</span><br><span class="line">		[[ -f $SDCARD/boot/orangepiEnv.txt ]] &amp;&amp; rm $SDCARD/boot/orangepiEnv.txt</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">update_initramfs</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># this should be invoked as late as possible for any modifications by</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">customize_image (userpatches) and prepare_partitions to be reflected <span class="keyword">in</span> the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">final initramfs</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># especially, this needs to be invoked after /etc/crypttab has been created</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> cryptroot-unlock to work:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https://serverfault.com/questions/907254/cryproot-unlock-with-dropbear-timeout-while-waiting-for-askpass</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># since Debian buster, it has to be called within create_image() on the $MOUNT</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">path instead of <span class="variable">$SDCARD</span> (<span class="built_in">which</span> can be a tmpfs and breaks cryptsetup-initramfs).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">update_initramfs()</span></span><br><span class="line">&#123;</span><br><span class="line">	local chroot_target=$1</span><br><span class="line">	local target_dir=$(</span><br><span class="line">		find $&#123;chroot_target&#125;/lib/modules/ -maxdepth 1 -type d -name &quot;*$&#123;VER&#125;*&quot;</span><br><span class="line">	)</span><br><span class="line">	if [ &quot;$target_dir&quot; != &quot;&quot; ]; then</span><br><span class="line">		update_initramfs_cmd=&quot;update-initramfs -uv -k $(basename $target_dir)&quot;</span><br><span class="line">	else</span><br><span class="line">		exit_with_error &quot;No kernel installed for the version&quot; &quot;$&#123;VER&#125;&quot;</span><br><span class="line">	fi</span><br><span class="line">	display_alert &quot;Updating initramfs...&quot; &quot;$update_initramfs_cmd&quot; &quot;&quot;</span><br><span class="line">	cp /usr/bin/$QEMU_BINARY $chroot_target/usr/bin/</span><br><span class="line">	mount_chroot &quot;$chroot_target/&quot;</span><br><span class="line"></span><br><span class="line">	chroot $chroot_target /bin/bash -c &quot;$update_initramfs_cmd&quot; &gt;&gt; $DEST/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1 || &#123;</span><br><span class="line">		display_alert &quot;Updating initramfs FAILED, see:&quot; &quot;$DEST/$&#123;LOG_SUBPATH&#125;/install.log&quot; &quot;err&quot;</span><br><span class="line">		exit 23</span><br><span class="line">	&#125;</span><br><span class="line">	display_alert &quot;Updated initramfs.&quot; &quot;for details see: $DEST/$&#123;LOG_SUBPATH&#125;/install.log&quot; &quot;info&quot;</span><br><span class="line"></span><br><span class="line">	display_alert &quot;Re-enabling&quot; &quot;initramfs-tools hook for kernel&quot;</span><br><span class="line">	chroot $chroot_target /bin/bash -c &quot;chmod -v +x /etc/kernel/postinst.d/initramfs-tools&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">	umount_chroot &quot;$chroot_target/&quot;</span><br><span class="line">	rm $chroot_target/usr/bin/$QEMU_BINARY</span><br><span class="line"></span><br><span class="line">&#125; #############################################################################</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">create_image</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># finishes creation of image from cached rootfs</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">create_image()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">stage: create file name</span></span><br><span class="line">	if [[ $SELECTED_CONFIGURATION == &quot;cli_standard&quot; ]]; then</span><br><span class="line">		IMAGE_TYPE=server</span><br><span class="line">	elif [[ $SELECTED_CONFIGURATION == &quot;cli_minimal&quot; ]]; then</span><br><span class="line">		IMAGE_TYPE=minimal</span><br><span class="line">	else</span><br><span class="line">		IMAGE_TYPE=desktop</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ $&#123;MEM_TYPE&#125; == &quot;1500MB&quot; ]]; then</span><br><span class="line">		local version=&quot;$&#123;BOARD^&#125;_$&#123;REVISION&#125;_$&#123;DISTRIBUTION,&#125;_$&#123;RELEASE&#125;_$&#123;IMAGE_TYPE&#125;&quot;$&#123;DESKTOP_ENVIRONMENT:+_$DESKTOP_ENVIRONMENT&#125;&quot;_linux$(grab_version &quot;$LINUXSOURCEDIR&quot;)_1.5gb&quot;</span><br><span class="line">	else</span><br><span class="line">		local version=&quot;$&#123;BOARD^&#125;_$&#123;REVISION&#125;_$&#123;DISTRIBUTION,&#125;_$&#123;RELEASE&#125;_$&#123;IMAGE_TYPE&#125;&quot;$&#123;DESKTOP_ENVIRONMENT:+_$DESKTOP_ENVIRONMENT&#125;&quot;_linux$(grab_version &quot;$LINUXSOURCEDIR&quot;)&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ $&#123;RELEASE&#125; == &quot;raspi&quot; ]]; then</span><br><span class="line">		local version=&quot;$&#123;BOARD^&#125;_$&#123;REVISION&#125;_raspios_bullseye_$&#123;IMAGE_TYPE&#125;&quot;$&#123;DESKTOP_ENVIRONMENT:+_$DESKTOP_ENVIRONMENT&#125;&quot;_linux$(grab_version &quot;$LINUXSOURCEDIR&quot;)&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	[[ $ROOTFS_TYPE == nfs ]] &amp;&amp; version=$&#123;version&#125;_nfsboot</span><br><span class="line"></span><br><span class="line">	destimg=$DEST/images/$&#123;version&#125;</span><br><span class="line">	rm -rf $destimg</span><br><span class="line">	mkdir -p $destimg</span><br><span class="line"></span><br><span class="line">	if [[ $ROOTFS_TYPE != nfs ]]; then</span><br><span class="line">		display_alert &quot;Copying files to&quot; &quot;/&quot;</span><br><span class="line">		echo -e &quot;\nCopying files to [/]&quot; &gt;&gt;&quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log</span><br><span class="line">		rsync -aHWXh \</span><br><span class="line">			  --exclude=&quot;/boot/*&quot; \</span><br><span class="line">			  --exclude=&quot;/dev/*&quot; \</span><br><span class="line">			  --exclude=&quot;/proc/*&quot; \</span><br><span class="line">			  --exclude=&quot;/run/*&quot; \</span><br><span class="line">			  --exclude=&quot;/tmp/*&quot; \</span><br><span class="line">			  --exclude=&quot;/sys/*&quot; \</span><br><span class="line">			  --info=progress0,stats1 $SDCARD/ $MOUNT/ &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span><br><span class="line">	else</span><br><span class="line">		display_alert &quot;Creating rootfs archive&quot; &quot;rootfs.tgz&quot; &quot;info&quot;</span><br><span class="line">		tar cp --xattrs --directory=$SDCARD/ --exclude=&#x27;./boot/*&#x27; --exclude=&#x27;./dev/*&#x27; --exclude=&#x27;./proc/*&#x27; --exclude=&#x27;./run/*&#x27; --exclude=&#x27;./tmp/*&#x27; \</span><br><span class="line">			--exclude=&#x27;./sys/*&#x27; . | pv -p -b -r -s $(du -sb $SDCARD/ | cut -f1) -N &quot;rootfs.tgz&quot; | gzip -c &gt; $destimg/$&#123;version&#125;-rootfs.tgz</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">stage: rsync /boot</span></span><br><span class="line">	display_alert &quot;Copying files to&quot; &quot;/boot&quot;</span><br><span class="line">	echo -e &quot;\nCopying files to [/boot]&quot; &gt;&gt;&quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log</span><br><span class="line">	if [[ $(findmnt --target $MOUNT/boot -o FSTYPE -n) == vfat ]]; then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">fat32</span></span><br><span class="line">		rsync -rLtWh \</span><br><span class="line">			  --info=progress0,stats1 \</span><br><span class="line">			  --log-file=&quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log $SDCARD/boot $MOUNT &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span><br><span class="line">	else</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">ext4</span></span><br><span class="line">		rsync -aHWXh \</span><br><span class="line">			  --info=progress0,stats1 \</span><br><span class="line">			  --log-file=&quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log $SDCARD/boot $MOUNT &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	call_extension_method &quot;pre_update_initramfs&quot; &quot;config_pre_update_initramfs&quot; &lt;&lt; &#x27;PRE_UPDATE_INITRAMFS&#x27;</span><br><span class="line">*allow config to hack into the initramfs create process*</span><br><span class="line">Called after rsync has synced both `/root` and `/root` on the target, but before calling `update_initramfs`.</span><br><span class="line">PRE_UPDATE_INITRAMFS</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">stage: create final initramfs</span></span><br><span class="line">	[[ -n $KERNELSOURCE ]] &amp;&amp; &#123;</span><br><span class="line">		update_initramfs $MOUNT</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">DEBUG: <span class="built_in">print</span> free space</span></span><br><span class="line">	local freespace=$(LC_ALL=C df -h)</span><br><span class="line">	echo $freespace &gt;&gt; $DEST/$&#123;LOG_SUBPATH&#125;/debootstrap.log</span><br><span class="line">	display_alert &quot;Free SD cache&quot; &quot;$(echo -e &quot;$freespace&quot; | grep $SDCARD | awk &#x27;&#123;print $5&#125;&#x27;)&quot; &quot;info&quot;</span><br><span class="line">	display_alert &quot;Mount point&quot; &quot;$(echo -e &quot;$freespace&quot; | grep $MOUNT | head -1 | awk &#x27;&#123;print $5&#125;&#x27;)&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">stage: write u-boot</span></span><br><span class="line">	write_uboot $LOOP</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">fix wrong / permissions</span></span><br><span class="line">	chmod 755 $MOUNT</span><br><span class="line"></span><br><span class="line">	call_extension_method &quot;pre_umount_final_image&quot; &quot;config_pre_umount_final_image&quot; &lt;&lt; &#x27;PRE_UMOUNT_FINAL_IMAGE&#x27;</span><br><span class="line">*allow config to hack into the image before the unmount*</span><br><span class="line">Called before unmounting both `/root` and `/boot`.</span><br><span class="line">PRE_UMOUNT_FINAL_IMAGE</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">unmount /boot/efi first, <span class="keyword">then</span> /boot, rootfs third, image file last</span></span><br><span class="line">	sync</span><br><span class="line">	[[ $UEFISIZE != 0 ]] &amp;&amp; umount -l &quot;$&#123;MOUNT&#125;$&#123;UEFI_MOUNT_POINT&#125;&quot;</span><br><span class="line">	[[ $BOOTSIZE != 0 ]] &amp;&amp; umount -l $MOUNT/boot</span><br><span class="line">	[[ $ROOTFS_TYPE != nfs ]] &amp;&amp; umount -l $MOUNT</span><br><span class="line">	[[ $CRYPTROOT_ENABLE == yes ]] &amp;&amp; cryptsetup luksClose $ROOT_MAPPER</span><br><span class="line"></span><br><span class="line">	call_extension_method &quot;post_umount_final_image&quot; &quot;config_post_umount_final_image&quot; &lt;&lt; &#x27;POST_UMOUNT_FINAL_IMAGE&#x27;</span><br><span class="line">*allow config to hack into the image after the unmount*</span><br><span class="line">Called after unmounting both `/root` and `/boot`.</span><br><span class="line">POST_UMOUNT_FINAL_IMAGE</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">to make sure its unmounted</span></span><br><span class="line">	while grep -Eq &#x27;($&#123;MOUNT&#125;|$&#123;DESTIMG&#125;)&#x27; /proc/mounts</span><br><span class="line">	do</span><br><span class="line">		display_alert &quot;Wait for unmount&quot; &quot;$&#123;MOUNT&#125;&quot; &quot;info&quot;</span><br><span class="line">		sleep 5</span><br><span class="line">	done</span><br><span class="line"></span><br><span class="line">	losetup -d $LOOP</span><br><span class="line">	rm -rf --one-file-system $DESTIMG $MOUNT</span><br><span class="line"></span><br><span class="line">	mkdir -p $DESTIMG</span><br><span class="line">	mv $&#123;SDCARD&#125;.raw $DESTIMG/$&#123;version&#125;.img</span><br><span class="line"></span><br><span class="line">	FINALDEST=$&#123;destimg&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">custom post_build_image_modify hook to run before fingerprinting and compression</span></span><br><span class="line">	[[ $(type -t post_build_image_modify) == function ]] &amp;&amp; display_alert &quot;Custom Hook Detected&quot; &quot;post_build_image_modify&quot; &quot;info&quot; &amp;&amp; post_build_image_modify &quot;$&#123;DESTIMG&#125;/$&#123;version&#125;.img&quot;</span><br><span class="line"></span><br><span class="line">	if [[ $BUILD_ALL != yes ]]; then</span><br><span class="line">	</span><br><span class="line">		if [[ $COMPRESS_OUTPUTIMAGE == &quot;&quot; || $COMPRESS_OUTPUTIMAGE == no ]]; then</span><br><span class="line">			COMPRESS_OUTPUTIMAGE=&quot;sha,gpg,img&quot;</span><br><span class="line">		elif [[ $COMPRESS_OUTPUTIMAGE == yes ]]; then</span><br><span class="line">			COMPRESS_OUTPUTIMAGE=&quot;sha,gpg,7z&quot;</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		if [[ $COMPRESS_OUTPUTIMAGE == *gz* ]]; then</span><br><span class="line">			display_alert &quot;Compressing&quot; &quot;$&#123;DESTIMG&#125;/$&#123;version&#125;.img.gz&quot; &quot;info&quot;</span><br><span class="line">			pigz -3 &lt; $DESTIMG/$&#123;version&#125;.img &gt; $DESTIMG/$&#123;version&#125;.img.gz</span><br><span class="line">			compression_type=&quot;.gz&quot;</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		if [[ $COMPRESS_OUTPUTIMAGE == *xz* ]]; then</span><br><span class="line">			display_alert &quot;Compressing&quot; &quot;$&#123;DESTIMG&#125;/$&#123;version&#125;.img.xz&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">compressing consumes a lot of memory we don<span class="string">&#x27;t have. Waiting for previous packing job to finish helps to run a lot more builds in parallel</span></span></span><br><span class="line">			available_cpu=$(grep -c &#x27;processor&#x27; /proc/cpuinfo)</span><br><span class="line">			[[ $&#123;BUILD_ALL&#125; == yes ]] &amp;&amp; available_cpu=$(( $available_cpu * 30 / 100 )) # lets use 20% of resources in case of build-all</span><br><span class="line">			[[ $&#123;available_cpu&#125; -gt 8 ]] &amp;&amp; available_cpu=8 # using more cpu cores for compressing is pointless</span><br><span class="line">			available_mem=$(LC_ALL=c free | grep Mem | awk &#x27;&#123;print $4/$2 * 100.0&#125;&#x27; | awk &#x27;&#123;print int($1)&#125;&#x27;) # in percentage</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">build optimisations when memory drops below 5%</span></span></span><br><span class="line">			if [[ $&#123;BUILD_ALL&#125; == yes &amp;&amp; ( $&#123;available_mem&#125; -lt 15 || $(ps -uax | grep &quot;pixz&quot; | wc -l) -gt 4 )]]; then</span><br><span class="line">				while [[ $(ps -uax | grep &quot;pixz&quot; | wc -l) -gt 2 ]]</span><br><span class="line">					do echo -en &quot;#&quot;</span><br><span class="line">					sleep 20</span><br><span class="line">				done</span><br><span class="line">			fi</span><br><span class="line">			pixz -7 -p $&#123;available_cpu&#125; -f $(expr $&#123;available_cpu&#125; + 2) &lt; $DESTIMG/$&#123;version&#125;.img &gt; $&#123;DESTIMG&#125;/$&#123;version&#125;.img.xz</span><br><span class="line">			compression_type=&quot;.xz&quot;</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		if [[ $COMPRESS_OUTPUTIMAGE == *img* || $COMPRESS_OUTPUTIMAGE == *7z* ]]; then</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">			mv $DESTIMG/$&#123;version&#125;.img $&#123;FINALDEST&#125;/$&#123;version&#125;.img || exit 1</span></span></span><br><span class="line">			compression_type=&quot;&quot;</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		if [[ $COMPRESS_OUTPUTIMAGE == *sha* ]]; then</span><br><span class="line">			cd $&#123;DESTIMG&#125;</span><br><span class="line">			display_alert &quot;SHA256 calculating&quot; &quot;$&#123;version&#125;.img$&#123;compression_type&#125;&quot; &quot;info&quot;</span><br><span class="line">			sha256sum -b $&#123;version&#125;.img$&#123;compression_type&#125; &gt; $&#123;version&#125;.img$&#123;compression_type&#125;.sha</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		if [[ $COMPRESS_OUTPUTIMAGE == *gpg* ]]; then</span><br><span class="line">			cd $&#123;DESTIMG&#125;</span><br><span class="line">			if [[ -n $GPG_PASS ]]; then</span><br><span class="line">				display_alert &quot;GPG signing&quot; &quot;$&#123;version&#125;.img$&#123;compression_type&#125;&quot; &quot;info&quot;</span><br><span class="line">				[[ -n $&#123;SUDO_USER&#125; ]] &amp;&amp; sudo chown -R $&#123;SUDO_USER&#125;:$&#123;SUDO_USER&#125; &quot;$&#123;DESTIMG&#125;&quot;/</span><br><span class="line">				echo &quot;$&#123;GPG_PASS&#125;&quot; | sudo -H -u $&#123;SUDO_USER&#125; bash -c &quot;gpg --passphrase-fd 0 --armor --detach-sign --pinentry-mode loopback --batch --yes $&#123;DESTIMG&#125;/$&#123;version&#125;.img$&#123;compression_type&#125;&quot; || exit 1</span><br><span class="line"><span class="meta prompt_">			#</span><span class="language-bash"><span class="string">else</span></span></span><br><span class="line"><span class="meta prompt_">			#</span><span class="language-bash"><span class="string">	display_alert &quot;GPG signing skipped - no GPG_PASS&quot; &quot;$&#123;version&#125;.img&quot; &quot;wrn&quot;</span></span></span><br><span class="line">			fi</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"><span class="string">fingerprint_image &quot;$&#123;DESTIMG&#125;/$&#123;version&#125;.img$&#123;compression_type&#125;.txt&quot; &quot;$&#123;version&#125;&quot;</span></span></span><br><span class="line"></span><br><span class="line">		if [[ $COMPRESS_OUTPUTIMAGE == *7z* ]]; then</span><br><span class="line">			display_alert &quot;Compressing&quot; &quot;$&#123;DESTIMG&#125;/$&#123;version&#125;.7z&quot; &quot;info&quot;</span><br><span class="line">			7za a -t7z -bd -m0=lzma2 -mx=3 -mfb=64 -md=32m -ms=on \</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash"><span class="string">&#123;DESTIMG&#125;/$&#123;version&#125;.7z $&#123;version&#125;.key $&#123;version&#125;.img* &gt;/dev/null 2&gt;&amp;1</span></span></span><br><span class="line">			find $&#123;DESTIMG&#125;/ -type \</span><br><span class="line">			f \( -name &quot;$&#123;version&#125;.img&quot; -o -name &quot;$&#123;version&#125;.img.asc&quot; -o -name &quot;$&#123;version&#125;.img.txt&quot; -o -name &quot;$&#123;version&#125;.img.sha&quot; \) -print0 \</span><br><span class="line"><span class="meta prompt_">			&gt;</span><span class="language-bash"><span class="string">/dev/null 2&gt;&amp;1</span></span></span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">display_alert &quot;Done building&quot; &quot;$&#123;DESTIMG&#125;/$&#123;version&#125;.img&quot; &quot;info&quot;</span></span></span><br><span class="line">	display_alert &quot;Done building&quot; &quot;$&#123;FINALDEST&#125;/$&#123;version&#125;.img&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">call custom post build hook</span></span></span><br><span class="line">	[[ $(type -t post_build_image) == function ]] &amp;&amp; post_build_image &quot;$&#123;DESTIMG&#125;/$&#123;version&#125;.img&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">move artefacts from temporally directory to its final destination</span></span></span><br><span class="line">	[[ -n $compression_type ]] &amp;&amp; rm $DESTIMG/$&#123;version&#125;.img</span><br><span class="line">	mv $DESTIMG/$&#123;version&#125;* $&#123;FINALDEST&#125;</span><br><span class="line">	rm -rf $DESTIMG</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">write image to SD card</span></span></span><br><span class="line">	if [[ $(lsblk &quot;$CARD_DEVICE&quot; 2&gt;/dev/null) &amp;&amp; -f $&#123;FINALDEST&#125;/$&#123;version&#125;.img ]]; then</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">make sha256sum if it does not exists. we need it for comparisson</span></span></span><br><span class="line">		if [[ -f &quot;$&#123;FINALDEST&#125;/$&#123;version&#125;&quot;.img.sha ]]; then</span><br><span class="line">			local ifsha=$(cat $&#123;FINALDEST&#125;/$&#123;version&#125;.img.sha | awk &#x27;&#123;print $1&#125;&#x27;)</span><br><span class="line">		else</span><br><span class="line">			local ifsha=$(sha256sum -b &quot;$&#123;FINALDEST&#125;/$&#123;version&#125;&quot;.img | awk &#x27;&#123;print $1&#125;&#x27;)</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		display_alert &quot;Writing image&quot; &quot;$CARD_DEVICE $&#123;readsha&#125;&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">write to SD card</span></span></span><br><span class="line">		pv -p -b -r -c -N &quot;[ .... ] dd&quot; $&#123;FINALDEST&#125;/$&#123;version&#125;.img | dd of=$CARD_DEVICE bs=1M iflag=fullblock oflag=direct status=none</span><br><span class="line"></span><br><span class="line">		call_extension_method &quot;post_write_sdcard&quot;  &lt;&lt;- &#x27;POST_BUILD_IMAGE&#x27;</span><br><span class="line">		*run after writing img to sdcard*</span><br><span class="line">		After the image is written to `$CARD_DEVICE`, but before verifying it.</span><br><span class="line">		You can still set SKIP_VERIFY=yes to skip verification.</span><br><span class="line">		POST_BUILD_IMAGE</span><br><span class="line"></span><br><span class="line">		if [[ &quot;$&#123;SKIP_VERIFY&#125;&quot; != &quot;yes&quot; ]]; then</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">read and compare</span></span></span><br><span class="line">			display_alert &quot;Verifying. Please wait!&quot;</span><br><span class="line">			local ofsha=$(dd if=$CARD_DEVICE count=$(du -b $&#123;FINALDEST&#125;/$&#123;version&#125;.img | cut -f1) status=none iflag=count_bytes oflag=direct | sha256sum | awk &#x27;&#123;print $1&#125;&#x27;)</span><br><span class="line">			if [[ $ifsha == $ofsha ]]; then</span><br><span class="line">				display_alert &quot;Writing verified&quot; &quot;$&#123;version&#125;.img&quot; &quot;info&quot;</span><br><span class="line">			else</span><br><span class="line">				display_alert &quot;Writing failed&quot; &quot;$&#123;version&#125;.img&quot; &quot;err&quot;</span><br><span class="line">			fi</span><br><span class="line">		fi</span><br><span class="line">	elif [[ `systemd-detect-virt` == &#x27;docker&#x27; &amp;&amp; -n $CARD_DEVICE ]]; then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">display warning when we want to write sd card under Docker</span></span></span><br><span class="line">		display_alert &quot;Can&#x27;t write to $CARD_DEVICE&quot; &quot;Enable docker privileged mode in config-docker.conf&quot; &quot;wrn&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">&#125; #############################################################################</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="6-distributions-shåˆ†æ"><a href="#6-distributions-shåˆ†æ" class="headerlink" title="6 distributions.shåˆ†æ"></a>6 distributions.shåˆ†æ</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Copyright (c) 2013-2021 Igor Pecovnik, igor.pecovnik@gma**.com</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This file is licensed under the terms of the GNU General Public</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">License version 2. This program is licensed <span class="string">&quot;as is&quot;</span> without any</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">warranty of any kind, whether express or implied.</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Functions:</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">install_common</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">install_rclocal</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">install_distribution_specific</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">post_debootstrap_tweaks</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">install_common()</span><br><span class="line">&#123;</span><br><span class="line">	display_alert &quot;Applying common tweaks&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">install rootfs encryption related packages separate to not <span class="built_in">break</span> packages cache</span></span><br><span class="line">	if [[ $CRYPTROOT_ENABLE == yes ]]; then</span><br><span class="line">		display_alert &quot;Installing rootfs encryption related packages&quot; &quot;cryptsetup&quot; &quot;info&quot;</span><br><span class="line">		chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;apt-get -y -qq --no-install-recommends install cryptsetup&quot; \</span><br><span class="line"><span class="meta prompt_">		&gt;</span><span class="language-bash">&gt; <span class="string">&quot;<span class="variable">$&#123;DEST&#125;</span>&quot;</span>/<span class="variable">$&#123;LOG_SUBPATH&#125;</span>/install.log 2&gt;&amp;1</span></span><br><span class="line">		if [[ $CRYPTROOT_SSH_UNLOCK == yes ]]; then</span><br><span class="line">			display_alert &quot;Installing rootfs encryption related packages&quot; &quot;dropbear-initramfs&quot; &quot;info&quot;</span><br><span class="line">			chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;apt-get -y -qq --no-install-recommends install dropbear-initramfs cryptsetup-initramfs&quot; \</span><br><span class="line"><span class="meta prompt_">			&gt;</span><span class="language-bash">&gt; <span class="string">&quot;<span class="variable">$&#123;DEST&#125;</span>&quot;</span>/<span class="variable">$&#123;LOG_SUBPATH&#125;</span>/install.log 2&gt;&amp;1</span></span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">add dummy fstab entry to make mkinitramfs happy</span></span><br><span class="line">	echo &quot;/dev/mmcblk0p1 / $ROOTFS_TYPE defaults 0 1&quot; &gt;&gt; &quot;$&#123;SDCARD&#125;&quot;/etc/fstab</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">required <span class="keyword">for</span> initramfs-tools-core on Stretch since it ignores the / fstab entry</span></span><br><span class="line">	echo &quot;/dev/mmcblk0p2 /usr $ROOTFS_TYPE defaults 0 2&quot; &gt;&gt; &quot;$&#123;SDCARD&#125;&quot;/etc/fstab</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">adjust initramfs dropbear configuration</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">needs to be <span class="keyword">done</span> before kernel installation, <span class="keyword">else</span> it won<span class="string">&#x27;t be in the initrd image</span></span></span><br><span class="line">	if [[ $CRYPTROOT_ENABLE == yes &amp;&amp; $CRYPTROOT_SSH_UNLOCK == yes ]]; then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">Set the port of the dropbear ssh daemon in the initramfs to a different one if configured</span></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">this avoids the typical &#x27;</span>host key changed warning<span class="string">&#x27; - `WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!`</span></span></span><br><span class="line">		[[ -f &quot;$&#123;SDCARD&#125;&quot;/etc/dropbear-initramfs/config ]] &amp;&amp; \</span><br><span class="line">		sed -i &#x27;s/^#DROPBEAR_OPTIONS=/DROPBEAR_OPTIONS=&quot;-p &#x27;&quot;$&#123;CRYPTROOT_SSH_UNLOCK_PORT&#125;&quot;&#x27;&quot;/&#x27; \</span><br><span class="line">		&quot;$&#123;SDCARD&#125;&quot;/etc/dropbear-initramfs/config</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">setup dropbear authorized_keys, either provided by userpatches or generated</span></span></span><br><span class="line">		if [[ -f $USERPATCHES_PATH/dropbear_authorized_keys ]]; then</span><br><span class="line">			cp &quot;$USERPATCHES_PATH&quot;/dropbear_authorized_keys &quot;$&#123;SDCARD&#125;&quot;/etc/dropbear-initramfs/authorized_keys</span><br><span class="line">		else</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">generate a default ssh key for login on dropbear in initramfs</span></span></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">this key should be changed by the user on first login</span></span></span><br><span class="line">			display_alert &quot;Generating a new SSH key pair for dropbear (initramfs)&quot; &quot;&quot; &quot;&quot;</span><br><span class="line">			ssh-keygen -t ecdsa -f &quot;$&#123;SDCARD&#125;&quot;/etc/dropbear-initramfs/id_ecdsa \</span><br><span class="line">			-N &#x27;&#x27; -O force-command=cryptroot-unlock -C &#x27;AUTOGENERATED_BY_ARMBIAN_BUILD&#x27;  &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">/usr/share/initramfs-tools/hooks/dropbear will automatically add &#x27;</span>id_ecdsa.pub<span class="string">&#x27; to authorized_keys file</span></span></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">during mkinitramfs of update-initramfs</span></span></span><br><span class="line"><span class="meta prompt_">			#</span><span class="language-bash"><span class="string">cat &quot;$&#123;SDCARD&#125;&quot;/etc/dropbear-initramfs/id_ecdsa.pub &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/dropbear-initramfs/authorized_keys</span></span></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">The version of the Linux kernel</span></span></span><br><span class="line">			CRYPTROOT_SSH_UNLOCK_KEY_NAME=&quot;$&#123;BOARD^&#125;_$&#123;REVISION&#125;_$&#123;DISTRIBUTION,&#125;_$&#123;RELEASE&#125;_$&#123;SELECTED_CONFIGURATION&#125;_linux&quot;$(grab_version &quot;$LINUXSOURCEDIR&quot;)&quot;&quot;.key</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">copy dropbear ssh key to image output dir for convenience</span></span></span><br><span class="line">			cp &quot;$&#123;SDCARD&#125;&quot;/etc/dropbear-initramfs/id_ecdsa &quot;$&#123;DEST&#125;/images/$&#123;CRYPTROOT_SSH_UNLOCK_KEY_NAME&#125;&quot;</span><br><span class="line">			display_alert &quot;SSH private key for dropbear (initramfs) has been copied to:&quot; \</span><br><span class="line">			&quot;$DEST/images/$CRYPTROOT_SSH_UNLOCK_KEY_NAME&quot; &quot;info&quot;</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">create modules file</span></span></span><br><span class="line">	local modules=MODULES_$&#123;BRANCH^^&#125;</span><br><span class="line">	if [[ -n &quot;$&#123;!modules&#125;&quot; ]]; then</span><br><span class="line">		tr &#x27; &#x27; &#x27;\n&#x27; &lt;&lt;&lt; &quot;$&#123;!modules&#125;&quot; &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/modules</span><br><span class="line">	elif [[ -n &quot;$&#123;MODULES&#125;&quot; ]]; then</span><br><span class="line">		tr &#x27; &#x27; &#x27;\n&#x27; &lt;&lt;&lt; &quot;$&#123;MODULES&#125;&quot; &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/modules</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">create blacklist files</span></span></span><br><span class="line">	local blacklist=MODULES_BLACKLIST_$&#123;BRANCH^^&#125;</span><br><span class="line">	if [[ -n &quot;$&#123;!blacklist&#125;&quot; ]]; then</span><br><span class="line">		tr &#x27; &#x27; &#x27;\n&#x27; &lt;&lt;&lt; &quot;$&#123;!blacklist&#125;&quot; | sed -e &#x27;s/^/blacklist /&#x27; &gt; &quot;$&#123;SDCARD&#125;/etc/modprobe.d/blacklist-$&#123;BOARD&#125;.conf&quot;</span><br><span class="line">	elif [[ -n &quot;$&#123;MODULES_BLACKLIST&#125;&quot; ]]; then</span><br><span class="line">		tr &#x27; &#x27; &#x27;\n&#x27; &lt;&lt;&lt; &quot;$&#123;MODULES_BLACKLIST&#125;&quot; | sed -e &#x27;s/^/blacklist /&#x27; &gt; &quot;$&#123;SDCARD&#125;/etc/modprobe.d/blacklist-$&#123;BOARD&#125;.conf&quot;</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">configure MIN / MAX speed for cpufrequtils</span></span></span><br><span class="line">	cat &lt;&lt;-EOF &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/default/cpufrequtils</span><br><span class="line">	ENABLE=true</span><br><span class="line">	MIN_SPEED=$CPUMIN</span><br><span class="line">	MAX_SPEED=$CPUMAX</span><br><span class="line">	GOVERNOR=$GOVERNOR</span><br><span class="line">	EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">remove default interfaces file if present</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">before installing board support package</span></span></span><br><span class="line">	rm -f &quot;$&#123;SDCARD&#125;&quot;/etc/network/interfaces</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">disable selinux by default</span></span></span><br><span class="line">	mkdir -p &quot;$&#123;SDCARD&#125;&quot;/selinux</span><br><span class="line">	[[ -f &quot;$&#123;SDCARD&#125;&quot;/etc/selinux/config ]] &amp;&amp; sed &quot;s/^SELINUX=.*/SELINUX=disabled/&quot; -i &quot;$&#123;SDCARD&#125;&quot;/etc/selinux/config</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">remove Ubuntu&#x27;</span>s legal text</span></span><br><span class="line">	[[ -f &quot;$&#123;SDCARD&#125;&quot;/etc/legal ]] &amp;&amp; rm &quot;$&#123;SDCARD&#125;&quot;/etc/legal</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Prevent loading paralel printer port drivers <span class="built_in">which</span> we don<span class="string">&#x27;t need here.</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Suppress boot error if kernel modules are absent</span></span></span><br><span class="line">	if [[ -f &quot;$&#123;SDCARD&#125;&quot;/etc/modules-load.d/cups-filters.conf ]]; then</span><br><span class="line">		sed &quot;s/^lp/#lp/&quot; -i &quot;$&#123;SDCARD&#125;&quot;/etc/modules-load.d/cups-filters.conf</span><br><span class="line">		sed &quot;s/^ppdev/#ppdev/&quot; -i &quot;$&#123;SDCARD&#125;&quot;/etc/modules-load.d/cups-filters.conf</span><br><span class="line">		sed &quot;s/^parport_pc/#parport_pc/&quot; -i &quot;$&#123;SDCARD&#125;&quot;/etc/modules-load.d/cups-filters.conf</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">console fix due to Debian bug</span></span></span><br><span class="line">	sed -e &#x27;s/CHARMAP=&quot;.*&quot;/CHARMAP=&quot;&#x27;$CONSOLE_CHAR&#x27;&quot;/g&#x27; -i &quot;$&#123;SDCARD&#125;&quot;/etc/default/console-setup</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">add the /dev/urandom path to the rng config file</span></span></span><br><span class="line">	echo &quot;HRNGDEVICE=/dev/urandom&quot; &gt;&gt; &quot;$&#123;SDCARD&#125;&quot;/etc/default/rng-tools</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">ping needs privileged action to be able to create raw network socket</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">this is working properly but not with (at least) Debian Buster</span></span></span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;chmod u+s /bin/ping&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">change time zone data</span></span></span><br><span class="line">	echo &quot;$&#123;TZDATA&#125;&quot; &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/timezone</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;dpkg-reconfigure -f noninteractive tzdata &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">set root password</span></span></span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;(echo $ROOTPWD;echo $ROOTPWD;) | passwd root &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">enable automated login to console(s)</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">mkdir -p &quot;$&#123;SDCARD&#125;&quot;/etc/systemd/system/getty@.service.d/</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">mkdir -p &quot;$&#123;SDCARD&#125;&quot;/etc/systemd/system/serial-getty@.service.d/</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">cat &lt;&lt;-EOF &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/systemd/system/serial-getty@.service.d/override.conf</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">[Service]</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">ExecStartPre=/bin/sh -c &#x27;</span><span class="built_in">exec</span> /bin/sleep 10<span class="string">&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">ExecStart=</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">ExecStart=-/sbin/agetty --noissue --autologin root %I \$TERM</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">Type=idle</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">EOF</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">cp &quot;$&#123;SDCARD&#125;&quot;/etc/systemd/system/serial-getty@.service.d/override.conf &quot;$&#123;SDCARD&#125;&quot;/etc/systemd/system/getty@.service.d/override.conf</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">force change root password at first login</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;chage -d 0 root&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">change console welcome text</span></span></span><br><span class="line">	echo -e &quot;$&#123;VENDOR&#125; $&#123;REVISION&#125; $&#123;RELEASE^&#125; \\l \n&quot; &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/issue</span><br><span class="line">	echo &quot;$&#123;VENDOR&#125; $&#123;REVISION&#125; $&#123;RELEASE^&#125;&quot; &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/issue.net</span><br><span class="line">	sed -i &quot;s/^PRETTY_NAME=.*/PRETTY_NAME=\&quot;$&#123;VENDOR&#125; $REVISION &quot;$&#123;RELEASE^&#125;&quot;\&quot;/&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/os-release</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">enable few bash aliases enabled in Ubuntu by default to make it even</span></span></span><br><span class="line">	sed &quot;s/#alias ll=&#x27;ls -l&#x27;/alias ll=&#x27;ls -l&#x27;/&quot; -i &quot;$&#123;SDCARD&#125;&quot;/etc/skel/.bashrc</span><br><span class="line">	sed &quot;s/#alias la=&#x27;ls -A&#x27;/alias la=&#x27;ls -A&#x27;/&quot; -i &quot;$&#123;SDCARD&#125;&quot;/etc/skel/.bashrc</span><br><span class="line">	sed &quot;s/#alias l=&#x27;ls -CF&#x27;/alias l=&#x27;ls -CF&#x27;/&quot; -i &quot;$&#123;SDCARD&#125;&quot;/etc/skel/.bashrc</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">root user is already there. Copy bashrc there as well</span></span></span><br><span class="line">	cp &quot;$&#123;SDCARD&#125;&quot;/etc/skel/.bashrc &quot;$&#123;SDCARD&#125;&quot;/root</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">display welcome message at first root login</span></span></span><br><span class="line">	touch &quot;$&#123;SDCARD&#125;&quot;/root/.not_logged_in_yet</span><br><span class="line"></span><br><span class="line">	if [[ $&#123;DESKTOP_AUTOLOGIN&#125; != no ]]; then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">set desktop autologin</span></span></span><br><span class="line">		touch &quot;$&#123;SDCARD&#125;&quot;/root/.desktop_autologin</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">NOTE: this needs to be executed before family_tweaks</span></span></span><br><span class="line">	local bootscript_src=$&#123;BOOTSCRIPT%%:*&#125;</span><br><span class="line">	local bootscript_dst=$&#123;BOOTSCRIPT##*:&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">create extlinux config file</span></span></span><br><span class="line">	if [[ $SRC_EXTLINUX == yes ]]; then</span><br><span class="line">		mkdir -p $SDCARD/boot/extlinux</span><br><span class="line">		cat &lt;&lt;-EOF &gt; &quot;$SDCARD/boot/extlinux/extlinux.conf&quot;</span><br><span class="line">		label $&#123;VENDOR&#125;</span><br><span class="line">		  kernel /boot/$NAME_KERNEL</span><br><span class="line">		  initrd /boot/$NAME_INITRD</span><br><span class="line">	EOF</span><br><span class="line">		if [[ -n $BOOT_FDT_FILE ]]; then</span><br><span class="line">			if [[ $BOOT_FDT_FILE != &quot;none&quot; ]]; then</span><br><span class="line">				echo &quot;  fdt /boot/dtb/$BOOT_FDT_FILE&quot; &gt;&gt; &quot;$SDCARD/boot/extlinux/extlinux.conf&quot;</span><br><span class="line">			fi</span><br><span class="line">		else</span><br><span class="line">			echo &quot;  fdtdir /boot/dtb/&quot; &gt;&gt; &quot;$SDCARD/boot/extlinux/extlinux.conf&quot;</span><br><span class="line">		fi</span><br><span class="line">	else</span><br><span class="line"></span><br><span class="line">		if [[ &quot;$&#123;BOOTCONFIG&#125;&quot; != &quot;none&quot; ]]; then</span><br><span class="line">			if [ -f &quot;$&#123;USERPATCHES_PATH&#125;/bootscripts/$&#123;bootscript_src&#125;&quot; ]; then</span><br><span class="line">				cp &quot;$&#123;USERPATCHES_PATH&#125;/bootscripts/$&#123;bootscript_src&#125;&quot; &quot;$&#123;SDCARD&#125;/boot/$&#123;bootscript_dst&#125;&quot;</span><br><span class="line">			else</span><br><span class="line">				cp &quot;$&#123;EXTER&#125;/config/bootscripts/$&#123;bootscript_src&#125;&quot; &quot;$&#123;SDCARD&#125;/boot/$&#123;bootscript_dst&#125;&quot;</span><br><span class="line">			fi</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		if [[ -n $BOOTENV_FILE ]]; then</span><br><span class="line">			if [[ -f $USERPATCHES_PATH/bootenv/$BOOTENV_FILE ]]; then</span><br><span class="line">				cp &quot;$USERPATCHES_PATH/bootenv/$&#123;BOOTENV_FILE&#125;&quot; &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt</span><br><span class="line">			elif [[ -f $EXTER/config/bootenv/$BOOTENV_FILE ]]; then</span><br><span class="line">				cp &quot;$&#123;EXTER&#125;/config/bootenv/$&#123;BOOTENV_FILE&#125;&quot; &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt</span><br><span class="line">			fi</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">TODO: modify $bootscript_dst or orangepiEnv.txt to make NFS boot universal</span></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">instead of copying sunxi-specific template</span></span></span><br><span class="line">		if [[ $ROOTFS_TYPE == nfs ]]; then</span><br><span class="line">			display_alert &quot;Copying NFS boot script template&quot;</span><br><span class="line">			if [[ -f $USERPATCHES_PATH/nfs-boot.cmd ]]; then</span><br><span class="line">				cp &quot;$USERPATCHES_PATH&quot;/nfs-boot.cmd &quot;$&#123;SDCARD&#125;&quot;/boot/boot.cmd</span><br><span class="line">			else</span><br><span class="line">				cp &quot;$&#123;EXTER&#125;&quot;/config/templates/nfs-boot.cmd.template &quot;$&#123;SDCARD&#125;&quot;/boot/boot.cmd</span><br><span class="line">			fi</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		[[ -n $OVERLAY_PREFIX &amp;&amp; -f &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt &amp;&amp; ($BRANCH =~ current|next || $BOARDFAMILY =~ &quot;rockchip-rk3588&quot;|&quot;rockchip-rk356x&quot;) ]] &amp;&amp; \</span><br><span class="line">			echo &quot;overlay_prefix=$OVERLAY_PREFIX&quot; &gt;&gt; &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt</span><br><span class="line"></span><br><span class="line">		[[ -n $DEFAULT_OVERLAYS &amp;&amp; -f &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt &amp;&amp; ($BRANCH =~ current|next || $BOARDFAMILY =~ &quot;rockchip-rk3588&quot;|&quot;rockchip-rk356x&quot;) ]] &amp;&amp; \</span><br><span class="line">			echo &quot;overlays=$&#123;DEFAULT_OVERLAYS//,/ &#125;&quot; &gt;&gt; &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt</span><br><span class="line"></span><br><span class="line">		[[ -n $BOOT_FDT_FILE &amp;&amp; -f &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt ]] &amp;&amp; \</span><br><span class="line">			echo &quot;fdtfile=$&#123;BOOT_FDT_FILE&#125;&quot; &gt;&gt; &quot;$&#123;SDCARD&#125;/boot/orangepiEnv.txt&quot;</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">initial date for fake-hwclock</span></span></span><br><span class="line">	date -u &#x27;+%Y-%m-%d %H:%M:%S&#x27; &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/fake-hwclock.data</span><br><span class="line"></span><br><span class="line">	echo &quot;$&#123;HOST&#125;&quot; &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/hostname</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">set hostname in hosts file</span></span></span><br><span class="line">	cat &lt;&lt;-EOF &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/hosts</span><br><span class="line">	127.0.0.1   localhost</span><br><span class="line">	127.0.1.1   $HOST</span><br><span class="line">	::1         localhost $HOST ip6-localhost ip6-loopback</span><br><span class="line">	fe00::0     ip6-localnet</span><br><span class="line">	ff00::0     ip6-mcastprefix</span><br><span class="line">	ff02::1     ip6-allnodes</span><br><span class="line">	ff02::2     ip6-allrouters</span><br><span class="line">	EOF</span><br><span class="line"></span><br><span class="line">	cd $SRC</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Prepare and export caching-related params common to all apt calls below, to maximize apt-cacher-ng usage</span></span></span><br><span class="line">	export APT_EXTRA_DIST_PARAMS=&quot;&quot;</span><br><span class="line">	[[ $NO_APT_CACHER != yes ]] &amp;&amp; APT_EXTRA_DIST_PARAMS=&quot;-o Acquire::http::Proxy=\&quot;http://$&#123;APT_PROXY_ADDR:-localhost:3142&#125;\&quot; -o Acquire::http::Proxy::localhost=\&quot;DIRECT\&quot;&quot;</span><br><span class="line"></span><br><span class="line">	display_alert &quot;Cleaning&quot; &quot;package lists&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;apt-get clean&quot;</span><br><span class="line"></span><br><span class="line">	display_alert &quot;Updating&quot; &quot;package lists&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;apt-get $&#123;APT_EXTRA_DIST_PARAMS&#125; update&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">	display_alert &quot;Temporarily disabling&quot; &quot;initramfs-tools hook for kernel&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;chmod -v -x /etc/kernel/postinst.d/initramfs-tools&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">install family packages</span></span></span><br><span class="line">	if [[ -n $&#123;PACKAGE_LIST_FAMILY&#125; ]]; then</span><br><span class="line">		display_alert &quot;Installing PACKAGE_LIST_FAMILY packages&quot; &quot;$&#123;PACKAGE_LIST_FAMILY&#125;&quot;</span><br><span class="line">		chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;DEBIAN_FRONTEND=noninteractive  apt-get $&#123;APT_EXTRA_DIST_PARAMS&#125; -yqq --no-install-recommends install $PACKAGE_LIST_FAMILY&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">install board packages</span></span></span><br><span class="line">	if [[ -n $&#123;PACKAGE_LIST_BOARD&#125; ]]; then</span><br><span class="line">		display_alert &quot;Installing PACKAGE_LIST_BOARD packages&quot; &quot;$&#123;PACKAGE_LIST_BOARD&#125;&quot;</span><br><span class="line">		chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;DEBIAN_FRONTEND=noninteractive  apt-get $&#123;APT_EXTRA_DIST_PARAMS&#125; -yqq --no-install-recommends install $PACKAGE_LIST_BOARD&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log || &#123; display_alert &quot;Failed to install PACKAGE_LIST_BOARD&quot; &quot;$&#123;PACKAGE_LIST_BOARD&#125;&quot; &quot;err&quot;; exit 2; &#125; </span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">remove family packages</span></span></span><br><span class="line">	if [[ -n $&#123;PACKAGE_LIST_FAMILY_REMOVE&#125; ]]; then</span><br><span class="line">		display_alert &quot;Removing PACKAGE_LIST_FAMILY_REMOVE packages&quot; &quot;$&#123;PACKAGE_LIST_FAMILY_REMOVE&#125;&quot;</span><br><span class="line">		chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;DEBIAN_FRONTEND=noninteractive  apt-get $&#123;APT_EXTRA_DIST_PARAMS&#125; -yqq remove --auto-remove $PACKAGE_LIST_FAMILY_REMOVE&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">remove board packages</span></span></span><br><span class="line">	if [[ -n $&#123;PACKAGE_LIST_BOARD_REMOVE&#125; ]]; then</span><br><span class="line">		display_alert &quot;Removing PACKAGE_LIST_BOARD_REMOVE packages&quot; &quot;$&#123;PACKAGE_LIST_BOARD_REMOVE&#125;&quot;</span><br><span class="line">		for PKG_REMOVE in $&#123;PACKAGE_LIST_BOARD_REMOVE&#125;; do</span><br><span class="line">			chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;DEBIAN_FRONTEND=noninteractive apt-get $&#123;APT_EXTRA_DIST_PARAMS&#125; -yqq remove --auto-remove $&#123;PKG_REMOVE&#125;&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log</span><br><span class="line">		done</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">install u-boot</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">@TODO: add install_bootloader() extension method, refactor into u-boot extension</span></span></span><br><span class="line">	[[ &quot;$&#123;BOOTCONFIG&#125;&quot; != &quot;none&quot; ]] &amp;&amp; &#123;</span><br><span class="line">		if [[ &quot;$&#123;REPOSITORY_INSTALL&#125;&quot; != *u-boot* ]]; then</span><br><span class="line">			UBOOT_VER=$(dpkg --info &quot;$&#123;DEB_STORAGE&#125;/u-boot/$&#123;CHOSEN_UBOOT&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot; | grep Descr | awk &#x27;&#123;print $(NF)&#125;&#x27;)</span><br><span class="line">			install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/u-boot/$&#123;CHOSEN_UBOOT&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot;</span><br><span class="line">		else</span><br><span class="line">			UBOOT_VER=$(dpkg --info &quot;$&#123;DEB_ORANGEPI&#125;/u-boot/$&#123;CHOSEN_UBOOT&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot; | grep Descr | awk &#x27;&#123;print $(NF)&#125;&#x27;)</span><br><span class="line">			install_deb_chroot &quot;$&#123;DEB_ORANGEPI&#125;/u-boot/$&#123;CHOSEN_UBOOT&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot; &quot;orangepi&quot;</span><br><span class="line">		fi</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	call_extension_method &quot;pre_install_kernel_debs&quot;  &lt;&lt; &#x27;PRE_INSTALL_KERNEL_DEBS&#x27;</span><br><span class="line">*called before installing the Armbian-built kernel deb packages*</span><br><span class="line">It is not too late to `unset KERNELSOURCE` here and avoid kernel install.</span><br><span class="line">PRE_INSTALL_KERNEL_DEBS</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">install kernel</span></span></span><br><span class="line">	[[ -n $KERNELSOURCE ]] &amp;&amp; &#123;</span><br><span class="line">		if [[ &quot;$&#123;REPOSITORY_INSTALL&#125;&quot; != *kernel* ]]; then</span><br><span class="line">			VER=$(dpkg --info &quot;$&#123;DEB_STORAGE&#125;/$&#123;CHOSEN_KERNEL&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot; | awk -F&quot;-&quot; &#x27;/Source:/&#123;print $2&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">			install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/$&#123;CHOSEN_KERNEL&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot;</span><br><span class="line">			if [[ -f $&#123;DEB_STORAGE&#125;/$&#123;CHOSEN_KERNEL/image/dtb&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb ]]; then</span><br><span class="line">				install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/$&#123;CHOSEN_KERNEL/image/dtb&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot;</span><br><span class="line">			fi</span><br><span class="line">			if [[ $INSTALL_HEADERS == yes ]]; then</span><br><span class="line">				install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/$&#123;CHOSEN_KERNEL/image/headers&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot;</span><br><span class="line">			else</span><br><span class="line">				cp &quot;$&#123;DEB_STORAGE&#125;/$&#123;CHOSEN_KERNEL/image/headers&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot; &quot;$&#123;SDCARD&#125;&quot;/opt/</span><br><span class="line">			fi</span><br><span class="line">		else</span><br><span class="line">			VER=$(dpkg --info &quot;$&#123;DEB_ORANGEPI&#125;/$&#123;CHOSEN_KERNEL&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot; | grep Descr | awk &#x27;&#123;print $(NF)&#125;&#x27;)</span><br><span class="line">			VER=&quot;$&#123;VER/-$LINUXFAMILY/&#125;&quot;</span><br><span class="line"></span><br><span class="line">			install_deb_chroot &quot;$&#123;DEB_ORANGEPI&#125;/$&#123;CHOSEN_KERNEL&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot; &quot;orangepi&quot;</span><br><span class="line"></span><br><span class="line">			if [[ -f $&#123;DEB_ORANGEPI&#125;/$&#123;CHOSEN_KERNEL/image/dtb&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb ]]; then</span><br><span class="line">				install_deb_chroot &quot;$&#123;DEB_ORANGEPI&#125;/$&#123;CHOSEN_KERNEL/image/dtb&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot; &quot;orangepi&quot;</span><br><span class="line">			fi</span><br><span class="line"></span><br><span class="line">			if [[ $INSTALL_HEADERS == yes ]]; then</span><br><span class="line">				install_deb_chroot &quot;$&#123;DEB_ORANGEPI&#125;/$&#123;CHOSEN_KERNEL/image/headers&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot; &quot;orangepi&quot;</span><br><span class="line">			fi</span><br><span class="line">		fi</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	call_extension_method &quot;post_install_kernel_debs&quot; &lt;&lt; &#x27;POST_INSTALL_KERNEL_DEBS&#x27;</span><br><span class="line">*allow config to do more with the installed kernel/headers*</span><br><span class="line">Called after packages, u-boot, kernel and headers installed in the chroot, but before the BSP is installed.</span><br><span class="line">If `KERNELSOURCE` is (still?) unset after this, Armbian-built firmware will not be installed.</span><br><span class="line">POST_INSTALL_KERNEL_DEBS</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">install board support packages</span></span></span><br><span class="line">	if [[ &quot;$&#123;REPOSITORY_INSTALL&#125;&quot; != *bsp* ]]; then</span><br><span class="line">		install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/$RELEASE/$&#123;BSP_CLI_PACKAGE_FULLNAME&#125;.deb&quot;</span><br><span class="line">	else</span><br><span class="line">		install_deb_chroot &quot;$&#123;DEB_ORANGEPI&#125;/$RELEASE/$&#123;CHOSEN_ROOTFS&#125;_$&#123;BSP_CLI_PACKAGE_FULLNAME&#125;.deb&quot; &quot;orangepi&quot;</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">install orangepi-desktop</span></span></span><br><span class="line">	if [[ &quot;$&#123;REPOSITORY_INSTALL&#125;&quot; != *orangepi-desktop* ]]; then</span><br><span class="line">		if [[ $BUILD_DESKTOP == yes ]]; then</span><br><span class="line">			install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/$&#123;RELEASE&#125;/$&#123;CHOSEN_DESKTOP&#125;_$&#123;REVISION&#125;_all.deb&quot;</span><br><span class="line">			install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/$&#123;RELEASE&#125;/$&#123;BSP_DESKTOP_PACKAGE_FULLNAME&#125;.deb&quot;</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">install display manager and PACKAGE_LIST_DESKTOP_FULL packages if enabled per board</span></span></span><br><span class="line">			desktop_postinstall</span><br><span class="line">		fi</span><br><span class="line">	else</span><br><span class="line">		if [[ $BUILD_DESKTOP == yes ]]; then</span><br><span class="line">			install_deb_chroot &quot;$&#123;CHOSEN_DESKTOP&#125;&quot; &quot;orangepi&quot;</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">install display manager and PACKAGE_LIST_DESKTOP_FULL packages if enabled per board</span></span></span><br><span class="line">			desktop_postinstall</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">install orangepi-firmware</span></span></span><br><span class="line">	if [[ &quot;$&#123;REPOSITORY_INSTALL&#125;&quot; != *orangepi-firmware* ]]; then</span><br><span class="line">		if [[ -f $&#123;DEB_STORAGE&#125;/orangepi-firmware_$&#123;REVISION&#125;_all.deb ]]; then</span><br><span class="line">			install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/orangepi-firmware_$&#123;REVISION&#125;_all.deb&quot;</span><br><span class="line">		fi</span><br><span class="line">	else</span><br><span class="line">		if [[ -f $&#123;DEB_STORAGE&#125;/orangepi-firmware_$&#123;REVISION&#125;_all.deb ]]; then</span><br><span class="line">			install_deb_chroot &quot;$&#123;DEB_ORANGEPI&#125;/orangepi-firmware_$&#123;REVISION&#125;_all.deb&quot; &quot;orangepi&quot;</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">install orangepi-config</span></span></span><br><span class="line">	if [[ &quot;$&#123;PACKAGE_LIST_RM&#125;&quot; != *orangepi-config* ]]; then</span><br><span class="line">		if [[ &quot;$&#123;REPOSITORY_INSTALL&#125;&quot; != *orangepi-config* ]]; then</span><br><span class="line">			if [[ $BUILD_MINIMAL != yes ]]; then</span><br><span class="line">				install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/orangepi-config_$&#123;REVISION&#125;_all.deb&quot;</span><br><span class="line">			fi</span><br><span class="line">		else</span><br><span class="line">			if [[ $BUILD_MINIMAL != yes ]]; then</span><br><span class="line">				install_deb_chroot &quot;$&#123;DEB_ORANGEPI&#125;/orangepi-config_$&#123;REVISION&#125;_all.deb&quot; &quot;orangepi&quot;</span><br><span class="line">			fi</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">install orangepi-zsh</span></span></span><br><span class="line">	if [[ &quot;$&#123;PACKAGE_LIST_RM&#125;&quot; != *orangepi-zsh* ]]; then</span><br><span class="line">		if [[ &quot;$&#123;REPOSITORY_INSTALL&#125;&quot; != *orangepi-zsh* ]]; then</span><br><span class="line">			if [[ $BUILD_MINIMAL != yes ]]; then</span><br><span class="line">				install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/orangepi-zsh_$&#123;REVISION&#125;_all.deb&quot;</span><br><span class="line">			fi</span><br><span class="line">		else</span><br><span class="line">			if [[ $BUILD_MINIMAL != yes ]]; then</span><br><span class="line">				install_deb_chroot &quot;orangepi-zsh&quot; &quot;remote&quot;</span><br><span class="line">			fi</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">install plymouth-theme-orangepi</span></span></span><br><span class="line">	if [[ $PLYMOUTH == yes &amp;&amp; $BUILD_DESKTOP == yes &amp;&amp; $RELEASE != buster ]]; then</span><br><span class="line">		if [[ &quot;$&#123;REPOSITORY_INSTALL&#125;&quot; != *plymouth-theme-orangepi* ]]; then</span><br><span class="line">			install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/orangepi-plymouth-theme_$&#123;REVISION&#125;_all.deb&quot;</span><br><span class="line">		else</span><br><span class="line">			install_deb_chroot &quot;orangepi-plymouth-theme&quot; &quot;remote&quot;</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">install kernel sources</span></span></span><br><span class="line">	if [[ -f $&#123;DEB_STORAGE&#125;/$&#123;CHOSEN_KSRC&#125;_$&#123;REVISION&#125;_all.deb &amp;&amp; $INSTALL_KSRC == yes ]]; then</span><br><span class="line">		install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/$&#123;CHOSEN_KSRC&#125;_$&#123;REVISION&#125;_all.deb&quot;</span><br><span class="line">	elif [[ $INSTALL_KSRC == yes ]]; then</span><br><span class="line">		display_alert &quot;Please set BUILD_KSRC=yes to generate the kernel source package&quot; &quot;&quot; &quot;wrn&quot;</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">install wireguard tools</span></span></span><br><span class="line">	if [[ $WIREGUARD == yes ]]; then</span><br><span class="line">		chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;apt-get -y -qq install wireguard-tools --no-install-recommends&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/debug/install.log 2&gt;&amp;1</span><br><span class="line">	fiinstall_wiringop</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">freeze orangepi packages</span></span></span><br><span class="line">	if [[ $BSPFREEZE == yes ]]; then</span><br><span class="line">		display_alert &quot;Freezing Orange Pi packages&quot; &quot;$BOARD&quot; &quot;info&quot;</span><br><span class="line">		chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;apt-mark hold $&#123;CHOSEN_KERNEL&#125; $&#123;CHOSEN_KERNEL/image/headers&#125; \</span><br><span class="line"><span class="meta prompt_">		linux-u-boot-$</span><span class="language-bash"><span class="string">&#123;BOARD&#125;-$&#123;BRANCH&#125; $&#123;CHOSEN_KERNEL/image/dtb&#125;&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span></span></span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">add orangepi user</span></span></span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;adduser --quiet --disabled-password --shell /bin/bash --home /home/$&#123;OPI_USERNAME&#125; --gecos $&#123;OPI_USERNAME&#125; $&#123;OPI_USERNAME&#125;&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;(echo $&#123;OPI_PWD&#125;;echo $&#123;OPI_PWD&#125;;) | passwd &quot;$&#123;OPI_USERNAME&#125;&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line">	for additionalgroup in sudo netdev audio video disk tty users games dialout plugdev input bluetooth systemd-journal ssh; do</span><br><span class="line">	        chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;usermod -aG $&#123;additionalgroup&#125; $&#123;OPI_USERNAME&#125; 2&gt;/dev/null&quot;</span><br><span class="line">	done</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">fix for gksu in Xenial</span></span></span><br><span class="line">	touch $&#123;SDCARD&#125;/home/$&#123;OPI_USERNAME&#125;/.Xauthority</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;chown $&#123;OPI_USERNAME&#125;:$&#123;OPI_USERNAME&#125; /home/$&#123;OPI_USERNAME&#125;/.Xauthority&quot;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">set up profile sync daemon on desktop systems</span></span></span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;which psd &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line">	if [ $? -eq 0 ]; then</span><br><span class="line">		echo -e &quot;$&#123;OPI_USERNAME&#125; ALL=(ALL) NOPASSWD: /usr/bin/psd-overlay-helper&quot; &gt;&gt; $&#123;SDCARD&#125;/etc/sudoers</span><br><span class="line">		touch $&#123;SDCARD&#125;/home/$&#123;OPI_USERNAME&#125;/.activate_psd</span><br><span class="line">		chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;chown $OPI_USERNAME:$OPI_USERNAME /home/$&#123;OPI_USERNAME&#125;/.activate_psd&quot;</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">remove deb files</span></span></span><br><span class="line">	rm -f &quot;$&#123;SDCARD&#125;&quot;/root/*.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">copy boot splash images</span></span></span><br><span class="line">	cp &quot;$&#123;EXTER&#125;&quot;/packages/blobs/splash/orangepi-u-boot.bmp &quot;$&#123;SDCARD&#125;&quot;/boot/boot.bmp</span><br><span class="line">	cp &quot;$&#123;EXTER&#125;&quot;/packages/blobs/splash/logo.bmp &quot;$&#123;SDCARD&#125;&quot;/boot/logo.bmp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">copy audio.wav and mute.wav</span></span></span><br><span class="line">	cp &quot;$&#123;EXTER&#125;&quot;/packages/blobs/audio_wav/audio.wav &quot;$&#123;SDCARD&#125;&quot;/usr/share/sounds/alsa/</span><br><span class="line">	cp &quot;$&#123;EXTER&#125;&quot;/packages/blobs/audio_wav/mute.wav &quot;$&#123;SDCARD&#125;&quot;/usr/share/sounds/alsa/</span><br><span class="line"></span><br><span class="line">	cp &quot;$&#123;EXTER&#125;&quot;/packages/blobs/test.mp4 &quot;$&#123;SDCARD&#125;&quot;/usr/local/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">copy watchdog test programm</span></span></span><br><span class="line">	cp &quot;$&#123;EXTER&#125;&quot;/packages/blobs/watchdog/watchdog_test_$&#123;ARCH&#125; &quot;$&#123;SDCARD&#125;&quot;/usr/local/bin/watchdog_test</span><br><span class="line"></span><br><span class="line">	[[ -f &quot;$&#123;SDCARD&#125;&quot;/usr/bin/gnome-session ]] &amp;&amp; sed -i &quot;s/user-session.*/user-session=ubuntu-wayland/&quot; $&#123;SDCARD&#125;/etc/lightdm/lightdm.conf.d/22-orangepi-autologin.conf</span><br><span class="line">	[[ -f &quot;$&#123;SDCARD&#125;&quot;/usr/bin/startplasma-x11 ]] &amp;&amp; sed -i &quot;s/user-session.*/user-session=plasma-x11/&quot; $&#123;SDCARD&#125;/etc/lightdm/lightdm.conf.d/22-orangepi-autologin.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">execute $LINUXFAMILY-specific tweaks</span></span></span><br><span class="line">	[[ $(type -t family_tweaks) == function ]] &amp;&amp; family_tweaks</span><br><span class="line"></span><br><span class="line">	call_extension_method &quot;post_family_tweaks&quot; &lt;&lt; &#x27;FAMILY_TWEAKS&#x27;</span><br><span class="line">*customize the tweaks made by $LINUXFAMILY-specific family_tweaks*</span><br><span class="line">It is run after packages are installed in the rootfs, but before enabling additional services.</span><br><span class="line">It allows implementors access to the rootfs (`$&#123;SDCARD&#125;`) in its pristine state after packages are installed.</span><br><span class="line">FAMILY_TWEAKS</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">enable additional services</span></span></span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl --no-reload enable orangepi-firstrun.service &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl --no-reload enable orangepi-firstrun-config.service &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl --no-reload enable orangepi-zram-config.service &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl --no-reload enable orangepi-hardware-optimize.service &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl --no-reload enable orangepi-ramlog.service &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl --no-reload enable orangepi-resize-filesystem.service &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl --no-reload enable orangepi-hardware-monitor.service &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">copy &quot;first run automated config, optional user configured&quot;</span></span></span><br><span class="line"> 	cp $&#123;EXTER&#125;/packages/bsp/orangepi_first_run.txt.template &quot;$&#123;SDCARD&#125;&quot;/boot/orangepi_first_run.txt.template</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string"># switch to beta repository at this stage if building nightly images</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string">[[ $IMAGE_TYPE == nightly ]] \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">	#&amp;&amp; echo &quot;deb http://beta.orangepi.com $RELEASE main $&#123;RELEASE&#125;-utils $&#123;RELEASE&#125;-desktop&quot; \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">	#&gt; &quot;$&#123;SDCARD&#125;&quot;/etc/apt/sources.list.d/orangepi.list</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">Cosmetic fix [FAILED] Failed to start Set console font and keymap at first boot</span></span></span><br><span class="line">	[[ -f &quot;$&#123;SDCARD&#125;&quot;/etc/console-setup/cached_setup_font.sh ]] \</span><br><span class="line">	&amp;&amp; sed -i &quot;s/^printf &#x27;.*/printf &#x27;\\\033\%\%G&#x27;/g&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/console-setup/cached_setup_font.sh</span><br><span class="line">	[[ -f &quot;$&#123;SDCARD&#125;&quot;/etc/console-setup/cached_setup_terminal.sh ]] \</span><br><span class="line">	&amp;&amp; sed -i &quot;s/^printf &#x27;.*/printf &#x27;\\\033\%\%G&#x27;/g&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/console-setup/cached_setup_terminal.sh</span><br><span class="line">	[[ -f &quot;$&#123;SDCARD&#125;&quot;/etc/console-setup/cached_setup_keyboard.sh ]] \</span><br><span class="line">	&amp;&amp; sed -i &quot;s/-u/-x&#x27;/g&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/console-setup/cached_setup_keyboard.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">fix for https://bugs.launchpad.net/ubuntu/+source/blueman/+bug/1542723</span></span></span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;chown root:messagebus /usr/lib/dbus-1.0/dbus-daemon-launch-helper&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;chmod u+s /usr/lib/dbus-1.0/dbus-daemon-launch-helper&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">disable samba NetBIOS over IP name service requests since it hangs when no network is present at boot</span></span></span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl --quiet disable nmbd 2&gt; /dev/null&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">disable low-level kernel messages for non betas</span></span></span><br><span class="line">	if [[ -z $BETA ]]; then</span><br><span class="line">		sed -i &quot;s/^#kernel.printk*/kernel.printk/&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/sysctl.conf</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">disable repeated messages due to xconsole not being installed.</span></span></span><br><span class="line">	[[ -f &quot;$&#123;SDCARD&#125;&quot;/etc/rsyslog.d/50-default.conf ]] &amp;&amp; \</span><br><span class="line">	sed &#x27;/daemon\.\*\;mail.*/,/xconsole/ s/.*/#&amp;/&#x27; -i &quot;$&#123;SDCARD&#125;&quot;/etc/rsyslog.d/50-default.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">disable deprecated parameter</span></span></span><br><span class="line">	sed &#x27;/.*$KLogPermitNonKernelFacility.*/,// s/.*/#&amp;/&#x27; -i &quot;$&#123;SDCARD&#125;&quot;/etc/rsyslog.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">enable getty on multiple serial consoles</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">and adjust the speed if it is defined and different than 115200</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">	# example: SERIALCON=&quot;ttyS0:15000000,ttyGS1&quot;</span></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">	ifs=$IFS</span></span></span><br><span class="line">	for i in $(echo &quot;$&#123;SERIALCON:-&#x27;ttyS0&#x27;&#125;&quot; | sed &quot;s/,/ /g&quot;)</span><br><span class="line">	do</span><br><span class="line">		IFS=&#x27;:&#x27; read -r -a array &lt;&lt;&lt; &quot;$i&quot;</span><br><span class="line">		[[ &quot;$&#123;array[0]&#125;&quot; == &quot;tty1&quot; ]] &amp;&amp; continue # Don&#x27;t enable tty1 as serial console.</span><br><span class="line">		display_alert &quot;Enabling serial console&quot; &quot;$&#123;array[0]&#125;&quot; &quot;info&quot;</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">add serial console to secure tty list</span></span></span><br><span class="line">		[ -z &quot;$(grep -w &#x27;^$&#123;array[0]&#125;&#x27; &quot;$&#123;SDCARD&#125;&quot;/etc/securetty 2&gt; /dev/null)&quot; ] &amp;&amp; \</span><br><span class="line">		echo &quot;$&#123;array[0]&#125;&quot; &gt;&gt;  &quot;$&#123;SDCARD&#125;&quot;/etc/securetty</span><br><span class="line">		if [[ $&#123;array[1]&#125; != &quot;115200&quot; &amp;&amp; -n $&#123;array[1]&#125; ]]; then</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="string">make a copy, fix speed and enable</span></span></span><br><span class="line">			cp &quot;$&#123;SDCARD&#125;&quot;/lib/systemd/system/serial-getty@.service \</span><br><span class="line">			&quot;$&#123;SDCARD&#125;/lib/systemd/system/serial-getty@$&#123;array[0]&#125;.service&quot;</span><br><span class="line">			sed -i &quot;s/--keep-baud 115200/--keep-baud $&#123;array[1]&#125;,115200/&quot; \</span><br><span class="line">			&quot;$&#123;SDCARD&#125;/lib/systemd/system/serial-getty@$&#123;array[0]&#125;.service&quot;</span><br><span class="line">		fi</span><br><span class="line">		chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl daemon-reload&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span><br><span class="line">		chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl --no-reload enable serial-getty@$&#123;array[0]&#125;.service&quot; \</span><br><span class="line"><span class="meta prompt_">		&gt;</span><span class="language-bash"><span class="string">&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span></span></span><br><span class="line">		if [[ &quot;$&#123;array[0]&#125;&quot; == &quot;ttyGS0&quot; &amp;&amp; $LINUXFAMILY == sun8i &amp;&amp; $BRANCH == legacy ]]; then</span><br><span class="line">			mkdir -p &quot;$&#123;SDCARD&#125;&quot;/etc/systemd/system/serial-getty@ttyGS0.service.d</span><br><span class="line">			cat &lt;&lt;-EOF &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/systemd/system/serial-getty@ttyGS0.service.d/10-switch-role.conf</span><br><span class="line">			[Service]</span><br><span class="line">			ExecStartPre=-/bin/sh -c &quot;echo 2 &gt; /sys/bus/platform/devices/sunxi_usb_udc/otg_role&quot;</span><br><span class="line">			EOF</span><br><span class="line">		fi</span><br><span class="line">	done</span><br><span class="line">	IFS=$ifs</span><br><span class="line"></span><br><span class="line">	[[ $LINUXFAMILY == sun*i ]] &amp;&amp; mkdir -p &quot;$&#123;SDCARD&#125;&quot;/boot/overlay-user</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">to prevent creating swap file on NFS (needs specific kernel options)</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">and f2fs/btrfs (not recommended or needs specific kernel options)</span></span></span><br><span class="line">	[[ $ROOTFS_TYPE != ext4 ]] &amp;&amp; touch &quot;$&#123;SDCARD&#125;&quot;/var/swap</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">install initial asound.state if defined</span></span></span><br><span class="line">	mkdir -p &quot;$&#123;SDCARD&#125;&quot;/var/lib/alsa/</span><br><span class="line">	[[ -n $ASOUND_STATE ]] &amp;&amp; cp &quot;$&#123;EXTER&#125;/packages/blobs/asound.state/$&#123;ASOUND_STATE&#125;&quot; &quot;$&#123;SDCARD&#125;&quot;/var/lib/alsa/asound.state</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">save initial orangepi-release state</span></span></span><br><span class="line">	cp &quot;$&#123;SDCARD&#125;&quot;/etc/orangepi-release &quot;$&#123;SDCARD&#125;&quot;/etc/orangepi-image-release</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">DNS fix. package resolvconf is not available everywhere</span></span></span><br><span class="line">	if [ -d /etc/resolvconf/resolv.conf.d ] &amp;&amp; [ -n &quot;$NAMESERVER&quot; ]; then</span><br><span class="line">		echo &quot;nameserver $NAMESERVER&quot; &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/resolvconf/resolv.conf.d/head</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">permit root login via SSH for the first boot</span></span></span><br><span class="line">	sed -i &#x27;s/#\?PermitRootLogin .*/PermitRootLogin yes/&#x27; &quot;$&#123;SDCARD&#125;&quot;/etc/ssh/sshd_config</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">enable PubkeyAuthentication</span></span></span><br><span class="line">	sed -i &#x27;s/#\?PubkeyAuthentication .*/PubkeyAuthentication yes/&#x27; &quot;$&#123;SDCARD&#125;&quot;/etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line">	if [ -f &quot;$&#123;SDCARD&#125;&quot;/etc/NetworkManager/NetworkManager.conf ]; then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">configure network manager</span></span></span><br><span class="line">		sed &quot;s/managed=\(.*\)/managed=true/g&quot; -i &quot;$&#123;SDCARD&#125;&quot;/etc/NetworkManager/NetworkManager.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">remove network manager defaults to handle eth by default</span></span></span><br><span class="line">		rm -f &quot;$&#123;SDCARD&#125;&quot;/usr/lib/NetworkManager/conf.d/10-globally-managed-devices.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="string">most likely we don&#x27;</span>t need to <span class="built_in">wait</span> <span class="keyword">for</span> nm to get online</span></span><br><span class="line">		chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl disable NetworkManager-wait-online.service&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">Just regular DNS and maintain /etc/resolv.conf as a file</span></span><br><span class="line">		sed &quot;/dns/d&quot; -i &quot;$&#123;SDCARD&#125;&quot;/etc/NetworkManager/NetworkManager.conf</span><br><span class="line">		sed &quot;s/\[main\]/\[main\]\ndns=default\nrc-manager=file/g&quot; -i &quot;$&#123;SDCARD&#125;&quot;/etc/NetworkManager/NetworkManager.conf</span><br><span class="line">		if [[ -n $NM_IGNORE_DEVICES ]]; then</span><br><span class="line">			mkdir -p &quot;$&#123;SDCARD&#125;&quot;/etc/NetworkManager/conf.d/</span><br><span class="line">			cat &lt;&lt;-EOF &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/NetworkManager/conf.d/10-ignore-interfaces.conf</span><br><span class="line">			[keyfile]</span><br><span class="line">			unmanaged-devices=$NM_IGNORE_DEVICES</span><br><span class="line">			EOF</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">	elif [ -d &quot;$&#123;SDCARD&#125;&quot;/etc/systemd/network ]; then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">configure networkd</span></span><br><span class="line">		rm &quot;$&#123;SDCARD&#125;&quot;/etc/resolv.conf</span><br><span class="line">		ln -s /run/systemd/resolve/resolv.conf &quot;$&#123;SDCARD&#125;&quot;/etc/resolv.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="built_in">enable</span> services</span></span><br><span class="line">		chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl enable systemd-networkd.service systemd-resolved.service&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">		if  [ -e /etc/systemd/timesyncd.conf ]; then</span><br><span class="line">			chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl enable systemd-timesyncd.service&quot; &gt;&gt; &quot;$&#123;DEST&#125;&quot;/$&#123;LOG_SUBPATH&#125;/install.log 2&gt;&amp;1</span><br><span class="line">		fi</span><br><span class="line">		umask 022</span><br><span class="line">		cat &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/systemd/network/eth0.network &lt;&lt;- __EOF__</span><br><span class="line">		[Match]</span><br><span class="line">		Name=eth0</span><br><span class="line"></span><br><span class="line">		[Network]</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">MACAddress=</span></span><br><span class="line">		DHCP=ipv4</span><br><span class="line">		LinkLocalAddressing=ipv4</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">Address=192.168.1.100/24</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">Gateway=192.168.1.1</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">DNS=192.168.1.1</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">Domains=example.com</span></span><br><span class="line">		NTP=0.pool.ntp.org 1.pool.ntp.org</span><br><span class="line">		__EOF__</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">avahi daemon defaults <span class="keyword">if</span> exists</span></span><br><span class="line">	[[ -f &quot;$&#123;SDCARD&#125;&quot;/usr/share/doc/avahi-daemon/examples/sftp-ssh.service ]] &amp;&amp; \</span><br><span class="line">	cp &quot;$&#123;SDCARD&#125;&quot;/usr/share/doc/avahi-daemon/examples/sftp-ssh.service &quot;$&#123;SDCARD&#125;&quot;/etc/avahi/services/</span><br><span class="line">	[[ -f &quot;$&#123;SDCARD&#125;&quot;/usr/share/doc/avahi-daemon/examples/ssh.service ]] &amp;&amp; \</span><br><span class="line">	cp &quot;$&#123;SDCARD&#125;&quot;/usr/share/doc/avahi-daemon/examples/ssh.service &quot;$&#123;SDCARD&#125;&quot;/etc/avahi/services/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">nsswitch settings <span class="keyword">for</span> sane DNS behavior: remove resolve, assure libnss-myhostname support</span></span><br><span class="line">	sed &quot;s/hosts\:.*/hosts:          files mymachines dns myhostname/g&quot; -i &quot;$&#123;SDCARD&#125;&quot;/etc/nsswitch.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">build logo <span class="keyword">in</span> any <span class="keyword">case</span></span></span><br><span class="line">	boot_logo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="built_in">disable</span> MOTD <span class="keyword">for</span> first boot - we want as clean 1st run as possible</span></span><br><span class="line">	chmod -x &quot;$&#123;SDCARD&#125;&quot;/etc/update-motd.d/*</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">install_rclocal()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	if [[ $BURN_IMAGE == yes ]]; then</span><br><span class="line"></span><br><span class="line">		cat &lt;&lt;-EOF &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/rc.local</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">!/bin/sh -e</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">		<span class="comment"># rc.local</span></span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">		<span class="comment"># This script is executed at the end of each multiuser runlevel.</span></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">Make sure that the script will <span class="string">&quot;exit 0&quot;</span> on success or any other</span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">value on error.</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">		<span class="comment"># In order to enable or disable this script just change the execution</span></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">bits.</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">		<span class="comment"># By default this script does nothing.</span></span></span><br><span class="line"></span><br><span class="line">		burn_to_emmc</span><br><span class="line"></span><br><span class="line">		exit 0</span><br><span class="line">		EOF</span><br><span class="line"></span><br><span class="line">	else</span><br><span class="line"></span><br><span class="line">		cat &lt;&lt;-EOF &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/rc.local</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">!/bin/sh -e</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">		<span class="comment"># rc.local</span></span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">		<span class="comment"># This script is executed at the end of each multiuser runlevel.</span></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">Make sure that the script will <span class="string">&quot;exit 0&quot;</span> on success or any other</span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">value on error.</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">		<span class="comment"># In order to enable or disable this script just change the execution</span></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">bits.</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">		<span class="comment"># By default this script does nothing.</span></span></span><br><span class="line"></span><br><span class="line">		exit 0</span><br><span class="line">		EOF</span><br><span class="line"></span><br><span class="line">	fi</span><br><span class="line">	chmod +x &quot;$&#123;SDCARD&#125;&quot;/etc/rc.local</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">install_distribution_specific()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	display_alert &quot;Applying distribution specific tweaks for&quot; &quot;$RELEASE&quot; &quot;info&quot;</span><br><span class="line"></span><br><span class="line">	case $RELEASE in</span><br><span class="line"></span><br><span class="line">	xenial)</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">remove legal info from Ubuntu</span></span><br><span class="line">			[[ -f &quot;$&#123;SDCARD&#125;&quot;/etc/legal ]] &amp;&amp; rm &quot;$&#123;SDCARD&#125;&quot;/etc/legal</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">ureadahead needs kernel tracing options that AFAIK are present only <span class="keyword">in</span> mainline. <span class="built_in">disable</span></span></span><br><span class="line">			chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c \</span><br><span class="line">			&quot;systemctl --no-reload mask ondemand.service ureadahead.service &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line">			chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c \</span><br><span class="line">			&quot;systemctl --no-reload mask setserial.service etc-setserial.service &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line"></span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">	stretch|buster|sid)</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">remove doubled <span class="built_in">uname</span> from motd</span></span><br><span class="line">			[[ -f &quot;$&#123;SDCARD&#125;&quot;/etc/update-motd.d/10-uname ]] &amp;&amp; rm &quot;$&#123;SDCARD&#125;&quot;/etc/update-motd.d/10-uname</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">rc.local is not existing but one might need it</span></span><br><span class="line">			install_rclocal</span><br><span class="line"></span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">	bullseye)</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">remove doubled <span class="built_in">uname</span> from motd</span></span><br><span class="line">			[[ -f &quot;$&#123;SDCARD&#125;&quot;/etc/update-motd.d/10-uname ]] &amp;&amp; rm &quot;$&#123;SDCARD&#125;&quot;/etc/update-motd.d/10-uname</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">rc.local is not existing but one might need it</span></span><br><span class="line">			install_rclocal</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">fix missing versioning</span></span><br><span class="line">			[[ $(grep -L &quot;VERSION_ID=&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/os-release) ]] &amp;&amp; echo &#x27;VERSION_ID=&quot;11&quot;&#x27; &gt;&gt; &quot;$&#123;SDCARD&#125;&quot;/etc/os-release</span><br><span class="line">			[[ $(grep -L &quot;VERSION=&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/os-release) ]] &amp;&amp; echo &#x27;VERSION=&quot;11 (bullseye)&quot;&#x27; &gt;&gt; &quot;$&#123;SDCARD&#125;&quot;/etc/os-release</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		;;</span><br><span class="line">	</span><br><span class="line">	bookworm)</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">remove doubled <span class="built_in">uname</span> from motd</span></span><br><span class="line">			[[ -f &quot;$&#123;SDCARD&#125;&quot;/etc/update-motd.d/10-uname ]] &amp;&amp; rm &quot;$&#123;SDCARD&#125;&quot;/etc/update-motd.d/10-uname</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">rc.local is not existing but one might need it</span></span><br><span class="line">			install_rclocal</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">fix missing versioning</span></span><br><span class="line">			[[ $(grep -L &quot;VERSION_ID=&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/os-release) ]] &amp;&amp; echo &#x27;VERSION_ID=&quot;12&quot;&#x27; &gt;&gt; &quot;$&#123;SDCARD&#125;&quot;/etc/os-release</span><br><span class="line">			[[ $(grep -L &quot;VERSION=&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/os-release) ]] &amp;&amp; echo &#x27;VERSION=&quot;11 (bookworm)&quot;&#x27; &gt;&gt; &quot;$&#123;SDCARD&#125;&quot;/etc/os-release</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">remove security updates repository since it does not exists yet</span></span><br><span class="line">			sed &#x27;/security/ d&#x27; -i &quot;$&#123;SDCARD&#125;&quot;/etc/apt/sources.list</span><br><span class="line"></span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">	bionic|focal|hirsute|impish|jammy)</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">by using default lz4 initrd compression leads to corruption, go back to proven method</span></span><br><span class="line">			sed -i &quot;s/^COMPRESS=.*/COMPRESS=gzip/&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/initramfs-tools/initramfs.conf</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">cleanup motd services and related files</span></span><br><span class="line">			chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl disable  motd-news.service &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line">			chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl disable  motd-news.timer &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line"></span><br><span class="line">			rm -f &quot;$&#123;SDCARD&#125;&quot;/etc/update-motd.d/&#123;10-uname,10-help-text,50-motd-news,80-esm,80-livepatch,90-updates-available,91-release-upgrade,95-hwe-eol&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">remove motd news from motd.ubuntu.com</span></span><br><span class="line">			[[ -f &quot;$&#123;SDCARD&#125;&quot;/etc/default/motd-news ]] &amp;&amp; sed -i &quot;s/^ENABLED=.*/ENABLED=0/&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/default/motd-news</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">rc.local is not existing but one might need it</span></span><br><span class="line">			install_rclocal</span><br><span class="line"></span><br><span class="line">			if [ -d &quot;$&#123;SDCARD&#125;&quot;/etc/NetworkManager ]; then</span><br><span class="line">				local RENDERER=NetworkManager</span><br><span class="line">			else</span><br><span class="line">				local RENDERER=networkd</span><br><span class="line">			fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">Basic Netplan config. Let NetworkManager/networkd manage all devices on this system</span></span><br><span class="line">			[[ -d &quot;$&#123;SDCARD&#125;&quot;/etc/netplan ]] &amp;&amp; cat &lt;&lt;-EOF &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/netplan/orangepi-default.yaml</span><br><span class="line">			network:</span><br><span class="line">			  version: 2</span><br><span class="line">			  renderer: $RENDERER</span><br><span class="line">			EOF</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">DNS fix</span></span><br><span class="line">			if [ -n &quot;$NAMESERVER&quot; ]; then</span><br><span class="line">				sed -i &quot;s/#DNS=.*/DNS=$NAMESERVER/g&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/systemd/resolved.conf</span><br><span class="line">			fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">Journal service adjustements</span></span><br><span class="line">			sed -i &quot;s/#Storage=.*/Storage=volatile/g&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/systemd/journald.conf</span><br><span class="line">			sed -i &quot;s/#Compress=.*/Compress=yes/g&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/systemd/journald.conf</span><br><span class="line">			sed -i &quot;s/#RateLimitIntervalSec=.*/RateLimitIntervalSec=30s/g&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/systemd/journald.conf</span><br><span class="line">			sed -i &quot;s/#RateLimitBurst=.*/RateLimitBurst=10000/g&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/systemd/journald.conf</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">Chrony temporal fix https://bugs.launchpad.net/ubuntu/+<span class="built_in">source</span>/chrony/+bug/1878005</span></span><br><span class="line">			sed -i &#x27;/DAEMON_OPTS=/s/&quot;-F -1&quot;/&quot;-F 0&quot;/&#x27; &quot;$&#123;SDCARD&#125;&quot;/etc/default/chrony</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="built_in">disable</span> conflicting services</span></span><br><span class="line">			chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl --no-reload mask ondemand.service &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line"></span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">	esac</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">use list modules INITRAMFS</span></span><br><span class="line">	if [ -f &quot;$&#123;EXTER&#125;&quot;/config/modules/&quot;$&#123;MODULES_INITRD&#125;&quot; ]; then</span><br><span class="line">		display_alert &quot;Use file list modules INITRAMFS&quot; &quot;$&#123;MODULES_INITRD&#125;&quot;</span><br><span class="line">		sed -i &quot;s/^MODULES=.*/MODULES=list/&quot; &quot;$&#123;SDCARD&#125;&quot;/etc/initramfs-tools/initramfs.conf</span><br><span class="line">		cat &quot;$&#123;EXTER&#125;&quot;/config/modules/&quot;$&#123;MODULES_INITRD&#125;&quot; &gt;&gt; &quot;$&#123;SDCARD&#125;&quot;/etc/initramfs-tools/modules</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">post_debootstrap_tweaks()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">remove service start blockers and QEMU binary</span></span><br><span class="line">	rm -f &quot;$&#123;SDCARD&#125;&quot;/sbin/initctl &quot;$&#123;SDCARD&#125;&quot;/sbin/start-stop-daemon</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;dpkg-divert --quiet --local --rename --remove /sbin/initctl&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;dpkg-divert --quiet --local --rename --remove /sbin/start-stop-daemon&quot;</span><br><span class="line">	rm -f &quot;$&#123;SDCARD&#125;&quot;/usr/sbin/policy-rc.d &quot;$&#123;SDCARD&#125;/usr/bin/$&#123;QEMU_BINARY&#125;&quot;</span><br><span class="line"></span><br><span class="line">	call_extension_method &quot;post_post_debootstrap_tweaks&quot; &quot;config_post_debootstrap_tweaks&quot; &lt;&lt; &#x27;POST_POST_DEBOOTSTRAP_TWEAKS&#x27;</span><br><span class="line">*run after removing diversions and qemu with chroot unmounted*</span><br><span class="line">Last chance to touch the `$&#123;SDCARD&#125;` filesystem before it is copied to the final media.</span><br><span class="line">It is too late to run any chrooted commands, since the supporting filesystems are already unmounted.</span><br><span class="line">POST_POST_DEBOOTSTRAP_TWEAKS</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">on_chroot()</span><br><span class="line">&#123;</span><br><span class="line">	if [ &quot;$SETFCAP&quot; != &quot;1&quot; ]; then</span><br><span class="line">		export CAPSH_ARG=&quot;--drop=cap_setfcap&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	capsh $CAPSH_ARG &quot;--chroot=$&#123;ROOTFS_DIR&#125;/&quot; -- -e &quot;$@&quot;</span><br><span class="line">&#125;</span><br><span class="line">export -f on_chroot</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shellcheck <span class="built_in">disable</span>=SC2119</span></span><br><span class="line">run_sub_stage()</span><br><span class="line">&#123;</span><br><span class="line">	log &quot;Begin $&#123;SUB_STAGE_DIR&#125;&quot;</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="built_in">pushd</span> <span class="string">&quot;<span class="variable">$&#123;SUB_STAGE_DIR&#125;</span>&quot;</span> &gt; /dev/null</span></span><br><span class="line">	cd $&#123;SUB_STAGE_DIR&#125;</span><br><span class="line"></span><br><span class="line">	for i in &#123;00..99&#125;; do</span><br><span class="line">		if [ -f &quot;$&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-debconf&quot; ]; then</span><br><span class="line">			display_alert &quot;Begin $&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-debconf&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line">			on_chroot &lt;&lt; EOF</span><br><span class="line">debconf-set-selections &lt;&lt;SELEOF</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">(<span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$&#123;i&#125;</span>-debconf&quot;</span>)</span></span><br><span class="line">SELEOF</span><br><span class="line">EOF</span><br><span class="line">			display_alert &quot;End $&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-debconf&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line">		fi</span><br><span class="line">		if [ -f &quot;$&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-packages-nr&quot; ]; then</span><br><span class="line">			display_alert &quot;Begin $&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-packages-nr&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line">			PACKAGES=&quot;$(sed -f &quot;$&#123;EXTER&#125;/packages/raspi/scripts/remove-comments.sed&quot; &lt; &quot;$&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-packages-nr&quot;)&quot;</span><br><span class="line">			if [ -n &quot;$PACKAGES&quot; ]; then</span><br><span class="line">				on_chroot &lt;&lt; EOF</span><br><span class="line">apt-get -o Acquire::Retries=3 install --no-install-recommends -y $PACKAGES</span><br><span class="line">EOF</span><br><span class="line">			fi</span><br><span class="line">			display_alert &quot;End $&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-packages-nr&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line">		fi</span><br><span class="line">		if [ -f &quot;$&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-packages&quot; ]; then</span><br><span class="line">			display_alert &quot;Begin $&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-packages&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line">			PACKAGES=&quot;$(sed -f &quot;$&#123;EXTER&#125;/packages/raspi/scripts/remove-comments.sed&quot; &lt; &quot;$&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-packages&quot;)&quot;</span><br><span class="line">			if [ -n &quot;$PACKAGES&quot; ]; then</span><br><span class="line">				on_chroot &lt;&lt; EOF</span><br><span class="line">apt-get -o Acquire::Retries=3 install -y $PACKAGES</span><br><span class="line">EOF</span><br><span class="line">			fi</span><br><span class="line">			display_alert &quot;End $&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-packages&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line">                fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">               <span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$&#123;SUB_STAGE_DIR&#125;</span>/<span class="variable">$&#123;i&#125;</span>-patches&quot;</span> ]; <span class="keyword">then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       <span class="built_in">log</span> <span class="string">&quot;Begin <span class="variable">$&#123;SUB_STAGE_DIR&#125;</span>/<span class="variable">$&#123;i&#125;</span>-patches&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       <span class="built_in">pushd</span> <span class="string">&quot;<span class="variable">$&#123;STAGE_WORK_DIR&#125;</span>&quot;</span> &gt; /dev/null</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       <span class="comment">#cd $&#123;STAGE_WORK_DIR&#125;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#                        QUILT_PATCHES=&quot;$&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-patches&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       SUB_STAGE_QUILT_PATCH_DIR=<span class="string">&quot;<span class="subst">$(basename <span class="string">&quot;<span class="variable">$SUB_STAGE_DIR</span>&quot;</span>)</span>-pc&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$STAGE_WORK_DIR</span>/<span class="variable">$SUB_STAGE_QUILT_PATCH_DIR</span>&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       <span class="built_in">ln</span> -snf <span class="string">&quot;<span class="variable">$STAGE_WORK_DIR</span>/<span class="variable">$SUB_STAGE_QUILT_PATCH_DIR</span>&quot;</span> .pc</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       <span class="built_in">ln</span> -snfv <span class="string">&quot;<span class="variable">$&#123;ROOTFS_DIR&#125;</span>&quot;</span> <span class="variable">$&#123;STAGE_WORK_DIR&#125;</span>/rootfs</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       quilt upgrade</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       <span class="keyword">if</span> [ -e <span class="string">&quot;<span class="variable">$&#123;SUB_STAGE_DIR&#125;</span>/<span class="variable">$&#123;i&#125;</span>-patches/EDIT&quot;</span> ]; <span class="keyword">then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                               <span class="built_in">echo</span> <span class="string">&quot;Dropping into bash to edit patches...&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                               bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       <span class="keyword">fi</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       RC=0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       quilt push -a || RC=$?</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$RC</span>&quot;</span> <span class="keyword">in</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                               0|2)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                                       ;;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                               *)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                                       <span class="literal">false</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                                       ;;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       <span class="keyword">esac</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       <span class="comment">#popd &gt; /dev/null</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">			<span class="built_in">cd</span> -</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                       <span class="built_in">log</span> <span class="string">&quot;End <span class="variable">$&#123;SUB_STAGE_DIR&#125;</span>/<span class="variable">$&#123;i&#125;</span>-patches&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">               <span class="keyword">fi</span></span></span><br><span class="line">		if [ -x $&#123;i&#125;-run.sh ]; then</span><br><span class="line">			display_alert &quot;Begin $&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-run.sh&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line">			./$&#123;i&#125;-run.sh</span><br><span class="line">			display_alert &quot;End $&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-run.sh&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line">		fi</span><br><span class="line">		if [ -f $&#123;i&#125;-run-chroot.sh ]; then</span><br><span class="line">			display_alert &quot;Begin $&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-run-chroot.sh&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line">			on_chroot &lt; $&#123;i&#125;-run-chroot.sh</span><br><span class="line">			display_alert &quot;End $&#123;SUB_STAGE_DIR&#125;/$&#123;i&#125;-run-chroot.sh&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line">		fi</span><br><span class="line">	done</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="built_in">popd</span> &gt; /dev/null</span></span><br><span class="line">	log &quot;End $&#123;SUB_STAGE_DIR&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">run_stage()&#123;</span><br><span class="line">	rm -rf &quot;$&#123;SRC&#125;&quot;/output/raspi</span><br><span class="line">	[[ ! -d &quot;$&#123;SRC&#125;&quot;/output/raspi ]] &amp;&amp; mkdir -p &quot;$&#123;SRC&#125;&quot;/output/raspi</span><br><span class="line"></span><br><span class="line">	STAGE_WORK_DIR=&quot;$&#123;SRC&#125;/output/raspi&quot;</span><br><span class="line"></span><br><span class="line">	if [ ! -f $&#123;STAGE_DIR&#125;/SKIP ]; then</span><br><span class="line">		if [ -x $&#123;STAGE_DIR&#125;/prerun.sh ]; then</span><br><span class="line">			display_alert &quot;Begin $&#123;STAGE_DIR&#125;/prerun.sh&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line">			source $&#123;STAGE_DIR&#125;/prerun.sh</span><br><span class="line">			display_alert &quot;End $&#123;STAGE_DIR&#125;/prerun.sh&quot; &quot;&quot; &quot;info&quot;</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		for SUB_STAGE_DIR in &quot;$&#123;STAGE_DIR&#125;&quot;/*; do</span><br><span class="line">			if [ -d &quot;$&#123;SUB_STAGE_DIR&#125;&quot; ] &amp;&amp; [ ! -f &quot;$&#123;SUB_STAGE_DIR&#125;/SKIP&quot; ]; then</span><br><span class="line">				run_sub_stage</span><br><span class="line">			fi</span><br><span class="line">		done</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">log ()</span><br><span class="line">&#123;</span><br><span class="line">	date +&quot;[%T] $*&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">install_opi_specific()</span><br><span class="line">&#123;</span><br><span class="line">	cd $SRC</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">install u-boot</span></span><br><span class="line">	UBOOT_VER=$(dpkg --info &quot;$&#123;InstallingDEB_STORAGE&#125;/u-boot/$&#123;CHOSEN_UBOOT&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot; | grep Descr | awk &#x27;&#123;print $(NF)&#125;&#x27;)</span><br><span class="line">	install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/u-boot/$&#123;CHOSEN_UBOOT&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">install kernel</span></span><br><span class="line">	VER=$(dpkg --info &quot;$&#123;DEB_STORAGE&#125;/$&#123;CHOSEN_KERNEL&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot; | awk -F&quot;-&quot; &#x27;/Source:/&#123;print $2&#125;&#x27;)</span><br><span class="line">	install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/$&#123;CHOSEN_KERNEL&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot;</span><br><span class="line">	if [[ -f $&#123;DEB_STORAGE&#125;/$&#123;CHOSEN_KERNEL/image/dtb&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb ]]; then</span><br><span class="line">		install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/$&#123;CHOSEN_KERNEL/image/dtb&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot;</span><br><span class="line">	fi</span><br><span class="line">	if [[ $INSTALL_HEADERS == yes ]]; then</span><br><span class="line">		install_deb_chroot &quot;$&#123;DEB_STORAGE&#125;/$&#123;CHOSEN_KERNEL/image/headers&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot;</span><br><span class="line">	else</span><br><span class="line">		cp &quot;$&#123;DEB_STORAGE&#125;/$&#123;CHOSEN_KERNEL/image/headers&#125;_$&#123;REVISION&#125;_$&#123;ARCH&#125;.deb&quot; &quot;$&#123;SDCARD&#125;&quot;/opt/</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	dpkg_install_deb_chroot &quot;$EXTER/packages/raspi/orangepi/debs/raspi-config_20230214_all.deb&quot;</span><br><span class="line"></span><br><span class="line">	case $&#123;BOARDFAMILY&#125; in</span><br><span class="line">		&quot;rockchip-rk356x&quot;)</span><br><span class="line">			rk356x_gpu_vpu_tweaks_for_raspios</span><br><span class="line">	esac</span><br><span class="line"></span><br><span class="line">	[[ ! -d &quot;$&#123;SDCARD&#125;/lib/firmware&quot; ]] &amp;&amp; mkdir -p &quot;$&#123;SDCARD&#125;/lib/firmware&quot;</span><br><span class="line">	cp -rfa $&#123;EXTER&#125;/cache/sources/orangepi-firmware-git/* $&#123;SDCARD&#125;/lib/firmware/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">NOTE: this needs to be executed before family_tweaks</span></span><br><span class="line">	local bootscript_src=$&#123;BOOTSCRIPT%%:*&#125;</span><br><span class="line">	local bootscript_dst=$&#123;BOOTSCRIPT##*:&#125;</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$&#123;BOOTCONFIG&#125;&quot; != &quot;none&quot; ]]; then</span><br><span class="line">		if [ -f &quot;$&#123;USERPATCHES_PATH&#125;/bootscripts/$&#123;bootscript_src&#125;&quot; ]; then</span><br><span class="line">			cp &quot;$&#123;USERPATCHES_PATH&#125;/bootscripts/$&#123;bootscript_src&#125;&quot; &quot;$&#123;SDCARD&#125;/boot/$&#123;bootscript_dst&#125;&quot;</span><br><span class="line">		else</span><br><span class="line">			cp &quot;$&#123;EXTER&#125;/config/bootscripts/$&#123;bootscript_src&#125;&quot; &quot;$&#123;SDCARD&#125;/boot/$&#123;bootscript_dst&#125;&quot;</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ -n $BOOTENV_FILE ]]; then</span><br><span class="line">		if [[ -f $USERPATCHES_PATH/bootenv/$BOOTENV_FILE ]]; then</span><br><span class="line">			cp &quot;$USERPATCHES_PATH/bootenv/$&#123;BOOTENV_FILE&#125;&quot; &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt</span><br><span class="line">		elif [[ -f $EXTER/config/bootenv/$BOOTENV_FILE ]]; then</span><br><span class="line">			cp &quot;$&#123;EXTER&#125;/config/bootenv/$&#123;BOOTENV_FILE&#125;&quot; &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	[[ -n $OVERLAY_PREFIX &amp;&amp; -f &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt &amp;&amp; ($BRANCH =~ current|next || $BOARDFAMILY =~ &quot;rockchip-rk3588&quot;|&quot;rockchip-rk356x&quot;) ]] &amp;&amp; \</span><br><span class="line">		echo &quot;overlay_prefix=$OVERLAY_PREFIX&quot; &gt;&gt; &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt</span><br><span class="line"></span><br><span class="line">	[[ -n $DEFAULT_OVERLAYS &amp;&amp; -f &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt &amp;&amp; ($BRANCH =~ current|next || $BOARDFAMILY =~ &quot;rockchip-rk3588&quot;|&quot;rockchip-rk356x&quot;) ]] &amp;&amp; \</span><br><span class="line">		echo &quot;overlays=$&#123;DEFAULT_OVERLAYS//,/ &#125;&quot; &gt;&gt; &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt</span><br><span class="line"></span><br><span class="line">	[[ -n $BOOT_FDT_FILE &amp;&amp; -f &quot;$&#123;SDCARD&#125;&quot;/boot/orangepiEnv.txt ]] &amp;&amp; \</span><br><span class="line">		echo &quot;fdtfile=$&#123;BOOT_FDT_FILE&#125;&quot; &gt;&gt; &quot;$&#123;SDCARD&#125;/boot/orangepiEnv.txt&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">install initial asound.state <span class="keyword">if</span> defined</span></span><br><span class="line">	mkdir -p &quot;$&#123;SDCARD&#125;&quot;/var/lib/alsa/</span><br><span class="line">	[[ -n $ASOUND_STATE ]] &amp;&amp; cp &quot;$&#123;EXTER&#125;/packages/blobs/asound.state/$&#123;ASOUND_STATE&#125;&quot; &quot;$&#123;SDCARD&#125;&quot;/var/lib/alsa/asound.state</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">create modules file</span></span><br><span class="line">	local modules=MODULES_$&#123;BRANCH^^&#125;</span><br><span class="line">	if [[ -n &quot;$&#123;!modules&#125;&quot; ]]; then</span><br><span class="line">		tr &#x27; &#x27; &#x27;\n&#x27; &lt;&lt;&lt; &quot;$&#123;!modules&#125;&quot; &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/modules</span><br><span class="line">	elif [[ -n &quot;$&#123;MODULES&#125;&quot; ]]; then</span><br><span class="line">		tr &#x27; &#x27; &#x27;\n&#x27; &lt;&lt;&lt; &quot;$&#123;MODULES&#125;&quot; &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/modules</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">create blacklist files</span></span><br><span class="line">	local blacklist=MODULES_BLACKLIST_$&#123;BRANCH^^&#125;</span><br><span class="line">	if [[ -n &quot;$&#123;!blacklist&#125;&quot; ]]; then</span><br><span class="line">		tr &#x27; &#x27; &#x27;\n&#x27; &lt;&lt;&lt; &quot;$&#123;!blacklist&#125;&quot; | sed -e &#x27;s/^/blacklist /&#x27; &gt; &quot;$&#123;SDCARD&#125;/etc/modprobe.d/blacklist-$&#123;BOARD&#125;.conf&quot;</span><br><span class="line">	elif [[ -n &quot;$&#123;MODULES_BLACKLIST&#125;&quot; ]]; then</span><br><span class="line">		tr &#x27; &#x27; &#x27;\n&#x27; &lt;&lt;&lt; &quot;$&#123;MODULES_BLACKLIST&#125;&quot; | sed -e &#x27;s/^/blacklist /&#x27; &gt; &quot;$&#123;SDCARD&#125;/etc/modprobe.d/blacklist-$&#123;BOARD&#125;.conf&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	cat &lt;&lt;-EOF &gt; &quot;$&#123;SDCARD&#125;&quot;/etc/orangepi-release</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">PLEASE DO NOT EDIT THIS FILE</span></span><br><span class="line">	BOARD=$&#123;BOARD&#125;</span><br><span class="line">	BOARD_NAME=&quot;$BOARD_NAME&quot;</span><br><span class="line">	BOARDFAMILY=$&#123;BOARDFAMILY&#125;</span><br><span class="line">	BUILD_REPOSITORY_URL=$&#123;BUILD_REPOSITORY_URL&#125;</span><br><span class="line">	BUILD_REPOSITORY_COMMIT=$&#123;BUILD_REPOSITORY_COMMIT&#125;</span><br><span class="line">	DISTRIBUTION_CODENAME=$&#123;RELEASE&#125;</span><br><span class="line">	DISTRIBUTION_STATUS=$&#123;DISTRIBUTION_STATUS&#125;</span><br><span class="line">	VERSION=$&#123;REVISION&#125;</span><br><span class="line">	LINUXFAMILY=$&#123;LINUXFAMILY&#125;</span><br><span class="line">	ARCH=$&#123;ARCHITECTURE&#125;</span><br><span class="line">	IMAGE_TYPE=$IMAGE_TYPE</span><br><span class="line">	BOARD_TYPE=$BOARD_TYPE</span><br><span class="line">	INITRD_ARCH=$&#123;INITRD_ARCH&#125;</span><br><span class="line">	KERNEL_IMAGE_TYPE=$&#123;KERNEL_IMAGE_TYPE&#125;</span><br><span class="line">	BRANCH=$&#123;BRANCH&#125;</span><br><span class="line">	EOF</span><br><span class="line"></span><br><span class="line">	install -d &quot;$&#123;SDCARD&#125;/etc/initramfs/post-update.d/&quot;</span><br><span class="line">	install -m 755 &quot;$&#123;EXTER&#125;/packages/bsp/common/etc/initramfs/post-update.d/99-uboot&quot; &quot;$&#123;SDCARD&#125;/etc/initramfs/post-update.d/&quot;</span><br><span class="line"></span><br><span class="line">	install -m 755 &quot;$&#123;EXTER&#125;/packages/raspi/orangepi/common/files/hciattach_opi&quot; &quot;$&#123;SDCARD&#125;/usr/bin/&quot;</span><br><span class="line">	install -m 755 &quot;$&#123;EXTER&#125;/packages/raspi/orangepi/common/files/brcm_patchram_plus&quot; &quot;$&#123;SDCARD&#125;/usr/bin/&quot;</span><br><span class="line"></span><br><span class="line">	install -d &quot;$&#123;SDCARD&#125;/usr/lib/orangepi/&quot;</span><br><span class="line">	install -m 755 &quot;$&#123;EXTER&#125;/packages/raspi/orangepi/common/files/orangepi-hardware-optimization&quot; &quot;$&#123;SDCARD&#125;/usr/lib/orangepi/&quot;</span><br><span class="line">	install -m 755 &quot;$&#123;EXTER&#125;/packages/raspi/orangepi/common/files/orangepi-hardware-optimize.service&quot; &quot;$&#123;SDCARD&#125;/usr/lib/systemd/system/&quot;</span><br><span class="line">	chroot &quot;$&#123;SDCARD&#125;&quot; /bin/bash -c &quot;systemctl --no-reload enable orangepi-hardware-optimize.service &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line"></span><br><span class="line">	install_wiringop</span><br><span class="line"></span><br><span class="line">	rm $SDCARD/root/*.deb &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">install_raspi_specific()</span><br><span class="line">&#123;</span><br><span class="line">	export TARGET_HOSTNAME=$&#123;TARGET_HOSTNAME:-raspberrypi&#125;</span><br><span class="line">	export FIRST_USER_NAME=$&#123;FIRST_USER_NAME:-pi&#125;</span><br><span class="line">	export FIRST_USER_PASS</span><br><span class="line">	export DISABLE_FIRST_BOOT_USER_RENAME=$&#123;DISABLE_FIRST_BOOT_USER_RENAME:-0&#125;</span><br><span class="line">	export WPA_ESSID</span><br><span class="line">	export WPA_PASSWORD</span><br><span class="line">	export WPA_COUNTRY</span><br><span class="line">	export ENABLE_SSH=&quot;$&#123;ENABLE_SSH:-0&#125;&quot;</span><br><span class="line">	export PUBKEY_ONLY_SSH=&quot;$&#123;PUBKEY_ONLY_SSH:-0&#125;&quot;</span><br><span class="line"></span><br><span class="line">	export LOCALE_DEFAULT=&quot;$&#123;LOCALE_DEFAULT:-en_GB.UTF-8&#125;&quot;</span><br><span class="line"></span><br><span class="line">	export KEYBOARD_KEYMAP=&quot;$&#123;KEYBOARD_KEYMAP:-gb&#125;&quot;</span><br><span class="line">	export KEYBOARD_LAYOUT=&quot;$&#123;KEYBOARD_LAYOUT:-English (UK)&#125;&quot;</span><br><span class="line"></span><br><span class="line">	export TIMEZONE_DEFAULT=&quot;$&#123;TIMEZONE_DEFAULT:-Europe/London&#125;&quot;</span><br><span class="line"></span><br><span class="line">	export PUBKEY_SSH_FIRST_USER</span><br><span class="line"></span><br><span class="line">	export APT_PROXY</span><br><span class="line"></span><br><span class="line">	export STAGE</span><br><span class="line">	export STAGE_DIR</span><br><span class="line">	export STAGE_WORK_DIR</span><br><span class="line">	export PREV_STAGE</span><br><span class="line">	export PREV_STAGE_DIR</span><br><span class="line">	export ROOTFS_DIR=$&#123;SDCARD&#125;</span><br><span class="line">	export PREV_ROOTFS_DIR</span><br><span class="line">	export IMG_SUFFIX</span><br><span class="line">	export NOOBS_NAME</span><br><span class="line">	export NOOBS_DESCRIPTION</span><br><span class="line">	export EXPORT_DIR</span><br><span class="line">	export EXPORT_ROOTFS_DIR</span><br><span class="line"></span><br><span class="line">	export QUILT_PATCHES</span><br><span class="line">	export QUILT_NO_DIFF_INDEX=1</span><br><span class="line">	export QUILT_NO_DIFF_TIMESTAMPS=1</span><br><span class="line">	export QUILT_REFRESH_ARGS=&quot;-p ab&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">check username is valid</span></span><br><span class="line">	if [[ ! &quot;$FIRST_USER_NAME&quot; =~ ^[a-z][-a-z0-9_]*$ ]]; then</span><br><span class="line">		echo &quot;Invalid FIRST_USER_NAME: $FIRST_USER_NAME&quot;</span><br><span class="line">		exit 1</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$DISABLE_FIRST_BOOT_USER_RENAME&quot; == &quot;1&quot; ]] &amp;&amp; [ -z &quot;$&#123;FIRST_USER_PASS&#125;&quot; ]; then</span><br><span class="line">		echo &quot;To disable user rename on first boot, FIRST_USER_PASS needs to be set&quot;</span><br><span class="line">		echo &quot;Not setting FIRST_USER_PASS makes your system vulnerable and open to cyberattacks&quot;</span><br><span class="line">		exit 1</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$DISABLE_FIRST_BOOT_USER_RENAME&quot; == &quot;1&quot; ]]; then</span><br><span class="line">		echo &quot;User rename on the first boot is disabled&quot;</span><br><span class="line">		echo &quot;Be advised of the security risks linked to shipping a device with default username/password set.&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ -n &quot;$&#123;APT_PROXY&#125;&quot; ]] &amp;&amp; ! curl --silent &quot;$&#123;APT_PROXY&#125;&quot; &gt;/dev/null ; then</span><br><span class="line">		echo &quot;Could not reach APT_PROXY server: $&#123;APT_PROXY&#125;&quot;</span><br><span class="line">		exit 1</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ -n &quot;$&#123;WPA_PASSWORD&#125;&quot; &amp;&amp; $&#123;#WPA_PASSWORD&#125; -lt 8 || $&#123;#WPA_PASSWORD&#125; -gt 63  ]] ; then</span><br><span class="line">		echo &quot;WPA_PASSWORD&quot; must be between 8 and 63 characters</span><br><span class="line">		exit 1</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$&#123;PUBKEY_ONLY_SSH&#125;&quot; = &quot;1&quot; &amp;&amp; -z &quot;$&#123;PUBKEY_SSH_FIRST_USER&#125;&quot; ]]; then</span><br><span class="line">		echo &quot;Must set &#x27;PUBKEY_SSH_FIRST_USER&#x27; to a valid SSH public key if using PUBKEY_ONLY_SSH&quot;</span><br><span class="line">		exit 1</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	RASPI_DIR=&quot;$&#123;EXTER&#125;/packages/raspi&quot;</span><br><span class="line"></span><br><span class="line">	if [[ $&#123;BUILD_DESKTOP&#125; == &quot;yes&quot; ]]; then</span><br><span class="line">		rm -r $&#123;RASPI_DIR&#125;/stage3/SKIP $&#123;RASPI_DIR&#125;/stage4/SKIP $&#123;RASPI_DIR&#125;/stage5/SKIP 2&gt;/dev/null</span><br><span class="line">		touch $&#123;RASPI_DIR&#125;/stage5/SKIP</span><br><span class="line">	else</span><br><span class="line">		rm -r $&#123;RASPI_DIR&#125;/stage1/SKIP $&#123;RASPI_DIR&#125;/stage2/SKIP 2&gt;/dev/null</span><br><span class="line">		touch $&#123;RASPI_DIR&#125;/stage3/SKIP $&#123;RASPI_DIR&#125;/stage4/SKIP $&#123;RASPI_DIR&#125;/stage5/SKIP</span><br><span class="line">		export FIRST_USER_PASS=&quot;pi&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	STAGE_LIST=$&#123;RASPI_DIR&#125;/stage*</span><br><span class="line"></span><br><span class="line">	for STAGE_DIR in $STAGE_LIST; do</span><br><span class="line">		STAGE_DIR=$(realpath &quot;$&#123;STAGE_DIR&#125;&quot;)</span><br><span class="line">		run_stage</span><br><span class="line">	done</span><br><span class="line"></span><br><span class="line">	STAGE_DIR=$&#123;RASPI_DIR&#125;/export-image</span><br><span class="line">	run_stage</span><br><span class="line"></span><br><span class="line">	rm -rf $&#123;SDCARD&#125;/boot/*</span><br><span class="line">	rm -rf $&#123;SDCARD&#125;/lib/firmware</span><br><span class="line">	rm -rf $&#123;SDCARD&#125;/lib/modules/*</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="7-æ•´ç†çš„åŒ…"><a href="#7-æ•´ç†çš„åŒ…" class="headerlink" title="7 æ•´ç†çš„åŒ…"></a>7 æ•´ç†çš„åŒ…</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">camera-engine-rkaiq_arm64.deb</span><br><span class="line">librga2_2.2.0-1_arm64.deb</span><br><span class="line">librga-dev_2.2.0-1_arm64.deb</span><br><span class="line">librockchip-mpp1_1.5.0-1_arm64.deb</span><br><span class="line">librockchip-mpp-dev_1.5.0-1_arm64.deb</span><br><span class="line">librockchip-vpu0_1.5.0-1_arm64.deb</span><br><span class="line">rockchip-mpp-demos_1.5.0-1_arm64.deb</span><br><span class="line">libmali-valhall-g610-g6p0-x11_1.9-1_arm64.deb</span><br><span class="line">gstreamer1.0-rockchip1_1.14-4_arm64.deb</span><br><span class="line">libgstreamer1.0-0_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">libgstreamer1.0-dev_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">gir1.2-gstreamer-1.0_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">gstreamer1.0-tools_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">libgstreamer-gl1.0-0_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">gir1.2-gst-plugins-base-1.0_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">gstreamer1.0-alsa_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">gstreamer1.0-plugins-base_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">gstreamer1.0-plugins-base-apps_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">gstreamer1.0-x_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">gstreamer1.0-gl_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">libgstreamer-plugins-base1.0-0_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">libgstreamer-plugins-base1.0-dev_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">gstreamer1.0-plugins-good_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">gstreamer1.0-pulseaudio_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">gstreamer1.0-gtk3_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">gstreamer1.0-qt5_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">libgstreamer-plugins-good1.0-0_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">libgstreamer-plugins-good1.0-dev_1.16.3-0ubuntu1.1_arm64.deb</span><br><span class="line">libdvbv5-0_1.18.0-2build1_arm64.deb</span><br><span class="line">dvb-tools_1.18.0-2build1_arm64.deb</span><br><span class="line">ir-keytable_1.18.0-2build1_arm64.deb</span><br><span class="line">libdvbv5-dev_1.18.0-2build1_arm64.deb</span><br><span class="line">libdvbv5-doc_1.18.0-2build1_all.deb</span><br><span class="line">libv4l-0_1.18.0-2build1_arm64.deb</span><br><span class="line">libv4l2rds0_1.18.0-2build1_arm64.deb</span><br><span class="line">libv4lconvert0_1.18.0-2build1_arm64.deb</span><br><span class="line">libv4l-dev_1.18.0-2build1_arm64.deb</span><br><span class="line">libv4l-rkmpp_1.4.0-1_arm64.deb</span><br><span class="line">v4l-utils_1.18.0-2build1_arm64.deb</span><br><span class="line">qv4l2_1.18.0-2build1_arm64.deb</span><br><span class="line">xserver-xorg-core_1.20.13-1ubuntu1~20.04.2_arm64.deb</span><br><span class="line">chromium-x11_91.0.4472.164_arm64.deb</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ç‘èŠ¯å¾®</category>
      </categories>
  </entry>
  <entry>
    <title>ubuntuå’Œdebianæ–‡ä»¶ç³»ç»Ÿæ„å»ºè¯¦è§£</title>
    <url>/2023/11/20/10%20debian%E5%92%8Cubuntu%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ç¬¬7ç« -Ubuntuå’ŒDebianç³»ç»Ÿæ„å»º"><a href="#ç¬¬7ç« -Ubuntuå’ŒDebianç³»ç»Ÿæ„å»º" class="headerlink" title="ç¬¬7ç«  Ubuntuå’ŒDebianç³»ç»Ÿæ„å»º"></a>ç¬¬7ç«  Ubuntuå’ŒDebianç³»ç»Ÿæ„å»º</h1><p>åœ¨å‰é¢çš„å‡ ä¸ªç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†busyboxï¼Œbuildrootï¼Œyoctoå·¥å…·æ„å»ºæ–‡ä»¶ç³»ç»Ÿã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨Linuxå‘è¡Œç‰ˆæ¥ç›´æ¥ä½œä¸ºæ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚Ubuntuç³»ç»Ÿå’ŒDebianç³»ç»Ÿã€‚ç”±äºUbuntuå’ŒDebianç³»ç»Ÿçš„æ„å»ºæ–¹æ³•ç›¸åŒï¼Œæ‰€ä»¥ä½œè€…å°†ä»–ä»¬ä¸¤ä¸ªç³»ç»Ÿçš„æ„å»ºæ”¾åˆ°äº†ä¸€èµ·ã€‚</p>
<p>æ³¨æ„ï¼šå¿…é¡»è¦åœ¨ubuntu20ç­‰æ›´é«˜ç‰ˆæœ¬çš„ç³»ç»Ÿä¸Šè¿›è¡Œæœ¬ç« èŠ‚çš„æ–‡ä»¶ç³»ç»Ÿæ„å»ºï¼Œç»æµ‹è¯•åœ¨ubutnu18ä¸Šå› ä¸ºä¸€äº›å·¥å…·çš„ç‰ˆæœ¬é—®é¢˜ï¼Œä¼šå‡ºç°å¾ˆå¤šæ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚</p>
<h2 id="7-1-å®‰è£…æ‰€éœ€çš„å·¥å…·"><a href="#7-1-å®‰è£…æ‰€éœ€çš„å·¥å…·" class="headerlink" title="7.1 å®‰è£…æ‰€éœ€çš„å·¥å…·"></a>7.1 å®‰è£…æ‰€éœ€çš„å·¥å…·</h2><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…æ‰€éœ€çš„å·¥å…·</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install binfmt-support qemu qemu-user-static debootstrap</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050842.jpg" alt="img"> </p>
<p>binfmt-supportï¼šæä¾›äº†å¯¹äºŒè¿›åˆ¶æ ¼å¼è§£é‡Šå™¨çš„æ”¯æŒã€‚å…è®¸åœ¨Linuxç³»ç»Ÿä¸­æ‰§è¡Œéæœ¬æœºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¾‹å¦‚åœ¨ARMæ¶æ„ä¸Šè¿è¡Œx86äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å®ƒä¸ºLinuxå†…æ ¸æ·»åŠ äº†è§£é‡Šå™¨æ³¨å†Œè¡¨å’Œæ‰§è¡Œæ–‡ä»¶çš„è§£æé€»è¾‘ã€‚</p>
<p>qemuï¼šæ˜¯ä¸€ä¸ªå¼€æºçš„ç¡¬ä»¶è™šæ‹ŸåŒ–å’Œä»¿çœŸè½¯ä»¶ï¼Œå…è®¸åœ¨ä¸€ä¸ªå¹³å°ä¸Šæ¨¡æ‹Ÿå¦ä¸€ä¸ªå¹³å°çš„è¿è¡Œã€‚å®ƒæ”¯æŒå¤šç§ä½“ç³»ç»“æ„å’Œç¡¬ä»¶è®¾å¤‡ï¼Œå¹¶å¯ä»¥ç”¨äºå¼€å‘å’Œæµ‹è¯•æ“ä½œç³»ç»Ÿã€åº”ç”¨ç¨‹åºç­‰ã€‚</p>
<p>qemu-user-staticï¼šè¿™æ˜¯QEMUçš„ç”¨æˆ·æ€é™æ€äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å…è®¸åœ¨ä¸»æœºå¹³å°ä¸Šè¿è¡Œä¸åŒä½“ç³»ç»“æ„çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œæ— éœ€è¿è¡Œå®Œæ•´çš„è™šæ‹Ÿæœºã€‚è¿™å¯¹äºäº¤å‰ç¼–è¯‘å’Œåœ¨æœ¬åœ°ä¸»æœºä¸Šæ¨¡æ‹Ÿå…¶ä»–ä½“ç³»ç»“æ„çš„åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ã€‚</p>
<p>debootstrapï¼šç”¨äºåœ¨Linuxç³»ç»Ÿä¸­åˆ›å»ºåŸºäºDebiançš„æœ€å°æ–‡ä»¶ç³»ç»Ÿçš„å·¥å…·ã€‚å¯ä»¥å¸®åŠ©ä½ ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªåŸºæœ¬çš„å’ŒUbuntuå’ŒDebianç³»ç»Ÿï¼Œå¹¶å¯ä»¥ç”¨äºåˆ›å»ºchrootç¯å¢ƒæˆ–æ„å»ºè‡ªå®šä¹‰çš„Linuxå‘è¡Œç‰ˆã€‚</p>
<h2 id="7-2æ ¹æ–‡ä»¶ç³»ç»Ÿåˆ¶ä½œ"><a href="#7-2æ ¹æ–‡ä»¶ç³»ç»Ÿåˆ¶ä½œ" class="headerlink" title="7.2æ ¹æ–‡ä»¶ç³»ç»Ÿåˆ¶ä½œ"></a>7.2æ ¹æ–‡ä»¶ç³»ç»Ÿåˆ¶ä½œ</h2><p>é¦–å…ˆæ¥å­¦ä¹ ä¸€ä¸‹debootstrapå‘½ä»¤çš„åŸºæœ¬è¯­æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">debootstrap arch &lt;æ¶æ„&gt; &lt;å‘è¡Œç‰ˆ&gt; &lt;ç›®æ ‡ç›®å½•&gt; [é•œåƒåœ°å€]</span><br></pre></td></tr></table></figure>

<p>â€“arch &lt;æ¶æ„&gt;ï¼šæŒ‡å®šç›®æ ‡ç³»ç»Ÿçš„æ¶æ„ï¼Œä¾‹å¦‚ amd64ã€armhfã€arm64 ç­‰ã€‚æ ¹æ®ç›®æ ‡ç³»ç»Ÿçš„æ¶æ„é€‰æ‹©åˆé€‚çš„å€¼ã€‚</p>
<p>&lt;å‘è¡Œç‰ˆ&gt;ï¼šæŒ‡å®šè¦åˆ›å»ºçš„Debianå‘è¡Œç‰ˆï¼Œæµè¡Œç³»ç»Ÿçš„ç‰ˆæœ¬å·å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>ï¼ˆ1ï¼‰Ubuntu 20.04ï¼šfocal</p>
<p>ï¼ˆ2ï¼‰Ubuntu 22.04ï¼šjammy</p>
<p>ï¼ˆ3ï¼‰Debian 10ï¼š buster</p>
<p>ï¼ˆ4ï¼‰Debian 11ï¼šbullseye</p>
<p>&lt;ç›®æ ‡ç›®å½•&gt;ï¼šæŒ‡å®šè¦åˆ›å»ºçš„ç›®æ ‡æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•è·¯å¾„ã€‚æ‰€æœ‰çš„Debianè½¯ä»¶åŒ…å’Œé…ç½®æ–‡ä»¶å°†å®‰è£…åˆ°è¯¥ç›®å½•ä¸­ã€‚</p>
<p>[é•œåƒåœ°å€]ï¼ˆå¯é€‰ï¼‰ï¼šæŒ‡å®šç”¨äºä¸‹è½½Ubuntuå’ŒDebianè½¯ä»¶åŒ…çš„é•œåƒåœ°å€ã€‚å¦‚æœä¸æä¾›é•œåƒåœ°å€ï¼Œå°†ä½¿ç”¨é»˜è®¤çš„é•œåƒåœ°å€è¿›è¡Œä¸‹è½½,è¿™é‡Œå»ºè®®é€‰æ‹©å›½å†…æºï¼Œä¾‹å¦‚åä¸ºæºã€é˜¿é‡Œæºç­‰ã€‚</p>
<p>æ³¨æ„ï¼šdebootstrap å‘½ä»¤çš„ä½¿ç”¨éœ€è¦åœ¨rootç”¨æˆ·ä¸‹ã€‚</p>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªé•œåƒå­˜æ”¾çš„ç›®å½•ï¼Œè¿™é‡Œä½œè€…èµ·åä¸ºbinaryï¼Œå¤§å®¶éšæ„å³å¯ï¼Œåˆ›å»ºå®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050838.jpg" alt="img"> </p>
<p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ¶ä½œæ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸ªç³»ç»Ÿçš„åˆ¶ä½œå‘½ä»¤éƒ½å·²ç»åˆ—äº†å‡ºæ¥ï¼š<br>ï¼ˆ1ï¼‰Ubuntu 20.04ï¼šfocal</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">arch=arm64</span><br><span class="line">release=focal</span><br><span class="line">chroot_dir=binary</span><br><span class="line">mirror=https://mirrors.huaweicloud.com/repository/ubuntu-ports/</span><br><span class="line">debootstrap --arch $&#123;arch&#125; $&#123;release&#125; $&#123;chroot_dir&#125; $&#123;mirror&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰Ubuntu 22.04ï¼šjammy</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">arch=arm64</span><br><span class="line">release=jammy</span><br><span class="line">chroot_dir=binary</span><br><span class="line">mirror=https://mirrors.huaweicloud.com/repository/ubuntu-ports/</span><br><span class="line">sudo debootstrap --arch $&#123;arch&#125; $&#123;release&#125; $&#123;chroot_dir&#125; $&#123;mirror&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰Debian 10ï¼š buster</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">arch=arm64</span><br><span class="line">release=buster</span><br><span class="line">chroot_dir=</span><br><span class="line">mirror=https://mirrors.huaweicloud.com/repository/debian/</span><br><span class="line">debootstrap --arch $&#123;arch&#125; $&#123;release&#125; $&#123;chroot_dir&#125; $&#123;mirror&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ4ï¼‰Debian 11ï¼šbullseye</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">arch=arm64</span><br><span class="line">release=bullseye</span><br><span class="line">chroot_dir=binary</span><br><span class="line">mirror=https://mirrors.huaweicloud.com/repository/debian/</span><br><span class="line">debootstrap --arch $&#123;arch&#125; $&#123;release&#125; $&#123;chroot_dir&#125; $&#123;mirror&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä½œè€…ä»¥ubuntu20ä¸ºä¾‹è¿›è¡Œæ¼”ç¤ºï¼Œå‘½ä»¤è¾“å…¥ä¹‹åä¼šå¼€å§‹æ–‡ä»¶ç³»ç»Ÿçš„æ„å»ºï¼Œæ„å»ºæ„æˆå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050845.jpg" alt="img"> </p>
<p>ç„¶åç­‰å¾…æ„å»ºå®Œæˆï¼Œæ„å»ºå®Œæˆä¹‹åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050849.jpg" alt="img"></p>
<p>å¯ä»¥çœ‹åˆ°Linuxçš„ä¸€äº›åŸºæœ¬ç›®å½•å°±éƒ½å·²ç»ç”Ÿæˆäº†ã€‚</p>
<h2 id="7-3æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ"><a href="#7-3æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="7.3æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ"></a>7.3æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ</h2><p>åœ¨æ„å»ºUbuntuå’ŒDebianæ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œéœ€è¦å°†ä¸»æœºçš„&#x2F;procã€&#x2F;sys&#x2F;ã€dev&#x2F;ã€dev&#x2F;ptsè¿™äº›è™šæ‹Ÿæ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°è¦æ„å»ºçš„ç³»ç»Ÿä¸­é€šè¿‡æŒ‚è½½è¿™äº›ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿï¼Œæ„å»ºæ–‡ä»¶ç³»ç»Ÿçš„è¿‡ç¨‹ä¸­çš„å‘½ä»¤å¯ä»¥æ­£å¸¸è®¿é—®å’Œæ“ä½œç³»ç»Ÿçš„è¿›ç¨‹ã€å†…æ ¸ã€ç¡¬ä»¶ä»¥åŠä¸´æ—¶æ–‡ä»¶å’Œè¿›ç¨‹ã€‚è¿™äº›æŒ‚è½½æ“ä½œä¸ºæ„å»ºè¿‡ç¨‹æä¾›äº†å¿…è¦çš„è¿è¡Œç¯å¢ƒå’Œèµ„æºã€‚</p>
<p>æŒ‚è½½æ“ä½œè¿™é‡Œé€šè¿‡mount.shè„šæœ¬æ¥å®Œæˆï¼Œè¯¥è„šæœ¬çš„å…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">mnt() &#123;</span><br><span class="line">	echo &quot;MOUNTING&quot;</span><br><span class="line">	sudo mount -t proc /proc $&#123;2&#125;proc</span><br><span class="line">	sudo mount -t sysfs /sys $&#123;2&#125;sys</span><br><span class="line">	sudo mount -o bind /dev $&#123;2&#125;dev</span><br><span class="line">	sudo mount -o bind /dev/pts $&#123;2&#125;dev/pts</span><br><span class="line">&#125;</span><br><span class="line">umnt() &#123;</span><br><span class="line">	echo &quot;UNMOUNTING&quot;</span><br><span class="line">	sudo umount $&#123;2&#125;proc</span><br><span class="line">	sudo umount $&#123;2&#125;sys</span><br><span class="line">	sudo umount $&#123;2&#125;dev/pts</span><br><span class="line">	sudo umount $&#123;2&#125;dev</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if [ &quot;$1&quot; == &quot;-m&quot; ] &amp;&amp; [ -n &quot;$2&quot; ] ;</span><br><span class="line">then</span><br><span class="line">	mnt $1 $2</span><br><span class="line">elif [ &quot;$1&quot; == &quot;-u&quot; ] &amp;&amp; [ -n &quot;$2&quot; ];</span><br><span class="line">then</span><br><span class="line">	umnt $1 $2</span><br><span class="line">else</span><br><span class="line">	echo &quot;&quot;</span><br><span class="line">	echo &quot;Either 1&#x27;st, 2&#x27;nd or both parameters were missing&quot;</span><br><span class="line">	echo &quot;&quot;</span><br><span class="line">	echo &quot;1&#x27;st parameter can be one of these: -m(mount) OR -u(umount)&quot;</span><br><span class="line">	echo &quot;2&#x27;nd parameter is the full path of rootfs directory(with trailing &#x27;/&#x27;)&quot;</span><br><span class="line">	echo &quot;&quot;</span><br><span class="line">	echo &quot;For example: ch-mount -m /media/sdcard/&quot;</span><br><span class="line">	echo &quot;&quot;</span><br><span class="line">	echo 1st parameter : $&#123;1&#125;</span><br><span class="line">	echo 2nd parameter : $&#123;2&#125;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>



<p>åˆ›å»ºè¯¥æ–‡ä»¶ï¼Œæ·»åŠ ç›¸åº”çš„å†…å®¹å¹¶èµ‹äºˆå¯æ‰§è¡Œæƒé™ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050848.jpg" alt="img"></p>
<p>è¯¥è„šæœ¬æ—¢å¯ä»¥ç”¨æ¥æŒ‚è½½ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è§£é™¤æŒ‚è½½ï¼ŒæŒ‚è½½çš„å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./mount.sh -m binary/</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050850.jpg" alt="img"> </p>
<p>æŒ‚è½½æˆåŠŸä¹‹åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ”¹å˜æ ¹ç›®å½•ï¼Œå°†æ ¹ç›®å½•ä¿®æ”¹ä¸ºåˆšåˆšåˆ›å»ºå¥½çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chroot binary/</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050000.jpg" alt="img"> </p>
<p>æ¥ä¸‹æ¥å°±å¯ä»¥è¿›å…¥ä¸‹ä¸€ä¸ªå°èŠ‚ï¼Œå¼€å§‹æ–‡ä»¶ç³»ç»Ÿçš„å®šåˆ¶äº†ã€‚</p>
<h2 id="7-4-å®šåˆ¶æ ¹æ–‡ä»¶ç³»ç»Ÿ"><a href="#7-4-å®šåˆ¶æ ¹æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="7.4 å®šåˆ¶æ ¹æ–‡ä»¶ç³»ç»Ÿ"></a>7.4 å®šåˆ¶æ ¹æ–‡ä»¶ç³»ç»Ÿ</h2><h3 id="7-4-1-aptæ¢æº"><a href="#7-4-1-aptæ¢æº" class="headerlink" title="7.4.1 aptæ¢æº"></a><strong>7.4.1 aptæ¢æº</strong></h3><p>ç”±äºæ„å»ºå‡ºç³»ç»Ÿçš„è½¯ä»¶æºåœ¨å›½å¤–ï¼Œå› ä¸ºç½‘ç»œé—®é¢˜è€Œä¸ç¨³å®šå¯¼è‡´ä¸‹è½½é€Ÿåº¦ç¼“æ…¢ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆå°†é»˜è®¤æºæ›´æ¢ä¸ºå›½å†…æºã€‚</p>
<p>Ubuntuå’ŒDebianç³»ç»Ÿçš„è½¯ä»¶æºæ–‡ä»¶ä¸ºâ€œ&#x2F;etc&#x2F;apt&#x2F;sources.listâ€ï¼Œè€Œä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿä»–ä»¬çš„è½¯ä»¶æºä¹Ÿå„ä¸ç›¸åŒï¼Œæ‰€ä»¥è¿™é‡Œç½—åˆ—äº†ä¸åŒç³»ç»Ÿçš„å›½å†…è½¯ä»¶æºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br>ï¼ˆ1ï¼‰Ubuntu 20.04ï¼šfocal</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu-ports/ focal main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.ustc.edu.cn/ubuntu-ports/ focal main main restricted universe multiverse</span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu-ports/ focal-updates main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.ustc.edu.cn/ubuntu-ports/ focal-updates main restricted universe multiverse</span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu-ports/ focal-backports main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.ustc.edu.cn/ubuntu-ports/ focal-backports main restricted universe multiverse</span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu-ports/ focal-security main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.ustc.edu.cn/ubuntu-ports/ focal-security main restricted universe multiverse</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰Ubuntu 22.04ï¼šjammy</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deb https://mirrors.huaweicloud.com/repository/ubuntu-ports/ jammy main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.huaweicloud.com/repository/ubuntu-ports/ jammy main restricted universe multiverse</span><br><span class="line">deb https://mirrors.huaweicloud.com/repository/ubuntu-ports/ jammy-updates main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.huaweicloud.com/repository/ubuntu-ports/ jammy-updates main restricted universe multiverse</span><br><span class="line">deb https://mirrors.huaweicloud.com/repository/ubuntu-ports/ jammy-backports main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.huaweicloud.com/repository/ubuntu-ports/ jammy-backports main restricted universe multiverse</span><br><span class="line">deb https://mirrors.huaweicloud.com/repository/ubuntu-ports/ jammy-security main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.huaweicloud.com/repository/ubuntu-ports/ jammy-security main restricted universe multiverse</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰Debian 10ï¼š buster</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deb https://mirrors.huaweicloud.com/repository/debian/ buster main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free</span><br><span class="line">deb https://mirrors.huaweicloud.com/repository/debian/ buster-updates main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free</span><br><span class="line">deb https://mirrors.huaweicloud.com/repository/debian/ buster-backports main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free</span><br><span class="line">deb https://mirrors.huaweicloud.com/repository/debian-security buster/updates main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free</span><br></pre></td></tr></table></figure>



<p>ï¼ˆ4ï¼‰Debian 11ï¼šbullseye</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deb https://mirrors.huaweicloud.com/debian/ bullseye main non-free contrib</span><br><span class="line">deb-src https://mirrors.huaweicloud.com/debian/ bullseye main non-free contrib</span><br><span class="line">deb https://mirrors.huaweicloud.com/debian-security/ bullseye-security main</span><br><span class="line">deb-src https://mirrors.huaweicloud.com/debian-security/ bullseye-security main</span><br><span class="line">deb https://mirrors.huaweicloud.com/debian/ bullseye-updates main non-free contrib</span><br><span class="line">deb-src https://mirrors.huaweicloud.com/debian/ bullseye-updates main non-free contrib</span><br><span class="line">deb https://mirrors.huaweicloud.com/debian/ bullseye-backports main non-free contrib</span><br><span class="line">deb-src https://mirrors.huaweicloud.com/debian/ bullseye-backports main non-free contrib</span><br></pre></td></tr></table></figure>

<p>ç„¶åä½¿ç”¨vimå‘½ä»¤ä¿®æ”¹&#x2F;etc&#x2F;apt&#x2F;sources.listä¸ºä¸Šé¢æä¾›çš„å›½å†…æºï¼Œä¿®æ”¹å®Œæˆå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/apt/sources.list</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050010.jpg" alt="img"> </p>
<p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œè½¯ä»¶æºçš„æ›´æ–°ï¼Œæ›´æ–°è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt update </span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050017.jpg" alt="img"> </p>
<p>ç­‰å¾…æ›´æ–°å®Œæˆå³å¯ã€‚é»˜è®¤çš„dnsæºåœ¨çƒ§å†™åˆ°å¼€å‘æ¿ä¹‹åå¯èƒ½ä¹Ÿæ— æ³•æ­£å¸¸è§£æåŸŸåï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ›´æ¢é•œåƒçš„dnsæºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rm -rf /etc/resolv.conf</span><br><span class="line">echo &quot;nameserver 8.8.8.8&quot; &gt; /etc/resolv.conf</span><br><span class="line">echo &quot;nameserver 114.114.114.114&quot; &gt;&gt; /etc/resolv.conf</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311220745228.png" alt="image-20231122074527194"></p>
<h3 id="7-4-2å®‰è£…å¸¸ç”¨å·¥å…·"><a href="#7-4-2å®‰è£…å¸¸ç”¨å·¥å…·" class="headerlink" title="7.4.2å®‰è£…å¸¸ç”¨å·¥å…·"></a><strong>7.4.2å®‰è£…å¸¸ç”¨å·¥å…·</strong></h3><p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…å¿…å¤‡çš„è½¯ä»¶åŒ…ï¼Œå®‰è£…è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt-get -y install dmidecode mtd-utils i2c-tools u-boot-tools \</span><br><span class="line">bash-completion man-db manpages nano gnupg initramfs-tools sudo \</span><br><span class="line">dosfstools mtools parted ntfs-3g zip atop \</span><br><span class="line">p7zip-full htop iotop pciutils lshw lsof exfat-fuse hwinfo \</span><br><span class="line">net-tools wireless-tools openssh-client openssh-server wpasupplicant ifupdown \</span><br><span class="line">pigz wget curl lm-sensors bluez gdisk usb-modeswitch usb-modeswitch-data make \</span><br><span class="line">gcc libc6-dev bison libssl-dev flex  fake-hwclock rfkill wireless-regdb toilet cmake locales \</span><br><span class="line">openssh-server openssh-client network-manager fonts-wqy-zenhei xfonts-intl-chinese alsa-utils vim blueman </span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050030.jpg" alt="img"> </p>
<p>ç­‰å¾…å®‰è£…å®Œæˆå³å¯ï¼Œæ¯ä¸ªå®‰è£…åŒ…çš„å…·ä½“ä½œç”¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dmidecodeï¼šç”¨äºè·å–ç³»ç»Ÿçš„DMIï¼ˆDesktop Management Interfaceï¼‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¡¬ä»¶è®¾å¤‡ã€BIOSå’Œå›ºä»¶ç­‰ã€‚</span><br><span class="line">mtd-utilsï¼šæä¾›å¯¹åµŒå…¥å¼é—ªå­˜è®¾å¤‡ï¼ˆMTDï¼‰çš„ç®¡ç†å’Œæ“ä½œå·¥å…·ï¼Œç”¨äºè¯»å–ã€æ“¦é™¤å’Œç¼–ç¨‹é—ªå­˜èŠ¯ç‰‡ã€‚</span><br><span class="line">i2c-toolsï¼šç”¨äºé…ç½®å’Œè°ƒè¯•I2Cæ€»çº¿è®¾å¤‡çš„å·¥å…·é›†ã€‚</span><br><span class="line">u-boot-toolsï¼šæä¾›ä¸U-Bootå¼•å¯¼åŠ è½½ç¨‹åºç›¸å…³çš„å·¥å…·ï¼Œç”¨äºé…ç½®å’Œç®¡ç†åµŒå…¥å¼ç³»ç»Ÿçš„å¼•å¯¼è¿‡ç¨‹ã€‚</span><br><span class="line">bash-completionï¼šä¸ºBash shellæä¾›è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œå¯ä»¥å¿«é€Ÿè¡¥å…¨å‘½ä»¤ã€é€‰é¡¹å’Œæ–‡ä»¶åã€‚</span><br><span class="line">man-dbå’Œmanpagesï¼šman-dbæ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å’Œæµè§ˆmané¡µé¢ï¼ˆLinuxå¸®åŠ©æ–‡æ¡£ï¼‰çš„å·¥å…·ï¼Œmanpagesåˆ™æ˜¯åŒ…å«å¸¸è§å‘½ä»¤å’Œå‡½æ•°çš„mané¡µé¢é›†åˆã€‚</span><br><span class="line">nanoï¼šä¸€ä¸ªç®€å•æ˜“ç”¨çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œé€‚ç”¨äºç»ˆç«¯ç¯å¢ƒã€‚</span><br><span class="line">gnupgï¼šGNUéšç§ä¿æŠ¤å·¥å…·ï¼Œç”¨äºåŠ å¯†ã€ç­¾åå’Œè®¤è¯æ•°æ®å’Œé€šä¿¡ã€‚</span><br><span class="line">initramfs-toolsï¼šç”¨äºåˆ›å»ºå’Œç®¡ç†åˆå§‹å†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼ˆinitramfsï¼‰ï¼Œé€šå¸¸ç”¨äºå¯åŠ¨Linuxç³»ç»Ÿå‰çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚</span><br><span class="line">sudoï¼šå…è®¸æ™®é€šç”¨æˆ·ä»¥è¶…çº§ç”¨æˆ·ï¼ˆrootï¼‰æƒé™æ‰§è¡Œå‘½ä»¤çš„å·¥å…·ã€‚</span><br><span class="line">dosfstoolsï¼šç”¨äºåˆ›å»ºã€æ£€æŸ¥å’Œç»´æŠ¤DOS/Windowsæ–‡ä»¶ç³»ç»Ÿï¼ˆFATï¼‰çš„å·¥å…·é›†ã€‚</span><br><span class="line">mtoolsï¼šç”¨äºåœ¨Linuxç³»ç»Ÿä¸Šç®¡ç†DOS/Windowsæ–‡ä»¶ç³»ç»Ÿï¼ˆFATï¼‰çš„å·¥å…·ã€‚</span><br><span class="line">partedï¼šç£ç›˜åˆ†åŒºå·¥å…·ï¼Œç”¨äºåˆ›å»ºã€è°ƒæ•´å’Œç®¡ç†ç£ç›˜åˆ†åŒºã€‚</span><br><span class="line">ntfs-3gï¼šç”¨äºåœ¨Linuxç³»ç»Ÿä¸Šè¯»å†™NTFSæ–‡ä»¶ç³»ç»Ÿçš„é©±åŠ¨ç¨‹åºã€‚</span><br><span class="line">zipå’Œp7zip-fullï¼šç”¨äºåˆ›å»ºå’Œæå–ZIPå’Œ7zç­‰å‹ç¼©æ–‡ä»¶çš„å·¥å…·ã€‚</span><br><span class="line">htopå’Œiotopï¼šç”¨äºç›‘è§†ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œåˆ†åˆ«ç›‘è§†è¿›ç¨‹å’Œç£ç›˜I/Oçš„æƒ…å†µã€‚</span><br><span class="line">pciutilsï¼šç”¨äºæŸ¥è¯¢å’Œé…ç½®PCIæ€»çº¿è®¾å¤‡çš„å·¥å…·ã€‚</span><br><span class="line">lshwï¼šæ˜¾ç¤ºç³»ç»Ÿç¡¬ä»¶ä¿¡æ¯çš„å·¥å…·ã€‚</span><br><span class="line">lsofï¼šåˆ—å‡ºæ‰“å¼€çš„æ–‡ä»¶å’Œè¿›ç¨‹çš„å·¥å…·ã€‚</span><br><span class="line">exfat-fuseï¼šç”¨äºåœ¨Linuxç³»ç»Ÿä¸Šè®¿é—®exFATæ–‡ä»¶ç³»ç»Ÿçš„é©±åŠ¨ç¨‹åºã€‚</span><br><span class="line">hwinfoï¼šç”¨äºè·å–å’Œæ˜¾ç¤ºç¡¬ä»¶ä¿¡æ¯çš„å·¥å…·ã€‚</span><br><span class="line">net-toolsï¼šåŒ…å«ä¸€äº›åŸºæœ¬çš„ç½‘ç»œå·¥å…·ï¼Œå¦‚ifconfigå’Œnetstatã€‚</span><br><span class="line">wireless-toolsï¼šç”¨äºé…ç½®å’Œç®¡ç†æ— çº¿ç½‘ç»œæ¥å£çš„å·¥å…·ã€‚</span><br><span class="line">openssh-clientå’Œopenssh-serverï¼šæä¾›SSHå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼Œç”¨äºè¿œç¨‹å®‰å…¨ç™»å½•å’Œæ–‡ä»¶ä¼ è¾“ã€‚</span><br><span class="line">wpasupplicantï¼šç”¨äºé…ç½®å’Œè¿æ¥æ— çº¿ç½‘ç»œçš„å·¥å…·ã€‚</span><br><span class="line">ifupdownï¼šç”¨äºé…ç½®å’Œç®¡ç†ç½‘ç»œæ¥å£çš„å·¥å…·ã€‚</span><br><span class="line">pigzï¼šå¹¶è¡Œå‹ç¼©/è§£å‹ç¼©å·¥å…·ï¼Œç”¨äºåŠ å¿«å‹ç¼©é€Ÿåº¦ã€‚</span><br><span class="line">wgetå’Œcurlï¼šç”¨äºä»ç½‘ç»œä¸Šä¸‹è½½æ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</span><br><span class="line">lm-sensorsï¼šç”¨äºç›‘æµ‹ç¡¬ä»¶ä¼ æ„Ÿå™¨ï¼ˆå¦‚æ¸©åº¦ã€é£æ‰‡é€Ÿåº¦ï¼‰çš„å·¥å…·ã€‚</span><br><span class="line">bluezï¼šæä¾›è“ç‰™åè®®æ ˆçš„å·¥å…·å’Œåº“ã€‚</span><br><span class="line">gdiskï¼šç”¨äºåˆ›å»ºå’Œç®¡ç†GUIDåˆ†åŒºè¡¨ï¼ˆGPTï¼‰çš„å·¥å…·ã€‚</span><br><span class="line">usb-modeswitchå’Œusb-modeswitch-dataï¼šç”¨äºåœ¨Linuxç³»ç»Ÿä¸Šåˆ‡æ¢å’Œé…ç½®USBç§»åŠ¨å®½å¸¦è®¾å¤‡çš„å·¥å…·å’Œæ•°æ®ã€‚</span><br><span class="line">makeå’Œgccï¼šç¼–è¯‘å’Œæ„å»ºè½¯ä»¶çš„å·¥å…·å’Œç¼–è¯‘å™¨ã€‚</span><br><span class="line">libc6-devï¼šCè¯­è¨€æ ‡å‡†åº“çš„å¼€å‘æ–‡ä»¶ï¼Œç”¨äºç¼–è¯‘å’Œé“¾æ¥Cè¯­è¨€ç¨‹åºã€‚</span><br><span class="line">bisonå’Œflexï¼šç”¨äºç”Ÿæˆè¯æ³•åˆ†æå™¨å’Œè¯­æ³•åˆ†æå™¨çš„ç”Ÿæˆå·¥å…·ã€‚</span><br><span class="line">fake-hwclockï¼šç”¨äºåœ¨ç³»ç»Ÿæ²¡æœ‰ç¡¬ä»¶æ—¶é’Ÿçš„æƒ…å†µä¸‹ï¼Œæ¨¡æ‹Ÿä¿å­˜å’Œæ¢å¤æ—¶é—´çš„å·¥å…·ã€‚</span><br><span class="line">rfkillï¼šç”¨äºç®¡ç†å°„é¢‘è®¾å¤‡çš„è½¯ä»¶å±è”½å¼€å…³çŠ¶æ€çš„å·¥å…·ã€‚</span><br><span class="line">wireless-regdbï¼šæ— çº¿ç”µè®¾å¤‡çš„æ³•è§„æ•°æ®åº“ï¼Œç”¨äºé…ç½®æ— çº¿ç”µé¢‘ç‡å’ŒåŠŸç‡é™åˆ¶ã€‚</span><br><span class="line">toiletï¼šç”¨äºåœ¨ç»ˆç«¯ä¸­ç”Ÿæˆå½©è‰²çš„ASCIIè‰ºæœ¯å­—çš„å·¥å…·ã€‚</span><br><span class="line">cmakeï¼šä¸€ä¸ªè·¨å¹³å°çš„å¼€æºæ„å»ºå·¥å…·ï¼Œç”¨äºç®¡ç†è½¯ä»¶é¡¹ç›®çš„æ„å»ºè¿‡ç¨‹ã€‚</span><br><span class="line">localesï¼šç”¨äºé…ç½®ç³»ç»Ÿçš„æœ¬åœ°åŒ–è®¾ç½®ï¼ŒåŒ…æ‹¬è¯­è¨€ã€æ—¥æœŸã€æ—¶é—´ç­‰ã€‚</span><br><span class="line">network-managerï¼šç”¨äºé…ç½®å’Œç®¡ç†ç½‘ç»œè¿æ¥çš„å·¥å…·ã€‚</span><br><span class="line">fonts-wqy-zenheiå’Œxfonts-intl-chineseï¼šæä¾›ä¸­æ–‡å­—ä½“æ”¯æŒï¼Œç”¨äºæ˜¾ç¤ºä¸­æ–‡å­—ç¬¦ã€‚</span><br><span class="line">alsa-utilsï¼šç”¨äºé…ç½®å’Œç®¡ç†Advanced Linux Sound Architecture (ALSA)çš„å·¥å…·ã€‚</span><br><span class="line">vimï¼šä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œé€‚ç”¨äºç»ˆç«¯ç¯å¢ƒ</span><br></pre></td></tr></table></figure>

<h3 id="7-4-3é…ç½®rootå¯†ç "><a href="#7-4-3é…ç½®rootå¯†ç " class="headerlink" title="7.4.3é…ç½®rootå¯†ç "></a><strong>7.4.3é…ç½®rootå¯†ç </strong></h3><p>è¾“å…¥â€œpasswd rootâ€å‘½ä»¤ï¼Œç„¶åè¿ç»­è¾“å…¥ä¸¤æ¬¡root ç”¨æˆ·å¯†ç ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050040.jpg" alt="img"> </p>
<h3 id="7-4-4æ·»åŠ topeetç”¨æˆ·"><a href="#7-4-4æ·»åŠ topeetç”¨æˆ·" class="headerlink" title="7.4.4æ·»åŠ topeetç”¨æˆ·"></a><strong>7.4.4æ·»åŠ topeetç”¨æˆ·</strong></h3><p>ç„¶åè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ·»åŠ åå­—ä¸ºtopeetçš„ç”¨æˆ·ï¼Œå¹¶å°†topeetç”¨æˆ·çš„ç™»å½•å¯†ç è®¾ç½®ä¸ºtopeetï¼Œå¹¶æˆäºˆè¯¥ç”¨æˆ·ä»¥ç®¡ç†å‘˜ï¼ˆrootï¼‰æƒé™æ‰§è¡Œæ‰€æœ‰å‘½ä»¤ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">adduser topeet --gecos &quot;First Last,RoomNumber,WorkPhone,HomePhone&quot; --disabled-password</span><br><span class="line">echo &quot;topeet:topeet&quot; |  chpasswd</span><br><span class="line">echo &quot;topeet ALL=(ALL:ALL) ALL&quot; &gt;&gt; /etc/sudoers</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050045.jpg" alt="img"> </p>
<p>è‡³æ­¤ï¼Œtopeetç”¨æˆ·å°±åˆ›å»ºå®Œæˆäº†ï¼Œå¦‚æœæƒ³è¦ä¿®æ”¹åˆ›å»ºçš„ç”¨æˆ·ä¿®æ”¹å‘½ä»¤ä¸­çš„topeetå³å¯ã€‚</p>
<h3 id="7-4-5é…ç½®ä¸»æœºå"><a href="#7-4-5é…ç½®ä¸»æœºå" class="headerlink" title="7.4.5é…ç½®ä¸»æœºå"></a><strong>7.4.5é…ç½®ä¸»æœºå</strong></h3><p>æ¥ä¸‹æ¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è®¾ç½®ä¸»æœºåç§°å’Œæœ¬æœº IPï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export HOST=topeet</span><br><span class="line">echo $HOST &gt; /etc/hostname</span><br><span class="line">echo &quot;127.0.0.1 localhost.localdomain localhost&quot; &gt;&gt; /etc/hosts</span><br><span class="line">echo &quot;127.0.0.1 $HOST&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050162.jpg" alt="img"> </p>
<h3 id="7-4-6ä¸­æ–‡è®¾ç½®"><a href="#7-4-6ä¸­æ–‡è®¾ç½®" class="headerlink" title="7.4.6ä¸­æ–‡è®¾ç½®"></a><strong>7.4.6ä¸­æ–‡è®¾ç½®</strong></h3><p>ç›®å‰çš„ç»ˆç«¯äº¤äº’ä»æ—§ä½¿ç”¨çš„æ˜¯è‹±æ–‡ï¼Œä¸ºäº†ä¾¿äºäº¤äº’å’ŒæŸ¥çœ‹æ‰“å°ä¿¡æ¯ï¼Œå¯ä»¥æ ¹æ®ä»¥ä¸‹æ­¥éª¤ä¿®æ”¹ä¸ºä¸­æ–‡ã€‚</p>
<p>é¦–å…ˆä½¿ç”¨sed å·¥å…·ä¿®æ”¹ &#x2F;etc&#x2F;locale.gen æ–‡ä»¶çš„å†…å®¹ï¼Œå°†ä»¥ zh_CN.UTF-8 å¼€å¤´çš„è¡Œä¸­çš„æ³¨é‡Šç¬¦å· # å»é™¤ã€‚</p>
<p>ç„¶åè®¾ç½®ç³»ç»Ÿçš„é»˜è®¤è¯­è¨€ç¯å¢ƒä¸ºä¸­æ–‡ï¼ˆä¸­å›½ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i &#x27;s/^# *\(zh_CN.UTF-8\)/\1/&#x27; /etc/locale.gen</span><br><span class="line">echo &quot;LANG=zh_CN.UTF-8&quot; &gt;&gt; /etc/default/locale</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050190.jpg" alt="img"> </p>
<p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆ zh_CN.UTF-8 è¯­è¨€ç¯å¢ƒæ‰€éœ€çš„é…ç½®æ–‡ä»¶ï¼Œæ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">locale-gen zh_CN.UTF-8</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050196.jpg" alt="img"><br>    æœ€åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†LC_ALL ã€LANGå’ŒLANGUAGEè¿½åŠ åˆ°rootå’Œtopeetç”¨æˆ·çš„ç¯å¢ƒå˜é‡ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;export LC_ALL=zh_CN.UTF-8&quot; &gt;&gt; ~/.bashrc</span><br><span class="line">echo &quot;export LANG=zh_CN.UTF-8&quot; &gt;&gt; ~/.bashrc</span><br><span class="line">echo &quot;export LANGUAGE=zh_CN.UTF-8&quot; &gt;&gt; ~/.bashrc</span><br><span class="line"></span><br><span class="line">echo &quot;export LC_ALL=zh_CN.UTF-8&quot; &gt;&gt; /home/topeet/.bashrc</span><br><span class="line">echo &quot;export LANG=zh_CN.UTF-8&quot; &gt;&gt; /home/topeet/.bashrc</span><br><span class="line">echo &quot;export LANGUAGE=zh_CN.UTF-8&quot; &gt;&gt; /home/topeet/.bashrc</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050210.jpg" alt="img"> </p>
<p>è‡³æ­¤ï¼Œä¸­æ–‡ç¯å¢ƒå°±è®¾ç½®å®Œæˆäº†ï¼Œå¯ä»¥ä½¿ç”¨apt-get updateå‘½ä»¤æ¥æŸ¥çœ‹ä¸­æ–‡æ˜¯å¦è®¾ç½®æˆåŠŸï¼Œè®¾ç½®æˆåŠŸå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050231.jpg" alt="img"></p>
<p>å¯ä»¥çœ‹åˆ°æ‰“å°ä¿¡æ¯å·²ç»è®¾ç½®ä¸ºäº†ä¸­æ–‡ã€‚</p>
<h3 id="7-4-7å®‰è£…æ¡Œé¢"><a href="#7-4-7å®‰è£…æ¡Œé¢" class="headerlink" title="7.4.7å®‰è£…æ¡Œé¢"></a>7.4.7å®‰è£…æ¡Œé¢</h3><p>ä¸Šé¢åªæ˜¯å¯¹ç³»ç»Ÿè¿›è¡Œäº†ä¸€äº›åŸºæœ¬è®¾ç½®ï¼Œæœ¬å°èŠ‚å°†è¿›è¡Œæ¡Œé¢ç³»ç»Ÿçš„å®‰è£…ï¼Œåœ¨Linuxçš„å‘è¡Œç‰ˆä¸­ä»¥GNOMEã€KDEã€Xfceå’ŒLXQtçš„ä½¿ç”¨æœ€ä¸ºå¹¿æ³›ï¼Œè€ƒè™‘åˆ°3568çš„æ€§èƒ½è¿™é‡Œé€‰ç”¨Xfceæ¡Œé¢è¿›è¡Œå®‰è£…ï¼Œå¦‚æœæƒ³è¦å®‰è£…å…¶ä»–æ¡Œé¢å¯ä»¥è‡ªè¡Œæœç´¢å…¶ä»–æ¡Œé¢çš„å®‰è£…å‘½ä»¤ã€‚Xfceæ¡Œé¢åŠä¸€äº›å…¶ä»–çš„é…ç½®è½¯ä»¶å®‰è£…å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apt-get install -y xubuntu-core lightdm</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050239.jpg" alt="img"> </p>
<p>åœ¨å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½è¦é€‰æ‹©é»˜è®¤æ˜¾ç¤ºç®¡ç†å™¨ï¼Œé€‰æ‹©lightmdå³å¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050316.jpg" alt="img"> </p>
<p>å®‰è£…å®Œæˆä¹‹åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ é™¤gdm3 ubuntu-sessionä¸¤ä¸ªè½¯ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apt-get remove -y gdm3 ubuntu-session</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212050334.jpg" alt="img"> </p>
<p>è‡³æ­¤ï¼Œå…³äºæ¡Œé¢çš„å®‰è£…å°±å®Œæˆäº†ã€‚</p>
<h3 id="7-4-8é…ç½®ç¡¬ç›˜è‡ªåŠ¨æ‰©å±•"><a href="#7-4-8é…ç½®ç¡¬ç›˜è‡ªåŠ¨æ‰©å±•" class="headerlink" title="7.4.8é…ç½®ç¡¬ç›˜è‡ªåŠ¨æ‰©å±•"></a>7.4.8é…ç½®ç¡¬ç›˜è‡ªåŠ¨æ‰©å±•</h3><p>ä¸ºäº†å°½å¯èƒ½çš„è®©çƒ§å†™çš„é•œåƒå°ï¼Œæ‰€ä»¥åœ¨æ„å»ºçƒ§å†™é•œåƒçš„æ—¶å€™åªæ˜¯åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šæ‰©å¤§äº†300Mï¼ˆåé¢è®²åˆ°ï¼‰ï¼Œä½†ç³»ç»Ÿçƒ§å†™è¿›å»ä¹‹åï¼Œä¼šå› ä¸ºç©ºé—´æ‰€ä»¥æ— æ³•å¯åŠ¨æ¡Œé¢ç¯å¢ƒç­‰ï¼Œæ‰€ä»¥ç¡¬ç›˜è‡ªåŠ¨æ‰©å±•ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ä¸€ä¸ªæ­¥éª¤ã€‚</p>
<p>é¦–å…ˆåœ¨usr&#x2F;binç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºdisk-helperçš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd usr/bin</span><br><span class="line">vim disk-helper</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Uncomment below to see more logs</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">set</span> -x</span></span><br><span class="line"></span><br><span class="line">MISC_DEV=$(realpath /dev/block/by-name/misc 2&gt;/dev/null)</span><br><span class="line"></span><br><span class="line">BUSYBOX_MOUNT_OPTS=&quot;loop (a|)sync (no|)atime (no|)diratime (no|)relatime (no|)dev (no|)exec (no|)suid (r|)shared (r|)slave (r|)private (un|)bindable (r|)bind move remount ro&quot;</span><br><span class="line">NTFS_3G_MOUNT_OPTS=&quot;ro uid=[0-9]* gid=[0-9]* umask=[0-9]* fmask=[0-9]* dmask=[0-9]*&quot;</span><br><span class="line"></span><br><span class="line">check_tool()</span><br><span class="line">&#123;</span><br><span class="line">	TOOL=$(echo $1 | grep -o &quot;^[^ ]*&quot;)</span><br><span class="line">	BR2_CONFIG=$2</span><br><span class="line"></span><br><span class="line">	type $TOOL &gt;/dev/null &amp;&amp; return 0</span><br><span class="line"></span><br><span class="line">	if grep -wq &quot;ID=buildroot&quot; /etc/os-release 2&gt;/dev/null; then</span><br><span class="line">		[ -n &quot;$BR2_CONFIG&quot; ] &amp;&amp; \</span><br><span class="line">			echo &quot;You may need to enable $BR2_CONFIG&quot;</span><br><span class="line">	else</span><br><span class="line">		echo &quot;Missing tool: $TOOL&quot;</span><br><span class="line">	fi</span><br><span class="line">	return 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">prepare_ubi()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Only support ubi <span class="keyword">for</span> mtd device</span></span><br><span class="line">	if echo $DEV | grep -vq /dev/mtd; then</span><br><span class="line">		echo &quot;$DEV is not a mtd device!&quot;</span><br><span class="line">		return 1</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	[ &quot;$PART_NO&quot; ] || &#123; echo &quot;No valid part number!&quot; &amp;&amp; return 1; &#125;</span><br><span class="line"></span><br><span class="line">	if [ &quot;$FSGROUP&quot; = ubifs ]; then</span><br><span class="line">		DEV=/dev/ubi$&#123;PART_NO&#125;_0</span><br><span class="line">	else</span><br><span class="line">		DEV=/dev/ubiblock$&#123;PART_NO&#125;_0</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	MTDDEV=/dev/mtd$&#123;PART_NO&#125;</span><br><span class="line"></span><br><span class="line">	echo &quot;Preparing $DEV from $MTDDEV&quot;</span><br><span class="line"></span><br><span class="line">	echo &quot;Remove ubi block device&quot;</span><br><span class="line">	if echo $DEV | grep -q ubiblock; then</span><br><span class="line">		check_tool ubiblock BR2_PACKAGE_MTD_UBIBLOCK || return 1</span><br><span class="line">		ubiblock -r /dev/ubi$&#123;PART_NO&#125;_0 &amp;&gt;/dev/null</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo &quot;Detach ubi device&quot;</span><br><span class="line">	check_tool ubidetach BR2_PACKAGE_MTD_UBIDETACH || return 1</span><br><span class="line">	ubidetach -p $MTDDEV &amp;&gt;/dev/null</span><br><span class="line"></span><br><span class="line">	echo &quot;Attach ubi device&quot;</span><br><span class="line">	check_tool ubiattach BR2_PACKAGE_MTD_UBIATTACH || return 1</span><br><span class="line">	ubiattach /dev/ubi_ctrl -m $PART_NO -d $PART_NO || return 1</span><br><span class="line"></span><br><span class="line">	echo &quot;Check for valid volume&quot;</span><br><span class="line">	if [ ! -e /dev/ubi$&#123;PART_NO&#125;_0 ]; then</span><br><span class="line">		echo &quot;No valid ubi volume&quot;</span><br><span class="line">		return 1</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo &quot;Create ubi block device&quot;</span><br><span class="line">	if echo $DEV | grep -q ubiblock; then</span><br><span class="line">		check_tool ubiblock BR2_PACKAGE_MTD_UBIBLOCK || return 1</span><br><span class="line">		ubiblock -c /dev/ubi$&#123;PART_NO&#125;_0 || return 1</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	return 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">format_ubifs()</span><br><span class="line">&#123;</span><br><span class="line">	echo &quot;Formatting $MTDDEV for $DEV&quot;</span><br><span class="line"></span><br><span class="line">	echo &quot;Remove ubi block device&quot;</span><br><span class="line">	if echo $DEV | grep -q ubiblock; then</span><br><span class="line">		check_tool ubiblock BR2_PACKAGE_MTD_UBIBLOCK || return 1</span><br><span class="line">		ubiblock -r /dev/ubi$&#123;PART_NO&#125;_0 &amp;&gt;/dev/null</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo &quot;Detach ubi device&quot;</span><br><span class="line">	check_tool ubidetach BR2_PACKAGE_MTD_UBIDETACH || return 1</span><br><span class="line">	ubidetach -p $MTDDEV &amp;&gt;/dev/null</span><br><span class="line"></span><br><span class="line">	echo &quot;Format device&quot;</span><br><span class="line">	check_tool ubiformat BR2_PACKAGE_MTD_UBIFORMAT || return 1</span><br><span class="line">	ubiformat -yq $MTDDEV || return 1</span><br><span class="line"></span><br><span class="line">	echo &quot;Attach ubi device&quot;</span><br><span class="line">	ubiattach /dev/ubi_ctrl -m $PART_NO -d $PART_NO || return 1</span><br><span class="line"></span><br><span class="line">	echo &quot;Create ubi volume&quot;</span><br><span class="line">	check_tool ubimkvol BR2_PACKAGE_MTD_UBIMKVOL || return 1</span><br><span class="line">	ubimkvol /dev/ubi$PART_NO -N $PART_NAME -m || return 1</span><br><span class="line"></span><br><span class="line">	echo &quot;Create ubi block device&quot;</span><br><span class="line">	if echo $DEV | grep -q ubiblock; then</span><br><span class="line">		check_tool ubiblock BR2_PACKAGE_MTD_UBIBLOCK || return 1</span><br><span class="line">		ubiblock -c /dev/ubi$&#123;PART_NO&#125;_0 || return 1</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">is_rootfs()</span><br><span class="line">&#123;</span><br><span class="line">	[ $MOUNT_POINT = &quot;/&quot; ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">remount_part()</span><br><span class="line">&#123;</span><br><span class="line">	mountpoint -q $MOUNT_POINT || return</span><br><span class="line"></span><br><span class="line">	if touch $MOUNT_POINT &amp;&gt;/dev/null; then</span><br><span class="line">		[ &quot;$1&quot; = ro ] &amp;&amp; mount -o remount,ro $MOUNT_POINT</span><br><span class="line">	else</span><br><span class="line">		[ &quot;$1&quot; = rw ] &amp;&amp; mount -o remount,rw $MOUNT_POINT</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">format_part()</span><br><span class="line">&#123;</span><br><span class="line">	echo &quot;Formatting $DEV($FSTYPE)&quot;</span><br><span class="line"></span><br><span class="line">	case $FSGROUP in</span><br><span class="line">		ext2)</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">Set max-mount-counts to 0, and <span class="built_in">disable</span> the time-dependent checking.</span></span><br><span class="line">			check_tool mke2fs BR2_PACKAGE_E2FSPROGS &amp;&amp; \</span><br><span class="line">			mke2fs -F -L $PART_NAME $DEV &amp;&amp; \</span><br><span class="line">			tune2fs -c 0 -i 0 $DEV</span><br><span class="line">			;;</span><br><span class="line">		vfat)</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">Use fat32 by default</span></span><br><span class="line">			check_tool mkfs.vfat BR2_PACKAGE_DOSFSTOOLS_MKFS_FAT &amp;&amp; \</span><br><span class="line">			mkfs.vfat -I -F 32 -n $PART_NAME $DEV</span><br><span class="line">			;;</span><br><span class="line">		ntfs)</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">Enable compression</span></span><br><span class="line">			check_tool mkntfs BR2_PACKAGE_NTFS_3G_NTFSPROGS &amp;&amp; \</span><br><span class="line">			mkntfs -FCQ -L $PART_NAME $DEV</span><br><span class="line">			;;</span><br><span class="line">		ubifs)</span><br><span class="line">			format_ubifs</span><br><span class="line">			;;</span><br><span class="line">		squashfs)</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">check_tool mksquashfs BR2_PACKAGE_SQUASHFS &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">			<span class="comment"># mksquashfs $DEV</span></span></span><br><span class="line">			echo &quot;It&#x27;s pointness to format a squashfs partition...&quot;</span><br><span class="line">			;;</span><br><span class="line">		jffs2)</span><br><span class="line">			echo &quot;It&#x27;s pointness to format a jffs2 partition...&quot;</span><br><span class="line">			;;</span><br><span class="line">		auto)</span><br><span class="line">			echo &quot;Unable to format a auto partition...&quot;</span><br><span class="line">			;;</span><br><span class="line">		*)</span><br><span class="line">			echo Unsupported file system $FSTYPE for $DEV</span><br><span class="line">			false</span><br><span class="line">			;;</span><br><span class="line">	esac</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">format_resize()</span><br><span class="line">&#123;</span><br><span class="line">	BACKUP=$1</span><br><span class="line">	SRC=$(realpath $MOUNT_POINT)</span><br><span class="line"></span><br><span class="line">	echo &quot;Format-resizing $DEV($FSTYPE)&quot;</span><br><span class="line"></span><br><span class="line">	echo &quot;Backup original data&quot;</span><br><span class="line">	cp -a &quot;$SRC&quot; &quot;$BACKUP/&quot; || return 1</span><br><span class="line">	umount &quot;$SRC&quot; || return 1</span><br><span class="line"></span><br><span class="line">	echo &quot;Format and mount rw&quot;</span><br><span class="line">	format_part || return 1</span><br><span class="line">	mount_part || return 1</span><br><span class="line">	remount_part rw</span><br><span class="line"></span><br><span class="line">	echo &quot;Restore backup data&quot;</span><br><span class="line">	cp -a &quot;$BACKUP/$SRC&quot; $(dirname &quot;$SRC&quot;) || return 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resize_ext2()</span><br><span class="line">&#123;</span><br><span class="line">	check_tool resize2fs BR2_PACKAGE_E2FSPROGS_RESIZE2FS || return 1</span><br><span class="line"></span><br><span class="line">	resize2fs $DEV</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resize_vfat()</span><br><span class="line">&#123;</span><br><span class="line">	check_tool fatresize BR2_PACKAGE_FATRESIZE || return 1</span><br><span class="line"></span><br><span class="line">	SIZE=$(fatresize -i $DEV | grep &quot;Size:&quot; | grep -o &quot;[0-9]*$&quot;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Somehow fatresize only works <span class="keyword">for</span> 256M+ fat</span></span><br><span class="line">	[ &quot;$SIZE&quot; -gt $((256 * 1024 * 1024)) ] &amp;&amp; return 1</span><br><span class="line"></span><br><span class="line">	MAX_SIZE=$(( $(cat $SYS_PATH/size) * 512))</span><br><span class="line">	MIN_SIZE=$(($MAX_SIZE - 16 * 1024 * 1024))</span><br><span class="line">	[ $MIN_SIZE -lt $SIZE ] &amp;&amp; return 0 # Large enough!</span><br><span class="line">	while [ $MAX_SIZE -gt $MIN_SIZE ];do</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">Somehow fatresize cannot resize to max size</span></span><br><span class="line">		MAX_SIZE=$(($MAX_SIZE - 512 * 1024))</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">Try to resize with fatresize, not always work</span></span><br><span class="line">		fatresize -s $MAX_SIZE $DEV &amp;&amp; return</span><br><span class="line">	done</span><br><span class="line">	return 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resize_ntfs()</span><br><span class="line">&#123;</span><br><span class="line">	check_tool ntfsresize BR2_PACKAGE_NTFS_3G_NTFSPROGS || return 1</span><br><span class="line"></span><br><span class="line">	echo y | ntfsresize -f $DEV</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resize_part()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Fixed size or already resized</span></span><br><span class="line">	[ -f $MOUNT_POINT/.fixed -o -f $MOUNT_POINT/.resized ] &amp;&amp; return</span><br><span class="line"></span><br><span class="line">	if [ -z &quot;$FSRESIZE&quot; ]; then</span><br><span class="line">		echo &quot;No resize for $FSTYPE&quot;</span><br><span class="line">		return</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo &quot;Resizing $DEV($FSTYPE)&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Online resize needs read-write</span></span><br><span class="line">	remount_part rw</span><br><span class="line">	if eval $FSRESIZE; then</span><br><span class="line">		touch $MOUNT_POINT/.resized</span><br><span class="line">		return</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo &quot;Done with rootfs&quot;</span><br><span class="line">	is_rootfs &amp;&amp; return</span><br><span class="line"></span><br><span class="line">	echo &quot;Fallback to format resize&quot;</span><br><span class="line">	TEMP_BACKUP=$(mktemp -d)</span><br><span class="line">	format_resize $TEMP_BACKUP &amp;&amp; touch $MOUNT_POINT/.resized</span><br><span class="line">	rm -rf $TEMP_BACKUP</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">erase_oem_command()</span><br><span class="line">&#123;</span><br><span class="line">	CMD=$1</span><br><span class="line">	FILE=$2</span><br><span class="line"></span><br><span class="line">	echo &quot;OEM: Erasing $CMD in $FILE&quot;</span><br><span class="line"></span><br><span class="line">	COUNT=$(echo $CMD | wc -c)</span><br><span class="line">	OFFSETS=$(strings -t d $FILE | grep -w &quot;$CMD&quot; | awk &#x27;&#123; print $1 &#125;&#x27;)</span><br><span class="line"></span><br><span class="line">	for offset in $OFFSETS; do</span><br><span class="line">		dd if=/dev/zero of=$FILE bs=1 count=$COUNT seek=$offset conv=notrunc 2&gt;/dev/null</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">done_oem_command()</span><br><span class="line">&#123;</span><br><span class="line">	CMD=$1</span><br><span class="line"></span><br><span class="line">	echo &quot;OEM: Done with $CMD&quot;</span><br><span class="line"></span><br><span class="line">	if [ -b &quot;$MISC_DEV&quot; ]; then</span><br><span class="line">		erase_oem_command $CMD $MISC_DEV</span><br><span class="line">	else</span><br><span class="line">		echo &quot;OEM: Erase $CMD from mtd device&quot;</span><br><span class="line"></span><br><span class="line">		check_tool nanddump BR2_PACKAGE_MTD_NANDDUMP || return</span><br><span class="line">		check_tool nandwrite BR2_PACKAGE_MTD_NANDWRITE || return</span><br><span class="line">		check_tool flash_erase BR2_PACKAGE_MTD_FLASH_ERASE || return</span><br><span class="line"></span><br><span class="line">		TEMP=$(mktemp)</span><br><span class="line">		nanddump $MISC_DEV -f $TEMP</span><br><span class="line">		erase_oem_command $CMD $TEMP</span><br><span class="line">		flash_erase $MISC_DEV 0 0</span><br><span class="line">		nandwrite $MISC_DEV $TEMP</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">handle_oem_command()</span><br><span class="line">&#123;</span><br><span class="line">	[ &quot;$OEM_CMD&quot; ] || return</span><br><span class="line"></span><br><span class="line">	for cmd in $OEM_CMD; do</span><br><span class="line">		case $cmd in</span><br><span class="line"><span class="meta prompt_">			cmd_wipe_$</span><span class="language-bash">PART_NAME)</span></span><br><span class="line">				is_rootfs &amp;&amp; continue</span><br><span class="line"></span><br><span class="line">				echo &quot;OEM: $cmd - Wiping $DEV&quot;</span><br><span class="line">				format_part &amp;&amp; done_oem_command $cmd</span><br><span class="line">				;;</span><br><span class="line">		esac</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">convert_mount_opts()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Accept all opts by default <span class="keyword">for</span> standard mount tool</span></span><br><span class="line">	if [ -z &quot;$@&quot; ] &amp;&amp; [ &quot;$(readlink $(which mount))&quot; != busybox ]; then</span><br><span class="line">		echo $OPTS</span><br><span class="line">		return</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Filter out unsupported opts</span></span><br><span class="line">	for opt in $&#123;@:-$BUSYBOX_MOUNT_OPTS&#125;; do</span><br><span class="line">		echo $&#123;OPTS//,/ &#125; | xargs -n 1 | grep -oE &quot;^$opt$&quot;</span><br><span class="line">	done | tr &quot;\n&quot; &quot;,&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">prepare_part()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Ignore external storages</span></span><br><span class="line">	echo $MOUNT_POINT | grep -q &quot;^\/mnt\/&quot; &amp;&amp; return 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Find real dev <span class="keyword">for</span> root dev</span></span><br><span class="line">	if is_rootfs; then</span><br><span class="line">		DEV=$(findmnt -n -o source /)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">Fallback to the by-name <span class="built_in">link</span></span></span><br><span class="line">		[ &quot;$DEV&quot; ] || DEV=/dev/block/by-name/rootfs</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	DEV=$(realpath $DEV 2&gt;/dev/null)</span><br><span class="line">	PART_NO=$(echo $DEV | grep -oE &quot;[0-9]*$&quot;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Unknown device</span></span><br><span class="line">	[ -b &quot;$DEV&quot; -o -c &quot;$DEV&quot; ] || return 1</span><br><span class="line"></span><br><span class="line">	SYS_PATH=$(echo /sys/class/*/$&#123;DEV##*/&#125;)</span><br><span class="line">	if [ -f &quot;$SYS_PATH/name&quot; ]; then</span><br><span class="line">		PART_NAME=$(cat $SYS_PATH/name)</span><br><span class="line">	else</span><br><span class="line">		PART_NAME=$(grep PARTNAME $&#123;SYS_PATH&#125;/uevent | cut -d &#x27;=&#x27; -f 2)</span><br><span class="line">	fi</span><br><span class="line">	PART_NAME=$&#123;PART_NAME:-$&#123;DEV##*/&#125;&#125;</span><br><span class="line"></span><br><span class="line">	case $FSTYPE in</span><br><span class="line">		ext[234])</span><br><span class="line">			FSGROUP=ext2</span><br><span class="line">			FSCK=&quot;fsck.$FSTYPE -y&quot;</span><br><span class="line">			FSCK_CONFIG=BR2_PACKAGE_E2FSPROGS_FSCK</span><br><span class="line">			FSRESIZE=resize_ext2</span><br><span class="line">			;;</span><br><span class="line">		msdos|fat|vfat)</span><br><span class="line">			FSGROUP=vfat</span><br><span class="line">			FSCK=&quot;fsck.vfat -y&quot;</span><br><span class="line">			FSCK_CONFIG=BR2_PACKAGE_DOSFSTOOLS_FSCK_FAT</span><br><span class="line">			FSRESIZE=resize_vfat</span><br><span class="line">			;;</span><br><span class="line">		ntfs)</span><br><span class="line">			FSGROUP=ntfs</span><br><span class="line">			FSCK=ntfsfix</span><br><span class="line">			FSCK_CONFIG=BR2_PACKAGE_NTFS_3G_NTFSPROGS</span><br><span class="line">			FSRESIZE=resize_ntfs</span><br><span class="line">			;;</span><br><span class="line">		ubi|ubifs)</span><br><span class="line">			FSGROUP=ubifs</span><br><span class="line">			unset FSCK</span><br><span class="line">			unset FSRESIZE</span><br><span class="line">			;;</span><br><span class="line">		squashfs)</span><br><span class="line">			FSGROUP=squashfs</span><br><span class="line">			unset FSCK</span><br><span class="line">			unset FSRESIZE</span><br><span class="line">			;;</span><br><span class="line">		jffs2)</span><br><span class="line">			FSGROUP=jffs2</span><br><span class="line">			unset FSCK</span><br><span class="line">			unset FSRESIZE</span><br><span class="line">			;;</span><br><span class="line">		auto)</span><br><span class="line">			FSGROUP=auto</span><br><span class="line">			echo &quot;Running fsck on a random fs is dangerous&quot;</span><br><span class="line">			unset FSCK</span><br><span class="line">			unset FSRESIZE</span><br><span class="line">			;;</span><br><span class="line">		*)</span><br><span class="line">			echo &quot;Unsupported file system $FSTYPE for $DEV&quot;</span><br><span class="line">			return</span><br><span class="line">	esac</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Setup mount tool and opts</span></span><br><span class="line">	case $FSGROUP in</span><br><span class="line">		ntfs)</span><br><span class="line">			MOUNT=ntfs-3g</span><br><span class="line">			check_tool ntfs-3g BR2_PACKAGE_NTFS_3G || return 1</span><br><span class="line">			OPTS=$(convert_mount_opts &quot;$NTFS_3G_MOUNT_OPTS&quot;)</span><br><span class="line">			;;</span><br><span class="line">		ubifs)</span><br><span class="line">			MOUNT=&quot;mount -t ubifs&quot;</span><br><span class="line">			OPTS=$(convert_mount_opts)</span><br><span class="line">			;;</span><br><span class="line">		*)</span><br><span class="line">			MOUNT=mount</span><br><span class="line">			OPTS=$(convert_mount_opts)</span><br><span class="line">			;;</span><br><span class="line">	esac</span><br><span class="line">	MOUNT_OPTS=$&#123;OPTS:+&quot; -o $&#123;OPTS%,&#125;&quot;&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Prepare <span class="keyword">for</span> ubi (consider /dev/mtdX as ubiblock)</span></span><br><span class="line">	if [ &quot;$FSGROUP&quot; = ubifs ] || echo $DEV | grep -q &quot;/dev/mtd[0-9]&quot;;then</span><br><span class="line">		if ! prepare_ubi; then</span><br><span class="line">			echo &quot;Failed to prepare ubi for $DEV&quot;</span><br><span class="line">			[ &quot;$AUTO_MKFS&quot; ] || return</span><br><span class="line"></span><br><span class="line">			echo &quot;Auto formatting&quot;</span><br><span class="line">			format_ubifs || return</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check_part()</span><br><span class="line">&#123;</span><br><span class="line">	[ &quot;$SKIP_FSCK&quot; -o &quot;$PASS&quot; -eq 0 ] &amp;&amp; return</span><br><span class="line"></span><br><span class="line">	if [ -z &quot;$FSCK&quot; ]; then</span><br><span class="line">		echo &quot;No fsck for $FSTYPE&quot;</span><br><span class="line">		return</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo &quot;Checking $DEV($FSTYPE)&quot;</span><br><span class="line"></span><br><span class="line">	check_tool &quot;$FSCK&quot; $FSCK_CONFIG || return</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">Fsck needs read-only</span></span><br><span class="line">	remount_part ro</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">FSCK <span class="variable">$DEV</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mount_part()</span><br><span class="line">&#123;</span><br><span class="line">	echo &quot;Mounting $DEV($FSTYPE) on $MOUNT_POINT $&#123;MOUNT_OPTS:+with$MOUNT_OPTS&#125;&quot;</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">MOUNT <span class="variable">$DEV</span> <span class="variable">$MOUNT_POINT</span> <span class="variable">$MOUNT_OPTS</span> &amp;&amp; <span class="built_in">return</span></span></span><br><span class="line">	[ &quot;$AUTO_MKFS&quot; ] || return</span><br><span class="line"></span><br><span class="line">	echo &quot;Failed to mount $DEV, try to format it&quot;</span><br><span class="line">	format_part &amp;&amp; \</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">MOUNT <span class="variable">$DEV</span> <span class="variable">$MOUNT_POINT</span> <span class="variable">$MOUNT_OPTS</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>â€‹	ç„¶åç»§ç»­åˆ›å»ºä¸€ä¸ªåä¸ºresize-helperçš„è„šæœ¬æ–‡ä»¶ï¼Œå‘è¯¥æ–‡ä»¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim resize-helper</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## BEGIN INIT INFO</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Provides:       resize-all</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Default-Start:  S</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Default-Stop:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Description:    è°ƒæ•´æ‰€æœ‰å·²æŒ‚è½½çš„å†…éƒ¨åˆ†åŒºçš„å¤§å°</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## END INIT INFO</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸åœ¨é”™è¯¯çŠ¶æ€ä¸‹é€€å‡º</span></span><br><span class="line">set +e</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å–æ¶ˆä»¥ä¸‹æ³¨é‡Šä»¥æŸ¥çœ‹æ›´å¤šæ—¥å¿—</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">set</span> -x</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŒ…å« disk-helper è„šæœ¬</span></span><br><span class="line">. $(dirname $0)/disk-helper</span><br><span class="line"></span><br><span class="line">LOGFILE=/tmp/resize-all.log</span><br><span class="line"></span><br><span class="line">do_part()</span><br><span class="line">&#123;</span><br><span class="line">    DEV=$1</span><br><span class="line">    MOUNT_POINT=$2</span><br><span class="line">    FSTYPE=$3</span><br><span class="line">    OPTS=$4</span><br><span class="line"></span><br><span class="line">    echo &quot;å¤„ç† $DEV $MOUNT_POINT $FSTYPE $OPTS&quot;</span><br><span class="line"></span><br><span class="line">    # è®¾ç½®æ£€æŸ¥/æŒ‚è½½å·¥å…·å¹¶è¿›è¡Œä¸€äº›å‡†å¤‡å·¥ä½œ</span><br><span class="line">    prepare_part || return</span><br><span class="line"></span><br><span class="line">    # å­˜å‚¨ ro/rw</span><br><span class="line">    MOUNTED_RO_RW=$(touch $MOUNT_POINT &amp;&gt;/dev/null &amp;&amp; echo rw || echo ro)</span><br><span class="line"></span><br><span class="line">    # å¦‚æœéœ€è¦ï¼Œè°ƒæ•´åˆ†åŒºå¤§å°</span><br><span class="line">    resize_part</span><br><span class="line"></span><br><span class="line">    # æ¢å¤ ro/rw</span><br><span class="line">    remount_part $MOUNTED_RO_RW</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resize_all()</span><br><span class="line">&#123;</span><br><span class="line">    echo &quot;å°†è°ƒæ•´ /proc/mounts ä¸­çš„æ‰€æœ‰åˆ†åŒºå¤§å°&quot;</span><br><span class="line"></span><br><span class="line">    while read LINE; do</span><br><span class="line">        do_part $LINE</span><br><span class="line">    done &lt; /proc/mounts</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    start|&quot;&quot;)</span><br><span class="line">        resize_all 2&gt;&amp;1 | tee $LOGFILE</span><br><span class="line">        echo &quot;æ—¥å¿—ä¿å­˜è‡³ $LOGFILE&quot;</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        echo &quot;ç”¨æ³•: resize-helper start&quot; &gt;&amp;2</span><br><span class="line">        exit 3</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p>â€‹	è¯¥è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯åœ¨ç³»ç»Ÿå¼•å¯¼æ—¶è°ƒæ•´æ‰€æœ‰å·²æŒ‚è½½çš„å†…éƒ¨åˆ†åŒºçš„å¤§å°ï¼Œä¿å­˜é€€å‡ºä¹‹åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç»™äºˆä¸¤ä¸ªè„šæœ¬çš„å¯æ‰§è¡Œæƒé™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chmod 777 resize-helper disk-helper</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311212254933.png" alt="image-20231121225448900"></p>
<p>ç„¶ååœ¨etc&#x2F;init.dç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºresize-disk.shçš„å¼€æœºå¯åŠ¨é¡¹ï¼Œå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash -e</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Description:  è°ƒæ•´ Rockchip å¹³å°ç¯å¢ƒä¸‹çš„ç£ç›˜å¤§å°</span></span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    start)</span><br><span class="line">        if [ ! -e /var/lib/misc/firstrun ]; then</span><br><span class="line">            /usr/bin/resize-helper  # è°ƒç”¨ resize-helper è„šæœ¬æ¥è°ƒæ•´ç£ç›˜å¤§å°</span><br><span class="line">            mkdir -p /var/lib/misc  # åˆ›å»ºç›®å½• /var/lib/misc</span><br><span class="line">            touch /var/lib/misc/firstrun  # åˆ›å»ºæ–‡ä»¶ /var/lib/misc/firstrun</span><br><span class="line">        fi</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        ;;</span><br><span class="line">    restart|reload)</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        echo &quot;ç”¨æ³•: $0 &#123;start|stop|restart&#125;&quot;</span><br><span class="line">        exit 1</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">exit $?</span><br></pre></td></tr></table></figure>

<p>è¯¥è„šæœ¬æ˜¯ä¸€ä¸ªåˆå§‹åŒ–è„šæœ¬ï¼ˆinit scriptï¼‰ï¼Œç”¨äºåœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨ç³»ç»Ÿæ—¶ï¼Œè¿è¡Œ&#x2F;usr&#x2F;bin&#x2F;resize-helperè°ƒæ•´ç£ç›˜å¤§å°ã€‚ç°åœ¨åªæ˜¯åˆ›å»ºäº†è¯¥è„šæœ¬ï¼Œæ¥ä¸‹æ¥å‘ç³»ç»Ÿä¸­æ·»åŠ ç›¸åº”çš„æœåŠ¡ï¼Œè®©è¯¥è„šæœ¬å¼€æœºè‡ªåŠ¨è¿è¡Œï¼Œé¦–å…ˆæ¥åˆ°&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;systemç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºresize-disk.serviceçš„æœåŠ¡ï¼Œç„¶åå‘è¯¥æœåŠ¡ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /usr/lib/systemd/system</span><br><span class="line">vi resize-disk.service</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">start</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Resize disk for rockchcip platform</span><br><span class="line">After=lighdm.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/etc/init.d/resize-disk.sh start</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">end</span></span><br></pre></td></tr></table></figure>

<p>è¯¥æœåŠ¡ä¼šè¿è¡Œ&#x2F;etc&#x2F;init.d&#x2F;resize-disk.shè„šæœ¬ï¼Œè¯¥è„šæœ¬</p>
<p>ä¿å­˜é€€å‡ºä¹‹åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºè¯¥æ–‡ä»¶çš„è½¯é“¾æ¥åˆ°&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;sysinit.target.wants&#x2F;ç›®å½•ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ln -s /usr/lib/systemd/system/resize-disk.service /etc/systemd/system/sysinit.target.wants/resize-disk.service</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311220732603.png" alt="image-20231122073214553"></p>
<p>â€‹	è‡³æ­¤ï¼Œå…³äºè‡ªåŠ¨æ‰©å®¹ç›¸å…³çš„é…ç½®ä¹Ÿå°±å®Œæˆäº†ï¼Œè¿™æ—¶å€™å¦‚æœåˆ¶ä½œçƒ§å†™é•œåƒè¿›å…¥ç³»ç»Ÿä¹‹åä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311220734847.png" alt="image-20231122073421803"></p>
<h3 id="7-4-9é…ç½®ADB"><a href="#7-4-9é…ç½®ADB" class="headerlink" title="7.4.9é…ç½®ADB"></a>7.4.9é…ç½®ADB</h3><p>ç‘èŠ¯å¾®åœ¨å¾ˆå¤šåœ°æ–¹è¦ç”¨åˆ°adbæœåŠ¡ï¼Œä¾‹å¦‚åœ¨RKNPUä¸­è¦ç”¨åˆ°çš„è¿æ‰³æ¨ç†ï¼ŒPCç«¯å‘å¼€å‘æ¿ä¼ è¾“æ–‡ä»¶éƒ½è¦ä½¿ç”¨adbæœåŠ¡ï¼Œæ‰€ä»¥åœ¨æœ¬å°èŠ‚å°†å¯¹adbæœåŠ¡è¿›è¡Œé€‚é…ã€‚</p>
<p>æœ¬å°èŠ‚è¦ç”¨åˆ°äº†æ–‡ä»¶å·²ç»æ”¾åœ¨äº†â€œiTOP-3568å¼€å‘æ¿\03_ã€iTOP-RK3568å¼€å‘æ¿ã€‘æŒ‡å—æ•™ç¨‹\03_æ–‡ä»¶ç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\04_Ubuntuå’ŒDebianç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\02_é…ç½®ADBâ€ç›®å½•ä¸‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023023.jpg" alt="img"> </p>
<p>é¦–å…ˆè¿›å…¥&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;ç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºusbdevice.serviceçš„æœåŠ¡ï¼Œè¯¥æœåŠ¡çš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Manage USB device functions</span><br><span class="line">DefaultDependencies=no</span><br><span class="line">After=local-fs.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/bin/usbdevice start </span><br><span class="line">ExecStop=/usr/bin/usbdevice stop</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=sysinit.target</span><br></pre></td></tr></table></figure>

<p>ä¿å­˜é€€å‡ºä¹‹åï¼Œç»§ç»­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºè¯¥æ–‡ä»¶çš„è½¯é“¾æ¥åˆ°&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;sysinit.target.wants&#x2F;ç›®å½•ä¸‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p>ln -s &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;usbdevice.service &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;sysinit.target.wants&#x2F;usbdevice.service</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023029.jpg" alt="img"> </p>
<p>ç„¶åè¿›å…¥&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;rules.dç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º61-usbdevice.rulesçš„è§„æ ¼ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SUBSYSTEM==&quot;android_usb&quot;,ACTION==&quot;change&quot;,RUN+=&quot;/usr/bin/usbdevice update&quot;  </span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè§„åˆ™å®šä¹‰äº†ä¸€ä¸ªè§¦å‘æ¡ä»¶ï¼Œå³å½“ç³»ç»Ÿä¸­çš„Android USBè®¾å¤‡å‘ç”Ÿæ›´æ”¹æ—¶ï¼ˆä¾‹å¦‚æ’å…¥æˆ–æ‹”å‡ºè®¾å¤‡ï¼‰ï¼Œå°†è¿è¡Œä¸€ä¸ªç‰¹å®šçš„å‘½ä»¤&#x2F;usr&#x2F;bin&#x2F;usbdevice updateï¼Œç„¶åå°†æä¾›èµ„æ–™é‡Œçš„usbdeviceè„šæœ¬å’Œadbdæ‹·è´åˆ°&#x2F;usr&#x2F;binç›®å½•ä¸‹ï¼ˆéœ€è¦æ‰“å¼€ä¸€ä¸ªç»ˆç«¯è¿›è¡Œæ“ä½œï¼‰ï¼Œæ‹·è´å®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023030.jpg" alt="img"></p>
<p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤èµ‹äºˆä¸¤ä¸ªæ–‡ä»¶å¯æ‰§è¡Œæƒé™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 777 adbd usbdevice</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023031.jpg" alt="img"> </p>
<p>æœ€åæ¥åˆ°&#x2F;etc&#x2F;profile.d&#x2F;ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºusbdevice.shçš„æ–‡ä»¶ï¼Œ&#x2F;etc&#x2F;profile.d&#x2F;ç›®å½•æ˜¯ç”¨äºå­˜æ”¾ç³»ç»Ÿçº§åˆ«çš„é…ç½®æ–‡ä»¶çš„ç›®å½•ã€‚å½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ‰§è¡Œ&#x2F;etc&#x2F;profileæ–‡ä»¶ï¼Œç„¶åå‘usbdevice.shæ–‡ä»¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_">  </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The <span class="built_in">env</span> variables below can be overridden</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">option: adb acm hid mtp ntb rndis uac1 uac2 ums uvc</span></span><br><span class="line">export USB_FUNCS=&quot;adb&quot;       </span><br><span class="line">export UMS_FILE=/userdata/ums_shared.img</span><br><span class="line">export UMS_SIZE=256M</span><br><span class="line">export UMS_FSTYPE=vfat</span><br><span class="line">export UMS_MOUNT=0</span><br><span class="line">export UMS_MOUNTPOINT=/mnt/ums</span><br><span class="line">export UMS_RO=0</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­è¦æ³¨æ„çš„æ˜¯ç¬¬6è¡Œçš„å†…å®¹ï¼Œè¡¨ç¤ºé»˜è®¤æ¨¡å¼ä¸ºADBï¼Œä¹Ÿæœ‰å…¶ä»–çš„å‡ ç§æ¨¡å¼ï¼Œå¦‚æœåç»­ç”¨åˆ°ä¼šè¿›è¡Œè¯´æ˜ï¼Œè‡³æ­¤ï¼Œå…³äºadbçš„é…ç½®å°±å®Œæˆäº†ï¼Œé•œåƒæ‰“åŒ…ä¹‹åçƒ§å†™åˆ°å¼€å‘æ¿ä¸Šï¼Œåœ¨RKçš„çƒ§å†™è½¯ä»¶ä¸­ä¼šæ˜¾ç¤ºâ€œå‘ç°äº†ä¸€ä¸ªADBè®¾å¤‡â€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023035.jpg" alt="img"></p>
<p>ç„¶åå°†ADBè®¾å¤‡è¿æ¥åˆ°è™šæ‹Ÿæœºubuntuä¸Šï¼Œè¿æ¥æˆåŠŸä¹‹åœ¨å·¦ä¾§åä¼šæœ‰ä¸€ä¸ªæ‰‹æœºçš„å›¾æ ‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023033.jpg" alt="img"></p>
<p>é¦–å…ˆè¾“å…¥â€œadb devicesâ€å‘½ä»¤æŸ¥çœ‹adbè®¾å¤‡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023203.jpg" alt="img"></p>
<p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æµ‹è¯•æ–‡ä»¶testé€šè¿‡adbä¼ è¾“åˆ°å¼€å‘æ¿çš„æ ¹ç›®å½•ï¼Œä¼ è¾“è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023212.jpg" alt="img"></p>
<p>ç„¶åæŸ¥çœ‹å¼€å‘æ¿çš„æ ¹ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°testæ–‡ä»¶å·²ç»æˆåŠŸä¼ è¾“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023222.jpg" alt="img"></p>
<p>è‡³æ­¤ï¼Œå…³äºadbçš„æµ‹è¯•å°±å®Œæˆäº†ã€‚</p>
<h3 id="7-4-10é…ç½®ç»ˆç«¯å’Œæ¡Œé¢è‡ªåŠ¨ç™»å½•"><a href="#7-4-10é…ç½®ç»ˆç«¯å’Œæ¡Œé¢è‡ªåŠ¨ç™»å½•" class="headerlink" title="7.4.10é…ç½®ç»ˆç«¯å’Œæ¡Œé¢è‡ªåŠ¨ç™»å½•"></a>7.4.10é…ç½®ç»ˆç«¯å’Œæ¡Œé¢è‡ªåŠ¨ç™»å½•</h3><p>æœ¬å°èŠ‚è¦ç”¨åˆ°çš„æ–‡ä»¶è·¯å¾„ä¸ºâ€œiTOP-3568å¼€å‘æ¿\03_ã€iTOP-RK3568å¼€å‘æ¿ã€‘æŒ‡å—æ•™ç¨‹\03_æ–‡ä»¶ç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\04_Ubuntuå’ŒDebianç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\03_ç»ˆç«¯å’Œæ¡Œé¢è‡ªåŠ¨ç™»å½•â€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023229.jpg" alt="img"> </p>
<p>ä¸ºäº†æ–¹ä¾¿ï¼Œæœ¬å°èŠ‚å°†å–æ¶ˆubuntuå¯åŠ¨æ—¶çš„ç»ˆç«¯ç™»å½•å’Œæ¡Œé¢çš„ç™»å½•ï¼Œé»˜è®¤è®©ç»ˆç«¯ç™»å½•è¿›rootç”¨æˆ·ï¼Œæ¡Œé¢é»˜è®¤ç™»å½•topeetç”¨æˆ·ï¼Œé¦–å…ˆè¾“å…¥ä»¥ä¸‹å‘½ä»¤ä¿®æ”¹ç»ˆç«¯è®¾ç½®é€‰é¡¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vim /lib/systemd/system/serial-getty\@.service</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°†ExecStarté€‰é¡¹ä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼Œä¿®æ”¹å®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ExecStart= -/sbin/agetty --autologin root --noclear %I $TERM</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023238.jpg" alt="img"> </p>
<p>è‡³æ­¤ï¼Œä¸²å£ç»ˆç«¯è‡ªåŠ¨ç™»å½•rootç”¨æˆ·å°±è®¾ç½®å®Œæˆäº†ï¼Œç„¶åè®¾ç½®æ¡Œé¢è‡ªåŠ¨ç™»å½•ï¼Œåœ¨å®‰è£…æ¡Œé¢ç« èŠ‚é»˜è®¤æ˜¾ç¤ºç®¡ç†å™¨ä½¿ç”¨çš„æ˜¯lightdmï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å°†æä¾›èµ„æ–™é‡Œé¢çš„lightdm.confæ‹·è´åˆ°&#x2F;etc&#x2F;lightdmç›®å½•ä¸‹ï¼Œæ‹·è´å®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023246.jpg" alt="img"> </p>
<p>æ¶‰åŠåˆ°è‡ªåŠ¨ç™»å½•çš„å†…å®¹ä¸ºè¯¥é…ç½®æ–‡ä»¶çš„126è¡Œå’Œ127è¡Œï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023348.jpg" alt="img"></p>
<p>è¿™é‡Œé»˜è®¤ç™»å½•çš„ä¸ºtopeetç”¨æˆ·ï¼Œå¦‚æœæƒ³è¦è‡ªåŠ¨ç™»å½•å…¶ä»–ç”¨æˆ·è‡ªè¡Œä¿®æ”¹å³å¯ï¼Œæ‰“åŒ…é•œåƒï¼Œçƒ§å†™åˆ°å¼€å‘æ¿ä¸Šä¹‹åï¼Œå¯ä»¥çœ‹åˆ°ç»ˆç«¯å·²ç»è‡ªåŠ¨ç™»å½•è¿›å…¥äº†ç³»ç»Ÿï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023362.jpg" alt="img"></p>
<p>åœ¨å›¾å½¢ç•Œé¢ä¹Ÿè·³è¿‡äº†ç™»å½•ç•Œé¢ï¼Œè‡ªåŠ¨è¿›å…¥äº†æ¡Œé¢ï¼Œè¿›å…¥æ¡Œé¢ä¹‹åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023376.png" alt="img"></p>
<p>è‡³æ­¤ç»ˆç«¯å’Œæ¡Œé¢è‡ªåŠ¨ç™»å½•çš„è®¾ç½®å°±å®Œæˆäº†ã€‚</p>
<h3 id="7-4-11é…ç½®ä»¥å¤ªç½‘ç»œ"><a href="#7-4-11é…ç½®ä»¥å¤ªç½‘ç»œ" class="headerlink" title="7.4.11é…ç½®ä»¥å¤ªç½‘ç»œ"></a>7.4.11é…ç½®ä»¥å¤ªç½‘ç»œ</h3><p>æœ¬å°èŠ‚è¦ç”¨åˆ°çš„æ–‡ä»¶è·¯å¾„ä¸ºâ€œiTOP-3568å¼€å‘æ¿\03_ã€iTOP-RK3568å¼€å‘æ¿ã€‘æŒ‡å—æ•™ç¨‹\03_æ–‡ä»¶ç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\04_Ubuntuå’ŒDebianç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\05_ä»¥å¤ªç½‘é…ç½®â€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023386.jpg" alt="img"> </p>
<p>ç°åœ¨ç³»ç»Ÿå¯åŠ¨ä¹‹åå¦‚æœä½¿ç”¨â€œifconfigâ€å‘½ä»¤æŸ¥çœ‹ç½‘ç»œå¯ä»¥å‘ç°åªæœ‰ä¸€ä¸ªæœ¬åœ°å›ç¯ç”Ÿæ•ˆäº†ï¼Œå…¶ä»–çš„å¹¶æœªç”Ÿæ•ˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023392.jpg" alt="img"></p>
<p>æ‰€ä»¥éœ€è¦å¯¹ç½‘ç»œè¿›è¡Œä¸€äº›é…ç½®ï¼Œé¦–å…ˆå¯¹â€œ&#x2F;etc&#x2F;NetworkManager&#x2F;NetworkManager.confâ€æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œå°†ifupdownä»falseè®¾ç½®ä¸ºtrueï¼Œä¿®æ”¹å®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023399.jpg" alt="img"></p>
<p>é€šè¿‡å°†[ifupdown]éƒ¨åˆ†ä¸­çš„managedé€‰é¡¹è®¾ç½®ä¸ºtrueï¼Œå¯ä»¥å¯ç”¨ NetworkManager å¯¹ ifupdown å·¥å…·çš„é›†æˆã€‚è¿™æ„å‘³ç€ NetworkManager å°†è¯»å–å’Œè§£é‡Š &#x2F;etc&#x2F;network&#x2F;interfaces æ–‡ä»¶ä¸­çš„é…ç½®ï¼Œå¹¶ä½¿ç”¨è‡ªå·±çš„æœºåˆ¶æ¥ç®¡ç†è¿™äº›ç½‘ç»œæ¥å£ã€‚</p>
<p>ç„¶åä¿®æ”¹&#x2F;usr&#x2F;lib&#x2F;NetworkManager&#x2F;conf.d&#x2F;10-globally-managed-devices.confé…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[keyfile] </span><br><span class="line">unmanaged-devices=*,except:type:wifi,except:type:ethernet,except:type:gsm,except:type:cdma</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè§„åˆ™çš„ä½œç”¨æ˜¯å‘Šè¯‰ NetworkManager ä¸è¦è‡ªåŠ¨ç®¡ç†é™¤äº†Wi-Fiã€ä»¥å¤ªç½‘ã€GSM å’Œ CDMA è®¾å¤‡ä¹‹å¤–çš„å…¶ä»–ç±»å‹çš„ç½‘ç»œè®¾å¤‡ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿è¿™äº›è®¾å¤‡ä¸å— NetworkManager çš„å¹²é¢„ï¼Œå¹¶å…è®¸å…¶ä»–å·¥å…·æˆ–é…ç½®æ¥å¤„ç†å®ƒä»¬ã€‚</p>
<p>è‡³æ­¤å…³äºç½‘ç»œç›¸å…³çš„é…ç½®å°±å®Œæˆäº†ã€‚æ‰“åŒ…é•œåƒé‡æ–°çƒ§å†™ä¹‹åï¼Œé‡æ–°ä½¿ç”¨â€œifconfigâ€å‘½ä»¤æŸ¥çœ‹ç½‘ç»œé…ç½®ï¼Œå¯ä»¥çœ‹åˆ°eth0å’Œeth1å·²ç»å‡ºç°äº†ï¼Œç”±äºç°åœ¨åªæ˜¯æ’ç€ä¸€æ ¹ç½‘çº¿ï¼Œæ‰€ä»¥åªæœ‰eth1è·å–åˆ°äº†ipï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023546.jpg" alt="img">	</p>
<p>å½“ä½¿ç”¨â€œapt-get updateâ€å‘½ä»¤è¿›è¡Œè½¯ä»¶æºæ›´æ–°çš„æ—¶å€™å¯èƒ½å‡ºç°ä»¥ä¸‹æ‰“å°ï¼Œè¿™æ˜¯å› ä¸ºè¯ä¹¦è¿‡æœŸæ‰€å¯¼è‡´çš„ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023562.jpg" alt="img"> </p>
<p>è¯¥é—®é¢˜å¯ä»¥é€šè¿‡è¾“å…¥ä¸‹é¢ä¸¤æ¡å‘½ä»¤æ¥è§£å†³ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">touch /etc/apt/apt.conf.d/99verify-peer.conf</span><br><span class="line"></span><br><span class="line">echo &gt;&gt;/etc/apt/apt.conf.d/99verify-peer.conf &quot;Acquire &#123; https::Verify-Peer false &#125;&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023572.jpg" alt="img"> </p>
<p>è‡³æ­¤ï¼Œå…³äºç½‘ç»œç›¸å…³çš„é…ç½®å°±å®Œæˆäº†ã€‚</p>
<h3 id="7-4-12é…ç½®è“ç‰™WIFI"><a href="#7-4-12é…ç½®è“ç‰™WIFI" class="headerlink" title="7.4.12é…ç½®è“ç‰™WIFI"></a>7.4.12é…ç½®è“ç‰™WIFI</h3><p>æœ¬å°èŠ‚è¦ç”¨åˆ°çš„æ–‡ä»¶è·¯å¾„ä¸ºâ€œiTOP-3568å¼€å‘æ¿\03_ã€iTOP-RK3568å¼€å‘æ¿ã€‘æŒ‡å—æ•™ç¨‹\03_æ–‡ä»¶ç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\04_Ubuntuå’ŒDebianç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\06_é…ç½®è“ç‰™WIFIâ€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023578.jpg" alt="img"> </p>
<p>ç”±äºè¿…ä¸ºä½¿ç”¨çš„è“ç‰™WIFIæ¨¡å—ä¸º8723duï¼Œè¯¥æ¨¡å—è‹¥æƒ³æ­£å¸¸ä½¿ç”¨ï¼Œéœ€è¦åœ¨ç³»ç»Ÿå¯åŠ¨ä¹‹åé€šè¿‡koçš„å½¢å¼è¿›è¡ŒåŠ è½½ï¼Œæ‰€ä»¥æœ¬å°èŠ‚å°†ä¼šè®²è§£å¦‚ä½•è®©æ¨¡å—å¼€æœºä¹‹åè‡ªåŠ¨è¢«åŠ è½½ã€‚</p>
<p>é¦–å…ˆè¿›å…¥åˆ°&#x2F;usr&#x2F;local&#x2F;binç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºwifi_blue.shçš„è„šæœ¬æ–‡ä»¶ï¼Œç„¶åå‘è¯¥è„šæœ¬ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">insmod /usr/local/modules/8723du.ko</span><br><span class="line">insmod /usr/local/modules/rtk_btusb.ko    </span><br><span class="line">rfkill unblock bluetooth</span><br><span class="line">hciconfig hci0 up</span><br></pre></td></tr></table></figure>

<p>è¯¥è„šæœ¬çš„ä½œç”¨å°±æ˜¯åŠ è½½è“ç‰™å’ŒWIFIä¸¤ä¸ªKOæ¨¡å—ï¼Œä¿å­˜é€€å‡ºä¹‹åä½¿ç”¨chmodå‘½ä»¤ç»™äºˆè¯¥è„šæœ¬å¯æ‰§è¡Œæƒé™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023584.jpg" alt="img"></p>
<p>è¿™æ—¶å€™åªæ˜¯æœ‰äº†å¯ä»¥åŠ è½½é©±åŠ¨çš„è„šæœ¬ï¼Œç„¶åæ¥åˆ°&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;systemç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºwifibt.serviceçš„å¼€æœºè‡ªåŠ¨è¿è¡ŒæœåŠ¡ï¼Œå‘è¯¥æœåŠ¡ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#start</span><br><span class="line">[Unit]</span><br><span class="line">Description=insmod topeet wifi_blue modules</span><br><span class="line">After=lighdm.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/bin/wifi_blue.sh</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">#end</span><br></pre></td></tr></table></figure>

<p>è¯¥æœåŠ¡çš„ç›®çš„å°±æ˜¯å¼€æœºè¿è¡Œ&#x2F;usr&#x2F;local&#x2F;bin&#x2F;wifi_blue.shè„šæœ¬ï¼Œä»è€ŒåŠ è½½WIFIå’Œè“ç‰™æ¨¡å—ï¼Œè®©ä¸¤ä¸ªåŠŸèƒ½æ­£å¸¸ä½¿ç”¨ï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºè¯¥æœåŠ¡çš„è½¯é“¾æ¥ï¼Œåˆ›å»ºå®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ln -s /usr/lib/systemd/system/wifibt.service /etc/systemd/system/sysinit.target.wants/</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023685.jpg" alt="img"> </p>
<p>æ¥ä¸‹æ¥éœ€è¦åœ¨&#x2F;usr&#x2F;local&#x2F;ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºmodulesçš„ç›®å½•ï¼Œç„¶åå°†æä¾›èµ„æ–™é‡Œçš„ä¸¤ä¸ªkoæ–‡ä»¶æ‹·è´åˆ°è¯¥ç›®å½•ä¸‹ï¼Œæ‹·è´å®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023716.jpg" alt="img"> </p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨èµ„æ–™ä¸­æä¾›çš„è¿™ä¸¤ä¸ªkoæ–‡ä»¶åªé€‚ç”¨äºå†…æ ¸ç‰ˆæœ¬ä¸º4.19çš„ç³»ç»Ÿï¼Œå¦‚æœæ˜¯å…¶ä»–ç‰ˆæœ¬çš„ç³»ç»Ÿå¯ä»¥è‡ªè¡Œæ›¿æ¢å¯¹åº”çš„koæ–‡ä»¶ã€‚</p>
<p>åˆæ¬¡ä¹‹å¤–è“ç‰™çš„æ­£å¸¸è¿è¡Œè¿˜éœ€è¦ç›¸åº”çš„å›ºä»¶ï¼Œæ‰€ä»¥è¿˜éœ€è¦èµ„æ–™ä¸­æä¾›çš„rtl8723du_configå’Œrtl8723du_fwä¸¤ä¸ªå›ºä»¶æ‹·è´åˆ°&#x2F;usr&#x2F;lib&#x2F;firmwareç›®å½•ä¸‹ï¼Œæ‹·è´å®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023722.jpg" alt="img"></p>
<p>è‡³æ­¤ï¼Œå…³äºè“ç‰™WIFIç›¸å…³çš„é…ç½®å°±å®Œæˆäº†ã€‚æ‰“åŒ…é•œåƒå¹¶çƒ§å†™åˆ°å¼€å‘æ¿ä¸Šï¼Œæ¥åˆ°å›¾å½¢ç•Œé¢ï¼Œå¯ä»¥çœ‹åˆ°è“ç‰™å·²ç»å¯ä»¥æ­£å¸¸çš„æœç´¢åˆ°è®¾å¤‡äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023728.png" alt="img"></p>
<p>åœ¨å³ä¸Šè§’çš„ç½‘ç»œè®¾ç½®ä¸­ä¹Ÿå¯ä»¥æœç´¢åˆ°ç›¸åº”çš„WIFIï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023739.png" alt="img"></p>
<p>è‡³æ­¤ï¼Œå…³äºè“ç‰™WIFI çš„ç›¸å…³é…ç½®å°±å®Œæˆäº†ã€‚</p>
<h3 id="7-4-13é…ç½®sshå…è®¸rootç™»å½•"><a href="#7-4-13é…ç½®sshå…è®¸rootç™»å½•" class="headerlink" title="7.4.13é…ç½®sshå…è®¸rootç™»å½•"></a>7.4.13é…ç½®sshå…è®¸rootç™»å½•</h3><p>æœ¬å°èŠ‚è¦ç”¨åˆ°çš„æ–‡ä»¶è·¯å¾„ä¸ºâ€œiTOP-3568å¼€å‘æ¿\03_ã€iTOP-RK3568å¼€å‘æ¿ã€‘æŒ‡å—æ•™ç¨‹\03_æ–‡ä»¶ç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\04_Ubuntuå’ŒDebianç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\04_ssh å…è®¸rootç™»å½•â€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023770.jpg" alt="img"> </p>
<p>é»˜è®¤æƒ…å†µä¸‹sshæ˜¯ä¸èƒ½rootç”¨æˆ·ç™»å½•çš„ï¼Œä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹sshdçš„é…ç½®æ–‡ä»¶æ¥å…è®¸ssh rootç™»å½•ã€‚</p>
<p>sshdçš„é…ç½®æ–‡ä»¶ä¸ºâ€œ&#x2F;etc&#x2F;ssh&#x2F;sshd_configâ€ï¼Œæ‰“å¼€è¯¥æ–‡ä»¶æ‰¾åˆ°ä¸‹å›¾æ‰€ç¤ºçš„å†…å®¹ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023832.jpg" alt="img"></p>
<p>ç„¶åä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼Œä¿®æ”¹å®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šã€‘</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PermitRootLogin yes</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023859.jpg" alt="img"> </p>
<p>è‡³æ­¤ï¼Œå…³äºsshæœ‰å…³çš„é…ç½®å°±ä¿®æ”¹å®Œæˆäº†ã€‚ç„¶åæ‰“åŒ…é•œåƒçƒ§å†™åˆ°å¼€å‘æ¿ï¼Œè¿›å…¥ç³»ç»Ÿä¹‹åæŸ¥çœ‹å¼€å‘æ¿çš„ipåœ°å€ä¸º192.168.1.168ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023871.jpg" alt="img"> </p>
<p>ç„¶åé€šè¿‡sshè½¯ä»¶é€šè¿‡rootç”¨æˆ·è¿æ¥ï¼Œè¿æ¥è®¾ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023943.jpg" alt="img"></p>
<p>è¿æ¥æˆåŠŸå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023992.jpg" alt="img"></p>
<p>è‡³æ­¤ï¼Œå…³äºsshå…è®¸rootç™»å½•çš„è®¾ç½®å°±å®Œæˆäº†ã€‚</p>
<h3 id="7-4-14å®‰è£…rga-debåŒ…"><a href="#7-4-14å®‰è£…rga-debåŒ…" class="headerlink" title="7.4.14å®‰è£…rga debåŒ…"></a>7.4.14å®‰è£…rga debåŒ…</h3><p>æœ¬å°èŠ‚è¦ç”¨åˆ°çš„æ–‡ä»¶è·¯å¾„ä¸ºâ€œiTOP-3568å¼€å‘æ¿\03_ã€iTOP-RK3568å¼€å‘æ¿ã€‘æŒ‡å—æ•™ç¨‹\03_æ–‡ä»¶ç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\04_Ubuntuå’ŒDebianç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\07_rgaâ€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023026.jpg" alt="img"> </p>
<p>æ³¨ï¼šè¿™é‡Œæä¾›çš„ä»…ä»…åªæ˜¯ubuntu20 rgaç›¸å…³çš„debåŒ…ï¼Œå¦‚æœæ˜¯å…¶ä»–ç³»ç»Ÿå¹¶ä¸é€‚ç”¨ã€‚</p>
<p>RGAæ˜¯Rockchipï¼ˆç‘èŠ¯å¾®ç”µå­ï¼‰å…¬å¸å¼€å‘çš„å›¾åƒå¤„ç†æŠ€æœ¯ï¼Œä¸»è¦åº”ç”¨äºä»–ä»¬çš„ç³»ç»ŸèŠ¯ç‰‡ä¸­ã€‚RGAæŠ€æœ¯åœ¨Rockchipçš„èŠ¯ç‰‡ä¸­é›†æˆäº†ä¸€ä¸ªä¸“é—¨çš„ç¡¬ä»¶æ¨¡å—ï¼Œç”¨äºåŠ é€Ÿ2Då›¾å½¢æ“ä½œã€‚è¿™ä¸ªç¡¬ä»¶æ¨¡å—é€šå¸¸è¢«ç§°ä¸ºRGAç¡¬ä»¶åŠ é€Ÿå™¨ã€‚</p>
<p>RGAä¼šå¯¹å›¾å½¢ç•Œé¢æœ‰ä¸€å®šçš„åŠ é€Ÿæ•ˆæœï¼Œè€Œä¸”åé¢åœ¨å®‰è£…GPUç›¸å…³åº“çš„éƒ¨åˆ†ä¹Ÿä¼šç”¨åˆ°RGAï¼Œæ‰€ä»¥è¿™é‡Œå…ˆæ¥å®‰è£…ä¸€ä¸‹RGAç›¸å…³çš„debåŒ…ã€‚</p>
<p>é¦–å…ˆå°†debåŒ…æ‹·è´åˆ°æ„å»ºçš„ubuntuæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ‹·è´å®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023034.jpg" alt="img"></p>
<p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…,å®‰è£…è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dpkg -i librga-dev_2.2.0-1_arm64.deb</span><br><span class="line">dpkg -i librga2_2.2.0-1_arm64.deb</span><br><span class="line">dpkg -i librga2-dbgsym_2.2.0-1_arm64.deb</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222023053.jpg" alt="img"> </p>
<p>è‡³æ­¤ï¼ŒRGAç›¸å…³çš„åº“å°±å®‰è£…å®Œæˆäº†ã€‚</p>
<h3 id="7-4-15-å®‰è£…mpp-debåŒ…"><a href="#7-4-15-å®‰è£…mpp-debåŒ…" class="headerlink" title="7.4.15 å®‰è£…mpp debåŒ…"></a>7.4.15 å®‰è£…mpp debåŒ…</h3><p>æœ¬å°èŠ‚è¦ç”¨åˆ°çš„æ–‡ä»¶è·¯å¾„ä¸ºâ€œiTOP-3568å¼€å‘æ¿\03_ã€iTOP-RK3568å¼€å‘æ¿ã€‘æŒ‡å—æ•™ç¨‹\03_æ–‡ä»¶ç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\04_Ubuntuå’ŒDebianç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\08_mppâ€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226972.jpg" alt="img"> </p>
<p>æ³¨ï¼šè¿™é‡Œæä¾›çš„ä»…ä»…åªæ˜¯ubuntu20 mppç›¸å…³çš„debåŒ…ï¼Œå¦‚æœæ˜¯å…¶ä»–ç³»ç»Ÿå¹¶ä¸é€‚ç”¨ã€‚</p>
<p>MPPï¼ˆMedia Processing Platformï¼‰æ˜¯ä¸€ç§å¤šåª’ä½“å¤„ç†å¹³å°ï¼Œç”¨äºå®ç°éŸ³é¢‘å’Œè§†é¢‘æ•°æ®çš„å¤„ç†ã€ç¼–è§£ç å’Œå¤„ç†ã€‚MPP æä¾›äº†ä¸€ç»„ä¸°å¯Œçš„åŠŸèƒ½å’Œç®—æ³•ï¼Œç”¨äºå¤„ç†å„ç§å¤šåª’ä½“æ•°æ®ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨ç¡¬ä»¶åŠ é€Ÿçš„ç¯å¢ƒä¸‹æä¾›é«˜æ•ˆçš„å¤„ç†æ€§èƒ½ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ MPP çš„ä¸»è¦ä½œç”¨ï¼š</p>
<p>ï¼ˆ1ï¼‰è§†é¢‘ç¼–è§£ç ï¼šMPP æä¾›äº†å„ç§è§†é¢‘ç¼–è§£ç å™¨ï¼Œå¦‚ H.264ã€H.265ã€MPEG-2 ç­‰ã€‚è¿™äº›ç¼–è§£ç å™¨èƒ½å¤Ÿå°†è§†é¢‘æ•°æ®è¿›è¡Œå‹ç¼©ï¼ˆç¼–ç ï¼‰å’Œè§£å‹ç¼©ï¼ˆè§£ç ï¼‰ï¼Œä»¥æ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯å¯¹è§†é¢‘æ•°æ®çš„å­˜å‚¨å’Œä¼ è¾“éœ€æ±‚ã€‚é€šè¿‡ç¡¬ä»¶åŠ é€Ÿï¼ŒMPP å¯ä»¥æä¾›é«˜æ•ˆçš„è§†é¢‘ç¼–è§£ç æ€§èƒ½ï¼Œå‡è½» CPU çš„è´Ÿæ‹…ã€‚</p>
<p>ï¼ˆ2ï¼‰å›¾åƒå¤„ç†ï¼šMPP åŒ…å«äº†ä¸€ç³»åˆ—å›¾åƒå¤„ç†ç®—æ³•ï¼Œå¦‚å›¾åƒç¼©æ”¾ã€æ—‹è½¬ã€è£å‰ªã€è‰²å½©ç©ºé—´è½¬æ¢ç­‰ã€‚è¿™äº›ç®—æ³•å¯ä»¥å¯¹å›¾åƒè¿›è¡Œå„ç§æ“ä½œå’Œè½¬æ¢ï¼Œä»¥æ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯å¯¹å›¾åƒå¤„ç†çš„éœ€æ±‚ã€‚MPP çš„ç¡¬ä»¶åŠ é€Ÿèƒ½åŠ›å¯ä»¥åŠ å¿«å›¾åƒå¤„ç†çš„é€Ÿåº¦ï¼Œå¹¶æä¾›æ›´é«˜çš„æ•ˆç‡ã€‚</p>
<p>ï¼ˆ3ï¼‰éŸ³é¢‘ç¼–è§£ç ï¼šé™¤äº†è§†é¢‘ç¼–è§£ç ï¼ŒMPP è¿˜æä¾›äº†éŸ³é¢‘ç¼–è§£ç çš„åŠŸèƒ½ã€‚å®ƒæ”¯æŒå¸¸è§çš„éŸ³é¢‘ç¼–ç æ ¼å¼ï¼Œå¦‚ AACã€MP3ã€AC3 ç­‰ã€‚é€šè¿‡ MPPï¼Œå¯ä»¥å¯¹éŸ³é¢‘æ•°æ®è¿›è¡Œé«˜æ•ˆçš„å‹ç¼©å’Œè§£å‹ç¼©ï¼Œå®ç°éŸ³é¢‘çš„å­˜å‚¨ã€ä¼ è¾“å’Œå¤„ç†ã€‚</p>
<p>ï¼ˆ4ï¼‰å¤šåª’ä½“å¤„ç†æµç¨‹ç®¡ç†ï¼šMPP æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¡†æ¶å’Œæ¥å£ï¼Œç”¨äºç®¡ç†å’Œæ§åˆ¶å¤šåª’ä½“å¤„ç†æµç¨‹ã€‚å®ƒå¯ä»¥å¯¹å¤šä¸ªåª’ä½“å¤„ç†å•å…ƒè¿›è¡Œè°ƒåº¦å’Œåè°ƒï¼Œå®ç°å¤æ‚çš„å¤šåª’ä½“å¤„ç†ä»»åŠ¡ã€‚MPP è¿˜æä¾›äº†ä¸°å¯Œçš„é…ç½®é€‰é¡¹å’Œå‚æ•°è®¾ç½®ï¼Œä»¥æ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚</p>
<p>MPPåŒ…çš„å®‰è£…æ–¹æ³•è·Ÿä¸Šé¢RGAåŒ…çš„å®‰è£…æ–¹æ³•ç›¸åŒï¼Œé¦–å…ˆå°†èµ„æ–™ä¸­æä¾›çš„MPPåŒ…æ‹·è´åˆ°æ„å»ºçš„ubuntuæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ‹·è´å®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226970.jpg" alt="img"></p>
<p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…,å®‰è£…è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>dpkg -i librockchip-mpp1_1.5.0-1_arm64.deb </p>
<p>dpkg -i librockchip-mpp-dev_1.5.0-1_arm64.deb</p>
<p>dpkg -i librockchip-vpu0_1.5.0-1_arm64.deb </p>
<p>dpkg -i rockchip-mpp-demos_1.5.0-1_arm64.deb</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226980.jpg" alt="img"> </p>
<p>è‡³æ­¤ï¼ŒMPPç›¸å…³çš„åº“å°±å®‰è£…å®Œæˆäº†ï¼Œæ‰“åŒ…é•œåƒï¼Œç„¶åçƒ§å†™åˆ°å¼€å‘æ¿ï¼Œå¼€å‘æ¿å¯åŠ¨ä¹‹åï¼Œåœ¨å¼€å‘æ¿ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ç”¨æ¥ç›‘æ§ç³»ç»Ÿæ‰“å°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p>tail -f &#x2F;var&#x2F;log&#x2F;syslog &amp;</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226975.jpg" alt="img"> </p>
<p>ç„¶åè¾“å…¥ä»¥ä¸‹å‘½ä»¤é€šè¿‡mpi_dec_testå‘½ä»¤è°ƒç”¨mppè¿›è¡Œè§†é¢‘çš„è§£ç ï¼Œå°†<a href="https://so.csdn.net/so/search?q=h264&spm=1001.2101.3001.7020">h264</a>è½¬ä¸ºyuvï¼Œè§£ç è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p>mpi_dec_test -i &#x2F;oem&#x2F;200frames_count.h264 -t 7 -n 250 -o &#x2F;home&#x2F;topeet&#x2F;test.yuv -w 640 -h 480</p>
<p> <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226973.jpg" alt="img"></p>
<p>è§£ç å®Œæˆä¹‹ååœ¨&#x2F;home&#x2F;topeet&#x2F;ç›®å½•ä¸‹ç”Ÿæˆäº†è§£ç ä¸ºyuvæ ¼å¼çš„test.yuvæ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226987.jpg" alt="img"> </p>
<p>ç„¶åç»§ç»­ä½¿ç”¨mpi_enc_testå‘½ä»¤è¿›è¡Œè§†é¢‘çš„ç¼–ç ï¼Œå°†ä¸Šé¢è§£ç å‡ºæ¥çš„yuvè½¬ä¸ºh264æ ¼å¼ï¼Œç¼–ç è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p>mpi_enc_test -i &#x2F;home&#x2F;topeet&#x2F;test.yuv -t 7 -n 250 -o &#x2F;home&#x2F;topeet&#x2F;test.h264 -w 640 -h 480 -fps 25</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226355.jpg" alt="img"> </p>
<p>ç¼–ç å®Œæˆä¹‹ååœ¨&#x2F;home&#x2F;topeet&#x2F;ç›®å½•ä¸‹ç”Ÿæˆäº†ç¼–ç ä¸ºh264æ ¼å¼çš„test.h26æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226373.jpg" alt="img"> </p>
<p>è‡³æ­¤ï¼Œå…³äºMPPçš„ç›¸å…³æµ‹è¯•å°±å®Œæˆäº†ã€‚</p>
<h3 id="7-4-16-å®‰è£…gpu-debåŒ…"><a href="#7-4-16-å®‰è£…gpu-debåŒ…" class="headerlink" title="7.4.16 å®‰è£…gpu debåŒ…"></a>7.4.16 å®‰è£…gpu debåŒ…</h3><p>æœ¬å°èŠ‚è¦ç”¨åˆ°çš„æ–‡ä»¶è·¯å¾„ä¸ºâ€œiTOP-3568å¼€å‘æ¿\03_ã€iTOP-RK3568å¼€å‘æ¿ã€‘æŒ‡å—æ•™ç¨‹\03_æ–‡ä»¶ç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\04_Ubuntuå’ŒDebianç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\09_gpuâ€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226388.jpg" alt="img"> </p>
<p>æ³¨ï¼šè¿™é‡Œæä¾›çš„ä»…ä»…åªæ˜¯ubuntu20 gpuç›¸å…³çš„debåŒ…ï¼Œå¦‚æœæ˜¯å…¶ä»–ç³»ç»Ÿå¹¶ä¸é€‚ç”¨ã€‚</p>
<p>é¦–å…ˆå°†ä¸Šé¢æä¾›èµ„æ–™é‡Œçš„xserverç›¸å…³debåŒ…æ‹·è´åˆ°è¦æ„å»ºçš„ubuntuç³»ç»Ÿä¸­ï¼Œæ‹·è´å®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226397.jpg" alt="img"> </p>
<p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡ŒdebåŒ…çš„å®‰è£…ï¼Œå®‰è£…è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š<br>dpkg -i xserver-common_1.20.13-1ubuntu1~20.04.9_all.deb</p>
<p>dpkg -i xserver-xorg-core_1.20.13-1ubuntu1~20.04.9_arm64.deb </p>
<p>dpkg -i xserver-xorg-dev_1.20.13-1ubuntu1~20.04.9_arm64.deb </p>
<p>dpkg -i xserver-xorg-legacy_1.20.13-1ubuntu1~20.04.9_arm64.deb</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226407.jpg" alt="img"> </p>
<p>ä¸­é—´åœ¨å®‰è£…xserver-xorg-core_1.20.13-1ubuntu1~20.04.9_arm64.debåŒ…æ—¶å‡ºç°äº†é”™è¯¯ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨â€œapt-get install -fâ€å‘½ä»¤è¿›è¡Œä¿®å¤å³å¯ï¼Œä¿®å¤è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226421.jpg" alt="img"></p>
<p>ä¿®å¤å®Œæˆä¹‹åå°†æä¾›èµ„æ–™ä¸­çš„libmaliåº“åŒæ ·æ‹·è´æ„å»ºçš„ubuntuç³»ç»Ÿä¸­ï¼Œæ‹·è´å®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226522.jpg" alt="img"> </p>
<p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼Œå®‰è£…è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>dpkg -i libmali-bifrost-g52-g13p0-x11-gbm_1.9-1_arm64.deb</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226531.jpg" alt="img"> </p>
<p>è‡³æ­¤ï¼Œå…³äºGPU ç›¸å…³åº“çš„å®‰è£…å°±å®Œæˆäº†ï¼Œ</p>
<h3 id="7-4-17-æ¸…é™¤å®‰è£…çš„è½¯ä»¶åŒ…"><a href="#7-4-17-æ¸…é™¤å®‰è£…çš„è½¯ä»¶åŒ…" class="headerlink" title="7.4.17 æ¸…é™¤å®‰è£…çš„è½¯ä»¶åŒ…"></a>7.4.17 æ¸…é™¤å®‰è£…çš„è½¯ä»¶åŒ…</h3><p>ç»è¿‡äº†ä¸Šé¢çš„ä¸€äº›æ­¥éª¤å·²ç»å¯¹æ„å»ºçš„ubuntuè¿›è¡Œäº†ç®€å•çš„é…ç½®ï¼Œä½†åœ¨é…ç½®çš„è¿‡ç¨‹ä¸­ä¹Ÿä¸‹è½½äº†å¾ˆå¤šçš„è½¯ä»¶åŒ…ï¼Œè¿™äº›è½¯ä»¶åŒ…ä¼šå ç”¨å¾ˆå¤šçš„ç©ºé—´ï¼Œæ‰€ä»¥åœ¨é…ç½®å®Œæˆä¹‹åè¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¸…é™¤å®‰è£…çš„è½¯ä»¶åŒ…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p>apt-get -y clean &amp;&amp; apt-get -y autoclean</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226543.jpg" alt="img"> </p>
<h3 id="7-4-18-é€€å‡ºchrootç¯å¢ƒ"><a href="#7-4-18-é€€å‡ºchrootç¯å¢ƒ" class="headerlink" title="7.4.18 é€€å‡ºchrootç¯å¢ƒ"></a>7.4.18 é€€å‡ºchrootç¯å¢ƒ</h3><p>è®¾ç½®å¥½ä»¥åå°±å¯ä»¥é€€å‡ºæ ¹æ–‡ä»¶ç³»ç»Ÿäº†ï¼Œè¾“å…¥å‘½ä»¤â€œexitâ€é€€å‡ºã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226565.jpg" alt="img"> </p>
<p>ç„¶åé€šè¿‡ä»¥ä¸‹å‘½ä»¤å–æ¶ˆbinaryç›®å½•çš„æŒ‚è½½ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p>.&#x2F;mount.sh -u binary&#x2F;</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226608.jpg" alt="img"> </p>
<h2 id="7-5-æ–‡ä»¶ç³»ç»Ÿé•œåƒçš„åˆ¶ä½œ"><a href="#7-5-æ–‡ä»¶ç³»ç»Ÿé•œåƒçš„åˆ¶ä½œ" class="headerlink" title="7.5 æ–‡ä»¶ç³»ç»Ÿé•œåƒçš„åˆ¶ä½œ"></a>7.5 æ–‡ä»¶ç³»ç»Ÿé•œåƒçš„åˆ¶ä½œ</h2><p>æœ¬å°èŠ‚è¦ç”¨åˆ°çš„æ–‡ä»¶è·¯å¾„ä¸ºâ€œiTOP-3568å¼€å‘æ¿\03_ã€iTOP-RK3568å¼€å‘æ¿ã€‘æŒ‡å—æ•™ç¨‹\03_æ–‡ä»¶ç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\04_Ubuntuå’ŒDebianç³»ç»Ÿæ„å»ºé…å¥—èµ„æ–™\10_åˆ¶ä½œçƒ§å†™é•œåƒâ€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226627.jpg" alt="img"> </p>
<p>é¦–å…ˆå°†ä¸Šè¿°èµ„æ–™ä¸­æä¾›çš„mk-image.shå’Œpost-build.shè„šæœ¬æ‹·è´åˆ°è™šæ‹Ÿæœºubutnuä¸Šï¼Œè€Œä¸”è¦è·Ÿæ„å»ºçš„binaryç›®å½•æ”¾åˆ°åŒä¸€ç›®å½•ä¸‹ï¼Œæ‹·è´å®Œæˆå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226706.jpg" alt="img"><br>    ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤èµ‹äºˆä¸¤ä¸ªè„šæœ¬å¯æ‰§è¡Œæƒé™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p>chmod 777 mk-image.sh post-build.sh<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226714.jpg" alt="img"></p>
<p>ç„¶åè¿è¡Œmk-image.shè„šæœ¬å³å¯å®Œæˆçƒ§å†™é•œåƒçš„åˆ¶ä½œäº†ï¼Œåˆ¶ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311222226722.jpg" alt="img"></p>
<p>åˆ¶ä½œå®Œæˆä¹‹åä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ªåä¸ºrootfs.imgçš„çƒ§å†™é•œåƒï¼Œåªéœ€è¦æ ¹æ®çƒ§å†™æ‰‹å†Œè¿›è¡Œå•ç‹¬çƒ§å†™å³å¯ã€‚è‡³æ­¤ï¼Œå…³äºUbuntuå’ŒDebianæ–‡ä»¶ç³»ç»Ÿçš„æ„å»ºå°±è®²è§£å®Œæˆäº†ã€‚</p>
]]></content>
      <categories>
        <category>ç‘èŠ¯å¾®</category>
      </categories>
  </entry>
  <entry>
    <title>æ˜¾ç¤ºç¡¬ä»¶å‘å±•ä¸è§†é¢‘å¼€å‘çŸ¥è¯†ç‚¹æ‰«ç›²</title>
    <url>/2023/11/19/9%20%E6%98%BE%E7%A4%BA%E7%A1%AC%E4%BB%B6%E5%8F%91%E5%B1%95%E4%B8%8E%E8%A7%86%E9%A2%91%E5%BC%80%E5%8F%91%E7%9F%A5%E8%AF%86%E7%82%B9%E6%89%AB%E7%9B%B2/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p> ç”µè„‘ä¸Šç‚«é…·çš„å±•ç¤ºï¼Œç”ŸåŠ¨çš„å½¢è±¡ï¼Œç¦»ä¸å¼€ç¡¬ä»¶çš„æ”¯æŒï¼Œç¡¬ä»¶æ˜¯éŸ³è§†é¢‘ç¼–ç¨‹æ–‡åŒ–çš„ä¸€éƒ¨åˆ†ã€‚å¼€å‘è€…æœ‰å¿…è¦å¯¹ç›¸å…³ç¡¬ä»¶å¤§æ¦‚äº†è§£ã€‚æœ¬ä¸“é¢˜æ¶‰åŠè§†é¢‘ç¡¬ä»¶ç›¸å…³è¯é¢˜ï¼ŒéŸ³é¢‘ç›¸å…³ä»¥åè®²è¿°ã€‚</p>
<p>â€‹    è§†é¢‘ç¼–ç¨‹çš„æœ¬è´¨æ˜¯å›¾å½¢å›¾åƒç¼–ç¨‹ï¼Œæœ¬ä¸“é¢˜ä»¥æ—¶é—´ä¸ºä¸»çº¿ï¼Œä»¥å…¬å¸ç¡¬ä»¶å‘å±•ä¸ºç‚¹ä½ï¼Œä»¥å›¾åƒå›¾åƒå¼€å‘æ¥å£ä¸ºåˆ‡é¢ï¼Œå®è§‚è¿›è¡Œä»‹ç»ï¼Œå¸Œæœ›å¯¹è§†é¢‘ç¼–ç¨‹å¼€å‘è€…è¿›è¡Œæœ‰ç›Šçš„å¯ç¤ºã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192138685.png" alt="img"></p>
<p>â€‹    æœ¬ç³»åˆ—æ–‡ç« ä¾å‘å±•é¡ºåºï¼Œä»æ—©æœŸèµ·æºå¼€å§‹ï¼Œå†åˆ°2Dæ—¶ä»£ï¼Œ3Dæ—¶ä»£ï¼Œç§»åŠ¨æ—¶ä»£ï¼Œæ™ºèƒ½æ—¶ä»£ï¼Œæœ€ååˆ°æ˜¾ç¤ºæ ‡å‡†ä¸ä¸“ä¸šè§†é¢‘å¤„ç†å•å…ƒï¼Œå¤§ä½“åˆ†ä¸º6éƒ¨åˆ†ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192138724.png" alt="img"></p>
<p>â€‹    æ—©æœŸæ¦‚è¿°å›é¡¾286ä¹‹å‰çš„ç”µè„‘ï¼Œä»¥åŠä¸€äº›å›¾å½¢å›¾åƒå·¥ä½œç«™ã€‚é‚£ä¸ªå¹´ä»£å›¾å½¢å›¾åƒç¼–ç¨‹èµ·æºäºæ¬§ç¾å‘è¾¾å›½å®¶ã€‚æ¯«ä¸å¤¸å¼ çš„è¯´ï¼Œæ¬§ç¾æ‰“å¼€äº†è®¡ç®—æœºä¸–ç•Œçš„å¤§é—¨ï¼Œåé¢ç®€å•æè¿°äº†VGAæ—©æœŸå›¾å½¢ç¼–ç¨‹ã€‚</p>
<p>â€‹    2Dæ—¶ä»£å›é¡¾äº†å½“å¹´ç¡¬ä»¶äº§å“ã€2Dç¼–ç¨‹æ¥å£ã€‚GDIã€GDI+ã€D2Dã€AGGã€Cairoã€Cocoa Drawingç­‰ã€‚2Dæ—¶ä»£çš„åˆ°æ¥ï¼Œè¿ˆå‡ºäº†å›¾å½¢å›¾åƒç¼–ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œæ‹‰å¼€äº†å¤šåª’ä½“ç¼–ç¨‹çš„åºå¹•ã€‚</p>
<p>â€‹    3Dæ—¶ä»£æ˜¯è®¡ç®—æœºå›¾å½¢å­¦å¤§å‘å±•çš„å¹´ä»£ï¼Œ3Då¼•æ“çš„å‡ºç°ï¼Œä¸ºå›¾å½¢å­¦çš„å‘å±•æ³¨å…¥äº†æ´»åŠ›ã€‚å¯ä»¥è¯´ï¼Œ3Dæ—¶ä»£çš„é™ä¸´ï¼ŒéŸ³è§†é¢‘æŠ€æœ¯çš„æ˜¥å¤©åˆ°æ¥äº†ã€‚</p>
<p>â€‹    ç§»åŠ¨æ—¶ä»£æ˜¯å›¾å½¢å›¾åƒæŠ€æœ¯åœ¨åµŒå…¥å¼è®¾å¤‡ä¸Šæ‹“å±•çš„å¹´ä»£ï¼Œå¤šåª’ä½“å¼•æ“ä¹Ÿå‘ç”Ÿäº†ä¸€äº›å˜åŒ–ã€‚å¤šåª’ä½“åŠŸèƒ½æ˜¯æ‰‹æœºæœ€é‡è¦çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œæœªæ¥éŸ³è§†é¢‘æŠ€æœ¯åœ¨æ‰‹æœºä¸Šå°†ä¼šæœ‰å¤§çš„å‘å±•ã€‚</p>
<p>â€‹    äººå·¥æ™ºèƒ½çš„å‘å±•ï¼Œæ™ºèƒ½æ—¶ä»£åˆ°æ¥äº†ï¼ŒéŸ³è§†é¢‘æ–¹é¢æ˜¯äººå·¥æ™ºèƒ½åº”ç”¨æœ€å¹¿æ³›çš„åˆ†æ”¯ã€‚éŸ³è§†é¢‘æŠ€æœ¯æ˜¯äººå·¥æ™ºèƒ½æœ€é‡è¦çš„æ–¹å‘ï¼Œæœªæ¥ï¼Œäººå·¥æ™ºèƒ½æŠ€æœ¯æ˜¯éŸ³è§†é¢‘æŠ€æœ¯æœ€æ ¸å¿ƒçš„æŠ€æœ¯ä¹‹ä¸€ã€‚</p>
<p>â€‹    æŠ€æœ¯çš„å‘å±•æ²¡æœ‰ç©·å°½ï¼Œç¡¬ä»¶æŠ€æœ¯çš„è¿›æ­¥ï¼Œæ˜¾ç¤ºæ ‡å‡†å’Œå·¥ä¸šåŒ–ç¡¬ä»¶çš„å‡ºç°ã€‚ç»™æŠ€æœ¯çš„å‘å‘å±•æŒ‡æ˜äº†æ–¹å‘ã€‚</p>
<h1 id="1ã€æ—©æœŸæ¦‚è¿°"><a href="#1ã€æ—©æœŸæ¦‚è¿°" class="headerlink" title="1ã€æ—©æœŸæ¦‚è¿°"></a>1ã€æ—©æœŸæ¦‚è¿°</h1><p>â€‹    æ—©æœŸå›¾å½¢å›¾åƒå¤„ç†ä¸»è¦é ä¸€äº›å·¥ä½œç«™æ¥å®Œæˆã€‚286ä¹‹å‰çš„ç”µè„‘ä»…è¿›è¡ŒåŸºæœ¬çš„åŒè‰²æ–‡æœ¬æ˜¾ç¤ºã€‚æ˜¾ç¤ºä¸»è¦é æ˜¾ç¤ºå™¨å’Œä¸»æ¿æ˜¾ç¤ºåŸå™¨ä»¶åšæ”¯æŒã€‚ä¸‹å›¾æ˜¯1973å¹´çš„Altoå’Œ1980å¹´çš„Perqå›¾å½¢å·¥ä½œç«™ï¼Œå…¶ä¸­Altoæ˜¯åœ°çƒä¸Šç¬¬ä¸€å°å›¾å½¢å·¥ä½œç«™ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192138787.png" alt="img"></p>
<p>â€‹    286ä¹‹å‰ï¼Œå›½å†…è°ˆä¸ä¸Šç”µè„‘çš„è§†é¢‘ç¼–ç¨‹ã€‚ä¸“ä¸šçš„éŸ³è§†é¢‘å¤„ç†ä¸»è¦é å›¾å½¢å›¾åƒå·¥ä½œç«™å®Œæˆï¼Œè®¾å¤‡å…¨é è¿›å£ï¼Œå›¾å½¢å›¾åƒè½¯ä»¶çš„å¼€å‘æ˜¯å›½å¤–ä¸“ä¸šèŠ¯ç‰‡å…¬å¸ã€è®¡ç®—æœºè®¾å¤‡å…¬å¸å¼€å‘ï¼Œå½“å¹´çš„è§†é¢‘ç¼–ç¨‹æ²¡æœ‰èµ°å‘æ°‘é—´ã€‚åæ¥ï¼Œåœ¨æ¶ˆè´¹çº§é¢†åŸŸï¼Œä¸€äº›å›¾å½¢åŠ é€Ÿå¡å‡ºç°ï¼Œä¸ºå›¾å½¢å›¾åƒç¼–ç¨‹åšäº†å‰æœŸçš„å‡†å¤‡ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192138694.png" alt="img"></p>
<p>â€‹    286ä¹‹å‰çš„å›¾å½¢å›¾åƒå·¥ä½œç«™ç¼–ç¨‹ï¼Œå†å²å·²ç»ä¹…è¿œï¼Œæœ¬ä¸“é¢˜ä¸åšé˜è¿°ã€‚</p>
<p>â€‹    æŠ€æœ¯çš„å‘å±•æ¨åŠ¨äº†æ˜¾ç¤ºæ ‡å‡†çš„æ”¹å˜ï¼Œä»MDAâ€”CGAâ€”EGAâ€”VGAã€‚æ˜¾ç¤ºæ ‡å‡†å¯¹ç¡¬ä»¶å‚å•†åšäº†è§„æ ¼çš„çº¦æŸï¼ŒæŒ‡å¼•ç€æ˜¾ç¤ºæŠ€æœ¯çš„æ–¹å‘ï¼Œå½±å“ç€å›¾å½¢å›¾åƒæŠ€æœ¯çš„å‘å±•ï¼Œå¯¹è§†é¢‘ç ”å‘äº§ç”Ÿå½±å“ï¼Œæ¨åŠ¨æœ«ç«¯æŠ€æœ¯åº”ç”¨ã€‚</p>
<p>â€‹    å†å²çš„çƒ½çƒŸè¿‡å»ï¼Œå¹´ä»£å·²ç»ä¹…è¿œï¼Œå¹¿è¢¤çš„äº’è”ç½‘ä¸Šï¼Œå¾ˆéš¾æ‰¾åˆ°å·¥ä½œç«™ç¼–ç¨‹çš„èµ„æ–™ã€‚</p>
<h1 id="2ã€VGAç¼–ç¨‹"><a href="#2ã€VGAç¼–ç¨‹" class="headerlink" title="2ã€VGAç¼–ç¨‹"></a>2ã€VGAç¼–ç¨‹</h1><p>â€‹    VGAçš„å‡ºç°ï¼Œæ˜¾å¡ä½œä¸ºç‹¬ç«‹åŠŸèƒ½éƒ¨ä»¶ï¼Œä»ä¸»æ¿ä¸Šå‰¥ç¦»ã€‚è¿™ä¸ªæ”¹å˜ï¼Œå›¾å½¢å›¾åƒç¼–ç¨‹çš„æ›™å…‰å‡ºç°äº†ï¼Œå½“å¹´çš„å›¾å½¢å›¾åƒç¼–ç¨‹è¿˜å¿…é¡»ä¾é å‚å®¶æä¾›çš„è§†é¢‘é©±åŠ¨ã€‚è§†é¢‘é©±åŠ¨çš„å®Œå¤‡ç¨‹åº¦ï¼Œå¾ˆå¤§ç¨‹åº¦å†³å®šäº†ç¡¬ä»¶å‚å•†çš„ç”Ÿå­˜ã€‚</p>
<p>â€‹    ä¸‹é¢çš„ä»£ç ï¼Œè€ä¸€ä»£ç¨‹åºå‘˜åº”è¯¥å¯¹æ­¤å¹¶ä¸é™Œç”Ÿã€‚ä¹Ÿå°±æ˜¯è¿™æ ·çš„ä»£ç ï¼Œæ‹‰å¼€äº†å›¾å½¢ç¼–ç¨‹çš„åºå¹•ï¼Œè¿ˆå‡ºäº†è§†é¢‘ç¼–ç¨‹çš„ç¬¬ä¸€æ­¥ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//è°ƒç”¨VGAé©±åŠ¨ç¨‹åº</span><br><span class="line">int  gdriver=DETECTï¼Œ gmode;</span><br><span class="line">initgraph ( &amp;gdriverï¼Œ &amp;gmodeï¼Œ â€œc:\\tc\\bgiâ€);</span><br><span class="line">setbkcolor ( BLACK);                 //è®¾å®šèƒŒæ™¯é¢œè‰²ä¸ºé»‘è‰²</span><br><span class="line">setcolor ( WHITE);                   //è®¾å®šç”»çº¿çš„é¢œè‰²ä¸ºç™½è‰²</span><br><span class="line">setlinestyle (0ï¼Œ 4444ï¼Œ 4);          //è®¾ç½®å½“å‰çº¿å‹ å®çº¿  çº¿å›¾æ ·  çº¿å®½å››ä¸ªåƒç´ </span><br><span class="line">line ( x1ï¼Œ y1ï¼Œ x2ï¼Œy2);            //ç”»çº¿  x1 y1èµ·ç‚¹  x2y2ç»ˆç‚¹</span><br><span class="line">lineto( xï¼Œ y);                      //å½“å‰ä½ç½®åˆ°xyåæ ‡ç”»ç›´çº¿</span><br></pre></td></tr></table></figure>

<p>â€‹    è®¡ç®—æœºå‘å±•è¿‡ç¨‹ä¸­ï¼Œæ˜¾ç¤ºéƒ¨ä»¶åœ¨è®¾è®¡ä¸Šå‘ç”Ÿç€å˜åŒ–ï¼Œä¸‹å›¾æ˜¯ä»70å¹´ä»£åˆ°ä»Šå¤©æ˜¾å¡å‘å±•è¿‡ç¨‹å›¾ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192138742.png" alt="img"></p>
<p>â€‹    è‡ªä»è®¡ç®—çš„å‡ºç°ï¼Œç›¸æ¯”å…¶å®ƒé¢†åŸŸï¼Œè®¡ç®—æœºé¢†åŸŸå‘å±•æ›´å¿«ï¼Œå¯¹ç¤¾ä¼šå½±å“æ›´è¿œï¼Œå‚å•†ç«äº‰æ›´ä¸ºæ¿€çƒˆã€‚ä¸‹é¢ä»å…¬å¸ã€äº§å“ã€æŠ€æœ¯çš„è§’åº¦æ¢è®¨ã€‚</p>
<ol start="2">
<li>2dæ—¶ä»£</li>
</ol>
<h1 id="3ã€2Dæ—¶ä»£"><a href="#3ã€2Dæ—¶ä»£" class="headerlink" title="3ã€2Dæ—¶ä»£"></a>3ã€2Dæ—¶ä»£</h1><p>â€‹    å‡ åå¹´å·¥è‰ºæ”¹è¿›ï¼Œè§£å†³äº†åŸºæœ¬åˆ¶é€ é—®é¢˜ï¼Œè®¡ç®—æœºå¼€å§‹å‘åº”ç”¨è¿‡æ¸¡ã€‚æ˜¾ç¤ºé—®é¢˜æ˜¯é¦–å½“å…¶å†²çš„é—®é¢˜ï¼Œå¤šå¹´çš„æ€è¾¨ä¸å®è·µï¼Œ2DæŠ€æœ¯æ¨ªç©ºå‡ºä¸–ï¼Œå®Œå–„å‘å±•ï¼Œä¸ºè®¡ç®—æœºçš„åº”ç”¨æ¨å¹¿åšå‡ºäº†å“è¶Šçš„è´¡çŒ®ã€‚åŒè‰²æ˜¾ç¤ºçš„æ˜Ÿæ˜Ÿä¹‹ç«ï¼Œåœ¨2Dæ—¶ä»£ç»ˆäºç†Šç†Šç‡ƒçƒ§ï¼Œè®¡ç®—æœºèµ°å‘æ°‘é—´çš„æ—¶ä»£åˆ°æ¥äº†ã€‚</p>
<p>â€‹    ä¸‹é¢ä»å…¬å¸äº§å“çš„è§’åº¦ï¼Œå›é¡¾2Dæ—¶ä»£çš„å›¾å½¢å›¾åƒç¼–ç¨‹ã€‚</p>
<h2 id="3-1ã€å…¬å¸"><a href="#3-1ã€å…¬å¸" class="headerlink" title="3.1ã€å…¬å¸"></a>3.1ã€å…¬å¸</h2><h3 id="3-1-1ã€Amiga"><a href="#3-1-1ã€Amiga" class="headerlink" title="3.1.1ã€Amiga"></a>3.1.1ã€Amiga</h3><p>â€‹    Amigaæ˜¯80å¹´ä»£å›¾å½¢æ€§èƒ½æœ€å¼ºå¤§çš„ç”µè„‘ä¹‹ä¸€ï¼Œæ‹¥æœ‰ä¸“é—¨å¤„ç†å›¾å½¢çš„èŠ¯ç‰‡ã€‚æ°.è¿ˆçº³æ˜¯å½“å¹´æ˜¾å¡èŠ¯ç‰‡è®¾è®¡çš„çµé­‚äººç‰©ã€‚ä¸‹å›¾Amiga500æ‹†æœºï¼Œçº¢åœˆå†…çš„deniseèŠ¯ç‰‡å°±æ˜¯ä¸“é—¨ç”¨æ¥è´Ÿè´£å¤„ç†å›¾å½¢çš„ï¼Œdeniseæ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„2dåŠ é€Ÿå¡ã€‚</p>
<p>â€‹    è¿™å®¶å…¬å¸åœ¨éŸ³è§†é¢‘å¤šåª’ä½“é¢†åŸŸè¶…è¶Šå½“å¹´çš„IBMä¸Appleï¼Œé—æ†¾çš„æ˜¯ï¼Œæœ€å¥½çš„æŠ€æœ¯ä¹Ÿè¢«å¸‚åœºæ‰€æ·˜æ±°ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139556.png" alt="img"></p>
<h3 id="3-1-2ã€IBM"><a href="#3-1-2ã€IBM" class="headerlink" title="3.1.2ã€IBM"></a>3.1.2ã€IBM</h3><p>â€‹    1981å¹´ï¼Œ IBMæ¨å‡ºä¸ªäººç”µè„‘ï¼Œæä¾›äº†ä¸¤ç§æ˜¾å¡ï¼Œä¸€ç§æ˜¯â€œå•è‰²æ˜¾å¡â€(ç®€ç§° MDA)ï¼Œ ä¸€ç§æ˜¯ â€œå½©è‰²ç»˜å›¾å¡â€ (ç®€ç§° CGA)ã€‚</p>
<p>â€‹    1982å¹´ï¼ŒIBMåˆæ¨å‡ºäº†MGAï¼ˆMonochrome Graphic Adapterï¼‰ï¼Œ åˆç§°Hercules Card (å¤§åŠ›å£«å¡)ï¼Œ é™¤äº†æ˜¾ç¤ºå›¾å½¢å¤–ï¼Œè¿˜ä¿ç•™äº†åŸæ¥MDAçš„åŠŸèƒ½ï¼ŒIBMæ˜¯ä¸–ç•Œç¬¬ä¸€å—æ˜¾å¡åˆ¶é€ å•†ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139564.png" alt="img"></p>
<h3 id="3-1-3ã€S3"><a href="#3-1-3ã€S3" class="headerlink" title="3.1.3ã€S3"></a>3.1.3ã€S3</h3><p>â€‹    S3åœ¨1989å¹´å¼€å§‹é€ æ˜¾å¡ï¼Œ2Dç”»è´¨é¢†åŸŸæ— äººèƒ½åŠï¼Œç››æä¸€æ—¶çš„Tridentä¹Ÿæ— å¥ˆè´¥ä¸‹é˜µæ¥ã€‚S3æœ€ç»å…¸çš„äº§å“å½“å±Trio64V+ï¼Œæœ‰ç€é«˜é€Ÿçš„2Dæ€§èƒ½å’Œå¼ºå¤§çš„VCDè½¯è§£å®åŠ›ï¼Œæ”¯æŒ1024Ã—768çš„åˆ†è¾¨ç‡ï¼Œåœ¨ä½åˆ†è¾¨ç‡ä¸‹æ”¯æŒæœ€é«˜32BitçœŸå½©è‰²ã€‚</p>
<p>â€‹    é‚£æ˜¯ä¸€ä¸ªVCDæ»¡å¤©é£çš„å¹´ä»£ï¼Œæ˜¾å¡çš„VCDè§£å‹èƒ½åŠ›æ˜¯è§†é¢‘åº•å±‚æŠ€æœ¯çš„ä¸€ä¸ªçªç ´ã€‚S3å‡ ç»è¢«è½¬å–ï¼Œå…ˆè¢«å¨ç››æ”¶ç¼–ï¼Œåè¢«HTCæ½å…¥å›Šä¸­ã€‚ä»Šå¤©ï¼ŒHTCæ­¥å±¥è¹’è·šï¼Œç”Ÿæ­»ä¸€çº¿ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139538.png" alt="img"></p>
<h3 id="3-1-4ã€Trident"><a href="#3-1-4ã€Trident" class="headerlink" title="3.1.4ã€Trident"></a>3.1.4ã€Trident</h3><p>â€‹    Tridentï¼Œè¿™å®¶å…¬å¸å½“å¹´åœ¨2Dæ˜¾å¡é¢†åŸŸçº¢æä¸€æ—¶ï¼Œåœ¨å½“å¹´çš„äº§å“ä¸“æŸœé‡Œï¼Œå¤šæ¬¡çœ‹åˆ°å…¶èº«å½±ï¼ŒåæœŸç”±äºæŠ€æœ¯æ–¹å‘åŸå› ï¼Œåœ¨3Dæ˜¾å¡å¹´ä»£è¢«æ·˜æ±°ã€‚æœ€ç»ˆåœ¨2003å¹´è¢«XGIæ”¶è´­ã€‚è€ŒXGIæœ€ç»ˆåœ¨åæ¥è¢«ATIçº³å…¥éº¾ä¸‹ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139600.png" alt="img"></p>
<h3 id="3-1-5ã€Matroxï¼ˆè¿ˆåˆ›ï¼‰"><a href="#3-1-5ã€Matroxï¼ˆè¿ˆåˆ›ï¼‰" class="headerlink" title="3.1.5ã€Matroxï¼ˆè¿ˆåˆ›ï¼‰"></a>3.1.5ã€Matroxï¼ˆè¿ˆåˆ›ï¼‰</h3><p>â€‹    æ›¾ç»ç‹¬æ˜¾é¢†åŸŸçš„ä¸»è¦ç©å®¶ï¼Œ2Dæ˜¾å¡æ—¶ä»£å£°åæ˜¾èµ«ï¼Œ3Dæ—¶ä»£è½å¯ï¼Œæœ€ç»ˆè½¬å‘å°ä¼—è§†é¢‘å¸‚åœºã€‚å¦‚ä»Šè¯´èµ·æ˜¾å¡GPUï¼Œå¾ˆå¤šäººè„‘æµ·é‡Œåªä¼šæµ®ç°NVIDIAã€AMDä¸¤ä¸ªåå­—ï¼Œåœ¨ä¸Šä¸ªä¸–çºªæœ«ï¼ŒMatrox(è¿ˆåˆ›)çš„åå­—å¦‚é›·è´¯è€³ã€‚å®ƒçš„èµ„æ ¼æ¯”NVIDIAã€AMDè¦è€å¾—å¤šã€‚è¿ˆåˆ›æ¥è‡ªåŠ æ‹¿å¤§(ATIä¹Ÿæ˜¯)ï¼ŒMatroxæˆç«‹äº1976å¹´ï¼Œæ¯”ATIæ—©9å¹´ï¼Œæ¯”NVIDIAæ—©17å¹´ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139577.png" alt="img"></p>
<h2 id="3-2ã€å›¾å½¢æŠ€æœ¯"><a href="#3-2ã€å›¾å½¢æŠ€æœ¯" class="headerlink" title="3.2ã€å›¾å½¢æŠ€æœ¯"></a>3.2ã€å›¾å½¢æŠ€æœ¯</h2><p>â€‹    1976å¹´~1995å¹´æ˜¯æ²‰é—·å¯‚å¯¥çš„2Dæ—¶ä»£ï¼Œæ˜¾ç¤ºæŠ€æœ¯å‘å±•ç¼“æ…¢ï¼Œï¼Œå›¾å½¢å›¾åƒç¼–ç¨‹è¿‘ä¹åœæ»ã€‚å¸‚åœºæœŸå¾…ç€é›†æˆç”µè·¯çš„å‘å±•ã€å¾®ç”µå­æŠ€æœ¯çš„çˆ†å‘ã€‚</p>
<p>â€‹    1995å¹´ä¹‹åï¼Œç¡¬ä»¶æŠ€æœ¯çš„æ˜¥å¤©åˆ°æ¥äº†ï¼Œ3Dæ˜¾å¡æ¶Œç°ï¼Œæ€§èƒ½å’ŒæŠ€æœ¯æœ‰å¾ˆå¤§æå‡ï¼Œé¸Ÿè¯­èŠ±é¦™ï¼Œç™¾å®¶äº‰é¸£ã€‚å‚å•†ä¸æ–­æ¨é™ˆå‡ºæ–°æ‰èƒ½ç”Ÿå­˜ï¼Œè·Ÿä¸ä¸ŠèŠ‚å¥çš„ä¼ä¸šï¼Œé€ƒä¸äº†è¢«æ”¶è´­çš„å‘½è¿ã€‚ç¼…æ€€è¿‡å»ï¼Œç»§å¾€å¼€æ¥ï¼Œ2DæŠ€æœ¯å¤šå¹´çš„å‘å±•ä¸º3DæŠ€æœ¯åšäº†20å¹´çš„é“ºå«ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139542.png" alt="img"></p>
<p>â€‹    ç»“åˆè¿‡å»å†å²ï¼Œå›é¡¾å½“å¹´2Dç¼–ç¨‹çš„æŠ€æœ¯ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139738.png" alt="img"></p>
<h3 id="3-2-1ã€GDIç¼–ç¨‹"><a href="#3-2-1ã€GDIç¼–ç¨‹" class="headerlink" title="3.2.1ã€GDIç¼–ç¨‹"></a>3.2.1ã€GDIç¼–ç¨‹</h3><p>â€‹    å½“æ—¶å›¾å½¢å›¾åƒç¼–ç¨‹å¤šä½¿ç”¨GDIæŠ€æœ¯ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139839.png" alt="img"></p>
<p>â€‹    ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CDC *pDC = GetDC();</span><br><span class="line">pDC-&gt;SelectObject(&amp;â€¦);</span><br><span class="line">ReleaseDC(pDC);</span><br></pre></td></tr></table></figure>

<p>â€‹    GDIç¼–ç¨‹çš„å‡ºç°ï¼Œä»£è¡¨äº†æ¶ˆè´¹çº§å›¾åƒç¼–ç¨‹çš„å…´èµ·ã€‚</p>
<h3 id="3-2-2ã€GDI-ç¼–ç¨‹"><a href="#3-2-2ã€GDI-ç¼–ç¨‹" class="headerlink" title="3.2.2ã€GDI+ç¼–ç¨‹"></a>3.2.2ã€GDI+ç¼–ç¨‹</h3><p>â€‹    GDI+æ˜¯GDIçš„å¢å¼ºç‰ˆï¼Œæƒ³å½“å¹´ï¼ŒWindowså¹³å°çš„ä¸Šçš„å›¾å½¢å›¾åƒæŠ€æœ¯ï¼Œèµ°åœ¨å„ä¸ªå¹³å°çš„å‰ç«¯ã€‚</p>
<p>â€‹    GDIç¼–ç¨‹ä¸ºOpenGLå’ŒDirectXåšäº†é“ºå«ã€‚</p>
<p>â€‹    ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HINSTANCE hInst = AfxGetResourceHandle();</span><br><span class="line">HRSRC hRsrc = ::FindResource (hInstï¼ŒMAKEINTRESOURCE(nID)ï¼ŒsTR); // type</span><br><span class="line"></span><br><span class="line">if (!hRsrc)</span><br><span class="line">return FALSE;</span><br><span class="line"></span><br><span class="line">// load resource into memory</span><br><span class="line"></span><br><span class="line">DWORD len = SizeofResource(hInstï¼Œ hRsrc);</span><br><span class="line">BYTE* lpRsrc = (BYTE*)LoadResource(hInstï¼Œ hRsrc);</span><br><span class="line">if (!lpRsrc)</span><br><span class="line">return FALSE;</span><br><span class="line"></span><br><span class="line">// Allocate global memory on which to create stream</span><br><span class="line">HGLOBAL m_hMem = GlobalAlloc(GMEM_FIXEDï¼Œ len);</span><br><span class="line">BYTE* pmem = (BYTE*)GlobalLock(m_hMem);</span><br><span class="line">memcpy(pmemï¼ŒlpRsrcï¼Œlen);</span><br><span class="line">IStream* pstm;</span><br><span class="line">CreateStreamOnHGlobal(m_hMemï¼ŒFALSEï¼Œ&amp;pstm);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// load from stream</span><br><span class="line">pImg=Gdiplus::Image::FromStream(pstm);</span><br><span class="line"></span><br><span class="line">// free/release stuff</span><br><span class="line">GlobalUnlock(m_hMem);</span><br><span class="line">pstm-&gt;Release();</span><br><span class="line">FreeResource(lpRsrc);</span><br></pre></td></tr></table></figure>

<p>â€‹    æ— è®ºGDIè¿˜æ˜¯GDI+æŠ€æœ¯ï¼Œéƒ½ä»£è¡¨ç€å›¾å½¢å›¾åƒç¼–ç¨‹çš„å¹´ä»£åˆ°æ¥äº†ã€‚</p>
<h3 id="3-2-3ã€Direct-2D"><a href="#3-2-3ã€Direct-2D" class="headerlink" title="3.2.3ã€Direct 2D"></a>3.2.3ã€Direct 2D</h3><p>â€‹    Direct2Dçš„å‡ºç°ä»£è¡¨ç€å¼•æ“æŠ€æœ¯çš„åˆ°æ¥ï¼Œä½“ç°äº†å¸‚åœºå¯¹å›¾å½¢å›¾åƒã€éŸ³è§†é¢‘æŠ€æœ¯çš„å¼ºçƒˆéœ€æ±‚ï¼Œåœ¨å¼•æ“çš„èƒŒåï¼Œå°è£…äº†å›¾å½¢å›¾åƒæŠ€æœ¯çš„ä¸“ä¸šæ€§ä¸å¤æ‚æ€§ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139869.png" alt="img"></p>
<p>â€‹    ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;windows.h&gt; </span><br><span class="line">#include &lt;d2d1.h&gt; </span><br><span class="line">#include &lt;d2d1helper.h&gt; </span><br><span class="line">#include &lt;dwrite.h&gt; </span><br><span class="line">#pragma comment(lib,&quot;dwrite.lib&quot;) </span><br><span class="line">#pragma comment(libd&quot;d2d1.lib&quot;) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">static HINSTANCE g_hinst; </span><br><span class="line">static HWND g_hwnd;</span><br><span class="line">static bool g_flag_app_exit;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">static ID2D1Factory * g_factory; </span><br><span class="line">static ID2D1HwndRenderTarget * g_render_target; </span><br><span class="line"></span><br><span class="line">g_render_target-&gt;Resize(D2D1::SizeU(LOWORD(lparam)ï¼ŒHIWORD(lparam))); </span><br><span class="line">D2D1CreateFactory(D2D1_FACTORY_TYPE_SINGLE_THREADEDï¼Œ &amp;g_factory); </span><br><span class="line"></span><br><span class="line">RECT rc; </span><br><span class="line">GetClientRect(g_hwndï¼Œ &amp;rc); </span><br><span class="line"></span><br><span class="line">g_factory-&gt;CreateHwndRenderTarget(</span><br><span class="line">        D2D1::RenderTargetProperties()ï¼Œ </span><br><span class="line">        D2D1::HwndRenderTargetProperties(g_hwndï¼Œ</span><br><span class="line">D2D1::SizeU(rcã€‚right - rcã€‚leftï¼Œ rcã€‚bottom - rcã€‚top)    )ï¼Œ </span><br><span class="line">        &amp;g_render_target); </span><br><span class="line"></span><br><span class="line">g_render_target-&gt;BeginDraw(); </span><br><span class="line">g_render_target-&gt;Clear(D2D1::ColorF(0ã€‚63ï¼Œ 0ã€‚84ï¼Œ 0ã€‚00));  </span><br><span class="line">g_render_target-&gt;EndDraw(); </span><br><span class="line">g_render_target-&gt;Release(); </span><br><span class="line">g_factory-&gt;Release(); </span><br></pre></td></tr></table></figure>

<h3 id="3-2-4ã€AGG"><a href="#3-2-4ã€AGG" class="headerlink" title="3.2.4ã€AGG"></a>3.2.4ã€AGG</h3><p>â€‹    AGGï¼Œå…¨åï¼šAnti-Grain Geometryï¼Œä¸€ä¸ªå¼€æºçš„ã€é«˜æ•ˆ2Då›¾å½¢åº“ã€‚AGGçš„åŠŸèƒ½ä¸GDI+çš„åŠŸèƒ½ç±»ä¼¼ï¼Œæä¾›äº†æ¯”GDI+æ›´çµæ´»çš„ç¼–ç¨‹æ¥å£ï¼Œäº§ç”Ÿçš„å›¾å½¢çš„è´¨é‡éå¸¸é«˜ï¼Œè·¨å¹³å°çš„2Då›¾å½¢å¼•æ“ï¼Œå¯åœ¨Windowsã€Winceã€Linuxç­‰å¹³å°ä¸Šè¿è¡Œã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139845.png" alt="img"></p>
<p>â€‹    è®¾è®¡ä¸Šï¼Œå¸ˆå‡ºBooståº“ï¼Œä½¿ç”¨äº†å¤§é‡çš„C++è¯­æ³•è§„åˆ™ï¼ŒåŒ…æ‹¬æ¨¡æ¿ã€ä»¿å‡½æ•°ç­‰å¤„ç†ã€‚ä¸ºäº†èƒ½åœ¨æ›´å¤šå¹³å°ä¸Šä½¿ç”¨ï¼Œå¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨Boostå’ŒSTLåº“ï¼Œè‡ªå·±å®ç°äº†éƒ¨åˆ†STLåŠŸèƒ½ã€‚â€</p>
<h3 id="3-2-5ã€Cairo"><a href="#3-2-5ã€Cairo" class="headerlink" title="3.2.5ã€Cairo"></a>3.2.5ã€Cairo</h3><p>â€‹    cairo æ˜¯ä¸€ä¸ªå…è´¹çš„çŸ¢é‡ç»˜å›¾è½¯ä»¶åº“ï¼Œå¯ä»¥ç»˜åˆ¶å¤šç§è¾“å‡ºæ ¼å¼ã€‚cairoæ”¯æŒè®¸å¤šå¹³å°ï¼ŒåŒ…æ‹¬ Linuxã€BSDã€Windowsç­‰ã€‚Linux ç»˜å›¾å¯ä»¥é€šè¿‡ X Window ç³»ç»Ÿã€Quartzã€å›¾åƒç¼“å†²æ ¼å¼æˆ– OpenGL ä¸Šä¸‹æ–‡æ¥å®ç°ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139859.png" alt="img"></p>
<p>â€‹    cairo çš„ä¸»è¦è®¾è®¡ç›®æ ‡æ˜¯æä¾›å°½å¯èƒ½æ¥è¿‘çš„è¾“å‡ºã€‚è¿™ç§ä¸€è‡´çš„è¾“å‡ºä½¿ cairo éå¸¸é€‚åˆ GUI å·¥å…·é›†ç¼–ç¨‹å’Œè·¨å¹³å°åº”ç”¨ç¨‹åºå¼€å‘ã€‚ä½¿ç”¨åŒä¸€ä¸ªç»˜å›¾åº“æ‰“å°é«˜åˆ†è¾¨ç‡çš„å±å¹•å’Œç»˜åˆ¶å±å¹•å†…å®¹ï¼Œè¿™ç§åŠŸèƒ½å…·æœ‰æ˜¾è‘—çš„ä¼˜ç‚¹ã€‚</p>
<p>â€‹    åœ¨æ”¯æŒçš„ç›®æ ‡å¹³å°ä¸Šï¼Œcairo å°è¯•æ™ºèƒ½åŒ–åœ°ä½¿ç”¨åº•å±‚ç¡¬ä»¶å’Œè½¯ä»¶æ”¯æŒã€‚é«˜è´¨é‡çŸ¢é‡å›¾å½¢å’Œé«˜æ€§èƒ½çš„ç»“åˆä½¿cairoæˆä¸ºä¼˜ç§€çš„ç»˜å›¾ç³»ç»Ÿã€‚</p>
<p>â€‹    cairo ç”¨Cç¼–å†™çš„ï¼Œä¸ºå¤§å¤šæ•°å¸¸ç”¨çš„è¯­è¨€æä¾›äº†ç»‘å®šã€‚é€‰ç”¨Cè¯­è¨€æœ‰åŠ©äºåˆ›å»ºæ–°çš„ç»‘å®šï¼Œåœ¨è¿›è¡ŒCè¯­è¨€è°ƒç”¨æ—¶æä¾›é«˜æ€§èƒ½ã€‚å’ŒPythonç»‘å®šï¼Œæ”¯æŒå¿«é€ŸåŸå‹å¼€å‘ï¼Œé™ä½äº†å­¦ä¹  cairoç»˜å›¾APIçš„é—¨æ§›ã€‚</p>
<p>â€‹    ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cairo.h&gt;</span> </span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span>  <span class="title function_">main</span> <span class="params">(<span class="type">int</span> argcï¼Œ <span class="type">char</span> *argv[])</span> </span><br><span class="line"></span><br><span class="line">&#123; </span><br><span class="line">    <span class="type">cairo_surface_t</span> *surface; </span><br><span class="line">    <span class="type">cairo_t</span> *cr; </span><br><span class="line">    <span class="type">int</span> width = <span class="number">640</span>; </span><br><span class="line">    <span class="type">int</span> height = <span class="number">480</span>; </span><br><span class="line">    surface = cairo_image_surface_create (CAIRO_FORMAT_ARGB32ï¼Œ widthï¼Œ height); </span><br><span class="line">    cr = cairo_create (surface); </span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Drawing code goes here */</span> </span><br><span class="line">    cairo_set_line_width (crï¼Œ <span class="number">10</span>); </span><br><span class="line">    cairo_set_source_rgb (crï¼Œ <span class="number">0</span>ï¼Œ <span class="number">0</span>ï¼Œ <span class="number">0</span>); </span><br><span class="line">    cairo_rectangle (crï¼Œ width/<span class="number">4</span>ï¼Œ height/<span class="number">4</span>ï¼Œ width/<span class="number">2</span>ï¼Œ height/<span class="number">2</span>); </span><br><span class="line">    cairo_stroke (cr); </span><br><span class="line"></span><br><span class="line">   <span class="comment">/* Write output and clean up */</span> </span><br><span class="line">   cairo_surface_write_to_png (surfaceï¼Œ <span class="string">&quot;rectangleã€‚png&quot;</span>); </span><br><span class="line">   cairo_destroy (cr); </span><br><span class="line">   cairo_surface_destroy (surface); </span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-6ã€Cocoa-Drawing"><a href="#3-2-6ã€Cocoa-Drawing" class="headerlink" title="3.2.6ã€Cocoa Drawing"></a>3.2.6ã€Cocoa Drawing</h3><p>â€‹    Cocoa Drawingæ˜¯è‹¹æœå…¬å¸çš„2Då›¾å½¢å›¾åƒå¼€å‘ç±»åº“ï¼Œåœ¨XCodeä¸‹è¿ç”¨ï¼Œæ—¨åœ¨æ¨å¹¿è‹¹æœå…¬å¸çš„æŠ€æœ¯ã€‚çºµç„¶è‹¹æœä¸€ç›´æœ‰ç€å¾ˆå¼ºçš„å›¾å½¢å›¾åƒå¤„ç†èƒ½åŠ›ï¼Œä½†ä»…å±€é™äºè‹¹æœå…¬å¸æœ¬èº«çš„è½¯ä»¶ï¼Œè‹¹æœåœ¨æ—©æœŸä¸€ç›´æ²¡æœ‰å¾ˆå¥½çš„å›¾å½¢å›¾åƒç¼–ç¨‹å¼•æ“ã€‚</p>
<p>â€‹    è¿‘äº›å¹´è‹¹æœçš„MetalæŠ€æœ¯ï¼Œæ‰å¯ä»¥ç®—ä½œè‹¹æœå…¬å¸çœŸæ­£çš„æŠ€æœ¯åˆ›ä¸¾ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139889.png" alt="img"></p>
<p>â€‹    ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[NSGraphicsContext saveGraphicsState];</span><br><span class="line"></span><br><span class="line">// Create the path and add the shapes</span><br><span class="line">NSBezierPath* clipPath = [NSBezierPath bezierPath];</span><br><span class="line">[clipPath appendBezierPathWithRect:NSMakeRect(0.0ï¼Œ0.0ï¼Œ100.0ï¼Œ100.0)];</span><br><span class="line">[clipPath appendBezierPathWithOvalInRect:NSMakeRect(50.0ï¼Œ50.0ï¼Œ100.0ï¼Œ100.0)];</span><br><span class="line"></span><br><span class="line">// Add the path to the clip shapeã€‚</span><br><span class="line">[clipPath addClip];</span><br><span class="line"></span><br><span class="line">// Draw the imageã€‚</span><br><span class="line">[NSGraphicsContext restoreGraphicsState];</span><br></pre></td></tr></table></figure>

<h2 id="3-3ã€æ€»ç»“"><a href="#3-3ã€æ€»ç»“" class="headerlink" title="3.3ã€æ€»ç»“"></a>3.3ã€æ€»ç»“</h2><p>â€‹    è®¡ç®—æœºåŠŸèƒ½çš„å¼ºå¤§ï¼Œä»£è¡¨æœ¬èº«çš„å¼ºå¤§ï¼Œæœ¬èº«çš„å¼ºå¤§ä»£è¡¨ä½“ç³»çš„å¤æ‚ï¼Œæ¨¡å—çš„ç»„åˆï¼Œè§†é¢‘æŠ€æœ¯ä¹Ÿä¸ä¾‹å¤–ï¼Œä»å®è§‚è§’åº¦æ¥çœ‹ï¼Œå›¾å½¢å›¾åƒç¼–ç¨‹æ¡†æ¶å¦‚ä¸‹å›¾ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139912.png" alt="img"></p>
<p>â€‹    è½¯ç¡¬ä»¶æŠ€æœ¯æ˜¯ç´§å¯†ç»“åˆçš„ï¼Œç¡¬ä»¶æŠ€æœ¯çš„è¿›æ­¥æ¨åŠ¨äº†è½¯ä»¶ç¼–ç¨‹çš„ç¹è£ï¼Œè½¯ä»¶æŠ€æœ¯çš„åº”ç”¨ä¿ƒè¿›äº†ç¡¬ä»¶çš„æ¨å¹¿ã€‚æ—©æœŸçš„ç¡¬ä»¶å…¬å¸é©±åŠ¨è®¾è®¡ã€ä¸“ä¸šçº§çš„ç¼–ç¨‹æ¥å£ç ”å‘ï¼Œåˆ°åæœŸæ¶ˆè´¹çº§å¸‚åœºè½¯ä»¶æŠ€æœ¯çš„ç¹è£ã€‚å›¾å½¢å›¾åƒç¼–ç¨‹å½¢æˆç‹¬ç«‹çš„è½¯ä»¶é˜µåœ°ï¼Œå‘¼å”¤ç€3Dæ—¶ä»£çš„åˆ°æ¥ã€‚</p>
<h1 id="4ã€3Dæ—¶ä»£"><a href="#4ã€3Dæ—¶ä»£" class="headerlink" title="4ã€3Dæ—¶ä»£"></a>4ã€3Dæ—¶ä»£</h1><p>â€‹    å†å²é•¿æ²³ä¸­ï¼Œç§‘æŠ€è¿›æ­¥æ˜¯äººç±»æ–‡æ˜çš„ä¸»è¦æ¨åŠ¨åŠ›ã€‚æ²§æµ·æ¡‘ç”°ï¼Œå¤©ä¸‹å¤šå˜ï¼Œäººç±»å¯¹ç§‘æŠ€çš„ç ”ç©¶ä¸æ¢ç´¢ä»æœªåœæ­¢ï¼Œè®¡ç®—æ˜¾ç¤ºæŠ€æœ¯ä¹Ÿä¸ä¾‹å¤–ã€‚</p>
<p>â€‹    ç°å®æ˜¯3Dçš„ï¼Œæ˜¾ç¤ºç¡¬ä»¶æ³¨å®šä¹Ÿæ˜¯3Dçš„ã€‚é€è¿‡å†å²çš„äº‘çƒŸï¼Œå¾—åˆ°å²æœˆçš„å¯ç¤ºï¼Œç¡¬ä»¶å¯¹3DæŠ€æœ¯çš„æ”¯æŒæ˜¯æ˜¾å¡å‚å•†å­˜æ´»çš„æ ¹æœ¬ã€‚ç¡¬ä»¶å¯¹å›¾å½¢å›¾åƒå¼•æ“çš„æ”¯æŒï¼Œæ˜¯æ˜¾ç¤ºèŠ¯ç‰‡å…¬å¸åšå¤§åšå¼ºçš„åŸºç¡€ã€‚å¼•æ“æ”¯æŒä¸»è¦åŒ…æ‹¬OpenGLå’ŒD3Då¼•æ“æ”¯æŒï¼Œåœ¨2000å¹´å‰å°¤ä¸ºæ˜æ˜¾ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139634.png" alt="img"></p>
<p>â€‹    ç§‘æŠ€çš„é£é£é›¨é›¨ï¼Œé¢ä¸´ç€æŠ€æœ¯çš„æŠ‰æ‹©å’Œé€‰å‹ï¼Œæ— è®ºè¾‰ç…Œé»¯æ·¡ï¼Œæ—¶å…‰é»˜ç„¶å‰è¡Œï¼Œé‚£äº›è¿œè¡Œçš„æŠ€æœ¯ï¼Œåšäº†ç§‘å­¦çš„è¾©è¯ã€‚</p>
<h2 id="4-1ã€å…¬å¸"><a href="#4-1ã€å…¬å¸" class="headerlink" title="4.1ã€å…¬å¸"></a>4.1ã€å…¬å¸</h2><h3 id="4-1-1ã€3Dfx"><a href="#4-1-1ã€3Dfx" class="headerlink" title="4.1.1ã€3Dfx"></a>4.1.1ã€3Dfx</h3><p>â€‹    1994å¹´ï¼Œ3Dfxæˆç«‹ï¼Œåœ¨å½“æ—¶æ˜¯ä¸€å®¶å°å…¬å¸ï¼Œå®šä½æ˜ç¡®ï¼Œå¾ˆå¿«å°±æ¨å‡ºäº†ä¸šç•Œçš„ç¬¬ä¸€å—çœŸæ­£æ„ä¹‰çš„3Då›¾å½¢åŠ é€Ÿå¡ï¼šVoodooã€‚åœ¨å½“å¹´ï¼ŒVoodooåœ¨é€Ÿåº¦ä»¥åŠè‰²å½©æ–¹é¢çš„è¡¨ç°è®©å–œæ¬¢æ¸¸æˆçš„ç”¨æˆ·ä¸ºä¹‹ç–¯ç‹‚ï¼ŒVoodooå‡ ä¹æ˜¯ç©å®¶ä»¬å”¯ä¸€çš„é€‰æ‹©ï¼Œå½“å¹´3Dfxçš„ä¸“ç”¨Glideå¼•æ“æ¥å£ç»Ÿæ²»äº†æ•´ä¸ª3Dä¸–ç•Œã€‚å½“å¹´ä¸€ä¸ªä¸“ä¸šå›¾å½¢å¼•æ“ï¼Œå¯æ‹¯æ•‘ä¸€ç³»åˆ—äº§å“ï¼Œæˆå°±ä¸€å®¶ç¡¬ä»¶å‚å•†ã€‚</p>
<p>â€‹    Glideå¼•æ“æä¾›äº†ä¸“ä¸šçš„3Då›¾å½¢æ˜¾ç¤ºæ¥å£ï¼ŒGlideå¯ä»¥è¯´æ˜¯ä¸€å¥—3Dæ¥å£åº“ï¼Œ3Dfxå‡­å€Ÿç¡¬ä»¶ä¸å¼•æ“çš„ç»“åˆåˆ›é€ äº†å‘å±•å†å²ä¸Šçš„å¥‡è¿¹ã€‚3Dfxçš„æˆåŠŸå°±æ˜¯åœ¨3Dç¡¬ä»¶æ”¯æŒå’Œç›¸å…³å¼•æ“æ”¯æŒè‰¯å¥½çš„è¡¨ç°ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139557.png" alt="img"></p>
<p>â€‹    3Dfxä»ç¡¬ä»¶ä¸Šå®ç°äº†Zç¼“å­˜å’ŒåŒç¼“å­˜ï¼Œå¯è¿›è¡Œå…‰æ …åŒ–ä¹‹ç±»çš„æ“ä½œï¼Œå®ç°äº†DirectX 6çš„ç‰¹å¾é›†ã€‚CPUä»ç¹é‡çš„åƒç´ å¡«å……ä»»åŠ¡ä¸­è§£è„±å‡ºæ¥ã€‚å½“ç„¶ï¼Œå½“å¹´çš„æŠ€æœ¯ä¸æˆç†Ÿï¼Œé¡¶ç‚¹å˜æ¢å¿…é¡»åœ¨CPUä¸­å®Œæˆï¼Œå…‰æ …åŒ–ä¹‹åçš„åƒç´ æ“ä½œä¹Ÿå¾ˆæœ‰é™ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139575.png" alt="img"></p>
<h3 id="4-1-2ã€ATI"><a href="#4-1-2ã€ATI" class="headerlink" title="4.1.2ã€ATI"></a>4.1.2ã€ATI</h3><p>â€‹    è¯´èµ·æ˜¾å¡ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸æATIï¼Œç”±äºå¯¹3DæŠ€æœ¯æ”¯æŒè¾ƒå¥½ä»¥åŠç´§è·ŸOpenGLå’ŒDirectXæ­¥ä¼ã€‚å¤šå¹´å’Œè‹±ä¼Ÿè¾¾é½åã€‚åæ¥ç”±äºæ˜¾å¡é©±åŠ¨é—®é¢˜ï¼Œé€ å°±äº†Aå¡è¿½å‡»Nå¡çš„å±€é¢ã€‚ATIæä¾›äº†è‰¯å¥½çš„ç¼–ç¨‹æ¥å£ï¼Œæˆä¸ºæ¨å¹¿çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚</p>
<p>â€‹    ATIçš„æ¬»åˆ›å§‹äººä½•å›½æºå…ˆç”Ÿï¼Œå¹¿ä¸œæ–°ä¼šäººï¼Œåœ¨å¾ˆå¤šå¹´é—´éƒ½æ˜¯èŠ¯ç‰‡ç•Œçš„é¡¶çº§äººç‰©ã€‚AMDåœ¨2006å¹´ä»¥54äº¿ç¾å…ƒæ”¶è´­ATIï¼Œä½•å›½æºä»æ­¤é€€å‡ºæ˜¾å¡èŠ¯ç‰‡è¡Œä¸šã€‚ä»Šå¤©ä¸–ç•Œä¸Šå¾ˆå¤šç”µè„‘çš„æ˜¾å¡éƒ½æœ‰ATIçš„æŠ€æœ¯ã€‚ä¸‹é¢æ˜¯æ˜¾å¡é¢†åŸŸçš„ä¸¤ä¸ªé£äº‘äººç‰©ï¼Œä½•å…ˆç”Ÿå·²é‡‘ç›†æ´—æ‰‹ï¼Œé€€å‡ºæ±Ÿæ¹–ï¼Œé»„è¯å¸ˆä¾ç„¶çš®è¡£æŒ‚å¸…ï¼Œå¾æˆ˜ä¸€çº¿ã€‚</p>
<p>â€‹    å¸‚åœºé£äº‘å˜å¹»ï¼Œæ¯«æ— ç–‘é—®ï¼ŒATIæ˜¯å¹¸è¿çš„ï¼Œå½“å¹´æ½œå›¾é—®é¼ï¼Œé›„éœ¸å¤©ä¸‹ã€‚ç›´è‡³åæ¥è¢«é«˜ä»·æ”¶è´­ï¼Œå¤šå¹´åçš„ä»Šå¤©ï¼ŒAå¡ä¾ç„¶ç¬‘å‚²æ±Ÿæ¹–ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139678.png" alt="img"></p>
<h3 id="4-1-3ã€NVIDIA"><a href="#4-1-3ã€NVIDIA" class="headerlink" title="4.1.3ã€NVIDIA"></a>4.1.3ã€NVIDIA</h3><p>â€‹    æèµ·æ˜¾å¡ï¼Œå¿…é¡»æåŠå¦å¤–ä¸€ä¸ªå‚å®¶NViDiaï¼Œè‹±ä¼Ÿè¾¾çš„åˆ›å§‹äººé»„ä»å‹‹å…ˆç”Ÿï¼Œå°æ¹¾å°åŒ—äººï¼Œæ±Ÿæ¹–äººç§°é»„è¯å¸ˆï¼ˆè€é»„ï¼‰ã€‚è¿‘20å¹´ä»¥æ¥ï¼Œä¸–ç•Œé¡¶çº§èŠ¯ç‰‡å·¨å¤´ã€‚åœ¨å›¾å½¢å¤„ç†èŠ¯ç‰‡ä¸Šï¼Œä½•å›½æºå’Œé»„ä»å‹‹éƒ½åšå‡ºäº†ä¸å¯ç£¨ç­çš„è´¡çŒ®ï¼Œå›¾å½¢å¤„ç†èŠ¯ç‰‡çš„å‰èº«ï¼Œå°±æ˜¯ä»Šå¤©çš„GPUï¼ŒGPUæ˜¯è‹±ä¼Ÿè¾¾æ¨å‡ºçš„ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139618.png" alt="img"></p>
<p>â€‹    NVIDIA é€šè¿‡NVç³»åˆ—äº§å“å°è¯•ç‰›åˆ€ï¼Œé€šè¿‡GeForce ç³»åˆ—äº§å“å‡ºå¾æ±Ÿæ¹–ï¼Œå±¡æˆ˜å±¡èƒœï¼Œæˆ˜åŠŸæ˜¾èµ«ï¼Œä»Šå¤©ç¨³åæ˜¾ç¤ºé¢†åŸŸç¬¬ä¸€æŠŠäº¤æ¤…ï¼Œæ— äººå‡ºå…¶å·¦å³ã€‚åœ¨äººå·¥æ™ºèƒ½æ•°æ®åˆ†ææ–¹é¢ï¼Œè‹±ä¼Ÿè¾¾ä¾ç„¶æˆ˜åŠŸæ˜¾èµ«ã€‚</p>
<p>â€‹    æƒ³å½“å¹´ï¼Œæ˜¾ç¤ºé¢†åŸŸæ˜¯è‹±ä¼Ÿè¾¾å’ŒATIçš„å¤©ä¸‹ï¼Œä¸¤è€…ç›¸äº’ç«äº‰ï¼Œæ¨åŠ¨äº†æ˜¾ç¤ºæŠ€æœ¯çš„å‘å±•ã€‚æˆå°±äº†ä»Šå¤©çš„æ˜¾ç¤ºè§„èŒƒã€‚å½“å¹´çš„ç«äº‰æœ¬è´¨æ˜¯æ˜¾ç¤ºæŒ‡ä»¤ã€Shaderç¼–ç¨‹ã€æ•ˆç‡çš„ç«äº‰ã€‚</p>
<p>â€‹    è‹±ä¼Ÿè¾¾çš„NV3å¼€å§‹æ”¯æŒOpenGLï¼Œå–å¾—äº†å·¨å¤§çš„æˆåŠŸã€‚åæœŸå¼€å§‹æ”¯æŒDirect3Dã€‚ä¹Ÿå°±æ˜¯å‰æœŸå¯¹è¿™äº›æ¡†æ¶æ”¯æŒä¸è¶³ï¼Œå¯¼è‡´ç»è¥ä¸¾æ­¥ç»´è‰°ã€‚</p>
<p>â€‹    1999å¹´8æœˆï¼ŒNVIDIAå…¬å¸å‘å¸ƒäº†ä¸€æ¬¾ä»£å·ä¸ºNV10çš„å›¾å½¢èŠ¯ç‰‡Geforce 256ã€‚Geforce 256æ˜¯å›¾å½¢èŠ¯ç‰‡é¢†åŸŸå¼€å¤©è¾Ÿåœ°çš„äº§å“ï¼Œå› ä¸ºå®ƒæ˜¯ç¬¬ä¸€æ¬¾æå‡ºGPUæ¦‚å¿µçš„äº§å“ã€‚</p>
<p>â€‹    Geforce 256æ‰€é‡‡ç”¨çš„æ ¸å¿ƒæŠ€æœ¯æœ‰â€œT&amp;Lâ€ç¡¬ä»¶ã€ç«‹æ–¹ç¯å¢ƒæè´¨è´´å›¾å’Œé¡¶ç‚¹æ··åˆã€çº¹ç†å‹ç¼©å’Œå‡¹å‡¸æ˜ å°„è´´å›¾ã€åŒé‡çº¹ç†å››åƒç´ ã€256ä½æ¸²æŸ“å¼•æ“ç­‰ã€‚â€œT&amp;Lâ€ç¡¬ä»¶çš„å‡ºç°ï¼Œè®©æ˜¾ç¤ºèŠ¯ç‰‡å…·å¤‡äº†ä»¥å‰åªæœ‰é«˜ç«¯å·¥ä½œç«™æ‰æœ‰çš„é¡¶ç‚¹å˜æ¢èƒ½åŠ›ï¼ŒåŒæ—¶æœŸçš„OpenGLå’ŒDirectX 7éƒ½æä¾›äº†ç¡¬ä»¶é¡¶ç‚¹å˜æ¢çš„ç¼–ç¨‹æ¥å£ã€‚1999å¹´ï¼ŒGPUçš„æ¦‚å¿µå°±è¿™æ ·å‡ºç°äº†ã€‚</p>
<p>â€‹    GPUçš„æ¨å‡ºï¼Œä¸ä»…ä»…æ˜¯ç¡¬ä»¶ä½“ç³»çš„é©å‘½æ€§å˜åŒ–ï¼Œæ›´æ˜¯å¯¹æ˜¾ç¤ºæ ‡å‡†çš„å¼ºå¤§æ”¯æŒã€‚ä»Šå¤©3Då¼•æ“ç¼–ç¨‹ï¼Œæ ¸å¿ƒä¸»è¦ä¹Ÿæ˜¯é¢å‘GPUçš„ç¼–ç¨‹ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139564.png" alt="img"></p>
<p>â€‹    åæœŸATIè¢«AMDæ”¶è´­ï¼Œçºµç„¶æ²¡æœ‰è‹±ä¼Ÿè¾¾è€€çœ¼ï¼Œä½†æ•´ä½“å‘å±•è¿˜ç®—é¡ºåˆ©ï¼Œå½¢æˆäº†Aå¡å’ŒNå¡ç«äº‰çš„æ ¼å±€ã€‚</p>
<p>â€‹    2020å¹´ï¼Œè‹±ä¼Ÿè¾¾æ”¶è´­ARMï¼Œå¸‚å€¼è¶…è¿‡3300äº¿ç¾å…ƒï¼Œè¶…è¿‡INTEL 1000äº¿ç¾å…ƒï¼Œæˆä¸ºå…¨çƒå¸‚å€¼æ’åTOP10ã€‚åœ¨è¥¿æ–¹çš„åœŸåœ°ä¸Šï¼Œä¸€ä¸ªé»„ç§äººï¼Œä¸€ä¸ªå°æ¹¾äººï¼Œæˆ˜åŠŸæ˜¾èµ«ã€‚</p>
<h3 id="4-1-4ã€3DLabs"><a href="#4-1-4ã€3DLabs" class="headerlink" title="4.1.4ã€3DLabs"></a>4.1.4ã€3DLabs</h3><p>â€‹    3DæŠ€æœ¯é£é€Ÿå‘å±•ï¼Œä¸“ä¸šæ˜¾å¡éœ€æ±‚å¢å¤§ã€‚ä¸“ä¸šå…¬å¸åº”è¿è€Œç”Ÿã€‚3DLabså°±æ˜¯è¿™æ ·çš„å…¬å¸ï¼Œå¼€å‘é«˜ç«¯ç»˜å›¾èŠ¯ç‰‡ï¼Œå¯¹OpenGLçš„å®Œç¾æ”¯æŒï¼Œæ€§èƒ½å¼ºå¤§ï¼Œå½“æ—¶çš„OpenGLæ™®é€šæ˜¾å¡éš¾ä»¥å®Œå…¨æ”¯æŒã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139756.png" alt="img"></p>
<p>â€‹    å½“å¹´åœ¨ä¸“ä¸šæ˜¾å¡å¸‚åœºï¼Œ3DLabsçš„äº§å“å‡ ä¹æ˜¯å”¯ä¸€é€‰æ‹©ã€‚é¢å¯¹ç¬æ¯ä¸‡å˜çš„ä¸–ç•Œï¼Œ3DLabsè¿˜æ˜¯è½åäº†ï¼Œå¯¹D3DæŠ€æœ¯é‡è§†ä¸è¶³å’Œå¯¹OpenGLè¿‡åº¦ä¾èµ–ï¼Œæœ€ç»ˆè¢«é»„è¯å¸ˆçš„Quadroå¹²æ‰ã€‚äº2002å¹´è¢«åˆ›æ–°ç§‘æŠ€æ”¶è´­ï¼Œæˆä¸ºæ——ä¸‹å­å…¬å¸ã€‚</p>
<p>â€‹    å¯¹D3Dçš„æ”¯æŒç¨‹åº¦ä¸ä»…ä»…å½±å“æ°‘é—´æ˜¾å¡ï¼Œå¯¹ä¸“ä¸šæ˜¾å¡ä¹Ÿæœ‰å¾ˆå¤§çš„å½±å“ã€‚æ˜¾å¡çš„å‘å±•ä¸ä»…ä»…è¦è€ƒè™‘OpenGLï¼Œæ›´è¦è€ƒè™‘D3Dã€‚D3Dæ˜¯å¾®è½¯çš„ï¼Œæ“ä½œç³»ç»Ÿæ˜¯å¾®è½¯çš„ï¼ŒWindowså„æ–­æ“ä½œç³»ç»Ÿçš„å­˜åœ¨ï¼Œå¯¹D3Dæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ”¯æŒã€‚å…¬å¸å†³å®šè½¯ä»¶ï¼Œè½¯ä»¶å†³å®šç¡¬ä»¶åˆä¸€æ¬¡å¾—åˆ°ä½“ç°ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139865.png" alt="img"></p>
<h3 id="4-1-5ã€Video-Logic"><a href="#4-1-5ã€Video-Logic" class="headerlink" title="4.1.5ã€Video Logic"></a>4.1.5ã€Video Logic</h3><p>â€‹    Video Logicå‰æœŸä¸»æ‰“äº§å“æ˜¯PowerVRï¼Œå½“å¹´PowerVRä¹Ÿæ¶‰è¶³æ¡Œé¢æ˜¾å¡å¸‚åœºï¼Œæ¯”è¾ƒæœ‰åçš„å°±æ˜¯PCX2èŠ¯ç‰‡ï¼Œæ€§èƒ½å¼ºå¤§ï¼Œæ”¯æŒD3Dã€OpenGLï¼Œç„¶è€Œé©±åŠ¨ç¨‹åºå…¼å®¹æ€§è¾ƒå·®ï¼Œæ¸¸æˆè¿è¡Œæœ‰é—®é¢˜ï¼Œå¯¹CPUè¦æ±‚è¾ƒé«˜ï¼Œå½±å“äº†é”€å”®ã€‚å³ä½¿å¦‚æ­¤ï¼Œåœ¨å¾ˆé•¿æ—¶é—´å†…ï¼Œå¸‚åœºå æœ‰ç‡ä¸€ç›´ä¿æŒç¬¬äºŒã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139862.png" alt="img"></p>
<p>â€‹    å¯¹å›¾å½¢å›¾åƒå¼•æ“çš„æ”¯æŒã€é©±åŠ¨çš„å‹å¥½ç¨‹åº¦å†³å®šäº†ç¡¬ä»¶çš„å‘å±•ã€‚åæœŸç”±äºä¼˜åŒ–ä¸å¥½ï¼Œå…¼å®¹æ€§é—®é¢˜ã€è½¯ä»¶å†²çªç­‰ï¼Œå®¹æ˜“å¼•èµ·æ¸²æŸ“é”™è¯¯æˆ–æ€§èƒ½ä¸‹é™ã€‚ç¦»ä¸å¼€æœ€ç»ˆè¢«è½¬å–çš„å‘½è¿ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139912.png" alt="img"></p>
<p>â€‹    ç›¸æ¯”å¤ªå¤šå‚å•†ï¼ŒPowerVRæ˜¯å¹¸è¿çš„ï¼Œæ¡Œé¢å¸‚åœºå¤±è´¥äº†ï¼Œä½†PowerVRç¿æ™ºçš„è½¬å‘äº†ç§»åŠ¨å›¾å½¢å¸‚åœºï¼Œé¿å…äº†æ¡Œé¢å¸‚åœºçš„æ®‹é…·ç«äº‰ï¼Œå‘æŒ¥äº†è‡ªå·±çš„æŠ€æœ¯ä¼˜åŠ¿ï¼Œç§»åŠ¨ç«¯æˆä¸ºæœªæ¥çš„è¶‹åŠ¿ï¼ŒPowerVRæˆä¸ºç§»åŠ¨æ˜¾ç¤ºé¢†åŸŸçš„é‡è¦åŠ›é‡ã€‚</p>
<p>â€‹    PCç«¯è®¡ç®—æœºå›¾å½¢å­¦å‘å±•çš„åŒæ—¶ï¼Œç§»åŠ¨ç«¯æŠ€æœ¯çš„å…´èµ·ï¼Œç§»åŠ¨ç«¯ç»†åˆ†ä¸“ä¸šæ˜¾ç¤ºèŠ¯ç‰‡çš„å‡ºç°ï¼Œè¿›è€Œå‘å±•æˆä¸ºç‹¬ç«‹çš„é¢†åŸŸï¼Œè®¡ç®—æœºå›¾å½¢å­¦å‘ç²¾ç»†åŒ–å‘å±•ã€‚</p>
<h3 id="4-1-6ã€intel"><a href="#4-1-6ã€intel" class="headerlink" title="4.1.6ã€intel"></a>4.1.6ã€intel</h3><p>â€‹    è‹±ç‰¹å°”æ˜¯ç¾å›½ä¸€å®¶ä»¥ç ”åˆ¶CPUä¸ºä¸»çš„å…¬å¸ï¼Œæ˜¯å…¨çƒæœ€å¤§çš„ä¸ªäººè®¡ç®—æœºé›¶ä»¶å’ŒCPUåˆ¶é€ å•†ï¼Œæˆç«‹äº1968å¹´ï¼Œå…·æœ‰52å¹´äº§å“åˆ›æ–°å’Œå¸‚åœºé¢†å¯¼çš„å†å²ã€‚</p>
<p>â€‹    1971å¹´ï¼Œè‹±ç‰¹å°”æ¨å‡ºäº†å…¨çƒç¬¬ä¸€ä¸ªå¾®å¤„ç†å™¨ã€‚å¾®å¤„ç†å™¨æ‰€å¸¦æ¥çš„è®¡ç®—æœºå’Œäº’è”ç½‘é©å‘½ï¼Œæ”¹å˜äº†æ•´ä¸ªä¸–ç•Œã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139935.png" alt="img"></p>
<p>â€‹    2016å¹´4æœˆï¼Œè‹±ç‰¹å°”æ¨å‡ºå¤„ç†å™¨è‡³å¼º7290Fé‡‡ç”¨äº†å¤šè¾¾72ä¸ªå¤„ç†å™¨æ ¸å¿ƒï¼Œæˆä¸ºè‹±ç‰¹å°”æ ¸å¿ƒæ•°æœ€å¤šçš„å¤„ç†å™¨ã€‚2019å¹´2æœˆï¼Œè‹±ç‰¹å°”æ¨å‡ºè‡³å¼ºé“‚é‡‘9282ï¼Œå®ƒæœ‰112ä¸ªçº¿ç¨‹ï¼Œæ˜¯çº¿ç¨‹æœ€å¤šçš„å¤„ç†å™¨ã€‚</p>
<p>â€‹    2020å¹´7æœˆï¼Œç¦å¸ƒæ–¯2020å…¨çƒå“ç‰Œä»·å€¼100å¼ºå‘å¸ƒï¼Œè‹±ç‰¹å°”æ’åç¬¬12ä½ã€‚9æœˆ3æ—¥ï¼Œè‹±ç‰¹å°”æ¨å‡ºäº†æ–°çš„æç®€ä¸»ä¹‰ Logoã€‚</p>
<p>â€‹    è°ˆåˆ°æ˜¾å¡ï¼Œä¸èƒ½å›é¿intelï¼Œç”±äºç‰¹æ®Šçš„åœ°ä½ï¼Œç›¸æ¯”å…¶å®ƒå‚å•†ï¼Œåœ¨æ˜¾å¡çš„é“è·¯ä¸Šï¼Œèµ°çš„ç›¸å¯¹å¹³ç¨³ä¸è¸å®ã€‚i740å°±æ˜¯Intelæ¨å‡ºçš„ç¬¬ä¸€æ¬¾äº§å“ï¼Œæå¤§çš„æ¨åŠ¨äº†AGPæ ‡å‡†çš„å‘å±•ã€‚</p>
<p>â€‹    intelä¸“æ³¨äºé›†æˆæ˜¾å¡é¢†åŸŸï¼Œä»i740ä¹‹åï¼Œå†ä¹Ÿæ²¡æœ‰æ¨å‡ºè¿‡ç‹¬ç«‹æ˜¾å¡ï¼Œi740æˆäº†Intelç‹¬ç«‹æ˜¾å¡çš„ç»å”±ã€‚çºµç„¶åœ¨æ˜¾å¡é¢†åŸŸæ²¡æœ‰å¤§çš„å»ºæ ‘ï¼Œä½†intelä¸€ç›´åœ¨åšå®ˆã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139916.png" alt="img"></p>
<h3 id="4-1-7ã€AMD"><a href="#4-1-7ã€AMD" class="headerlink" title="4.1.7ã€AMD"></a>4.1.7ã€AMD</h3><p>â€‹    AMDæ˜¾å¡å³ATI(è¢«AMDæ”¶è´­)æ˜¾å¡ï¼Œä¿—ç§°Aå¡ã€‚æ­è½½AMDå…¬å¸çš„æ˜¾ç¤ºèŠ¯ç‰‡ã€‚ä¸NVIDIAé½åï¼ŒåŒä¸ºä¸–ç•Œä¸¤å¤§æ˜¾ç¤ºèŠ¯ç‰‡å‚å•†ä¹‹ä¸€ã€‚ç”±äºæ”¶è´­å…³ç³»ï¼Œåœ¨æœ¬ä¸“é¢˜ä¸­ï¼Œä¸åšè¿‡å¤šè®²è¿°ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139966.png" alt="img"></p>
<p>â€‹    AMDæ˜¯ç›®å‰ä¸šå†…å”¯ä¸€ä¸€ä¸ªå¯ä»¥æä¾›é«˜æ€§èƒ½CPUã€é«˜æ€§èƒ½ç‹¬ç«‹æ˜¾å¡ã€ä¸»æ¿èŠ¯ç‰‡ç»„ä¸‰å¤§ç»„ä»¶çš„åŠå¯¼ä½“å…¬å¸ï¼Œä¸ºæ˜ç¡®å…¶ä¼˜åŠ¿ï¼Œæå‡º3Aå¹³å°æ–°æ ‡å¿—ï¼Œåœ¨ç¬”è®°æœ¬é¢†åŸŸæœ‰â€œAMD VISIONâ€æ ‡å¿—çš„å°±è¡¨ç¤ºè¯¥ç”µè„‘é‡‡ç”¨3Aæ„å»ºæ–¹æ¡ˆã€‚</p>
<p>â€‹    ä»Šå¤©æ˜¾å¡å¸‚åœºï¼Œæ˜¯Aå¡ä¸Nå¡çš„å¤©ä¸‹ï¼Œ19å¹´ç¬¬å››å­£åº¦ï¼ŒAMDå‡ºè´§é‡ç¯æ¯”å¤§å¢22.6%ï¼Œä»½é¢19%ï¼ŒNVIDIAå‡å°‘1.9%ï¼Œä»½é¢18%ï¼ŒIntelå¾®å¢0.2%ï¼Œä»½é¢63%ã€‚ç”±äºè®¡ç®—å°†Intelæ ¸æ˜¾ã€APUç®—åœ¨å†…ï¼ŒNVIDIAå¹¶æ— ä¼˜åŠ¿ã€‚</p>
<p>â€‹    åœ¨ç‹¬æ˜¾æ–¹é¢ï¼ŒAMDå‡ºè´§é‡å æ¯”27%ï¼Œè¾ƒä¸Šå­£åº¦çš„24%å’Œå»å¹´çš„26%å‡æœ‰å¢åŠ ï¼Œä½†NVIDIAä»æ—§ä»¥73%å„æ–­å‰©ä½™å¸‚åœºã€‚ä»Šå¹´ï¼ŒIntel Xeæ¶æ„ç‹¬æ˜¾å°†é¢ä¸–ï¼Œå¯¹ç‹¬æ˜¾æ ¼å±€æœ‰ä¸€å®šå†²å‡»ã€‚</p>
<p>â€‹    AMDæ˜¾å¡ä¸NVIDIAæ˜¾å¡ç›¸æ¯”ï¼Œæœ‰æ›´é«˜çš„åŠŸè€—ä¸æ›´é«˜çš„æ€§èƒ½ã€‚AMDæ˜¾å¡çš„å­å“ç‰Œæœ‰ ATI å’Œ Radeonï¼Œæ˜¾å¡å‹å·ä¼—å¤šã€‚ä»Šå¤©ï¼ŒAMD(ATI)æ˜¾å¡æŠ€æœ¯åšæŒºï¼Œä¾ç„¶è€€çœ¼ã€‚</p>
<h2 id="4-2ã€è½¯ä»¶ä¸ç¡¬ä»¶"><a href="#4-2ã€è½¯ä»¶ä¸ç¡¬ä»¶" class="headerlink" title="4.2ã€è½¯ä»¶ä¸ç¡¬ä»¶"></a>4.2ã€è½¯ä»¶ä¸ç¡¬ä»¶</h2><h3 id="4-2-1ã€æ¥å£ä¸ç¡¬ä»¶"><a href="#4-2-1ã€æ¥å£ä¸ç¡¬ä»¶" class="headerlink" title="4.2.1ã€æ¥å£ä¸ç¡¬ä»¶"></a>4.2.1ã€æ¥å£ä¸ç¡¬ä»¶</h3><p>â€‹    ä¸“ä¸šå›¾å½¢å›¾åƒé¢†åŸŸï¼ŒZç¼“å­˜å’ŒåŒç¼“å­˜ç§°ä¸ºäº†3Då›¾å½¢æŠ€æœ¯çš„æ ‡é…ã€‚åœ¨ä»Šå¤©çš„æµè¡Œå›¾å½¢å›¾åƒAPIé‡Œï¼Œå½“å¹´çš„Zç¼“å†²å’ŒåŒç¼“å†²ï¼Œä»…ä»…æ˜¯ä»Šå¤©å›¾å½¢å›¾åƒå¼•æ“çš„ä¸€ä¸ªå‚æ•°æˆ–è€…ä¸€ä¸ªå‡½æ•°è€Œå·²ï¼Œå‚æ•°å’Œå‡½æ•°çš„èƒŒåï¼Œæ˜¯ç¡¬ä»¶çš„æ”¯æŒã€‚</p>
<p>â€‹    æ˜¾å¡æ’å£æœ‰PCIå’ŒAGPä¸¤ç§ã€‚åœ¨æ•°æ®å¤„ç†ä¸Šï¼Œé€æ¸æ”¯æŒé«˜é€Ÿå’Œå¹¶è¡Œã€‚å…·æœ‰ç€æ›´å¤§çš„ä¼ è¾“é€Ÿç‡ï¼Œæ›´å¤æ‚æ•°æ®çš„å¤„ç†èƒ½åŠ›ã€‚ç¡¬ä»¶æŠ€æœ¯çš„å˜é©æ¨åŠ¨äº†è½¯ä»¶æŠ€æœ¯çš„è¿›æ­¥ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139076.png" alt="img"></p>
<p>â€‹    ä»»ä½•æŠ€æœ¯çš„å‘å±•éƒ½ä¸æ˜¯ä¸€å¸†é£é¡ºçš„ï¼Œæ˜¾ç¤ºæŠ€æœ¯ä¹Ÿä¸ä¾‹å¤–ã€‚æ¯ä¸€æ¬¡æŠ€æœ¯çš„é©æ–°ï¼Œéƒ½å¯èƒ½å¸¦æ¥é©å‘½æ€§çš„å˜åŒ–ã€‚é‚£äº›æ›¾ç»è¢«æ·˜æ±°ã€è¢«è¾¹ç¼˜åŒ–çš„æŠ€æœ¯ï¼Œä¸ºä¸»æµæŠ€æœ¯çš„å‘å±•åšäº†åŠ©æ”»ã€‚åœ¨æ˜¾å¡æŠ€æœ¯å‘å±•è¿‡ç¨‹ä¸­ï¼Œç¡¬ä»¶çš„å‡çº§ï¼Œæ¶æ„çš„æ”¹å˜ï¼Œéƒ½ä»£è¡¨ç€åŠŸèƒ½çš„æå‡ã€‚</p>
<p>â€‹    ä¸‹å›¾ä»å¦å¤–ä¸€ä¸ªè§’åº¦ï¼Œå±•ç°æ˜¾å¡å‘å±•çš„è¿‡ç¨‹ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139165.png" alt="img"></p>
<h3 id="4-2-2ã€3Då¼•æ“"><a href="#4-2-2ã€3Då¼•æ“" class="headerlink" title="4.2.2ã€3Då¼•æ“"></a>4.2.2ã€3Då¼•æ“</h3><p>â€‹    é¥æƒ³å½“å¹´ï¼Œè§†é¢‘ç¼–ç¨‹ä¸»è¦é ä¸“ä¸šå¼•æ“æ¥ä½“ç°ï¼Œå„å®¶å…¬å¸é›„å¿ƒå‹ƒå‹ƒï¼Œå¼€å®—ç«‹æ´¾ï¼Œåœ¨æ•°å®¶å…¬å¸çš„ä¸“ä¸šå›¾å½¢å›¾åƒæ¥å£é‡Œï¼ŒOpenGLå’ŒDirectXæœ€ç»ˆèƒœå‡ºã€‚ä»Šå¤©ï¼Œæ¶ˆè´¹çº§å¸‚åœºä¸»è¦é€šè¿‡OpenGLå’ŒDirectXæ¥ä½“ç°ã€‚</p>
<p>â€‹    å¯æ‚²çš„æ˜¯ï¼Œæ—©æœŸåœ¨linuxä¸Šå¾ˆå°‘æœ‰å›¾å½¢å›¾åƒç¼–ç¨‹çš„å¤„ç†ã€‚ä¸€ç›´åˆ°ä»Šå¤©ï¼Œå›¾å½¢å›¾åƒå·¥ä½œä¸»è¦è¿˜æ˜¯åœ¨Windowså’ŒMacä¸Šè¿›è¡Œã€‚</p>
<p>â€‹    æ—¶å…‰çš„æ²³æµï¼Œæµæ·Œç€ä¸€ä¸ªçœŸç†ï¼Œå¯¹3Dçš„æ”¯æŒï¼Œä»¥åŠå¯¹3Dç›¸å…³å›¾å½¢ç³»ç»Ÿçš„æ”¯æŒï¼Œæ˜¯ç¡¬ä»¶å‚å•†å­˜æ´»çš„æ ¹æœ¬ã€‚è¿™é‡Œçš„3Dæ”¯æŒï¼Œå°±æ˜¯3Då¼•æ“ã€‚</p>
<p>â€‹    å½“å¹´çš„å›¾å½¢å›¾åƒç¼–ç¨‹ï¼ŒOpenGLåˆšåˆšèµ·æ­¥ï¼Œå¾ˆå¤šå…¬å¸æä¾›çš„åº”ç”¨å¼•æ“éƒ½æ˜¯å¯¹OpenGLå’ŒD3Dçš„å°è£…ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139192.png" alt="img"></p>
<h4 id="4-2-2-1ï¼OpenGL"><a href="#4-2-2-1ï¼OpenGL" class="headerlink" title="4.2.2.1ï¼OpenGL"></a>4.2.2.1ï¼OpenGL</h4><p>â€‹    OpenGLæ˜¯æ¸²æŸ“2Dã€3Dæ•°å­—å›¾å½¢çš„è·¨è¯­è¨€ã€è·¨å¹³å°çš„åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰ã€‚ç”±è¿‘350ä¸ªå‡½æ•°ç»„æˆï¼Œç»˜åˆ¶ç®€å•å›¾å½¢å’Œå¤æ‚ä¸‰ç»´æ™¯è±¡ã€‚OpenGLå¸¸ç”¨äºCADã€è™šæ‹Ÿç°å®ã€ç§‘å­¦å¯è§†åŒ–å’Œæ¸¸æˆå¼€å‘ç­‰ã€‚OpenGLç›´æ¥æ“çºµå›¾å½¢ç¡¬ä»¶ï¼Œé«˜æ•ˆè¿›è¡Œå›¾å½¢å›¾åƒç¼–ç¨‹ï¼Œå®ç°ä¸€èˆ¬ç”±æ˜¾ç¤ºè®¾å¤‡å‚å•†æä¾›ã€‚OpenGLæ˜¯å¯¹æ˜¾å¡ç¼–ç¨‹çš„å·¥ä¸šæ¥å£ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139175.png" alt="img"></p>
<p>â€‹    OpenGLè§„èŒƒç”±1992å¹´æˆç«‹çš„OpenGLæ¶æ„è¯„å®¡å§”å‘˜ä¼šï¼ˆARBï¼‰ç»´æŠ¤ã€‚ARBç”±ä¸šç•Œé¡¶çº§è½¯ç¡¬ä»¶å…¬å¸ç»„æˆï¼Œä¸‹å›¾æ˜¯OpenGLçš„å‘å±•è¿‡ç¨‹ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139161.png" alt="img"></p>
<p>â€‹    OpenGL APIå®šä¹‰äº†è‹¥å¹²è¢«å®¢æˆ·ç«¯ç¨‹åºè°ƒç”¨çš„å‡½æ•°ï¼Œä»¥åŠä¸€äº›æ•´å‹å¸¸é‡ã€‚è¿™äº›å®ç°æ–¹ä¾¿äº†å¼€å‘è€…è°ƒç”¨ã€‚</p>
<p>â€‹    OpenGLä¸è¯­è¨€å¹³å°æ— å…³ã€‚è§„èŒƒæ²¡æœ‰è·å¾—å’Œç®¡ç†OpenGLä¸Šä¸‹æ–‡ç›¸å…³çš„å†…å®¹ï¼Œå°†è¿™äº›ç»†èŠ‚äº¤ç»™åº•å±‚çª—å£ç³»ç»Ÿã€‚OpenGLä¸“æ³¨å›¾åƒæ¸²æŸ“ï¼Œä¸æä¾›è¾“å…¥ã€éŸ³é¢‘åŠçª—å£ç›¸å…³çš„APIã€‚</p>
<p>â€‹    OpenGLä¸æ–­è¿›åŒ–APIã€‚æ–°ç‰ˆè§„èŒƒå®šæœŸç”±Khronos Groupå‘å¸ƒï¼Œæ–°ç‰ˆæœ¬é€šè¿‡æ‰©å±•APIæ¥æ”¯æŒå„ç§æ–°åŠŸèƒ½ã€‚æ¯ä¸ªç‰ˆæœ¬ç»†èŠ‚ç”±Khronos Groupæˆå‘˜ä¸€è‡´å†³å®šï¼ŒåŒ…æ‹¬æ˜¾å¡å‚å•†ã€æ“ä½œç³»ç»Ÿè®¾è®¡äººå‘˜ä»¥åŠç±»ä¼¼Mozillaå’Œè°·æ­Œçš„æŠ€æœ¯æ€§å…¬å¸ã€‚</p>
<p>â€‹    é™¤äº†æ ¸å¿ƒAPIåŠŸèƒ½ï¼ŒGPUä¾›åº”å•†é€šè¿‡æ‰©å±•çš„å½¢å¼æä¾›é¢å¤–åŠŸèƒ½ã€‚æ‰©å±•å¼•å…¥æ–°åŠŸèƒ½å’Œæ–°å¸¸é‡ï¼Œå¢åŠ æˆ–å–æ¶ˆç°æœ‰OpenGLåŠŸèƒ½ã€‚</p>
<p>â€‹    æ¯ä¸ªæ‰©å±•ä¸ä¸€ä¸ªæ ‡è¯†ç¬¦è”ç³»ï¼Œæ ‡è¯†ç¬¦åŸºäºå¼€å‘å…¬å¸çš„åç§°ã€‚ä¾‹å¦‚ï¼Œè‹±ä¼Ÿè¾¾ï¼ˆnVidiaï¼‰çš„æ ‡è¯†ç¬¦æ˜¯NVã€‚å¦‚æœå¤šä¸ªä¾›åº”å•†åŒæ„ä½¿ç”¨ç›¸åŒçš„APIæ¥å®ç°ç›¸åŒåŠŸèƒ½ï¼Œé‚£ä¹ˆå°±ç”¨EXTæ ‡å¿—ç¬¦ã€‚è¿™ç§æƒ…å†µæ›´è¿›ä¸€æ­¥ï¼ŒKhronos Groupçš„æ¶æ„è¯„å®¡å§”å‘˜ï¼ˆArchitecture Review Boardï¼ŒARBï¼‰æ­£å¼æ‰¹å‡†è¯¥æ‰©å±•ï¼Œé‚£ä¹ˆå°±è¢«ç§°ä¸ºä¸€ä¸ªâ€œæ ‡å‡†æ‰©å±•â€ï¼Œæ ‡è¯†ç¬¦ä½¿ç”¨ARBã€‚ç¬¬ä¸€ä¸ªARBæ‰©å±•æ˜¯GL_ARB_multitextureã€‚</p>
<p>â€‹    OpenGLæ¯ä¸ªæ–°ç‰ˆæœ¬ä¸­å¼•å…¥çš„åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯ARBå’ŒEXTç±»å‹çš„æ‰©å±•ï¼Œé€šå¸¸ç”±æ•°ä¸ªè¢«å¹¿æ³›å®ç°çš„æ‰©å±•åŠŸèƒ½ç»„åˆè€Œæˆã€‚</p>
<p>â€‹    ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;GLToolsã€‚h&gt;             // OpenGL toolkit</span><br><span class="line">#include &lt;GLShaderManagerã€‚h&gt;    // Shader Manager Class</span><br><span class="line"></span><br><span class="line">GLBatch	triangleBatch;</span><br><span class="line">GLShaderManager	shaderManager;</span><br><span class="line"></span><br><span class="line">void ChangeSize(int wï¼Œ int h);</span><br><span class="line">void SetupRC();</span><br><span class="line">void RenderScene(void);</span><br><span class="line">gltSetWorkingDirectory(argv[0]);</span><br><span class="line">glutInit(&amp;argcï¼Œ argv);</span><br><span class="line">glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGBA | GLUT_DEPTH | GLUT_STENCIL);</span><br><span class="line">glutInitWindowSize(800ï¼Œ 600);</span><br><span class="line">glutCreateWindow(&quot;Triangle&quot;);</span><br><span class="line">glutReshapeFunc(ChangeSize);</span><br><span class="line">glutDisplayFunc(RenderScene);</span><br><span class="line"></span><br><span class="line">SetupRC();</span><br><span class="line">glutMainLoop();</span><br></pre></td></tr></table></figure>

<h4 id="4-2-2-2ã€DirectX"><a href="#4-2-2-2ã€DirectX" class="headerlink" title="4.2.2.2ã€DirectX"></a>4.2.2.2ã€DirectX</h4><p>â€‹    å¾®è½¯åœ¨ä¸šç•Œçš„å¤§å“¥åœ°ä½ï¼Œå½±å“åŠ›ä¸è¨€è€Œå–»ã€‚åœ¨å‘å±•å²ä¸Šï¼Œå¤šæ¬¡å’ŒIBMå¯¹åšå…¬å ‚ï¼Œå¾®è½¯å®£å¸ƒï¼Œå‡¡æ˜¯IBMçš„ç”µè„‘ï¼Œä¸èƒ½å®‰è£…Windowsæ“ä½œç³»ç»Ÿã€‚è½¯ä»¶å‚å•†è¦æŒŸç¡¬ä»¶å‚å•†ï¼Œåœ¨å¾®è½¯å‘å±•å†å²ä¸Šï¼Œç•™ä¸‹äº†å…‰è¾‰çš„ä¸€é¡µã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139171.png" alt="img"></p>
<p>â€‹    éŸ³è§†é¢‘æ˜¯ç”µè„‘æœ€æ ¸å¿ƒçš„åŠŸèƒ½ä¹‹ä¸€ï¼Œä½œä¸ºç³»ç»Ÿä¾›åº”å•†ï¼Œå¾®è½¯æ¨å‡ºäº†è‡ªå·±çš„DirectXäº§å“ï¼Œè¯¥äº§å“åœ¨1995å¹´å‰ååå‡ å¹´é—´ï¼Œå†³å®šäº†å¾ˆå¤šç¡¬ä»¶å‚å•†çš„ç”Ÿæ­»ã€‚</p>
<p>â€‹    ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#pragma comment(libï¼Œ&quot;d3d9.lib&quot;)</span><br><span class="line">#pragma comment(libï¼Œ&quot;d3dx9.lib&quot;)</span><br><span class="line">#include &lt;d3dx9ã€‚h&gt;</span><br><span class="line">LPDIRECT3D9 g_pD3D = NULL;</span><br><span class="line">LPDIRECT3DDEVICE9 g_pD3DDevice = NULL;</span><br><span class="line">LPDIRECT3DVERTEXBUFFER9 g_pVertexBuffer = NULL; </span><br><span class="line"></span><br><span class="line">HRESULT InitialiseD3D(HWND hWnd)</span><br><span class="line">HRESULT InitialiseVertexBuffer()</span><br><span class="line">void SetupRotation()</span><br><span class="line">void SetupCamera()</span><br><span class="line">void SetupPerspective()</span><br><span class="line">void Render()</span><br><span class="line">void CleanUp()</span><br></pre></td></tr></table></figure>

<p>â€‹    å½“æˆ‘ä»¬å¹³å¿ƒé™æ°”é¢å¯¹è¿™äº›æŠ€æœ¯å’Œä»£ç æ—¶ï¼Œæ·±åˆ»çš„æ„Ÿå—åˆ°ï¼Œå°¤å…¶åœ¨æ—©æœŸï¼Œå½“å¹´çš„D3DæŠ€æœ¯å¯¹æ˜¾å¡å‚å®¶çš„å½±å“æ˜¯å¯æ€•çš„ï¼Œå¯¹D3DæŠ€æœ¯çš„æ”¯æŒç¨‹åº¦ä»£è¡¨äº†æ˜¾å¡çš„å—æ¬¢è¿ç¨‹åº¦ã€‚å½“å¹´çš„D3DæŠ€æœ¯åº”ç”¨æœ€ä¸»è¦æ˜¯æ¸¸æˆé¢†åŸŸã€‚</p>
<p>â€‹    ä»D3Dçš„å‘å±•ï¼Œå¾—åˆ°å²æœˆçš„å¯ç¤ºï¼Œå„æ–­é˜»ç¢äº†æŠ€æœ¯çš„å‘å±•ï¼Œç›¸ä¿¡åœ¨æŸä¸€å¤©ï¼ŒD3Dä¹Ÿç»ˆç©¶ä¼šé€€å‡ºæŠ€æœ¯çš„èˆå°ã€‚</p>
<h3 id="4-2-3ã€Shaderç¼–ç¨‹"><a href="#4-2-3ã€Shaderç¼–ç¨‹" class="headerlink" title="4.2.3ã€Shaderç¼–ç¨‹"></a>4.2.3ã€Shaderç¼–ç¨‹</h3><p>â€‹    Shaderåœ¨3Dç¼–ç¨‹é‡Œé¢å æ®ç€é‡è¦çš„åœ°ä½ï¼Œæ˜¯OpenGLã€DirectXã€Unityç­‰å¼•æ“ä¸­æœ€æ ¸å¿ƒçš„æ¦‚å¿µã€‚æˆäº†3Då›¾å½¢å›¾åƒç¼–ç¨‹çš„æ ¸å¿ƒæ ‡é…ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139313.png" alt="img"></p>
<p>â€‹    ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#version 130</span><br><span class="line">in vec4 vVertex;</span><br><span class="line">in vec3 vNormal;</span><br><span class="line"></span><br><span class="line">uniform vec4    ambientColor;</span><br><span class="line">uniform vec4    diffuseColor;	</span><br><span class="line">uniform vec4    specularColor;</span><br><span class="line">uniform vec3	   vLightPosition;</span><br><span class="line">uniform mat4	   mvpMatrix;</span><br><span class="line">uniform mat4	   mvMatrix;</span><br><span class="line">uniform mat3	   normalMatrix;</span><br><span class="line">smooth out vec4 vVaryingColor;</span><br><span class="line"></span><br><span class="line">void main(void) </span><br><span class="line">&#123; </span><br><span class="line">    vec3 vEyeNormal = normalMatrix * vNormal;</span><br><span class="line">    vec4 vPosition4 = mvMatrix * vVertex;</span><br><span class="line">    vec3 vPosition3 = vPosition4ã€‚xyz / vPosition4ã€‚w;</span><br><span class="line">    vec3 vLightDir = normalize(vLightPosition - vPosition3);</span><br><span class="line">    float diff = max(0ã€‚0ï¼Œ dot(vEyeNormalï¼Œ vLightDir));</span><br><span class="line">    vVaryingColor = diff * diffuseColor;</span><br><span class="line">    vVaryingColor += ambientColor;</span><br><span class="line">    vec3 vReflection = normalize(reflect(-vLightDirï¼Œ vEyeNormal));</span><br><span class="line">    float spec = max(0ã€‚0ï¼Œ dot(vEyeNormalï¼Œ vReflection));</span><br><span class="line">if(diff != 0) </span><br><span class="line">&#123;</span><br><span class="line">        float fSpec = pow(specï¼Œ 128ã€‚0);</span><br><span class="line">        vVaryingColorã€‚rgb += vec3(fSpecï¼Œ fSpecï¼Œ fSpec);</span><br><span class="line">	&#125;</span><br><span class="line">    gl_Position = mvpMatrix * vVertex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-2-1ã€Metal"><a href="#4-2-2-1ã€Metal" class="headerlink" title="4.2.2.1ã€Metal"></a>4.2.2.1ã€Metal</h4><p>â€‹    Metalæ˜¯è‹¹æœå…¬å¸çš„å›¾å½¢ç¼–ç¨‹åº“ï¼Œè¿‘ä¸¤å¹´å–å¾—äº†å·¨å¤§çš„å‘å±•ã€‚åœ¨Macå¹³å°å’ŒIOSå¹³å°éŸ³è§†é¢‘å¼€å‘ä¸Šï¼ŒMetalæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139423.png" alt="img"></p>
<p>â€‹    Metalæä¾›å¯¹GPUçš„ç›´æ¥è®¿é—®ï¼ŒæŠ€æœ¯äººå‘˜æœ€å¤§ç¨‹åº¦åœ°å‘æŒ¥ iOSã€macOSå’ŒApple tvOS appä¸­çš„å›¾å½¢ç¡¬ä»¶è®¡ç®—æ½œèƒ½ã€‚Metalæ„å»ºäºæ˜“ç”¨çš„ä½å¼€é”€æ¶æ„ä¹‹ä¸Šï¼Œæä¾›é¢„ç¼–è¯‘çš„GPU ç€è‰²å™¨å’Œç²¾ç»†çš„èµ„æºæ§åˆ¶ã€‚</p>
<p>â€‹    Metalæ”¯æŒå¤šçº¿ç¨‹ï¼Œæ”¯æŒ GPU é©±åŠ¨å‘½ä»¤åˆ›å»ºã€‚æ”¯æŒGPUé˜µåˆ—ç¼–ç¨‹ï¼Œå……åˆ†åˆ©ç”¨ Mac Pro å’Œ Pro Display XDR çš„ä¸“ä¸šçº§å¤šåª’ä½“åŠŸèƒ½ã€‚</p>
<p>â€‹    æ¸²æŸ“ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#import &quot;Renderer.h&quot;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    float red, green , blue, alpha;</span><br><span class="line">&#125;Color;</span><br><span class="line"></span><br><span class="line">@implementation Renderer</span><br><span class="line">&#123;</span><br><span class="line">    id&lt;MTLDevice&gt; _device;</span><br><span class="line">    id&lt;MTLCommandQueue&gt; _commandQueue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ç”»viewçš„å†…å®¹ï¼Œè¿™ä¸ªä»£ç†æ–¹æ³•ä¼šæŒ‰å¸§ç‡æ‰§è¡Œ</span><br><span class="line">-(void)drawInMTKView:(MTKView *)view&#123;</span><br><span class="line">    //è·å–é¢œè‰²</span><br><span class="line">    Color color = [self makeFancyColor];</span><br><span class="line">    //è®¾ç½®èƒŒæ™¯è‰²</span><br><span class="line">    view.clearColor = MTLClearColorMake(color.red, color.green, color.blue, color.alpha);</span><br><span class="line">    </span><br><span class="line">    //åˆ›å»ºä¸€ä¸ªå‘½ä»¤ç¼“å†²åŒº</span><br><span class="line">    id&lt;MTLCommandBuffer&gt; commandBuffer = [_commandQueue commandBuffer];</span><br><span class="line">    commandBuffer.label = @&quot;mycommand&quot;;</span><br><span class="line">    </span><br><span class="line">    //æ¸²æŸ“è¿‡ç¨‹ï¼Œç”¨äºä¿å­˜æ¸²æŸ“è¿‡ç¨‹çš„ç»“æœ</span><br><span class="line">    MTLRenderPassDescriptor *renderPassDescriptor = view.currentRenderPassDescriptor;</span><br><span class="line">    </span><br><span class="line">    if (renderPassDescriptor != nil) &#123;</span><br><span class="line">        id&lt;MTLRenderCommandEncoder&gt; renderEncoder = [commandBuffer renderCommandEncoderWithDescriptor:renderPassDescriptor];</span><br><span class="line">        renderEncoder.label = @&quot;myrenderEncoder&quot;;</span><br><span class="line">        </span><br><span class="line">        //ç»“æŸç¼–ç </span><br><span class="line">        [renderEncoder endEncoding];</span><br><span class="line">        </span><br><span class="line">        //æ³¨å†Œä¸€ä¸ªå¯ç»˜åˆ¶å›¾åƒ</span><br><span class="line">        [commandBuffer presentDrawable:view.currentDrawable];</span><br><span class="line">    &#125;</span><br><span class="line">    //æäº¤å‘½ä»¤åˆ°GPU</span><br><span class="line">    [commandBuffer commit];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//è§†å£å‘ç”Ÿå˜åŒ–ä¼šè¢«è°ƒç”¨</span><br><span class="line">- (void)mtkView:(nonnull MTKView *)view drawableSizeWillChange:(CGSize)size &#123;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<h4 id="4-2-2-2ã€Vulkan"><a href="#4-2-2-2ã€Vulkan" class="headerlink" title="4.2.2.2ã€Vulkan"></a>4.2.2.2ã€Vulkan</h4><p>â€‹    Vulkanæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„2Då’Œ3Dç»˜å›¾åº”ç”¨ç¨‹åºæ¥å£ï¼ˆAPIï¼‰ï¼Œç§‘çº³æ–¯ç»„ç»‡ï¼ˆKhronos Groupï¼‰åœ¨2015å¹´æ¸¸æˆå¼€å‘è€…å¤§ä¼šï¼ˆGDCï¼‰ä¸Šå‘å¸ƒã€‚</p>
<p>â€‹    Khronos Groupç›®å‰æ˜¯ä¸–ç•Œå¤šåª’ä½“ã€éŸ³è§†é¢‘ã€å›¾å½¢å›¾åƒé¢†åŸŸçš„æ ¸å¿ƒåä¼šï¼Œæ‹¥æœ‰ä¸–ç•Œé¡¶çº§ä¼šå‘˜å•å…ƒï¼Œæ‹¥æœ‰ä¸–ç•Œçº§çš„æŠ€æœ¯æ ‡å‡†ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139417.png" alt="img"></p>
<p>â€‹    ç§‘çº³æ–¯æŠŠVulkan APIç§°ä¸ºâ€œä¸‹ä¸€ä»£OpenGLè¡ŒåŠ¨â€ï¼ˆnext generation OpenGL initiativeï¼‰æˆ–â€œglNextâ€ã€‚å°±åƒOpenGLï¼ŒVulkané’ˆå¯¹å®æ—¶3Dç¨‹åºï¼ˆå¦‚ç”µå­æ¸¸æˆï¼‰è®¾è®¡ï¼ŒVulkanå¹¶è®¡åˆ’æä¾›é«˜æ€§èƒ½å’Œä½CPUç®¡ç†è´Ÿæ‹…ï¼ˆoverheadï¼‰ï¼Œè¿™ä¹Ÿæ˜¯Direct3D12å’ŒAMDçš„Mantleçš„ç›®æ ‡ã€‚Vulkanå…¼å®¹Mantleçš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå¹¶ä½¿ç”¨äº†Mantleçš„ä¸€äº›ç»„ä»¶ã€‚</p>
<p>â€‹    Vulkan æ˜¯ AMD Mantle çš„åç»­ç‰ˆæœ¬ï¼Œç»§æ‰¿äº†å¼ºå¤§çš„ä½å¼€é”€æ¶æ„ï¼Œä½¿è½¯ä»¶å¼€å‘èƒ½å¤Ÿå…¨é¢è·å– Radeo GPU ä¸å¤šæ ¸ CPU çš„æ€§èƒ½ã€æ•ˆç‡å’ŒåŠŸèƒ½ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139433.png" alt="img"></p>
<p>â€‹    Vulkan æ”¯æŒæ·±å…¥ç¡¬ä»¶åº•å±‚çš„æ§åˆ¶ï¼Œä¸ºå„ç§ç³»ç»Ÿå¸¦æ¥æ›´å¿«çš„æ€§èƒ½å’Œæ›´é«˜çš„å½±åƒè´¨é‡ã€‚Vulkan API è¿˜æä¾›è¶…é«˜çš„ OS å…¼å®¹æ€§ã€æ¸²æŸ“ç‰¹æ€§å’Œç¡¬ä»¶æ•ˆç‡ã€‚</p>
<p>â€‹    åŸºäºGCNæ¶æ„çš„Radeon æ˜¾å¡æ‹¥æœ‰å¼ºå¤§çš„â€œå¼‚æ­¥è®¡ç®—â€åŠŸèƒ½ï¼Œä½¿æ˜¾å¡å¹¶è¡Œå¤„ç†3Då‡ ä½•å›¾å½¢ä¸è®¡ç®—å·¥ä½œé‡ã€‚å½“æ¸¸æˆéœ€è¦åŒæ—¶è®¡ç®—å¤æ‚ç…§æ˜ä¸æ¸²æŸ“äººç‰©æ—¶ï¼Œè¿™ç§åŠŸèƒ½å°±æ‰¾åˆ°äº†ç”¨æ­¦ä¹‹åœ°ã€‚è¿™äº›ä»»åŠ¡å¹¶ä¸éœ€è¦åœ¨Radeonæ˜¾å¡ä¸Šä¸²è¡Œè¿è¡Œï¼ŒèŠ‚çº¦æ—¶é—´ã€æå‡æ•´ä½“å¸§é€Ÿç‡ã€‚Vulkanåœ¨è¿‘æœŸWindowså’ŒLinuxç³»ç»Ÿä¸Šéƒ½æœ‰å¾ˆå¥½çš„åº”ç”¨ã€‚</p>
<p>â€‹    ç›®å‰ï¼ŒVulkanå¾—åˆ°å¹¿æ³›çš„çš„æ”¯æŒï¼Œåœ¨ç¡¬ä»¶ä¸Šï¼Œæ— è®ºæ˜¯æœåŠ¡å™¨ã€æ¡Œé¢ã€ç§»åŠ¨ç«¯ï¼Œéƒ½è¿›è¡Œäº†å®Œå¥½çš„æ”¯æŒã€‚åœ¨ç³»ç»Ÿå±‚é¢ä¸Šï¼ŒLinuxã€Windowsã€Macã€Androidã€IOSéƒ½ä¸ºVulkanæä¾›äº†å®Œå¤‡çš„æ¥å£ã€‚</p>
<p>â€‹    ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;vulkan/vulkan.h&gt;</span><br><span class="line">#include &lt;stdexcept&gt;</span><br><span class="line">#include &lt;functional&gt;</span><br><span class="line"></span><br><span class="line">class HelloTriangleApplication </span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">void run() </span><br><span class="line">&#123;</span><br><span class="line">        initVulkan();</span><br><span class="line">        mainLoop();</span><br><span class="line">        cleanup();</span><br><span class="line">    &#125;</span><br><span class="line">private:</span><br><span class="line">void initVulkan() &#123;&#125;</span><br><span class="line">void mainLoop() &#123;&#125;</span><br><span class="line">void cleanup() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">int main() </span><br><span class="line">&#123;</span><br><span class="line">    HelloTriangleApplication app;</span><br><span class="line">try </span><br><span class="line">&#123;</span><br><span class="line">        app.run();</span><br><span class="line">&#125;</span><br><span class="line">catch (const std::runtime_error&amp; e) </span><br><span class="line">&#123;</span><br><span class="line">        std::cerr &lt;&lt; e.what() &lt;&lt; std::endl;</span><br><span class="line">        return EXIT_FAILURE;</span><br><span class="line">    &#125;</span><br><span class="line">    return EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-3ã€å¯ç¤º"><a href="#4-3ã€å¯ç¤º" class="headerlink" title="4.3ã€å¯ç¤º"></a>4.3ã€å¯ç¤º</h2><p>â€‹    è®¡ç®—æœºå›¾å½¢å­¦çš„å‘å±•ä¸æ˜¯ä¸€è¹´è€Œå°±çš„ï¼Œå‰æœŸå‘å±•è¿‡ç¨‹ä¸­ï¼Œç™¾èŠ±é½æ”¾ï¼Œç™¾å®¶äº‰é¸£ã€‚å„å®¶æ¥å£ä¸ä¸€ï¼Œå¤„äºè“¬å‹ƒä¸ç¨³å®šå‘å±•æœŸï¼Œç³»ç»Ÿå‚å•†ã€ç¡¬ä»¶å‚å•†ã€è½¯ä»¶å‚å•†ã€è¡Œä¸šåä¼šä¸€èµ·ï¼Œå…±åŒæ¨å‡ºè½¯ç¡¬ä»¶è§„èŒƒï¼ŒOpenGLå°±æ˜¯ä¸€ä¸ªæˆåŠŸçš„è¡¨ç°ã€‚</p>
<p>â€‹    æŠ€æœ¯å‘å±•è¿‡ç¨‹ä¸­ï¼Œä¸€äº›å‚å•†æ²¡æœ‰æ˜ç¡®çš„è§„èŒƒæˆ–æ²¡æœ‰æ˜ç¡®çš„æ”¯æŒè§„èŒƒï¼Œè¿›è€Œå¤±è´¥äº†ã€‚æ²¡æœ‰ç¡¬ä»¶å‚å•†æ”¯æŒçš„è§„èŒƒåŒæ ·æ˜¯å¯æ‚²çš„ï¼Œå¾ˆå¿«è¢«æ·˜æ±°äº†ã€‚è½¯ä»¶è¿è¡Œåœ¨ç¡¬ä»¶ä¹‹ä¸Šï¼Œç¡¬ä»¶åœ¨ä¸€å®šç¨‹åº¦ä¸Šå†³å®šç€è½¯ä»¶ã€‚è½¯ä»¶åè¿‡æ¥å½±å“ç€ç¡¬ä»¶ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192139426.png" alt="img"></p>
<p>â€‹    3Dæ—¶ä»£ç»šä¸½å¤šå½©ï¼Œç°å®ç”Ÿæ´»å§¹ç´«å«£çº¢ï¼Œå¤šå¹´æŠ€æœ¯ç§¯æ·€ï¼Œåœ¨3Dæ—¶ä»£äº”å½©æ–‘æ–“ï¼Œåº”ç”¨è¾ˆå‡ºã€‚æ˜¾ç¤ºæŠ€æœ¯çš„åº”ç”¨å‘æŒ¥åˆ°äº†æè‡´ï¼Œå¯¹è®¡ç®—æŠ€æœ¯çš„å‘å±•åšå‡ºäº†å“è¶Šçš„è´¡çŒ®ã€‚</p>
<p>â€‹    3Dæ—¶ä»£çš„åˆ°æ¥ï¼Œä¸ºæ˜¾ç¤ºæŠ€æœ¯çš„ç²¾ç»†åŒ–å‘å±•å¹å“äº†å·è§’ã€‚åœ¨è®¡ç®—æœºå›¾å½¢å›¾åƒæŠ€æœ¯å‘å±•å²ä¸Šï¼Œæ‰¿å‰å¯åï¼Œç»§å¾€å¼€æ¥ã€‚</p>
<h1 id="5ã€ç§»åŠ¨æ—¶ä»£"><a href="#5ã€ç§»åŠ¨æ—¶ä»£" class="headerlink" title="5ã€ç§»åŠ¨æ—¶ä»£"></a>5ã€ç§»åŠ¨æ—¶ä»£</h1><p>â€‹    ç§»åŠ¨æ—¶ä»£å¯ä»¥è¿½è¸ªåˆ°å¾ˆè¿œï¼Œä»å¤è€çš„ç”µå°åˆ°1948å¹´è´å°”å®éªŒå®¤çš„Bell boyï¼Œåˆ°1956å¹´æ‘©æ‰˜ç½—æ‹‰çš„BPæœºã€‚å¯»å‘¼æœºçš„å‘å±•å†å²ï¼Œä¸»è¦æ˜¯é€šè®¯æŠ€æœ¯çš„è¿›æ­¥ã€‚å’Œä¸»é¢˜æœ‰ä¸€å®šåå·®ï¼Œä¸åšé˜è¿°ã€‚ç¿»å¼€åŠä¸ªå¤šä¸–çºªçš„ç”»å·ï¼Œå†å²æ²¡æœ‰æƒ³åˆ°çš„æ˜¯ï¼Œé€šè®¯æŠ€æœ¯åœ¨ä»Šå¤©æœ‰å¦‚æ­¤å‚²å¨‡çš„æˆç»©ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146034.png" alt="img"></p>
<p>â€‹    æ—©æœŸç”µè„‘è‡³ä¸Šï¼Œåæ¥ç§»åŠ¨è‡³ä¸Šã€‚ä¸å¯æ€€ç–‘çš„æ˜¯ï¼Œç§»åŠ¨äº’è”ç½‘é«˜é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œæ‰‹æœºæˆä¸ºåº”ç”¨ç³»ç»Ÿæœ€é‡è¦çš„ç»ˆç«¯ã€‚</p>
<p>â€‹    ç§»åŠ¨ç«¯å›¾å½¢ç³»ç»Ÿçš„ç ”ç©¶ï¼Œæ˜¯ç§»åŠ¨åº”ç”¨ç»ˆç«¯å¼€å‘çš„é‡ä¸­ä¹‹é‡ï¼Œä¹Ÿæ˜¯æ‰‹æœºåº•å±‚æŠ€æœ¯çš„æ ¸å¿ƒè¦ç´ ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146054.png" alt="img"></p>
<p>â€‹    æœ¬ç¯‡ä»æ‰‹æœºå‘å±•å²èµ·ç¬”ï¼Œåˆ°ç§»åŠ¨æ˜¾ç¤ºèŠ¯ç‰‡å‚å®¶ã€ç§»åŠ¨èŠ¯ç‰‡æŠ€æœ¯ä¸æµè¡Œå›¾å½¢åº“è®²è¿°ï¼Œå¸Œæœ›ç»™ç§»åŠ¨ç«¯éŸ³è§†é¢‘å¼€å‘å¸¦æ¥æœ‰ç›Šçš„å¯ç¤ºã€‚</p>
<h2 id="5-1ã€æ‰‹æœºæ—¶ä»£"><a href="#5-1ã€æ‰‹æœºæ—¶ä»£" class="headerlink" title="5.1ã€æ‰‹æœºæ—¶ä»£"></a>5.1ã€æ‰‹æœºæ—¶ä»£</h2><p>â€‹    é‚£å¹´çš„â€œhello motoâ€ï¼Œèƒ½å¦å‹¾èµ·ä½ ç»µç»µçš„æƒ…æ€ã€‚è¿™é¢—åœ†åœ†çš„è¡Œæ˜Ÿï¼Œâ€hello motoâ€ä¹‹å£°å¥å“äº†é“¶æ²³ç³»æ— çº¿é€šè®¯çš„å·è§’ã€‚é‚£ä¸ªå¹´ä»£æ‰‹æç”µè¯(ä¹Ÿå«ç§»åŠ¨ç”µè¯)ï¼Œè¿˜ä¸å«æ‰‹æœºï¼Œç»°å·å¤§å“¥å¤§ï¼Œä¹Ÿå«æ¿ç –ã€‚å½“å¹´çš„å¤§å“¥å¤§ä»…ä»…å±€é™é€šè¯ï¼ŒçŸ­ä¿¡åŠŸèƒ½ä¹Ÿä¸å…·å¤‡ã€‚æœ‰äº†å¤§å“¥å¤§ï¼Œä¸å­¦æ•°ç†åŒ–ï¼Œå¤§å“¥å¤§æˆä¸ºäº†èº«ä»½çš„è±¡å¾ã€‚</p>
<p>â€‹    ç¡¬ä»¶æŠ€æœ¯çš„è¿›æ­¥ï¼Œæ‰‹æœºå‘å°å‹åŒ–å‘å±•ã€‚ä¸¤ä¸ªä¼ä¸šçš„é«˜å…‰æ—¶åˆ»å¸¦æ¥äº†ï¼Œå½“å¹´çš„æ‘©æ‰˜ç½—æ‹‰å’Œè¯ºåŸºäºšå ªç§°ä¸šç•Œå¤§å“¥ï¼Œèµšé’±èµšåˆ°ç½—é©¬ã€‚ä»æ—©æœŸçš„å•è‰²å±é€æ¸å‘å±•åˆ°å½©è‰²å±ã€‚ä»1990å¹´åˆ°2005å¹´ï¼Œé‚£æ˜¯è¯ºåŸºäºšå’Œæ‘©æ‰˜ç½—æ‹‰çš„æ—¶ä»£ã€‚æ˜¨æ—¥å¹´å°‘è‹±é›„ï¼ŒæŒ‡ç‚¹æ±Ÿå±±ï¼Œä»Šå¤©è‹±é›„ç™½å‘ï¼Œç¾äººè°¢å¹•ã€‚äº’è”ç½‘ç»™æˆ‘ä»¬å¤šå°‘å”å˜˜ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146040.png" alt="img"></p>
<p>â€‹    å·¥è‰ºçš„æå‡ä¸ä»…æ¨åŠ¨ç¡¬ä»¶è®¾è®¡çš„è¿›æ­¥ï¼Œæ›´æ¨åŠ¨è½¯ä»¶ç³»ç»Ÿçš„å‘å±•ï¼Œæ‰‹æœºåº”è¯¥æ‹¥æœ‰æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚åœ¨è¿™ä¸€å¤§ç¯å¢ƒä¸‹ï¼ŒSmartPhoneã€Symbianã€Linuxæ‰‹æœºæ“ä½œç³»ç»Ÿä¸æ–­æ¶Œç°ï¼Œä¸ºæ™ºèƒ½æ‰‹æœºç³»ç»Ÿå‘å±•å‘èµ·äº†å‰æœŸçš„ç«åŠ›ä¾¦å¯Ÿã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146031.png" alt="img"></p>
<p>â€‹    ä¹”å¸ƒæ–¯æ‹…è´Ÿç€ä¸Šå¸èµ‹äºˆçš„ä¼Ÿå¤§ä½¿å‘½ï¼Œ2007å¹´ï¼ŒIphoneè¯ç”Ÿäº†ã€‚ä¼´éšç€Iphoneçš„è¯ç”Ÿï¼ŒAndroidçš„å‡ºç°ï¼Œæ™ºèƒ½æ—¶ä»£åˆ°æ¥äº†ã€‚å®Œæˆäº†ä¼Ÿå¤§ä½¿å‘½çš„ä¹”å¸®ä¸»ï¼Œè¿™ä½å¤©é€‰ä¹‹å­ï¼Œ4å¹´ä¹‹åï¼Œæ’’æ‰‹äººå¯°ï¼Œé­‚å½’å¤©å ‚ã€‚è€Œä»–ï¼Œç•™ä¸‹äº†è¿™é¢—è¡Œæ˜Ÿä¸Šå¸‚å€¼æœ€é«˜çš„å…¬å¸ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146048.png" alt="img"></p>
<p>â€‹    æ™ºèƒ½æ‰‹æœºçš„å…´èµ·ï¼Œä¿ƒè¿›ç§»åŠ¨ç«¯ç¡¬ä»¶æå‡ï¼Œæ˜¾ç¤ºæŠ€æœ¯ä¹Ÿæœ‰å¾ˆå¤§å˜åŒ–ã€‚ç§»åŠ¨æ—¶ä»£ç¡¬ä»¶å‘å±•åŒæ ·ç²¾å½©,å……æ»¡äº†ç«äº‰ä¸æ€æˆ®ï¼Œé‡è›®å’Œé‚ªæ¶ï¼Œå’ŒPCç«¯åŒæ ·ç²¾å½©ã€‚è½¯ä»¶æ–¹é¢ç›¸å¯¹å¹³æ»‘å¹³æ·¡ï¼Œæ²¡æœ‰å¤§çš„å¼€å¼€åˆåˆã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146075.png" alt="img"></p>
<p>â€‹    æ‰‹æœºçš„å‘å±•å²ï¼Œä¹Ÿæ˜¯ä¸€éƒ¨æ— çº¿æŠ€æœ¯çš„å‘å±•å²ã€‚ç¡¬ä»¶æŠ€æœ¯ä¸é€šè®¯è§„èŒƒå¯†åˆ‡ç›¸å…³ï¼Œç¿»å¼€ç§»åŠ¨é€šè®¯çš„æ—¥è®°ï¼Œä»1Gåˆ°5Gï¼Œæ„Ÿæ—¶å…‰å¦‚æ¢­ï¼Œå¹æŠ€æœ¯ç¥é€Ÿã€‚é€šè®¯æŠ€æœ¯è§„èŒƒä¸å±äºæœ¬ä¸»é¢˜å†…å®¹ï¼Œä¸åšé˜è¿°ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146307.png" alt="img"></p>
<p>â€‹    ç§»åŠ¨æ—¶ä»£èŠ¯ç‰‡ç§‘æŠ€ï¼Œçœ‹åˆ°äº†ä¸­å›½ä¼ä¸šçš„å½±å­ï¼Œä¸œæ–¹ç”¨èµ„æœ¬å¼€å§‹äº†ä¹°ä¹°ä¹°çš„è¿‡ç¨‹ã€‚å¯¹èŠ¯ç‰‡æŠ€æœ¯çš„æ¸´æ±‚ï¼Œèµ„æœ¬æ˜¯æœ€ç›´æ¥çš„å€¾è¯‰ã€‚æœŸæœ›ä¸è¿œçš„æœªæ¥ï¼Œæœ‰ä¸€å®¶æ‹¥æœ‰æ ¸å¿ƒæŠ€æœ¯çš„ä¸œæ–¹èŠ¯ç‰‡å‚å•†ã€‚åœ¨æŠ€æœ¯çš„é•¿æ²³ä¸­ï¼Œä¹¦å†™æµ“é‡çš„ä¸€ç¬”ã€‚åœ¨èŠ¯ç‰‡çš„äº¤å“ä¹ä¸­ï¼Œå¥å‡ºä¸­å›½çš„å£°éŸ³ã€‚</p>
<p>â€‹    æ³¢æ¾œå£®é˜”çš„æ‰‹æœºåº”ç”¨ï¼Œåå°æ˜¯èŠ¯ç‰‡æŠ€æœ¯çš„é©±åŠ¨ã€‚ä¸‹ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä»èŠ¯ç‰‡çš„è§’åº¦å›é¡¾ã€‚</p>
<h2 id="5-2ã€ç§»åŠ¨ç«¯ä¸»æµæ˜¾ç¤ºèŠ¯ç‰‡"><a href="#5-2ã€ç§»åŠ¨ç«¯ä¸»æµæ˜¾ç¤ºèŠ¯ç‰‡" class="headerlink" title="5.2ã€ç§»åŠ¨ç«¯ä¸»æµæ˜¾ç¤ºèŠ¯ç‰‡"></a>5.2ã€ç§»åŠ¨ç«¯ä¸»æµæ˜¾ç¤ºèŠ¯ç‰‡</h2><h3 id="5-2-1ã€ARM"><a href="#5-2-1ã€ARM" class="headerlink" title="5.2.1ã€ARM"></a>5.2.1ã€ARM</h3><p>â€‹    ARMä¸ä»…è¿›è¡ŒåµŒå…¥å¼CPUæ¶æ„æˆæƒï¼Œä¹Ÿè¿›è¡ŒGPUæ¶æ„æˆæƒã€‚åœ¨èŠ¯ç‰‡æ¶æ„è®¾è®¡ä¸Šï¼ŒARMç¨³åå¤´æŠŠäº¤æ¤…ã€‚2006å¹´ï¼ŒARM å®Œæˆå¯¹æŒªå¨Falanxå…¬å¸çš„æ”¶è´­ï¼Œè·å¾—å…¶ç§»åŠ¨GPUæŠ€æœ¯ï¼Œå®Œæˆå¯¹åŸæœ‰IPæŠ€æœ¯çš„æ‰©å±•ã€‚ä¹Ÿå°±æ˜¯ä»é‚£ä¸ªå¹´ä»£å¼€å§‹ï¼ŒARMé—ªäº®ç™»åœºã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146341.png" alt="img"></p>
<p>â€‹    ARMæ˜¯æœ‰å…ˆè§ä¹‹æ˜çš„ï¼Œ15å¹´åï¼ŒGPUå¹¿æ³›ç”¨äºæ™ºèƒ½æ‰‹æœºã€DTVå’Œå¹³æ¿ç”µè„‘ç­‰å¤šç§è®¾å¤‡ã€‚15å¹´æ—¶é—´ï¼ŒARM MaliæŠ€æœ¯æˆä¸ºå…¨çƒå‡ºè´§é‡ç¬¬ä¸€çš„GPUï¼Œé¢„è®¡2020å¹´æ€»è®¡å‡ºè´§é‡å°±è¶…è¿‡15äº¿ã€‚åœ¨ç§»åŠ¨å›¾å½¢ç¡¬ä»¶å‘å±•å²ä¸Šï¼ŒARM mailæ˜¯å¿…è°ˆçš„æŠ€æœ¯ã€‚</p>
<p>â€‹    Mali GPUæ¶æ„å‘å±•äº†3ä»£ï¼ŒUtgardã€Midgardå’ŒBifrostã€‚Utgardçš„ä»£è¡¨æ˜¯Mali-400 MPï¼Œä¸‰æ˜Ÿçš„Exynos4412ç”¨çš„å°±æ˜¯è¿™æ¬¾GPUï¼ŒMali-450è‡³ä»Šçš„ä¸€äº›ç”µè§†èŠ¯ç‰‡è¿˜åœ¨ä½¿ç”¨ï¼ˆä¾‹å¦‚å°ç±³ç”µè§†ï¼‰ã€‚Midgardçš„å‹å·æ˜¯Mali-Tç³»åˆ—ï¼Œè”å‘ç§‘Helio X20å°±ç”¨çš„æ˜¯Mali-T880ï¼Œè€ŒBifrostçš„å‹å·æ˜¯Mali-Gç³»åˆ—ã€‚</p>
<p>â€‹    ARMçš„Maliå¯ä»¥è¯´æ˜¯ARM CPUçš„â€œé»„é‡‘æ­æ¡£â€ï¼Œæ¶æ„ä¸Šä¸æ˜¯æœ€å…ˆè¿›ï¼Œæ™®åŠç‡éå¸¸é«˜ï¼Œä½å»‰çš„æˆæƒè´¹æ˜¯èŠ¯ç‰‡å‚å•†æ¯”è¾ƒå–œæ¬¢çš„ã€‚ARMç§‘æŠ€ä¸æ–¹æ¡ˆçš„æˆæƒï¼Œä¿è¯äº†æŠ€æœ¯çº¯ç²¹ï¼Œé™ä½äº†ç»è¥é£é™©ã€‚</p>
<p>â€‹    Maliæ˜¯ä¸€æ¬¾é«˜ç«¯GPUï¼Œå°†å›¾å½¢IPè§†è§‰å¨±ä¹å˜ä¸ºç°å®ï¼Œå¸‚åœºå å®‰å“æ™ºèƒ½æ‰‹æœº30%ä»¥ä¸Šï¼Œå¯ä¸PowerVR SGXç³»åˆ—GPUå¯¹æ¯”ã€‚</p>
<p>â€‹    åº”ç”¨åŸºäºARMä½“ç³»ç»“æ„çš„ç§»åŠ¨è®¾å¤‡ä¸Šï¼Œå¾—ç›ŠäºCPUå æœ‰ç‡å‘å±•è¿…çŒ›ã€‚ARMÂ® Maliâ„¢ ç³»åˆ— GPU ä¸ºæ‰€æœ‰åµŒå…¥å¼å›¾å½¢ IP å’Œè§†é¢‘ IP æä¾›å®Œå–„çš„è§£å†³æ–¹æ¡ˆï¼Œä½¿è®¾å¤‡åˆ¶é€ å•†å’Œå†…å®¹å¼€å‘å•†èƒ½å¤Ÿä¸ºæœ€å¹¿æ³›çš„æ¶ˆè´¹ç±»è®¾å¤‡ï¼ˆæ‰‹æœºã€æ¸¸æˆæœºã€æ™ºèƒ½æœ¬ã€HDTVï¼‰æä¾›æœ€é«˜è´¨é‡çš„å°–ç«¯å¤šåª’ä½“è§£å†³æ–¹æ¡ˆã€‚GPUæ˜¯è¿‘äº›å¹´ç¡¬ä»¶æœ€é‡è¦çš„åº”ç”¨ä¹‹ä¸€ï¼Œå½“å¹´ARMæ”¶è´­Falanxç®€ç›´æ˜¯ç¥æ¥ä¹‹ç¬”ï¼Œä¸ºARMçš„åšå¤§åšå¼ºåŸ‹ä¸‹äº†ä¼ç¬”ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146348.png" alt="img"></p>
<p>â€‹    Mali åµŒå…¥å¼å›¾å½¢ IP è®¾è®¡ç”¨äºæé«˜èƒ½æºæ•ˆç‡å’Œè§£å†³æ€§èƒ½é—®é¢˜ï¼ŒåŒ…æ‹¬ä¸–ç•Œä¸Šæœ€å°çš„ GPUã€å®Œæ•´å¤šæ ¸å¯æ‰©å±•æ€§ï¼ˆæœ€é«˜å¯è¾¾ 1080pï¼‰ã€ç”¨äºå¯è§†è®¡ç®—çš„ GPU çš„é€šç”¨è®¡ç®— (GPGPU) ä»¥åŠå¤šç”¨é€”åº”ç”¨ç¨‹åºã€‚æ‰€æœ‰ Mali GPU éƒ½å—é¢„å…ˆé›†æˆçš„ Mali å›¾å½¢é©±åŠ¨ç¨‹åºè½¯ä»¶æ”¯æŒã€‚</p>
<p>â€‹    çµæ´»æ€§æ˜¯è¦è€ƒè™‘çš„ä¸€ä¸ªé‡è¦å› ç´ ï¼Œæ”¯æŒçš„ä¸šç•Œæ ‡å‡†å¼€æ”¾å¼ API åŒ…æ‹¬OpenVGã€OpenGL ESã€OpenCLä»¥åŠDirectXÂ®ã€‚è¿™äº›æ˜¯ARMæˆåŠŸçš„åŸºç¡€ã€‚</p>
<p>â€‹    ARMåœ¨èŠ¯ç‰‡æ¶æ„è®¾è®¡ä¸Šï¼Œæœ‰å¤šè§çš„ç»éªŒç§¯ç´¯ã€‚é«˜é€šåœ¨é€šè®¯é¢†åŸŸé‡Œï¼Œæœ‰æœ€å¥½çš„æŠ€æœ¯äº§å“ã€‚</p>
<h3 id="5-2-2ã€Qualcomm"><a href="#5-2-2ã€Qualcomm" class="headerlink" title="5.2.2ã€Qualcomm"></a>5.2.2ã€Qualcomm</h3><p>â€‹    é«˜é€šï¼ˆQualcommï¼‰çš„è‹±æ–‡æ˜¯Quality Communicationsï¼Œç¿»è¯‘å°±æ˜¯é«˜è´¨é‡é€šä¿¡ã€‚åˆ›å§‹äººé›…å„å¸ƒæ–¯æ˜¯æé€šä¿¡å·¥ç¨‹æåˆ°å«æ˜Ÿé¢†åŸŸçš„ç”·äººï¼Œé«˜é€šä»Šå¤©â€œè¿æ¥ä¸‡ç‰©â€çš„ä½¿å‘½ä»åˆ›ç«‹é‚£å¤©å°±å¥ å®šäº†ã€‚è¿™æ˜¯ä¸€å®¶è¶…å¼ºçš„å…¬å¸ï¼Œå…¶æŠ€æœ¯å»¶ç»­æ€§ä¸å¼ºå¤§æ€§é¦–å±ˆä¸€æŒ‡ã€‚åœ¨è¿™ä¸ªå¹´ä»£çš„äººï¼Œéƒ½ç”¨è¿‡é«˜é€šçš„äº§å“æˆ–è€…æŠ€æœ¯ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146324.png" alt="img"></p>
<p>â€‹    1985å¹´æˆç«‹çš„å…¬å¸ï¼Œåœ¨1989å¼€å§‹æ¨å¹¿CDMAã€‚ä¸šç•Œçš„æ³¨æ„åŠ›éƒ½åœ¨TDMAæŠ€æœ¯ä¸Šï¼ˆåæ¥æ¼”å˜æˆGSMï¼‰ï¼Œé«˜é€šé ç€è‡ªå·±çš„å®éªŒå’Œæµ‹è¯•ï¼Œè®©CDMAåœ¨1993å¹´æˆä¸ºè¡Œä¸šæ ‡å‡†å¹¶å’ŒGSMåˆ†åº­æŠ—ç¤¼ï¼Œè¿™å°±æ˜¯é«˜é€šçš„æ°´å¹³ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146383.png" alt="img"></p>
<p>â€‹    é«˜é€šç ”å‘æŠ•å…¥å æ¯”å¸¸å¹´åœ¨æ”¶å…¥çš„20%ä»¥ä¸Šã€‚å‰30å¹´ï¼Œé«˜é€šç´¯è®¡æŠ•å…¥äº†è¶…è¿‡440äº¿ç¾å…ƒçš„ç ”å‘ç»è´¹ï¼Œè·å¾—äº†è¶…è¿‡13ä¸‡é¡¹å…¨çƒä¸“åˆ©ã€‚</p>
<p>â€‹    2007å¹´ï¼Œé‚£ä¸€å¹´å‘ç”Ÿäº†ä¸¤ä»¶æ”¹å˜ä¸–ç•Œçš„äº‹æƒ…ï¼šä¹”å¸ƒæ–¯å‘å¸ƒiPhoneï¼Œé«˜é€šæ¨å‡ºäº†éªé¾™èŠ¯ç‰‡Snapdragon S1ã€‚</p>
<p>â€‹    13å¹´é—´ï¼Œé«˜é€šåœ¨ç§»åŠ¨SoCé¢†åŸŸæ‰“èµ¢è¿‡ä¸¤æ¬¡é‡å¤§æˆ˜å½¹ï¼Œç¬¬ä¸€æ¬¡è®©å¾·å·ä»ªå™¨ã€è‹±ä¼Ÿè¾¾è¿™äº›ä¸šç•Œå¤§å‚é€€å‡ºäº†ç§»åŠ¨é«˜ç«¯å¸‚åœºã€‚ç¬¬äºŒæ¬¡åˆ™æ˜¯è®©è”å‘ç§‘è´¥èµ°ä¸­é«˜ç«¯ã€‚ä¸­é€”è¿˜æ’æ’­è¿‡è‹±ç‰¹å°”é ç€Atom+è¡¥è´´ï¼Œæ‰“äº†å‡ å¹´é…±æ²¹çš„å†å²ã€‚è¿™äº›ææ€–æˆç»©çš„å­˜åœ¨ï¼Œæ˜¯é«˜é€šå¯¹ç¡¬ä»¶æŠ€æœ¯çš„ä¸æ‡ˆè¿½æ±‚ã€‚</p>
<p>â€‹    æ—¶é—´çº¿è°ƒå›2007å¹´ï¼Œä»é‚£æ—¶å¼€å§‹ï¼Œé«˜é€šæ¯å¹´çš„SoCï¼Œéƒ½ä¼šå¸¦ç€æ–°çš„åˆ¶ç¨‹ã€æ–°çš„CPUã€GPUå’Œè°ƒåˆ¶è§£è°ƒå™¨äº®ç›¸ã€‚é«˜é€šåœ¨è°ƒåˆ¶è§£è°ƒå™¨ä¸Šçš„ä¼˜åŠ¿ï¼ŒçŠ¹å¦‚ä¸å¯é€¾è¶Šçš„é¸¿æ²Ÿï¼ŒæŠŠå…¶å®ƒå¤§å‚æ’æŒ¤åœ¨åƒé‡Œä¹‹å¤–ã€‚é«˜é€šæŠŠè°ƒåˆ¶è§£è°ƒå™¨åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§éªé¾™ï¼Œä¸€ç§å…¶å®ƒã€‚</p>
<p>â€‹    2007å¹´å®‰å“å’ŒWindows Mobileçš„è›®è’æ—¶ä»£ï¼Œé«˜é€šMSM7225&#x2F;7625è¿™äº›ä¸Šå¤çš„SoCè¿GPUéƒ½å·²ç»æ”¯æŒ3Gäº†ï¼Œæ¯”å›½å†…ç§°ä¸º3Gå…ƒå¹´çš„2009å¹´è¿˜æ—©äº†æ•´æ•´2å¹´ã€‚ä½œä¸ºç§»åŠ¨æŠ€æœ¯çš„é¡¶çº§å…ƒè€ï¼Œè¿™ä¸ªä¸è®©äººæ„å¤–ã€‚</p>
<p>â€‹    ç§»åŠ¨GPUï¼Œç‰¹åˆ«æ˜¯Adrenoç³»åˆ—ï¼Œåœ¨è¿‘10å‡ å¹´ä¸€ç›´ç»´æŒç€è¿œè¶…æ‘©å°”å®šå¾‹çš„æ€§èƒ½å¢é€Ÿã€‚è¿™ä¸ªæ•…äº‹å‡ºç°å¾—æœ€å¯†é›†çš„è¯ï¼Œå°±æ˜¯â€œæš´æ¶¨â€äºŒå­—ã€‚åœ¨ä¼—å¤šå…¬å¸ä¸­ï¼Œé«˜é€šåƒä¸€ä¸ªå·¥ç¨‹å¸ˆä¸€æ ·ï¼Œåšå®ˆç¡¬ä»¶è®¾è®¡çš„é˜µåœ°ã€‚</p>
<p>â€‹    2009å¹´ï¼ŒMSM7227ï¼ˆéš¶å±éªé¾™S1ï¼‰æ­è½½çš„Adreno 200ï¼Œå…¶æµ®ç‚¹æ€§èƒ½æ˜¯2.1GFLOPSã€‚è€Œ2012å¹´åˆçš„Adreno 225ä¸Šï¼Œæµ®ç‚¹æ€§èƒ½å·²ç»æš´æ¶¨äº†10æ•°å€ï¼Œè¾¾åˆ°25 GFLOPSã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146377.png" alt="img"></p>
<p>â€‹    æ‰‹æœºGPUå’Œç”µè„‘æœ‰ä¸€å®šçš„åŒºåˆ«ï¼Œæ‰‹æœºGPUæ˜¯æ•´åˆåˆ°SoCå†…çš„ï¼Œç”µè„‘å¯ä»¥æœ‰ç‹¬ç«‹æ˜¾å¡ã€‚é«˜é€šçš„adrenoçš„æŠ€æœ¯éƒ¨åˆ†æºè‡ªé«˜é€šä»AMDæ”¶è´­çš„ç§»åŠ¨GPUéƒ¨é—¨ã€‚</p>
<p>â€‹    é«˜é€šçš„GPUå¸‚åœºå æœ‰ç‡å¾ˆé«˜ï¼Œadrenoçš„è¡¨ç°ä¹Ÿè¶³å¤Ÿä¼˜ç§€ï¼Œæ”¯æŒè¶³å¤Ÿå¤šçš„æ–°ç‰¹æ€§ï¼Œæ€§èƒ½æ¯”è¾ƒå¼ºï¼ŒåŠŸè€—è¡¨ç°ä¹Ÿå¾ˆç†æƒ³ã€‚</p>
<p>â€‹    å¦‚æœè¯´2015å¹´ä¹‹å‰ï¼Œå…¶ä»–å‚å•†çš„GPUè¿˜ç®—å’Œé«˜é€šè¿½å¾—å¾ˆç´§çš„è¯ï¼Œé‚£åœ¨éªé¾™820&#x2F;821çš„Adreno 530å¼€å§‹ï¼Œé«˜é€šå°±è¿›å…¥äº†æ— äººä¹‹å¢ƒã€‚æˆ–æ˜¯ä»ç»å¯¹æ€§èƒ½ï¼Œæˆ–æ˜¯ä»èƒ½è€—æ¯”ä¸Šï¼Œæ‹‰å¼€äº†å’Œè‹¹æœã€ä¸‰æ˜Ÿã€æµ·æ€ã€è”å‘ç§‘çš„å·®è·ã€‚ç°åœ¨å”¯ä¸€èƒ½åœ¨GPUæ€§èƒ½ä¸Šè·Ÿç€é«˜é€šçš„ï¼Œå°±åªå‰©è‹¹æœäº†ã€‚ä½†åŒä»£äº§å“ä¸Šï¼Œé«˜é€šæ€»æ˜¯èƒ½åœ¨èƒ½è€—æ¯”ä¸Šå‹è‹¹æœä¸€å¤´ã€‚</p>
<p>â€‹    è®©äººç–¯ç‹‚çš„æ˜¯ï¼Œé™¤äº†èƒ½è€—æ¯”å…¶å®ƒå…¬å¸å ä¼˜ä¹‹å¤–ï¼Œé«˜é€šçš„Adrenoå‡ ä¹å¸¸å¹´éƒ½æ˜¯ç”¨ç€åŒä»£é¢ç§¯æœ€å°çš„GPUèŠ¯ç‰‡é¢ç§¯ã€‚ä¸‰æ˜ŸExynos 9810ä¸Šçš„GPUé¢ç§¯è¾¾åˆ°äº†25 mm2ï¼ŒKirin 970ä¸Šä¹Ÿæœ‰18 mm2ï¼Œä½†é«˜é€šç¡¬ç”Ÿç”Ÿåªç”¨äº†10 mm2å‡ºå¤´çš„èŠ¯ç‰‡é¢ç§¯ï¼Œåšåˆ°äº†æ›´å¼ºçš„æ€§èƒ½æ›´ä½çš„èƒ½è€—ã€‚</p>
<p>â€‹    é«˜é€šåœ¨åµŒå…¥å¼æŠ€æœ¯ä¸Šçš„èƒ½åŠ›æ˜¯æœ‰ç›®å…±ç¹çš„ï¼ŒåµŒå…¥å¼ç¡¬ä»¶å¯¹ç§»åŠ¨ç«¯æä¾›äº†æ ¸å¿ƒçš„æ”¯æŒã€‚åœ¨å›¾å½¢å›¾åƒè§†é¢‘ç¡¬ä»¶æŠ€æœ¯ä¸Šï¼Œé«˜é€šé“é«˜ä¸€ä¸ˆã€‚ã€</p>
<p>â€‹    åœ¨äº’è”ç½‘ä¼—å¤šç§‘æŠ€å…¬å¸ä¸­ï¼Œé«˜é€šç®—æ˜¯åšç§¯è–„å‘ã€‚åœ¨ä¼ä¸šå‘å±•ä¸Šï¼Œç¨³å¥è¸å®ï¼Œåœ¨èŠ¯ç‰‡é¢†åŸŸå…·æœ‰ä¸¾è¶³è½»é‡çš„åœ°ä½ã€‚åœ¨äº’è”ç½‘ã€äººå·¥æ™ºèƒ½é«˜é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œé«˜é€šçš„ç¡¬å®åŠ›å±•ç°å‡ºæ¥ã€‚</p>
<p>â€‹    è‹¹æœæ„Ÿè°¢é«˜é€šï¼Œé«˜é€šçš„å­˜åœ¨ï¼Œé˜»å‡»äº†ä¸€çº¿ç§‘æŠ€å…¬å¸å¯¹è‹¹æœçš„å›´å‰¿ã€‚åœ¨æŠ€æœ¯å¤§æ½®ä¸­ï¼Œé«˜é€šä¸æ–­ä¸ºè‹¹æœè¾“é€æŠ€æœ¯çš„è¡€æ¶²ï¼Œæˆå°±äº†è‹¹æœçš„ä¸‡äº¿å¸å›½ã€‚</p>
<h3 id="5-2-3ã€Apple"><a href="#5-2-3ã€Apple" class="headerlink" title="5.2.3ã€Apple"></a>5.2.3ã€Apple</h3><p>â€‹    2006å¹´åˆ°2013å¹´ï¼ŒAMDå’ŒNVIDIAåœ¨ç§»åŠ¨å¸‚åœºç«äº‰ä¸­å®Œå…¨å¤±ç­–ã€‚ä¸¢æ‰å…¨çƒç§»åŠ¨GPUä¸»è¦ä¾›åº”å•†çš„åŒæ—¶ï¼Œè‹¹æœä¸€æ­¥æ­¥å–ä»£ä»–ä»¬å¹¶æˆä¸ºæœ€å¼ºå¤§ã€æœ€ä¸»æµçš„GPUå¤„ç†å™¨çš„ç”Ÿäº§è€…ã€‚AMDå’ŒNVIDIAé‡è¹ˆIntelçš„è¦†è¾™ï¼Œä¸¢æ‰ç§»åŠ¨GPUå¸‚åœºã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146543.png" alt="img"></p>
<p>â€‹    å½“å¹´Intelæœªèƒ½é¢„æ–™iPhoneçš„æ½œåŠ›ï¼Œå¿½è§†äº†ç§»åŠ¨å¸‚åœºã€‚è®©ARMä»ä¸€å®¶åŸºç¡€ç§»åŠ¨å¤„ç†å™¨ç”Ÿäº§å•†ä¸€è·ƒæˆä¸ºæ™ºèƒ½æ‰‹æœºå’Œå¹³æ¿å¤„ç†å™¨çš„ä¸»è¦ç”Ÿäº§å•†ï¼Œè€Œç§»åŠ¨GPUçš„å‘å±•ä¹Ÿååˆ†ç›¸ä¼¼ã€‚å†å²ä¸æ–­çš„ç»™è‹¹æœæœºä¼šï¼Œå¹¶ç»™ä¸å…¶æŠŠæ¡æœºä¼šçš„èƒ½åŠ›ã€‚</p>
<p>â€‹    iOSç¬¦åˆç”¨æˆ·çŸ¥è§‰ï¼Œè§†è§‰ç¾è§‚ï¼Œå›¾å½¢ç¯å¢ƒ(å½’åŠŸäºGPUåŠ é€Ÿ)ï¼Œè¿™æ˜¯iPhoneé”€é‡å±…é«˜ä¸ä¸‹çš„å› ç´ ã€‚Googleå®Œå…¨æ²¡æœ‰æ„è¯†åˆ°iPhoneæˆåŠŸçš„å…³é”®ã€‚</p>
<p>â€‹    iPhoneå¯¹GPUçš„é‡è§†ï¼Œè®©iPhoneé€‚åˆæ¸¸æˆã€‚ä»ä¸€å¼€å§‹ï¼Œæ¸¸æˆæ˜¯è‹¹æœåº”ç”¨å•†åº—é‡Œçš„ä¸»è§’ï¼Œæ”¹å˜äº†å¤§ä¼—å¯¹è‹¹æœâ€œæ²¡æœ‰æ¸¸æˆâ€çš„å°è±¡ã€‚iPhoneã€iPod touchè¿˜æœ‰2010å¹´çš„iPadï¼Œå‡ä½œä¸ºç‹¬ç«‹çš„ç§»åŠ¨æ¸¸æˆè®¾å¤‡é¢ è¦†äº†æ¸¸æˆå¸‚åœºã€‚</p>
<p>â€‹    è‹¹æœæ¨å‡ºäº†æ–°çš„APIï¼šMetalã€‚å¾ˆå¤šä¼˜ç§€çš„å¼€å‘è€…éƒ½åˆ©ç”¨äº†è¿™å¥—æ–°çš„APIå¼€å‘æ–°åº”ç”¨ã€‚Metalå¯ä»¥è®©æ¸¸æˆå’Œå…¶ä»–éœ€è¦å›¾å½¢æ€§èƒ½çš„åº”ç”¨ç»•è¿‡OpenGLï¼Œåˆ©ç”¨è‹¹æœ64ä½å¤„ç†å™¨çš„å¼ºå¤§GPUã€‚è‹¹æœåœ¨å›¾å½¢å¤„ç†é€Ÿåº¦ä¸Šæœ‰å¾ˆå¤§ä¼˜åŠ¿ï¼Œåœ¨ç§»åŠ¨æ¸¸æˆæ–¹é¢å°¤å…¶æ˜æ˜¾ï¼›è€ŒMetalåˆ™è®©ä¼˜åŠ¿è¿›ä¸€æ­¥å¢åŠ ã€‚</p>
<p>â€‹    è‹¹æœæŠŠImaginationçš„äººæŒ–äº†ä¹‹åè‡ªç ”äº†GPUï¼Œç„¶åæŠŠè¿™å¸®äººè§£æ•£äº†ã€‚è¿™ä»¶äº‹æƒ…å‘Šè¯‰æˆ‘ä»¬ï¼Œè‹¹æœæ˜¯é ä¸ä½çš„ï¼Œä¸çŸ¥é“å“ªå¤©åˆä¼šå¸ç£¨æ€é©´ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146606.png" alt="img"></p>
<p>â€‹    è¿‘äº›å¹´è‹¹æœGPUèµ°å‘è‡ªç ”é“è·¯ã€‚æœªæ¥è°æŒæ¡äº†æœ€å¼ºçš„æ‰‹æœºå›¾å½¢æ€§èƒ½ï¼Œè°å°±å¯ä»¥åœ¨å¸‚åœºä¸Šè·å¾—æ›´å¤§ä¸»åŠ¨æƒï¼Œè‹¹æœæ·±è°™æ­¤é“ã€‚åœ¨è¿›è¡ŒæŠ€æœ¯æ‹“å±•çš„åŒæ—¶ï¼Œè¿›ä¸€æ­¥å·©å›ºAç³»åˆ—èŠ¯ç‰‡çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</p>
<p>â€‹    A11å°½ç®¡é‡‡ç”¨çš„æ˜¯å’Œéªé¾™835ä¸€æ ·çš„10nmå·¥è‰ºï¼Œæ•´ä½“æ€§èƒ½ä»ç„¶å¼ºäºéªé¾™835ã€‚GPUç›¸æ¯”A10æå‡äº†30%ï¼Œä¸‰æ ¸å¿ƒè®¾è®¡ï¼Œå¹¶å¯¹æ²‰æµ¸å¼ 3D æ¸¸æˆå’Œ AR å¢å¼ºç°å®è¿›è¡Œäº†ä¼˜åŒ–ã€‚è¿™æ˜¯è‹¹æœç¬¬ä¸€ä»£è‡ªç ”GPUï¼Œè‹¹æœçœŸæ­£èƒ½æŠŠè‡ªå·±çš„GPUå®Œå–„èµ·æ¥è¿˜éœ€è¦1-2å¹´æ—¶é—´ã€‚é‚£æ—¶Aç³»åˆ—GPUå’ŒCPUèåˆçš„ä¼šæ›´åŠ ç´§å¯†ï¼Œåœ¨æ€§èƒ½å’Œèƒ½è€—ä¸Šä¼šæœ‰æ›´å¤§çš„çªç ´ã€‚</p>
<p>â€‹    å‘å±•çš„å…³é”®æ—¶åˆ»ï¼Œä¸Šå¸åçˆ±è‹¹æœã€‚é¢ä¸´æŠ€æœ¯æŠ‰æ‹©æ—¶ï¼Œè‹¹æœå¾€å¾€æŠ¼å®æˆåŠŸã€‚çœ‹ä¼¼å­¤å‚²ç‹¬è¡Œï¼Œé‡å¤§æˆ˜å½¹åˆ°æ¥æ—¶ï¼Œæ€»æœ‰å‹å†›å‡ºç°ã€‚è¿™äº›å› ç´ çš„ç»¼åˆï¼Œä½¿è‹¹æœç¨³åç§‘æŠ€å…¬å¸ç¬¬ä¸€å®åº§ã€‚</p>
<h3 id="5-2-4ã€Imagination-Technologies"><a href="#5-2-4ã€Imagination-Technologies" class="headerlink" title="5.2.4ã€Imagination Technologies"></a>5.2.4ã€Imagination Technologies</h3><p>â€‹    Imagination Technologieså‰èº«æ˜¯video logicå…¬å¸ã€‚æ›¾ç»çš„å…¨çƒç§»åŠ¨ GPU IPé¾™å¤´ï¼Œæ·±è€•GPU å†…æ ¸ç ”å‘å’Œè®¾è®¡ï¼Œæ›¾æ˜¯è‹¹æœå¾¡ç”¨å›¾å½¢æŠ€æœ¯æä¾›å•†ï¼Œæ€»éƒ¨ä½äºè‹±å›½ã€‚2018å¹´è¢«ä¸­èµ„èƒŒæ™¯ä¼ä¸šæ”¶è´­ï¼Œæœªæ¥å‘å±•ä¸æ˜ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146692.png" alt="img"></p>
<p>â€‹    Imagination Technologiesçš„æ ¸å¿ƒäº§å“æ˜¯IMG Aç³»åˆ—äº§å“ï¼Œè¢«è®¾è®¡ä¸ºå¯åº”ç”¨äºå„ç§åœºæ™¯çš„GPUï¼Œæ”¯æŒè‡ªåŠ¨é©¾é©¶ã€AIoTã€æ•°å­—ç”µè§†ã€æœºé¡¶ç›’ã€ç§»åŠ¨è®¾å¤‡ç­‰æ™ºèƒ½åº”ç”¨ã€‚</p>
<p>â€‹    IMG Aç³»åˆ—åœ¨å¤šä¸ªå¸‚åœºä¸­æˆæƒå®¢æˆ·ï¼Œè¿™ç‚¹å’ŒARMç›¸åƒã€‚é¦–æ‰¹æ­è½½è¯¥IPçš„SoCå™¨ä»¶åœ¨2020å¹´ä¾›è´§ã€‚Imagination Technologieså®£å¸ƒï¼Œç´«å…‰å·²è·å¾—æœ€æ–°ä¸€ä»£ç¥ç»ç½‘ç»œåŠ é€Ÿå™¨ï¼ˆNNAï¼‰PowerVR Series3NXåŠå¯¼ä½“IPæˆæƒè®¸å¯ï¼Œæ˜¯é¢å‘ä¸­é«˜ç«¯ç§»åŠ¨è®¾å¤‡å¸‚åœºçš„ç³»ç»Ÿçº§èŠ¯ç‰‡ã€‚</p>
<p>â€‹    æ•£çƒ­æ¡ä»¶é™åˆ¶ï¼Œå¤§å¤šæ•°ç§»åŠ¨GPUå¾ˆéš¾æä¾›æŒç»­ä¸€è‡´çš„æ¸¸æˆä½“éªŒï¼ŒèŠ¯ç‰‡å‘çƒ­å…¶æ€§èƒ½ä¸‹é™åˆ°ä¸å¯æ¥å—çš„æ°´å¹³ã€‚IMG Aç³»åˆ—åˆ™ä»¥ä¸€è‡´çš„å¸§é€Ÿæä¾›æŒç»­å¯é çš„æ€§èƒ½ä»¥åŠæ›´é•¿æ¸¸æˆæ—¶é—´ï¼Œé¿å…äº†å› èŠ¯ç‰‡è¿‡çƒ­å¯¼è‡´æ—¶é’Ÿé™é¢‘ç”šè‡³æ•…éšœç­‰è¿‡çƒ­æƒ…å†µï¼ŒIMG Aç³»åˆ—æœ‰ä¸€å®šçš„æŠ€æœ¯ä¼˜åŠ¿ã€‚</p>
<p>â€‹    IMG Aç³»åˆ—é‡‡ç”¨Imaginationçš„HyperLaneæŠ€æœ¯ï¼Œç‹¬ç«‹çš„ç¡¬ä»¶æ§åˆ¶é€šé“è¢«éš”ç¦»åœ¨å†…å­˜ä¸­ï¼Œå°†ä¸åŒçš„ä»»åŠ¡åŒæ—¶æäº¤ç»™GPUï¼Œå®ç°GPUå¤šä»»åŠ¡å¤„ç†ã€‚</p>
<p>â€‹    é€šè¿‡AI Synergyï¼ŒGPUåœ¨å¯ä»¥æä¾›å›¾å½¢å¤„ç†åŠŸèƒ½çš„åŒæ—¶ï¼Œä½¿ç”¨å¤‡ç”¨èµ„æºæ”¯æŒå¯ç¼–ç¨‹AIä»¥åŠå›ºå®šåŠŸèƒ½ï¼Œå³é«˜åº¦ä¼˜åŒ–çš„Imaginationç¥ç»ç½‘ç»œåŠ é€Ÿå™¨ã€‚AI Synergyåœ¨æœ€å°çš„èŠ¯ç‰‡é¢ç§¯ä¸­æä¾›å¯ç¼–ç¨‹çš„äººå·¥æ™ºèƒ½ï¼Œç»Ÿä¸€çš„è½¯ä»¶æ ˆå¯å®ç°çµæ´»å‡ºè‰²çš„æ€§èƒ½ã€‚</p>
<p>â€‹    PowerVRæ›¾ç»æ˜¯è‹¹æœâ€œå¾¡ç”¨â€çš„GPUï¼Œæ€§èƒ½è¡¨ç°å¼ºå¤§ã€æ¶æ„å…ˆè¿›ï¼Œä¸ä»…åœ¨iOSé¢†åŸŸï¼Œåœ¨å®‰å“é¢†åŸŸä½¿ç”¨ä¹Ÿå¾ˆå¹¿æ³›ã€‚å½“å¹´çš„ä¸€ä»£ç¥Uè”å‘ç§‘MT6577å°±ä½¿ç”¨äº†å¤§å¹…åº¦è¶…é¢‘çš„SGX531ï¼Œæ€§èƒ½æ˜¯ä½ç«¯æœºé‡Œçš„ç¿˜æ¥šã€‚</p>
<p>â€‹    ä½†æ˜¯ï¼Œå› ä¸ºè¾ƒé«˜çš„æˆæƒè´¹ç”¨ï¼ŒPVRé€æ¸å¤±å»äº†å®‰å“å¸‚åœºï¼Œå®¢æˆ·çº·çº·è½¬å‘æ›´å»‰ä»·çš„ARM Maliã€‚è™½ç„¶æœ‰è”å‘ç§‘Helio X30ç­‰çš„æ”¯æŒï¼ŒPVRä»ç„¶æ˜¯å¼ºå¼©ä¹‹æœ«ã€‚å†åŠ ä¸Šè‹¹æœçš„æŠ›å¼ƒï¼ˆè‹¹æœå®£å¸ƒè‡ªç ”GPUï¼‰å’ŒæŒ–å¢™è„šï¼Œç­‰å¾…Imaginationçš„åªæœ‰å–èº«çš„æ‚²æƒ¨å‘½è¿ã€‚</p>
<p>â€‹    GPUæŠ€æœ¯çš„é€‰æ‹©ï¼Œæ˜¯å¾ˆå¤šèŠ¯ç‰‡å…¬å¸åšå¼ºåšå¤§çš„åŸºç¡€ã€‚å°¤å…¶æ˜¯æ™ºèƒ½æ—¶ä»£çš„å¸¦æ¥ï¼ŒGPUçš„åº”ç”¨æ±¹æ¶Œæ¾æ¹ƒï¼Œé£å·äº‘æ¶Œã€‚</p>
<h3 id="5-2-5ã€Vivante"><a href="#5-2-5ã€Vivante" class="headerlink" title="5.2.5ã€Vivante"></a>5.2.5ã€Vivante</h3><p>â€‹    Vivante(å›¾èŠ¯)æ›¾ç»æ˜¯åµŒå…¥å¼å›¾å½¢å¤„ç†å™¨ï¼ˆGPUï¼‰çš„æŠ€æœ¯å…ˆè¡Œè€…ã€‚æ€»éƒ¨ä½äºåŠ å·ï¼Œä¸ºå…¨çƒç§»åŠ¨è®¾å¤‡å’Œå®¶åº­å¨±ä¹å¸‚åœºæä¾›é¡¶çº§åº”ç”¨ï¼Œè¶…çº§å¤„ç†å™¨è§£å†³æ–¹æ¡ˆã€‚æ›¾ç»æ‹¥æœ‰ç§ç±»ç¹å¤šçš„2D&#x2F;3Då›¾å½¢å¤„ç†å™¨ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146625.png" alt="img"></p>
<p>â€‹    ç”¨ç¡…å°æ¨¡ï¼Œä¸ºä¸šç•Œæ ‡å‡†åº”ç”¨ç¨‹åºæ¥å£æä¾›å¼ºå¤§æ”¯æŒã€‚å›¾èŠ¯èŠ¯ç‰‡æŠ€æœ¯å°†æ¡Œé¢è´¨é‡å›¾è±¡å’Œæ€§èƒ½å¸¦å…¥æ±½è½¦ã€æ‰‹æŒä¸­çš„å±å¹•ã€‚ä¼˜ç§€å¯å‡çº§çš„åµŒå…¥å¼è§£å†³æ–¹æ¡ˆæ˜¯å¯å‡çº§çš„ï¼Œå»ºç«‹åœ¨ä¸šç•Œæ ‡å‡†ä¹‹ä¸Šï¼Œä¸”ä¼˜åŒ–åŠŸè€—ã€æ€§èƒ½å’Œå¤§å°ã€‚</p>
<p>â€‹    å›¾èŠ¯ä¸æ–­å¢é•¿çš„äº§å“ç³»åˆ—ï¼Œä¸å…¨çƒå¤šå®¶å…¬å¸æˆåŠŸåˆä½œã€‚å¯¹ç§»åŠ¨è§†è§‰é€¼çœŸå’Œé«˜æ¸…è§†è§‰é€¼çœŸçš„æ ¸å¿ƒæŠ€æœ¯ï¼Œæˆä¸ºå½“å¹´é¡¶çº§ç§»åŠ¨ç«¯å›¾å½¢å›¾åƒæŠ€æœ¯ä¾›åº”å•†ã€‚</p>
<p>â€‹    2016å¹´01æœˆ08æ—¥ï¼Œå›¾èŠ¯è¢«ä¸­å›½èŠ¯åŸæ”¶è´­ï¼Œäº§å“å¼€å§‹æ²‰é»˜ã€‚å¯¹OpenGL ESã€OpenVGã€DirectXçš„æˆåŠŸæ”¯æŒï¼Œæ˜¯å›¾èŠ¯å‰æœŸæˆåŠŸçš„æ ¸å¿ƒè¦ç´ ã€‚</p>
<h3 id="5-2-6ã€NVIDIAã€AMDã€Intel"><a href="#5-2-6ã€NVIDIAã€AMDã€Intel" class="headerlink" title="5.2.6ã€NVIDIAã€AMDã€Intel"></a>5.2.6ã€NVIDIAã€AMDã€Intel</h3><p>â€‹    ç§»åŠ¨ç«¯å›¾å½¢æŠ€æœ¯çš„å¿«é€Ÿå‘å±•ï¼ŒåŠ é€Ÿäº†ç§»åŠ¨æ—¶ä»£çš„åˆ°æ¥ã€‚å½“å¹´PCç«¯æ˜¾ç¤ºæŠ€æœ¯çš„å¤§ä½¬ä»¬ï¼Œå˜å¾—å­¤å•ä¸å¯‚å¯ï¼Œè¿™èƒ½å‘Šè¯‰æˆ‘ä»¬ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146638.png" alt="img"></p>
<p>â€‹    æ‰‹æœºgpuä¸èƒ½å•å–ï¼Œéœ€è¦å¯ç”¨çš„åŸºå¸¦ï¼ŒNVIDIAå¹¶æ²¡æœ‰åŸºå¸¦ã€‚åœ¨ä¸éœ€è¦åŸºå¸¦çš„ç§»åŠ¨gpuä¸Šï¼ŒNVIDIAåšçš„å¾ˆå¥½ï¼Œä¾‹å¦‚switch gpuã€‚</p>
<p>â€‹    è‹±ä¼Ÿè¾¾å¼€å‘è¿‡æ‰‹æœºèŠ¯ç‰‡â€”â€”Tegraç³»åˆ—ï¼Œç°åœ¨Tegraå·²ç»è°¢å¹•ï¼Œå½“å¹´ä½¿ç”¨TegraèŠ¯ç‰‡æ‰‹æœºé£è¡Œä¸€æ—¶ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146708.png" alt="img"></p>
<p>â€‹    è‹±ä¼Ÿè¾¾åœ¨Tegra4åŠä¹‹å‰çš„GPUæ¶æ„å«GeForce ULPï¼ŒTegra4å·ç§°â€œ72æ ¸GPUâ€ï¼Œä½†æ¶æ„ååˆ†è€æ—§ï¼Œæ˜¯DX9æ—¶ä»£çš„åˆ†ç¦»æ¸²æŸ“æ¶æ„ã€‚Tegraå› ä¸ºåŸºå¸¦èŠ¯ç‰‡é—®é¢˜é€€å‡ºæ‰‹æœºå¸‚åœºï¼Œåæ¥æ¨å‡ºäº†Tegra K1ç”¨ä¸Šå…ˆè¿›çš„Kepleræ¶æ„ï¼Œä½†æ˜¯ä¸€åˆ‡éƒ½å¤ªæ™šäº†ã€‚</p>
<p>â€‹    NVIDIAç°åœ¨å’Œå¯é¢„è§çš„å°†æ¥éƒ½æ²¡æœ‰æ‰‹æœºäº§å“ï¼Œè¿™æ˜¯NVIDIAä¸èƒ½æ¥å—çš„ã€‚æœŸæœ›æœ‰ä¸€å¤©ï¼Œåœ¨ç§»åŠ¨ç«¯æ˜¾ç¤ºèŠ¯ç‰‡ä¸Šï¼Œä¸Šæ¼”ç‹è€…å½’æ¥ã€‚AMDä¸ä»…ç¼ºå°‘ç§»åŠ¨GPUï¼Œè¿˜å‡ ä¹æ²¡æœ‰å¸‚åœºä»½é¢ã€‚Intelåœ¨è¡¥è´´ç¡¬ä»¶å‚å•†è®©å®ƒä»¬ä½¿ç”¨Inteläº§å“(é€ æˆäº†æ¯å¹´400äº¿ç¾å…ƒçš„æŸå¤±)ã€‚</p>
<p>â€‹    ä¸–ç•Œä¸Šå½±å“åŠ›æœ€å¤§çš„ä¸¤ä¸ªGPUå‚å®¶ï¼ŒAMDå’ŒNVIDIAã€‚ä¸¤ä¸ªå¾®å¤„ç†å™¨çš„å‘æ˜è€…Intelå’Œå¾·å·ä»ªå™¨ï¼Œå‡ ä¹å…¨éƒ½è¢«è‹¹æœé€å‡ºäº†ç§»åŠ¨å¸‚åœºã€‚ç°åœ¨å¸‚åœºä¸­åªæœ‰ä½ç«¯é›¶ä»¶å‚å•†ã€è‹¹æœé«˜ç«¯ã€é«˜é”€é‡çš„iOSè®¾å¤‡ç«äº‰ã€‚è¿™ä»¤äººæ„Ÿå¹ï¼Œè‹¹æœè·³å‡ºäº†æ—¶ä»£çš„å±€é™æ€§ï¼Œåœ¨æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯æˆä¸ºæœ€æˆåŠŸçš„ä¼ä¸šï¼Œä¸Šå¸å¤ªåçˆ±è‹¹æœäº†ã€‚</p>
<p>â€‹    å½“å¹´Nvidiaä¹°äº†Iceraï¼Œi500ä¹‹åï¼ŒæŠ˜è…¾SoCï¼Œæ²¡æœ‰ä¸‹æ–‡ã€‚15å¹´å®£å‘Šæ”¾å¼ƒï¼Œç°åœ¨æƒ³ç”¨åªèƒ½å¤–æŒ‚åŸºå¸¦ã€‚é»„è¯å¸ˆä»°å¤©é•¿å•¸ï¼Œç§»åŠ¨ç«¯æŠ¥å›½æ— é—¨ã€‚</p>
<p>â€‹    å¤–æŒ‚æ˜¯å¯ä»¥çš„ï¼ŒDrivePX2ä¸Šæ¥GPUç”¨PCIE 4xï¼Œç„¶åGPUæœ‰è‡ªå·±æ˜¾å­˜ï¼Œè¿™ä¸ªä¸æ˜¯æ‰‹æœºèƒ½æ¥å—çš„ã€‚å¦‚æœç”¨CCIï¼Œè®¿é—®å†…å­˜æ²¡æœ‰é—®é¢˜ï¼Œä½†æœ‰å…¶å®ƒå±€é™æ€§ã€‚Tegra X1åé»„æ€»å°±ä¸ç”¨CCIäº’è”äº†ã€‚</p>
<p>â€‹    AMDã€INTELå’Œè‹±ä¼Ÿè¾¾é“è·¯ç›¸ä¼¼ï¼Œ3Dæ—¶ä»£é›„èµ·ï¼Œç§»åŠ¨æ—¶ä»£æ²‰å¯‚ï¼Œæ™ºèƒ½æ—¶ä»£å¥‹èµ·ã€‚æ¯ä¸€å®¶å…¬å¸éƒ½æœ‰å„è‡ªçš„é¢†åœ°ã€‚é‚£äº›æˆåŠŸçš„è·¨ç•Œï¼Œæˆå°±äº†æŠ€æœ¯çš„è‰³é‡ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146815.png" alt="img"></p>
<p>â€‹    å°±å·¥è‰ºè€Œè¨€ï¼Œç›¸å¯¹äºCPUï¼ŒGPUæŠ€æœ¯éš¾åº¦ä½ä¸€äº›ã€‚è¿™ä¹Ÿæ˜¯ä¼—å¤šå°å‚å¼€å§‹å‘GPUè¿ˆè¿›çš„åŸå› ã€‚åœ¨ç§»åŠ¨æ—¶ä»£ï¼Œç§‘æŠ€çš„å‘å±•åˆ›é€ æœºä¼šï¼Œå¾ˆå¤šä¼ ç»Ÿçš„CPUã€GPUå¤§å‚ç”±äºå›ºå®ˆè½¨é“ï¼Œé”™è¿‡äº†GPUå‘å±•çš„é»„é‡‘æ—¶ä»£ã€‚</p>
<h2 id="5-3ã€ç§»åŠ¨å›¾å½¢åº“"><a href="#5-3ã€ç§»åŠ¨å›¾å½¢åº“" class="headerlink" title="5.3ã€ç§»åŠ¨å›¾å½¢åº“"></a>5.3ã€ç§»åŠ¨å›¾å½¢åº“</h2><p>â€‹    ç§»åŠ¨æ‰‹æœºå›¾å½¢æ¥å£ä¸Šï¼Œæ²¡æœ‰æ¡Œé¢ç«¯çš„ä¸‡é©¬å¥”è…¾ã€ç™¾èˆ¸äº‰æµï¼Œæ•´ä½“ç›¸å¯¹å¹³ç¨³ä¸è‡ªç„¶ã€‚æ— è®ºAndroidè¿˜æ˜¯IOSï¼Œéƒ½æ˜¯Linuxçš„å†…æ ¸ã€‚æ‰€ä»¥åœ¨ç§»åŠ¨å›¾å½¢åº“çš„é€‰å‹ä¸å‘å±•ä¸Šï¼Œå’Œæ¡Œé¢ç«¯å›¾å½¢åº“æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ‰¿æ¥ã€‚OpenGLæ¡Œé¢ç«¯ä¸å¯æ’¼åŠ¨çš„åœ°ä½ï¼Œç§»åŠ¨ç«¯ï¼ŒOpenGLçš„ç®€åŒ–ç‰ˆOpenGL ESåº”è¿è€Œç”Ÿã€‚</p>
<h3 id="5-3-1ã€OpenGL-ES"><a href="#5-3-1ã€OpenGL-ES" class="headerlink" title="5.3.1ã€OpenGL ES"></a>5.3.1ã€OpenGL ES</h3><p>â€‹    OpenGL ES æ˜¯ OpenGLä¸‰ç»´å›¾å½¢ API çš„å­é›†ï¼Œé’ˆå¯¹æ‰‹æœºã€PDAå’Œæ¸¸æˆä¸»æœºç­‰åµŒå…¥å¼è®¾å¤‡è€Œè®¾è®¡ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146838.png" alt="img"></p>
<p>â€‹    OpenGL ES æ˜¯ OpenGL è£å‰ªå®šåˆ¶è€Œæ¥ï¼Œå»é™¤äº†å¤æ‚å›¾å…ƒç­‰éç»å¯¹å¿…è¦çš„ç‰¹æ€§ã€‚OpenGL ES 2.0 å‚ç…§ OpenGL 2.0 è§„èŒƒå®šä¹‰ã€‚</p>
<p>â€‹    OpenGL ES å…æˆæƒå¹¶ä¸”è·¨å¹³å°ï¼Œå¼ºå¤§çš„2Då’Œ3Då›¾å½¢åº”ç”¨ç¨‹åºæ¥å£APIï¼Œé’ˆå¯¹å¤šç§åµŒå…¥å¼ç³»ç»Ÿä¸“é—¨è®¾è®¡ï¼ŒåŒ…æ‹¬æ§åˆ¶å°ã€ç§»åŠ¨ç”µè¯ã€æ‰‹æŒè®¾å¤‡ã€å®¶ç”µè®¾å¤‡å’Œæ±½è½¦ã€‚ç”±ç²¾å¿ƒå®šä¹‰çš„æ¡Œé¢OpenGLå­é›†ç»„æˆï¼Œå®ç°äº†è½¯ä»¶ä¸å›¾å½¢åŠ é€Ÿé—´çµæ´»å¼ºå¤§çš„åº•å±‚äº¤äº’æ¥å£ã€‚</p>
<h4 id="5-3-1-1ã€OpenGL-ES-ç‰ˆæœ¬ä¸åŠŸèƒ½"><a href="#5-3-1-1ã€OpenGL-ES-ç‰ˆæœ¬ä¸åŠŸèƒ½" class="headerlink" title="5.3.1.1ã€OpenGL ES ç‰ˆæœ¬ä¸åŠŸèƒ½"></a>5.3.1.1ã€OpenGL ES ç‰ˆæœ¬ä¸åŠŸèƒ½</h4><p>â€‹    OpenGL ESåŒ…å«æµ®ç‚¹è¿ç®—å’Œé¡¶ç‚¹è¿ç®—ï¼ŒåŠEGLä¾¿æºè®¾å¤‡çš„æœ¬åœ°è§†çª—ç³»ç»Ÿè§„èŒƒã€‚</p>
<p>â€‹    OpenGL ES 1.X é¢å‘åŠŸèƒ½å›ºå®šçš„ç¡¬ä»¶æ‰€è®¾è®¡ï¼Œå¹¶æä¾›åŠ é€Ÿæ”¯æŒã€å›¾å½¢è´¨é‡åŠæ€§èƒ½æ ‡å‡†ï¼Œä¹Ÿå°±æ˜¯å›ºå®šç®¡çº¿ç¼–ç¨‹ã€‚OpenGL ES 2.X æä¾›åŒ…æ‹¬é®ç›–å™¨æŠ€æœ¯åœ¨å†…çš„å…¨å¯ç¼–ç¨‹3Då›¾å½¢ç®—æ³•ã€‚OpenGL ES 3.xåˆ™åœ¨å¯ç¼–ç¨‹ç®¡çº¿ä¸Šè¿›è¡Œäº†å¢å¼ºã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146870.png" alt="img"></p>
<p>â€‹    OpenGL ESæé«˜äº†ä¸åŒæ¶ˆè´¹ç”µå­è®¾å¤‡çš„3Då›¾å½¢æ¸²æŸ“é€Ÿåº¦ï¼Œåœ¨åµŒå…¥å¼ç³»ç»Ÿä¸Šå®ç°äº†å…¨é¢å¯ç¼–ç¨‹çš„3Då›¾å½¢ã€‚</p>
<p>â€‹    OpenGL ESå·¥ä½œç»„åœ¨å…­ä¸ªæœˆå†…æ›´æ–°OpenGL ESé‡‡çº³è€…é¡¹ç›®ï¼Œæä¾›å…¼å®¹æ€§æµ‹è¯•ï¼Œå¹¶æä¾›ç›¸å…³æºä»£ç ã€‚ç›®å‰ Corporationã€Imaginationã€NVIDIAã€é«˜é€šã€ZiiLABSç­‰éƒ½è¡¨è¾¾äº†å¯¹OpenGL ES 3.0çš„å¤§åŠ›æ”¯æŒã€‚æœ€æ–°GPUå°±æ”¯æŒOpenGL ES 3.0ã€‚</p>
<h4 id="5-3-1-2ã€OpenGL-ES-3-0æ–°åŠŸèƒ½"><a href="#5-3-1-2ã€OpenGL-ES-3-0æ–°åŠŸèƒ½" class="headerlink" title="5.3.1.2ã€OpenGL ES 3.0æ–°åŠŸèƒ½"></a>5.3.1.2ã€OpenGL ES 3.0æ–°åŠŸèƒ½</h4><p>â€‹    1ã€æ¸²æŸ“ç®¡çº¿å¤šé‡å¢å¼ºï¼Œå®ç°å…ˆè¿›è§†è§‰æ•ˆæœçš„åŠ é€Ÿï¼ŒåŒ…æ‹¬é®æŒ¡æŸ¥è¯¢(Occlusion Query)ã€å˜ç¼“åé¦ˆ(Transform Feedback)ã€å®ä¾‹æ¸²æŸ“(Instanced Rendering)ã€æ›´å¤šæ¸²æŸ“ç›®æ ‡æ”¯æŒã€‚</p>
<p>â€‹    2ã€é«˜è´¨é‡ETC2&#x2F;EACçº¹ç†å‹ç¼©æ ¼å¼æˆä¸ºä¸€é¡¹æ ‡å‡†åŠŸèƒ½ï¼Œä¸åŒå¹³å°ä¸Šä¸å†éœ€è¦ä¸åŒçš„çº¹ç†é›†ã€‚</p>
<p>â€‹    3ã€æ–°ç‰ˆGLSL ES 3.0ç€è‰²è¯­è¨€ï¼Œå…¨é¢æ”¯æŒæ•´æ•°å’Œ32ä½æµ®ç‚¹æ“ä½œã€‚</p>
<p>â€‹    4ã€çº¹ç†åŠŸèƒ½å¢å¼ºï¼Œæ”¯æŒæµ®ç‚¹çº¹ç†ã€3Dçº¹ç†ã€æ·±åº¦çº¹ç†ã€é¡¶ç‚¹çº¹ç†ã€NPOTçº¹ç†ã€R&#x2F;RGå•åŒé€šé“çº¹ç†ã€ä¸å¯å˜çº¹ç†ã€2Dé˜µåˆ—çº¹ç†ã€æ— äºŒæ¬¡å¹‚é™åˆ¶çº¹ç†ã€é˜´å½±å¯¹æ¯”ã€è°ƒé…(swizzle)ã€LODä¸mip level clampsã€æ— ç¼ç«‹æ–¹ä½“è´´å›¾ã€é‡‡æ ·å¯¹è±¡ã€çº¹ç†MSAAæŠ—é”¯é½¿æ¸²æŸ“å™¨ã€‚</p>
<p>â€‹    5ã€æ›´å¤šç²¾ç¡®å°ºå¯¸çº¹ç†å’Œæ¸²æŸ“ç¼“å†²æ ¼å¼ï¼Œä¾¿æºç§»åŠ¨åº”ç”¨æ›´ç®€å•ã€‚</p>
<h4 id="5-3-1-3ã€OpenGL-ES-ç¤ºä¾‹ä»£ç "><a href="#5-3-1-3ã€OpenGL-ES-ç¤ºä¾‹ä»£ç " class="headerlink" title="5.3.1.3ã€OpenGL ES ç¤ºä¾‹ä»£ç "></a>5.3.1.3ã€OpenGL ES ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line">       private final int CONTEXT_CLIENT_VERSION = 3;</span><br><span class="line">       private GLSurfaceView mGLSurfaceView;</span><br><span class="line"></span><br><span class="line">       @Override</span><br><span class="line">       protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">              super.onCreate(savedInstanceState);</span><br><span class="line">              mGLSurfaceView = new GLSurfaceView(this);</span><br><span class="line">              if (detectOpenGLES30()) &#123;</span><br><span class="line">              mGLSurfaceView.setEGLContextClientVersion(CONTEXT_CLIENT_VERSION);</span><br><span class="line">                     mGLSurfaceView.setRenderer(new RendererJNI(this));</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                     Log.e(&quot;opengles30&quot;, &quot;OpenGL ES 3.0 not supported on device.  Exiting...&quot;);</span><br><span class="line">                     finish();</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              setContentView(mGLSurfaceView);</span><br><span class="line">       &#125;</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">       @Override</span><br><span class="line">       protected void onResume() &#123;</span><br><span class="line">              super.onResume();</span><br><span class="line">              mGLSurfaceView.onResume();</span><br><span class="line">       &#125;</span><br><span class="line">      </span><br><span class="line">       @Override</span><br><span class="line">       protected void onPause() &#123;</span><br><span class="line">              super.onPause();</span><br><span class="line">              mGLSurfaceView.onPause();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       private boolean detectOpenGLES30() &#123;</span><br><span class="line">              ActivityManager am = (ActivityManager)getSystemService(Context.ACTIVITY_SERVICE);</span><br><span class="line">              ConfigurationInfo info = am.getDeviceConfigurationInfo();        </span><br><span class="line">              return (info.reqGlEsVersion &gt;= 0x30000);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-2ã€å…¶å®ƒ"><a href="#5-3-2ã€å…¶å®ƒ" class="headerlink" title="5.3.2ã€å…¶å®ƒ"></a>5.3.2ã€å…¶å®ƒ</h3><p>â€‹    Vulkanå’ŒMetalä¸ä»…æ˜¯3Dæ—¶ä»£çš„å›¾å½¢æ¡†æ¶ï¼Œä¹Ÿæ˜¯ç§»åŠ¨é¢†åŸŸçš„æ ¸å¿ƒå›¾å½¢å›¾åƒæ¡†æ¶ã€‚å…³äºMetalå’ŒVulkançš„çŸ¥è¯†ï¼Œå‚è€ƒå‰é¢ä¸»é¢˜ã€‚</p>
<h2 id="5-4ã€å¯ç¤º"><a href="#5-4ã€å¯ç¤º" class="headerlink" title="5.4ã€å¯ç¤º"></a>5.4ã€å¯ç¤º</h2><p>â€‹    æ¢³ç†è¿™æ®µå†å²æ—¶ï¼Œæˆ‘ä»¬å‘ç°ï¼Œä¿¡æ¯ç§‘æŠ€çš„æ ¸å¿ƒæ˜¯èŠ¯ç‰‡ï¼ŒèŠ¯ç‰‡æŠ€æœ¯è¢«å›½å¤–å·¨å¤´å„æ–­ã€‚å¶å°”æœ‰ä¸­èµ„å…¬å¸çš„å½±å­ï¼Œå¤§å¤šæ˜™èŠ±ä¸€ç°ã€‚èŠ¯ç‰‡æŠ€æœ¯æ˜¯ç™¾å¹´å¤§è®¡ï¼Œå¾ˆéš¾å®ç°å¼¯é“è¶…è½¦ã€‚</p>
<p>â€‹    åœ¨è®¡ç®—ç§‘æŠ€ç™½çš®ä¹¦é‡Œï¼Œå¤§å¤šæ˜¯æ¬§ç¾ç§‘æŠ€çš„å½±å­ï¼Œä¸œæ–¹å…¬å¸æ¯”é‡è¾ƒä½ã€‚è¿™æ³¨å®šäº†ç§‘æŠ€èµ¶è¶…æ˜¯ä¸€ä¸ªé•¿æœŸçš„è¿‡ç¨‹ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146955.png" alt="img"></p>
<p>â€‹    åœ¨è½¯ä»¶è§„èŒƒåˆ¶å®šä¸Šï¼Œé¢ä¸´åŒæ ·çš„æƒ…å†µã€‚æœªæ¥å‡ åå¹´ï¼Œåœ¨è½¯ä»¶è§„èŒƒä¸Šï¼Œæˆ‘ä»¬åŸ‹å¤´è‹¦å¹²ï¼Œå¥‹å‹‡å‘å‰ã€‚</p>
<p>â€‹    é€šè®¯æ ¸å¿ƒæŠ€æœ¯ä¸Šï¼Œä¾ç„¶æœ‰å¾ˆå¤§ä¸è¶³ã€‚ä½†åœ¨å¸‚åœºåº”ç”¨ä¸Šï¼Œæˆ‘ä»¬æ‹”å¾—å¤´ç­¹ã€‚åœ¨ç§»åŠ¨å•†åŠ¡ã€ç§»åŠ¨æ”¯ä»˜ã€çŸ­è§†é¢‘åº”ç”¨ä¸Šï¼Œæ·æŠ¥é¢‘ä¼ ã€‚</p>
<p>â€‹    ç¾æ‘„ç§‘æŠ€åšæŒéŸ³è§†é¢‘æ ¸å¿ƒæŠ€æœ¯ç ”ç©¶ï¼Œåº•å±‚ç¡¬ä»¶æŠ€æœ¯ç ”å‘ã€‚åœ¨æŠ€æœ¯æ¥å£ï¼Œäº§ä¸šåº”ç”¨ä¸Šä¹˜é£ç ´æµªï¼Œæ¿€æµå‹‡è¿›ã€‚åœ¨ç¥–å›½å›¾å½¢å›¾åƒæŠ€æœ¯å»ºè®¾ä¸Šï¼Œåšå‡ºåº”æœ‰çš„è´¡çŒ®ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146972.png" alt="img"></p>
<p>â€‹    ç¼˜èšç¼˜æ•£ï¼Œæ—¶ç©ºå˜æ¢ã€‚1978å¹´ä¹‹åï¼Œç§‘æŠ€çš„æ˜¥å¤©å†æ¬¡åˆ°æ¥äº†ã€‚ä»åŸºç¡€èŠ¯ç‰‡ï¼Œè½¯ä»¶è§„èŒƒï¼Œåˆ°è¡Œä¸šåº”ç”¨ã€‚æˆ‘ä»¬æµå¹´ç¬‘æ·ï¼Œåšä¿¡æœªæ¥å¯æœŸã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192146007.png" alt="img"></p>
<h1 id="6-äººå·¥æ™ºèƒ½æ—¶ä»£"><a href="#6-äººå·¥æ™ºèƒ½æ—¶ä»£" class="headerlink" title="6 äººå·¥æ™ºèƒ½æ—¶ä»£"></a>6 äººå·¥æ™ºèƒ½æ—¶ä»£</h1><h2 id="6-1ã€äººå·¥æ™ºèƒ½å‘å±•å†å²"><a href="#6-1ã€äººå·¥æ™ºèƒ½å‘å±•å†å²" class="headerlink" title="6.1ã€äººå·¥æ™ºèƒ½å‘å±•å†å²"></a>6.1ã€äººå·¥æ™ºèƒ½å‘å±•å†å²</h2><p>â€‹    äººå·¥æ™ºèƒ½æ˜¯ç§‘æŠ€æ°¸ä¹…çš„è¯é¢˜ï¼Œè®¡ç®—æœºæœ¬èº«æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œäººå·¥æ™ºèƒ½å‘å±•å²ä¸Šï¼Œè®¡ç®—æœºçš„å‡ºç°ï¼Œæ˜¯äººå·¥æ™ºèƒ½å‘å±•çš„ä¼Ÿå¤§èŠ‚ç‚¹ã€‚21ä¸–çºªä»…ä»…æ˜¯äººå·¥æ™ºèƒ½çš„å¼€ç«¯ï¼Œäººå·¥æ™ºèƒ½çš„å‘å±•æ–¹å…´æœªè‰¾ã€‚</p>
<p>â€‹    æ—©æœŸçš„äººå·¥æ™ºèƒ½åé‡äºç†è®ºï¼Œè¥¿æ–¹çš„ç¥å­¦å¤§å¸ˆã€å“²å­¦å…ˆé©±ã€æ•°å­¦å·¨åŒ ä¸€èµ·ï¼Œä¸ºäººå·¥æ™ºèƒ½å¥ å®šäº†æ–‡åŒ–åŸºç¡€ï¼Œä¸‹é¢æˆ‘ä»¬å¼€å§‹ä¸å¤§å¸ˆçš„å¯¹è¯ã€‚</p>
<h3 id="6-1-1ã€å¤§äº‹è®°"><a href="#6-1-1ã€å¤§äº‹è®°" class="headerlink" title="6.1.1ã€å¤§äº‹è®°"></a>6.1.1ã€å¤§äº‹è®°</h3><p>â€‹    200å¹´å‰ï¼Œå·´è´å¥‡ï¼Œä¸€ä¸ªè‹±å›½æ•°å­¦å®¶ï¼Œè®¾è®¡äº†ç¬¬ä¸€å°è®¡ç®—äºŒæ¬¡å¤šé¡¹å¼çš„è®¡ç®—æœºå™¨ï¼Œå«åšå·®åˆ†æœºï¼Œæ‘‡åŠ¨æ‰‹æŸ„ï¼Œè®¡ç®—å‡ºx*x+aå¼å­çš„å€¼ã€‚å½“æ—¶çš„ä¸œæ–¹ï¼Œå¤§æ¸…çš‡æœï¼Œå³å°†é¢ä¸´è¡€è‰²çš„è¾‰ç…Œã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144726.png" alt="img"></p>
<p>â€‹    1956å¹´ï¼Œå‡ ä¸ªç§‘å­¦å®¶ï¼Œèšä¼šåœ¨ç¾å›½æ±‰è¯ºæ€å°é•‡å®é™çš„è¾¾ç‰¹èŒ…æ–¯å­¦é™¢ï¼Œåˆ©ç”¨æš‘å‡çš„ä¸¤ä¸ªæœˆè¿›è¡Œå°é—­å¼çš„è®¨è®ºç ”ç©¶ï¼Œä¸»é¢˜æ˜¯â€œè¾¾ç‰¹èŒ…æ–¯å¤å­£äººå·¥æ™ºèƒ½ç ”ç©¶è®¡åˆ’â€ã€‚é¦–æ¬¡æå‡ºâ€œäººå·¥æ™ºèƒ½ï¼ˆArtificial Intelligenceï¼Œç®€ç§°AIï¼‰â€è¿™ä¸€æ¦‚å¿µï¼Œäººå·¥æ™ºèƒ½å­¦ç§‘åº”è¿è€Œç”Ÿäº†ã€‚å½“å¹´ç®€å•çš„ä¸¤ä¸ªå•è¯ï¼Œæˆä¸ºä»Šå¤©ç§‘æŠ€çš„ä¸»æ—‹å¾‹ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144719.png" alt="img"></p>
<p>â€‹    1959å¹´ï¼Œå¡ç¼ªå°”è®²åˆ°ï¼Œè®¡ç®—æœºå¯ä»¥æ¯”äººæ›´å¥½åœ°ç¼–ç¨‹ï¼Œè¿›è¡Œå›½é™…è±¡æ£‹æ¸¸æˆæ—¶ï¼Œåˆ›é€ äº†â€œæœºå™¨å­¦ä¹ â€(Machine Learning)ä¸€è¯ã€‚ä¸Šæ‰¿æ¥äººå·¥æ™ºèƒ½ï¼Œä¸‹æ‰¿æ¥è‡ªç„¶è¯­è¨€ä¸æœºå™¨è§†è§‰ã€‚ç¼–ç¨‹é‚‚é€…äººå·¥æ™ºèƒ½ï¼Œäººå·¥æ™ºèƒ½é’æ¢…ç«¹é©¬çš„å¹´ä»£å¼€å§‹äº†ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144994.png" alt="img"></p>
<p>â€‹    1965å¹´ï¼ŒJoseph Weizenbaumï¼Œå¼€å‘ELIZAï¼Œä¸€ä¸ªäº¤äº’å¼è®¡ç®—æœºç¨‹åºï¼Œç”¨è‹±è¯­ä¸äººäº¤è°ˆã€‚Weizenbaumæœ‰ä¸€ä¸ªç›®æ ‡ï¼Œè¯æ˜äººå·¥æ™ºèƒ½æ€ç»´ä¸äººç±»æ€ç»´ä¹‹é—´çš„æ²Ÿé€šæ˜¯è‚¤æµ…çš„ã€‚è¿™æ˜¯ç¬¬ä¸€ä¸ªé€šè¿‡å›¾çµæµ‹è¯•çš„è½¯ä»¶ç¨‹åºï¼Œâ€œå¯¹è¯å°±æ˜¯æ¨¡å¼åŒ¹é…â€ï¼Œä»£è¡¨ç€è‡ªç„¶è¯­è¨€æŠ€æœ¯çš„å¼€ç«¯ã€‚60å¹´åçš„ä»Šå¤©ï¼Œè‡ªç„¶è¯­è¨€æŠ€æœ¯åº”ç”¨å¹¿æ³›ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144980.png" alt="img"></p>
<p>â€‹    1978å¹´ï¼Œå¡è€åŸºæ¢…éš†å¤§å­¦ï¼Œå¼€å‘è‡ªåŠ¨é€‰é…è®¡ç®—æœºé…ä»¶çš„ç¨‹åºXCONï¼Œ1980å¹´æŠ•å…¥å·¥å‚ä½¿ç”¨ï¼ŒåŒ…å«2500æ¡è§„åˆ™ï¼Œåç»­å‡ å¹´å¤„ç†äº†è¶…è¿‡80000æ¡è®¢å•ï¼Œå‡†ç¡®åº¦è¶…è¿‡95%ï¼Œæ¯å¹´èŠ‚çœè¶…è¿‡2500ä¸‡ç¾å…ƒã€‚è¿™æ˜¯æ—©æœŸçš„ä¸“å®¶ç³»ç»Ÿï¼Œå¼€å§‹äºç”Ÿäº§åº”ç”¨ã€‚æˆ‘ä»¬ä»Šå¤©è¿›è¡Œè‡ªåŠ¨è´­ç‰©æ—¶ï¼Œå¾ˆå°‘æœ‰äººçŸ¥é“åŠä¸ªä¸–çºªä»¥å‰ï¼Œåœ¨å¤§æ´‹å½¼å²¸å·²è¢«å¹¿æ³›åº”ç”¨ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144020.png" alt="img"></p>
<p>â€‹    1979å¹´ï¼Œæ–¯å¦ç¦å¤§å­¦ï¼Œåˆ¶é€ äº†æ— äººé©¾é©¶è½¦Stanford Cartï¼Œè¿™æ˜¯æ±½è½¦çš„ç¬¬ä¸€æ¬¡ï¼Œä¾é è§†è§‰æ„Ÿåº”å™¨ï¼Œåœ¨æ²¡æœ‰äººå·¥å¹²é¢„çš„æƒ…å†µä¸‹ï¼Œè‡ªä¸»ç©¿è¿‡æ•£ä¹±æ‰”ç€æ¤…å­çš„æˆ¿é—´ï¼Œéœ€è¦å‡ ä¸ªå°æ—¶æ‰èƒ½å®Œæˆã€‚å½“å¹´çš„è§†è§‰æ„Ÿåº”å™¨ï¼Œå°±æ˜¯ä»Šå¤©çš„æœºå™¨è§†è§‰ï¼Œå½“å¹´çš„æ— äººå·¥å¹²é¢„ï¼Œå°±æ˜¯ä»Šå¤©çš„è‡ªåŠ¨é©¾é©¶ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144044.png" alt="img"></p>
<p>â€‹    1982å¹´ï¼Œè‹±å›½ç§‘å­¦å®¶éœæ™®è²å°”å¾·å‡ ä¹åŒæ—¶ä¸æ°å¼—é‡ŒÂ·è¾›é¡¿ï¼Œå‘ç°äº†å…·æœ‰å­¦ä¹ èƒ½åŠ›çš„ç¥ç»ç½‘ç»œç®—æ³•ï¼Œæ²‰å¯‚10å¹´ä¹‹åï¼Œç¥ç»ç½‘ç»œæœ‰äº†æ–°çš„è¿›å±•ã€‚ä»æ­¤ç¥ç»ç½‘ç»œé«˜é€Ÿå‘å±•ï¼Œ90å¹´ä»£å¼€å§‹å•†ä¸šåŒ–ï¼Œç”¨äºæ–‡å­—å›¾åƒè¯†åˆ«å’Œè¯­éŸ³è¯†åˆ«ã€‚ä»Šå¤©çš„ç¥ç»ç½‘ç»œå·¥ç¨‹å¸ˆä»¬ï¼Œé²œæœ‰äººçŸ¥é“è¿™ä¸¤ä½å¤§å¸ˆçš„åå­—ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144071.png" alt="img"></p>
<p>â€‹    1986å¹´ï¼Œæ¢…èµ›å¾·æ–¯ - å¥”é©°ï¼ŒErnst Dickmannsçš„æŒ‡å¯¼ä¸‹å»ºé€ å¹¶å‘å¸ƒäº†ä¸€è¾†é…å¤‡æ‘„åƒå¤´å’Œä¼ æ„Ÿå™¨çš„æ— äººé©¾é©¶å¢å¼è´§è½¦ã€‚èƒ½å¤Ÿåœ¨æ²¡æœ‰äººç±»é©¾é©¶å‘˜çš„é“è·¯ä¸Šè¡Œé©¶é«˜è¾¾55è‹±é‡Œ&#x2F;å°æ—¶ã€‚å½“å¹´çš„ç¥å¥‡å¹»æƒ³ï¼Œä»Šå¤©çš„ç¾å¥½ç°å®ã€‚Ernst Dickmannsï¼Œæˆä¸ºäº†è‡ªåŠ¨é©¾é©¶çš„é¼»ç¥–ï¼Œå½“å¹´çš„å¥”é©°è´§è½¦ï¼Œä¹Ÿç§°äº†è‡ªåŠ¨é©¾é©¶çš„å…ˆé©±ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144102.png" alt="img"></p>
<p>â€‹    1998å¹´ï¼ŒDave Hamptonå’ŒCaleb Chungã€‚å‘æ˜äº†Furbyï¼Œç¬¬ä¸€æ¬¾ç©å…·æœºå™¨äººã€‚2000å¹´å‰åï¼Œæ—¥æœ¬ç§‘æŠ€å…¬å¸å‡­å€Ÿç€è¾ƒå¥½çš„å·¥ä¸šåŸºç¡€ï¼Œåœ¨æ—©æœŸæ™ºèƒ½æ—¶ä»£å æ®ç€ä¸å¯æˆ–ç¼ºçš„ä½ç½®ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144234.png" alt="img"></p>
<p>â€‹    1999å¹´ï¼Œç´¢å°¼ã€‚æ¨å‡ºAIBOï¼Œä»·å€¼2000ç¾å…ƒçš„æœºå™¨äººå® ç‰©ç‹—ï¼Œä¸ç¯å¢ƒï¼Œæ‰€æœ‰è€…å’Œå…¶å®ƒAIBOçš„äº’åŠ¨æ¥â€œå­¦ä¹ â€ã€‚åŠŸèƒ½åŒ…æ‹¬èƒ½è§£å’Œå“åº”100å¤šä¸ªè¯­éŸ³å‘½ä»¤å¹¶ä¸äººç±»æ‰€æœ‰è€…è¿›è¡Œå¯¹è¯ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144268.png" alt="img"></p>
<p>â€‹    2002å¹´ï¼ŒRoombaï¼Œè‡ªåŠ¨æœºå™¨äººçœŸç©ºå¸å°˜å™¨ï¼Œé¿å¼€éšœç¢ç‰©è¿›è¡Œæ¸…æ´ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144255.png" alt="img"></p>
<p>â€‹    2006å¹´ï¼Œæ°å¼—é‡Œè¾›é¡¿ã€‚å‡ºç‰ˆã€ŠLearning Multiple Layers of Representationã€‹ï¼Œå¥ å®šç¥ç»ç½‘ç»œçš„å…¨æ–°æ¶æ„ï¼Œä»Šå¤©äººå·¥æ™ºèƒ½çš„æ ¸å¿ƒæŠ€æœ¯ã€‚çŸ­çŸ­10å¹´é—´ï¼Œæ•°å­¦å†°å±±èƒŒåï¼Œæ˜¥é£åŒ–é›¨ï¼Œå¤éœ²å‡é¦™ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144331.png" alt="img"></p>
<p>â€‹    2007å¹´ï¼ŒFei Fei Liã€‚å‡ºç”ŸäºåŒ—äº¬ï¼Œç¾å›½å›½å®¶å·¥ç¨‹é™¢é™¢å£«ï¼ŒTwitterç‹¬ç«‹è‘£äº‹ã€‚ç»„å»ºImageNetï¼Œä¸€ä¸ªæ³¨é‡Šå›¾åƒæ•°æ®åº“ï¼Œå¸®åŠ©ç‰©ä½“è¯†åˆ«ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144320.png" alt="img"></p>
<p>â€‹    2009å¹´ï¼Œå´æ©è¾¾ï¼Œä½¿ç”¨å›¾å½¢å¤„ç†å™¨ï¼ˆGPUè€Œä¸æ˜¯CPUï¼‰è¿›è¡Œå¤§è§„æ¨¡æ— ç›‘ç£å¼æœºå™¨å­¦ä¹ ã€‚å–å¾—äº†æƒŠäººçš„æˆå°±ï¼Œå‘ä¸–äººå±•ç¤ºäº†ä¸€ä¸ªè¶…å¼ºçš„ç¥ç»ç½‘ç»œï¼Œå®ƒåœ¨è‡ªä¸»è§‚çœ‹åƒä¸‡å¼ å›¾ç‰‡ä¹‹åï¼Œè¯†åˆ«å°çŒ«çš„å›¾åƒã€‚è¿™æ˜¯å†å²ä¸Šåœ¨æ²¡æœ‰äººå·¥å¹²é¢„ä¸‹ï¼Œè‡ªä¸»å¼ºåŒ–å­¦ä¹ çš„é‡Œç¨‹ç¢‘å¼äº‹ä»¶ã€‚å‘ä¸–äººå±•ç¤ºäº†æ— ç›‘ç£å­¦ä¹ çš„ä»·å€¼ï¼Œè‡ªæ­¤AIè¯†åˆ«ï¼Œæ¸©æŸ”äº†å²æœˆï¼ŒæƒŠè‰³äº†æ—¶å…‰ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144408.png" alt="img"></p>
<p>â€‹    2011å¹´ï¼ŒWatsonï¼Œç”µè§†æ¸¸æˆä¸­ã€‚å›ç­”IBMåˆ›å»ºçš„è®¡ç®—æœºè‡ªç„¶è¯­è¨€é—®é¢˜ï¼Œå‡»è´¥äº†ä¸¤ä¸ªå‰Jeopardyå† å†›ï¼Œè‚¯è©¹å®æ–¯å’Œå¸ƒæ‹‰å¾·é²ç‰¹ã€‚è‡ªç„¶è¯­è¨€å¤„ç†é€æ­¥å¼€å§‹æ­¥å…¥äººç±»ç”Ÿæ´»ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144475.png" alt="img"></p>
<p>â€‹    2015-2017ï¼ŒAlphaGoï¼Œè°·æ­ŒGoçš„è®¡ç®—æœºç¨‹åºï¼Œå‡»è´¥äº†å„ç§ï¼ˆäººç±»ï¼‰å† å†›ã€‚å½“æ—¶åå™ªä¸€æ—¶ï¼Œä¸ºäººå·¥æ™ºèƒ½åšäº†æœ€å¥½çš„æŠ€æœ¯è¥é”€ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144464.png" alt="img"></p>
<p>â€‹    2015å¹´ï¼Œè°·æ­Œã€‚å‘åŠ›è‡ªåŠ¨é©¾é©¶ï¼ŒWaymoä»Šå¤©æ˜¯è‡ªåŠ¨é©¾é©¶æ’è¡Œç¬¬ä¸€åã€‚å½“å¹´æ»¡å¤´é’ä¸çš„Ernst Dickmannsï¼Œä»Šå¤©å·²æ˜¯ç™½å‘è‹è‹ã€‚ä¸‹å›¾å³ä¸ºErnst Dickmannsã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144489.png" alt="img"></p>
<p>â€‹    2015 å¹´ï¼Œæ²ˆå‘æ´‹ï¼Œå¾®è½¯äºšæ´²ç ”ç©¶é™¢è§†è§‰è®¡ç®—ç»„å¼€å‘çš„åŸºäºæ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰çš„è®¡ç®—æœºè§†è§‰ç³»ç»Ÿï¼Œåœ¨ ImageNet1000 è¿™é¡¹è§†è§‰è¯†åˆ«æŒ‘æˆ˜ä¸­ç¬¬ä¸€ä¸ªè¶…è¶Šäººç±»è§†è§‰èƒ½åŠ›çš„è®¡ç®—æœºç³»ç»Ÿã€‚2019å¹´ï¼Œæ²ˆå‘æ´‹ç¦»å¼€å¾®è½¯ï¼Œæˆä¸ºæ¸…åå¤§å­¦åŒè˜æ•™æˆã€‚è¿™ä½æ¥è‡ªå—äº¬ï¼Œäººå·¥æ™ºèƒ½å›½é™…å·¨äººï¼ŒæŠŠä¸­å›½çš„äººå·¥æ™ºèƒ½æŠ€æœ¯æ¨å‘ä¸€ä¸ªæ–°çš„é«˜åº¦ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144595.png" alt="img"></p>
<p>â€‹    2016ï¼Œå¾®è½¯ã€‚ç»„å»ºâ€œå¾®è½¯äººå·¥æ™ºèƒ½ä¸ç ”ç©¶äº‹ä¸šéƒ¨â€(MicrosoftAI and Research Group)ã€‚äººå·¥æ™ºèƒ½æ˜¯å¾®è½¯çš„æ¢¦æƒ³ï¼Œ1991å¹´ï¼Œç›–èŒ¨å…ˆç”Ÿå°±åšè¿‡äººå·¥æ™ºèƒ½çš„é¢„è¨€ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144600.png" alt="img"></p>
<p>â€‹        äººå·¥æ™ºèƒ½åœ¨æ¨¡æ‹Ÿã€ä»¿çœŸã€æ¸¸æˆæ–¹é¢ä¹Ÿæœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œå›½å†…2015å¹´ä»¥å‰ï¼Œä»¿çœŸé¢†åŸŸæ˜¯äººå·¥æ™ºèƒ½æœ€æ ¸å¿ƒçš„é¢†åŸŸï¼Œä»¥åé€æ¸å‘å…¶å®ƒé¢†åŸŸè¿‡æ¸¡ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144674.png" alt="img"></p>
<h3 id="6-1-2ã€å¯ç¤º"><a href="#6-1-2ã€å¯ç¤º" class="headerlink" title="6.1.2ã€å¯ç¤º"></a>6.1.2ã€å¯ç¤º</h3><p>â€‹    2020å¹´å‰åï¼Œäººå·¥æ™ºèƒ½è¿æ¥äº†é«˜é€Ÿå‘å±•æœŸï¼Œ2019å¹´ï¼Œäººå·¥æ™ºèƒ½å…ƒå¹´ã€‚å¤§æ•°æ®ã€æ•°æ®æŒ–æ˜ã€æœºå™¨å­¦ä¹ ç­‰ç†è®ºç™¾èŠ±é½æ”¾ï¼Œäººå·¥æ™ºèƒ½çš„æ—¶ä»£ç»ˆäºåˆ°æ¥äº†ã€‚</p>
<p>â€‹    å‡è§†è¿™æ®µå†å²æ—¶ï¼Œæ—©æœŸçš„äººå·¥æ™ºèƒ½åé‡äºæ¨¡æ‹Ÿä»¿çœŸï¼Œæ²¡æœ‰å®æ—¶æ€§ã€‚æ‘„åƒä¸è§†é¢‘æŠ€æœ¯çš„è¿›æ­¥ï¼Œäººå·¥æ™ºèƒ½å‘å®æ—¶æ€§å‘å±•ï¼Œå®æ—¶æ€§æœ‰ç€é‡è¦æ„ä¹‰ï¼Œå¼€å¯äº†äººå·¥æ™ºèƒ½ç¤¾ä¼šåº”ç”¨æ–°ç¯‡ç« ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144706.png" alt="img"></p>
<p>â€‹    äººå·¥æ™ºèƒ½ä»£è¡¨ç€å¤§æ•°æ®é‡çš„åˆ°æ¥ï¼Œæ²¡æœ‰å¤§çš„æ•°æ®é‡æ— æ³•è¿›è¡Œæœ‰æ•ˆçš„åˆ†æï¼Œæ•°æ®å¤„ç†æ˜¯äººå·¥æ™ºèƒ½çš„æ ¸å¿ƒè¦ç´ ï¼Œæ•°æ®å¤„ç†ä»Šå¤©ç”±å¹¶è¡Œè®¡ç®—æ¥å®Œæˆã€‚</p>
<p>â€‹    å¤§çš„æ•°æ®é‡ä¸ä»…å¯¹ç®—æ³•æœ‰è¦æ±‚ï¼Œå¯¹ç®—åŠ›ä¹Ÿæ˜¯ä¸€ä¸ªè€ƒéªŒã€‚äººå·¥æ™ºèƒ½éœ€è¦å·¨å¤§çš„ç®—åŠ›ï¼Œæ²¡æœ‰ç®—åŠ›è°ˆä¸ä¸Šäººå·¥æ™ºèƒ½ã€‚ç›®å‰åœ¨äººå·¥æ™ºèƒ½åˆçº§é˜¶æ®µï¼Œç§‘æŠ€å…¬å¸ç®—åŠ›ä¸»è¦é CPUã€GPUã€‚å¤§çš„ç§‘æŠ€å…¬å¸é è¶…ç®—ä¸­å¿ƒã€VPGã€APUã€TPUã€NPUç­‰æ¥è§£å†³ã€‚å¤§æ•°æ®çš„è¶…å¼ºèƒ½åŠ›ï¼Œä¸ºäººå·¥æ™ºèƒ½çš„ç®—åŠ›æä¾›å¼ºæœ‰åŠ›çš„æ”¯æŒã€‚</p>
<p>â€‹    äººå·¥æ™ºèƒ½ç›®å‰é˜¶æ®µä¸¤ä¸ªä¸»è¦è¡¨ç°ï¼Œç¬¬ä¸€ä¸ªæ˜¯è‡ªç„¶è¯­è¨€å¤„ç†ï¼Œç¬¬äºŒä¸ªæ˜¯æœºå™¨è§†è§‰ã€‚è‡ªç„¶æ–‡å­—ç¬¦å·å’ŒéŸ³è§†é¢‘æ˜¯äººç±»ä¿¡æ¯ä¸¤ä¸ªé‡è¦çš„è½½ä½“ã€‚</p>
<p>â€‹    æœºå™¨è§†è§‰ï¼Œå¾ˆå¤šå¹´å‰ï¼Œå›½å¤–æœ‰ä¸€äº›å…¬å¸åœ¨åšï¼Œä»…é™äºä¸€äº›ä¸“ä¸šé¢†åŸŸã€‚90å¹´ä»£è¿›å…¥å›½å†…åï¼Œä¸­ç§‘é™¢ç‰©ç†æ‰€å¼•è¿›å›½å¤–ä¸“ä¸šç›¸æœºï¼Œç»“åˆå›½å†…åº”ç”¨ï¼Œå¼€å‘å‡ºç›¸å…³æ£€æµ‹ç³»ç»Ÿã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192144737.png" alt="img"></p>
<p>â€‹    æ–°çš„ç¡¬ä»¶ä¸æ˜¾ç¤ºæ ‡å‡†å¯¹æ™ºèƒ½è§†è§‰å¤„ç†æœ‰ç€å¾ˆå¤§æ¨åŠ¨ï¼Œéšç€å¹¶è¡Œè®¡ç®—çš„å‘å±•ã€‚å¯ä»¥åšä¿¡çš„æ˜¯ï¼Œè§†è§‰æ™ºèƒ½æ˜¯æœªæ¥äººå·¥æ™ºèƒ½å‘å±•çš„é‡è¦æ–¹å‘ã€‚</p>
<h2 id="6-2ã€ç¡¬ä»¶å‘å±•"><a href="#6-2ã€ç¡¬ä»¶å‘å±•" class="headerlink" title="6.2ã€ç¡¬ä»¶å‘å±•"></a>6.2ã€ç¡¬ä»¶å‘å±•</h2><p>â€‹    äººå·¥æ™ºèƒ½æ—¶ä»£éœ€è¦ç¡¬ä»¶çš„æ”¯æŒï¼Œä¸ä»…ä»…æ˜¯å¤–è®¾ï¼Œæ›´æ˜¯æ•°æ®è®¡ç®—ã€‚åœ¨æ­¤éœ€æ±‚ä¸‹ï¼Œä¸ä»…å¤–è®¾çš„ç¹è£ï¼Œæ›´æ˜¯èŠ¯ç‰‡æŠ€æœ¯çš„çˆ†å‘ã€‚</p>
<p>â€‹    èŠ¯ç‰‡æŠ€æœ¯ä¸ºæ™ºèƒ½å¤„ç†æä¾›äº†åŸºç¡€ï¼Œåœ¨æ•°æ®é˜¶æ®µå¤„ç†ï¼Œä¸ºCPUã€GPUæä¾›ç‰©ç†è®¡ç®—åŸºç¡€ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œæœ‰äº†å¹¶è¡Œè®¡ç®—æ¶æ„ã€‚æ— è®ºäº‘å¹³å°ã€å¤§æ•°æ®ã€æœºå™¨å­¦ä¹ ã€åŒºå—é“¾æ— ä¸€ä¸æ˜¯å»ºç«‹åœ¨å¹¶è¡Œè®¡ç®—çš„åŸºç¡€ä¸Šã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147639.jpeg" alt="https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=3453621467,281658853&amp;fm=26&amp;gp=0.jpg"></p>
<p>â€‹    60å¹´ä»£ï¼Œä¸­å›½æŒ¥å‰‘æ–©èŠ¯ç‰‡ï¼Œä¸§å¤±å‘å±•å…ˆæœºã€‚ä»Šå¤©ï¼Œå€¾å›½ä¹‹åŠ›ï¼Œåä¸‡äº¿çº§æŠ•èµ„ï¼Œå‘å±•èŠ¯ç‰‡ï¼Œç•™ç»™æˆ‘ä»¬å¤šå°‘å¯ç¤ºã€‚</p>
<p>â€‹    ä¸‹é¢é€šè¿‡èŠ¯ç‰‡ã€ç›¸æœºä¼ æ„Ÿå™¨ç¡¬ä»¶è§’åº¦è®²è¿°ï¼Œå…¶å®ƒå±‚é¢å‚è€ƒç›¸å…³èµ„æ–™ã€‚æ™ºèƒ½æ—¶ä»£çš„æœºå™¨è§†è§‰è§†é¢‘æ¥è‡ªäºç›¸æœºï¼Œè€ƒè™‘äº†ç›¸æœºå› ç´ ã€‚</p>
<h3 id="6-2-1ã€AI-AR-VRèŠ¯ç‰‡"><a href="#6-2-1ã€AI-AR-VRèŠ¯ç‰‡" class="headerlink" title="6.2.1ã€AI&#x2F;AR&#x2F;VRèŠ¯ç‰‡"></a>6.2.1ã€AI&#x2F;AR&#x2F;VRèŠ¯ç‰‡</h3><p>â€‹    äººå·¥æ™ºèƒ½é¦–å…ˆæ˜¯ç¡¬ä»¶æŠ€æœ¯çš„è¿›æ­¥ï¼Œç¡¬ä»¶æŠ€æœ¯çš„æ ¸å¿ƒæ˜¯èŠ¯ç‰‡ã€‚èŠ¯ç‰‡æŠ€æœ¯æ˜¯é›†æˆç”µè·¯çš„é«˜åº¦å°è£…ã€‚èŠ¯ç‰‡æŠ€æœ¯æ˜¯åŠå¯¼ä½“æŠ€æœ¯çš„ä½“ç°ï¼Œæ•´ä¸ªç”Ÿäº§è¿‡ç¨‹ä¸äº§ä¸šé“¾è¾ƒé•¿ï¼Œéœ€è¦å¤šå®¶å…¬å¸åˆä½œæ‰èƒ½å®Œæˆã€‚</p>
<p>â€‹    é¡¶çº§ç§‘æŠ€å…¬å¸é’Ÿæƒ…äºèŠ¯ç‰‡ç ”å‘ï¼ŒåŒ…æ‹¬AI&#x2F;AR&#x2F;VRèŠ¯ç‰‡ç ”å‘ã€‚å¾®è½¯ã€ç‰¹æ–¯æ‹‰ã€è‹±ä¼Ÿè¾¾ã€facebookã€è°·æ­Œã€NXPã€åä¸ºç­‰ã€‚äººå·¥æ™ºèƒ½æ—¶ä»£çš„åˆ°æ¥ï¼ŒèŠ¯ç‰‡çš„å¤šæ ·æ€§ä¸åŠŸèƒ½æ€§éƒ½æœ‰å¾ˆå¤§å˜åŒ–ã€‚æŠ€æœ¯çš„é£èµ·äº‘æ¶Œï¼Œä¸ºèŠ¯ç‰‡åˆ¶é€ æä¾›äº†å¥‘æœºã€‚</p>
<p>â€‹    äººå·¥æ™ºèƒ½æ—¶ä»£ï¼ŒAI&#x2F;AR&#x2F;VRèŠ¯ç‰‡å¿«é€Ÿå‘å±•ï¼Œä¸ºäººå·¥æ™ºèƒ½æä¾›æ¾æ¹ƒåŠ¨åŠ›æ”¯æŒã€‚èŠ¯ç‰‡æŠ€æœ¯æ˜¯äººå·¥æ™ºèƒ½åç»­é˜¶æ®µçš„å…³é”®æŠ€æœ¯ï¼Œæ²¡æœ‰èŠ¯ç‰‡æŠ€æœ¯çš„è¿›æ­¥ï¼Œäººå·¥æ™ºèƒ½å°†ä¼šä¸¾æ­¥ä¸å‰ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147689.png" alt="img"></p>
<h3 id="6-2-2ã€ç›¸æœºèŠ¯ç‰‡"><a href="#6-2-2ã€ç›¸æœºèŠ¯ç‰‡" class="headerlink" title="6.2.2ã€ç›¸æœºèŠ¯ç‰‡"></a>6.2.2ã€ç›¸æœºèŠ¯ç‰‡</h3><p>â€‹    ç›¸æœºï¼Œè®°å½•ç€ç¤¾ä¼šæ–‡æ˜ã€‚ç›¸æœºï¼Œç•™å­˜ç€ç¤¾ä¼šç‚¹æ»´ã€‚ç›¸æœºï¼ŒåŠ©åŠ›ç€ç”Ÿäº§ç”Ÿæ´»ã€‚ç›¸æœºï¼Œæ˜¯æœºå™¨è§†è§‰ç¬¬ä¸€æ­¥çš„è¡¨è¾¾ã€‚</p>
<p>â€‹    æ•´ä¸ªè§†é¢‘å¤„ç†æµç¨‹ï¼Œç›¸æœºæ˜¯å‰ç«¯ï¼Œæœºå™¨è§†è§‰éƒ¨åˆ†å¤„ç†åœ¨å‰ç«¯å®ç°ã€‚å­¦ä¹ æœºå™¨è§†è§‰ï¼Œæœ‰å¿…è¦å¯¹ç›¸æœºç®€å•äº†è§£ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147646.png" alt="img"></p>
<p>â€‹        å¯¹äºå·¥ä¸šè§†é¢‘è€Œè¨€ï¼Œç›¸æœºæ˜¯é‡ä¸­ä¹‹é‡ï¼Œç›¸æœºæŠ€æœ¯æœ‰å¾ˆå¤šåˆ†ç±»ã€‚æœ¬éƒ¨åˆ†é€šè¿‡ä¼ ç»Ÿç›¸æœºå’Œå·¥ä¸šç›¸æœºè¿›è¡Œè®²è¿°ã€‚</p>
<h4 id="6-2-2-1ã€ä¼ ç»Ÿç›¸æœº"><a href="#6-2-2-1ã€ä¼ ç»Ÿç›¸æœº" class="headerlink" title="6.2.2.1ã€ä¼ ç»Ÿç›¸æœº"></a>6.2.2.1ã€ä¼ ç»Ÿç›¸æœº</h4><p>â€‹    ç›¸æœºæŠ€æœ¯å‘å±•å¤šå¹´ï¼Œä¸»è¦æ˜¯å›¾åƒä¼ æ„Ÿå™¨çš„å‘å±•ï¼Œç›®å‰åˆ†ä¸ºCCDå’ŒCMOSä¸¤ç§ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147725.png" alt="img"></p>
<h5 id="6-2-2-1-1ã€CCD"><a href="#6-2-2-1-1ã€CCD" class="headerlink" title="6.2.2.1.1ã€CCD"></a>6.2.2.1.1ã€CCD</h5><p>â€‹    CCDèŠ¯ç‰‡æ˜¯å°†å…‰ä¿¡å·è½¬æ¢æˆç”µä¿¡å·çš„èŠ¯ç‰‡ï¼Œåœ¨æ•°ç ç›¸æœºã€æ‘„åƒæœºä¸­ï¼Œå…‰ä¿¡å·è½¬æ¢æˆç”µä¿¡å·ï¼Œç„¶åå¤„ç†ï¼Œç¼–ç¨‹æ•°ç ç…§ç‰‡æ–‡ä»¶ã€‚</p>
<p>â€‹    CCDèŠ¯ç‰‡ï¼Œä½¿ç”¨é«˜æ„Ÿå…‰åº¦çš„åŠå¯¼ä½“ææ–™åˆ¶æˆï¼ŒæŠŠå…‰çº¿è½¬å˜æˆç”µè·ï¼Œé€šè¿‡æ¨¡æ•°è½¬æ¢å™¨èŠ¯ç‰‡è½¬æ¢æˆæ•°å­—ä¿¡å·ï¼Œæ•°å­—ä¿¡å·ç»è¿‡å‹ç¼©åç”±ç›¸æœºå†…éƒ¨çš„å­˜å‚¨è®¾å¤‡ä¿å­˜ï¼Œç„¶åæŠŠæ•°æ®ä¼ è¾“ç»™è®¡ç®—æœºï¼Œå€ŸåŠ©äºè®¡ç®—æœºçš„å¤„ç†æ‰‹æ®µï¼Œæ ¹æ®éœ€è¦å’Œæƒ³åƒæ¥ä¿®æ”¹å›¾åƒã€‚</p>
<p>â€‹    CCDèŠ¯ç‰‡ç”±æ„Ÿå…‰å•ä½ç»„æˆï¼Œé€šå¸¸ä»¥ç™¾ä¸‡åƒç´ ä¸ºå•ä½ã€‚CCDè¡¨é¢å—åˆ°å…‰çº¿ç…§å°„æ—¶ï¼Œæ¯ä¸ªæ„Ÿå…‰å•ä½ä¼šå°†ç”µè·åæ˜ åœ¨ç»„ä»¶ä¸Šï¼Œæ‰€æœ‰çš„æ„Ÿå…‰å•ä½æ‰€äº§ç”Ÿçš„ä¿¡å·åŠ åœ¨ä¸€èµ·ï¼Œæ„æˆäº†ä¸€å¹…å®Œæ•´çš„ç”»é¢ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147694.png" alt="img"></p>
<p>â€‹    CCDå›¾åƒä¼ æ„Ÿå™¨æ˜¯æŒ‰ä¸€å®šè§„å¾‹æ’åˆ—çš„mosï¼ˆé‡‘å±â€”æ°§åŒ–ç‰©â€”åŠå¯¼ä½“ï¼‰ç”µå®¹å™¨ç»„æˆçš„é˜µåˆ—ï¼Œåœ¨på‹æˆ–nå‹ç¡…è¡¬åº•ä¸Šç”Ÿé•¿ä¸€å±‚å¾ˆè–„ï¼ˆçº¦120nmï¼‰çš„äºŒæ°§åŒ–ç¡…ï¼Œå†åœ¨äºŒæ°§åŒ–ç¡…è–„å±‚ä¸Šä¾æ¬¡åºæ²‰ç§¯é‡‘å±æˆ–æºæ‚å¤šæ™¶ç¡…ç”µæï¼ˆæ …æï¼‰ï¼Œå½¢æˆè§„åˆ™çš„mosç”µå®¹å™¨é˜µåˆ—ï¼Œå†åŠ ä¸Šä¸¤ç«¯çš„è¾“å…¥åŠè¾“å‡ºäºŒæç®¡å°±æ„æˆäº†CCDèŠ¯ç‰‡ã€‚</p>
<h5 id="6-2-2-1-2ã€CMOS"><a href="#6-2-2-1-2ã€CMOS" class="headerlink" title="6.2.2.1.2ã€CMOS"></a>6.2.2.1.2ã€CMOS</h5><p>â€‹    CMOSç›¸æœºé‡‡ç”¨CMOSå›¾åƒä¼ æ„Ÿå™¨çš„è®¾å¤‡ã€‚CMOSä¸€èˆ¬åº”ç”¨åœ¨æ™®é€šæ•°ç è®¾å¤‡ä¸­ï¼ŒCCDä¸€èˆ¬åº”ç”¨é«˜æ¡£æ•°ç è®¾å¤‡ä¸­ï¼ŒCCDæ¯”CMOSå•ä½æˆåƒçš„æ•ˆæœè¦å¥½ã€‚CCDé•œå¤´æ¯”CMOSåˆ†è¾¨ç‡è¦é«˜ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147761.png" alt="img"></p>
<p>â€‹    CCDå’ŒCMOSåœ¨åˆ¶é€ ä¸Šçš„ä¸»è¦åŒºåˆ«æ˜¯CCDæ˜¯é›†æˆåœ¨åŠå¯¼ä½“å•æ™¶ææ–™ä¸Šï¼Œè€ŒCMOSæ˜¯é›†æˆåœ¨è¢«ç§°åšé‡‘å±æ°§åŒ–ç‰©çš„åŠå¯¼ä½“ææ–™ä¸Šã€‚CCDåªæœ‰å°‘æ•°å‡ ä¸ªå‚å•†ç´¢å°¼ã€æ¾ä¸‹ç­‰æŒæ¡è¿™ç§æŠ€æœ¯ã€‚CCDåˆ¶é€ å·¥è‰ºè¾ƒå¤æ‚ï¼Œé‡‡ç”¨CCDçš„æ‘„åƒå¤´ä»·æ ¼æ˜‚è´µã€‚</p>
<p>â€‹    ç›¸åŒåƒç´ ä¸‹CCDçš„æˆåƒé€šé€æ€§ã€æ˜é”åº¦éƒ½å¾ˆå¥½ï¼Œè‰²å½©è¿˜åŸã€æ›å…‰å¯ä»¥ä¿è¯åŸºæœ¬å‡†ç¡®ã€‚CMOSç”±äºä½å»‰çš„ä»·æ ¼ä»¥åŠé«˜åº¦çš„æ•´åˆæ€§ï¼Œå› æ­¤åœ¨æ‘„åƒå¤´é¢†åŸŸè¿˜æ˜¯å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚</p>
<p>â€‹    CMOSçš„ä¿¡å·æ˜¯ä»¥ç‚¹ä¸ºå•ä½çš„ç”µè·ä¿¡å·ï¼Œè€ŒCCDæ˜¯ä»¥è¡Œä¸ºå•ä½çš„ç”µæµä¿¡å·ï¼Œå‰è€…æ›´ä¸ºæ•æ„Ÿï¼Œé€Ÿåº¦ä¹Ÿæ›´å¿«ï¼Œæ›´ä¸ºçœç”µã€‚é«˜çº§çš„CMOSå¹¶ä¸æ¯”ä¸€èˆ¬CCDå·®ï¼ŒCMOSå·¥è‰ºè¿˜ä¸æ˜¯ååˆ†æˆç†Ÿï¼Œæ™®é€šçš„CMOSä¸€èˆ¬åˆ†è¾¨ç‡ä½è€Œæˆåƒè¾ƒå·®ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147893.png" alt="img"></p>
<p>â€‹    CCDæˆ–CMOSï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯åˆ©ç”¨çŸ½æ„Ÿå…‰äºŒæä½“è¿›è¡Œå…‰ä¸ç”µçš„è½¬æ¢ã€‚å…‰çº¿è¶Šå¼ºã€ç”µåŠ›è¶Šå¼ºï¼›åä¹‹ï¼Œå…‰çº¿è¶Šå¼±ã€ç”µåŠ›ä¹Ÿè¶Šå¼±çš„é“ç†ï¼Œå°†å…‰å½±åƒè½¬æ¢ä¸ºç”µå­æ•°å­—ä¿¡å·ã€‚</p>
<p>â€‹    CCDæ¯æ›å…‰ä¸€æ¬¡ï¼Œåœ¨å¿«é—¨å…³é—­åè¿›è¡Œåƒç´ è½¬ç§»å¤„ç†ï¼Œå°†æ¯ä¸€è¡Œä¸­æ¯ä¸€ä¸ªåƒç´ ï¼ˆpixelï¼‰çš„ç”µè·ä¿¡å·ä¾åºä¼ å…¥â€œç¼“å†²å™¨â€ä¸­ï¼Œç”±åº•ç«¯çš„çº¿è·¯å¼•å¯¼è¾“å‡ºè‡³CCDæ—çš„æ”¾å¤§å™¨è¿›è¡Œæ”¾å¤§ï¼Œå†ä¸²è”ADCè¾“å‡ºï¼›ç›¸å¯¹åœ°ï¼ŒCMOSçš„è®¾è®¡ä¸­æ¯ä¸ªåƒç´ æ—å°±ç›´æ¥è¿ç€ADCï¼ˆæ”¾å¤§å…¼ç±»æ¯”æ•°å­—ä¿¡å·è½¬æ¢å™¨ï¼‰ï¼Œä¿¡å·ç›´æ¥æ”¾å¤§å¹¶è½¬æ¢æˆæ•°å­—ä¿¡å·ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147035.png" alt="img"></p>
<p>â€‹    CCDçš„å……åˆ†ä¿æŒä¿¡å·ä¼ è¾“æ—¶ä¸å¤±çœŸï¼Œé€è¿‡æ¯ä¸€ä¸ªåƒç´ é›†åˆè‡³å•ä¸€æ”¾å¤§å™¨ä¸Šå†åšç»Ÿä¸€å¤„ç†ï¼Œä¿æŒèµ„æ–™çš„å®Œæ•´æ€§ï¼›CMOSåˆ¶ç¨‹ç®€å•ï¼Œæ²¡æœ‰ä¸“å±é€šé“ï¼Œå¿…é¡»å…ˆæ”¾å¤§å†æ•´åˆå„ä¸ªåƒç´ èµ„æ–™ã€‚</p>
<p>â€‹    ç”±äºCMOSæ¯ä¸ªåƒç´ åŒ…å«äº†æ”¾å¤§å™¨ä¸A&#x2F;Dè½¬æ¢ç”µè·¯ï¼Œè¿‡å¤šçš„é¢å¤–è®¾å¤‡å‹ç¼©å•ä¸€åƒç´ çš„æ„Ÿå…‰åŒºåŸŸçš„è¡¨é¢ç§¯ï¼Œå› æ­¤ç›¸åŒåƒç´ ä¸‹ï¼ŒåŒæ ·å¤§å°ä¹‹æ„Ÿå…‰å™¨å°ºå¯¸ï¼ŒCMOSçš„æ„Ÿå…‰åº¦ä¼šä½äºCCDã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147982.png" alt="img"></p>
<p>â€‹    CMOSåº”ç”¨åŠå¯¼ä½“å·¥ä¸šå¸¸ç”¨çš„MOSåˆ¶ç¨‹ï¼Œä¸€æ¬¡æ•´åˆå…¨éƒ¨å‘¨è¾¹è®¾æ–½äºå•æ™¶ç‰‡ä¸­ï¼ŒèŠ‚çœåŠ å·¥æ™¶ç‰‡æ‰€éœ€è´Ÿæ‹…çš„æˆæœ¬å’Œè‰¯ç‡çš„æŸå¤±ï¼›CCDé‡‡ç”¨ç”µè·ä¼ é€’çš„æ–¹å¼è¾“å‡ºèµ„è®¯ï¼Œå¿…é¡»å¦è¾Ÿä¼ è¾“é€šé“ï¼Œå¦‚æœé€šé“ä¸­æœ‰ä¸€ä¸ªåƒç´ æ•…éšœï¼ˆFailï¼‰ï¼Œå°±ä¼šå¯¼è‡´ä¸€æ•´æ’çš„è®¯å·å£…å¡ï¼Œæ— æ³•ä¼ é€’ã€‚</p>
<p>â€‹    CMOSæ¯ä¸ªæ„Ÿå…‰äºŒæä½“æ—éƒ½æ­é…ä¸€ä¸ªADCæ”¾å¤§å™¨ï¼Œå¦‚æœä»¥ç™¾ä¸‡åƒç´ è®¡ï¼Œéœ€è¦ç™¾ä¸‡ä¸ªä»¥ä¸Šçš„ADCæ”¾å¤§å™¨ï¼Œè™½ç„¶æ˜¯ç»Ÿä¸€åˆ¶é€ ä¸‹çš„äº§å“ï¼Œæ¯ä¸ªæ”¾å¤§å™¨æˆ–å¤šæˆ–å°‘éƒ½æœ‰äº›å¾®çš„å·®å¼‚å­˜åœ¨ï¼Œå¾ˆéš¾è¾¾åˆ°åŒæ­¥æ”¾å¤§çš„æ•ˆæœï¼Œå¯¹æ¯”å•ä¸€ä¸ªæ”¾å¤§å™¨çš„CCDï¼ŒCMOSæœ€ç»ˆè®¡ç®—å‡ºçš„å™ªç‚¹å°±æ¯”è¾ƒå¤šã€‚</p>
<p>â€‹    å¸‚åœºé”€å”®çš„æ•°ç æ‘„åƒå¤´ä¸­ä»¥CMOSæ„Ÿå…‰å™¨ä»¶çš„ä¸ºä¸»ã€‚åœ¨é‡‡ç”¨CMOSä¸ºæ„Ÿå…‰å…ƒå™¨ä»¶çš„äº§å“ä¸­ï¼Œé‡‡ç”¨å½±åƒå…‰æºè‡ªåŠ¨å¢ç›Šè¡¥å¼ºæŠ€æœ¯ï¼Œè‡ªåŠ¨äº®åº¦ã€ç™½å¹³è¡¡æ§åˆ¶æŠ€æœ¯ï¼Œè‰²é¥±å’Œåº¦ã€å¯¹æ¯”åº¦ã€è¾¹ç¼˜å¢å¼ºä»¥åŠä¼½é©¬çŸ«æ­£ç­‰å…ˆè¿›çš„å½±åƒæ§åˆ¶æŠ€æœ¯ï¼Œå®Œå…¨å¯ä»¥è¾¾åˆ°ä¸CCDæ‘„åƒå¤´ç›¸åª²ç¾çš„æ•ˆæœã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147015.png" alt="img"></p>
<p>â€‹    å°½ç®¡CCDåœ¨å½±åƒå“è´¨ç­‰æ–¹é¢å‡ä¼˜äºCMOSï¼Œä¸å¯å¦è®¤çš„CMOSå…·æœ‰ä½æˆæœ¬ã€ä½è€—ç”µä»¥åŠé«˜æ•´åˆåº¦çš„ç‰¹æ€§ã€‚CMOSçš„ä½æˆæœ¬å’Œç¨³å®šä¾›è´§ï¼Œæ‰€ä»¥å¹¿æ³›ä½¿ç”¨ï¼Œåˆ¶é€ æŠ€æœ¯ä¸æ–­åœ°æ”¹è‰¯æ›´æ–°ï¼Œä½¿å¾—CCDä¸CMOSä¸¤è€…çš„å·®å¼‚é€æ¸ç¼©å°ã€‚</p>
<h4 id="6-2-2-2ã€å·¥ä¸šç›¸æœº"><a href="#6-2-2-2ã€å·¥ä¸šç›¸æœº" class="headerlink" title="6.2.2.2ã€å·¥ä¸šç›¸æœº"></a>6.2.2.2ã€å·¥ä¸šç›¸æœº</h4><p>â€‹    å·¥ä¸šç›¸æœºæ˜¯æœºå™¨è§†è§‰ç³»ç»Ÿä¸­çš„å…³é”®ç»„ä»¶ï¼Œæœ¬è´¨åŠŸèƒ½å°±æ˜¯å°†å…‰ä¿¡å·è½¬å˜æˆæœ‰åºçš„ç”µä¿¡å·ã€‚é€‰æ‹©åˆé€‚çš„ç›¸æœºä¹Ÿæ˜¯æœºå™¨è§†è§‰ç³»ç»Ÿè®¾è®¡ä¸­çš„é‡è¦ç¯èŠ‚ï¼Œç›¸æœºçš„é€‰æ‹©ä¸ä»…ç›´æ¥å†³å®šæ‰€é‡‡é›†åˆ°çš„å›¾åƒåˆ†è¾¨ç‡ã€å›¾åƒè´¨é‡ç­‰ï¼ŒåŒæ—¶ä¸æ•´ä¸ªè§†è§‰ç³»ç»Ÿçš„è¿è¡Œæ¨¡å¼ç›´æ¥ç›¸å…³ã€‚ </p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147005.jpeg" alt="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1608566505281&amp;di=7b7d2283ab97792c4f33165fd0252355&amp;imgtype=0&amp;src=http%3A%2F%2Fa.img.youboy.com%2Fcoimg%2F2010%2F4%2F16%2Fg3_2764572.jpg"></p>
<p>â€‹    å·¥ä¸šç›¸æœºä¿—ç§°æ‘„åƒæœºï¼Œç›¸æ¯”äºä¼ ç»Ÿçš„æ°‘ç”¨ç›¸æœºï¼ˆæ‘„åƒæœºï¼‰è€Œè¨€ï¼Œå®ƒå…·æœ‰é«˜çš„å›¾åƒç¨³å®šæ€§ã€é«˜ä¼ è¾“èƒ½åŠ›å’Œé«˜æŠ—å¹²æ‰°èƒ½åŠ›ç­‰ï¼Œå¸‚é¢ä¸Šå·¥ä¸šç›¸æœºå¤§å¤šæ˜¯åŸºäºCCDï¼ˆCharge Coupled Deviceï¼‰æˆ–CMOSï¼ˆComplementary Metal Oxide Semiconductorï¼‰èŠ¯ç‰‡çš„ç›¸æœºã€‚</p>
<p>â€‹    CCDæ˜¯ç›®å‰æœºå™¨è§†è§‰å¸¸ç”¨çš„å›¾åƒä¼ æ„Ÿå™¨ã€‚å®ƒé›†å…‰ç”µè½¬æ¢åŠç”µè·å­˜è´®ã€ç”µè·è½¬ç§»ã€ä¿¡å·è¯»å–äºä¸€ä½“ï¼Œæ˜¯å…¸å‹çš„å›ºä½“æˆåƒå™¨ä»¶ã€‚çªå‡ºç‰¹ç‚¹æ˜¯ä»¥ç”µè·ä½œä¸ºä¿¡å·ï¼Œä¸åŒäºå…¶å®ƒå™¨ä»¶æ˜¯ä»¥ç”µæµæˆ–è€…ç”µå‹ä¸ºä¿¡å·ã€‚é€šè¿‡å…‰ç”µè½¬æ¢å½¢æˆç”µè·åŒ…ï¼Œè€Œååœ¨é©±åŠ¨è„‰å†²çš„ä½œç”¨ä¸‹è½¬ç§»ã€æ”¾å¤§è¾“å‡ºå›¾åƒä¿¡å·ã€‚å…¸å‹çš„CCDç›¸æœºç”±å…‰å­¦é•œå¤´ã€æ—¶åºåŠåŒæ­¥ä¿¡å·å‘ç”Ÿå™¨ã€å‚ç›´é©±åŠ¨å™¨ã€æ¨¡æ‹Ÿ&#x2F;æ•°å­—ä¿¡å·å¤„ç†ç”µè·¯ç»„æˆã€‚CCDä½œä¸ºä¸€ç§åŠŸèƒ½å™¨ä»¶ï¼Œä¸çœŸç©ºç®¡ç›¸æ¯”ï¼Œå…·æœ‰æ— ç¼ä¼¤ã€æ— æ»åã€ä½ç”µå‹å·¥ä½œã€ä½åŠŸè€—ç­‰ä¼˜ç‚¹ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147051.png" alt="img"></p>
<p>â€‹    CMOSå›¾åƒä¼ æ„Ÿå™¨çš„å¼€å‘æœ€æ—©å‡ºç°åœ¨20ä¸–çºª70 å¹´ä»£åˆï¼Œ90 å¹´ä»£åˆæœŸï¼Œè¶…å¤§è§„æ¨¡é›†æˆç”µè·¯ (VLSI)åˆ¶é€ å·¥è‰ºæŠ€æœ¯çš„å‘å±•ï¼ŒCMOSå›¾åƒä¼ æ„Ÿå™¨å¾—åˆ°è¿…é€Ÿå‘å±•ã€‚CMOSå›¾åƒä¼ æ„Ÿå™¨å°†å…‰æ•å…ƒé˜µåˆ—ã€å›¾åƒä¿¡å·æ”¾å¤§å™¨ã€ä¿¡å·è¯»å–ç”µè·¯ã€æ¨¡æ•°è½¬æ¢ç”µè·¯ã€å›¾åƒä¿¡å·å¤„ç†å™¨åŠæ§åˆ¶å™¨é›†æˆåœ¨ä¸€å—èŠ¯ç‰‡ä¸Šï¼Œè¿˜å…·æœ‰å±€éƒ¨åƒç´ çš„ç¼–ç¨‹éšæœºè®¿é—®çš„ä¼˜ç‚¹ã€‚CMOSå›¾åƒä¼ æ„Ÿå™¨ä»¥å…¶è‰¯å¥½çš„é›†æˆæ€§ã€ä½åŠŸè€—ã€é«˜é€Ÿä¼ è¾“å’Œå®½åŠ¨æ€èŒƒå›´ç­‰ç‰¹ç‚¹å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚</p>
<p>â€‹    å·¥ä¸šè§†è§‰ç¦»ä¸å¼€ç›¸æœºçš„æ”¯æŒï¼Œåœ¨ä¸€äº›é«˜ç«¯é¢†åŸŸï¼Œå¿…é¡»ç”¨å·¥ä¸šç›¸æœºæ¥å¤„ç†ã€‚å·¥ä¸šç›¸æœºæ˜¯æ°‘ç”¨ç›¸æœºçš„å¢å¼ºç‰ˆï¼Œæœ¬è´¨ä¾ç„¶é‡‡ç”¨CCDæˆ–è€…CMOSæŠ€æœ¯ã€‚ç›¸å¯¹æ°‘ç”¨ç›¸æœºï¼Œç”¨æ›´é«˜çš„è½¯ç¡¬ä»¶é…ç½®ï¼Œæ›´å¤§çš„åŠŸè€—è·å¾—æ›´å¥½çš„è´¨é‡ã€‚</p>
<h3 id="6-2-2-3ã€æ€»ç»“"><a href="#6-2-2-3ã€æ€»ç»“" class="headerlink" title="6.2.2.3ã€æ€»ç»“"></a>6.2.2.3ã€æ€»ç»“</h3><p>â€‹    äººå·¥æ™ºèƒ½å›¾åƒå¤„ç†ï¼Œå·¥ä¸šä¸Šï¼Œå¯¹é«˜æ¸…æ™°ç…§ç‰‡è¿›è¡Œå¤„ç†ã€‚å…¶å®ƒé¢†åŸŸï¼Œæ˜¯æ¶ˆè´¹çº§çš„å¤„ç†ã€‚æŠ€æœ¯çš„è¿›æ­¥ï¼Œé«˜æ¸…æ™°ç›¸æœºåœ¨æ¶ˆè´¹çº§å¸‚åœºåº”ç”¨ï¼Œé«˜æ¸…ç…§ç‰‡çš„æ¶ˆè´¹çº§æŠ€æœ¯å¤„ç†å°†ä¼šæ˜¾ç°ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147242.png" alt="img"></p>
<p>â€‹    å·¥ä¸šè§†é¢‘çš„å¤„ç†é é«˜ç«¯ç¡¬ä»¶å®ç°ï¼Œæ¶ˆè´¹çº§é«˜æ¸…è§†é¢‘çš„å¤„ç†ï¼Œè¿˜éœ€è¦æ–°çš„æŠ€æœ¯æ¡†æ¶æ”¯æŒã€‚åœ¨æœªæ¥å‡ å¹´å°†æœ‰æ–°çš„æœºä¼šå‡ºç°ã€‚</p>
<h2 id="6-3ã€æœºå™¨è§†è§‰"><a href="#6-3ã€æœºå™¨è§†è§‰" class="headerlink" title="6.3ã€æœºå™¨è§†è§‰"></a>6.3ã€æœºå™¨è§†è§‰</h2><p>â€‹    æœºå™¨è§†è§‰æ˜¯äººå·¥æ™ºèƒ½å¿«é€Ÿå‘å±•çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä¹Ÿæ˜¯æ™ºèƒ½è§†è§‰é‡è¦çš„ä¸€éƒ¨åˆ†ã€‚æœºå™¨è§†è§‰å°±æ˜¯ç”¨æœºå™¨ä»£æ›¿äººçœ¼æ¥åšæµ‹é‡å’Œåˆ¤æ–­ã€‚</p>
<p>â€‹    æœºå™¨è§†è§‰ç³»ç»Ÿé€šè¿‡æœºå™¨è§†è§‰äº§å“(å³å›¾åƒæ‘„å–è£…ç½®ï¼Œåˆ†CMOSå’ŒCCDä¸¤ç§)å°†è¢«æ‘„å–ç›®æ ‡è½¬æ¢æˆå›¾åƒä¿¡å·ï¼Œä¼ é€ç»™ä¸“ç”¨çš„å›¾åƒå¤„ç†ç³»ç»Ÿï¼Œå¾—åˆ°è¢«æ‘„ç›®æ ‡çš„å½¢æ€ä¿¡æ¯ã€‚æ ¹æ®åƒç´ åˆ†å¸ƒå’Œäº®åº¦ã€é¢œè‰²ç­‰ä¿¡æ¯ï¼Œè½¬å˜æˆæ•°å­—åŒ–ä¿¡å·;å›¾åƒç³»ç»Ÿå¯¹è¿™äº›ä¿¡å·è¿›è¡Œå„ç§è¿ç®—æ¥æŠ½å–ç›®æ ‡çš„ç‰¹å¾ï¼Œè¿›è€Œæ ¹æ®åˆ¤åˆ«çš„ç»“æœæ§åˆ¶ç°åœºçš„è®¾å¤‡åŠ¨ä½œã€‚ </p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147722.png" alt="img"></p>
<p>â€‹    æœºå™¨è§†è§‰æ˜¯ä¸€é¡¹ç»¼åˆæŠ€æœ¯ï¼ŒåŒ…æ‹¬å›¾åƒå¤„ç†ã€æœºæ¢°å·¥ç¨‹æŠ€æœ¯ã€æ§åˆ¶ã€ç”µå…‰æºç…§æ˜ã€å…‰å­¦æˆåƒã€ä¼ æ„Ÿå™¨ã€æ¨¡æ‹Ÿä¸æ•°å­—è§†é¢‘æŠ€æœ¯ã€è®¡ç®—æœºè½¯ç¡¬ä»¶æŠ€æœ¯(å›¾åƒå¢å¼ºå’Œåˆ†æç®—æ³•ã€å›¾åƒå¡ã€ I&#x2F;Oå¡ç­‰)ã€‚</p>
<p>â€‹    å¾ˆå¤šå¹´å‰ï¼Œæœºå™¨è§†è§‰å°±åœ¨å¹¿æ³›åº”ç”¨ã€‚ç›®å‰ï¼Œåœ¨æ·±åº¦å’Œå¹¿åº¦æ–¹é¢æ‹“å±•ã€‚æœªæ¥10å¹´ï¼Œæœºå™¨è§†è§‰å¯¹äººç±»ç”Ÿæ´»ï¼Œå°†ä¼šæœ‰é©å‘½æ€§çš„å˜åŒ–ã€‚</p>
<p>â€‹    æœºå™¨è§†è§‰æ˜¯ä¸€é—¨æŠ€æœ¯ï¼Œæœºå™¨è§†è§‰ç³»ç»Ÿæ˜¯æŠ€æœ¯çš„åº”ç”¨ï¼Œä¸‹ä¸€ä¸»é¢˜ï¼Œæˆ‘ä»¬è®²è¿°æœºå™¨è§†è§‰ç³»ç»Ÿã€‚</p>
<h2 id="6-4ã€æœºå™¨è§†è§‰ç³»ç»Ÿ"><a href="#6-4ã€æœºå™¨è§†è§‰ç³»ç»Ÿ" class="headerlink" title="6.4ã€æœºå™¨è§†è§‰ç³»ç»Ÿ"></a>6.4ã€æœºå™¨è§†è§‰ç³»ç»Ÿ</h2><p>â€‹    ä¸€ä¸ªå…¸å‹çš„æœºå™¨è§†è§‰åº”ç”¨ç³»ç»ŸåŒ…æ‹¬å›¾åƒæ•æ‰ã€å…‰æºç³»ç»Ÿã€å›¾åƒæ•°å­—åŒ–æ¨¡å—ã€æ•°å­—å›¾åƒå¤„ç†æ¨¡å—ã€æ™ºèƒ½åˆ¤æ–­å†³ç­–æ¨¡å—å’Œæœºæ¢°æ§åˆ¶æ‰§è¡Œæ¨¡å—ã€‚</p>
<p>â€‹    æœºå™¨è§†è§‰ç³»ç»ŸåŸºæœ¬çš„ç‰¹ç‚¹å°±æ˜¯æé«˜ç”Ÿäº§çš„çµæ´»æ€§å’Œè‡ªåŠ¨åŒ–ç¨‹åº¦ã€‚åœ¨ä¸é€‚äºäººå·¥ä½œä¸šçš„å±é™©å·¥ä½œç¯å¢ƒæˆ–è€…äººå·¥è§†è§‰éš¾ä»¥æ»¡è¶³è¦æ±‚çš„åœºåˆï¼Œç”¨æœºå™¨è§†è§‰æ¥æ›¿ä»£äººå·¥è§†è§‰ã€‚åœ¨å¤§æ‰¹é‡é‡å¤æ€§å·¥ä¸šç”Ÿäº§ä¸­ï¼Œç”¨æœºå™¨è§†è§‰æ£€æµ‹æ–¹æ³•æé«˜ç”Ÿäº§çš„æ•ˆç‡å’Œè‡ªåŠ¨åŒ–ç¨‹åº¦ã€‚ </p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147712.png" alt="img"></p>
<p>â€‹    æœºå™¨è§†è§‰ç³»ç»Ÿæé«˜ç”Ÿäº§çš„æŸ”æ€§å’Œè‡ªåŠ¨åŒ–ç¨‹åº¦ã€‚åœ¨ä¸€äº›ä¸é€‚åˆäººå·¥ä½œä¸šçš„å±é™©å·¥ä½œç¯å¢ƒæˆ–äººå·¥è§†è§‰éš¾ä»¥æ»¡è¶³è¦æ±‚çš„åœºåˆï¼Œå¸¸ç”¨æœºå™¨è§†è§‰æ¥æ›¿ä»£äººå·¥è§†è§‰ï¼›åŒæ—¶åœ¨å¤§æ‰¹é‡å·¥ä¸šç”Ÿäº§è¿‡ç¨‹ä¸­ï¼Œç”¨äººå·¥è§†è§‰æ£€æŸ¥äº§å“è´¨é‡æ•ˆç‡ä½ä¸”ç²¾åº¦ä¸é«˜ï¼Œç”¨æœºå™¨è§†è§‰æ£€æµ‹æ–¹æ³•å¤§å¤§æé«˜ç”Ÿäº§æ•ˆç‡å’Œè‡ªåŠ¨åŒ–ç¨‹åº¦ã€‚æœºå™¨è§†è§‰æ˜“äºå®ç°ä¿¡æ¯é›†æˆï¼Œæ˜¯å®ç°è®¡ç®—æœºé›†æˆåˆ¶é€ çš„åŸºç¡€æŠ€æœ¯ä¹‹ä¸€ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147680.jpeg" alt="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1608562528401&amp;di=e64ba214572a7b1d069c2c1c0522dc5c&amp;imgtype=0&amp;src=http%3A%2F%2Fwww.mv186.com%2Fuploads%2Fimage%2F20150902%2F1441176652869171.png"></p>
<p>â€‹    å·¥ä¸šæœºå™¨è§†è§‰ç³»ç»ŸåŒ…æ‹¬ï¼šå…‰æºã€é•œå¤´ï¼ˆå®šç„¦é•œå¤´ã€å˜å€é•œå¤´ã€è¿œå¿ƒé•œå¤´ã€æ˜¾å¾®é•œå¤´ï¼‰ã€ ç›¸æœºï¼ˆåŒ…æ‹¬CCDç›¸æœºå’ŒCOMSç›¸æœºï¼‰ã€å›¾åƒå¤„ç†å•å…ƒï¼ˆæˆ–å›¾åƒæ•è·å¡ï¼‰ã€å›¾åƒå¤„ç†è½¯ä»¶ã€ç›‘è§†å™¨ã€é€šè®¯ &#x2F; è¾“å…¥è¾“å‡ºå•å…ƒç­‰ã€‚</p>
<p>â€‹    æœºå™¨è§†è§‰æ£€æµ‹ç³»ç»Ÿé‡‡ç”¨CCDç…§ç›¸æœºå°†è¢«æ£€æµ‹çš„ç›®æ ‡è½¬æ¢æˆå›¾åƒä¿¡å·ï¼Œä¼ é€ç»™ä¸“ç”¨çš„å›¾åƒå¤„ç†ç³»ç»Ÿï¼Œä¾æ®åƒç´ åˆ†å¸ƒå’Œäº®åº¦ã€é¢œè‰²ç­‰ä¿¡æ¯ï¼Œè½¬å˜æˆæ•°å­—åŒ–ä¿¡å·ï¼Œå›¾åƒå¤„ç†ç³»ç»Ÿå¯¹è¿™äº›ä¿¡å·è¿›è¡Œå„ç§è¿ç®—æ¥æŠ½å–ç›®æ ‡çš„ç‰¹å¾ï¼Œå¦‚é¢ç§¯ã€æ•°é‡ã€ä½ç½®ã€é•¿åº¦ï¼Œå†æ ¹æ®é¢„è®¾çš„å…è®¸åº¦å’Œå…¶å®ƒæ¡ä»¶è¾“å‡ºç»“æœï¼ŒåŒ…æ‹¬å°ºå¯¸ã€è§’åº¦ã€ä¸ªæ•°ã€åˆæ ¼&#x2F;ä¸åˆæ ¼ã€æœ‰&#x2F;æ— ç­‰ï¼Œå®ç°è‡ªåŠ¨è¯†åˆ«åŠŸèƒ½ã€‚</p>
<p>â€‹    ç›®å‰ï¼Œæœºå™¨è§†è§‰ç³»ç»Ÿä¸»è¦åº”ç”¨åœ¨å·¥ä¸šç”Ÿäº§é¢†åŸŸï¼Œäº’è”ç½‘åº”ç”¨æ­£åœ¨å…´èµ·ï¼Œåœ¨å±…å®¶ç”Ÿæ´»åº”ç”¨ä¸Šæ–¹å…´æœªè‰¾ã€‚</p>
<h2 id="6-5ã€è®¡ç®—æœºè§†è§‰"><a href="#6-5ã€è®¡ç®—æœºè§†è§‰" class="headerlink" title="6.5ã€è®¡ç®—æœºè§†è§‰"></a>6.5ã€è®¡ç®—æœºè§†è§‰</h2><p>â€‹    è®¡ç®—æœºè§†è§‰æ˜¯ç ”ç©¶å¦‚ä½•ä½¿æœºå™¨â€œçœ‹â€çš„ç§‘å­¦ï¼Œç”¨æ‘„å½±æœºå’Œç”µè„‘ä»£æ›¿äººçœ¼å¯¹ç›®æ ‡è¿›è¡Œè¯†åˆ«ã€è·Ÿè¸ªå’Œæµ‹é‡ç­‰ï¼Œå¹¶è¿›ä¸€æ­¥åšå›¾å½¢å¤„ç†ï¼Œä½¿ç”µè„‘å¤„ç†æ›´é€‚åˆäººçœ¼è§‚å¯Ÿæˆ–ä¼ é€ç»™ä»ªå™¨æ£€æµ‹çš„å›¾åƒã€‚è®¡ç®—æœºè§†è§‰å¯ä»¥çœ‹ä½œï¼Œå¦‚ä½•ä½¿äººå·¥ç³»ç»Ÿä»å›¾åƒæˆ–å¤šç»´æ•°æ®ä¸­â€œæ„ŸçŸ¥â€çš„ç§‘å­¦ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147700.png" alt="img"></p>
<p>â€‹    è®¡ç®—æœºè§†è§‰æ˜¯ä¸€é—¨å…³äºå¦‚ä½•è¿ç”¨ç…§ç›¸æœºå’Œè®¡ç®—æœºæ¥è·å–æˆ‘ä»¬æ‰€éœ€çš„ï¼Œè¢«æ‹æ‘„å¯¹è±¡çš„æ•°æ®ä¸ä¿¡æ¯çš„å­¦é—®ã€‚å½¢è±¡åœ°è¯´ï¼Œå°±æ˜¯ç»™è®¡ç®—æœºå®‰è£…ä¸Šçœ¼ç›ï¼ˆç…§ç›¸æœºï¼‰å’Œå¤§è„‘ï¼ˆç®—æ³•ï¼‰ï¼Œè®©è®¡ç®—æœºèƒ½å¤Ÿæ„ŸçŸ¥ç¯å¢ƒã€‚</p>
<p>â€‹    è®¡ç®—æœºè§†è§‰æ—¢æ˜¯å·¥ç¨‹é¢†åŸŸï¼Œä¹Ÿæ˜¯ç§‘å­¦é¢†åŸŸä¸­é‡è¦ç ”ç©¶é¢†åŸŸã€‚è®¡ç®—æœºè§†è§‰æ˜¯ä¸€é—¨ç»¼åˆæ€§çš„å­¦ç§‘ï¼Œå¸å¼•äº†ä¼—å¤šç ”ç©¶è€…å‚åŠ åˆ°å¯¹å®ƒçš„ç ”ç©¶ä¹‹ä¸­ã€‚åŒ…æ‹¬è®¡ç®—æœºç§‘å­¦å’Œå·¥ç¨‹ã€ä¿¡å·å¤„ç†ã€ç‰©ç†å­¦ã€åº”ç”¨æ•°å­¦å’Œç»Ÿè®¡å­¦ï¼Œç¥ç»ç”Ÿç†å­¦å’Œè®¤çŸ¥ç§‘å­¦ç­‰ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147672.png" alt="img"></p>
<p>â€‹    è®¡ç®—æœºè§†è§‰å¼€å§‹äº60å¹´ä»£åˆï¼Œ80å¹´ä»£å–å¾—å¾ˆå¤šé‡å¤§è¿›å±•ã€‚è®¡ç®—æœºè§†è§‰ä¸äººç±»è§†è§‰å¯†åˆ‡ç›¸å…³ï¼Œå¯¹äººç±»è§†è§‰æœ‰æ­£ç¡®çš„è®¤è¯†å¯¹è®¡ç®—æœºè§†è§‰çš„ç ”ç©¶éå¸¸æœ‰ç›Šã€‚</p>
<p>â€‹    è®¡ç®—æœºè§†è§‰ç”¨å„ç§æˆåƒç³»ç»Ÿä»£æ›¿è§†è§‰å™¨å®˜ä½œä¸ºè¾“å…¥æ•æ„Ÿæ‰‹æ®µï¼Œç”±è®¡ç®—æœºæ¥ä»£æ›¿å¤§è„‘å®Œæˆå¤„ç†å’Œè§£é‡Šã€‚è®¡ç®—æœºè§†è§‰çš„ç ”ç©¶ç›®æ ‡å°±æ˜¯ä½¿è®¡ç®—æœºè±¡äººé‚£æ ·é€šè¿‡è§†è§‰è§‚å¯Ÿå’Œç†è§£ä¸–ç•Œï¼Œå…·æœ‰è‡ªä¸»é€‚åº”ç¯å¢ƒçš„èƒ½åŠ›ã€‚</p>
<p>â€‹    è®¡ç®—æœºè§†è§‰æ ¹æ®è®¡ç®—æœºç³»ç»Ÿçš„ç‰¹ç‚¹è¿›è¡Œè§†è§‰ä¿¡æ¯å¤„ç†ã€‚è¿„ä»Šä¸ºæ­¢äººç±»è§†è§‰ç³»ç»Ÿï¼Œæ˜¯åŠŸèƒ½æœ€å¼ºå¤§å’Œå®Œå–„çš„è§†è§‰ç³»ç»Ÿã€‚å¯¹äººç±»è§†è§‰å¤„ç†æœºåˆ¶çš„ç ”ç©¶å°†ç»™è®¡ç®—æœºè§†è§‰çš„ç ”ç©¶æä¾›å¯å‘å’ŒæŒ‡å¯¼ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192147682.jpeg" alt="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic1.zhimg.com%2Fv2-5f3ab881181f49338b21dfa143f8bffc_b.jpg&amp;refer=http%3A%2F%2Fpic1.zhimg.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1615908110&amp;t=0cc3aa72b4535c39f9657f6823f990b2"></p>
<p>â€‹    è®¡ç®—æœºä¿¡æ¯å¤„ç†çš„æ–¹æ³•æ˜¯ç ”ç©¶äººç±»è§†è§‰çš„æœºç†ï¼Œå»ºç«‹äººç±»è§†è§‰è®¡ç®—ç†è®ºã€‚ç§°ä¸ºè®¡ç®—è§†è§‰ï¼ˆComputational Visionï¼‰ã€‚è®¡ç®—è§†è§‰æ˜¯è®¡ç®—æœºè§†è§‰ä¸­çš„ä¸€ä¸ªç ”ç©¶é¢†åŸŸã€‚</p>
<p>â€‹    è®¡ç®—æœºè§†è§‰å’Œæœºå™¨è§†è§‰çš„å®šä¹‰æœ‰å¾ˆå¤šè®¤çŸ¥çš„åŒºåˆ«ï¼Œå¾ˆå¤šæ–‡çŒ®ä¸­æœ‰ä¸åŒçš„è®ºè¿°ï¼Œç¬”è€…è®¤ä¸ºï¼Œä¸¤è€…éƒ½æ˜¯äººå·¥æ™ºèƒ½çš„åˆ†æ”¯ï¼Œä¾§é‡ç‚¹ä¸ä¸€æ ·ã€‚åœ¨ä»Šå¤©å­¦æœ¯é¢†åŸŸï¼Œéƒ½æ²¡æœ‰ä¸¥æ ¼çš„å®šä¹‰ã€‚</p>
<h2 id="6-6ã€æ™ºèƒ½æ—¶ä»£è½¯ä»¶å‘å±•"><a href="#6-6ã€æ™ºèƒ½æ—¶ä»£è½¯ä»¶å‘å±•" class="headerlink" title="6.6ã€æ™ºèƒ½æ—¶ä»£è½¯ä»¶å‘å±•"></a>6.6ã€æ™ºèƒ½æ—¶ä»£è½¯ä»¶å‘å±•</h2><p>â€‹    å¤©ä¸‹äº‹ç‰©å‘å±•ä¸€åˆ†ä¸ºäºŒï¼Œè½¯ç¡¬ä»¶æŠ€æœ¯ä¹Ÿä¸ä¾‹å¤–ï¼Œç¬¬äºŒæ¬¡å·¥ä¸šé©å‘½ç”µç£ç†è®ºï¼ŒçŸ³ç ´å¤©æƒŠï¼Œåœ¨åæœŸæ¨åŠ¨äº†è®¡ç®—æœºæŠ€æœ¯çš„è¿›æ­¥ã€‚ä¸ºç¬¬å››æ¬¡ç§‘æŠ€é©å‘½çš„å‘å±•åšå¥½äº†ç¡¬ä»¶çš„é“ºå«ã€‚åœ¨ç¡¬ä»¶å¤§åŠ›å‘å±•èƒŒåï¼Œæ™ºèƒ½æ—¶ä»£è½¯ä»¶çš„å·è§’å¹å“äº†ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148933.png" alt="img"></p>
<p>â€‹    äººç±»åœ¨æ™ºèƒ½ç§‘æŠ€æ–¹é¢çš„æ¢ç´¢æ²¡æœ‰ç»ˆç‚¹ï¼Œä¹Ÿå¾ˆéš¾æ‰¾åˆ°èµ·ç‚¹ã€‚äººå·¥æ™ºèƒ½æ¢ç´¢è¿‡ç¨‹ä¸­ï¼Œè½¯ä»¶æ–¹é¢æœ‰ç€å¤©ç¿»åœ°è¦†çš„å˜åŒ–ï¼Œä¸‹é¢ä»ç¼–ç¨‹è¯­è¨€ã€è¿ç®—å¹³å°ã€æœºå™¨å­¦ä¹ åº“ç­‰æ–¹é¢åˆ†åˆ«è¿›è¡Œé˜è¿°ã€‚</p>
<h3 id="6-6-1ã€äººå·¥æ™ºèƒ½ç¼–ç¨‹è¯­è¨€"><a href="#6-6-1ã€äººå·¥æ™ºèƒ½ç¼–ç¨‹è¯­è¨€" class="headerlink" title="6.6.1ã€äººå·¥æ™ºèƒ½ç¼–ç¨‹è¯­è¨€"></a>6.6.1ã€äººå·¥æ™ºèƒ½ç¼–ç¨‹è¯­è¨€</h3><p>â€‹    äººå·¥æ™ºèƒ½ç¼–ç¨‹è¯­è¨€æ˜¯ä¸€ç±»é€‚åº”äºäººå·¥æ™ºèƒ½å’ŒçŸ¥è¯†å·¥ç¨‹é¢†åŸŸçš„ã€å…·æœ‰ç¬¦å·å¤„ç†å’Œé€»è¾‘æ¨ç†èƒ½åŠ›çš„è®¡ç®—æœºç¨‹åºè®¾è®¡è¯­è¨€ã€‚èƒ½å¤Ÿç”¨å®ƒæ¥ç¼–å†™ç¨‹åºæ±‚è§£éæ•°å€¼è®¡ç®—ã€çŸ¥è¯†å¤„ç†ã€æ¨ç†ã€è§„åˆ’ã€å†³ç­–ç­‰å…·æœ‰æ™ºèƒ½çš„å„ç§å¤æ‚é—®é¢˜ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148892.jpeg" alt="https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1385822726,935678861&amp;fm=26&amp;gp=0.jpg"></p>
<p>â€‹    äº‹å®ä¸Šï¼Œå·²ç»æœ‰å¤šç§å¯¹åº”äºå„ç§ä¸åŒçŸ¥è¯†è¡¨ç¤ºæ–¹å¼çš„äººå·¥æ™ºèƒ½ç¼–ç¨‹è¯­è¨€ã€‚æŒ‰æ‰€å¯¹åº”çš„çŸ¥è¯†è¡¨ç¤ºæ–¹å¼ä¸åŒã€‚å¯ä»¥åŒºåˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p>
<p>â€‹    Aã€å¯¹åº”äºäº§ç”Ÿå¼è§„åˆ™çŸ¥è¯†è¡¨ç¤ºçš„è¯­è¨€ã€‚ä¾‹å¦‚ï¼Œç”±ç¾å›½å¡è€åŸºÂ·æ¢…å†œå¤§å­¦çš„CÂ·LÂ·ç¦åŸºï¼ˆCã€‚Lã€‚Forgyï¼‰ç­‰äºº1977å¹´å¼€å‘çš„OPS(official production system)ï¼Œå½“æ—¶ç”¨å®ƒæ¥ä¸ºDECå…¬å¸å¼€å‘äº†ä¸€ä¸ªè§£å†³VAXè®¡ç®—æœºç³»ç»Ÿé…ç½®é—®é¢˜çš„ä¸“å®¶ç³»ç»ŸX1&#x2F;XCONã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148938.png" alt="img"></p>
<p>â€‹    Bã€å¯¹åº”äºé€»è¾‘å…¬å¼çŸ¥è¯†è¡¨ç¤ºçš„è¯­è¨€ã€‚ä¸€ç§å·²å¹¿ä¸ºåº”ç”¨çš„é€»è¾‘è¯­è¨€å°±æ˜¯PROLOGã€‚1970å¹´ç”±æ³•å›½é©¬å¡å¤§å­¦çš„ Aã€‚æŸ¯è¿ˆè±ªåŸƒ(Alain Colmerauer)æ‰€å¼€å‘çš„ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148894.png" alt="img"></p>
<p>â€‹    Cã€å¯¹åº”äºæ¡†æ¶æˆ–è¯­ä¹‰ç½‘çŸ¥è¯†è¡¨ç¤ºçš„è¯­è¨€ã€‚è¿™æ˜¯â€œé¢å‘å¯¹è±¡â€çš„(object-oriented)è¯­è¨€ã€‚å…¶ä¸­ä¸€ä¸ªæœ‰ä»£è¡¨æ€§çš„è¯­ç§å°±æ˜¯Smalltalkã€‚1980å¹´é¦–åˆ›ï¼Œåæ¥ç‰ˆæœ¬ä¸æ–­æ›´æ–°ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148927.png" alt="img"></p>
<p>â€‹    Dã€å¯¹åº”äºå‡½æ•°çŸ¥è¯†è¡¨ç¤ºæˆ–å‡½æ•°å¼ç¨‹åºè®¾è®¡é£æ ¼çš„è¯­è¨€çš„åˆ—è¡¨å¤„ç†è¯­è¨€ã€‚å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼Œç†è®ºä¸Šå¾ˆå®Œç¾ï¼Œå»ºç«‹åœ¨åšå®çš„æ•°å­¦åŸºç¡€ä¹‹ä¸Šï¼Œå¯¹äºäººå·¥æ™ºèƒ½é—®é¢˜ï¼Œåœ¨å¸¸è§„è®¡ç®—æœºä¸Šå¾ˆéš¾å®ç°ã€‚20ä¸–çºª50å¹´ä»£æœ«ï¼Œéº»çœç†å·¥å­¦é™¢çš„çº¦ç¿°Â·éº¦å¡é”¡ç­‰äººé¦–å…ˆå¼€å‘çš„åˆ—è¡¨å¤„ç†è¯­è¨€LISPï¼ˆLISt Processingï¼‰è¿„ä»Šä»ç„¶å¹¿æ³›ç”¨äºç¼–å†™äººå·¥æ™ºèƒ½åº”ç”¨ç¨‹åºï¼Œç‰¹åˆ«æ˜¯ç”¨äºå¼€å‘ä¸“å®¶ç³»ç»Ÿã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148886.jpeg" alt="https://ss0.baidu.com/7Po3dSag_xI4khGko9WTAnF6hhy/baike/w%3D268%3Bg%3D0/sign=cd791b07708b4710ce2ffacafbf5a4c0/1b4c510fd9f9d72a1781f33bd62a2834349bbb2b.jpg"></p>
<p>â€‹    äººå·¥æ™ºèƒ½ç¼–ç¨‹è¯­è¨€æœ‰å…±åŒç‰¹ç‚¹ï¼Œè¯­è¨€éƒ½é¢å‘è¦è§£å†³çš„é—®é¢˜ã€ç»“åˆçŸ¥è¯†è¡¨ç¤ºã€å®Œå…¨è„±ç¦»å½“ä»£è®¡ç®—æœºçš„è¯ºä¾æ›¼ç»“æ„ç‰¹æ€§è€Œç‹¬ç«‹è®¾è®¡çš„ï¼›å¤„äºæ¯”é¢å‘è¿‡ç¨‹çš„é«˜çº§ç¼–ç¨‹è¯­è¨€æ›´é«˜çš„æŠ½è±¡å±‚æ¬¡ã€‚</p>
<p>â€‹    ç”¨è¿™äº›è¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œåœ¨ç°ä»£è®¡ç®—æœºç¯å¢ƒä¸­ï¼Œæ— è®ºæ˜¯è§£é‡Šæˆ–ç¼–è¯‘æ‰§è¡Œï¼Œå¾€å¾€æ•ˆç‡å¾ˆä½ã€‚å°¤å…¶ç¨‹åºè§„æ¨¡å¾ˆå¤§ã€å¤æ‚æ—¶ï¼Œæµªè´¹å¤§é‡ç³»ç»Ÿèµ„æºï¼Œç³»ç»Ÿæ€§èƒ½å¾€å¾€ä¼šä¸‹é™åˆ°éš¾ä»¥å®¹å¿çš„åœ°æ­¥ã€‚ </p>
<h4 id="6-6-1-1ã€LISP"><a href="#6-6-1-1ã€LISP" class="headerlink" title="6.6.1.1ã€LISP"></a>6.6.1.1ã€LISP</h4><p>â€‹    20ä¸–çºª50å¹´ä»£åæœŸï¼Œéº»çœç†å·¥å­¦é™¢çš„John McCarthyå°±å¼€å§‹äº†äººå·¥æ™ºèƒ½çš„ç ”ç©¶ï¼Œå½“æ—¶è‡´åŠ›äºè®¾è®¡ä¸€ä¸ªç”¨è¡¨å¤„ç†çš„é€’å½’ç³»ç»Ÿï¼Œåœ¨20ä¸–çºª60å¹´ä»£åˆç ”åˆ¶å‡ºäº†LISPè¯­è¨€ã€‚</p>
<p>â€‹    LISPè¯­è¨€æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†ç¬¦å·è¡¨è¾¾å¼çš„ã€ç›¸å½“ç®€å•çš„å‡½æ•°å¼ç¨‹åºè®¾è®¡è¯­è¨€ï¼Œä»¥æ•°å­¦ä¸­çš„å‡½æ•°ä¸å‡½æ•°ä½œç”¨çš„æ¦‚å¿µä½œä¸ºè®¾è®¡åŸç†ï¼Œå¥ å®šäº†å‡½æ•°å¼è¯­è¨€çš„åŸºç¡€ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148104.png" alt="img"></p>
<p>â€‹    LISPè¯­è¨€æ˜¯å®Œå…¨évon Neumanné£æ ¼çš„ï¼Œå®ƒæ²¡æœ‰ä½¿ç”¨ALGOL60ç­‰è¯­è¨€ä¸­æ‰€é‡‡ç”¨çš„å¯ä¿®æ”¹å˜é‡ã€èµ‹å€¼è¯­å¥ã€è½¬å‘è¯­å¥ç­‰von Neumannç»“æ„è¯­è¨€ä¸­çš„æœ‰å…³æ¦‚å¿µã€‚LISPç¨‹åºä¸å…¶æ•°æ®ç»“æ„é‡‡ç”¨äº†ç›¸åŒçš„ç»“æ„å½¢å¼ä¸å¤„ç†æ–¹å¼ã€‚</p>
<p>â€‹    LISPæ–¹ä¾¿åœ°ç¼–å†™è§£é‡Šç¨‹åºã€‚LISPè¯­è¨€é™¤äº†ç”¨sä¸€è¡¨è¾¾å¼æ¥ç»Ÿä¸€å¤„ç†æ•°æ®ä¸ç¨‹åºå¤–ï¼Œè¿˜å¼•å…¥äº†å‰ç¼€è¿ç®—ç¬¦è¡¨ç¤ºæ³•ã€é€’å½’æ•°æ®ç»“æ„ã€é€’å½’æ§åˆ¶ç»“æ„ä»¥åŠæ–°çš„æ¡ä»¶è¡¨è¾¾å¼å½¢å¼ã€‚</p>
<h4 id="6-6-1-2ã€Prolog"><a href="#6-6-1-2ã€Prolog" class="headerlink" title="6.6.1.2ã€Prolog"></a>6.6.1.2ã€Prolog</h4><p>â€‹    Prolog(Programming in Logic)æ˜¯ä¸€ç§é€»è¾‘ç¼–ç¨‹è¯­è¨€ï¼Œå»ºç«‹åœ¨é€»è¾‘å­¦çš„ç†è®ºåŸºç¡€ä¹‹ä¸Šï¼Œæœ€åˆè¢«è¿ç”¨äºè‡ªç„¶è¯­è¨€ç­‰ç ”ç©¶é¢†åŸŸã€‚ç°å·²å¹¿æ³›åº”ç”¨åœ¨äººå·¥æ™ºèƒ½çš„ç ”ç©¶ä¸­ï¼Œå¯ä»¥ç”¨æ¥å»ºé€ ä¸“å®¶ç³»ç»Ÿã€è‡ªç„¶è¯­è¨€ç†è§£ã€æ™ºèƒ½çŸ¥è¯†åº“ç­‰ã€‚</p>
<p>â€‹    å¯¹ä¸€äº›åº”ç”¨ç¨‹åºçš„ç¼–å†™å¾ˆæœ‰å¸®åŠ©ï¼Œèƒ½å¤Ÿæ¯”å…¶å®ƒè¯­è¨€æ›´å¿«é€Ÿå¼€å‘ç¨‹åºï¼ŒPrologçš„ç¼–ç¨‹æ–¹æ³•æ›´åƒæ˜¯ä½¿ç”¨é€»è¾‘è¯­è¨€æ¥æè¿°ç¨‹åºã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148111.png" alt="img"></p>
<p>â€‹    Prologå…·æœ‰é²œæ˜çš„é€»è¾‘ç¼–ç¨‹è¯­è¨€ç‰¹è‰²ï¼ŒåŒ…æ‹¬ï¼šæ²¡æœ‰ç‰¹å®šçš„è¿è¡Œé¡ºåºï¼Œè¿è¡Œé¡ºåºæ˜¯ç”±è®¡ç®—æœºå†³å®šçš„ï¼Œè€Œä¸æ˜¯ç¨‹åºå‘˜ï¼›ç¨‹åºä¸­æ²¡æœ‰ifã€whenã€caseã€forè¿™æ ·çš„æ§åˆ¶æµç¨‹è¯­å¥ï¼›Prologç¨‹åºå’Œæ•°æ®é«˜åº¦ç»Ÿä¸€ï¼Œå…¶ç¨‹åºå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ™ºèƒ½æ•°æ®åº“ï¼›å…·æœ‰å¼ºå¤§çš„é€’å½’åŠŸèƒ½ã€‚</p>
<p>â€‹    1981å¹´æ—¥æœ¬æ”¿åºœå®£å¸ƒç¬¬5ä»£è®¡ç®—æœºç³»ç»Ÿ(FGCS)é¡¹ç›®ä»¥Prologä¸ºåŸºç¡€è¯­è¨€ä»¥æ¥ï¼ŒPrologæˆä¸ºäº†äººå·¥æ™ºèƒ½ç ”ç©¶é¢†åŸŸçš„ä¸»å¯¼è¯­è¨€ã€‚</p>
<h4 id="6-6-1-3ã€OPS83"><a href="#6-6-1-3ã€OPS83" class="headerlink" title="6.6.1.3ã€OPS83"></a>6.6.1.3ã€OPS83</h4><p>â€‹    OPS83æ˜¯åº”ç”¨äºä¸“å®¶ç³»ç»Ÿçš„ç¨‹åºè®¾è®¡è¯­è¨€ï¼Œæ”¯æŒOPSæ—©æœŸç‰ˆæœ¬ï¼Œä¹Ÿæ”¯æŒPASCALæˆ–Cè¿™äº›å¸¸è§„ç¨‹åºè®¾è®¡è¯­è¨€æ‰€å…·æœ‰çš„è¿‡ç¨‹è®¾è®¡èƒ½åŠ›ã€‚å®ƒä¸æ˜¯å¯¹æ‰€æœ‰ç¨‹åºè®¾è®¡ä»»åŠ¡éƒ½é€‚å®œï¼ŒOPS83è¾ƒä¹‹OPSçš„æ—©æœŸç‰ˆæœ¬ï¼Œå¯¹è®¸å¤šé—®é¢˜å¤„ç†çš„æ›´ç›®ç„¶ã€æ›´æœ‰æ•ˆã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148162.png" alt="img"></p>
<p>â€‹    OPSæ˜¯ç”±ç¾å›½å®¾å¤•æ³•å°¼äºšå·å¡å†…åŸºä¸€æ¢…éš†å¤§å­¦çš„C.L.Forgyç­‰äººå¼€å‘ã€‚æœ€æ—©ç‰ˆæœ¬æ˜¯åœ¨1975å¹´å¼€å‘çš„ï¼Œä¹‹åå‡ ç»ä¿®æ”¹å½¢æˆäº†OPSlã€OPS2(1978)ã€OPS4(1979)ã€OPS5(1981)å¤šç§ç‰ˆæœ¬ï¼Œ1986å¹´å‡ºç°äº†OPS83ã€‚ </p>
<p>â€‹    OSP83é‡‡ç”¨äº§ç”Ÿå¼ç³»ç»Ÿçš„çŸ¥è¯†è¡¨ç¤ºæ¨¡å¼å’Œæ­£å‘ç²¾ç¡®æ¨ç†æ–¹å¼ã€‚å®ƒæä¾›äº†ä¸¤ç§äº¤äº’ç¯å¢ƒï¼šä¸€æ˜¯å’Œç”¨æˆ·çš„ç•Œé¢ï¼›äºŒæ˜¯å’ŒçŸ¥è¯†å·¥ç¨‹å¸ˆçš„ç•Œé¢(è°ƒè¯•ç¯å¢ƒ)ã€‚OPS83åŒ…æ‹¬ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼šçŸ¥è¯†åº“ã€æ¨ç†æœºå’Œå·¥ä½œå­˜è´®å™¨ã€‚</p>
<p>â€‹    çŸ¥è¯†åº“åˆç§°è§„åˆ™åº“ã€‚æ¯æ¡è§„åˆ™å‡ä»¥0PS83è¯­è¨€æ¥è¡¨ç¤ºã€‚OPS83çš„æ¨ç†è¿‡ç¨‹ç”±è‹¥å¹²â€œè¯†åˆ«ä¸€åŠ¨ä½œâ€å‘¨æœŸç»„æˆã€‚æ¯ä¸ªå‘¨æœŸåŒ…æ‹¬ä¸‰ä¸ªåŠ¨ä½œæˆ–é˜¶æ®µï¼šåŒ¹é…ã€å†²çªè§£å†³(æˆ–é€‰æ‹©)å’Œæ‰§è¡Œã€‚</p>
<p>â€‹    åŒ¹é…æ˜¯æ•°æ®å’Œå·²æœ‰è§„åˆ™çš„åŒ¹é…ã€‚åŒ¹é…çš„ç»“æœå½¢æˆäº†å†²çªé›†ã€‚æ˜¯æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è§„åˆ™çš„é›†åˆã€‚ç„¶åï¼Œæ¨ç†æœºä»å†²çªé›†ä¸­é€‰æ‹©è§„åˆ™æ‰§è¡Œã€‚å·¥ä½œå­˜è´®å™¨(Work Memoryï¼ŒWM)ç”¨æ¥å­˜è´®æ¨ç†æœºåœ¨æ¨ç†è¿‡ç¨‹ä¸­çš„åˆå§‹çŠ¶æ€ã€ä¸­é—´çŠ¶æ€å’Œç›®æ ‡ç­‰ä¿¡æ¯ã€‚</p>
<p>â€‹    å„ä¸ªæ¨¡å—å¯ä½œä¸ºç‹¬ç«‹çš„æ–‡ä»¶å­˜æ”¾åœ¨å­˜è´®å™¨ä¸­ï¼Œå•ç‹¬ç¼–è¯‘ï¼Œç„¶åè¿æ¥åœ¨ä¸€èµ·è¿è¡Œã€‚æ•°æ®ç±»å‹ã€è¯­å¥ã€å­ç¨‹åºç­‰ä¸ä¸€èˆ¬ç¨‹åºè®¾è®¡è¯­è¨€ç±»ä¼¼ï¼Œä½¿ç”¨OPS83çš„çŸ¥è¯†å·¥ç¨‹å¸ˆæœ‰ä¸€ä¸ªç±»ä¼¼äºè¿‡ç¨‹æè¿°å‹è¯­è¨€çš„ç¼–ç¨‹ç¯å¢ƒã€‚</p>
<h4 id="6-6-1-4ã€Python"><a href="#6-6-1-4ã€Python" class="headerlink" title="6.6.1.4ã€Python"></a>6.6.1.4ã€Python</h4><p>â€‹    1989å¹´åœ£è¯èŠ‚æœŸé—´ï¼Œè·å…°äººå‰å¤šÂ·èŒƒç½—è‹å§†ï¼ˆGuido van Rossumï¼‰ï¼Œåœ¨é˜¿å§†æ–¯ç‰¹ä¸¹ï¼Œä¸ºäº†æ‰“å‘åœ£è¯èŠ‚çš„æ— è¶£ï¼Œå†³å¿ƒå¼€å‘ä¸€ä¸ªæ–°çš„è„šæœ¬è§£é‡Šç¨‹åºï¼Œä½œä¸ºABCè¯­è¨€çš„ç»§æ‰¿ã€‚è¿˜å—åˆ°äº†Modula-3çš„å½±å“ï¼Œç»“åˆäº†Unix shellå’ŒCçš„ä¹ æƒ¯ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148214.png" alt="img"></p>
<p>â€‹    Guidoæœ¬äººçœ‹æ¥ï¼ŒABCè¯­è¨€ä¼˜ç¾å¼ºå¤§ï¼Œä¸ºéä¸“ä¸šç¨‹åºå‘˜è®¾è®¡ã€‚ä½†æ˜¯ABCè¯­è¨€å¹¶æ²¡æœ‰æˆåŠŸï¼Œç©¶å…¶åŸå› ï¼ŒGuidoè®¤ä¸ºæ˜¯å…¶éå¼€æ”¾é€ æˆçš„ã€‚Guidoåœ¨Pythonä¸­é¿å…è¿™ä¸€é”™è¯¯ã€‚åŒæ—¶ï¼Œä»–è¿˜æƒ³å®ç°åœ¨ABCä¸­é—ªç°è¿‡ä½†æœªæ›¾å®ç°çš„ä¸œè¥¿ã€‚</p>
<p>â€‹    Pythonè¯­æ³•å’ŒåŠ¨æ€ç±»å‹ï¼Œä»¥åŠè§£é‡Šå‹è¯­è¨€çš„æœ¬è´¨ï¼Œä½¿å®ƒæˆä¸ºå¤šæ•°å¹³å°ä¸Šå†™è„šæœ¬å’Œå¿«é€Ÿå¼€å‘åº”ç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼Œéšç€ç‰ˆæœ¬çš„æ›´æ–°å’Œè¯­è¨€æ–°åŠŸèƒ½çš„æ·»åŠ ï¼Œé€æ¸è¢«ç”¨äºç‹¬ç«‹çš„ã€å¤§å‹é¡¹ç›®çš„å¼€å‘ã€‚</p>
<p>â€‹    Pythonè§£é‡Šå™¨æ˜“äºæ‰©å±•ï¼Œå¯ä»¥ä½¿ç”¨Cæˆ–C++ï¼ˆæˆ–è€…å…¶å®ƒå¯ä»¥é€šè¿‡Cè°ƒç”¨çš„è¯­è¨€ï¼‰æ‰©å±•æ–°çš„åŠŸèƒ½å’Œæ•°æ®ç±»å‹ã€‚Python ä¹Ÿå¯ç”¨äºå¯å®šåˆ¶åŒ–è½¯ä»¶ä¸­çš„æ‰©å±•ç¨‹åºè¯­è¨€ã€‚ä¸°å¯Œçš„æ ‡å‡†åº“ï¼Œæä¾›äº†é€‚ç”¨äºå„ä¸ªä¸»è¦ç³»ç»Ÿå¹³å°çš„æºç æˆ–æœºå™¨ç ã€‚</p>
<p>â€‹    ç”±äºPythonè¯­è¨€çš„ç®€æ´æ€§ã€æ˜“è¯»æ€§ä»¥åŠå¯æ‰©å±•æ€§ï¼Œåœ¨å›½å†…å¤–ç”¨Pythonåšç§‘å­¦è®¡ç®—çš„ç ”ç©¶æœºæ„æ—¥ç›Šå¢å¤šï¼Œå¾ˆå¤šçŸ¥åå¤§å­¦å·²ç»é‡‡ç”¨Pythonæ¥æ•™æˆç¨‹åºè®¾è®¡è¯¾ç¨‹ã€‚ä¾‹å¦‚å¡è€åŸºæ¢…éš†å¤§å­¦ã€éº»çœç†å·¥å­¦é™¢ç­‰ã€‚</p>
<p>â€‹    ä¼—å¤šå¼€æºçš„ç§‘å­¦è®¡ç®—è½¯ä»¶åŒ…éƒ½æä¾›äº†Pythonçš„è°ƒç”¨æ¥å£ï¼Œä¾‹å¦‚è‘—åçš„è®¡ç®—æœºè§†è§‰åº“OpenCVã€ä¸‰ç»´å¯è§†åŒ–åº“VTKã€åŒ»å­¦å›¾åƒå¤„ç†åº“ITKã€‚Pythonä¸“ç”¨çš„ç§‘å­¦è®¡ç®—æ‰©å±•åº“ååˆ†æµè¡Œï¼Œä¾‹å¦‚å¦‚ä¸‹3ä¸ªç»å…¸çš„ç§‘å­¦è®¡ç®—æ‰©å±•åº“ï¼šNumPyã€SciPyå’Œmatplotlibï¼Œå®ƒä»¬åˆ†åˆ«ä¸ºPythonæä¾›äº†å¿«é€Ÿæ•°ç»„å¤„ç†ã€æ•°å€¼è¿ç®—ä»¥åŠç»˜å›¾åŠŸèƒ½ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148197.png" alt="img"></p>
<p>â€‹    Pythonè¯­è¨€åŠå…¶ä¼—å¤šçš„æ‰©å±•åº“æ‰€æ„æˆçš„å¼€å‘ç¯å¢ƒé€‚åˆå·¥ç¨‹æŠ€æœ¯ã€ç§‘ç ”äººå‘˜å¤„ç†å®éªŒæ•°æ®ã€åˆ¶ä½œå›¾è¡¨ï¼Œç”šè‡³å¼€å‘ç§‘å­¦è®¡ç®—åº”ç”¨ç¨‹åºï¼Œå¹¶å¯ç”¨äºæœºå™¨å­¦ä¹ é¢†åŸŸã€‚</p>
<p>â€‹    è®©äººæƒŠå¥‡çš„æ˜¯ï¼ŒPythonä»Šå¤©æˆä¸ºäººå·¥æ™ºèƒ½åº”ç”¨å±‚ä¸Šæœ€ä¸»è¦çš„å¤–éƒ¨æ¥å£ï¼Œå°¤å…¶åœ¨å›¾å½¢å›¾åƒé¢†åŸŸï¼Œä½¿ç”¨å°¤å…¶å¹¿æ³›ï¼Œä¾‹å¦‚TensorFlowå’ŒPyTorchç­‰ã€‚è¿™åº”è¯¥æ˜¯Guidoæ‰€ä¸æ›¾æƒ³åˆ°çš„ã€‚</p>
<h3 id="6-6-1-4ã€å¯ç¤º"><a href="#6-6-1-4ã€å¯ç¤º" class="headerlink" title="6.6.1.4ã€å¯ç¤º"></a>6.6.1.4ã€å¯ç¤º</h3><p>â€‹    è¯šç„¶ï¼Œç¼–ç¨‹è¯­è¨€å¾ˆå¤šï¼Œæè¿°è¿™æ®µå†å²æ—¶ï¼Œåº”è¯¥è®¤è¯†åˆ°çš„æ˜¯ï¼Œä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸å½“æ—¶çš„ç¡¬ä»¶ç¯å¢ƒã€è½¯ä»¶ç†è®ºç›¸ç…§åº”ã€‚åœ¨ä»Šå¤©ï¼Œåªéœ€è¦ä¸€æ¦‚è€Œè¿‡ï¼Œå¯¹äºæ·±åº¦ç ”å‘ï¼Œæœ‰ä¸€å®šè®¤çŸ¥çš„å¿…è¦ã€‚</p>
<p>â€‹    äººå·¥æ™ºèƒ½æ˜¯ä¸€åœºç§‘æŠ€é©å‘½ï¼Œä¸ä»…ä»…æ˜¯ç†è®ºçš„å‘å±•ï¼Œæ›´æ˜¯å®è·µçš„åº”ç”¨ï¼Œéšç€ç¡¬ä»¶æŠ€æœ¯çš„è¿›æ­¥ï¼Œäººå·¥æ™ºèƒ½ç†å¿µçš„å˜å¹»ï¼Œè½¯ä»¶æ–¹é¢ä¹Ÿå°†æœ‰å¾ˆå¤§çš„å‘å±•ã€‚</p>
<p>â€‹    ç¼–ç¨‹è¯­è¨€å‘å±•ä¸Šï¼Œäººå·¥æ™ºèƒ½æœ‰å¾ˆå¤§çš„å‘å±•ï¼Œç¼–ç¨‹è¯­è¨€ä¸ç¡¬ä»¶ç³»ç»Ÿç´§å¯†ç»“åˆï¼Œç¼–ç¨‹è¯­è¨€ä¸æ¡†æ¶æ¨¡å¼åä½œå¹¶è¡Œï¼Œæ‰ä¼šæœ‰æ›´å¤§çš„çªç ´ã€‚åœ¨æœªæ¥ï¼Œäººå·¥æ™ºèƒ½æ–¹é¢ç¼–ç¨‹è¯­è¨€çš„å‘å±•ï¼Œæœ‰è¿™æ ·ä¸‰ä¸ªæ€ç´¢ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148251.png" alt="img"></p>
<p>â€‹    Aã€ç ”åˆ¶ä¸æŸç§è¯­è¨€å®Œå…¨é€‚åº”çš„æ–°ä¸€ä»£è®¡ç®—æœºã€‚ä¾‹å¦‚LlSPæœºã€æ•°æ®æµæœºã€PROLOGæœºã€é¢å‘å¯¹è±¡çš„ä½“ç³»ç»“æ„ç­‰ã€‚ä½†ä¸¾æ­¥ç»´è‰°ã€å‰æ™¯æ¸ºèŒ«ã€‚ä»¥è¯ºä¾æ›¼æœºä¸ºæ ¸å¿ƒçš„ç°ä»£é€šç”¨è®¡ç®—æœºå·²ç»å¹¿æ³›æ™®åŠè€Œä¸”æ€§èƒ½ä¸æ–­æé«˜ï¼Œç§¯ç´¯äº†å·¨å¤§çš„è½¯ä»¶èµ„æºã€‚ä»»ä½•ä¸ç°ä»£è®¡ç®—æœºä¸å…¼å®¹çš„ä¸“ç”¨æœºï¼Œæœ€å¤šæ»¡è¶³ç‰¹æ®Šéœ€æ±‚ï¼Œéš¾ä»¥ä¸ç°ä»£é€šç”¨è®¡ç®—æœºæŠ—è¡¡ã€‚åœ¨æ²¡æœ‰å¾ˆå¤§å•†ä¸šæœºä¼šçš„å‰æä¸‹ï¼Œè¿™ç§åŠæ³•æ˜¯ä¸å¯èƒ½å®ç°çš„ã€‚</p>
<p>â€‹    Bã€æŠŠä¸åŒé£æ ¼çš„ç¼–ç¨‹è¯­è¨€ç»“åˆèµ·æ¥ï¼Œå‘å±•å¤åˆè¯­è¨€æˆ–åµŒå…¥å¼è¯­è¨€ï¼Œå–é•¿è¡¥çŸ­ï¼Œä½¿ç³»ç»Ÿæ€§èƒ½å¾—ä»¥è¿›ä¸€æ­¥æé«˜ã€‚æŠŠé¢å‘å¯¹è±¡è¯­è¨€çš„è®¾è®¡æ€è·¯èæ±‡åˆ°å¸¸ç”¨çš„é¢å‘è¿‡ç¨‹çš„é«˜çº§è¯­è¨€ä¸­ã€‚C++è¯­è¨€å°±æ˜¯ä¸€ä¸ªçªå‡ºçš„ä¾‹å­ã€‚è¿™ç§æ”¹å˜ç›¸å¯¹æ¥è¯´å½±å“è¾ƒå°ï¼Œæ¯•ç«Ÿä¸æ˜¯è„±èƒæ¢éª¨ã€‚</p>
<p>â€‹    Cã€ç”¨é¢å‘é—®é¢˜çš„äººå·¥æ™ºèƒ½ç¼–ç¨‹è¯­è¨€çš„ç‰¹ç‚¹ï¼Œå…ˆé€‰æ‹©æŸç§è¯­è¨€ç¼–å†™å‡ºä¸€ä¸ªç®€æ´æ˜äº†è€Œæ˜“äºè°ƒè¯•çš„ç¨‹åºåŸå‹ã€‚é€šè¿‡éªŒè¯ã€è°ƒè¯•ï¼Œå†ä»¿ç…§è¿™ä¸ªåŸå‹ï¼Œæ”¹ç¼–ä¸ºæŸç§é¢å‘è¿‡ç¨‹çš„é«˜çº§è¯­è¨€ç¨‹åºï¼Œä¾‹å¦‚Cæˆ–C++ï¼Œè¾¾åˆ°æé«˜æœ€ç»ˆåº”ç”¨ç³»ç»Ÿå¼€å‘è´¨é‡å’Œæ‰§è¡Œæ•ˆç‡çš„ç›®çš„ã€‚ç”¨PROLOGã€ LISPã€OPSç­‰æ¥å¼€å‘ä¸“å®¶ç³»ç»ŸåŸå‹ï¼Œå·²æœ‰ä¸å°‘å…ˆä¾‹ã€‚åœ¨æŠ€æœ¯å˜å¹»çš„å‰æä¸‹ï¼Œè¿™ç§æ–¹å¼æœ‰ä¸€å®šçš„ä»·å€¼ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148324.jpeg" alt="https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=1263603027,3603698295&amp;fm=26&amp;gp=0.jpg"></p>
<p>â€‹    è®¡ç®—æœºå‘å±•å²ä¸Šï¼ŒåŸºäºå†¯Â·è¯ºä¼Šæ›¼çš„ç¡¬ä»¶ç³»ç»Ÿå¾ˆéš¾å‘ç”Ÿå˜åŒ–ï¼Œè®¡ç®—æœºç¼–ç¨‹è¯­è¨€çš„å‘å±•ä»æœªåœæ­¢ã€‚æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªå¯ç¤ºï¼Œæ€æƒ³æœ€å®¹æ˜“åœ¨è½¯ä»¶æ–¹é¢å®ç°ï¼Œè€Œè®¡ç®—æœºç¼–ç¨‹è¯­è¨€çš„å‘å±•ä¹Ÿå°±ä¸è¶³ä¸ºå¥‡ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148373.png" alt="img"></p>
<p>â€‹    å…³äºè®¡ç®—æœºä½“ç³»ç»“æ„çš„å‘å±•ï¼Œæœ‰ä¸€å®šä»·å€¼çš„æ˜¯ï¼Œåœ¨æœªæ¥ï¼Œé‡å­è®¡ç®—æœºçš„ä½“ç³»ç»“æ„å°†ä¼šæ˜¯ä¸€ä¸ªé‡è¦çš„æ–¹å‘ã€‚éšç€é‡å­æŠ€æœ¯çš„è¿›æ­¥ï¼Œå¯¹äºå•†ä¸šè€Œè¨€ï¼Œå†æ¬¡æ€èµ·å¸‚åœºçš„æ²§æµ·æ¡‘ç”°ï¼Œè…¥é£è¡€é›¨ã€‚</p>
<h3 id="6-6-3ã€æœºå™¨å­¦ä¹ åº“"><a href="#6-6-3ã€æœºå™¨å­¦ä¹ åº“" class="headerlink" title="6.6.3ã€æœºå™¨å­¦ä¹ åº“"></a>6.6.3ã€æœºå™¨å­¦ä¹ åº“</h3><p>â€‹    æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œæœºå™¨å­¦ä¹ æ˜¯ä¸€ä¸ªå®Œå–„çš„ç”Ÿæ€ç¯å¢ƒï¼Œå¯¹äºäººå·¥æ™ºèƒ½è€Œè¨€ï¼Œç®—æ³•åº“æ˜¯é‡ä¸­ä¹‹é‡ã€‚é™ä½äº†æ™ºèƒ½è§†è§‰åˆ†æçš„é—¨æ§›ï¼ŒåŠ å¤§äº†äººå·¥æ™ºèƒ½çš„åº”ç”¨ã€‚äººå·¥æ™ºèƒ½ç®—æ³•åº“æœ‰å¾ˆå¤šï¼Œæœ¬éƒ¨åˆ†é‡ç‚¹è®¨è®ºåº”ç”¨å¹¿æ³›çš„ä¸¤ä¸ªç¥ç»ç½‘ç»œåº“ï¼ŒTensorFlowå’ŒPyTorchã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148162.png" alt="img"></p>
<p>â€‹    ç¥ç»ç½‘ç»œå¯ä»¥æŒ‡å‘ä¸¤ç§ï¼Œä¸€ä¸ªæ˜¯ç”Ÿç‰©ç¥ç»ç½‘ç»œï¼Œä¸€ä¸ªæ˜¯äººå·¥ç¥ç»ç½‘ç»œã€‚</p>
<h4 id="6-6-3-1ã€ç”Ÿç‰©ç¥ç»ç½‘ç»œ"><a href="#6-6-3-1ã€ç”Ÿç‰©ç¥ç»ç½‘ç»œ" class="headerlink" title="6.6.3.1ã€ç”Ÿç‰©ç¥ç»ç½‘ç»œ"></a>6.6.3.1ã€ç”Ÿç‰©ç¥ç»ç½‘ç»œ</h4><p>â€‹    ç”Ÿç‰©ç¥ç»ç½‘ç»œï¼šä¸€èˆ¬æŒ‡ç”Ÿç‰©çš„å¤§è„‘ç¥ç»å…ƒï¼Œç»†èƒï¼Œè§¦ç‚¹ç­‰ç»„æˆçš„ç½‘ç»œï¼Œç”¨äºäº§ç”Ÿç”Ÿç‰©çš„æ„è¯†ï¼Œå¸®åŠ©ç”Ÿç‰©è¿›è¡Œæ€è€ƒå’Œè¡ŒåŠ¨ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148129.jpeg" alt="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=1907824141,1397086773&amp;fm=26&amp;gp=0.jpg"></p>
<h4 id="6-6-3-2ã€äººå·¥ç¥ç»ç½‘ç»œ"><a href="#6-6-3-2ã€äººå·¥ç¥ç»ç½‘ç»œ" class="headerlink" title="6.6.3.2ã€äººå·¥ç¥ç»ç½‘ç»œ"></a>6.6.3.2ã€äººå·¥ç¥ç»ç½‘ç»œ</h4><p>â€‹    äººå·¥ç¥ç»ç½‘ç»œï¼ˆArtificial Neural Networksï¼Œç®€å†™ä¸ºANNsï¼‰ä¹Ÿç®€ç§°ä¸ºç¥ç»ç½‘ç»œï¼ˆNNsï¼‰æˆ–ç§°ä½œè¿æ¥æ¨¡å‹ï¼ˆConnection Modelï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§æ¨¡ä»¿åŠ¨ç‰©ç¥ç»ç½‘ç»œè¡Œä¸ºç‰¹å¾ï¼Œè¿›è¡Œåˆ†å¸ƒå¼å¹¶è¡Œä¿¡æ¯å¤„ç†çš„ç®—æ³•æ•°å­¦æ¨¡å‹ã€‚è¿™ç§ç½‘ç»œä¾é ç³»ç»Ÿçš„å¤æ‚ç¨‹åº¦ï¼Œé€šè¿‡è°ƒæ•´å†…éƒ¨å¤§é‡èŠ‚ç‚¹ä¹‹é—´ç›¸äº’è¿æ¥çš„å…³ç³»ï¼Œä»è€Œè¾¾åˆ°å¤„ç†ä¿¡æ¯çš„ç›®çš„ã€‚</p>
<p>â€‹    äººå·¥ç¥ç»ç½‘ç»œï¼šæ˜¯ä¸€ç§åº”ç”¨ç±»ä¼¼äºå¤§è„‘ç¥ç»çªè§¦è”æ¥çš„ç»“æ„è¿›è¡Œä¿¡æ¯å¤„ç†çš„æ•°å­¦æ¨¡å‹ã€‚åœ¨å·¥ç¨‹ä¸å­¦æœ¯ç•Œä¹Ÿå¸¸ç›´æ¥ç®€ç§°ä¸ºâ€œç¥ç»ç½‘ç»œâ€æˆ–ç±»ç¥ç»ç½‘ç»œã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148142.png" alt="img"></p>
<p>â€‹    äººå·¥ç¥ç»ç½‘ç»œï¼ˆArtificial Neural Networkï¼Œå³ANN ï¼‰ï¼Œæ˜¯20ä¸–çºª80 å¹´ä»£ä»¥æ¥äººå·¥æ™ºèƒ½é¢†åŸŸå…´èµ·çš„ç ”ç©¶çƒ­ç‚¹ã€‚å®ƒä»ä¿¡æ¯å¤„ç†è§’åº¦å¯¹äººè„‘ç¥ç»å…ƒç½‘ç»œè¿›è¡ŒæŠ½è±¡ï¼Œ å»ºç«‹æŸç§ç®€å•æ¨¡å‹ï¼ŒæŒ‰ä¸åŒçš„è¿æ¥æ–¹å¼ç»„æˆä¸åŒçš„ç½‘ç»œã€‚åœ¨å·¥ç¨‹ä¸å­¦æœ¯ç•Œä¹Ÿå¸¸ç›´æ¥ç®€ç§°ä¸ºç¥ç»ç½‘ç»œæˆ–ç±»ç¥ç»ç½‘ç»œã€‚ç¥ç»ç½‘ç»œæ˜¯ä¸€ç§è¿ç®—æ¨¡å‹ï¼Œç”±å¤§é‡çš„èŠ‚ç‚¹ï¼ˆæˆ–ç§°ç¥ç»å…ƒï¼‰ä¹‹é—´ç›¸äº’è”æ¥æ„æˆã€‚</p>
<p>â€‹    æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ç§ç‰¹å®šçš„è¾“å‡ºå‡½æ•°ï¼Œç§°ä¸ºæ¿€åŠ±å‡½æ•°ï¼ˆactivation functionï¼‰ã€‚æ¯ä¸¤ä¸ªèŠ‚ç‚¹é—´çš„è¿æ¥éƒ½ä»£è¡¨ä¸€ä¸ªå¯¹äºé€šè¿‡è¯¥è¿æ¥ä¿¡å·çš„åŠ æƒå€¼ï¼Œç§°ä¹‹ä¸ºæƒé‡ï¼Œè¿™ç›¸å½“äºäººå·¥ç¥ç»ç½‘ç»œçš„è®°å¿†ã€‚ç½‘ç»œçš„è¾“å‡ºåˆ™ä¾ç½‘ç»œçš„è¿æ¥æ–¹å¼ï¼Œæƒé‡å€¼å’Œæ¿€åŠ±å‡½æ•°çš„ä¸åŒè€Œä¸åŒã€‚è€Œç½‘ç»œè‡ªèº«é€šå¸¸éƒ½æ˜¯å¯¹è‡ªç„¶ç•ŒæŸç§ç®—æ³•æˆ–è€…å‡½æ•°çš„é€¼è¿‘ï¼Œä¹Ÿå¯èƒ½æ˜¯å¯¹ä¸€ç§é€»è¾‘ç­–ç•¥çš„è¡¨è¾¾ã€‚</p>
<h4 id="6-6-3-3ã€TensorFlow"><a href="#6-6-3-3ã€TensorFlow" class="headerlink" title="6.6.3.3ã€TensorFlow"></a>6.6.3.3ã€TensorFlow</h4><p>â€‹    TensorFlowâ„¢æ˜¯åŸºäºæ•°æ®æµç¼–ç¨‹ï¼ˆdataflow programmingï¼‰çš„ç¬¦å·æ•°å­¦ç³»ç»Ÿï¼Œåœ¨äººå·¥æ™ºèƒ½é¢†åŸŸï¼Œæœ‰è¿™å¹¿æ³›çš„åº”ç”¨ã€‚TensorFlowæ˜¯ä»Šå¤©ç¥ç»ç½‘ç»œè®­ç»ƒçš„ä¸»è¦å¹³å°ï¼Œæˆå°±äº†TensorFlowåœ¨ä»Šå¤©åºå¤§çš„ç”¨æˆ·ç¾¤ã€‚</p>
<p>â€‹    ç”¨äºå„ç±»æœºå™¨å­¦ä¹ ï¼ˆmachine learningï¼‰ï¼Œå‰èº«æ˜¯è°·æ­Œçš„ç¥ç»ç½‘ç»œç®—æ³•åº“DistBelief ã€‚è°·æ­Œä¸ä»…åœ¨å¤§æ•°æ®é¢†åŸŸæœ‰ç€é‡è¦çš„ä½ç½®ï¼Œåœ¨äººå·¥æ™ºèƒ½æ–¹é¢ï¼Œè°·æ­Œä¹Ÿååˆ—å‰èŒ…ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148170.png" alt="img"></p>
<p>â€‹    Tensorflowæ‹¥æœ‰å¤šå±‚çº§ç»“æ„ï¼Œä½¿ç”¨é¢å‘å„ç§åœºæ™¯ï¼Œå¯éƒ¨ç½²äºå„ç±»æœåŠ¡å™¨ã€PCç»ˆç«¯å’Œç½‘é¡µï¼Œæ”¯æŒGPUå’ŒTPUé«˜æ€§èƒ½æ•°å€¼è®¡ç®—ï¼Œå¼€å‘ç¯å¢ƒå‹å¥½ã€‚åº”ç”¨äºè°·æ­Œå†…éƒ¨çš„äº§å“å¼€å‘å’Œå„é¢†åŸŸçš„ç§‘å­¦ç ”ç©¶ ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148229.png" alt="img"></p>
<h5 id="6-6-3-3-1ã€å‘å±•"><a href="#6-6-3-3-1ã€å‘å±•" class="headerlink" title="6.6.3.3.1ã€å‘å±•"></a>6.6.3.3.1ã€å‘å±•</h5><p>â€‹    TensorFlowç”±è°·æ­Œäººå·¥æ™ºèƒ½å›¢é˜Ÿè°·æ­Œå¤§è„‘ï¼ˆGoogle Brainï¼‰å¼€å‘å’Œç»´æŠ¤ï¼Œæ˜¯è°·æ­Œæ ¸å¿ƒçš„äººå·¥æ™ºèƒ½é¡¹ç›®ã€‚æ‹¥æœ‰å¾ˆå¤šå­é¡¹ç›®ï¼šTensorFlow Hubã€TensorFlow Liteã€TensorFlow Research Cloudã€å„ç±»åº”ç”¨ç¨‹åºæ¥å£ã€‚</p>
<p>â€‹    è°·æ­Œå¤§è„‘2011å¹´æˆç«‹ï¼Œå¼€å±•é¢å‘å¤§è§„æ¨¡æ·±åº¦å­¦ä¹ åº”ç”¨ç ”ç©¶ï¼Œè°·æ­Œå¤§è„‘å…·æœ‰è‡ªæˆ‘å­¦ä¹ åŠŸèƒ½ï¼Œå°†1.6ä¸‡å¤„ç†å™¨è¿æ¥ã€‚TensorFlowçš„å‰èº«DistBeliefã€‚DistBeliefæ„å»ºå„å°ºåº¦ä¸‹çš„ç¥ç»ç½‘ç»œåˆ†å¸ƒå¼å­¦ä¹ å’Œäº¤äº’ç³»ç»Ÿï¼Œè¢«ç§°ä¸ºâ€œç¬¬ä¸€ä»£æœºå™¨å­¦ä¹ ç³»ç»Ÿâ€ï¼Œä¸ºä¸–ç•Œäººå·¥æ™ºèƒ½å‘å±•åšå‡ºäº†å“è¶Šçš„è´¡çŒ®ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148176.jpeg" alt="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=2190712454,4261596438&amp;fm=26&amp;gp=0.jpg"></p>
<p>â€‹    DistBeliefåœ¨è°·æ­Œå’ŒAlphabetæ——ä¸‹å…¬å¸çš„äº§å“å¼€å‘ä¸­å¹¿æ³›ä½¿ç”¨ï¼Œæˆæœé¢‡ä¸°ã€‚TensorFlowæ‹¥æœ‰ç”Ÿæ€ç³»ç»Ÿï¼Œä»æ•°æ®è®­ç»ƒï¼Œæ¥å£å¯¼å‡ºï¼Œåˆ°å·¥ç¨‹åº”ç”¨ã€‚2018å¹´4æœˆçš„TensorFlowå¼€å‘è€…å³°ä¼šï¼Œæœ‰21ä¸ªTensorFlowé¡¹ç›®éå¸¸æœ‰ä»·å€¼å’Œæ„ä¹‰ ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148400.png" alt="img"></p>
<h5 id="6-6-3-3-2ã€æ ¸å¿ƒç»„ä»¶"><a href="#6-6-3-3-2ã€æ ¸å¿ƒç»„ä»¶" class="headerlink" title="6.6.3.3.2ã€æ ¸å¿ƒç»„ä»¶"></a>6.6.3.3.2ã€æ ¸å¿ƒç»„ä»¶</h5><p>â€‹    TensorFlowåˆ©ç”¨GPUåšæ•°æ®è®­ç»ƒï¼Œå¯ä»¥è¿›è¡Œå•æœºä¹Ÿå¯ä»¥è¿›è¡Œåˆ†å¸ƒå¼éƒ¨ç½²ã€‚</p>
<p>â€‹    åˆä½œç»„ä»¶äº’ç›¸é…åˆï¼Œä¿è¯äº†TensorFlowçš„è¿è½¬ã€‚åˆ†å¸ƒå¼TensorFlowçš„æ ¸å¿ƒç»„ä»¶å¦‚ä¸‹ï¼š</p>
<p>â€‹    åˆ†å‘ä¸­å¿ƒï¼ˆdistributed masterï¼‰ï¼›</p>
<p>â€‹    æ‰§è¡Œå™¨ï¼ˆdataflow executor&#x2F;worker serviceï¼‰ï¼›</p>
<p>â€‹    å†…æ ¸åº”ç”¨ï¼ˆkernel implementationï¼‰</p>
<p>â€‹    æœ€åº•ç«¯çš„è®¾å¤‡å±‚ï¼ˆdevice layerï¼‰&#x2F;ç½‘ç»œå±‚ï¼ˆnetworking layerï¼‰ã€‚</p>
<p>â€‹    åˆ†å‘ä¸­å¿ƒä»è¾“å…¥çš„æ•°æ®æµå›¾ä¸­å‰ªå–å­å›¾ï¼ˆsubgraphï¼‰ï¼Œå°†å…¶åˆ’åˆ†ä¸ºæ“ä½œç‰‡æ®µå¹¶å¯åŠ¨æ‰§è¡Œå™¨ã€‚åˆ†å‘ä¸­å¿ƒå¤„ç†æ•°æ®æµå›¾æ—¶ä¼šè¿›è¡Œé¢„è®¾å®šçš„æ“ä½œä¼˜åŒ–ï¼ŒåŒ…æ‹¬å…¬å…±å­è¡¨è¾¾å¼æ¶ˆå»ï¼ˆcommon subexpression eliminationï¼‰ã€å¸¸é‡æŠ˜å ï¼ˆconstant foldingï¼‰ç­‰ã€‚</p>
<p>â€‹    æ‰§è¡Œå™¨è´Ÿè´£å›¾æ“ä½œï¼ˆgraph operationï¼‰åœ¨è¿›ç¨‹å’Œè®¾å¤‡ä¸­çš„è¿è¡Œã€æ”¶å‘å…¶å®ƒæ‰§è¡Œå™¨çš„ç»“æœã€‚åˆ†å¸ƒå¼TensorFlowæ‹¥æœ‰å‚æ•°å™¨ï¼ˆparameter serverï¼‰ä»¥æ±‡æ€»å’Œæ›´æ–°å…¶å®ƒæ‰§è¡Œå™¨è¿”å›çš„æ¨¡å‹å‚æ•°ã€‚æ‰§è¡Œå™¨åœ¨è°ƒåº¦æœ¬åœ°è®¾å¤‡æ—¶ä¼šé€‰æ‹©è¿›è¡Œå¹¶è¡Œè®¡ç®—å’ŒGPUåŠ é€Ÿ ã€‚</p>
<p>â€‹    å†…æ ¸åº”ç”¨è´Ÿè´£å•ä¸€çš„å›¾æ“ä½œï¼ŒåŒ…æ‹¬æ•°å­¦è®¡ç®—ã€æ•°ç»„æ“ä½œï¼ˆarray manipulationï¼‰ã€æ§åˆ¶æµï¼ˆcontrol flowï¼‰å’ŒçŠ¶æ€ç®¡ç†æ“ä½œï¼ˆstate management operationsï¼‰ã€‚å†…æ ¸åº”ç”¨ä½¿ç”¨Eigenæ‰§è¡Œå¼ é‡çš„å¹¶è¡Œè®¡ç®—ã€cuDNNåº“ç­‰æ‰§è¡ŒGPUåŠ é€Ÿã€gemmlowpæ‰§è¡Œä½æ•°å€¼ç²¾åº¦è®¡ç®—ï¼Œæ­¤å¤–ç”¨æˆ·å¯ä»¥åœ¨å†…æ ¸åº”ç”¨ä¸­æ³¨å†Œé¢å¤–çš„å†…æ ¸ï¼ˆfused kernelsï¼‰ä»¥æå‡åŸºç¡€æ“ä½œï¼Œä¾‹å¦‚æ¿€åŠ±å‡½æ•°å’Œå…¶æ¢¯åº¦è®¡ç®—çš„è¿è¡Œæ•ˆç‡ã€‚</p>
<p>â€‹    å•è¿›ç¨‹TensorFlowç›¸å¯¹ç®€å•ï¼Œæ•´ä½“éƒ¨ç½²è®­ç»ƒä¸æ–¹ä¾¿ï¼Œå’Œåˆ†å¸ƒå¼ç›¸æ¯”ï¼Œç»´æŠ¤ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚æ²¡æœ‰åˆ†å‘ä¸­å¿ƒå’Œæ‰§è¡Œå™¨ï¼Œä½¿ç”¨ç‰¹æ®Šçš„ä¼šè¯åº”ç”¨ï¼ˆSession implementationï¼‰è”ç³»æœ¬åœ°è®¾å¤‡ã€‚</p>
<p>â€‹    TensorFlowçš„å†…æ ¸æ˜¯Cè¯­è¨€çš„ï¼Œæä¾›çš„åŸå§‹æ¥å£ä¹Ÿæ˜¯Cè¯­è¨€çš„ã€‚å…¶å®ƒç»„ä»¶&#x2F;APIå‡é€šè¿‡Cè¯­è¨€APIä¸æ ¸å¿ƒç»„ä»¶è¿›è¡Œäº¤äº’ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148396.jpeg" alt="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=974600695,3576740431&amp;fm=15&amp;gp=0.jpg"></p>
<h5 id="6-6-3-3-3ã€ç»„ä»¶"><a href="#6-6-3-3-3ã€ç»„ä»¶" class="headerlink" title="6.6.3.3.3ã€ç»„ä»¶"></a>6.6.3.3.3ã€ç»„ä»¶</h5><p>â€‹    TensorFlow Hubæ˜¯ä¸€ä¸ªå…è®¸ç”¨æˆ·å‘å¸ƒã€å…±äº«å’Œä½¿ç”¨TensorFlowæ¨¡å—çš„åº“å¼€å‘é¡¹ç›®ã€‚ç”¨æˆ·å¯ä»¥å°†TensorFlowæ•°æ®æµå›¾æˆ–å…¶éƒ¨åˆ†ä½¿ç”¨Hubè¿›è¡Œå°è£…å¹¶ç§»æ¤åˆ°å…¶å®ƒé—®é¢˜ä¸­å†æ¬¡åˆ©ç”¨ã€‚TensorFlow Hubé¡µé¢åˆ—å‡ºäº†ç”±è°·æ­Œå’ŒDeepMindæä¾›çš„å°è£…æ¨¡å‹ï¼Œå…¶ä¸»é¢˜åŒ…æ‹¬å­—ç¬¦åµŒå…¥ã€è§†é¢‘åˆ†ç±»å’Œå›¾åƒå¤„ç†ã€‚</p>
<p>â€‹    TensorFlow Extended (TFX)ï¼ŒTFXæ˜¯è°·æ­ŒåŸºäºTensorFlowå¼€å‘çš„äº§å“çº§æœºå™¨å­¦ä¹ å¹³å°ï¼Œå…¶ç›®æ ‡æ˜¯æ˜¯å¯¹äº§å“å¼€å‘ä¸­çš„æ¨¡å‹å®ç°ã€åˆ†æéªŒè¯å’Œä¸šåŠ¡åŒ–æ“ä½œè¿›è¡Œæ•´åˆï¼Œåœ¨å®æ—¶æ•°æ®ä¸‹å®Œæˆæœºå™¨å­¦ä¹ äº§å“çš„æ ‡å‡†åŒ–ç”Ÿäº§ã€‚TFXåŒ…å«ä¸‰ä¸ªç®—æ³•åº“ï¼šTensorFlow Data Validationå¯¹æœºå™¨å­¦ä¹ æ•°æ®è¿›è¡Œç»Ÿè®¡æè¿°å’ŒéªŒè¯ã€TensorFlow Transformå¯¹æ¨¡å‹æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€        TensorFlow Model Analysiså¯¹æœºå™¨å­¦ä¹ æ¨¡å‹è¿›è¡Œåˆ†æï¼Œæä¾›è¡¨ç°è¯„åˆ†ã€‚å¦æœ‰TensorFlow Servingä½œä¸ºæ¨¡å‹ä¸šåŠ¡åŒ–çš„é«˜æ€§èƒ½ç³»ç»Ÿï¼Œæä¾›æ¨¡å‹æ¥å£å’Œç®¡ç†ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148449.png" alt="img"></p>
<p>â€‹    TensorFlow Probability (TFP)ï¼ŒTFPæ˜¯åœ¨TensorFlow Python APIåŸºç¡€ä¸Šå¼€å‘çš„ç»Ÿè®¡å­¦ç®—æ³•åº“ï¼Œå…¶ç›®æ ‡æ˜¯æ–¹ä¾¿ç”¨æˆ·å°†æ¦‚ç‡æ¨¡å‹å’Œæ·±åº¦å­¦ä¹ æ¨¡å‹ç›¸ç»“åˆä½¿ç”¨ã€‚TFPåŒ…å«å¤§é‡æ¦‚ç‡åˆ†å¸ƒçš„ç”Ÿæˆå™¨ã€æ”¯æŒæ„å»ºæ·±åº¦ç½‘ç»œçš„æ¦‚ç‡å±‚ï¼ˆprobabilistic layersï¼‰ã€æä¾›å˜åˆ†è´å¶æ–¯æ¨æ–­ï¼ˆVariational inferenceï¼‰å’Œé©¬å°”å¯å¤«é“¾è’™ç‰¹å¡ç½—æ–¹æ³•ï¼ˆMarkov chain Monte Carloï¼‰å’Œä¸€äº›ç‰¹æ®Šçš„ä¼˜åŒ–å™¨ï¼ŒåŒ…æ‹¬Nelder-Meadæ–¹æ¡ˆã€BFGSç®—æ³•ï¼ˆBroyden-Fletcher-Goldfarb-Shanno algorithmï¼‰å’ŒSGLDï¼ˆStochastic Gradient Langevin Dynamicsï¼‰ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148432.png" alt="https://www.yht7.com/upload/image/20200419/1354575-20200418172212742-1807272001.png"></p>
<p>â€‹    TensorFlow.jsæ˜¯TensorFlowçš„JavaScript APIï¼Œä¸»è¦ç”¨äºç½‘é¡µç«¯çš„æœºå™¨å­¦ä¹ åº”ç”¨å¼€å‘ã€‚æ–¹ä¾¿ç½‘é¡µç”¨æˆ·è¿›è¡Œäººå·¥æ™ºèƒ½æ•°æ®è®­ç»ƒã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148452.png" alt="img"></p>
<p>â€‹    TensorFlow Liteæ˜¯ä¸ºç§»åŠ¨å’ŒåµŒå…¥å¼è®¾å¤‡æä¾›äººå·¥æ™ºèƒ½æ”¯æŒï¼Œåœ¨Androidã€iOSç³»ç»Ÿä¸‹æœºå™¨å­¦ä¹ æ¨¡å‹çš„å“åº”æ—¶é—´å¹¶é™ä½æ–‡ä»¶å¤§å°ã€‚TensorFlow Liteéƒ¨ç½²äº†å¤§éƒ¨åˆ†äººå·¥æ™ºèƒ½ç®—æ³•ï¼Œå…·æœ‰å¾ˆå¥½çš„å‚è€ƒä»·å€¼ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148537.png" alt="img"></p>
<p>â€‹    Swift for TensorFlowæ˜¯å¼€æºç‰ˆSwiftçš„TensorFlow APIå¼€å‘é¡¹ç›®ï¼Œåœ¨æ·±åº¦å­¦ä¹ å’Œå¾®åˆ†è®¡ç®—æ–¹é¢åº”ç”¨ã€‚å’ŒEager Executionå¾ˆç›¸åƒï¼Œå¯ç›´æ¥æ‰§è¡Œæ•°æ®æµå›¾ï¼Œå…·å¤‡æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148583.png" alt="img"></p>
<p>â€‹    TensorFlow Research Cloudæ˜¯é¢å‘ç§‘å­¦ç ”ç©¶çš„æœºå™¨å­¦ä¹ TPUäº‘è®¡ç®—å¹³å°ã€‚è¯¥é¡¹ç›®æ‹¥æœ‰1000ä¸ªäº‘TPUå’Œæ€»è®¡180åƒä¸‡äº¿æ¬¡è®¡ç®—åŠ›ï¼Œæ¯ä¸ªTPUæ‹¥æœ‰64 GBçš„é«˜å¸¦å®½å†…å­˜ ã€‚å¯ä»¥é€šè¿‡äº’è”ç½‘ç”³è¯·ä½¿ç”¨ï¼Œè¿›è¡Œæœ‰ä»·å€¼çš„äººå·¥æ™ºèƒ½æ•°æ®è®­ç»ƒã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148715.png" alt="img"></p>
<h5 id="6-6-3-3-4ã€å…¶å®ƒ"><a href="#6-6-3-3-4ã€å…¶å®ƒ" class="headerlink" title="6.6.3.3.4ã€å…¶å®ƒ"></a>6.6.3.3.4ã€å…¶å®ƒ</h5><p>â€‹    Magentaæ˜¯åœ¨è‰ºæœ¯é¢†åŸŸä½¿ç”¨æœºå™¨å­¦ä¹ çš„ç ”ç©¶é¡¹ç›®ï¼Œè¯¥é¡¹ç›®ä½¿ç”¨æ·±åº¦å­¦ä¹ ç½‘ç»œå’Œå¼ºåŒ–å­¦ä¹ ç®—æ³•å­¦ä¹ ç”ŸæˆéŸ³ä¹ã€ç»˜ç”»å’Œå…¶å®ƒè‰ºæœ¯ä½œå“ï¼Œä»¥å¸®åŠ©è‰ºæœ¯äººå‘˜æ‹“å±•å…¶åˆ›ä½œè¿‡ç¨‹ ã€‚Magentaé¡¹ç›®çš„ç ”ç©¶æˆæœåŒ…æ‹¬éŸ³ä¹åˆ›ä½œå·¥å…·NSynthå’Œæ··éŸ³å·¥å…·MusicVAEã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148710.png" alt="img"></p>
<p>â€‹    Nucleusæ˜¯å°†TensorFlowåº”ç”¨äºåŸºå› ç»„æ–‡ä»¶ï¼Œä¾‹å¦‚SAMå’ŒVCFæ ¼å¼æ–‡ä»¶çš„è¯»å†™å’Œåˆ†æçš„åº“å¼€å‘é¡¹ç›® ã€‚Nucleusä½¿ç”¨Pythonå’ŒC++è¿›è¡Œå¼€å‘ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148725.png" alt="img"></p>
<h4 id="6-6-3-2ã€PyTorch"><a href="#6-6-3-2ã€PyTorch" class="headerlink" title="6.6.3.2ã€PyTorch"></a>6.6.3.2ã€PyTorch</h4><p>â€‹    PyTorchæ˜¯ä¸€ä¸ªå¼€æºçš„Pythonæœºå™¨å­¦ä¹ åº“ï¼ŒåŸºäºTorchï¼Œç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†ç­‰åº”ç”¨ç¨‹åºã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148729.png" alt="img"></p>
<p>â€‹    2017å¹´1æœˆï¼Œç”±Facebookäººå·¥æ™ºèƒ½ç ”ç©¶é™¢ï¼ˆFAIRï¼‰åŸºäºTorchæ¨å‡ºäº†PyTorchã€‚å®ƒæ˜¯ä¸€ä¸ªåŸºäºPythonçš„è®¡ç®—åŒ…ï¼Œæä¾›ä¸¤ä¸ªé«˜çº§åŠŸèƒ½ï¼š1ã€å…·æœ‰å¼ºå¤§çš„GPUåŠ é€Ÿçš„å¼ é‡è®¡ç®—ï¼ˆå¦‚NumPyï¼‰ã€‚2ã€åŒ…å«è‡ªåŠ¨æ±‚å¯¼ç³»ç»Ÿçš„æ·±åº¦ç¥ç»ç½‘ç»œã€‚</p>
<p>â€‹    PyTorchä½¿ç”¨Pythoné‡å†™äº†å¾ˆå¤šå†…å®¹ï¼Œæ›´åŠ çµæ´»ï¼Œæ”¯æŒåŠ¨æ€å›¾ï¼Œæä¾›äº†Pythonæ¥å£ã€‚å®ƒæ˜¯ç”±Torch7å›¢é˜Ÿå¼€å‘ï¼Œæ˜¯ä¸€ä¸ªä»¥Pythonä¼˜å…ˆçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œå®ç°å¼ºå¤§çš„GPUåŠ é€Ÿï¼Œæ”¯æŒåŠ¨æ€ç¥ç»ç½‘ç»œã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148793.jpeg" alt="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3593097388,1004973136&amp;fm=26&amp;gp=0.jpg"></p>
<p>â€‹    PyTorchå¯ä»¥çœ‹ä½œåŠ å…¥äº†GPUæ”¯æŒçš„numpyï¼Œä¹Ÿå¯ä»¥çœ‹æˆæ‹¥æœ‰è‡ªåŠ¨æ±‚å¯¼åŠŸèƒ½çš„å¼ºå¤§çš„æ·±åº¦ç¥ç»ç½‘ç»œã€‚é™¤Facebookå¤–ï¼Œå·²ç»è¢«Twitterã€CMUå’ŒSalesforceç­‰æœºæ„é‡‡ç”¨ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148838.png" alt="img"></p>
<p>â€‹    PyTorchç®€æ´é«˜æ•ˆï¼Œå¿«é€Ÿåº”ç”¨çš„æ¡†æ¶ï¼Œè®¾è®¡è¿½æ±‚æœ€å°‘å°è£…ï¼Œç¬¦åˆäººç±»æ€ç»´ï¼Œè®©ç”¨æˆ·å°½å¯èƒ½åœ°ä¸“æ³¨äºå®ç°è‡ªå·±çš„æƒ³æ³•ï¼Œä¸googleçš„Tensorflowç±»ä¼¼ï¼ŒFAIRçš„æ”¯æŒè¶³ä»¥ç¡®ä¿PyTorchè·å¾—æŒç»­çš„å¼€å‘æ›´æ–°ã€‚</p>
<p>  æ— è®ºå¯¹äºæœºå™¨è§†è§‰ï¼Œè¿˜æ˜¯äººå·¥æ™ºèƒ½ï¼Œç›¸å¯¹ä»å‰ï¼Œæ•°æ®é‡å‘ç”Ÿäº†åœ°è¦†å¤©ç¿»çš„å˜åŒ–ã€‚ä¼ ç»Ÿçš„è¿ç®—æ¡†æ¶ä¸èƒ½æ»¡è¶³ç°å®çš„å‘å±•ã€‚äººå·¥æ™ºèƒ½å½±å“ä¸æ˜¯ä¸€ç‚¹ä¸€çº¿ï¼Œè€Œæ˜¯æ•´ä¸ªè®¡ç®—ä½“ç³»ã€‚</p>
<p>â€‹    ä»AI&#x2F;AR&#x2F;VRèŠ¯ç‰‡ï¼Œåˆ°GPUæ•°æ®å¤„ç†ï¼Œå†åˆ°å¹³å°æ¶æ„ï¼Œæ¡†æ¶ç¼–ç¨‹ï¼Œå¤–éƒ¨æ¥å£è°ƒç”¨ï¼Œéƒ½æœ‰å·¨å¤§çš„å˜é©ã€‚ä»Šå¤©æˆ‘ä»¬è°ˆä¸€ä¸‹åŸºäºå¤§æ‰¹é‡æ•°æ®çš„è¿ç®—æ¡†æ¶ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148028.png" alt="img"></p>
<p>â€‹    GPUçš„å‚ä¸æ•°æ®å¤„ç†å·²ç»å¤šå¹´ï¼Œå¤šå¹´å‘å±•è¿‡ç¨‹ä¸­ï¼ŒGPUä¸è¿‡æ˜¯ç¡¬ä»¶çš„æ”¯æŒ(å¦‚ä¸‹å›¾)ï¼ŒæŒ‡ä»¤çš„æä¾›ï¼Œä¼ ç»Ÿçš„å·¥ç¨‹å¸ˆå¾ˆéš¾è¿›è¡ŒæŒ‡ä»¤çº§çš„å¼€å‘ã€‚æ‰€ä»¥ï¼Œè¿ç®—å¹³å°å‡ºç°äº†ï¼Œæ‹“å±•äº†æŠ€æœ¯åº”ç”¨ï¼Œä¾¿æ·äº†è½¯ä»¶å¼€å‘ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148094.png" alt="http://attachbak.dataguru.cn/attachments/forum/201604/24/180629knkh2kffhhwwl23f.png"></p>
<p>â€‹    ä¸‹é¢è®²è¿°ç›®å‰æœ€å¹¿æ³›çš„ä¸¤ä¸ªè¿ç®—å¹³å°ï¼Œè‹±ä¼Ÿè¾¾çš„CUDAå’Œå¼€æ”¾çš„OPENCLå¹³å°ã€‚</p>
<h4 id="6-6-2-1ã€CUDA"><a href="#6-6-2-1ã€CUDA" class="headerlink" title="6.6.2.1ã€CUDA"></a>6.6.2.1ã€CUDA</h4><p>â€‹    CUDAï¼ˆCompute Unified Device Architectureï¼‰ï¼ŒCUDAâ„¢æ˜¯ç”±NVIDIAæ¨å‡ºçš„å¹¶è¡Œè®¡ç®—æ¶æ„ï¼Œè¯¥æ¶æ„ä½¿GPUè§£å†³å¤æ‚çš„è®¡ç®—é—®é¢˜ã€‚åŒ…å«äº†CUDAæŒ‡ä»¤é›†æ¶æ„ï¼ˆISAï¼‰ä»¥åŠGPUå†…éƒ¨çš„å¹¶è¡Œè®¡ç®—å¼•æ“ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148827.png" alt="img"></p>
<p>â€‹    å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨Cè¯­è¨€æ¥ä¸ºCUDAâ„¢æ¶æ„ç¼–å†™ç¨‹åºï¼ŒCè¯­è¨€æ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ä¸€ç§é«˜çº§ç¼–ç¨‹è¯­è¨€ã€‚ç¼–å†™å‡ºçš„ç¨‹åºå¯ä»¥åœ¨æ”¯æŒCUDAâ„¢çš„å¤„ç†å™¨ä¸Šä»¥è¶…é«˜æ€§èƒ½è¿è¡Œã€‚</p>
<p>â€‹    è®¡ç®—è¡Œä¸šä»åªä½¿ç”¨CPUçš„â€œä¸­å¤®å¤„ç†â€å‘CPUä¸GPUå¹¶ç”¨çš„â€œååŒå¤„ç†â€å‘å±•ã€‚ä¸ºæ‰“é€ è¿™ä¸€å…¨æ–°çš„è®¡ç®—å…¸èŒƒï¼ŒNVIDIAâ„¢ï¼ˆè‹±ä¼Ÿè¾¾â„¢ï¼‰å‘æ˜äº†CUDAï¼ˆCompute Unified Device Architectureï¼Œç»Ÿä¸€è®¡ç®—è®¾å¤‡æ¶æ„ï¼‰è¿™ä¸€ç¼–ç¨‹æ¨¡å‹ã€‚</p>
<h5 id="6-6-2-1-1ã€åº”ç”¨"><a href="#6-6-2-1-1ã€åº”ç”¨" class="headerlink" title="6.6.2.1.1ã€åº”ç”¨"></a>6.6.2.1.1ã€åº”ç”¨</h5><p>â€‹    åœ¨åº”ç”¨ç¨‹åºä¸­å……åˆ†åˆ©ç”¨CPUå’ŒGPUå„è‡ªçš„ä¼˜ç‚¹ã€‚è¯¥æ¶æ„å·²åº”ç”¨äºGeForceâ„¢ï¼ˆç²¾è§†â„¢ï¼‰ã€IONâ„¢ï¼ˆç¿¼æ‰¬â„¢ï¼‰ã€Quadroä»¥åŠTesla GPUï¼ˆå›¾å½¢å¤„ç†å™¨ï¼‰ä¸Šï¼Œå¯¹åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„å¸‚åœºã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148781.png" alt="http://attachbak.dataguru.cn/attachments/forum/201604/24/180626qfnnioezwoc57w15.png"></p>
<p>â€‹    åœ¨æ¶ˆè´¹çº§å¸‚åœºä¸Šï¼Œå‡ ä¹æ¯ä¸€æ¬¾é‡è¦çš„æ¶ˆè´¹çº§è§†é¢‘åº”ç”¨ç¨‹åºéƒ½å·²ç»ä½¿ç”¨CUDAåŠ é€Ÿæˆ–å¾ˆå¿«å°†ä¼šåˆ©ç”¨CUDAæ¥åŠ é€Ÿï¼Œå…¶ä¸­åŒ…æ‹¬Elemental Technologieså…¬å¸ã€MotionDSPå…¬å¸ä»¥åŠLoiLoå…¬å¸çš„äº§å“ã€‚</p>
<p>â€‹    åœ¨ç§‘ç ”ç•Œï¼ŒCUDAä¸€ç›´å—åˆ°çƒ­æ§ã€‚ä¾‹å¦‚ï¼ŒCUDAç°å·²èƒ½å¤Ÿå¯¹AMBERè¿›è¡ŒåŠ é€Ÿã€‚AMBERæ˜¯ä¸€æ¬¾åˆ†å­åŠ¨åŠ›å­¦æ¨¡æ‹Ÿç¨‹åºï¼Œå…¨ä¸–ç•Œåœ¨å­¦æœ¯ç•Œä¸åˆ¶è¯ä¼ä¸šä¸­æœ‰è¶…è¿‡60ï¼Œ000åç ”ç©¶äººå‘˜ä½¿ç”¨è¯¥ç¨‹åºæ¥åŠ é€Ÿæ–°è¯çš„æ¢ç´¢å·¥ä½œã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148810.png" alt="img"></p>
<p>â€‹    åœ¨é‡‘èå¸‚åœºï¼ŒNumerixä»¥åŠCompatibLé’ˆå¯¹ä¸€æ¬¾å…¨æ–°çš„å¯¹æ‰‹é£é™©åº”ç”¨ç¨‹åºå‘å¸ƒäº†CUDAæ”¯æŒå¹¶å–å¾—äº†18å€é€Ÿåº¦æå‡ã€‚Numerixä¸ºè¿‘400å®¶é‡‘èæœºæ„æ‰€å¹¿æ³›ä½¿ç”¨ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148816.png" alt="img"></p>
<p>â€‹    CUDAçš„å¹¿æ³›åº”ç”¨é€ å°±äº†GPUè®¡ç®—ä¸“ç”¨Tesla GPUçš„å´›èµ·ã€‚å…¨çƒè´¢å¯Œäº”ç™¾å¼ºä¼ä¸šå·²ç»å®‰è£…äº†700å¤šä¸ªGPUé›†ç¾¤ï¼Œè¿™äº›ä¼ä¸šæ¶‰åŠå„ä¸ªé¢†åŸŸï¼Œä¾‹å¦‚èƒ½æºé¢†åŸŸçš„æ–¯ä¼¦è´è°¢ä¸é›ªä½›é¾™ä»¥åŠé“¶è¡Œä¸šçš„æ³•å›½å·´é»é“¶è¡Œï¼ŒåŒ…æ‹¬é˜¿é‡Œäº‘ã€‚</p>
<p>â€‹    GPUè®¡ç®—ç›®å‰æˆä¸ºä¸»æµã€‚åœ¨æ˜¾å¡ç¡¬ä»¶ä¸Šï¼ŒGPUå°†ä¸ä»…ä»…æ˜¯å›¾å½¢å¤„ç†å™¨ï¼Œè¿˜æ˜¯åº”ç”¨ç¨‹åºå‡å¯ä½¿ç”¨çš„é€šç”¨å¹¶è¡Œå¤„ç†å™¨ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148060.png" alt="img"></p>
<p>â€‹    éšç€æ˜¾å¡çš„å‘å±•ï¼ŒGPUè¶Šæ¥è¶Šå¼ºå¤§ï¼ŒGPUä¸ºå›¾åƒå¤„ç†åšäº†ä¼˜åŒ–ã€‚è®¡ç®—ä¸Šè¶…è¶Šäº†é€šç”¨çš„CPUã€‚å¼ºå¤§çš„èŠ¯ç‰‡ä¸èƒ½ä»…ä»…è¿›è¡Œæ˜¾ç¤ºï¼Œå› æ­¤NVIDIAæ¨å‡ºCUDAï¼Œè®©æ˜¾å¡å¯ä»¥ç”¨äºå›¾åƒè®¡ç®—ä»¥å¤–çš„ç›®çš„ã€‚</p>
<p>â€‹    CUDAæ¶æ„å¯ä»¥ä½¿ç”¨GPUæ¥è§£å†³å•†ä¸šã€å·¥ä¸šä»¥åŠç§‘å­¦æ–¹é¢çš„å¤æ‚è®¡ç®—é—®é¢˜ã€‚å®ƒæ˜¯ä¸€ä¸ªå®Œæ•´çš„GPGPUè§£å†³æ–¹æ¡ˆï¼Œæä¾›äº†ç¡¬ä»¶çš„ç›´æ¥è®¿é—®æ¥å£ï¼Œè€Œä¸å¿…åƒä¼ ç»Ÿæ–¹å¼ä¸€æ ·å¿…é¡»ä¾èµ–å›¾å½¢APIæ¥å£æ¥å®ç°GPUçš„è®¿é—®ã€‚</p>
<h5 id="6-6-2-1-2ã€ç³»ç»Ÿç»“æ„"><a href="#6-6-2-1-2ã€ç³»ç»Ÿç»“æ„" class="headerlink" title="6.6.2.1.2ã€ç³»ç»Ÿç»“æ„"></a>6.6.2.1.2ã€ç³»ç»Ÿç»“æ„</h5><p>â€‹    åœ¨æ¶æ„ä¸Šé‡‡ç”¨äº†ä¸€ç§å…¨æ–°çš„è®¡ç®—ä½“ç³»ç»“æ„æ¥ä½¿ç”¨GPUæä¾›çš„ç¡¬ä»¶èµ„æºï¼Œä»è€Œç»™å¤§è§„æ¨¡çš„æ•°æ®è®¡ç®—åº”ç”¨æä¾›äº†ä¸€ç§æ¯”CPUæ›´åŠ å¼ºå¤§çš„è®¡ç®—èƒ½åŠ›ã€‚CUDAé‡‡ç”¨Cè¯­è¨€ä½œä¸ºç¼–ç¨‹è¯­è¨€æä¾›å¤§é‡çš„é«˜æ€§èƒ½è®¡ç®—æŒ‡ä»¤å¼€å‘èƒ½åŠ›ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨GPUçš„å¼ºå¤§è®¡ç®—èƒ½åŠ›çš„åŸºç¡€ä¸Šå»ºç«‹èµ·ä¸€ç§æ•ˆç‡æ›´é«˜çš„å¯†é›†æ•°æ®è®¡ç®—è§£å†³æ–¹æ¡ˆã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148088.png" alt="img"></p>
<p>â€‹    CUDAä½“ç³»ç»“æ„åŒ…å«ä¸‰éƒ¨åˆ†ï¼šå¼€å‘åº“ã€è¿è¡ŒæœŸç¯å¢ƒå’Œé©±åŠ¨ã€‚</p>
<p>â€‹    å¼€å‘åº“æ˜¯åŸºäºCUDAæŠ€æœ¯æä¾›çš„åº”ç”¨å¼€å‘åº“ã€‚CUDA1ã€‚1ç‰ˆæä¾›äº†ä¸¤ä¸ªæ ‡å‡†çš„æ•°å­¦è¿ç®—åº“â€”â€”CUFFTï¼ˆç¦»æ•£å¿«é€Ÿå‚…ç«‹å¶å˜æ¢ï¼‰å’ŒCUBLASï¼ˆç¦»æ•£åŸºæœ¬çº¿æ€§è®¡ç®—ï¼‰çš„å®ç°ã€‚è¿™ä¸¤ä¸ªæ•°å­¦è¿ç®—åº“è§£å†³çš„æ˜¯å…¸å‹çš„å¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—é—®é¢˜ï¼Œä¹Ÿæ˜¯åœ¨å¯†é›†æ•°æ®è®¡ç®—ä¸­éå¸¸å¸¸è§çš„è®¡ç®—ç±»å‹ã€‚å¼€å‘äººå‘˜åœ¨å¼€å‘åº“çš„åŸºç¡€ä¸Šå¿«é€Ÿã€æ–¹ä¾¿çš„å»ºç«‹èµ·è‡ªå·±çš„è®¡ç®—åº”ç”¨ã€‚æ­¤å¤–ï¼Œå¼€å‘äººå‘˜ä¹Ÿå¯ä»¥åœ¨CUDAçš„æŠ€æœ¯åŸºç¡€ä¸Šå®ç°å‡ºæ›´å¤šçš„å¼€å‘åº“ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148086.png" alt="img"></p>
<p>â€‹    è¿è¡ŒæœŸç¯å¢ƒæä¾›äº†åº”ç”¨å¼€å‘æ¥å£å’Œè¿è¡ŒæœŸç»„ä»¶ï¼ŒåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹çš„å®šä¹‰å’Œå„ç±»è®¡ç®—ã€ç±»å‹è½¬æ¢ã€å†…å­˜ç®¡ç†ã€è®¾å¤‡è®¿é—®å’Œæ‰§è¡Œè°ƒåº¦ç­‰å‡½æ•°ã€‚åŸºäºCUDAå¼€å‘çš„ç¨‹åºä»£ç åœ¨å®é™…æ‰§è¡Œä¸­åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯è¿è¡Œåœ¨CPUä¸Šçš„å®¿ä¸»ä»£ç ï¼ˆHost Codeï¼‰ï¼Œä¸€ç§æ˜¯è¿è¡Œåœ¨GPUä¸Šçš„è®¾å¤‡ä»£ç ï¼ˆDevice Codeï¼‰ã€‚ä¸åŒç±»å‹ä»£ç è¿è¡Œçš„ç‰©ç†ä½ç½®ä¸åŒï¼Œè®¿é—®çš„èµ„æºä¸åŒï¼Œå¯¹åº”çš„è¿è¡ŒæœŸç»„ä»¶ä¹Ÿåˆ†ä¸ºå…¬å…±ç»„ä»¶ã€å®¿ä¸»ç»„ä»¶å’Œè®¾å¤‡ç»„ä»¶ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå›Šæ‹¬äº†æ‰€æœ‰åœ¨GPGPUå¼€å‘ä¸­æ‰€éœ€è¦çš„åŠŸèƒ½å’Œèƒ½å¤Ÿä½¿ç”¨åˆ°çš„èµ„æºæ¥å£ï¼Œå¼€å‘äººå‘˜é€šè¿‡è¿è¡ŒæœŸç¯å¢ƒçš„ç¼–ç¨‹æ¥å£å®ç°å„ç§ç±»å‹çš„è®¡ç®—ã€‚</p>
<p>â€‹    ç”±äºå­˜åœ¨ç€å¤šç§GPUç‰ˆæœ¬çš„NVidiaæ˜¾å¡ï¼Œä¸åŒç‰ˆæœ¬çš„GPUä¹‹é—´éƒ½æœ‰ä¸åŒçš„å·®å¼‚ï¼Œå› æ­¤é©±åŠ¨éƒ¨åˆ†åŸºæœ¬ä¸Šå¯ä»¥ç†è§£ä¸ºæ˜¯CUDA-enableçš„GPUçš„è®¾å¤‡æŠ½è±¡å±‚ï¼Œæä¾›ç¡¬ä»¶è®¾å¤‡çš„æŠ½è±¡è®¿é—®æ¥å£ã€‚CUDAæä¾›è¿è¡ŒæœŸç¯å¢ƒé€šè¿‡è¿™ä¸€å±‚æ¥å®ç°å„ç§åŠŸèƒ½ã€‚åŸºäºCUDAå¼€å‘çš„åº”ç”¨å¿…é¡»æœ‰NVIDIA CUDA-enableçš„ç¡¬ä»¶æ”¯æŒã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148132.png" alt="http://attachbak.dataguru.cn/attachments/forum/201604/24/180626v66bl8kkukn3unfp.png"></p>
<p>â€‹    NVIDIAå…¬å¸GPUè¿ç®—äº‹ä¸šéƒ¨æ€»ç»ç†Andy Keaneåœ¨æ´»åŠ¨ä¸­è¡¨ç¤ºï¼šä¸€ä¸ªå……æ»¡ç”Ÿå‘½åŠ›çš„æŠ€æœ¯å¹³å°åº”è¯¥æ˜¯å¼€æ”¾çš„ï¼ŒCUDAæœªæ¥ä¹Ÿä¼šå‘è¿™ä¸ªæ–¹å‘å‘å±•ã€‚ç”±äºCUDAçš„ä½“ç³»ç»“æ„ä¸­æœ‰ç¡¬ä»¶æŠ½è±¡å±‚çš„å­˜åœ¨ï¼Œå› æ­¤ä»Šåä¹Ÿæœ‰å¯èƒ½å‘å±•æˆä¸ºä¸€ä¸ªé€šç”¨çš„GPGPUæ ‡å‡†æ¥å£ï¼Œå…¼å®¹ä¸åŒå‚å•†çš„GPUäº§å“ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148328.png" alt="img"></p>
<p>â€‹    æ”¯æŒCUDAçš„GPUé”€é‡é€¾10äº¿ï¼Œæ•°ä»¥ä¸‡è®¡çš„å¼€å‘äººå‘˜æ­£åœ¨ä½¿ç”¨å…è´¹çš„CUDAè½¯ä»¶å¼€å‘å·¥å…·æ¥è§£å†³å„ç§é—®é¢˜ã€‚ä»è§†é¢‘ä¸éŸ³é¢‘å¤„ç†å’Œç‰©ç†æ•ˆæœæ¨¡æ‹Ÿåˆ°çŸ³æ²¹å¤©ç„¶æ°”å‹˜æ¢ã€äº§å“è®¾è®¡ã€åŒ»å­¦æˆåƒä»¥åŠç§‘å­¦ç ”ç©¶ï¼Œæ¶µç›–äº†å„ä¸ªé¢†åŸŸã€‚</p>
<h5 id="6-6-2-1-3ã€æ ¸å¿ƒ"><a href="#6-6-2-1-3ã€æ ¸å¿ƒ" class="headerlink" title="6.6.2.1.3ã€æ ¸å¿ƒ"></a>6.6.2.1.3ã€æ ¸å¿ƒ</h5><p>â€‹    CUDAçš„æ ¸å¿ƒæœ‰ä¸‰ä¸ªé‡è¦æŠ½è±¡æ¦‚å¿µï¼š çº¿ç¨‹ç»„å±‚æ¬¡ç»“æ„ã€å…±äº«å­˜å‚¨å™¨ã€å±è”½åŒæ­¥ï¼ˆbarriersynchronizationï¼‰ï¼Œè½»æ¾å°†å…¶ä½œä¸ºCè¯­è¨€çš„æœ€å°æ‰©å±•çº§å…¬å¼€ç»™ç¨‹åºå‘˜ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148351.png" alt="img"></p>
<p>â€‹    CUDA è½¯ä»¶å †æ ˆç”±å‡ å±‚ç»„æˆï¼Œä¸€ä¸ªç¡¬ä»¶é©±åŠ¨ç¨‹åºï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰å’Œå®ƒçš„Runtimeï¼Œè¿˜æœ‰äºŒä¸ªé«˜çº§çš„é€šç”¨æ•°å­¦åº“ï¼ŒCUFFT å’ŒCUBLASã€‚ç¡¬ä»¶è¢«è®¾è®¡æˆæ”¯æŒè½»é‡çº§çš„é©±åŠ¨å’ŒRuntime å±‚é¢ï¼Œå› è€Œæé«˜æ€§èƒ½ã€‚</p>
<h5 id="6-6-2-1-4ã€å…¶å®ƒ"><a href="#6-6-2-1-4ã€å…¶å®ƒ" class="headerlink" title="6.6.2.1.4ã€å…¶å®ƒ"></a>6.6.2.1.4ã€å…¶å®ƒ</h5><p>â€‹    NVIDIAè¿›å†›é«˜æ€§èƒ½è®¡ç®—é¢†åŸŸï¼Œæ¨å‡ºäº†Tesla&amp;CUDAé«˜æ€§èƒ½è®¡ç®—ç³»åˆ—è§£å†³æ–¹æ¡ˆï¼ŒCUDAæŠ€æœ¯ï¼Œä¸€ç§åŸºäºNVIDIAå›¾å½¢å¤„ç†å™¨ï¼ˆGPUï¼‰ä¸Šå…¨æ–°çš„å¹¶è¡Œè®¡ç®—ä½“ç³»æ¶æ„ï¼Œè®©ç§‘å­¦å®¶ã€å·¥ç¨‹å¸ˆå’Œå…¶å®ƒä¸“ä¸šæŠ€æœ¯äººå‘˜èƒ½å¤Ÿè§£å†³ä»¥å‰æ— æ³•è§£å†³çš„é—®é¢˜ï¼Œä½œä¸ºä¸€ä¸ªä¸“ç”¨é«˜æ€§èƒ½GPUè®¡ç®—è§£å†³æ–¹æ¡ˆï¼ŒNVIDIAæŠŠè¶…çº§è®¡ç®—èƒ½å¤Ÿå¸¦ç»™ä»»ä½•å·¥ä½œç«™æˆ–æœåŠ¡å™¨ï¼Œä»¥åŠæ ‡å‡†ã€åŸºäºCPUçš„æœåŠ¡å™¨é›†ç¾¤ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148371.png" alt="img"></p>
<p>â€‹    CUDAæ˜¯ç”¨äºGPUè®¡ç®—çš„å¼€å‘ç¯å¢ƒï¼Œæ˜¯ä¸€ä¸ªå…¨æ–°çš„è½¯ç¡¬ä»¶æ¶æ„ï¼Œå¯ä»¥å°†GPUè§†ä¸ºä¸€ä¸ªå¹¶è¡Œæ•°æ®è®¡ç®—çš„è®¾å¤‡ï¼Œå¯¹è®¡ç®—åˆ†é…å’Œç®¡ç†ã€‚CUDAçš„æ¶æ„ä¸­ï¼Œè®¡ç®—ä¸å†åƒè¿‡å»æ‰€è°“çš„GPGPUæ¶æ„é‚£æ ·å¿…é¡»å°†è®¡ç®—æ˜ å°„åˆ°å›¾å½¢APIï¼ˆOpenGLå’ŒDirect 3Dï¼‰ä¸­ï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´ï¼ŒCUDAçš„å¼€å‘é—¨æ§›å¤§å¤§é™ä½ã€‚CUDAç¼–ç¨‹åŸºäºCè¯­è¨€ï¼Œä»»ä½•æœ‰Cè¯­è¨€åŸºç¡€çš„ç”¨æˆ·éƒ½å¾ˆå®¹æ˜“åœ°å¼€å‘CUDAçš„åº”ç”¨ç¨‹åºã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148430.png" alt="img"></p>
<p>â€‹    GPUçš„ç‰¹ç‚¹æ˜¯å¤„ç†å¯†é›†å‹æ•°æ®å’Œå¹¶è¡Œæ•°æ®è®¡ç®—ï¼Œå› æ­¤CUDAéå¸¸é€‚åˆéœ€è¦å¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—çš„é¢†åŸŸã€‚CUDAé™¤äº†å¯ä»¥ç”¨Cã€C++ã€JAVAã€Pythonè¯­è¨€å¼€å‘ã€‚å¹¿æ³›çš„åº”ç”¨åœ¨å›¾å½¢åŠ¨ç”»ã€ç§‘å­¦è®¡ç®—ã€åœ°è´¨ã€ç”Ÿç‰©ã€ç‰©ç†æ¨¡æ‹Ÿç­‰é¢†åŸŸã€‚</p>
<p>â€‹    è®¡ç®—æ­£åœ¨ä»CPUâ€ä¸­å¤®å¤„ç†â€å‘CPUä¸GPUâ€ååŒå¤„ç†â€çš„æ–¹å‘å‘å±•ã€‚å¯¹åº”ç”¨ç¨‹åºå¼€å‘å•†æ¥è¯´ï¼Œè‹±ä¼Ÿè¾¾â„¢ CUDAâ„¢ æ¶æ„æ‹¥æœ‰åºå¤§çš„ç”¨æˆ·ç¾¤ã€‚</p>
<h4 id="6-6-2-2ã€OPENCL"><a href="#6-6-2-2ã€OPENCL" class="headerlink" title="6.6.2.2ã€OPENCL"></a>6.6.2.2ã€OPENCL</h4><p>â€‹    OpenCLï¼ˆOpen Computing Languageï¼Œå¼€æ”¾è¿ç®—è¯­è¨€ï¼‰æ˜¯ç¬¬ä¸€ä¸ªé¢å‘å¼‚æ„ç³»ç»Ÿå¹¶è¡Œç¼–ç¨‹çš„å¼€æ”¾å¼ã€å…è´¹æ ‡å‡†ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç»Ÿä¸€çš„ç¼–ç¨‹ç¯å¢ƒã€‚</p>
<p>â€‹    ä¾¿äºè½¯ä»¶å¼€å‘äººå‘˜ä¸ºé«˜æ€§èƒ½è®¡ç®—æœåŠ¡å™¨ã€æ¡Œé¢è®¡ç®—ç³»ç»Ÿã€æ‰‹æŒè®¾å¤‡ç¼–å†™é«˜æ•ˆè½»ä¾¿çš„ä»£ç ï¼Œè€Œä¸”å¹¿æ³›é€‚ç”¨äºå¤šæ ¸å¿ƒå¤„ç†å™¨(CPU)ã€å›¾å½¢å¤„ç†å™¨(GPU)ã€Cellç±»å‹æ¶æ„ä»¥åŠæ•°å­—ä¿¡å·å¤„ç†å™¨(DSP)ç­‰å…¶å®ƒå¹¶è¡Œå¤„ç†å™¨ï¼Œåœ¨æ¸¸æˆã€å¨±ä¹ã€ç§‘ç ”ã€åŒ»ç–—ç­‰å„ç§é¢†åŸŸéƒ½æœ‰å¹¿é˜”çš„å‘å±•å‰æ™¯ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148356.png" alt="img"></p>
<p>â€‹    OpenCLå¹³å°å¯ç”±CPUï¼ŒGPUæˆ–å…¶å®ƒç±»å‹çš„å¤„ç†å™¨ç»„æˆã€‚OpenCLç”¨äºç¼–å†™kernels ï¼ˆåœ¨OpenCLè®¾å¤‡ä¸Šè¿è¡Œçš„å‡½æ•°ï¼‰çš„è¯­è¨€ï¼ˆåŸºäºC99ï¼‰å’Œä¸€ç»„ç”¨äºå®šä¹‰å¹¶æ§åˆ¶å¹³å°çš„APIç»„æˆã€‚OpenCLæä¾›äº†åŸºäºä»»åŠ¡åˆ†å‰²å’Œæ•°æ®åˆ†å‰²çš„å¹¶è¡Œè®¡ç®—æœºåˆ¶ã€‚</p>
<p>â€‹    OpenCLç±»ä¼¼äºå¦å¤–ä¸¤ä¸ªå¼€æ”¾çš„å·¥ä¸šæ ‡å‡†OpenGLå’ŒOpenALï¼Œè¿™ä¸¤ä¸ªæ ‡å‡†åˆ†åˆ«ç”¨äºä¸‰ç»´å›¾å½¢å’Œè®¡ç®—æœºéŸ³é¢‘æ–¹é¢ã€‚OpenCLæ‰©å±•äº†GPUç”¨äºå›¾å½¢ç”Ÿæˆä¹‹å¤–çš„èƒ½åŠ›ã€‚OpenCLç”±éç›ˆåˆ©æ€§æŠ€æœ¯ç»„ç»‡Khronos  GroupæŒç®¡ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148590.png" alt="img"></p>
<h5 id="6-6-2-2-1ã€å‘å±•"><a href="#6-6-2-2-1ã€å‘å±•" class="headerlink" title="6.6.2.2.1ã€å‘å±•"></a>6.6.2.2.1ã€å‘å±•</h5><p>â€‹    OpenCLæœ€åˆè‹¹æœå…¬å¸å¼€å‘ï¼Œæ‹¥æœ‰å…¶å•†æ ‡æƒï¼Œå¹¶åœ¨ä¸AMDï¼ŒIBMï¼Œè‹±ç‰¹å°”å’ŒNVIDIAæŠ€æœ¯å›¢é˜Ÿçš„åˆä½œä¹‹ä¸‹åˆæ­¥å®Œå–„ã€‚éšåï¼Œè‹¹æœå°†è¿™ä¸€è‰æ¡ˆæäº¤è‡³Khronos  Groupã€‚</p>
<p>â€‹    2008å¹´6æœˆçš„WWDCå¤§ä¼šä¸Šï¼Œè‹¹æœæå‡ºäº†OpenCLè§„èŒƒï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªé€šç”¨çš„å¼€æ”¾APIï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¼€å‘GPUé€šç”¨è®¡ç®—è½¯ä»¶ã€‚éšåï¼ŒKhronos  Groupå®£å¸ƒæˆç«‹GPUé€šç”¨è®¡ç®—å¼€æ”¾è¡Œä¸šæ ‡å‡†å·¥ä½œç»„ï¼Œä»¥è‹¹æœçš„ææ¡ˆä¸ºåŸºç¡€åˆ›ç«‹OpenCLè¡Œä¸šè§„èŒƒã€‚5ä¸ªæœˆåçš„2008å¹´11æœˆ18æ—¥ï¼Œè¯¥å·¥ä½œç»„å®Œæˆäº†OpenCL 1ã€‚0è§„èŒƒçš„æŠ€æœ¯ç»†èŠ‚ã€‚2010å¹´6æœˆ14æ—¥ï¼ŒOpenCL 1ã€‚1 å‘å¸ƒã€‚2011å¹´11æœˆ15æ—¥ï¼ŒOpenCL 1ã€‚2 å‘å¸ƒã€‚2013å¹´11æœˆ19æ—¥ï¼ŒOpenCL 2ã€‚0å‘å¸ƒã€‚ç›®å‰ï¼ŒOpenCLæœ€æ–°ç‰ˆæœ¬æ˜¯3ã€‚0ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148672.png" alt="img"></p>
<p>â€‹    2009å¹´6æœˆNVIDIAé¦–å®¶å‘å¸ƒäº†æ”¯æŒOpenCL 1ã€‚0é€šç”¨è®¡ç®—è§„èŒƒçš„é©±åŠ¨ç¨‹åºï¼Œæ”¯æŒWindowså’ŒLinuxæ“ä½œç³»ç»Ÿã€‚</p>
<p>â€‹    2009å¹´8æœˆåˆAMDé¦–æ¬¡å‘å¸ƒäº†å¯æ”¯æŒIAå¤„ç†å™¨(x86å’Œamd64&#x2F;x64)çš„OpenCL SDKâ€”â€”ATI Stream SDK v2ã€‚0Betaï¼Œäº¤ç”±ä¸šç•Œæ ‡å‡†ç»„ç»‡Khronos è¿›è¡Œå®¡æ ¸ã€‚ç›®å‰ï¼Œè¯¥SDKæ›´åä¸ºAMD APP SDKã€‚</p>
<p>â€‹    2012å¹´2æœˆï¼Œintelå‘å¸ƒäº†The Intel&reg; SDK for OpenCL* Applications 2012ï¼Œæ”¯æŒOpenCL 1ã€‚1åŸºäºå¸¦HD4000&#x2F;2500çš„æ˜¾ç¤ºæ ¸å¿ƒçš„ç¬¬ä¸‰ä»£é…·ç¿CPUï¼ˆi3ï¼Œi5ï¼Œi7)å’ŒGPUã€‚</p>
<p>â€‹    2013å¹´6æœˆï¼Œintelå‘å¸ƒäº†ç¬¬å››ä»£é…·ç¿CPU haswell å…¶å†…ç½®çš„HD4600&#x2F;4400&#x2F;4200 Irisï¼ˆé”çŸ©ï¼‰5000&#x2F;5100&#x2F;pro 5200ï¼ˆè‡ªå¸¦eDRAMç¼“å­˜ï¼‰æ”¯æŒOpenCL 1ã€‚2ï¼ˆæœªæ¥å¯èƒ½å‡çº§åˆ°OpenCL 2ã€‚0ï¼‰</p>
<p>â€‹    NVIDIAæ˜¾å¡æ–¹é¢ Geforce 8000\9000\100ã€GTX200-1000ï¼ŒRTX2000å‡æ”¯æŒOpenCL 1ã€‚0-1ã€‚2</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148656.png" alt="img"></p>
<p>â€‹    AMDæ˜¾å¡æ–¹é¢ Radeon HD 4000-7000\Rx 200\Rx 300\RX 400-500&#x2F;Furyç³»åˆ—ï¼ŒVegaç³»åˆ— å‡æ”¯æŒOpenCL 1ã€‚0-1ã€‚2ï¼Œé™¤Radeon HD4000-6000ç³»åˆ—å¤–ï¼Œå…¶ä½™å‡ä¼šæ”¯æŒOpenCL 2ã€‚0</p>
<p>â€‹    ç§»åŠ¨å¹³å°æ–¹é¢ç›®å‰é«˜é€šadreno320&#x2F;330&#x2F;400ç³»åˆ—&#x2F;500ç³»åˆ—æä¾›äº†Androidä¸Šçš„OpenCL1ã€‚2æˆ–è€…2ã€‚0æ”¯æŒï¼ŒNVIDIAçš„Tegra K1ä¹Ÿæä¾›äº†OpenCL æ”¯æŒã€‚</p>
<h5 id="6-6-2-2-2ã€æ”¯æŒ"><a href="#6-6-2-2-2ã€æ”¯æŒ" class="headerlink" title="6.6.2.2.2ã€æ”¯æŒ"></a>6.6.2.2.2ã€æ”¯æŒ</h5><p>â€‹    OpenCLå·¥ä½œç»„çš„æˆå‘˜åŒ…æ‹¬ï¼š3Dlabsã€AMDã€è‹¹æœã€ARMã€Codeplayã€çˆ±ç«‹ä¿¡ã€é£æ€å¡å°”ã€åä¸ºã€HSAåŸºé‡‘ä¼šã€GraphicRemedyã€IBMã€Imagination Technologiesã€Intelã€è¯ºåŸºäºšã€NVIDIAã€æ‘©æ‰˜ç½—æ‹‰ã€QNXã€é«˜é€šï¼Œä¸‰æ˜Ÿã€Seaweedã€å¾·å·ä»ªå™¨ã€å¸ƒé‡Œæ–¯æ‰˜å°”å¤§å­¦ã€ç‘å…¸Umeå¤§å­¦ã€‚åƒIntelã€NVIDIAå’ŒAMDéƒ½æ˜¯è¿™ä¸ªæ ‡å‡†çš„æ”¯æŒè€…ï¼Œä¸è¿‡å¾®è½¯å¹¶ä¸åœ¨å…¶åˆ—ã€‚ç›®å‰ï¼ŒNVIDIAæ˜¾å¡å¯¹OpenCLæŠ€æœ¯æ”¯æŒè¾ƒå¥½ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148659.png" alt="img"></p>
<p>â€‹    åœ¨NVIDIAçš„Quadroã€Geforceç³»åˆ—ä¸“ä¸šæ˜¾å¡ä¸­ï¼Œèƒ½å¤Ÿä½¿ç”¨OpenCLæŠ€æœ¯ã€‚åªè¦æ˜¾å¡èƒ½å¤Ÿè¾¾åˆ°CUDAçš„è¦æ±‚ï¼Œå°±èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨OpenCLï¼Œä»¥è·å¾—ä¼˜å¼‚çš„CPUè¿ç®—æ•ˆç‡ã€‚</p>
<p>â€‹    åœ¨AMD-ATIçš„StreamæŠ€æœ¯ä¸­ï¼ˆç°å·²ç»æ”¹åä¸ºAMD APPå¹¶è¡ŒåŠ é€ŸæŠ€æœ¯ï¼‰ï¼Œå·²ç»ä¸ºæ—¥å¸¸ä½¿ç”¨ã€åŠå…¬ã€æ¸¸æˆç­‰æä¾›ç‰©ç†åŠ é€Ÿã€‚åŸºäºOpenCLæ ‡å‡†å¼€å‘ï¼Œå…¶ä¸­ï¼ŒATI Radeon HD 4000-5000ã€AMD Radeon HD 6000ç³»åˆ—åŒæ—¶æ”¯æŒATI Streamå’ŒAMD APPï¼ˆç”±äºStreamåŸºäºCALå’ŒBrook+è¯­è¨€å¼€å‘ï¼Œæ›´é€‚åˆVLIW5å’ŒVLIW4è¿™æ ·çš„SIMDæ¶æ„ï¼‰ï¼ŒAMD Radeon HD7000å’ŒRadeon Rx 200ç³»åˆ—æ”¯æŒAMD APPï¼Œè¿ç®—æ•ˆç‡è¾ƒè€æ¶æ„æå‡ååˆ†æ˜æ˜¾ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148635.png" alt="img"></p>
<h5 id="6-6-2-2-3ã€API"><a href="#6-6-2-2-3ã€API" class="headerlink" title="6.6.2.2.3ã€API"></a>6.6.2.2.3ã€API</h5><p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148721.png" alt="img"></p>
<p>â€‹    OpenCLå¹³å°APIï¼šå®šä¹‰äº†å®¿ä¸»æœºç¨‹åºå‘ç°OpenCLè®¾å¤‡æ‰€ç”¨çš„å‡½æ•°ä»¥åŠè¿™äº›å‡½æ•°çš„åŠŸèƒ½ï¼Œè¿˜å®šä¹‰äº†OpenCLåº”ç”¨åˆ›å»ºä¸Šä¸‹æ–‡çš„å‡½æ•°ã€‚</p>
<p>â€‹    OpenCLè¿è¡Œæ—¶APIï¼šç®¡ç†ä¸Šä¸‹æ–‡æ¥åˆ›å»ºå‘½ä»¤é˜Ÿåˆ—ä»¥åŠè¿è¡Œæ—¶å‘ç”Ÿçš„å…¶å®ƒæ“ä½œã€‚ä¾‹å¦‚ï¼Œå°†å‘½ä»¤æäº¤åˆ°å‘½ä»¤é˜Ÿåˆ—çš„å‡½æ•°å°±æ¥è‡ªOpenCLè¿è¡Œæ—¶APIã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148915.png" alt="img"></p>
<p>â€‹    OpenCLç¼–ç¨‹è¯­è¨€ï¼šç¼–å†™å†…æ ¸ä»£ç çš„ç¼–ç¨‹è¯­è¨€ã€‚åŸºäºISO C99æ ‡å‡†çš„ä¸€ä¸ªæ‰©å±•å­é›†ï¼Œé€šå¸¸ç§°ä¸ºOpenCL Cç¼–ç¨‹è¯­è¨€ã€‚</p>
<h5 id="6-6-2-2-4ã€æ€»ç»“"><a href="#6-6-2-2-4ã€æ€»ç»“" class="headerlink" title="6.6.2.2.4ã€æ€»ç»“"></a>6.6.2.2.4ã€æ€»ç»“</h5><p>â€‹    ç»¼åˆä¸Šè¿°å†…å®¹ï¼Œå½¢æˆOpenCLå…¨æ™¯å›¾(å¦‚ä¸‹)ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªå®šä¹‰ä¸Šä¸‹æ–‡çš„å®¿ä¸»æœºç¨‹åºã€‚ä¸Šå›¾ä¸­çš„ä¸Šä¸‹æ–‡åŒ…å«ä¸¤ä¸ªOpenCLè®¾å¤‡ã€ä¸€ä¸ªCPUå’Œä¸€ä¸ªGPUã€‚æ¥ä¸‹æ¥å®šä¹‰äº†å‘½ä»¤é˜Ÿåˆ—ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148901.png" alt="img"></p>
<p>â€‹    è¿™é‡Œæœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯é¢å‘GPUçš„æœ‰åºå‘½ä»¤é˜Ÿåˆ—ï¼Œå¦ä¸€ä¸ªæ˜¯é¢å‘CPUçš„ä¹±åºå‘½ä»¤é˜Ÿåˆ—ã€‚ç„¶åå®¿ä¸»æœºç¨‹åºå®šä¹‰ä¸€ä¸ªç¨‹åºå¯¹è±¡ï¼Œè¿™ä¸ªç¨‹åºå¯¹è±¡ç¼–è¯‘åå°†ä¸ºä¸¤ä¸ªOpenCLè®¾å¤‡ï¼ˆCPUå’ŒGPUï¼‰ç”Ÿæˆå†…æ ¸ã€‚</p>
<p>â€‹    æ¥ä¸‹æ¥å®¿ä¸»æœºç¨‹åºå®šä¹‰ç¨‹åºæ‰€éœ€çš„å†…å­˜å¯¹è±¡ï¼Œå¹¶æŠŠå®ƒä»¬æ˜ å°„åˆ°å†…æ ¸çš„å‚æ•°ã€‚æœ€åï¼Œå®¿ä¸»æœºç¨‹åºå°†å‘½ä»¤æ”¾å…¥å‘½ä»¤é˜Ÿåˆ—æ¥æ‰§è¡Œè¿™äº›å†…æ ¸ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148953.png" alt="img"></p>
<h3 id="6-6-4ã€å…¶å®ƒç›¸å…³åº“"><a href="#6-6-4ã€å…¶å®ƒç›¸å…³åº“" class="headerlink" title="6.6.4ã€å…¶å®ƒç›¸å…³åº“"></a>6.6.4ã€å…¶å®ƒç›¸å…³åº“</h3><p>â€‹    æ™ºèƒ½æ—¶ä»£æ˜¯ç™¾èŠ±é½æ”¾çš„æ—¶ä»£ï¼ŒèŠ¯ç‰‡æŠ€æœ¯é©±åŠ¨ç¡¬ä»¶æŠ€æœ¯ï¼ŒèŠ¯ç‰‡æŒ‡ä»¤æä¾›æ“ä½œæ¥å£ï¼Œæ“ä½œæ¥å£é©±åŠ¨è¿ç®—å¹³å°ï¼Œè¿ç®—å¹³å°é©±åŠ¨æœºå™¨å­¦ä¹ åº“ã€‚æœ¬ä¸»é¢˜ä»‹ç»éƒ¨åˆ†æœºå™¨è§†è§‰å’Œå¹¶è¡Œè®¡ç®—åº“ã€‚</p>
<h4 id="6-6-4-1ã€OpenCV"><a href="#6-6-4-1ã€OpenCV" class="headerlink" title="6.6.4.1ã€OpenCV"></a>6.6.4.1ã€OpenCV</h4><p>â€‹    OpenCVæ˜¯åŸºäºBSDè®¸å¯ï¼ˆå¼€æºï¼‰å‘è¡Œçš„è·¨å¹³å°è®¡ç®—æœºè§†è§‰å’Œæœºå™¨å­¦ä¹ è½¯ä»¶åº“ï¼Œè¿è¡Œåœ¨Linuxã€Windowsã€Androidå’ŒMac OSæ“ä½œç³»ç»Ÿä¸Šã€‚ è½»é‡é«˜æ•ˆï¼Œç”±ä¸€ç³»åˆ— C å‡½æ•°å’Œå°‘é‡ C++ ç±»æ„æˆï¼Œæä¾›äº†Pythonã€Rubyã€MATLABç­‰ç¼–ç¨‹æ¥å£ï¼Œå®ç°äº†å›¾åƒå¤„ç†å’Œè®¡ç®—æœºè§†è§‰æ–¹é¢çš„é€šç”¨ç®—æ³•ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148536.png" alt="img"></p>
<h4 id="6-6-4-1ã€ç®€ä»‹"><a href="#6-6-4-1ã€ç®€ä»‹" class="headerlink" title="6.6.4.1ã€ç®€ä»‹"></a>6.6.4.1ã€ç®€ä»‹</h4><p>â€‹    OpenCVç”¨C++è¯­è¨€ç¼–å†™ï¼Œåˆ©ç”¨MMXå’ŒSSEæŒ‡ä»¤ï¼ŒOpenCV ä¸ºIntelÂ® Integrated Performance Primitivesï¼ˆIPPï¼‰æä¾›äº†é€æ˜æ¥å£ã€‚æ„å‘³ç€å¦‚æœæœ‰ç‰¹å®šå¤„ç†å™¨ä¼˜åŒ–çš„ IPP åº“ï¼ŒOpenCV åœ¨è¿è¡Œæ—¶è‡ªåŠ¨åŠ è½½è¿™äº›åº“ã€‚ </p>
<p>â€‹    OpenCV æ‹¥æœ‰ 500 å¤šä¸ªCå‡½æ•°çš„è·¨å¹³å°çš„ä¸­ã€é«˜å±‚ APIã€‚ä¸ä¾èµ–äºå…¶å®ƒçš„å¤–éƒ¨åº“ã€‚OpenCV ä½¿ç”¨ç±»BSDlicenseï¼Œå¯¹éå•†ä¸šåº”ç”¨å’Œå•†ä¸šåº”ç”¨å…è´¹ï¼ˆFREEï¼‰ã€‚</p>
<p>â€‹    OpenCVçš„è§†è§‰å¤„ç†ç®—æ³•ä¸°å¯Œï¼Œéƒ¨åˆ†ç”¨Cè¯­è¨€ç¼–å†™ï¼Œå¼€æºçš„ç‰¹æ€§ï¼Œå¤„ç†å¾—å½“ï¼Œä¸éœ€è¦å¤–éƒ¨æ”¯æŒå¯ä»¥å®Œæ•´ç¼–è¯‘é“¾æ¥ç”Ÿæˆæ‰§è¡Œç¨‹åºï¼Œæ–¹ä¾¿ç®—æ³•çš„ç§»æ¤ï¼ŒOpenCVçš„ä»£ç ç»è¿‡é€‚å½“æ”¹å†™å¯ä»¥æ­£å¸¸çš„è¿è¡Œåœ¨DSPç³»ç»Ÿå’ŒARMåµŒå…¥å¼ç³»ç»Ÿä¸­ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148544.jpeg" alt="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=974700158,1979112963&amp;fm=26&amp;gp=0.jpg"></p>
<h4 id="6-6-4-2ã€åº”ç”¨"><a href="#6-6-4-2ã€åº”ç”¨" class="headerlink" title="6.6.4.2ã€åº”ç”¨"></a>6.6.4.2ã€åº”ç”¨</h4><p>â€‹    OpenCVè‡´åŠ›äºçœŸå®ä¸–ç•Œçš„å®æ—¶åº”ç”¨ï¼Œé€šè¿‡ä¼˜åŒ–Cä»£ç çš„ç¼–å†™å¯¹å…¶æ‰§è¡Œé€Ÿåº¦å¸¦æ¥äº†å¯è§‚çš„æå‡ï¼Œé€šè¿‡è´­ä¹°Intelçš„IPPé«˜æ€§èƒ½å¤šåª’ä½“å‡½æ•°åº“ï¼ˆIntegrated Performance Primitivesï¼‰å¾—åˆ°æ›´å¿«çš„å¤„ç†é€Ÿåº¦ã€‚</p>
<p>â€‹    åº”ç”¨é¢†åŸŸï¼šäººæœºäº’åŠ¨ã€ç‰©ä½“è¯†åˆ«ã€å›¾åƒåˆ†å‰²ã€äººè„¸è¯†åˆ«ã€åŠ¨ä½œè¯†åˆ«ã€è¿åŠ¨è·Ÿè¸ªã€æœºå™¨äººã€è¿åŠ¨åˆ†æã€æœºå™¨è§†è§‰ã€ç»“æ„åˆ†æã€æ±½è½¦å®‰å…¨é©¾é©¶</p>
<h4 id="6-6-4-3ã€æ¥å£"><a href="#6-6-4-3ã€æ¥å£" class="headerlink" title="6.6.4.3ã€æ¥å£"></a>6.6.4.3ã€æ¥å£</h4><p>â€‹    OpenCVå…¶å®ƒæ¥å£æ˜¯ç”¨C++æ¥å£æ”¹ç¼–çš„ï¼Œä¸»è¦æ¥å£è¯­è¨€ä¹Ÿæ˜¯C++è¯­è¨€ï¼Œä¾ç„¶ä¿ç•™äº†å¤§é‡çš„Cè¯­è¨€æ¥å£ã€‚è¯¥åº“ä¹Ÿæœ‰å¤§é‡çš„Pythonã€Java and MATLAB&#x2F;OCTAVEã€GOã€C#ã€Chã€Rubyç­‰çš„æ¥å£ã€‚APIæ¥å£å‡½æ•°é€šè¿‡åœ¨çº¿æ–‡æ¡£è·å¾—ã€‚ä¸€ä¸ªä½¿ç”¨CUDAçš„GPUæ¥å£ä¹Ÿäº2010å¹´9æœˆå¼€å§‹å®ç°ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148521.jpeg" alt="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=1001109053,1480904686&amp;fm=26&amp;gp=0.jpg"></p>
<p>â€‹    OpenCVå¯ä»¥åœ¨Windowsï¼ŒAndroidï¼ŒMaemoï¼ŒFreeBSDï¼ŒOpenBSDï¼ŒiOSï¼ŒLinux å’ŒMac OSç­‰å¹³å°ä¸Šè¿è¡Œã€‚å¯ä»¥åœ¨ SourceForge è·å¾—å®˜æ–¹ç‰ˆæœ¬ï¼Œæˆ–è€…ä» SVN è·å¾—å¼€å‘ç‰ˆæœ¬ã€‚</p>
<h4 id="6-6-4-2ã€OpenMP"><a href="#6-6-4-2ã€OpenMP" class="headerlink" title="6.6.4.2ã€OpenMP"></a>6.6.4.2ã€OpenMP</h4><p>â€‹    OpenMPæ˜¯OpenMP Architecture Review Boardç‰µå¤´æå‡ºçš„ï¼Œå·²è¢«å¹¿æ³›æ¥å—ï¼Œç”¨äºå…±äº«å†…å­˜å¹¶è¡Œç³»ç»Ÿçš„å¤šå¤„ç†å™¨ç¨‹åºè®¾è®¡ï¼Œå¹¶æä¾›ä¸€å¥—æŒ‡å¯¼æ€§ç¼–è¯‘å¤„ç†æ–¹æ¡ˆ(Compiler Directive) ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148438.png" alt="img"></p>
<p>â€‹    OpenMPæ”¯æŒçš„ç¼–ç¨‹è¯­è¨€åŒ…æ‹¬Cã€C++å’ŒFortranï¼›æ”¯æŒOpenMpçš„ç¼–è¯‘å™¨åŒ…æ‹¬Sun Compilerï¼ŒGNU Compilerå’ŒIntel Compilerç­‰ã€‚</p>
<h5 id="6-6-4-2-1ã€ç®€ä»‹"><a href="#6-6-4-2-1ã€ç®€ä»‹" class="headerlink" title="6.6.4.2.1ã€ç®€ä»‹"></a>6.6.4.2.1ã€ç®€ä»‹</h5><p>â€‹    OpenMpæä¾›äº†å¯¹å¹¶è¡Œç®—æ³•çš„ä¸“ç”¨æè¿°ï¼Œæºä»£ç ä¸­åŠ å…¥ä¸“ç”¨çš„pragmaæŒ‡ä»¤æ¥æŒ‡æ˜è‡ªå·±çš„æ„å›¾ï¼Œç”±æ­¤ç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨å°†ç¨‹åºè¿›è¡Œå¹¶è¡ŒåŒ–ï¼Œåœ¨å¿…è¦ä¹‹å¤„åŠ å…¥åŒæ­¥äº’æ–¥ä»¥åŠé€šä¿¡ã€‚åœ¨è¿›è¡Œè½¯ä»¶å¼€å‘æ—¶é—´ï¼Œä¸²è¡ŒåŒ–åˆ°å¹¶è¡ŒåŒ–æ˜¯ä¸€ä¸ªæé«˜æ•ˆç‡æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚</p>
<p>å¿½ç•¥è¿™äº›pragmaï¼Œæˆ–è€…ç¼–è¯‘å™¨ä¸æ”¯æŒOpenMpæ—¶ï¼Œç¨‹åºåˆå¯é€€åŒ–ä¸ºä¸²è¡Œç¨‹åºï¼Œä»£ç ä»ç„¶å¯ä»¥æ­£å¸¸è¿ä½œï¼Œè¿™æ˜¯è€ƒè™‘CPUç¡¬ä»¶ä¸åŒè€Œè®¾å®šçš„æ–¹æ¡ˆï¼Œåªæ˜¯ä¸èƒ½åˆ©ç”¨å¤šçº¿ç¨‹æ¥åŠ é€Ÿç¨‹åºæ‰§è¡Œã€‚æ ¹æ®ç¡¬ä»¶æ”¯æŒï¼Œè¿›è¡Œå•çº¿ç¨‹å’Œå¤šçº¿ç¨‹çš„å¤„ç†ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148450.png" alt="img"></p>
<p>â€‹    OpenMPå¯¹äºå¹¶è¡Œæè¿°çš„é«˜å±‚æŠ½è±¡é™ä½äº†å¹¶è¡Œç¼–ç¨‹çš„éš¾åº¦å’Œå¤æ‚åº¦ï¼Œç¨‹åºå‘˜å¯ä»¥æŠŠæ›´å¤šçš„ç²¾åŠ›æŠ•å…¥åˆ°å¹¶è¡Œç®—æ³•æœ¬èº«ï¼Œè€Œéå…¶å…·ä½“å®ç°ç»†èŠ‚ï¼Œè¿™æ ·è®©ç¨‹åºå‘˜é›†ä¸­ç²¾åŠ›åšæŸäº›äº‹æƒ…ã€‚å¯¹åŸºäºæ•°æ®åˆ†é›†çš„å¤šçº¿ç¨‹ç¨‹åºè®¾è®¡ï¼ŒOpenMPæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå°¤å…¶å¯¹è®¡ç®—è¦æ±‚ä¸¥æ ¼çš„åœ°æ–¹ã€‚</p>
<p>â€‹    OpenMPæä¾›äº†æ›´å¼ºçš„çµæ´»æ€§ï¼Œå¯ä»¥é€‚åº”ä¸åŒçš„å¹¶è¡Œç³»ç»Ÿé…ç½®ã€‚çº¿ç¨‹ç²’åº¦å’Œè´Ÿè½½å¹³è¡¡ç­‰æ˜¯ä¼ ç»Ÿå¤šçº¿ç¨‹ç¨‹åºè®¾è®¡ä¸­çš„éš¾é¢˜ï¼Œè¿™äº›é—®é¢˜ä»å‰ä¸»è¦é ä¸­é—´ä»¶æ¥è¿›è¡Œå®ç°ï¼Œæˆ–è€…ä»ç¨‹åºçš„æ¡†æ¶è§’åº¦æ¥è¿›è¡Œè€ƒè™‘ã€‚ç°åœ¨ï¼ŒæŠŠè¿™äº›å’Œå…´çš„å¤„ç†äº¤ç»™ç¨‹åºå‘˜ç›´æ¥æ¥è§¦çš„æ¡†æ¶ï¼Œä»è€Œæé«˜äº†æ•ˆç‡ã€‚OpenMPä¸­ï¼ŒOpenMPåº“ä»ç¨‹åºå‘˜æ‰‹ä¸­æ¥ç®¡äº†éƒ¨åˆ†è¿™ä¸¤æ–¹é¢çš„å·¥ä½œã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148432.png" alt="https://pic.ikafan.com/imgp/L3Byb3h5L2h0dHAvaW1hZ2VzMC5jbmJsb2dzLmNvbS9ibG9nMjAxNS81MjI0OTAvMjAxNTA2LzI3MjExMzUwNTY0ODI3NC5wbmc=.jpg"></p>
<p>â€‹    ä½œä¸ºé«˜å±‚æŠ½è±¡ï¼ŒOpenMPä¸é€‚åˆå¤æ‚çš„çº¿ç¨‹é—´åŒæ­¥å’Œäº’æ–¥çš„åœºåˆï¼Œè¿™æ˜¯ç”±äºOpenMpæœ¬èº«çš„ç»“æ„å†³å®šçš„ã€‚OpenMpä¸èƒ½åœ¨éå…±äº«å†…å­˜ç³»ç»Ÿï¼Œä¾‹å¦‚è®¡ç®—æœºé›†ç¾¤ä½¿ç”¨ï¼Œå¦‚æœä½¿ç”¨ï¼Œå¤„ç†æ•ˆæœå¾ˆä¸ç†æƒ³ã€‚å…±äº«å†…å®¹çš„ç³»ç»Ÿä¸Šï¼ŒMPIä½¿ç”¨è¾ƒå¤šã€‚åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒæŠ€æœ¯é€‰å‹éå¸¸é‡è¦ã€‚</p>
<p>â€‹    OpenMPæ˜¯ä½œä¸ºå…±äº«å­˜å‚¨æ ‡å‡†è€Œé—®ä¸–çš„ã€‚å®ƒæ˜¯ä¸ºåœ¨å¤šå¤„ç†æœºä¸Šç¼–å†™å¹¶è¡Œç¨‹åºè€Œè®¾è®¡çš„ä¸€ä¸ªåº”ç”¨ç¼–ç¨‹æ¥å£ã€‚å®ƒåŒ…æ‹¬ä¸€å¥—ç¼–è¯‘æŒ‡å¯¼è¯­å¥å’Œä¸€ä¸ªç”¨æ¥æ”¯æŒå®ƒçš„å‡½æ•°åº“ã€‚å½“ä»ŠåŒæ ¸ã€å››æ ¸çš„ CPU å½“é“ï¼Œè€Œå…­æ ¸çš„CPUä¹Ÿå·²ç»é¢ä¸–å¤šæ—¶ï¼Œæ‰€ä»¥åœ¨å¤šå¤„ç†æœºä¸Šç¼–å†™ã€è¿è¡Œå¹¶è¡Œç¨‹åºä¼šå˜å¾—ç›¸å½“æ™®éã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148459.png" alt="https://pic.ikafan.com/imgp/L3Byb3h5L2h0dHAvaW1hZ2VzMC5jbmJsb2dzLmNvbS9ibG9nMjAxNS81MjI0OTAvMjAxNTA2LzI3MjExNDQzNTgwNzM3OC5wbmc=.jpg"></p>
<h5 id="6-6-4-2-2ã€å•çº¿ç¨‹ä¸å¤šçº¿ç¨‹"><a href="#6-6-4-2-2ã€å•çº¿ç¨‹ä¸å¤šçº¿ç¨‹" class="headerlink" title="6.6.4.2.2ã€å•çº¿ç¨‹ä¸å¤šçº¿ç¨‹"></a>6.6.4.2.2ã€å•çº¿ç¨‹ä¸å¤šçº¿ç¨‹</h5><p>â€‹    ä¸€èˆ¬å•çº¿ç¨‹ï¼ˆsingle threadï¼‰ç¨‹åºï¼Œå¤šæ ¸å¿ƒå¤„ç†å™¨æ²¡æœ‰åŠæ³•æå‡å¤„ç†æ•ˆèƒ½ï¼›å¯¹äºå¤šçº¿ç¨‹ï¼ˆmulti threadï¼‰çš„ç¨‹åºï¼Œå°±å¯ä»¥é€šè¿‡ä¸åŒçš„æ ¸å¿ƒåŒæ—¶è®¡ç®—ï¼Œæ¥è¾¾åˆ°åŠ é€Ÿçš„ç›®çš„ã€‚ç¨‹åºå‘˜åœ¨è¿›è¡Œå¼€å‘æ—¶é—´ï¼Œå¯¹æ•ˆç‡è¦æœ‰ä¸€å®šçš„è®¤çŸ¥ï¼Œå¦‚æœæ•ˆç‡è¾ƒé«˜çš„ç¨‹åºï¼Œå»ºè®®è¿›è¡Œå¹¶è¡Œç¨‹åºæ¶‰åŠã€‚</p>
<p>â€‹    ä¸‹é¢æˆ‘ä»¬ä¸¾ä¾‹ï¼Œå•çº¿ç¨‹ç¨‹åºï¼Œä¸€ä»¶äº‹ä¸€æ¬¡è¦åç§’çš„è¯ï¼Œè¦åšåæ¬¡ï¼Œä¸€é¢—æ ¸å¿ƒï¼Œå°±æ˜¯ 10 ç§’ çš„ 10 å€ï¼Œè¿™å°±æ˜¯ 100 ç§’ï¼›å¦‚æœæŒ‰ç…§å¤šçº¿ç¨‹çš„ç¨‹åºè¿è¡Œï¼Œå¯ä»¥æŠŠä¸€ä»¶äº‹ï¼Œç»™ä¸¤é¢—æ ¸å¿ƒå„è‡ªå®Œæˆï¼Œæ¯æ ¸å¿ƒå„åš 5 æ¬¡ï¼Œæ—¶é—´å°±ç¼©çŸ­ä¸º 50 ç§’ï¼Œè¿™æ ·é€Ÿåº¦æé«˜äº†1å€ã€‚</p>
<p>â€‹    å¤šçº¿ç¨‹çš„ç¨‹åºå®é™…ä¸Šä¹Ÿä¸ç®€å•ï¼Œæˆ‘ä»¬ä¸Šé¢çš„è®¡ç®—æ˜¯æœºæ¢°çš„ã€‚åœ¨å·¥ä½œçš„åˆ‡å‰²ã€ç»“åˆä¸Šï¼Œä¹Ÿæ˜¯è¦å¤šèŠ±æ—¶é—´çš„ã€‚</p>
<p>â€‹    ç°å®ä¸­ï¼Œåœ¨æœ€ä½³çŠ¶å†µï¼ŒåŒæ ¸å¿ƒçš„æ•ˆèƒ½ä¹Ÿä¸ä¼šæ˜¯ 1 + 1 &#x3D; 2 è¿™æ ·çš„ç†æƒ³åŒ–æƒ…å†µï¼Œè¿™ä¸ªä»…ä»…æ˜¯æˆ‘ä»¬ä¸è€ƒè™‘å…¶å®ƒæƒ…å†µæ—¶é—´çš„ç»“æœã€‚</p>
<p>â€‹    å¹¶ä¸æ˜¯æ‰€æœ‰ä»»åŠ¡éƒ½å¯ä»¥åˆ‡å‰²ï¼å¾ˆå¤šä»»åŠ¡å…³é”®åœ¨ä¸€èµ·ï¼Œç›´æ¥åˆ‡å‰²ç»™ä¸åŒçš„å¤„ç†æ ¸å¿ƒå„è‡ªå¹¶è¡Œè¿ç®—ï¼Œå‡ºæ¥çš„ç»“æœä¼šæœ‰é—®é¢˜ï¼Œè¿™æ˜¯å®‰å…¨æ‰€ä¸èƒ½å®¹å¿çš„ã€‚å¤šçº¿ç¨‹çš„ç¨‹åºåœ¨ç¼–å†™ã€ç»´æŠ¤ä¸Šï¼Œæ¯”å•çº¿ç¨‹çš„ç¨‹åºå¤æ‚äº†å¾ˆå¤šã€‚å¯¹äºæ•ˆç‡è¦æ±‚ä¸é«˜ï¼Œè¦æ±‚å¥å£®æ€§èƒ½çš„ç¨‹åºï¼Œå•çº¿ç¨‹ç¨³å®šè¿˜æ˜¯å¥½çš„ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148467.png" alt="https://pic.ikafan.com/imgp/L3Byb3h5L2h0dHAvaW1hZ2VzMC5jbmJsb2dzLmNvbS9ibG9nMjAxNS81MjI0OTAvMjAxNTA2LzI3MjExNjA0NDA4MzcxOC5wbmc=.jpg"></p>
<p>â€‹    ç”µè„‘æ˜¯å¤šå¤„ç†å™¨ã€å¤šæ ¸å¤„ç†å™¨ï¼Œæˆ–å…·å¤‡IntelHyper-ThreadingTechnology æŠ€æœ¯ï¼Œä»£è¡¨åŒä¸€ä¸ªæ—¶é—´å¤„ç†å¤šä¸ªçº¿ç¨‹çš„åŠŸèƒ½ï¼ŒæŠŠå„è‡ªç‹¬ç«‹çš„å·¥ä½œç”±å•çº¿ç¨‹æ”¹æˆå¤šçº¿ç¨‹ï¼Œæ‰§è¡Œçš„æ•ˆç‡ä¸Šï¼Œä¸€èˆ¬æ˜¯æœ‰æå‡çš„ã€‚</p>
<p>â€‹    å¾®è½¯VSï¼Œæä¾›çº¿ç¨‹æ§åˆ¶åŠŸèƒ½ã€‚è¿™ç§æ–¹æ³•ï¼Œäº§ç”Ÿå¤šä¸ª threadï¼Œç­–ç•¥å¦‚ä¸‹ï¼šä¸»çº¿ç¨‹æŠŠå·¥ä½œåˆ†é…ï¼Œå­çº¿ç¨‹å»ç„¶åè¿ç®—ï¼Œæœ€åä¸»çº¿ç¨‹å¯¹ç»“æœè¿›è¡Œæ•´ç†ã€‚</p>
<p>â€‹    OpenMP é€šè¿‡é«˜é˜¶æŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤å¾€å¾€æ˜¯å¯¹CPUæŒ‡ä»¤è¿›è¡Œè°ƒç”¨ï¼Œæ¼”åŒ–ä¸ºä¸€ç³»åˆ—æ“ä½œï¼Œè¿™ä¸­æ“ä½œåœ¨ä»å‰æ˜¯ä¸å¯æƒ³è±¡çš„ã€‚å°†ç¨‹åºå¹¶è¡ŒåŒ–ã€å¤šçº¿ç¨‹åŒ–çš„ APIï¼Œè¿™ç‚¹å…å»äº†è½¯ä»¶å·¥ç¨‹å¸ˆçš„å¤§éƒ¨åˆ†å·¥ä½œè´Ÿæ‹…ï¼›å¹¶è¡ŒåŒ–å¤„ç†æ˜¯OpenMpçš„æ ¸å¿ƒæ€æƒ³ï¼Œæœ€ç®€å•æƒ…å½¢ï¼ŒåªåŠ ä¸€è¡ŒæŒ‡ä»¤ï¼Œå°†å¾ªç¯å†…çš„ç¨‹åºå¹¶è¡ŒåŒ–å¤„ç†ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148444.png" alt="https://pic.ikafan.com/imgp/L3Byb3h5L2h0dHAvaW1hZ2VzMC5jbmJsb2dzLmNvbS9ibG9nMjAxNS81MjI0OTAvMjAxNTA2LzI3MTczNjQ2ODMwNTMzMy5wbmc=.jpg"></p>
<h5 id="6-6-4-2-3ã€OpenMPä¸MPI"><a href="#6-6-4-2-3ã€OpenMPä¸MPI" class="headerlink" title="6.6.4.2.3ã€OpenMPä¸MPI"></a>6.6.4.2.3ã€OpenMPä¸MPI</h5><p>â€‹    OpenMP æ˜¯é’ˆå¯¹å…±äº«å†…å­˜å¹¶è¡Œç¼–ç¨‹çš„ APIã€‚ä¸ä¹‹å‰çš„ MPI ä¸åŒçš„æ˜¯ï¼ŒOpenMPæ˜¯çº¿ç¨‹çº§å¹¶è¡Œï¼Œæ¯” MPI çš„è¿›ç¨‹çº§å¹¶è¡Œè¦æ›´è½»é‡åŒ–ä¸€äº›ã€‚è½»é‡çº§ä»£è¡¨æ›´å°‘çš„æ”¹åŠ¨ï¼Œå…±äº«å†…å®¹æ˜¯è§£å†³å…±äº«çš„é‡è¦æ‰‹æ®µä¹‹ä¸€ã€‚</p>
<p>â€‹    MPI çš„å¹¶è¡Œéœ€è¦å®Œå…¨é‡å†™æ•´ä¸ªç¨‹åºï¼Œè¿™ç‚¹ç›¸å¯¹éº»çƒ¦å¾ˆå¤šï¼Œæ˜¯å¾ˆå¤šç¨‹åºå‘˜æ’æ–¥çš„ã€‚å°†ä¸€ä¸ªä¸²è¡Œç¨‹åºæ”¹é€ æˆ OpenMP çš„å¹¶è¡Œè¿›è¡Œçš„æ”¹åŠ¨è¿‘ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148684.png" alt="img"></p>
<h5 id="6-6-4-2-4ã€åº”ç”¨"><a href="#6-6-4-2-4ã€åº”ç”¨" class="headerlink" title="6.6.4.2.4ã€åº”ç”¨"></a>6.6.4.2.4ã€åº”ç”¨</h5><p>â€‹    åˆ†ä¸ºWindowsç¯å¢ƒå’ŒLinuxç¯å¢ƒã€‚</p>
<h6 id="6-6-4-2-4-1ã€Windowsç¯å¢ƒä¸‹å¼€å‘"><a href="#6-6-4-2-4-1ã€Windowsç¯å¢ƒä¸‹å¼€å‘" class="headerlink" title="6.6.4.2.4.1ã€Windowsç¯å¢ƒä¸‹å¼€å‘"></a><strong>6.6.4.2.4.1ã€Windowsç¯å¢ƒä¸‹å¼€å‘</strong></h6><p>â€‹    åœ¨VC++ä¸­ä½¿ç”¨OpenMPï¼Œå°† Project çš„Propertiesä¸­C&#x2F;C++é‡ŒLanguageçš„OpenMP Supportå¼€å¯ï¼ˆå‚æ•°ä¸º &#x2F;openmpï¼‰ï¼Œå°±å¯ä»¥è®©VC++ç¼–è¯‘æ—¶æ”¯æŒOpenMP çš„è¯­æ³•ï¼›</p>
<p>â€‹    ç¼–å†™ä½¿ç”¨OpenMP çš„ç¨‹åºæ—¶ï¼Œåˆ™éœ€è¦å…ˆinclude OpenMPçš„å¤´æ–‡ä»¶ï¼šomp.hã€‚</p>
<p>â€‹    for å¾ªç¯å¹¶è¡ŒåŒ–å¤„ç†ï¼Œè¦åœ¨å‰é¢åŠ ä¸Šä¸€è¡Œ</p>
<p>â€‹    #pragma omp parallel for</p>
<p>â€‹    å®ä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;STDIO.H&gt;</span><br><span class="line">#include &lt;STDLIBã€‚H&gt;</span><br><span class="line">void Test(int n)</span><br><span class="line">&#123;</span><br><span class="line">    for(int i = 0; i &lt; 10000; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        //do nothingï¼Œ just waste time</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;%dï¼Œ &quot;ï¼Œ n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argcï¼Œchar* argv[])</span><br><span class="line">&#123;</span><br><span class="line">for(int i = 0; i &lt; 10; ++i)</span><br><span class="line"></span><br><span class="line">    Test(i);</span><br><span class="line"></span><br><span class="line">system(&quot;pause&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€‹    ä¸Šé¢çš„ç¨‹åºï¼Œåœ¨ main() æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„å¾ªç¯ï¼Œåæ¬¡è°ƒç”¨Test()è¿™ä¸ªå‡½æ•°ï¼ŒæŠŠå¾ªç¯çš„æ‰§è¡Œæ¬¡æ•°ä¼ è¿›Test() å¹¶æ‰“å°ã€‚è¿è¡Œç»“æœï¼š</p>
<p>â€‹    0ï¼Œ 1ï¼Œ 2ï¼Œ 3ï¼Œ 4ï¼Œ 5ï¼Œ 6ï¼Œ 7ï¼Œ 8ï¼Œ 9ï¼Œ</p>
<p>â€‹    OpenMP main() é‡Œå¹³è¡ŒåŒ–å¤„ç†ï¼ŒæŒ‰ç…§å¦‚ä¸‹æ–¹å¼è¿›è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;omp.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"></span><br><span class="line">void Test (int n)</span><br><span class="line">&#123;</span><br><span class="line">    for(int i = 0; i &lt; 10000; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        //do nothingï¼Œ just waste time</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;%dï¼Œ &quot;ï¼Œ n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argcï¼Œchar* argv[])</span><br><span class="line">&#123;</span><br><span class="line">    #pragma omp parallel for</span><br><span class="line"></span><br><span class="line">    for(int i = 0; i &lt; 10; ++i)</span><br><span class="line">        Test( i );</span><br><span class="line"></span><br><span class="line">    system(&quot;pause&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€‹    è¿è¡Œç»“æœï¼š</p>
<p>â€‹    0ï¼Œ 5ï¼Œ 1ï¼Œ 6ï¼Œ 2ï¼Œ 7ï¼Œ 3ï¼Œ 8ï¼Œ 4ï¼Œ 9ï¼Œ</p>
<p>â€‹    OpenMPæŠŠå¾ªç¯åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œæ‹†æˆ 0 - 4ï¼Œ 5 - 9ï¼Œä¸åŒçš„çº¿ç¨‹å»è·‘ï¼Œè¿›è¡Œäº¤é”™è¾“å‡ºã€‚</p>
<p>â€‹    æ€ä¹ˆç¡®å®šçœŸçš„æœ‰è·‘å¤šçº¿ç¨‹å‘¢ï¼Œéœ€è¦ä»ç¡¬ä»¶çš„è§’åº¦æ¥è¿›è¡Œè§‚å¯Ÿã€‚å¦‚æœæœ¬æ¥æœ‰å¤šå¤„ç†å™¨ã€å¤šæ ¸å¿ƒå¤„ç†å™¨æˆ–æœ‰ Hyper Thread çš„è¯ï¼Œä¸€ä¸ªå•çº¿ç¨‹ç¨‹åºï¼Œæœ€å¤šåªä¼šæŠŠä¸€é¢—æ ¸å¿ƒçš„ä½¿ç”¨é‡åƒå®Œã€‚</p>
<p>â€‹    å•çº¿ç¨‹çš„ç¨‹åºï¼Œå·¥ä½œç®¡ç†å‘˜ä¸­çœ‹åˆ°CPUä½¿ç”¨ç‡æœ€å¤šæ˜¯50%ï¼Œè¯´æ˜CPUåˆ©ç”¨ç‡ä½ã€‚åˆ©ç”¨ OpenMP æŠŠå¾ªç¯è¿›è¡Œå¹³è¡ŒåŒ–å¤„ç†åï¼ŒæŠŠä¸¤é¢—æ ¸å¿ƒçš„ CPU éƒ½ç”¨äº†ï¼ä¹Ÿå°±æ˜¯CPUä½¿ç”¨ç‡æé«˜äº†ï¼Œå¯èƒ½è¾¾åˆ°100%ï¼Œè¿™å°±è¯æ˜å¹¶è¡Œçš„ç»“æœã€‚</p>
<h6 id="6-6-4-2-4-2ã€Linuxç¯å¢ƒ"><a href="#6-6-4-2-4-2ã€Linuxç¯å¢ƒ" class="headerlink" title="6.6.4.2.4.2ã€Linuxç¯å¢ƒ"></a><strong>6.6.4.2.4.2ã€Linuxç¯å¢ƒ</strong></h6><p>â€‹    gcc æ”¯æŒ OpenMPæ˜¯è¿™æ ·çš„ï¼šä½¿ç”¨gcc ç¼–è¯‘æ—¶åŠ ä¸Š -fopenmp å¼€å…³å‚æ•°å³å¯ï¼š</p>
<p>â€‹    $ gcc -fopenmp &lt;source.c&gt; -o <exec></p>
<p>â€‹    $ g++ -fopenmp &lt;source.cpp&gt; -o <exec></p>
<p>â€‹    ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;cstdio&gt;</span><br><span class="line">#include &lt;cstring&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;ompã€‚h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">void hello()</span><br><span class="line">&#123;</span><br><span class="line">  int my_rank = omp_get_thread_num();</span><br><span class="line">  int thread_count = omp_get_num_threads();</span><br><span class="line">  printf(&quot;Hello from thread %d of %d\n&quot;ï¼Œ my_rankï¼Œ thread_count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">  int thread_count = 4;</span><br><span class="line">  #pragma omp parallel num_threads(thread_count)</span><br><span class="line">  hello();</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€‹    ä¸Šé¢ä»£ç é¦–å…ˆå¢åŠ äº†ä¸€ä¸ª ompã€‚h å¤´æ–‡ä»¶ï¼Œç„¶åä¸»å‡½æ•°ä¸­å¤šå‡ºæ¥ä¸€å¥ä¸²è¡Œä»£ç ä¸­æ²¡æœ‰çš„é¢„å¤„ç†å™¨æŒ‡ä»¤ï¼Œå…¶å®ƒçš„è·Ÿæ­£å¸¸çš„ä¸²è¡Œç¨‹åºæ²¡ä»€ä¹ˆåŒºåˆ«ã€‚</p>
<p>â€‹    # pragma æ˜¯ C&#x2F;C++ ä¸­ç”¨ä»¥å…è®¸é C è¯­è¨€è§„èŒƒéƒ¨åˆ†çš„è¡Œä¸ºï¼Œå¦‚æœç¼–è¯‘å™¨ä¸æ”¯æŒé¢„å¤„ç†å™¨æŒ‡ä»¤ï¼Œé‚£ä¹ˆç¼–è¯‘æ—¶è¿™å¥è¯å°±ä¼šè¢«å¿½ç•¥æ‰ã€‚</p>
<p>â€‹    OpenMP ä¾é # pragma omp å¼€å¤´çš„é¢„å¤„ç†å™¨æŒ‡ä»¤æ¥è¿›è¡Œçº¿ç¨‹çº§å¹¶è¡Œã€‚é¢„å¤„ç†å™¨æŒ‡ä»¤åé¢åŠ çš„æ˜¯ä¸€äº›å­å¥ï¼Œç”¨æ¥é™„åŠ é¢å¤–æ§åˆ¶ä¿¡æ¯ã€‚æ¯”å¦‚è¯´ num_threads() å­å¥æ˜¯ç”¨æ¥æ§åˆ¶æ¥ä¸‹æ¥çš„ä»£ç å—ä¸­éœ€è¦ç”¨å¤šå°‘ä¸ªçº¿ç¨‹è¿›è¡Œå¹¶è¡Œã€‚</p>
<p>â€‹    ç¨‹åºç¼–è¯‘å®Œæˆä¹‹åç›´æ¥æ‰“å¼€æ˜¯æ— æ³•è¿è¡Œçš„ï¼Œéœ€è¦ç”¨ mpiexec æ¥è°ƒç”¨ç”Ÿæˆå¥½çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œmpiexec ä¼šé¦–å…ˆå¾—åˆ°è¿è¡Œçš„ç›®æ ‡æœºå™¨ã€è¿›ç¨‹æ•°ç­‰æƒ…å†µï¼Œç„¶åå¯åŠ¨å¤šä¸ªè¿›ç¨‹ï¼Œç­‰åˆ°å¤šè¿›ç¨‹å…¨éƒ¨å¼€èµ·æ¥ä¹‹åï¼Œå¹¶è¡Œå°±å¼€å§‹äº†ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192148697.png" alt="img"></p>
<p>â€‹    åœ¨ OpenMP ä¸­ï¼Œç¼–è¯‘å®Œæˆä¹‹åçš„å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥ç›´æ¥è¿è¡Œï¼Œç¨‹åºåœ¨ä¸€å¼€å§‹æ˜¯ä¸²è¡Œè¿è¡Œï¼Œåˆ°äº†éœ€è¦å¹¶è¡Œçš„æ—¶å€™ï¼Œå•è¿›ç¨‹å•çº¿ç¨‹ä¼šåˆ†è£‚æˆå•è¿›ç¨‹å¤šçº¿ç¨‹ï¼ˆå…¶å®æ˜¯é™¤äº†ä¸»çº¿ç¨‹ä»¥å¤–ï¼Œåˆå¯åŠ¨äº†å‡ ä¸ªæ–°çš„çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼‰ï¼Œæ‰§è¡Œå®Œæ¯•ååˆå›åˆ°å•çº¿ç¨‹ä¸²è¡Œã€‚è€Œä¸”æ¯æ¬¡å¹¶è¡Œçš„çº¿ç¨‹æ•°æ˜¯å¯ä»¥åœ¨è¿è¡Œæ—¶æŒ‡å®šçš„ã€‚</p>
<p>â€‹    OpenMP å¯ä»¥åªæŠŠå…¶ä¸­çš„ä¸€éƒ¨åˆ†ä½œå¹¶è¡Œå¤„ç†ï¼Œè€Œä¸”å¹¶è¡Œçš„æ—¶å€™å…±äº«çš„å†…å­˜ã€å˜é‡ç­‰éƒ½æ˜¯åœ¨ä¸€èµ·çš„ï¼Œä»ä¸²è¡Œç¨‹åºçš„åŸºç¡€ä¸Šæ”¹é€ è¿‡æ¥éå¸¸å®¹æ˜“ï¼Œå¯èƒ½åªè¦åŠ å‡ æ®µé¢„å¤„ç†å™¨æŒ‡ä»¤å°±å¯ä»¥äº†ï¼Œå‰©ä¸‹çš„äº¤ç»™ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å»è§£å†³ã€‚</p>
<h5 id="6-6-4-2-5ã€åŒæ­¥åä½œ"><a href="#6-6-4-2-5ã€åŒæ­¥åä½œ" class="headerlink" title="6.6.4.2.5ã€åŒæ­¥åä½œ"></a>6.6.4.2.5ã€åŒæ­¥åä½œ</h5><p>â€‹    MPI ä¾é è¿›ç¨‹é—´é€šä¿¡å®Œæˆåä½œï¼ŒOpenMPé å†…å­˜å…±äº«çš„è§£å†³çº¿ç¨‹å†™ä½œã€‚</p>
<p>â€‹    OpenMP å†²çªè§£å†³æœ‰å››ç§æ–¹æ³•ï¼š</p>
<p>Aï¼šCrirical æŒ‡ä»¤ &#x2F; å½’çº¦æŒ‡ä»¤</p>
<p>â€‹    ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int sum = 0;</span><br><span class="line">#pragma omp parallel for num_threads(100)</span><br><span class="line">for (int i=0;i&lt;100;i++)</span><br><span class="line">&#123;</span><br><span class="line">       sum += i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">printf(&quot;%d\n&quot;ï¼Œ sum);</span><br></pre></td></tr></table></figure>

<p>â€‹    è¿è¡Œçš„ç»“æœæ˜¯æ¯æ¬¡è¿è¡Œï¼Œsum æœ€ç»ˆç»“æœå¯èƒ½æ˜¯ä¸åŒçš„ã€‚è¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Œè¿è¡Œæ—¶å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—® sum å˜é‡ï¼Œå¯èƒ½å‰ä¸€ä¸ªçº¿ç¨‹å†™ä¸Šå»çš„å†…å®¹é©¬ä¸Šè¢«ä¸‹ä¸€ä¸ªçº¿ç¨‹ç»™è¦†ç›–æ‰äº†ï¼Œæ•°æ®å…±äº«å‡ºç°äº†é—®é¢˜ï¼Œå³å‡ºç°äº†æ•°æ®å†²çªã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int sum = 0;</span><br><span class="line">#pragma omp parallel for num_threads(100)</span><br><span class="line">for (int i=0;i&lt;100;i++)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    #pragma omp critical</span><br><span class="line">    sum += i;</span><br><span class="line">&#125;</span><br><span class="line">printf(&quot;%d\n&quot;ï¼Œ sum);</span><br></pre></td></tr></table></figure>

<p>â€‹    åŠ ä¸Š# pragma omp critical æŒ‡ä»¤ï¼Œæ¥è¿›è¡Œæ•°æ®å¤„ç†ï¼Œä¼šè¿›è¡Œç‰¹æ®Šçš„å¤„ç†ï¼Œç¼–è¯‘å™¨å®‰æ’çº¿ç¨‹å¯¹ä¸‹é¢æ‰§è¡Œçš„ä»£ç è¿›è¡Œäº’æ–¥è®¿é—®ï¼Œè¿™æ˜¯ä¸€ç§è¿è¡Œçº¦æŸã€‚æ¯æ¬¡åªèƒ½å¤Ÿæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸‹é¢çš„è¿™ä¸€å¥ä»£ç ã€‚è¿™æ ·ä¿è¯æ•°æ®å¤„ç†çš„æœ‰åºä¸å®‰å…¨æ€§èƒ½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int sum = 0;</span><br><span class="line">#pragma omp parallel for num_threads(100) reduction(+: sum)</span><br><span class="line">for (int i=0;i&lt;100;i++)</span><br><span class="line">&#123;</span><br><span class="line">    sum += i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">printf(&quot;%d\n&quot;ï¼Œ sum);</span><br></pre></td></tr></table></figure>

<p>â€‹    reduction(+: sum) æ˜¯å½’çº¦å­å¥ï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹å®šçš„å†™æ³•ã€‚åŠ ä¸Šè¿™ä¸€å¥ï¼Œæ‰§è¡Œå¹¶è¡Œä»»åŠ¡æ—¶ï¼Œsum æœ¬èº«æ˜¯å…±äº«çš„ï¼Œä½†è¿™ä¸ªå…±äº«å’Œä¸Šé¢æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶ä¼šäº§ç”Ÿä¸€ä¸ªç§æœ‰å˜é‡ï¼Œåœ¨å¹¶è¡Œå—è¿ç®—ç»“æŸåï¼Œç³»ç»Ÿä¼šå°†ç§æœ‰å˜é‡çš„å€¼æ•´åˆï¼Œç„¶åä¼ é€’ç»™å…±äº«å˜é‡ã€‚è¿™æ ·ä¿è¯æ•°æ®çš„å…±äº«æ€§ã€‚</p>
<p>Bï¼šå¸¦å‘½åçš„ critical æŒ‡ä»¤</p>
<p>â€‹    ç”¨# pragma omp critical(name) æ¥å‘½åä¸åŒçš„ä¸´ç•ŒåŒºã€‚</p>
<p>â€‹    åŒä¸€ä¸ªä¸´ç•ŒåŒºçš„è®¿é—®å’Œä¸Šé¢ä¸€æ ·ï¼Œä¸€æ¬¡åªæœ‰ä¸€ä¸ªè¿›ç¨‹æ“ä½œï¼Œä¿è¯æ•°æ®çš„å®‰å…¨ï¼Œä¸åŒçš„ä¸´ç•ŒåŒºæœ‰ä¸åŒçš„è¿›ç¨‹è¿›è¡ŒåŒæ—¶è®¿é—®ï¼Œè¿™æ ·ä¿è¯æ•°æ®çš„åŒæ­¥ã€‚å®‰å…¨ä¸åŒæ­¥æ˜¯å¤„ç†æ—¶é—´å¿…é¡»è€ƒè™‘çš„å› ç´ ã€‚</p>
<p>Cï¼šatomic æŒ‡ä»¤ï¼š</p>
<p>â€‹    ç”¨# pragma omp atomic çš„ä½¿ç”¨å½¢å¼ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">x &lt;op&gt;= &lt;expression&gt;;</span><br><span class="line">x++;</span><br><span class="line">++x;</span><br><span class="line">x--;</span><br><span class="line">--x;</span><br></pre></td></tr></table></figure>

<p>â€‹    è¿™äº›è¯­å¥ç”¨ CPU ä¸­çš„ç‰¹æ®Šç¡¬ä»¶æŒ‡ä»¤æ¥å®ç°ï¼ŒåŠ å¿«å¤„ç†ç»“æœã€‚</p>
<p>Dï¼šç®€å•é”</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">omp_set_lock(&amp;lock);</span><br><span class="line">critical section</span><br><span class="line">omp_unset_lock(&amp;lock);</span><br></pre></td></tr></table></figure>

<p>â€‹    é”ä½çš„åŒºåŸŸåªå…è®¸å•ä¸ªçº¿ç¨‹è¿›è¡Œè®¿é—®ï¼Œä¿è¯æ•°æ®å®‰å…¨ã€‚</p>
<h4 id="6-6-4-3ã€OpenACC"><a href="#6-6-4-3ã€OpenACC" class="headerlink" title="6.6.4.3ã€OpenACC"></a>6.6.4.3ã€OpenACC</h4><p>  OpenACCï¼Œå¼€æ”¾å¼å¹¶è¡Œç¼–ç¨‹æ ‡å‡†ï¼Œç¨‹åºå‘˜èƒ½å¤Ÿè½»æ¾åˆ©ç”¨å¼‚æ„ CPU&#x2F;GPU è®¡ç®—ç³»ç»Ÿçš„å¼ºå¤§èƒ½åŠ›ã€‚å’ŒCUDAä¸€æ ·ï¼Œæ˜¯å¹¶è¡Œè®¡ç®—çš„ä¸»è¦å¹³å°æ¶æ„ã€‚</p>
<h5 id="6-6-4-3-1ã€ç®€ä»‹"><a href="#6-6-4-3-1ã€ç®€ä»‹" class="headerlink" title="6.6.4.3.1ã€ç®€ä»‹"></a>6.6.4.3.1ã€ç®€ä»‹</h5><p>  OpenACC ä¸ºå¹¶è¡Œç¨‹åºå‘˜ç»™ç¼–è¯‘å™¨æä¾›ç®€å•çš„æç¤ºï¼Œé€šè¿‡æŒ‡ä»¤ï¼Œä½¿ç¼–è¯‘å™¨èƒ½å¤Ÿè¯†åˆ«å“ªäº›ä»£ç éƒ¨åˆ†éœ€è¦åŠ é€Ÿï¼Œæ— éœ€ç¨‹åºå‘˜ä¿®æ”¹æˆ–æ”¹ç¼–åº•å±‚ä»£ç æœ¬èº«ã€‚ç®€åŒ–å¹¶è¡Œç¼–ç¨‹æ ‡å‡†ï¼ŒæŠŠè®¡ç®—ä»»åŠ¡æ˜ å°„åˆ°åŠ é€Ÿå™¨è¿™æ–¹é¢ï¼ŒæŒ‡ä»¤å‘ç¼–è¯‘å™¨å‘ˆç°å‡ºå¹¶è¡Œæœºåˆ¶ï¼Œä»è€Œè®©ç¼–è¯‘å™¨èƒ½å¤Ÿæ›´å¥½æ‰§è¡Œå·¥ä½œã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149273.jpeg" alt="https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1683434966,140585891&amp;fm=15&amp;gp=0.jpg"></p>
<p>  OpenACC æŒ‡ä»¤ç”± PGIã€Cray ä»¥åŠè‹±ä¼Ÿè¾¾åœ¨ CAPS çš„æ”¯æŒä¸‹å¼€å‘è€Œæˆï¼Œæ˜¯å¤šå®¶ä¼ä¸šå¸Œæœ›åˆ©ç”¨æŒ‡ä»¤æ¥ç®€åŒ– GPU ç¼–ç¨‹æ¨¡å‹çš„ä¸€ä¸ªå…±åŒæ„¿æ™¯ã€‚ç¡¬ä»¶å‚å•†å’ŒæŠ€æœ¯åä¼šä¸€èµ·ï¼Œè¿™äº›ä¼ä¸šå‡è‡´åŠ›äºæ”¯æŒä¸€ç§å…±åŒçš„ç¼–ç¨‹æ ‡å‡†ã€‚å…±åŒæŠŠå¹¶è¡Œç¼–ç¨‹æŠ€æœ¯æ¨å‘å‰è¿›ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149296.png" alt="img"></p>
<p>  OpenACCæŒ‡ä»¤ä¸OpenMPæŒ‡ä»¤å·¥ä½œæ–¹å¼å¾ˆç±»ä¼¼ï¼Œéƒ½æ˜¯æŒ‡ä»¤çº§åˆ«ç¼–ç¨‹ï¼Œé€‚ç”¨äºé«˜åº¦æ•°æ®å¹¶è¡Œä»£ç ã€‚å¯æ’å…¥æ ‡å‡†çš„Cï¼ŒC + +å’ŒFortranç¨‹åºç›´æ¥æŒ‡å¯¼ç¼–è¯‘å™¨è¿›è¡ŒæŸäº›ä»£ç æ®µçš„å¹¶è¡Œã€‚è¿™äº›å¹¶è¡Œçš„ä»£ç ï¼Œç¼–è¯‘å™¨ä¼šç‰¹åˆ«æ³¨æ„æ•°æ®åœ¨CPUå’ŒGPUï¼ˆæˆ–å…¶å®ƒï¼‰ä¹‹é—´æ¥å›è½¬ç§»çš„é€»è¾‘å…³ç³»ï¼Œå¹¶å°†è®¡ç®—æ˜ å°„åˆ°é€‚å½“çš„å¤„ç†å™¨ä¸Šã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149279.png" alt="img"></p>
<p>  è¿™äº›æŒ‡ä»¤ç”±ç¡¬ä»¶æ”¯æŒï¼Œä¸éœ€è¦è¾ƒå¤§çš„æ”¹åŠ¨ï¼Œç›¸å¯¹å°çš„æ”¹åŠ¨ä»¥æ ‡ç¤ºå‡ºåŠ é€Ÿå¹¶è¡ŒåŒºåŸŸã€‚æŒ‡ä»¤è®¾è®¡é€‚ç”¨äºä¸€ä¸ªé€šç”¨å¹¶è¡Œå¤„ç†å™¨ï¼Œè¿™æ ·ç›¸åŒçš„ä»£ç å¯ä»¥è¿è¡Œåœ¨å¤šæ ¸CPUã€GPUæˆ–ä»»ä½•ç¼–è¯‘å™¨æ”¯æŒçš„å…¶å®ƒç±»å‹çš„å¹¶è¡Œç¡¬ä»¶ä¸Šã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149269.png" alt="img"></p>
<h5 id="6-6-4-3-2ã€å‘å±•ä¸åº”ç”¨"><a href="#6-6-4-3-2ã€å‘å±•ä¸åº”ç”¨" class="headerlink" title="6.6.4.3.2ã€å‘å±•ä¸åº”ç”¨"></a>6.6.4.3.2ã€å‘å±•ä¸åº”ç”¨</h5><p>  2015å¹´7æœˆï¼ŒåŒ—äº¬ï¼Œå…¨çƒè§†è§‰è®¡ç®—æŠ€æœ¯è¡Œä¸šé¢†è¢–NVIDIAå‘å¸ƒäº†OpenACCå·¥å…·å¥—ä»¶ï¼Œé€šè¿‡å…¨æ–°çš„å¥—ä»¶ï¼Œç§‘å­¦ç ”ç©¶å°†å¯ä»¥åšæ›´å¤šäº‹æƒ…ï¼Œå¹¶å¤§å¹…æå‡è®¡ç®—æ•ˆç‡ã€‚</p>
<p>  è™½ç„¶è®¡ç®—æ ¸å¿ƒåœ¨çŸ­æ—¶é—´å†…ä¸ä¼šå˜å¾—æ›´å¿«ï¼Œè¿™æ˜¯ç¡¬ä»¶çš„åˆ¶çº¦ï¼Œä½†å¤„ç†å™¨çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›è¶Šæ¥è¶Šå¼ºå¤§ã€‚è¿™ä¸€è¶‹åŠ¿åå¹´é‡Œä¸€ç›´å­˜åœ¨ï¼Œè€Œä¸”è¿˜ä¼šæŒç»­ä¸‹å»ï¼Œé€šè¿‡è½¯æœºåˆ¶æé«˜æ•ˆç‡ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149332.png" alt="img"></p>
<p>  OpenACCå·²åœ¨HPCè¡Œä¸šä¸­å¾—åˆ°å¹¿æ³›æ”¯æŒï¼Œç®€åŒ–GPUç­‰ç°ä»£å¤„ç†å™¨çš„å¹¶è¡Œç¼–ç¨‹ã€‚2011å¹´Crayã€PGIä»¥åŠNVIDIAç­‰é¢†å…ˆçš„HPCä¾›åº”å•†æ¨å‡ºOpenACCç¼–ç¨‹æ ‡å‡†ä»¥æ¥ï¼Œå·²æœ‰8000å¤šåç ”ç©¶äººå‘˜å’Œç§‘å­¦å®¶é‡‡ç”¨äº†è¿™ä¸€æ ‡å‡†ã€‚å¹¶å–å¾—äº†å“è¶Šçš„æˆç»©ï¼Œå…è´¹çš„æ ‡å‡†</p>
<p>  OpenACCå·¥å…·å¥—ä»¶åº”ç”¨å¿«æ·ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œå¿«é€Ÿå¯¹GPUç¼–ç¨‹ã€‚å…¨æ–°çš„OpenACCå·¥å…·å¥—ä»¶è¡Œä¸šé¢†å…ˆï¼Œè·å¾—äº†å¹¿æ³›çš„åº”ç”¨ã€‚</p>
<p>  è¯¥å·¥å…·å¥—ä»¶ä¸­ï¼Œå‘å­¦æœ¯å¼€å‘è€…å’Œç ”ç©¶äººå‘˜å…è´¹æä¾›è¿™ä¸€ç¼–è¯‘å™¨ï¼Œå•†ä¸šç”¨æˆ·æœ‰90å¤©çš„å…è´¹è¯•ç”¨æœŸï¼Œé»„æ€»è¿˜æ˜¯å¾ˆåšé“çš„ã€‚</p>
<p>  å…¨æ–°çš„OpenACCå·¥å…·å¥—ä»¶æœ‰ä¸€ä¸ªç‰¹åˆ«çš„å·¥å…·ï¼šNVProf Profilerï¼ŒæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ·»åŠ  OpenACCâ€œæŒ‡ä»¤â€ï¼Œä¼šè¿›è¡Œç¼–è¯‘å™¨æç¤ºï¼Œä»¥åŠ é€Ÿä»£ç å®ç°ã€‚é€šè¿‡çœŸå®æ¡ˆä¾‹å¯ä»¥æ–¹ä¾¿å¿«æ·çš„å…¥é—¨ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149302.png" alt="img"></p>
<p>  ç®€å•çš„æŒ‡ä»¤è®©ç ”ç©¶äººå‘˜èƒ½å¤Ÿæ„Ÿå—åˆ°å¹¶è¡Œè®¡ç®—ï¼Œè¿è¡ŒåŠ é€Ÿï¼ŒåŒæ—¶ä¸ä¼šç ´åç°æœ‰çš„CPUä»£ç ï¼Œä¸æµªè´¹ä¹‹å‰æ‰€æœ‰ä»£ç ç¼–å†™èŠ±è´¹çš„æ—¶é—´ï¼Œè¿™äº›æŒ‡ä»¤ä¸ä»£ç å…·æœ‰ç€è¾ƒå¥½çš„åº”ç”¨ã€‚</p>
<h5 id="6-6-4-3-3ã€ç¡¬ä»¶ç‹¬ç«‹æ€§"><a href="#6-6-4-3-3ã€ç¡¬ä»¶ç‹¬ç«‹æ€§" class="headerlink" title="6.6.4.3.3ã€ç¡¬ä»¶ç‹¬ç«‹æ€§"></a>6.6.4.3.3ã€ç¡¬ä»¶ç‹¬ç«‹æ€§</h5><p>  ç¡¬ä»¶ç‹¬ç«‹æ€§ä»£è¡¨ä¸€ä¸ªæ ‡å‡†ï¼Œæ— è®ºå¯¹äºç¡¬ä»¶å‚å•†æˆ–è€…è½¯ä»¶å‚å•†ï¼Œå¯¹äºHPCç”¨æˆ·æ¥è¯´ç‰¹åˆ«é‡è¦ï¼Œæ— è®ºè½¯ä»¶å‚å•†è¿˜æ˜¯ç¡¬ä»¶å‚å•†ï¼Œä¸æ„¿æ„æ¥å—é‚£ç§å—ä¾›åº”å•†é™åˆ¶çš„ï¼Œéä¾¿æºå¼ç¼–ç¨‹ç¯å¢ƒã€‚</p>
<p>  OpenACCçš„ä¸€å¤§ä¸»è¦ç‰¹æ€§æ˜¯é«˜æ€§èƒ½ç§»æ¤ï¼Œè¿™ä¸»è¦æ˜¯ç¡¬ä»¶ç‹¬ç«‹æ€§çš„ç»“æœã€‚PGI OpenACCç¼–è¯‘å™¨åˆ™æŠŠè¿™ä¸€ä¼˜åŠ¿æ¨å‘å…¨æ–°é«˜åº¦ï¼Œè®©ä¸–äººæƒŠå¹ã€‚è¯¥ç¼–è¯‘å™¨é¦–æ¬¡èƒ½å¤Ÿåœ¨x86å¤šæ ¸CPUå’ŒGPUä¸ŠåŠ é€ŸOpenACCä»£ç ï¼Œæå¤§ç¨‹åº¦æé«˜äº†æ•ˆç‡ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149521.png" alt="img"></p>
<p>  æ²¡æœ‰ä¸€å°é…å¤‡GPUçš„ç³»ç»Ÿæ—¶ï¼Œç¼–è¯‘å™¨ä¼šåœ¨å¤šä¸ª CPUæ ¸å¿ƒä¸Šå®Œæˆä»£ç å¹¶è¡ŒåŒ–ï¼Œè¿›è€Œæå‡æ€§èƒ½ã€‚å½“ç³»ç»Ÿä¸­æœ‰GPUæ—¶ï¼Œè¯¥ç¼–è¯‘å™¨å°†ä¼šé’ˆå¯¹GPUåšä»£ç å¹¶è¡ŒåŒ–çš„ä¼˜åŒ–ï¼Œæœ€ç»ˆä¸å¤šæ ¸CPUç›¸æ¯”å¯å¸¦æ¥5~10å€çš„æ€§èƒ½æå‡ã€‚è¿™ç§æå‡å¤§å¤§æé«˜äº†æ•ˆç‡ï¼Œåœ¨ä»Šå¤©å¾—åˆ°å¹¿æ³›çš„åº”ç”¨ã€‚</p>
<p>  OpenACCä»£ç åœ¨Cè¯­è¨€åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œé€šè¿‡æ·»åŠ compiler directives ç¼–è¯‘å™¨æŒ‡ä»¤(pragmas): #pragma æ¥æ ‡ç¤ºã€‚è¿™ä¸ªå’Œå‰é¢ä»‹ç»çš„æœ‰äº›ç›¸ä¼¼ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149551.png" alt="img"></p>
<p>  cuda ä¸­ __syncthreads()è¿›è¡Œçº¿ç¨‹åŒæ­¥ï¼Œç›®å‰çš„OpenAccè¿˜æ²¡æœ‰çº¿ç¨‹åŒæ­¥æœºåˆ¶ã€‚</p>
<p>  OpenACCDevice model</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149604.png" alt="img"></p>
<p>  OpenACCexcute model</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149618.png" alt="img"></p>
<h5 id="6-6-4-3-4ã€å®ä¾‹01â€”parallel-loops"><a href="#6-6-4-3-4ã€å®ä¾‹01â€”parallel-loops" class="headerlink" title="6.6.4.3.4ã€å®ä¾‹01â€”parallel loops"></a>6.6.4.3.4ã€å®ä¾‹01â€”parallel loops</h5><p>  ç¬¬ä¸€æ®µä»£ç å’Œç¬¬äºŒæ®µä»£ç ç­‰æ•ˆï¼Œåœ¨OpenAccä¸­ä¸€ä¸ªparallelåŒºåŸŸæœ‰ä¸€ä¸ªå•ä¸ªloopç»„æˆã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#pragma acc parallel loop copyin(M[0:Mh*Mw])</span><br><span class="line">copyin(N[0:Mw*Nw]) copyout(P[0:Mh*Nw])</span><br><span class="line">for (int i=0; i&lt;Mh; i++)</span><br><span class="line">&#123;</span><br><span class="line">    ã€‚ã€‚ã€‚</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  ç­‰ä»·äºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#pragma acc parallel copyin(M[0:Mh*Mw])</span><br><span class="line">copyin(N[0:Mw*Nw]) copyout(P[0:Mh*Nw])</span><br><span class="line">&#123;</span><br><span class="line">    #pragma acc loop</span><br><span class="line">    for (int i=0; i&lt;Mh; i++) &#123;</span><br><span class="line">    ã€‚ã€‚ã€‚</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  ç»“æœè¯´æ˜ï¼š</p>
<p>  copyinå¯¹åº”æ‹·è´å†…å­˜ä»hoståˆ°device</p>
<p>  copyoutå¯¹åº”æ‹·è´å†…å­˜ä»deviceåˆ°host </p>
<h5 id="6-6-4-3-5ã€å®ä¾‹02â€”gangs-and-workers"><a href="#6-6-4-3-5ã€å®ä¾‹02â€”gangs-and-workers" class="headerlink" title="6.6.4.3.5ã€å®ä¾‹02â€”gangs and workers"></a>6.6.4.3.5ã€å®ä¾‹02â€”gangs and workers</h5><p>  gangså¯ä»¥ç±»æ¯”æˆcudaçš„blockï¼›</p>
<p>  workerså¯ä»¥ç±»æ¯”æˆthreadã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#pragma acc parallel num_gangs(1024) num_workers(32)</span><br><span class="line">&#123;</span><br><span class="line">    #pragma acc loop gang</span><br><span class="line">    for (int i=0; i&lt;2048; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        #pragma acc loop worker</span><br><span class="line">        for (int j=0; j&lt;512; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            foo(iï¼Œj);</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  è§£é‡Šï¼šçº¿ç¨‹åˆ†é…: 1024<em>32 &#x3D; 32K ä¸ªthreadï¼Œä¸¤ä¸ªå¾ªç¯é¢˜ä¸€å…±æ˜¯æ‰§è¡Œ2048</em>512 &#x3D; 1Mï¼Œ æ¯ä¸ªthreadæ‰§è¡Œfoo()å‡½æ•° 1M&#x2F;32K &#x3D; 32 æ¬¡ã€‚</p>
<p>  å¦å¤–ä¸€ä¸ªä»£ç ï¼š</p>
<p>  ç»“æœè¯´æ˜ï¼šä»£ç ä¼šåˆ†é…1023*32ä¸ªthreadï¼Œæ¯ä¸ªgang&#x3D;1024ï¼Œ å¯¹äºæ¯ä¸ªgangæ¥è¯´æ‰§è¡Œa &#x3D;23 æ˜¯å†—ä½™çš„ï¼Œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡å³å¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#pragma acc parallel copyout(a) num_gangs(1024) num_workers(32)</span><br><span class="line">&#123;</span><br><span class="line">    a = 23;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  å†çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#pragma acc parallel num_gangs(32)</span><br><span class="line">&#123;</span><br><span class="line">    Statement 1;</span><br><span class="line">    #pragma acc loop gang</span><br><span class="line">    for (int i=0; i&lt;n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        Statement 2;</span><br><span class="line">    &#125;</span><br><span class="line">ï½</span><br></pre></td></tr></table></figure>

<p>  Statement 3;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#pragma acc loop gang</span><br><span class="line"></span><br><span class="line">for (int i=0; i&lt;m; i++)</span><br><span class="line">&#123;</span><br><span class="line">        Statement 4;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Statement 5;</span><br><span class="line"></span><br><span class="line">if (condition) Statement 6;</span><br></pre></td></tr></table></figure>

<p>  ç»“æœè¯´æ˜ï¼šä»å¾ªç¯æ¬¡æ•°ä¸Šæ¥è¯´ï¼Œgang32ä¸ªï¼Œstatement2çš„å¾ªç¯æ¬¡æ•°nï¼Œstatement4å¾ªç¯æ¬¡æ•°æ˜¯mï¼Œ æœ€ç»ˆåˆ°åº•åˆ†é…å¤šå°‘ä¸ªthreadå–å†³äºç¼–è¯‘å™¨ï¼Œæœ‰å¯èƒ½m&gt;nï¼Œåˆ™åˆ†é…mä¸ªï¼Œå®é™…æƒ…å†µå¯èƒ½æ›´åŠ å¤æ‚ã€‚</p>
<p>  statement1ï¼Œ 3ï¼Œ 5ï¼Œ6 å¯¹äº32gangæ¥è¯´æ˜¯å†—ä½™çš„ï¼Œæƒ…å†µå’Œä¸Šé¢çš„ç›¸åŒï¼Œå¯ä»¥çœ‹å‡ºOpenAccä¸­çš„å†—ä½™æ˜¯å¯¹äºgangæ¥è¯´çš„ï¼Œä¸‹é¢çš„è¿™ç§å†™æ³•å¯ä»¥æ¶ˆé™¤è¿™ç§å†—ä½™ï¼šå–å¾—æ›´å¥½çš„æ•ˆæœï¼Œåœ¨ç¼–ç¨‹æ—¶é—´åº”è¯¥æ³¨æ„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#pragma acc parallel num_gangs(1)</span><br><span class="line">num_workers(32)</span><br><span class="line">&#123;</span><br><span class="line">    Statement 1;</span><br><span class="line">    #pragma acc loop gang</span><br><span class="line">    for (int i=0; i&lt;n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        Statement 2;</span><br><span class="line">    &#125;</span><br><span class="line">    Statement 3;</span><br><span class="line"></span><br><span class="line">    #pragma acc loop gang</span><br><span class="line">    for (int i=0; i&lt;m; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        Statement 4;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Statement 5;</span><br><span class="line"></span><br><span class="line">    if (condition)</span><br><span class="line">    &#123;</span><br><span class="line">        Statement 6;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="6-6-4-3-6ã€å®ä¾‹03â€”kernel-regions"><a href="#6-6-4-3-6ã€å®ä¾‹03â€”kernel-regions" class="headerlink" title="6.6.4.3.6ã€å®ä¾‹03â€”kernel regions"></a>6.6.4.3.6ã€å®ä¾‹03â€”kernel regions</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#pragma acc kernels</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    #pragma acc loop num_gangs(1024)</span><br><span class="line">    for (int i=0; i&lt;2048; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        a[i] = b[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #pragma acc loop num_gangs(512)</span><br><span class="line">    for (int j=0; j&lt;2048; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        c[j] = a[j]*2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (int k=0; k&lt;2048; k++) </span><br><span class="line">    &#123;</span><br><span class="line">        d[k] = c[k];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  ç»“æœè¯´æ˜ï¼š</p>
<p>  å’Œå‰é¢æ¯”è¾ƒï¼ŒåŒºåˆ«æ˜¯ acc kernelï¼Œ ä¹Ÿå°±æ˜¯æŒ‡ä»¤ä¸ä¸€æ ·ï¼Œå‰é¢ä»£ç ç”¨çš„æ˜¯acc parallelã€‚</p>
<p>  Kernel ç»“æ„ä¸»è¦æè¿°ç¨‹åºå‘˜æ„å›¾: å½“å‰ç¨‹åºé€‚åˆå¹¶è¡Œï¼Œç¼–è¯‘å™¨æ ¹æ®æè¿°ä¼šæœ‰éå¸¸çµæ´»çš„è¡¨ç°ã€‚æŠŠå†³å®šæƒç•™ç»™ç¼–è¯‘å™¨ã€‚</p>
<p>  ç¼–è¯‘å™¨çš„å‚ä¸é¿å…äº†ç¡¬ä»¶çš„æ¨¡ç³Šæ€§ï¼Œä¸ºå¹¶è¡Œå¼€å‘æä¾›äº†ä¾¿åˆ©ã€‚</p>
<h4 id="6-6-4-5ã€OpenAL"><a href="#6-6-4-5ã€OpenAL" class="headerlink" title="6.6.4.5ã€OpenAL"></a>6.6.4.5ã€OpenAL</h4><p>â€‹    OpenALï¼Œè‹±æ–‡å…¨ç§°ä¸ºï¼šOpen Audio Libraryï¼Œè‡ªç”±è½¯ä»¶ç•Œçš„è·¨å¹³å°éŸ³æ•ˆAPIï¼Œç”±Loki Softwareï¼Œä¸»è¦åº”ç”¨æ˜¯åœ¨éŸ³æ•ˆç¼“å†²å’Œæ”¶å¬ä¸­ç¼–ç ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149105.png" alt="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1282481439,2142315962&amp;fm=26&amp;gp=0.jpg"></p>
<p>â€‹    OpenALè®¾è®¡ç»™å¤šé€šé“ä¸‰ç»´ä½ç½®éŸ³æ•ˆçš„ç‰¹æ•ˆè¡¨ç°ï¼Œå…¶ API é£æ ¼æ¨¡ä»¿è‡ªOpenGLã€‚</p>
<p>â€‹    Loki å€’é—­ä»¥åï¼Œè¯¥å¼€å‘æ¥å£ï¼Œå¼€å§‹ç”±è‡ªç”±è½¯ä»¶&#x2F;å¼€æ”¾æºå§‹ç ç¤¾ç¾¤ç»§ç»­ç»´æŠ¤ã€‚æœ€å¤§çš„ä¸»å¯¼è€…æ˜¯åˆ›æ–°ç§‘æŠ€ï¼Œå¹¶å¾—åˆ°æ¥è‡ª Apple å’Œè‡ªç”±è½¯ä»¶&#x2F;å¼€æ”¾æºä»£ç çˆ±å¥½è€…çš„æŒç»­æ”¯æ´ã€‚è¿™æ˜¯ä»Šå¤©ä»åœ¨æ´»è·ƒçš„åŸºæœ¬åŸå› ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149116.png" alt="img"></p>
<p>â€‹    OpenAL ä¸»è¦åŠŸèƒ½æ˜¯åœ¨æ¥æºç‰©ä½“ã€éŸ³æ•ˆç¼“å†²å’Œæ”¶å¬è€…ä¸­ç¼–ç ã€‚æ¥æºç‰©ä½“åŒ…å«ä¸€ä¸ªæŒ‡å‘ç¼“å†²åŒºçš„æŒ‡æ ‡ã€å£°éŸ³çš„é€Ÿåº¦ã€ä½ç½®å’Œæ–¹å‘ï¼Œä»¥åŠå£°éŸ³å¼ºåº¦ã€‚æ”¶å¬è€…ç‰©ä½“åŒ…å«æ”¶å¬è€…çš„é€Ÿåº¦ã€ä½ç½®å’Œæ–¹å‘ï¼Œä»¥åŠå…¨éƒ¨å£°éŸ³çš„æ•´ä½“å¢ç›Šã€‚ç¼“å†²é‡ŒåŒ…å« 8 æˆ– 16 ä½å…ƒã€å•å£°é“æˆ–ç«‹ä½“å£° PCM æ ¼å¼çš„éŸ³æ•ˆèµ„æ–™ï¼Œè¡¨ç°å¼•æ“è¿›è¡Œæ‰€æœ‰å¿…è¦çš„è®¡ç®—ï¼Œå¦‚è·ç¦»è¡°å‡ã€å¤šæ™®å‹’æ•ˆåº”ç­‰ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149120.png" alt="img"></p>
<p>â€‹    ä¸åŒäº OpenGL è§„æ ¼ï¼ŒOpenAL è§„æ ¼åŒ…å«ä¸¤ä¸ªAPIåˆ†æ”¯ï¼šè¿™æ˜¯ç”±äºOpenALçš„ç‰¹ç‚¹å†³å®šçš„ã€‚ä»¥å®é™… OpenAL å‡½å¼ç»„æˆçš„æ ¸å¿ƒï¼Œå’Œ ALC APIï¼ŒALC ç”¨äºç®¡ç†è¡¨ç°å†…å®¹ã€èµ„æºä½¿ç”¨æƒ…å†µï¼Œå¹¶å°†è·¨å¹³å°é£æ ¼å°åœ¨å…¶ä¸­ã€‚è¿˜æœ‰ALUTåº“ï¼Œæä¾›é«˜é˜¶â€œæ˜“ç”¨â€çš„åŠŸèƒ½ï¼Œå…¶å®šä½ç›¸å½“äº OpenGL çš„ GLUTã€‚</p>
<p>â€‹    æ”¯æŒå¹³å°åŒ…æ‹¬ï¼šMac OS Xã€iOSã€Linuxã€BSDã€Solarisã€IRIXã€Windows PlayStationã€Xboxç­‰æ“ä½œç³»ç»Ÿä¸Šã€‚åœ¨å¦‚ä¸‹å·¥å…·ä¸­ä¹Ÿè¿›è¡Œå¹¿æ³›çš„åº”ç”¨ã€‚Blender - 3D å»ºæ¨¡å’Œæ¸²æŸ“å·¥å…·ã€‚Unity - 3D æ¸¸æˆå¼•æ“å’Œ IDEã€‚Basic4gl - ç¼–è¯‘å™¨å’Œç¼–ç¨‹è½¯ä»¶ã€‚</p>
<h4 id="6-6-4-6ã€OpenGL"><a href="#6-6-4-6ã€OpenGL" class="headerlink" title="6.6.4.6ã€OpenGL"></a>6.6.4.6ã€OpenGL</h4><p>â€‹    ç•¥ï¼ˆä¸Šä¸»é¢˜å·²æœ‰è®²è¿°ï¼‰ã€‚</p>
<h3 id="6-6-5ã€æ€»ç»“"><a href="#6-6-5ã€æ€»ç»“" class="headerlink" title="6.6.5ã€æ€»ç»“"></a>6.6.5ã€æ€»ç»“</h3><p>â€‹    äººå·¥æ™ºèƒ½åº”ç”¨çš„å¹¿æ³›æ€§ï¼Œåœ¨æœºå™¨è§†è§‰å±‚é¢ï¼Œä¸å¯èƒ½é ä¸€å¥—æ¡†æ¶è¿›è¡Œå¼€å‘ï¼Œæœªæ¥åœ¨æœºå™¨è§†è§‰ã€äººå·¥æ™ºèƒ½ã€éŸ³è§†é¢‘å¤„ç†å±‚é¢ä¸æ’é™¤æœ‰æ›´å¤šæ”¯æŒåº“çš„å‡ºç°ã€‚</p>
<p>â€‹    ç¾æ‘„SDKåº”ç”¨äººå·¥æ™ºèƒ½æŠ€æœ¯ï¼Œåœ¨æ™ºèƒ½è§†è§‰ã€è§†éŸ³é¢‘é¢†åŸŸè¿›è¡Œç€æ¢ç´¢ï¼Œä¸ºçŸ­è§†é¢‘æŠ€æœ¯çš„å‘å±•ï¼Œå†™ä¸‹æµ“é‡çš„ä¸€ç¬”ï¼Œ</p>
<p>â€‹    åŸºäºå·¥ä¸šç›¸æœºçš„è½¯ä»¶ç¼–ç¨‹ã€‚å‚å•†æä¾›é©±åŠ¨ä¸ç¨‹åºç¤ºä¾‹ã€‚å·¥ç¨‹å…¬å¸å‚è€ƒç›¸å…³ç¤ºä¾‹ï¼Œé€šè¿‡ç®—æ³•å¯¹ç›¸æœºè§†é¢‘åª’ä½“æ•°æ®è¿›è¡ŒåŠ å·¥åˆ†æã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149159.png" alt="https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=3462397246,2717035819&amp;fm=26&amp;gp=0.jpg"></p>
<p>â€‹    æœºå™¨è§†è§‰åå‘äºæœºå™¨å­¦ä¹ &#x2F;å¹¶è¡Œè¿ç®—ï¼Œè¿ç”¨æ•°æ®æŒ–æ˜æŠ€æœ¯ï¼Œè¿›è¡Œæ¨¡å‹è®­ç»ƒã€‚æœºå™¨è§†è§‰åœ¨ç¡¬ä»¶ä¸Šå¾€å¾€å’ŒGPUå…³è”ï¼Œåœ¨æ¡†æ¶æ”¯æŒä¸Šå’Œå¤§æ•°æ®è¿›è¡Œå…³è”ã€‚</p>
<p>â€‹    å›½å¤–é‡ç‚¹è¿›è¡Œäººå·¥æ™ºèƒ½ç®—æ³•ç ”ç©¶ï¼Œäººå·¥æ™ºèƒ½æ–¹æ¡ˆç­–åˆ’ï¼Œäººå·¥æ™ºèƒ½å·¥å…·ç ”å‘ã€‚å›½å†…é‡ç‚¹è¿›è¡Œå·¥å…·åº”ç”¨ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149173.png" alt="img"></p>
<p>â€‹    ç›®å‰ï¼Œå›½å†…åº”ç”¨æœ€å¤šçš„æ˜¯TensorFlowå’ŒPyTorchï¼Œæ¥è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œå¯¼å‡ºæ¥å£ï¼Œåœ¨åº”ç”¨å±‚é¢è°ƒç”¨ã€‚å½¢æˆå„ç§äººå·¥æ™ºèƒ½ç³»ç»Ÿã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149148.jpeg" alt="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1961163947,2304056094&amp;fm=26&amp;gp=0.jpg"></p>
<p>â€‹    è§†é¢‘é¢†åŸŸçš„äººå·¥æ™ºèƒ½ç³»ç»Ÿæ˜¯è§†é¢‘æ™ºèƒ½åº”ç”¨çš„ä¸»è¦æ ‡æŸ±ï¼Œå›½å†…äººå·¥æ™ºèƒ½å‘å±•æ—¥æ–°æœˆå¼‚ï¼Œåœ¨è§†é¢‘æ–¹é¢ä¹Ÿæœ‰ä¸€äº›å®Œå–„çš„æ¡†æ¶ä¸æ¥å£ï¼Œä¸ºäººå·¥æ™ºèƒ½è§†é¢‘ç³»ç»Ÿæä¾›ç®—æ³•æ”¯æŒã€‚</p>
<h2 id="6-8ã€å¯ç¤º"><a href="#6-8ã€å¯ç¤º" class="headerlink" title="6.8ã€å¯ç¤º"></a>6.8ã€å¯ç¤º</h2><p>â€‹    ç¡¬ä»¶æ˜¯æ¨åŠ¨è½¯ä»¶æŠ€æœ¯å‘å±•çš„åŸåŠ¨åŠ›ï¼Œåœ¨ç¡¬ä»¶æŠ€æœ¯è¿›æ­¥çš„åŸºç¡€ä¸Šï¼Œæ™ºèƒ½æ—¶ä»£ä¸ºå›¾å½¢å›¾åƒã€éŸ³è§†é¢‘é¢†åŸŸæ·»åŠ äº†äººå·¥æ™ºèƒ½çš„æˆåˆ†ã€‚</p>
<p>â€‹    ä»å›¾å½¢å›¾åƒè§’åº¦æ¥è¯´ï¼Œä¸ä»…æ˜¯ç¡¬æ€§å‚æ•°çš„æå‡ï¼Œæ›´æ˜¯å¯¹å›¾åƒæ•°æ®çš„æ™ºèƒ½ä¿®å¤å¤„ç†ã€‚ä»è§†é¢‘è§’åº¦æ¥è¯´ï¼Œä¸ä»…ä»…æ˜¯æ‘„å½±ã€å½•åˆ¶ã€ç¼–æ’ç¡¬æœ¯çš„æå‡ï¼Œæ›´æ˜¯å¯¹è§†é¢‘æ•°æ®çš„æ·±åº¦æŒ–æ˜ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149908.png" alt="img"></p>
<p>â€‹    æ™ºèƒ½ä¿®å¤ä¸æ·±åº¦å¤„ç†ä»å‰æ˜¯ä¸å¯æƒ³è±¡çš„ï¼Œå½“æµåª’ä½“æŠ€æœ¯è¿‡æ¸¡åˆ°æ·±åº¦å¤„ç†æ—¶ï¼Œä»£è¡¨ç€äººç±»ä¿¡æ¯åŠ å·¥èƒ½åŠ›çš„æ˜¾è‘—å¢å¼ºã€‚ä»æ—©æœŸè‡ªç„¶è¯­è¨€å¤„ç†åˆ°ä»Šå¤©æµåª’ä½“çš„å¹¶è¡Œè¿ç®—ï¼Œä»£è¡¨ç€æ˜¯æŠ€æœ¯çš„å·¨å¤§è¿›æ­¥ã€‚</p>
<p>â€‹    ç¡¬ä»¶æ°´å¹³çš„è¿›æ­¥ï¼Œå°¤å…¶æ˜¯å·¥ä¸šç›¸æœºæ°´å¹³çš„è¿›æ­¥ï¼Œä¿ƒè¿›äº†é«˜æ¸…æ™°é¢†åŸŸçš„å›¾å½¢å›¾åƒå¤„ç†ã€‚ä¼ ç»Ÿç›¸æœºæ°´å¹³çš„æå‡ï¼Œå¿…å°†ä¸ºè§†é¢‘å¤„ç†æä¾›æ–°çš„å‘å±•æ–¹å‘ä¸å‘å±•ç©ºé—´ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149895.png" alt="img"></p>
<p>â€‹    æœºå™¨è§†è§‰æŠ€æœ¯æ˜¯æ™ºèƒ½æ—¶ä»£çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œæœºå™¨è§†è§‰æŠ€æœ¯æ•´ä½“åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†æ˜¯åŸºäºå·¥ä¸šç›¸æœºçš„ä¸“ä¸šå¤„ç†ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ä¼ ç»Ÿè§†é¢‘æ™ºèƒ½å¤„ç†ã€‚</p>
<p>â€‹    å›½å¤–ç§‘æŠ€å…¬å¸è‚©è´Ÿç€æ™ºèƒ½æ—¶ä»£ç¡¬ä»¶å‘å±•çš„é‡ä»»ï¼Œæ¨åŠ¨GPUã€TPUã€NPUã€ä¸“ä¸šç›¸æœºç­‰ç¡¬ä»¶åŠŸèƒ½æå‡ã€‚åŒæ—¶æä¾›éŸ³è§†é¢‘ã€å›¾å½¢å›¾åƒé¢†åŸŸçš„ç®—æ³•éªŒè¯ï¼Œç»™å‡ºç›¸å…³è§£å†³æ–¹æ¡ˆã€‚</p>
<p>â€‹    å›½å†…ç§‘æŠ€å…¬å¸æ‹…è´Ÿç€äººå·¥æ™ºèƒ½ç»ˆç«¯åº”ç”¨çš„é‡ä»»ï¼Œä»¥å›½å¤–åº•å±‚ç ”å‘ä¸ºåŸºç¡€ï¼Œè¿›è¡Œè¡Œä¸šåˆ†ç±»ï¼Œå¸‚åœºæ•´åˆï¼Œåº”ç”¨è½åœ°ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149919.png" alt="img"></p>
<p>â€‹    åœ¨é‡å­è®¡ç®—æœºå‘å±•çš„å¤§èƒŒæ™¯ä¸‹ï¼Œä¸è¿œçš„å°†æ¥ï¼Œç›¸ä¿¡æŠ€æœ¯å°†ä¼šå‘ç”Ÿå˜é©ï¼Œè¡Œä¸šå°†ä¼šé‡æ–°æ´—ç‰Œã€‚äººå·¥æ™ºèƒ½çš„åŸºç¡€ç†è®ºå°†ä¼šæœ‰ç¿»å¤©è¦†åœ°çš„å˜åŒ–ï¼Œäººå·¥æ™ºèƒ½çš„åº”ç”¨å°†ä¼šæ›´æ·±åˆ»ä¸å¹¿æ³›ã€‚ä»Šå¤©çš„äººå·¥æ™ºèƒ½æ˜¯é‡å­æ—¶ä»£çš„ä¸€ä¸ªå‰èµ°è€Œå·²ã€‚çœŸæ­£çš„äººå·¥æ™ºèƒ½æ˜¯é‡å­æ—¶ä»£äººå·¥æ™ºèƒ½ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192149904.png" alt="img"></p>
<p>â€‹    åœ¨ç¬¬å››æ¬¡ç§‘æŠ€é©å‘½çš„æ™ºèƒ½æ—¶ä»£ï¼Œé»„è‰²é¢å­”ã€ä¸œæ–¹å…¬å¸é€æ¸å¢å¤šï¼Œè¿™ä¸ªæ²‰é»˜äº†200å¹´çš„æ°‘æ—ï¼Œå¼€å§‹é‡æ–°å±¹ç«‹äºä¸–ç•Œæ°‘æ—ä¹‹æ—ã€‚</p>
<h1 id="7ã€æ˜¾ç¤ºæ ‡å‡†ä¸è§†é¢‘å¤„ç†å•å…ƒ"><a href="#7ã€æ˜¾ç¤ºæ ‡å‡†ä¸è§†é¢‘å¤„ç†å•å…ƒ" class="headerlink" title="7ã€æ˜¾ç¤ºæ ‡å‡†ä¸è§†é¢‘å¤„ç†å•å…ƒ"></a>7ã€æ˜¾ç¤ºæ ‡å‡†ä¸è§†é¢‘å¤„ç†å•å…ƒ</h1><p>â€‹    æ¶ˆè´¹çº§è§†é¢‘æ™ºèƒ½å¤„ç†å¤§ä½“æœ‰10å¹´å·¦å³ï¼Œæœ‰äº†å·¨å¤§çš„å‘å±•ï¼Œå±•æœ›æœªæ¥ï¼Œå¯¹åº”äºå¤§å‚è€Œè¨€ï¼Œç«äº‰æ˜¯æ ‡å‡†çš„ç«äº‰ã€‚åŒ…å«æ˜¾ç¤ºæ ‡å‡†ä¸å¤„ç†å•å…ƒï¼Œç«äº‰æ¨åŠ¨äº†ç§‘æŠ€çš„è¿›æ­¥ï¼Œå¸‚åœºçš„ç¹è£ã€‚</p>
<p>â€‹    æ–°çš„æ˜¾ç¤ºç¡¬ä»¶ä¹Ÿä¸æ–­å‘å±•ï¼ŒGPUåŸºç¡€ä¸Šï¼Œå‡ºç°äº†GPGPUã€TPUã€NPUã€VPUã€APUç­‰æ–°çš„è§†é¢‘å¤„ç†å•å…ƒï¼Œç›¸ä¿¡æœªæ¥æœ‰æ›´å¤šçš„æ•°æ®ç¡¬ä»¶å¤„ç†å•å…ƒå‡ºç°ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150530.png" alt="img"></p>
<p>â€‹    äººå·¥æ™ºèƒ½è¿˜å¤„åœ¨åˆçº§é˜¶æ®µï¼Œæ ‡å‡†ä¸è§„èŒƒå¤„åœ¨å˜åŒ–ä¸­ï¼Œéšç€é«˜æ¸…æ™°è§†é¢‘ç¡¬ä»¶çš„å‡ºç°ï¼Œè½¯ä»¶ç®—æ³•å¾ˆå¤šæ–¹é¢ä¹Ÿé¢ä¸´ç€è°ƒæ•´ã€‚è¿‘äº›å¹´å„å›½é‡è§†äººå·¥æ™ºèƒ½çš„å‘å±•ï¼Œèµ„æœ¬çš„æŠ•å…¥ï¼Œæ”¿ç­–çš„é©±åŠ¨å¢æ·»äº†äººå·¥æ™ºèƒ½å‘å±•çš„æ´»åŠ›ã€‚</p>
<h2 id="7-1ã€æ˜¾ç¤ºæ ‡å‡†"><a href="#7-1ã€æ˜¾ç¤ºæ ‡å‡†" class="headerlink" title="7.1ã€æ˜¾ç¤ºæ ‡å‡†"></a>7.1ã€æ˜¾ç¤ºæ ‡å‡†</h2><p>â€‹    å¤šå¹´æ±Ÿæ¹–å®æ€ï¼Œå„è·¯æ˜¾å¡è¢«èµ¶å°½æ€ç»ï¼Œç•™ä¸‹è‹±ä¼Ÿè¾¾å’ŒAMDï¼ŒÂ·ç›®å‰æ˜¾å¡æŠ€æœ¯çš„é©æ–°ï¼Œä¸»è¦å°±æ˜¯Aå¡ä¸Nå¡æŠ€æœ¯çš„å‘å±•ã€‚è‹±ä¼Ÿè¾¾åé‡äººå·¥æ™ºèƒ½ï¼ŒAMDåé‡äºGCNä¸APUæ–¹å‘ã€‚</p>
<p>â€‹    è¿‘æœŸå€¡å¯¼çš„æ˜¾ç¤ºæŠ€æœ¯æœ‰è‹±ä¼Ÿè¾¾çš„G-Syncå’ŒAMDçš„Freesync 2ã€‚åœ¨ä»‹ç»G-Syncçš„åŒæ—¶ï¼Œæœ‰å¿…è¦ä»‹ç»ä¸‹V-Syncã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150439.png" alt="img"></p>
<h4 id="7-1-1ã€V-Sync"><a href="#7-1-1ã€V-Sync" class="headerlink" title="7.1.1ã€V-Sync"></a>7.1.1ã€V-Sync</h4><p>â€‹    å‚ç›´åŒæ­¥åˆç§°åœºåŒæ­¥ï¼ˆVertical synchronizationï¼‰ï¼Œä»CRTæ˜¾ç¤ºå™¨çš„æ˜¾ç¤ºåŸç†æ¥çœ‹ï¼Œå•ä¸ªåƒç´ ç»„æˆäº†æ°´å¹³æ‰«æçº¿ï¼Œæ°´å¹³æ‰«æçº¿åœ¨å‚ç›´æ–¹å‘çš„å †ç§¯å½¢æˆäº†å®Œæ•´çš„ç”»é¢ã€‚</p>
<p>â€‹    å±å¹•çš„åˆ·æ–°è¿‡ç¨‹æ˜¯æ¯ä¸€è¡Œä»å·¦åˆ°å³ï¼ˆè¡Œåˆ·æ–°ï¼Œæ°´å¹³åˆ·æ–°ï¼ŒHorizontal Scanningï¼‰ï¼Œä»ä¸Šåˆ°ä¸‹ï¼ˆå±å¹•åˆ·æ–°ï¼Œå‚ç›´åˆ·æ–°ï¼ŒVertical Scanningï¼‰ã€‚å½“æ•´ä¸ªå±å¹•åˆ·æ–°å®Œæ¯•ï¼Œå³ä¸€ä¸ªå‚ç›´åˆ·æ–°å‘¨æœŸå®Œæˆï¼Œä¼šæœ‰çŸ­æš‚çš„ç©ºç™½æœŸï¼Œæ­¤æ—¶å‘å‡º VSync ä¿¡å·ã€‚æ‰€ä»¥ï¼ŒVSync ä¸­çš„ V æŒ‡çš„æ˜¯å‚ç›´åˆ·æ–°ä¸­çš„å‚ç›´-Verticalã€‚</p>
<p>â€‹    æ˜¾ç¤ºå™¨çš„åˆ·æ–°ç‡å—æ˜¾å¡DACæ§åˆ¶ï¼Œæ˜¾å¡DACå®Œæˆä¸€å¸§æ‰«æåå°±ä¼šäº§ç”Ÿä¸€ä¸ªå‚ç›´åŒæ­¥ä¿¡å·ã€‚æ‰“å¼€å‚ç›´åŒæ­¥æŒ‡çš„æ˜¯å°†è¯¥ä¿¡å·é€å…¥æ˜¾å¡3Då›¾å½¢å¤„ç†éƒ¨åˆ†ï¼Œè¿™æ ·è®©æ˜¾å¡åœ¨ç”Ÿæˆ3Då›¾å½¢æ—¶å—å‚ç›´åŒæ­¥ä¿¡å·çš„åˆ¶çº¦ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150488.png" alt="img"></p>
<p>â€‹    æ˜¾ç¤ºå™¨ä¸Šçš„å›¾åƒæ˜¯ä¸€çº¿ä¸€çº¿æ‰«æä¸Šå»çš„ï¼Œæ— è®ºéš”è¡Œæ‰«æè¿˜æ˜¯é€è¡Œæ‰«æï¼Œæ˜¾ç¤ºå™¨éƒ½æœ‰2ç§åŒæ­¥å‚æ•°â€”â€”æ°´å¹³åŒæ­¥å’Œå‚ç›´åŒæ­¥ã€‚</p>
<p>â€‹    æ°´å¹³åŒæ­¥è„‰å†²ï¼ˆHorizontal synchronization pulseï¼Œ Hsyncï¼‰åŠ åœ¨ä¸¤ä¸ªæ‰«æè¡Œä¹‹é—´ã€‚å®ƒæ˜¯ä¸€ä¸ªçŸ­å°çš„è„‰å†²ï¼Œä¸€è¡Œæ‰«æå®Œæˆä¹‹åï¼Œå®ƒå°±ä¼šå‡ºç°ï¼ŒæŒ‡ç¤ºç€è¿™ä¸€è¡Œæ‰«æå®Œæˆï¼ŒåŒæ—¶ä¹ŸæŒ‡ç¤ºç€ä¸‹ä¸€è¡Œå°†è¦å¼€å§‹ã€‚</p>
<p>â€‹    æ°´å¹³åŒæ­¥è„‰å†²å‡ºç°åï¼Œä¼šæœ‰ä¸€å°æ®µå«horizontal back porchçš„æ—¶é—´ï¼Œè¿™æ®µæ—¶é—´é‡Œçš„åƒç´ ä¿¡å·ä¸ä¼šè¢«æ˜¾ç¤ºå‡ºæ¥ï¼Œè¿‡äº†è¿™ä¸€å°æ®µæ—¶é—´ä¹‹åï¼Œç”µå­æªå°±å¼€å§‹æ‰«ææ–°çš„ä¸€è¡Œï¼Œå°†è¦æ˜¾ç¤ºçš„å†…å®¹æ‰«æåˆ°æ˜¾ç¤ºå™¨ä¸Šã€‚</p>
<p>â€‹    å‚ç›´åŒæ­¥è„‰å†²ï¼ˆVertical synchronizationï¼Œ Vsyncï¼‰æ˜¯åŠ åœ¨ä¸¤å¸§ä¹‹é—´ã€‚è·Ÿæ°´å¹³åŒæ­¥è„‰å†²ç±»ä¼¼ï¼Œä½†å®ƒæŒ‡ç¤ºç€å‰ä¸€å¸§çš„ç»“æŸï¼Œå’Œæ–°ä¸€å¸§çš„å¼€å§‹ã€‚ å‚ç›´åŒæ­¥è„‰å†²æ˜¯ä¸€ä¸ªæŒç»­æ—¶é—´æ¯”è¾ƒé•¿çš„è„‰å†²ï¼Œå¯èƒ½æŒç»­ä¸€è¡Œæˆ–å‡ è¡Œçš„æ‰«ææ—¶é—´ï¼Œä½†åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œæ²¡æœ‰åƒç´ ä¿¡å·å‡ºç°ã€‚</p>
<h4 id="7-1-2ã€G-Sync"><a href="#7-1-2ã€G-Sync" class="headerlink" title="7.1.2ã€G-Sync"></a>7.1.2ã€G-Sync</h4><p>â€‹    G-SYNCæŠ€æœ¯å¯è§£å†³V-SYNCå¸¦æ¥çš„å–èˆé—®é¢˜ï¼Œä¸è®ºç”»é¢æ›´æ–°ç‡æœ‰å¤šå¿«ï¼Œå®ƒéƒ½å¯ä»¥è®©å±å¹•ä¸GPUå®Œå…¨åŒæ­¥ï¼Œæä¾›æ— ä¸ä¼¦æ¯”çš„PCæ¸¸æˆä½“éªŒã€‚é€šè¿‡NVIDIA G-SYNCæŠ€æœ¯æ¸¸æˆåœºæ™¯å¯å³æ—¶å‘ˆç°åœ¨ç©å®¶çš„çœ¼å‰ï¼Œç‰©ä»¶ä¹Ÿå°†æ›´æ¸…æ™°é”åˆ©ï¼Œæ¸¸æˆä¹Ÿå˜å¾—æ›´æµç•…ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150522.png" alt="img"></p>
<p>â€‹    2013å¹´10æœˆ18æ—¥ï¼ŒNVIDIA editorâ€™s dayç¬¬äºŒå¤©ï¼Œè¿ç»­å‘å¸ƒGameStream PC Game for Shieldä»¥åŠShadowPlayä¸¤é¡¹é‡ç£…æŠ€æœ¯ä¹‹åï¼ŒNVIDIAåœ¨åŠ æ‹¿å¤§è’™ç‰¹åˆ©å°”æ­£å¼å‘å¸ƒäº†å…¨æ–°çš„é’ˆå¯¹ç”»é¢è¿è´¯æ€§çš„æ–°æŠ€æœ¯â€”â€”G-SYNCã€‚</p>
<p>â€‹    ä½œä¸ºå‚ç›´åŒæ­¥æŠ€æœ¯çš„æ›¿ä»£ä»¥åŠè‡ªé€‚åº”å‚ç›´åŒæ­¥æŠ€æœ¯çš„å»¶ä¼¸ï¼ŒG-SYNCæŠ€æœ¯ä¸ä»…è§£å†³äº†ç”»é¢æ’•è£‚é—®é¢˜ï¼ŒåŒæ—¶ä»æ ¹æœ¬ä¸Šè§£å†³äº†å›°æ‰°å‚ç›´åŒæ­¥æŠ€æœ¯è®¸ä¹…çš„ç”»é¢è§†è§‰å¡é¡¿é—®é¢˜ã€‚ </p>
<p>â€‹    G-SYNCæŠ€æœ¯åœ¨æ˜¾ç¤ºå™¨ä¸­å†…ç½®ä¸€æšå¯ä¸GeForceç¡¬ä»¶ç›´æ¥é€šè®¯çš„èŠ¯ç‰‡ï¼Œè¿™æšè‡ªå¸¦ç¼“å­˜çš„èŠ¯ç‰‡å¯ä»¥åè°ƒæ˜¾ç¤ºå™¨ä¸GPU outputbufferä¹‹é—´çš„æ•°æ®åŒæ­¥ã€‚</p>
<p>â€‹    é€šè¿‡G-SYNCèŠ¯ç‰‡çš„æ§åˆ¶ï¼Œæ˜¾ç¤ºå™¨çš„åˆ·æ–°å»¶è¿Ÿå°†å¯ä»¥ä¸GPUå¸§è¾“å‡ºå»¶è¿Ÿä¿æŒå®Œå…¨ä¸€è‡´ï¼Œæ”¯æŒG-SYNCæŠ€æœ¯çš„æ˜¾ç¤ºå™¨ä¼šæ ¹æ®GPUå½“å‰çš„æ€§èƒ½æ°´å¹³è‡ªåŠ¨è°ƒèŠ‚åˆ·æ–°ç‡ï¼Œ</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150502.png" alt="img"></p>
<p>â€‹    G-SYNCèŠ¯ç‰‡ä¾¦æµ‹åˆ°GPUçš„å¸§è¾“å‡ºå»¶è¿Ÿå¤§äº16msæ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å»¶é•¿æ˜¾ç¤ºå™¨çš„åˆ·æ–°å»¶è¿Ÿï¼Œé¿å…ä¼ ç»Ÿçš„å¸§ä¸¢å¼ƒå¯¼è‡´çš„è§†è§‰å¡é¡¿ç°è±¡ã€‚</p>
<p>â€‹    G-Syncèƒ½å¤Ÿå»é™¤æ¸¸æˆå‚ç›´åŒæ­¥ï¼ˆVSyncï¼‰å¼€å¯æ—¶çš„ç”»é¢æ»åé—®é¢˜ï¼Œä¹Ÿèƒ½å¤Ÿå…‹æœå‚ç›´åŒæ­¥å…³é—­æ—¶ç”»é¢å¤±çœŸé—®é¢˜ã€‚å¸¸è§„æ˜¾ç¤ºå™¨ä¼šç›´æ¥åŒæ­¥GPUçš„å¤„ç†ç»“æœï¼Œå€ŸåŠ©G-Syncæ¨¡å—ï¼Œåªæœ‰å½“GPUå®Œæˆä¸€å¸§çš„æ¸²æŸ“å’Œç”»é¢ä¼˜åŒ–åï¼Œæ˜¾ç¤ºå™¨æ‰ä¼šåˆ·æ–°æ˜¾ç¤ºå†…å®¹ã€‚ </p>
<p>â€‹    å¾ˆå¤šå…¬å¸éƒ½æ¨å‡ºäº†æ”¯æŒG-Syncå›¾åƒå¢å¼ºæŠ€æœ¯çš„æ˜¾ç¤ºå™¨,æ¶ˆé™¤äº†å±å¹•æ’•è£‚å’Œå‚ç›´åŒæ­¥è¾“å…¥å»¶è¿Ÿç­‰å½±å“ï¼Œ å¢å¼ºäº†ç°æœ‰æ˜¾ç¤ºå™¨åŠŸèƒ½çš„åŒæ—¶å±å¹•ç”»é¢å‘ˆç°å‡ºåœºæ™¯åŠæ—¶å‡ºç°ã€ç‰©ä½“æ›´åŠ é”åˆ©ä»¥åŠæ¸¸æˆè¿è¡Œæ›´åŠ é¡ºç•…ç­‰å‡ºè‰²çš„æ˜¾ç¤ºæ•ˆæœã€‚G-Syncèƒ½å¼ºåˆ¶æ˜¾ç¤ºå™¨è¿è¡Œåœ¨GPUçš„å¸§é€Ÿç‡ä¸‹ï¼Œç”šè‡³èƒ½è®©åŸç”Ÿåˆ·æ–°ç‡é™åˆ°æ›´ä½ï¼Œæä¾›æ›´å¥½çš„è§†è§‰æ•ˆæœã€‚</p>
<h4 id="7-1-3ã€FreeSync2"><a href="#7-1-3ã€FreeSync2" class="headerlink" title="7.1.3ã€FreeSync2"></a>7.1.3ã€FreeSync2</h4><p>â€‹    FreeSync 2 æ˜¯AMDåŠ›æ¨çš„è§†è§‰æ•ˆæœå¢å¼ºæŠ€æœ¯ï¼Œå¯æœ‰æ•ˆæ¶ˆé™¤æ¸¸æˆä¸­å¸¸è§çš„æ’•è£‚(Tearing)ã€å¡é¡¿(Shuttering)ç°è±¡ï¼Œä¿è¯ç”»é¢æµç•…ã€æ— æ’•è£‚ã€æ— å¡é¡¿ã€æ— ä¼ªå½±ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150545.png" alt="img"></p>
<p>â€‹    å›¾åƒæ’•è£‚æ˜¯å±å¹•å›¾åƒçœ‹èµ·æ¥ä¸è¿è´¯ï¼Œè¿™æ˜¯å¸§é€Ÿç‡ï¼ˆæ˜¾ç¤ºå›¾åƒå¸§çš„é€Ÿç‡ï¼‰ä¸æ˜¾ç¤ºå™¨åˆ·æ–°ç‡ï¼ˆæ˜¾ç¤ºå™¨å›¾åƒåˆ·æ–°é¢‘ç‡ï¼‰ä¸åŒ¹é…çš„ç»“æœã€‚FreeSync2ä¸ºæ˜¾ç¤ºå™¨æä¾›å¯å˜åˆ·æ–°ç‡ï¼Œå³åŠ¨æ€åˆ·æ–°ç‡ï¼ˆVRR &#x2F; DRRï¼‰ã€‚è¯¥åŠŸèƒ½ä½¿æ˜¾ç¤ºå™¨çš„åˆ·æ–°ç‡ä¸AMD Radeonæ˜¾å¡çš„å¸§é€Ÿç‡ç›¸åŒ¹é…ã€‚</p>
<p>â€‹    FreeSync2æ”¯æŒé«˜è¾¾240Hzçš„åˆ·æ–°ç‡ï¼Œå…·ä½“å–å†³äºæ˜¾ç¤ºå™¨ã€‚è¿™æ ·ï¼Œå¯ä»¥äº«å—æ˜¾å¡èƒ½å¤Ÿè¾¾åˆ°çš„æœ€å¤§å¸§é€Ÿç‡ã€‚å¦‚æœçœ¼ç›å¤Ÿæ•é”çš„è¯ï¼Œä½ å¯èƒ½ä¼šå‘ç°åˆ°è¾“å…¥å»¶è¿Ÿï¼Œæˆ–è€…é¼ æ ‡ç§»åŠ¨å’Œå…‰æ ‡å®é™…ç§»åŠ¨ä¹‹é—´çš„å»¶è¿Ÿä¹Ÿé™ä½äº†ã€‚FreeSyncåŸºäºVESAçš„è‡ªé€‚åº”åŒæ­¥åè®®ï¼Œå¯ä»¥åœ¨DisplayPortå’ŒHDMIä¸Šè¿è¡Œã€‚</p>
<p>â€‹    FreeSync2æ”¯æŒé«˜åŠ¨æ€èŒƒå›´&amp;è‰²åŸŸæ”¯æŒï¼Œä½å»¶è¿Ÿã€ä½åˆ·æ–°ç‡è¡¥å¿æŠ€æœ¯ç­‰ã€‚è®©æ¸¸æˆæ˜¾ç¤ºæ•ˆæœæ›´åŠ é€¼çœŸã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150733.png" alt="img"></p>
<p>â€‹    ä»HDRå†…å®¹åˆ°æ˜¾ç¤ºå™¨ä¼ è¾“æ—¶éœ€è¦è¿›è¡ŒTone Mappingï¼Œè¿™ä¸ªé¢å¤–çš„è®¡ç®—å¢åŠ äº†GPUå¤„ç†æ•°æ®ï¼ŒåŒæ—¶å¢åŠ äº†å»¶æ—¶ã€‚FreeSync2å–æ¶ˆäº†ä¼ è¾“è¿‡ç¨‹çš„è½¬æ¢è¿‡ç¨‹ï¼Œé™ä½HDRè½¬æ¢å¸¦æ¥çš„å»¶è¿Ÿã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150710.png" alt="img"></p>
<p>â€‹    FreeSync2å¼•å…¥çš„å¦ä¸€ä¸ªæ–°åŠŸèƒ½æ˜¯LFCï¼ŒLow Frame Rate Compensationä½åˆ·æ–°ç‡è¡¥å¿æŠ€æœ¯ï¼Œå½“æ¸¸æˆçš„FPSå°äºæ˜¾ç¤ºå™¨æœ€ä½åˆ·æ–°ç‡æ—¶ï¼Œé€šè¿‡é¢å¤–æ’å¸§(GPUè®¡ç®—ï¼Œç±»ä¼¼MEMC)ï¼Œè®©ä½FPSçš„ç”»é¢æ›´åŠ æµç•…ã€‚LFCæŠ€æœ¯çš„åº”ç”¨ï¼Œå³æ—¶æ˜¾å¡æ¸²æŸ“FPSè¾ƒä½æ—¶ä¹Ÿå¯ä»¥æ˜¾è‘—çš„æ”¹å–„ç”»é¢æµç•…åº¦ï¼Œæé«˜æ¸¸æˆä½“éªŒã€‚</p>
<h4 id="7-1-4ã€æ€»ç»“"><a href="#7-1-4ã€æ€»ç»“" class="headerlink" title="7.1.4ã€æ€»ç»“"></a>7.1.4ã€æ€»ç»“</h4><p>â€‹    æ˜¾ç¤ºå™¨æ˜¯æ˜¾ç¤ºéƒ¨åˆ†çš„å‰ç«¯ï¼Œæ˜¾ç¤ºæ ‡å‡†å¯¹æ˜¾ç¤ºç¡¬ä»¶çš„å‘å±•èµ·ç€å¼•å¯¼çš„ä½œç”¨ï¼Œæ˜¾ç¤ºæ ‡å‡†çš„å˜é©é€šè¿‡ä¼ ç»Ÿç¡¬ä»¶å¤§å‚æ¥æ¨åŠ¨ï¼Œç›®å‰è€Œè®ºï¼Œåªæœ‰NVIDIAã€AMDã€INTELæ‰æœ‰è¿™æ ·çš„å®åŠ›ã€‚</p>
<p>â€‹    æ˜¾ç¤ºæ ‡å‡†å¯¹äºå›¾å½¢å›¾åƒã€è§†é¢‘ã€ç¡¬ä»¶éƒ½æœ‰ç€ç´§å¯†çš„è”ç³»ï¼Œå‘å±•è¿‡ç¨‹ä¸­ï¼Œæ ‡å‡†çš„æ”¹å˜å°†æ¨åŠ¨è½¯ç¡¬ä»¶çš„å‘å±•ã€‚</p>
<p>â€‹    ç¾æ‘„SDKï¼Œæ”¯æŒG-Syncã€V-Syncã€FreeSync2æ ‡å‡†ï¼Œæ”¯æŒæœ€æ–°æ˜¾ç¤ºè§„èŒƒï¼Œå½°æ˜¾çŸ­è§†é¢‘ä»·å€¼ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150772.png" alt="img"></p>
<h2 id="7-2-VPU"><a href="#7-2-VPU" class="headerlink" title="7.2 VPU"></a>7.2 VPU</h2><p>   VPU(Video Processing Unitï¼Œè§†é¢‘å¤„ç†å•å…ƒï¼‰æ˜¯ä¸€ç§å…¨æ–°çš„è§†é¢‘å¤„ç†å¹³å°æ ¸å¿ƒå¼•æ“ï¼Œå…·æœ‰ç¡¬è§£ç åŠŸèƒ½ä»¥åŠå‡å°‘CPUè´Ÿè·çš„èƒ½åŠ›ã€‚VPUå¯ä»¥å‡å°‘æœåŠ¡å™¨è´Ÿè½½å’Œç½‘ç»œå¸¦å®½çš„æ¶ˆè€—ã€‚</p>
<p>â€‹    VPUç”±ATIæå‡ºï¼ŒåŒºåˆ«äºä¼ ç»ŸGPUï¼ˆGraph Process Unitï¼Œå›¾å½¢å¤„ç†å•å…ƒï¼‰ã€‚å›¾å½¢å¤„ç†å•å…ƒåˆåŒ…æ‹¬è§†é¢‘å¤„ç†å•å…ƒã€å¤–è§†é¢‘æ¨¡å—å’Œåå¤„ç†æ¨¡å—è¿™ä¸‰ä¸ªä¸»è¦æ¨¡å—ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150284.png" alt="img"></p>
<h3 id="7-2-1ã€VPUçš„åŸºç¡€ç‰¹æ€§"><a href="#7-2-1ã€VPUçš„åŸºç¡€ç‰¹æ€§" class="headerlink" title="7.2.1ã€VPUçš„åŸºç¡€ç‰¹æ€§"></a>7.2.1ã€VPUçš„åŸºç¡€ç‰¹æ€§</h3><p>â€‹    Aã€æ”¯æŒè§†é¢‘ç¼–è§£ç æ ‡å‡†ç±»åˆ«ä¸°å¯Œï¼Œå›¾åƒé«˜æ¸…ã€‚</p>
<p>â€‹    Bã€æ”¯æŒå¤šç§æŠ—è¯¯ç å·¥å…·ã€å¤šè§£ç å’Œå…¨åŒå·¥å¤šæ–¹é€šè¯åŒæ—¶è¿›è¡Œã€‚</p>
<p>â€‹    Cã€æä¾›äº†å¯ç¼–ç¨‹æ€§ã€æŸ”åˆæ€§ï¼Œä»¥åŠæ˜“äºå‡çº§çš„è§£ç å’Œç¼–ç æˆ–ä¸»æœºæ¥å£ï¼Œå› ä¸ºåœ¨ç¼–è§£ç å¤„ç†å’Œä¸»æ¥å£éƒ½å®ç°ä¸ºå¯ç¼–ç¨‹å¾®å¤„ç†ä¸­çš„å›ºä»¶ã€‚</p>
<h3 id="7-2-2ã€VPUç‰¹è‰²åŠåº”ç”¨"><a href="#7-2-2ã€VPUç‰¹è‰²åŠåº”ç”¨" class="headerlink" title="7.2.2ã€VPUç‰¹è‰²åŠåº”ç”¨"></a>7.2.2ã€VPUç‰¹è‰²åŠåº”ç”¨</h3><p>â€‹    VPUé’ˆå¯¹è§†è§‰å¤„ç†åº”ç”¨è€Œè®¾è®¡ï¼Œåœ¨æ€§èƒ½ã€åŠŸè€—å’ŒåŠŸèƒ½æ€§æ–¹é¢éƒ½æœ‰ç‰¹åˆ«çš„å¼ºåŒ–ï¼Œä½¿ä¹‹æ›´è´´è¿‘äºå®é™…çš„åº”ç”¨éœ€æ±‚ï¼Œå…¶è®¾è®¡å…¼é¡¾åˆ°å¤šç§ç”¨é€”ï¼Œä¸“é—¨ä¸ºè§†è§‰å¤„ç†è¿›è¡Œç¡¬ä»¶ç³»ç»Ÿçš„ä¼˜åŒ–ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150269.png" alt="img"></p>
<p>â€‹    VPUä¹Ÿæ˜¯SoCï¼Œé›†æˆå¤šä¸ªä¸»æ§RISCçš„CPUã€è®¸å¤šç¡¬ä»¶åŠ é€Ÿå™¨å•å…ƒå’ŒçŸ¢é‡å¤„ç†å™¨é˜µåˆ—ï¼Œä¸“é—¨ä¸ºè§†è§‰æµ·é‡åƒç´ è®¾è®¡çš„é«˜æ€§èƒ½å½±åƒä¿¡å·å¤„ç†å™¨(ISP)ï¼Œä»¥åŠä¸°å¯Œçš„é«˜é€Ÿå¤–å›´æ¥å£ã€‚</p>
<p>â€‹    ä¿è¯å¼ºå¤§æ€§èƒ½å’ŒåŠŸèƒ½çš„å‰æä¸‹ï¼ŒVPUé‡‡ç”¨æ›´å…ˆè¿›çš„é›†æˆç”µè·¯å·¥è‰ºï¼Œå¤§å¤§ç¼©å°äº†èŠ¯ç‰‡çš„å°ºå¯¸ï¼Œç»“åˆæœ‰æ•ˆçš„æŠ€æœ¯æ‰‹æ®µï¼Œé™ä½å„ä¸ªè¿ç®—å•å…ƒçš„åŠŸè€—ã€‚</p>
<p>â€‹    VPUä¸ºè§†è§‰åº”ç”¨æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„å¹³å°ï¼Œæ›´å¤šçš„å¼€å‘å·¥ä½œæ˜¯åœ¨è½¯ä»¶ä¸Šï¼ŒåŸºäºVPUçš„è§†è§‰åº”ç”¨ç³»ç»Ÿå¼€å‘å¯ä»¥å……åˆ†åˆ©ç”¨ç‰‡ä¸Šçš„ç¡¬ä»¶å•å…ƒåŠç›¸å…³çš„è½¯ä»¶èµ„æºã€‚</p>
<p>â€‹    åŒ…å«å·¥å…·ã€æ”¯æŒåº“åŠæ¡†æ¶çš„å®Œæ•´VPUè½¯ä»¶å¼€å‘å¥—ä»¶(SDK)ï¼Œè§†é¢‘å¤„ç†å™¨ä¸­æ¶‰åŠè§†è§‰å¤„ç†çš„å•å…ƒå¾—åˆ°äº†å¢å¼ºï¼Œå¦‚æ ¸å¿ƒè§†è§‰å¤„ç†å•å…ƒã€çº¿æ€§ä»£æ•°è¿ç®—çŸ©é˜µï¼Œè¿˜æœ‰å‰ç«¯å½±åƒå¤„ç†å•å…ƒï¼Œä¸ä»…åŒ…å«ISPå¤„ç†ï¼Œè¿˜æœ‰ISPä»¿çœŸï¼Œæ”¯æŒç›¸æœºè°ƒè¯•å·¥å…·ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150274.png" alt="img"></p>
<p>â€‹    å›¾å½¢å¤„ç†èƒ½åŠ›çš„æå‡è¡¨ç°åœ¨æ”¯æŒå›¾å½¢æ£€æµ‹APIï¼Œä¸ºä¾¿äºå¤šæ ¸å¼‚æ„èŠ¯ç‰‡å¼€å‘è€Œæ”¯æŒOpenCLã€‚ç”±äºåœ¨è§†è§‰åº”ç”¨ä¸­ï¼Œä¸é«˜æ•æ„Ÿåº¦å’Œè¶…é«˜åƒç´ çš„ä¼ æ„Ÿå™¨çš„æ¥é©³å°¤ä¸ºé‡è¦ï¼Œå› æ­¤ä¸“é—¨æœ‰ä¼ æ„Ÿå™¨æ”¯æŒæ¥å£å•å…ƒã€‚</p>
<p>â€‹    VPUç‰¹æœ‰çš„å·¥å…·å•å…ƒæä¾›è§†è§‰è°ƒè¯•å…¨é¢æ”¯æŒã€‚VPUä¸­çš„ä¸»æ§åˆ¶å™¨ã€BSPã€HDKç­‰é€šç”¨å•å…ƒä»¥å¼€æ”¾ä¸ºä¸»ï¼Œä¾¿äºå®¢æˆ·è¿›è¡Œæ›´å¤šåº”ç”¨å¼€å‘ã€‚</p>
<h3 id="7-2-3ã€Movidius"><a href="#7-2-3ã€Movidius" class="headerlink" title="7.2.3ã€Movidius"></a>7.2.3ã€Movidius</h3><p>â€‹    ä½œä¸ºä¸€ä¸ªè¡Œä¸šçš„å¹³å°é¢†å…ˆè€…éœ€è¦æœ‰è¶³å¤Ÿçš„ç§¯ç´¯å’Œä¸æ‡ˆçš„è¿›å–ï¼Œå½“ç„¶è¿˜è¦æœ‰å¼ºå¤§çš„è´¢åŠ›å’Œç‰©åŠ›ã€äººåŠ›çš„æ”¯æŒï¼ŒVPUå¹³å°çš„åˆ›å»ºå’Œå‘å±•ä¹Ÿç»ä¸è½»æ¾ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150303.png" alt="img"></p>
<p>â€‹    Movidiusåœ¨éƒ½æŸæ—æˆç«‹ï¼Œä½äºçˆ±å°”å…°ï¼Œåœ¨ç½—é©¬å°¼äºšï¼Œç¡…è°·å»ºç«‹ç ”å‘å›¢é˜Ÿã€‚å…¬å¸åˆ›å§‹äººå ªç§°åŠå¯¼ä½“å’Œå¤„ç†å™¨è¡Œä¸šçš„å…ƒè€ï¼Œå…¬å¸è®¾ç«‹æœ‰æŠ€æœ¯æŒ‡å¯¼å§”å‘˜ä¼šï¼Œç¡®ç«‹å…¬å¸çš„æŠ€æœ¯è·¯çº¿å’ŒVPUå¹³å°å‘å±•æ€»ä½“è§„åˆ’ã€‚</p>
<p>â€‹    Movidiusæ ¸å¿ƒç®¡ç†å±‚ï¼Œæ¥æºäºATIåŠå…¶å®ƒçŸ¥åå…¬å¸èµ„æ·±çš„é«˜ç®¡å’Œä¸“å®¶ã€‚å…¬å¸å‘˜å·¥æœªè¿‡ç™¾äººï¼Œç ”å‘äººå‘˜å äº†ä¹æˆï¼Œäº”åˆ†ä¹‹ä¸€è´Ÿè´£VPUèŠ¯ç‰‡ç¡¬ä»¶è®¾è®¡ï¼Œå…¶ä½™ä»äº‹VPUä¸Šè½¯ä»¶æ„å»ºï¼Œå¯è§VPUåº”ç”¨åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºè½¯ä»¶ã€‚2016å¹´ï¼ŒMovidiusè¢«intelæ”¶è´­ã€‚</p>
<h3 id="7-2-4ã€INTEL"><a href="#7-2-4ã€INTEL" class="headerlink" title="7.2.4ã€INTEL"></a>7.2.4ã€INTEL</h3><p>â€‹    2019å¹´ï¼Œè‹±ç‰¹å°”äººå·¥æ™ºèƒ½å³°ä¼šï¼ˆIntel AI Summit 2019ï¼‰ï¼Œè‹±ç‰¹å°”å±•ç¤ºäº†ä¸€ç³»åˆ—æ–°äº§å“ï¼Œæ—¨åœ¨åŠ é€Ÿä»äº‘ç«¯åˆ°è¾¹ç¼˜çš„äººå·¥æ™ºèƒ½ç³»ç»Ÿå¼€å‘å’Œéƒ¨ç½²ï¼Œè¿æ¥äººå·¥æ™ºèƒ½æµªæ½®çš„åˆ°æ¥ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150309.png" alt="img"></p>
<p>â€‹    è‹±ç‰¹å°”å±•ç¤ºäº†é¢å‘è®­ç»ƒ (NNP-T1000) å’Œé¢å‘æ¨ç† (NNP-I1000) çš„è‹±ç‰¹å°”Nervanaç¥ç»ç½‘ç»œå¤„ç†å™¨ (NNP)ã€‚ä½œä¸ºè‹±ç‰¹å°”ä¸ºäº‘ç«¯å’Œæ•°æ®ä¸­å¿ƒå®¢æˆ·æä¾›çš„é¦–ä¸ªé’ˆå¯¹å¤æ‚æ·±åº¦å­¦ä¹ çš„ä¸“ç”¨ ASICèŠ¯ç‰‡ï¼Œè‹±ç‰¹å°”Nervana NNPå…·å¤‡è¶…é«˜æ‰©å±•æ€§å’Œè¶…é«˜æ•ˆç‡ã€‚</p>
<p>â€‹    è‹±ç‰¹å°”è¿˜å‘å¸ƒäº†ä¸‹ä¸€ä»£è‹±ç‰¹å°”Movidius Myriadè§†è§‰å¤„ç†å•å…ƒ (VPU)ï¼Œç”¨äºè¾¹ç¼˜åª’ä½“ã€è®¡ç®—æœºè§†è§‰å’Œæ¨ç†åº”ç”¨ã€‚</p>
<h3 id="7-2-5ã€ä»£ç ç¤ºä¾‹"><a href="#7-2-5ã€ä»£ç ç¤ºä¾‹" class="headerlink" title="7.2.5ã€ä»£ç ç¤ºä¾‹"></a>7.2.5ã€ä»£ç ç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line"> * VPUCoder.h</span><br><span class="line"> *</span><br><span class="line"> * Current, Only Support YUV420sp encoder and decoder</span><br><span class="line"> *</span><br><span class="line"> *  Created on: Dec 16, 2013</span><br><span class="line"> *      Author: henry</span><br><span class="line"> *</span><br><span class="line"> *  Example:</span><br><span class="line"> *</span><br><span class="line"> *  int main()</span><br><span class="line"> *  &#123;</span><br><span class="line"> *  int ret = InitCodec();</span><br><span class="line"> *  //===========encode video</span><br><span class="line"> *  ret = StartEnc(&quot;/sdcard/test.mkv&quot;, 1280, 720, 30);</span><br><span class="line"> *</span><br><span class="line"> *  while(1)</span><br><span class="line"> *  &#123;</span><br><span class="line"> *         //get data and length, //unsigned char* data; int length</span><br><span class="line"> *         ret = ProcessEnc(data, length);</span><br><span class="line"> *  &#125;</span><br><span class="line"> *  ret = StopEnc();</span><br><span class="line"> *</span><br><span class="line"> *  //===========decode video</span><br><span class="line"> *  ret = ProcessDec(&quot;/sdcard/test.mkv&quot;, 1280, 720);</span><br><span class="line"> *  return 0;</span><br><span class="line"> *  &#125;</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#ifndef VPUCODER_H_</span><br><span class="line">#define VPUCODER_H_</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Init encoder and decoder handle, only call once, must first call</span><br><span class="line"> *</span><br><span class="line"> * @return 0 is successful, another fail</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">int InitCodec();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * setup encoder configure</span><br><span class="line"> * @param filePath   : save file path</span><br><span class="line"> * @param enc_width  : video width</span><br><span class="line"> * @param enc_height : video height</span><br><span class="line"> * @param enc_fps    : video fps</span><br><span class="line"> *</span><br><span class="line"> * @return 0 is successful, another fail</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">int StartEnc(const char* filePath, uint32_t enc_width, uint32_t enc_height, uint32_t enc_fps);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * stop encode video</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">void StopEnc();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @params data   : frame data</span><br><span class="line"> * @params length : frame length</span><br><span class="line"> *</span><br><span class="line"> * @return 0 is successful, another fail</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">int ProcessEnc(const unsigned char* data, uint32_t length);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * setup decoder configure</span><br><span class="line"> * @param filePath   : source file path</span><br><span class="line"> * @param enc_width  : video width</span><br><span class="line"> * @param enc_height : video height</span><br><span class="line"> *</span><br><span class="line"> * @return 0 is successful, another fail</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">int ProcessDec(const char* filePath, uint32_t dec_width, uint32_t dec_height);</span><br><span class="line">#endif /* VPUCODER_H_ */</span><br></pre></td></tr></table></figure>

<h3 id="7-2-6ã€æ€»ç»“"><a href="#7-2-6ã€æ€»ç»“" class="headerlink" title="7.2.6ã€æ€»ç»“"></a>7.2.6ã€æ€»ç»“</h3><p>â€‹    GPUçš„æ¦‚å¿µç”±NVIDIAå…¬å¸æå‡ºï¼ŒGPUè‹±æ–‡å…¨ç§° Graphic Processing Unitï¼Œä¸­æ–‡è¯‘ä¸ºâ€œå›¾å½¢å¤„ç†å™¨â€ã€‚</p>
<p>â€‹    VPUçš„æ¦‚å¿µç”±ATIå…¬å¸æå‡ºï¼ŒVPUè‹±æ–‡å…¨ç§° Visual Processing Unitï¼Œä¸­æ–‡è¯‘ä¸ºâ€œè§†è§‰å¤„ç†å™¨â€ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150391.png" alt="img"></p>
<p>â€‹    GPUä¸VPUå®é™…å‡ä¸ºæ˜¾ç¤ºå¤„ç†æ ¸å¿ƒï¼ŒGPUæä¾›äº†æ›´å¤šå›¾å½¢æ¥å£ï¼ŒVPUæä¾›äº†æ›´å¤šè§†é¢‘æ¥å£ã€‚2006å¹´ï¼ŒATIå…¬å¸è¢«AMDå…¬å¸æ”¶è´­ä¹‹åï¼Œå·²æ­£å¼é‡‡ç”¨GPUçš„åå­—ã€‚</p>
<p>â€‹    INTELçš„åŠ å…¥ï¼ŒVPUè¿‘äº›å¹´å–å¾—å·¨å¤§çš„å‘å±•ï¼Œç¤¾ä¼šå‘å±•ä¸­ï¼Œè§†é¢‘å¤„ç†æ„ˆæ¥æ„ˆé‡è¦ï¼ŒVPUé€‚åº”å®æ—¶æ½®æµï¼Œå°¤å…¶åœ¨åµŒå…¥å¼é¢†åŸŸåº”ç”¨å¹¿æ³›ã€‚</p>
<p>â€‹    ç¾æ‘„SDKï¼Œå›½é™…é¢†å…ˆçš„è§†é¢‘å¼•æ“ï¼Œä¼˜ç§€çš„è§†é¢‘è¿ç®—æ¶æ„ï¼Œå¼•é¢†çŸ­è§†é¢‘å‘å±•çš„æ–¹å‘ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150565.png" alt="img"></p>
<h2 id="7-3-APU"><a href="#7-3-APU" class="headerlink" title="7.3 APU"></a>7.3 APU</h2><p>APUæ˜¯â€œAccelerated Processing Unitsâ€çš„ç®€ç§°ï¼Œä¸­æ–‡åå­—å«åŠ é€Ÿå¤„ç†å™¨ï¼Œæ˜¯AMDèèšæœªæ¥ç†å¿µçš„äº§å“ï¼Œå®ƒç¬¬ä¸€æ¬¡å°†å¤„ç†å™¨å’Œç‹¬æ˜¾æ ¸å¿ƒåšåœ¨ä¸€ä¸ªæ™¶ç‰‡ä¸Šã€‚</p>
<p>â€‹    CPUä¸APUååŒè®¡ç®—ã€å½¼æ­¤åŠ é€Ÿï¼Œå…·æœ‰é«˜æ€§èƒ½å¤„ç†å™¨å’Œæœ€æ–°æ”¯æŒDX11ç‹¬ç«‹æ˜¾å¡çš„å¤„ç†æ€§èƒ½ï¼Œå¤§å¹…æå‡ç”µè„‘è¿è¡Œæ•ˆç‡ï¼Œå®ç°äº†CPUä¸GPUçœŸæ­£çš„èåˆã€‚APUæ˜¯å¤„ç†å™¨æœªæ¥å‘å±•çš„è¶‹åŠ¿ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150692.png" alt="img"></p>
<h3 id="7-3-1ã€AMDä¸APU"><a href="#7-3-1ã€AMDä¸APU" class="headerlink" title="7.3.1ã€AMDä¸APU"></a>7.3.1ã€AMDä¸APU</h3><p>â€‹    ä»APUå‘å±•æ¥çœ‹ï¼ŒAMDè®©CPUå’ŒGPUå½»åº•èä¸ºä¸€ä½“ï¼Œæ— è®ºæ˜¯AMDçš„Llanoï¼Œè¿˜æ˜¯Brazosï¼Œç›®æ ‡éƒ½æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>â€‹    AMDè®¤ä¸ºï¼ŒCPUå’ŒGPUçš„èåˆåˆ†ä¸ºå››æ­¥è¿›è¡Œï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150725.png" alt="img"></p>
<p>â€‹    ç¬¬ä¸€æ­¥ï¼šç‰©ç†æ•´åˆ(Physical Integration)ï¼Œå°†CPUå’ŒGPUé›†æˆåœ¨åŒä¸€å—ç¡…èŠ¯ç‰‡ä¸Šï¼Œåˆ©ç”¨é«˜å¸¦å®½çš„å†…éƒ¨æ€»çº¿é€šè®¯ï¼Œé›†æˆé«˜æ€§èƒ½çš„å†…å­˜æ§åˆ¶å™¨ï¼Œå€ŸåŠ©å¼€æ”¾çš„è½¯ä»¶ç³»ç»Ÿä¿ƒæˆå¼‚æ„è®¡ç®—ã€‚</p>
<p>â€‹    ç¬¬äºŒæ­¥ï¼šå¹³å°ä¼˜åŒ–(Optimized Platforms)ï¼ŒCPUå’ŒGPUä¹‹é—´äº’è¿æ¥å£è¿›ä¸€æ­¥å¢å¼ºï¼Œç»Ÿä¸€è¿›è¡ŒåŒå‘ç”µæºç®¡ç†ï¼ŒGPUæ”¯æŒé«˜çº§ç¼–ç¨‹è¯­è¨€ã€‚</p>
<p>â€‹    ç¬¬ä¸‰æ­¥ï¼šæ¶æ„æ•´åˆ(Architectural Integration)ï¼Œå®ç°ç»Ÿä¸€çš„CPU&#x2F;GPUå¯»å€ç©ºé—´ã€GPUä½¿ç”¨å¯åˆ†é¡µç³»ç»Ÿå†…å­˜ã€GPUç¡¬ä»¶å¯è°ƒåº¦ã€CPU&#x2F;GPU&#x2F;APUå†…å­˜ååŒä¸€è‡´ã€‚</p>
<p>â€‹    ç¬¬å››æ­¥ï¼šæ¶æ„å’Œç³»ç»Ÿæ•´åˆ(Architectural &amp; OS Integration)ï¼Œä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬GPUè®¡ç®—ç¯å¢ƒåˆ‡æ¢ã€GPUå›¾å½¢ä¼˜å…ˆè®¡ç®—ã€ç‹¬ç«‹æ˜¾å¡çš„PCI-EååŒã€ä»»åŠ¡å¹¶è¡Œè¿è¡Œå®æ—¶æ•´åˆç­‰ç­‰ã€‚</p>
<p>â€‹    AMD Fusionç³»åˆ—APUå°†å¤šæ ¸(x86)ä¸­å¤®å¤„ç†å™¨ã€æ”¯æŒDX11æ ‡å‡†çš„å¼ºå¤§ç‹¬ç«‹æ˜¾å¡æ€§èƒ½ä»¥åŠé«˜é€Ÿæ€»çº¿èåˆåœ¨ä¸€å—èŠ¯ç‰‡ä¸Šï¼Œæ‹¥æœ‰å¹¶è¡Œå¤„ç†å¼•æ“å’Œä¸“é—¨é«˜æ¸…è§†é¢‘åŠ é€Ÿæ¨¡å—ï¼Œå®ç°æ•°æ®åœ¨ä¸åŒå¤„ç†æ ¸å¿ƒé—´çš„åŠ é€Ÿä¼ é€’ã€‚</p>
<p>â€‹    åŸºäºAMD Fusion APUçš„å°å¼æœºã€ç¬”è®°æœ¬å’Œé«˜æ¸…è½»è–„æœ¬å·²ç»é”€å”®å¤šå¹´ã€‚åŸºäºAMD Fusion APUçš„å¹³æ¿ç”µè„‘å’ŒåµŒå…¥å¼ç”µè„‘æœ‰å¾ˆå¤šä¼˜ç‚¹ã€‚é«˜æ¸…è§†é¢‘æ’­æ”¾æ•ˆæœæµç•…ï¼Œæ»¡è¶³å¤šç§åº”ç”¨çš„çªç ´æ€§çš„è®¡ç®—èƒ½åŠ›ï¼Œå…¨é¢æ”¯æŒDXä»¥åŠå¼ºå¤§çš„ç”µæ± ç»­èˆªèƒ½åŠ›ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150720.png" alt="img"></p>
<p>â€‹    AMDé€šè¿‡å’Œå®ç¢ã€åç¡•ã€æˆ´å°”ã€å¯Œå£«é€šã€æƒ æ™®ã€è”æƒ³ã€å¾®æ˜Ÿã€ä¸‰æ˜Ÿã€ç´¢å°¼ã€ä¸œèŠç­‰é¢†å…ˆPCå‚å•†åˆä½œï¼Œåœ¨ç”µè„‘ä¸Šæ¨å‡ºåŸºäºAMD Fusion APUçš„æ–°å“ã€‚</p>
<p>AMDå…¬å¸é«˜çº§å‰¯æ€»è£Rick Bergmanè¡¨ç¤ºï¼šâ€œç®€è€Œè¨€ä¹‹ï¼Œæˆ‘è®¤ä¸ºAMD FusionåŠ é€Ÿå¤„ç†å™¨æ˜¯è‡ªä»x86æ¶æ„é—®ä¸–ä¹‹å40ä½™å¹´æ¥å¤„ç†å™¨é¢†åŸŸæœ€ä¼Ÿå¤§çš„è¿›æ­¥ã€‚é€šè¿‡è¿™ä¸€è·¨è¶Šï¼Œæˆ‘ä»¬è®©é¡¾å®¢èƒ½å¤Ÿéšæ—¶éšåœ°ä½“éªŒé«˜æ¸…è§†é¢‘ã€äº«å—    è¶…çº§ä¸ªäººè®¡ç®—ä½“éªŒï¼Œå¹¶ä¸”è®©ç¬”è®°æœ¬ç”µè„‘å…·å¤‡å…¨å¤©çš„ç”µæ± ç»­èˆªèƒ½åŠ›ã€‚è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„äº§å“ç³»åˆ—ï¼Œå…¨æ–°çš„è§†è§’ï¼Œç»™æ¶ˆè´¹è€…å¸¦æ¥å…¨æ–°çš„ç²¾å½©åº”ç”¨ä½“éªŒã€‚â€</p>
<h3 id="7-3-2ã€VISIONå¼•æ“"><a href="#7-3-2ã€VISIONå¼•æ“" class="headerlink" title="7.3.2ã€VISIONå¼•æ“"></a>7.3.2ã€VISIONå¼•æ“</h3><p>â€‹    éšç€ç¡¬ä»¶æŠ€æœ¯çš„è¿›æ­¥ï¼Œé«˜æ¸…è§†é¢‘çš„æ—¶ä»£åˆ°æ¥äº†ã€‚ä»YouTubeè§†é¢‘ç½‘ç«™åˆ°DirectX12ç”µè„‘æ¸¸æˆå†åˆ°è“å…‰ç¢Ÿç‰‡ï¼Œå¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚AMD VISIONå¼•æ“æ¨ªç©ºå‡ºä¸–ï¼Œä¸€ç³»åˆ—ä¸é«˜æ¸…è§†é¢‘ç›¸å…³çš„ç‹¬ç‰¹æ€§èƒ½å°†ä½¿åŸºäºAMD APUçš„ä¸ªäººç”µè„‘ä¸ºç”¨æˆ·å¸¦æ¥æ›´åŠ ç”ŸåŠ¨ä¸é€¼çœŸçš„é«˜æ¸…è§†é¢‘ä½“éªŒã€‚</p>
<p>â€‹    VISIONå¼•æ“æ±‡é›†äº†ä¸‹åˆ—åŠŸèƒ½ï¼š</p>
<ol>
<li>æ”¯æŒDirectX11æ ‡å‡†</li>
<li>å¼ºå¤§çš„å¹¶è¡Œå¤„ç†èƒ½åŠ›åŠ é€Ÿåº”ç”¨æ€§èƒ½æå‡</li>
<li>AMD Radeonâ„¢ HD 6800ç³»åˆ—æ˜¾å¡æ•´åˆUVD3è§†é¢‘åŠ é€Ÿæ¨¡å—</li>
<li>ç‹¬ç‰¹çš„å›¾å½¢é©±åŠ¨ç¨‹åºï¼Œæ¯æœˆæ›´æ–°ï¼Œä¸æ–­æé«˜è§†é¢‘æ€§èƒ½ã€‚</li>
</ol>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150709.png" alt="img"></p>
<p>â€‹    å¸¦æœ‰VISIONå¼•æ“æ ‡è¯†çš„ç”µè„‘ä»£è¡¨ç€æ›´å¼ºå¤§çš„æ€§èƒ½ã€‚æ›´æµç•…çš„ä¸Šç½‘ä½“éªŒï¼›åä¸½ã€æµç•…ã€å®‰é™çš„é«˜æ¸…è§†é¢‘æ’­æ”¾ï¼›ä½¿æ ‡æ¸…è§†é¢‘æ’­æ”¾å‡ºé«˜æ¸…æ•ˆæœï¼›å°†2Då†…å®¹è½¬æ¢æˆæ›´ç«‹ä½“çš„3Dæ ¼å¼ï¼›è½»æ¾é«˜æ¸…åº”ç”¨ï¼›ä¸ºç”¨æˆ·å¸¦æ¥3Dæ¸¸æˆä½“éªŒã€‚</p>
<p>â€‹    è¿ç®—ä½“éªŒä¸è½¯ä»¶å¯†ä¸å¯åˆ†ï¼Œå¼€å‘è€…å—åˆ°CPUå’ŒGPUå¤„ç†ä¿¡æ¯æ—¶å„è‡ªä¸ºæˆ˜è¿›è¡Œç‹¬ç«‹è®¡ç®—çš„åˆ¶çº¦ã€‚ä»Šå¤©ï¼ŒAMD Fusion APUæ¶ˆé™¤äº†è¿™ä¸€éšœç¢ï¼Œå¼€å‘è€…å¯ä»¥åˆ©ç”¨GPUçš„å¹¶è¡Œå¤„ç†èƒ½åŠ›ã€‚</p>
<p>â€‹    AMD FusionæŠ€æœ¯å…¨å¤©ç”µæ± ç»­èˆªèƒ½åŠ›ï¼Œç»­èˆªæ—¶é—´é•¿è¾¾10å°æ—¶ä»¥ä¸Šã€‚å•èŠ¯ç‰‡è®¾è®¡æ‰€å¸¦æ¥çš„èŠ‚ç”µæ•ˆæœè¶…è¿‡æˆ‘ä»¬çš„é¢„æ–™ã€‚</p>
<h3 id="7-3-3ã€APUæ–°å“"><a href="#7-3-3ã€APUæ–°å“" class="headerlink" title="7.3.3ã€APUæ–°å“"></a>7.3.3ã€APUæ–°å“</h3><p>â€‹    é”é¾™7 5700Gå¤„ç†å™¨é‡‡ç”¨Cezanneï¼ˆå¡å°šï¼‰æ ¸å¿ƒï¼Œä¸AMDè·¯çº¿å›¾ä¸­ä¸€è‡´ã€‚å…¶æœ€é«˜é¢‘ç‡å¤§çº¦ä¸º4.75GHzï¼Œä¸º8æ ¸16çº¿ç¨‹ï¼Œä¸‰çº§ç¼“å­˜ä¸º16MBï¼Œåªæœ‰â€œæ ‡å‡†ç‰ˆâ€çš„ä¸€åŠï¼ŒCPUæµ‹è¯•æˆç»©åˆ™ç»å¯¹æ˜¯é”é¾™5000çº§åˆ«çš„ï¼Œè½»æ¾å‹åˆ¶åä»£é…·ç¿å’Œè‡ªå®¶çš„é”é¾™3000ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150701.png" alt="img"></p>
<h3 id="7-3-4ã€APUç¼–ç¨‹"><a href="#7-3-4ã€APUç¼–ç¨‹" class="headerlink" title="7.3.4ã€APUç¼–ç¨‹"></a>7.3.4ã€APUç¼–ç¨‹</h3><p>â€‹    APUæ²¡æœ‰è®¾è®¡ç‹¬ç«‹çš„å¼€å‘ç¯å¢ƒï¼ŒAPUç›®å‰æ”¯æŒOpenCLä¸OpenGLã€DirectXç­‰ã€‚åœ¨å¹¶è¡Œç¼–ç¨‹é¢†åŸŸï¼Œä¸»è¦æ”¯æŒçš„æ˜¯OpenCLã€‚</p>
<p>   ä¸‹é¢æ˜¯OpenCLç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;fstream&gt;</span><br><span class="line">#include &lt;sstream&gt;</span><br><span class="line">#include &lt;CL/cl.h&gt;</span><br><span class="line"></span><br><span class="line">const int ARRAY_SIZE = 1000;</span><br><span class="line"></span><br><span class="line">//ä¸€ã€ é€‰æ‹©OpenCLå¹³å°å¹¶åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡</span><br><span class="line">cl_context CreateContext()</span><br><span class="line">&#123;</span><br><span class="line">       cl_int errNum;</span><br><span class="line">       cl_uint numPlatforms;</span><br><span class="line">       cl_platform_id firstPlatformId;</span><br><span class="line">       cl_context context = NULL;</span><br><span class="line"></span><br><span class="line">       //é€‰æ‹©å¯ç”¨çš„å¹³å°ä¸­çš„ç¬¬ä¸€ä¸ª</span><br><span class="line">       errNum = clGetPlatformIDs(1, &amp;firstPlatformId, &amp;numPlatforms);</span><br><span class="line">       if (errNum != CL_SUCCESS || numPlatforms &lt;= 0)</span><br><span class="line">       &#123;</span><br><span class="line">              std::cerr &lt;&lt; &quot;Failed to find any OpenCL platforms.&quot; &lt;&lt; std::endl;</span><br><span class="line">              return NULL;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       //åˆ›å»ºä¸€ä¸ªOpenCLä¸Šä¸‹æ–‡ç¯å¢ƒ</span><br><span class="line">       cl_context_properties contextProperties[] =</span><br><span class="line">       &#123;</span><br><span class="line">              CL_CONTEXT_PLATFORM,</span><br><span class="line">              (cl_context_properties)firstPlatformId,</span><br><span class="line">              0</span><br><span class="line">       &#125;;</span><br><span class="line"></span><br><span class="line">       context = clCreateContextFromType(contextProperties, CL_DEVICE_TYPE_GPU,</span><br><span class="line">              NULL, NULL, &amp;errNum);</span><br><span class="line"></span><br><span class="line">       return context;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//äºŒã€ åˆ›å»ºè®¾å¤‡å¹¶åˆ›å»ºå‘½ä»¤é˜Ÿåˆ—</span><br><span class="line">cl_command_queue CreateCommandQueue(cl_context context, cl_device_id *device)</span><br><span class="line">&#123;</span><br><span class="line">       cl_int errNum;</span><br><span class="line">       cl_device_id *devices;</span><br><span class="line">       cl_command_queue commandQueue = NULL;</span><br><span class="line">       size_t deviceBufferSize = -1;</span><br><span class="line">       // è·å–è®¾å¤‡ç¼“å†²åŒºå¤§å°</span><br><span class="line">       errNum = clGetContextInfo(context, CL_CONTEXT_DEVICES, 0, NULL, &amp;deviceBufferSize);</span><br><span class="line">       if (deviceBufferSize &lt;= 0)</span><br><span class="line">       &#123;</span><br><span class="line">              std::cerr &lt;&lt; &quot;No devices available.&quot;;</span><br><span class="line">              return NULL;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       // ä¸ºè®¾å¤‡åˆ†é…ç¼“å­˜ç©ºé—´</span><br><span class="line">       devices = new cl_device_id[deviceBufferSize / sizeof(cl_device_id)];</span><br><span class="line">       errNum = clGetContextInfo(context, CL_CONTEXT_DEVICES, deviceBufferSize, devices, NULL);</span><br><span class="line"></span><br><span class="line">       //é€‰å–å¯ç”¨è®¾å¤‡ä¸­çš„ç¬¬ä¸€ä¸ª</span><br><span class="line">       commandQueue = clCreateCommandQueue(context, devices[0], 0, NULL);</span><br><span class="line"></span><br><span class="line">       *device = devices[0];</span><br><span class="line">       delete[] devices;</span><br><span class="line">       return commandQueue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä¸‰ã€åˆ›å»ºå’Œæ„å»ºç¨‹åºå¯¹è±¡</span><br><span class="line">cl_program CreateProgram(cl_context context, cl_device_id device, const char* fileName)</span><br><span class="line">&#123;</span><br><span class="line">       cl_int errNum;</span><br><span class="line">       cl_program program;</span><br><span class="line"></span><br><span class="line">       std::ifstream kernelFile(fileName, std::ios::in);</span><br><span class="line">       if (!kernelFile.is_open())</span><br><span class="line">       &#123;</span><br><span class="line">              std::cerr &lt;&lt; &quot;Failed to open file for reading: &quot; &lt;&lt; fileName &lt;&lt; std::endl;</span><br><span class="line">              return NULL;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       std::ostringstream oss;</span><br><span class="line">       oss &lt;&lt; kernelFile.rdbuf();</span><br><span class="line">       std::string srcStdStr = oss.str();</span><br><span class="line">       const char *srcStr = srcStdStr.c_str();</span><br><span class="line">       program = clCreateProgramWithSource(context, 1,</span><br><span class="line">              (const char**)&amp;srcStr,</span><br><span class="line">              NULL, NULL);</span><br><span class="line"></span><br><span class="line">       errNum = clBuildProgram(program, 0, NULL, NULL, NULL, NULL);</span><br><span class="line">       return program;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//åˆ›å»ºå’Œæ„å»ºç¨‹åºå¯¹è±¡</span><br><span class="line">bool CreateMemObjects(cl_context context, cl_mem memObjects[3],</span><br><span class="line">       float *a, float *b)</span><br><span class="line">&#123;</span><br><span class="line">       memObjects[0] = clCreateBuffer(context, CL_MEM_READ_ONLY | CL_MEM_COPY_HOST_PTR,</span><br><span class="line">              sizeof(float) * ARRAY_SIZE, a, NULL);</span><br><span class="line">       memObjects[1] = clCreateBuffer(context, CL_MEM_READ_ONLY | CL_MEM_COPY_HOST_PTR,</span><br><span class="line">              sizeof(float) * ARRAY_SIZE, b, NULL);</span><br><span class="line">       memObjects[2] = clCreateBuffer(context, CL_MEM_READ_WRITE,</span><br><span class="line">              sizeof(float) * ARRAY_SIZE, NULL, NULL);</span><br><span class="line">       return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// é‡Šæ”¾OpenCLèµ„æº</span><br><span class="line">void Cleanup(cl_context context, cl_command_queue commandQueue,</span><br><span class="line">       cl_program program, cl_kernel kernel, cl_mem memObjects[3])</span><br><span class="line">&#123;</span><br><span class="line">       for (int i = 0; i &lt; 3; i++)</span><br><span class="line">       &#123;</span><br><span class="line">              if (memObjects[i] != 0)</span><br><span class="line">                     clReleaseMemObject(memObjects[i]);</span><br><span class="line">       &#125;</span><br><span class="line">       if (commandQueue != 0)</span><br><span class="line">              clReleaseCommandQueue(commandQueue);</span><br><span class="line"></span><br><span class="line">       if (kernel != 0)</span><br><span class="line">              clReleaseKernel(kernel);</span><br><span class="line">       if (program != 0)</span><br><span class="line">              clReleaseProgram(program);</span><br><span class="line">       if (context != 0)</span><br><span class="line">              clReleaseContext(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char** argv)</span><br><span class="line">&#123;</span><br><span class="line">       cl_context context = 0;</span><br><span class="line">       cl_command_queue commandQueue = 0;</span><br><span class="line">       cl_program program = 0;</span><br><span class="line">       cl_device_id device = 0;</span><br><span class="line">       cl_kernel kernel = 0;</span><br><span class="line">       cl_mem memObjects[3] = &#123; 0, 0, 0 &#125;;</span><br><span class="line">       cl_int errNum;</span><br><span class="line"></span><br><span class="line">       // ä¸€ã€é€‰æ‹©OpenCLå¹³å°å¹¶åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡</span><br><span class="line">       context = CreateContext();</span><br><span class="line"></span><br><span class="line">       // äºŒã€ åˆ›å»ºè®¾å¤‡å¹¶åˆ›å»ºå‘½ä»¤é˜Ÿåˆ—</span><br><span class="line">       commandQueue = CreateCommandQueue(context, &amp;device);</span><br><span class="line"></span><br><span class="line">       //åˆ›å»ºå’Œæ„å»ºç¨‹åºå¯¹è±¡</span><br><span class="line">       program = CreateProgram(context, device, &quot;HelloWorld.cl&quot;);</span><br><span class="line"></span><br><span class="line">       // å››ã€ åˆ›å»ºOpenCLå†…æ ¸å¹¶åˆ†é…å†…å­˜ç©ºé—´</span><br><span class="line">       kernel = clCreateKernel(program, &quot;hello_kernel&quot;, NULL);</span><br><span class="line"></span><br><span class="line">       //åˆ›å»ºè¦å¤„ç†çš„æ•°æ®</span><br><span class="line">       float result[ARRAY_SIZE];</span><br><span class="line">       float a[ARRAY_SIZE];</span><br><span class="line">       float b[ARRAY_SIZE];</span><br><span class="line">       for (int i = 0; i &lt; ARRAY_SIZE; i++)</span><br><span class="line">       &#123;</span><br><span class="line">              a[i] = (float)i;</span><br><span class="line">              b[i] = (float)(ARRAY_SIZE - i);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       //åˆ›å»ºå†…å­˜å¯¹è±¡</span><br><span class="line">       if (!CreateMemObjects(context, memObjects, a, b))</span><br><span class="line">       &#123;</span><br><span class="line">              Cleanup(context, commandQueue, program, kernel, memObjects);</span><br><span class="line">              return 1;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       // äº”ã€ è®¾ç½®å†…æ ¸æ•°æ®å¹¶æ‰§è¡Œå†…æ ¸</span><br><span class="line">       errNum = clSetKernelArg(kernel, 0, sizeof(cl_mem), &amp;memObjects[0]);</span><br><span class="line">       errNum |= clSetKernelArg(kernel, 1, sizeof(cl_mem), &amp;memObjects[1]);</span><br><span class="line">       errNum |= clSetKernelArg(kernel, 2, sizeof(cl_mem), &amp;memObjects[2]);</span><br><span class="line"></span><br><span class="line">       size_t globalWorkSize[1] = &#123; ARRAY_SIZE &#125;;</span><br><span class="line">       size_t localWorkSize[1] = &#123; 1 &#125;;</span><br><span class="line"></span><br><span class="line">       errNum = clEnqueueNDRangeKernel(commandQueue, kernel, 1, NULL,</span><br><span class="line">              globalWorkSize, localWorkSize,</span><br><span class="line">              0, NULL, NULL);</span><br><span class="line"></span><br><span class="line">       // å…­ã€ è¯»å–æ‰§è¡Œç»“æœå¹¶é‡Šæ”¾OpenCLèµ„æº</span><br><span class="line">       errNum = clEnqueueReadBuffer(commandQueue, memObjects[2], CL_TRUE,</span><br><span class="line">              0, ARRAY_SIZE * sizeof(float), result,</span><br><span class="line">              0, NULL, NULL);</span><br><span class="line"></span><br><span class="line">       for (int i = 0; i &lt; ARRAY_SIZE; i++)</span><br><span class="line">       &#123;</span><br><span class="line">              std::cout &lt;&lt; result[i] &lt;&lt; &quot; &quot;;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       std::cout &lt;&lt; std::endl;</span><br><span class="line">       std::cout &lt;&lt; &quot;Executed program succesfully.&quot; &lt;&lt; std::endl;</span><br><span class="line">       getchar();</span><br><span class="line">       Cleanup(context, commandQueue, program, kernel, memObjects);</span><br><span class="line"></span><br><span class="line">       return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-5ã€æ€»ç»“"><a href="#7-3-5ã€æ€»ç»“" class="headerlink" title="7.3.5ã€æ€»ç»“"></a>7.3.5ã€æ€»ç»“</h3><p>â€‹    APUçš„æˆåŠŸï¼Œå·©å›ºäº†AMDçš„å¸‚åœºï¼Œå’ŒINTELå½¢æˆæœ‰åŠ›çš„ç«äº‰ã€‚æ¨åŠ¨å¤„ç†å™¨æŠ€æœ¯ã€æ¶æ„æŠ€æœ¯ã€å¹¶è¡Œè®¡ç®—æŠ€æœ¯çš„å‘å±•ã€‚å¤šå¹´ä»¥æ¥ï¼ŒINTELåŠæ‰“AMDï¼ŒAPUçš„å‡ºç°ï¼Œè¿™ä¸€å±€é¢å¾—åˆ°æ”¹å˜ã€‚</p>
<p>â€‹    å¹¶è¡Œè®¡ç®—é¢†åŸŸï¼ŒAPUä¸»è¦æ”¯æŒOpenCLæŠ€æœ¯ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼ŒOpenCLæŠ€æœ¯å°†ä¸æ–­å®Œå–„ï¼Œé©±åŠ¨å°†ä¸æ–­æ›´æ–°ã€‚</p>
<p>â€‹    AMDæœ‰ç€å…‰è¾‰çš„è¿‡å»ï¼Œä¹Ÿåº”è¯¥æœ‰ç€è¾‰ç…Œçš„æ˜å¤©ã€‚ä¸ºå¤„ç†å™¨çš„å‘å±•åšå‡ºäº†å“è¶Šçš„è´¡çŒ®ã€‚å›¾ä¸ºå°æ¹¾ç±AMDæ€»è£è‹å§¿ä¸°å¥³å£«ã€‚è‹±ä¼Ÿè¾¾çš„é»„ä»å‹‹ä¸ºè‹å§¿ä¸°çš„èˆ…èˆ…ã€‚åœ¨èŠ¯ç‰‡é¢†åŸŸï¼Œå°ç±åäººæœ‰ç€å“è¶Šçš„è´¡çŒ®ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150730.png" alt="img"></p>
<h2 id="7-4-gpgpu"><a href="#7-4-gpgpu" class="headerlink" title="7.4 gpgpu"></a>7.4 gpgpu</h2><p>  é€šç”¨å›¾å½¢å¤„ç†å™¨ï¼ˆGeneral-purpose computing on graphics processing unitsï¼Œç®€ç§°GPGPUï¼‰ï¼Œåˆ©ç”¨å¤„ç†å›¾å½¢ä»»åŠ¡çš„å›¾å½¢å¤„ç†å™¨æ¥è®¡ç®—åŸæœ¬ç”±ä¸­å¤®å¤„ç†å™¨å¤„ç†çš„é€šç”¨è®¡ç®—ä»»åŠ¡ã€‚è¿™äº›é€šç”¨è®¡ç®—ä¸å›¾å½¢å¤„ç†æ²¡æœ‰å…³ç³»ã€‚</p>
<p>â€‹    ç°ä»£å›¾å½¢å¤„ç†å™¨æœ‰å¼ºå¤§çš„å¹¶è¡Œå¤„ç†èƒ½åŠ›å’Œå¯ç¼–ç¨‹æµæ°´çº¿ï¼Œæµå¤„ç†å™¨å¯ä»¥å¤„ç†éå›¾å½¢æ•°æ®ã€‚åœ¨é¢å¯¹å•æŒ‡ä»¤æµå¤šæ•°æ®æµï¼ˆSIMDï¼‰ï¼Œä¸”æ•°æ®å¤„ç†çš„è¿ç®—é‡è¿œå¤§äºæ•°æ®è°ƒåº¦å’Œä¼ è¾“çš„éœ€è¦æ—¶ï¼Œé€šç”¨å›¾å½¢å¤„ç†å™¨åœ¨æ€§èƒ½ä¸Šå¤§å¤§è¶…è¶Šäº†ä¼ ç»Ÿçš„ä¸­å¤®å¤„ç†å™¨åº”ç”¨ç¨‹åºã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150945.png" alt="img"></p>
<h3 id="7-4-1ã€ä¸»è¦åŠŸèƒ½"><a href="#7-4-1ã€ä¸»è¦åŠŸèƒ½" class="headerlink" title="7.4.1ã€ä¸»è¦åŠŸèƒ½"></a>7.4.1ã€ä¸»è¦åŠŸèƒ½</h3><p>â€‹    é€šç”¨å›¾å½¢å¤„ç†å™¨æ˜¯è¿‘å¹´æ¥å‡ºç°çš„è®¡ç®—æœºèŠ¯ç‰‡ï¼Œåœ¨èˆªç©ºèˆªå¤©åŠé˜²åŠ¡åº”ç”¨ä¸­çš„é«˜æ€§èƒ½åµŒå…¥å¼è®¡ç®—ä¸­å¹¿æ³›åº”ç”¨ã€‚å‰ä¸€ä¸ªåå¹´é‡Œä½œä¸ºé«˜ç«¯è®¡ç®—æœºæ¸¸æˆçš„å›¾å½¢å¤„ç†å¼•æ“å¼•å…¥ï¼Œæ˜¯ä¸€ç§å¤§è§„æ¨¡å¹¶è¡Œå¤„ç†å™¨ã€‚ä¸ä»…æœ‰åŠ©äºå¤æ‚çš„æµ®ç‚¹è®¡ç®—ï¼Œè€Œä¸”å®¹æ˜“ç¼–ç¨‹ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150014.png" alt="img"></p>
<p>â€‹    é€šç”¨å›¾å½¢å¤„ç†å™¨èŠ¯ç‰‡çš„ä¸»è¦è®¾è®¡åˆ¶é€ å•†ï¼šåŠ åˆ©ç¦å°¼äºšå·åœ£å…‹æ‹‰æ‹‰çš„NVIDIAå…¬å¸å’ŒåŠ åˆ©ç¦äºšå·æ¡‘å°¼ç»´å°”çš„å…ˆè¿›å¾®å‹å™¨ä»¶å…¬å¸ï¼ˆAMDå…¬å¸ï¼‰ã€‚</p>
<h3 id="7-4-2ã€è®¾è®¡ä¼˜åŠ¿"><a href="#7-4-2ã€è®¾è®¡ä¼˜åŠ¿" class="headerlink" title="7.4.2ã€è®¾è®¡ä¼˜åŠ¿"></a>7.4.2ã€è®¾è®¡ä¼˜åŠ¿</h3><p>â€‹    é€šç”¨å›¾å½¢å¤„ç†å™¨å¹¿æ³›ä½¿ç”¨ï¼Œå…¶è®¾è®¡æ”¯æŒï¼šåŒ…æ‹¬â€œå¼€æ”¾æ€§å›¾å½¢åº“â€ï¼ˆOpen Graphics Libraryï¼Œ OpenGLï¼‰è¯­è¨€ã€NVIDIAå…¬å¸åˆ›é€ çš„å¹¶è¡Œå¤„ç†ç¼–ç¨‹è¯­è¨€CUDAã€æœ€è¿‘å‡ºç°çš„â€œå¼€æ”¾æ€§è®¡ç®—è¯­è¨€â€ï¼ˆ Open Computing Languageï¼Œ OpenCLï¼‰ã€‚ç¡¬ä»¶å¹³å°çš„æ”¯æŒä¸ºè½¯ä»¶å¼€å‘æä¾›äº†ä¾¿åˆ©ã€‚</p>
<p>â€‹    ä¸‹å›¾æ˜¯ä¸­å›½å¤©æ ‘ä¹‹æ–°æ¨å‡ºçš„æœ€æ–°7NM GPGPUã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150926.png" alt="img"></p>
<p>â€‹    åœ¨OpenGLï¼ŒCUDAå’ŒOpenCLç¼–ç¨‹æŠ€æœ¯å‡ºç°ä¹‹å‰ï¼Œå¤§è§„æ¨¡å¹¶è¡Œå¤„ç†çš„ç¼–ç¨‹æ˜¯ä¸€é¡¹å›°éš¾çš„ä»»åŠ¡ï¼Œä¸ºæ•°ä¸å¤šçš„ä¸“å®¶é‡‡ç”¨æå…¶ç¥ç§˜(å°ä¼—ç¼–ç¨‹)è¯­è¨€æ‰èƒ½å¤Ÿå®Œæˆã€‚æ–°å‡ºç°çš„è½¯ä»¶ç¼–ç¨‹æ¡†æ¶ï¼Œå°¤å…¶æ˜¯OpenCLæœ‰åŠ©äºç†Ÿæ‚‰Cè¯­è¨€å’ŒC++è¯­è¨€çš„ç¨‹åºç¼–åˆ¶äººå‘˜æ¥å—é€šç”¨å›¾å½¢å¤„ç†å™¨æŠ€æœ¯ã€‚</p>
<p>â€‹    é€šç”¨å›¾å½¢å¤„ç†å™¨ä¸­ï¼Œå¤šä¸ªå¤„ç†æ ¸è§„åˆ™æ’åˆ—åœ¨ä¸€èµ·ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå™¨ä»¶ä¸­å¤„ç†æ ¸çš„æ•°é‡ä¼šè¶Šæ¥è¶Šå¤šï¼Œé€šç”¨å›¾å½¢å¤„ç†å™¨çš„è½¯ä»¶æ²¡æœ‰å¿…è¦éšç€å¤„ç†å™¨æ ¸æ•°é‡çš„å¢åŠ è€Œé‡æ–°ç¼–å†™ã€‚éœ€è¦æœ‰è¾ƒå¥½çš„ç¼–ç¨‹æ”¯æŒã€‚è½¯ä»¶æ¡†æ¶åº”è¯¥é€‚åº”ç¡¬ä»¶è®¾è®¡çš„æ”¹å˜ã€‚</p>
<h3 id="7-4-3ã€æŠ€æœ¯åŸç†"><a href="#7-4-3ã€æŠ€æœ¯åŸç†" class="headerlink" title="7.4.3ã€æŠ€æœ¯åŸç†"></a>7.4.3ã€æŠ€æœ¯åŸç†</h3><p>â€‹    å¯Œå…°å…‹æ—è¯´ï¼Œé€šç”¨å›¾å½¢å¤„ç†å™¨å¯ä»¥ç”¨æ¥è§£æäº‹ç‰©ä»¥å¾—åˆ°å¯åˆ©ç”¨çš„ä¿¡æ¯ï¼Œä¼ é€’å‘¨å›´ç¯å¢ƒä¸­çš„æœ‰ç”¨ææ–™ã€‚é€šç”¨å›¾å½¢å¤„ç†å™¨æ‰€æ“…é•¿çš„æ˜¯å®Œæˆä¸¤æ–¹é¢çš„å·¥ä½œï¼Œä¸€æ˜¯è¡¨ç°äº‹ç‰©ï¼ŒäºŒæ˜¯è§£æäº‹ç‰©ã€‚</p>
<p>â€‹    é€šç”¨å›¾å½¢å¤„ç†å™¨èŠ¯ç‰‡çš„åº”ç”¨é¢†åŸŸä»å•ä¸€çš„å›¾å½¢å¤„ç†è£…ç½®æ‰©å±•åˆ°äº†ä¿¡å·å¤„ç†è£…ç½®ï¼Œé€šç”¨å›¾å½¢å¤„ç†å™¨çš„è½¯ä»¶ç¼–ç¨‹è¯­è¨€ä¹Ÿåœ¨å‘ç€ä¿¡å·å¤„ç†å’Œé€šç”¨å¤„ç†æ‰©å±•ã€‚ç±»ä¼¼äºâ€œå¼€æ”¾æ€§å›¾å½¢åº“â€ï¼ˆOpenGLï¼‰é‚£æ ·çš„å›¾å½¢å¤„ç†è¯­è¨€å°±å¯ä»¥ç”¨äºé€šç”¨å¤„ç†ã€‚</p>
<p>â€‹    é€šç”¨è®¡ç®—æŠ€æœ¯ï¼Œè®©æ˜¾å¡å‚ä¸åŸæœ¬CPUè®¡ç®—ä»»åŠ¡çš„æŠ€æœ¯ï¼Œä»æå‡ºåˆ°ç°åœ¨åä½™å¹´æ—¶é—´ï¼Œä½†æ˜¯å‘å±•ç¥é€Ÿã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150899.png" alt="img"></p>
<p>â€‹    åå¹´å‰ï¼Œé«˜æ¸…è§†é¢‘åˆšæµè¡Œæ—¶ï¼Œç¼–ç é«˜æ¸…è§†é¢‘å¯¹äºç”µè„‘æ¥è¯´ï¼Œå¤„ç†éå¸¸å›°éš¾ã€‚è§†é¢‘ç¼–ç è¿‡ç¨‹ä¸­ï¼Œå¤§éƒ¨åˆ†è¿ç®—éƒ½æ˜¯æµ®ç‚¹ç±»å‹çš„ï¼ŒCPUä¸å–„äºåšè¿™ç§è¿ç®—ï¼ŒGPUå¯¹äºè¿™ç§ç±»å‹çš„è®¡ç®—ç›¸å½“æ‹¿æ‰‹ï¼Œè®¡ç®—èµ·æ¥é‡åˆå¤§åˆå¿«ï¼Œé‚£ä¸ªå¹´ä»£äººä»¬åœ¨æ€ç´¢ï¼Œèƒ½å¦ç”¨GPUæ¥ç¼–ç é«˜æ¸…è§†é¢‘ã€‚</p>
<p>â€‹    å½“æ—¶ä¸šç•Œçš„ç ”ç©¶é‡ç‚¹è½¬å‘äº†GPGPUï¼Œè‹±ä¼Ÿè¾¾å‡­å€Ÿç€å¼ºå¤§çš„æŠ€æœ¯å®åŠ›ï¼Œåœ¨ç¡¬ä»¶ä¸è®¡ç®—æœºå¹³å°é¢†åŸŸã€‚è‹±ä¼Ÿè¾¾ç¬¬ä¸€ä¸ªæ¨å‡ºäº†ä¸€å¥—æ¯”è¾ƒå®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œå°†åŸæœ¬CPUçš„è¿ç®—æ¬åˆ°äº†GPUä¹‹ä¸Šï¼Œè§†é¢‘ç¼–ç é€Ÿåº¦æ¯”åŸå…ˆå¿«äº†å‡ å€ã€‚</p>
<p>â€‹    CPUæœ‰ç€é€šç”¨æ€§çš„éœ€æ±‚ï¼Œå®ƒä¸Šé¢å•ä¸ªæ ¸å¿ƒä¼šè®¾è®¡çš„éå¸¸å¤§è€Œå…¨é¢ï¼Œå¹¶ä¸”ç”±äºCPUè®¡ç®—çš„ç‰¹æ€§ï¼Œæ ¸å¿ƒä¸­å¾ˆå¤§ä¸€éƒ¨åˆ†é¢ç§¯ç”¨æ¥æ„å»ºç¼“å­˜ï¼ˆä¸€ä¸ªæ ¸å¿ƒä¸­å¾€å¾€æœ‰L1å’ŒL2ä¸¤çº§ç¼“å­˜ï¼‰å’Œæ§åˆ¶å•å…ƒï¼ˆè§£ç å™¨ä¸åˆ†æ”¯é¢„æµ‹ç­‰å‰ç«¯å•å…ƒï¼‰ã€‚CPUåŠŸèƒ½çš„å¼ºå¤§ï¼Œä»£è¡¨ç€CPUæœ¬èº«ä½“é‡çš„å¤§ï¼Œå°¤å…¶å¯¹äºç¼“å­˜çš„é›†ä¸­ã€‚</p>
<p>â€‹    å®é™…ç”¨æ¥è¿ç®—çš„å•å…ƒé¢ç§¯å¯èƒ½ä»…ä»…åªå æ•´ä¸ªæ ¸å¿ƒçš„ä¸€åŠç”šè‡³ä¸åˆ°ï¼ˆå¦‚å›¾ï¼‰ã€‚ç§ç§åŸå› ä½¿CPUæ²¡æœ‰åŠæ³•åšéå¸¸å¤§çš„è§„æ¨¡ï¼Œä¸€ä¸ªæ ¸å¿ƒä¸­èƒ½å¡å…¥çš„ä¸œè¥¿æœ‰é™ï¼Œæ€»ä½“çš„æ ¸å¿ƒæ•°éœ€è¦æ§åˆ¶åœ¨ä¸€ä¸ªåˆç†èŒƒå›´ä¸­ï¼Œå¤šäº†å°±ä¼šå‘ç”Ÿå„ç§é—®é¢˜ã€‚ç¡¬ä»¶é›†æˆæ˜¯å¾ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œå½“å·¥è‰ºæ²¡æœ‰è¶³å¤Ÿè¿›æ­¥çš„æ—¶é—´ï¼Œé›†æˆå‘å±•çš„å¤§é—¨å°±å…³é—­äº†ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150043.png" alt="img"></p>
<p>â€‹    å…«æ ¸Coffee Lakeçš„æ ¸å¿ƒå›¾ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå››ä¸ªæ ¸å¿ƒçš„é¢ç§¯å·²ç»æ¥è¿‘å³è¾¹çš„é›†æˆGPUã€‚è€ŒGPUçš„è®¾è®¡ç†å¿µå°±ç®€å•å¾ˆå¤šï¼Œå›¾å½¢è®¡ç®—æ˜¯ä¸€é¡¹ç®€å•ç›´æ¥çš„â€œç²—æ´»â€ï¼Œç›¸å¯¹å•è°ƒç›´æ¥ã€‚å¤æ‚åº¦è¿œä¸å¦‚CPUè¦è´Ÿè´£çš„å„ç§å„æ ·ä¸åŒç±»å‹çš„å·¥ä½œï¼Œå½“å¹´æƒ³è¦æé«˜å›¾å½¢è®¡ç®—é€Ÿåº¦çš„ä¸€ä¸ªç®€å•åŠæ³•å°±æ˜¯æ‰©å¤§å¤„ç†å™¨ä¸­å«æœ‰çš„å•å…ƒæ•°é‡ã€‚</p>
<p>â€‹    GPUå¯¹äºç‰¹å®šçš„è®¡ç®—ä»»åŠ¡ï¼Œæœ‰æ›´å¤§çš„è®¡ç®—å•å…ƒï¼Œåœ¨è¿ç®—èƒ½åŠ›ä¸Šè¿œè¶…CPUï¼Œè¡¨ç°å‡ºæ¥å°±æ˜¯ç°åœ¨çš„GPUåœ¨æµ®ç‚¹è¿ç®—ååé‡ä¸Šè¿œè¶…CPUã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150923.png" alt="img"></p>
<p>â€‹    CPUä¸GPUåœ¨æ„é€ ä¸Šçš„ä¸åŒ</p>
<p>â€‹    GPUé€‚åˆå¤§æ‰¹é‡ç‰¹å®šè®¡ç®—ï¼Œå°¤å…¶æ˜¯å¹¶è¡Œè®¡ç®—ï¼Œå‡ å¤§å›¾å½¢è½¯ç¡¬ä»¶å‚å•†éƒ½æ¨å‡ºäº†è‡ªå·±çš„GPGPUè®¡ç®—è§£å†³æ–¹æ¡ˆï¼Œä¸‹é¢ä¸»é¢˜è¿›è¡Œä»‹ç»ã€‚</p>
<h3 id="7-4-4ã€æ”¯æŒæ–¹"><a href="#7-4-4ã€æ”¯æŒæ–¹" class="headerlink" title="7.4.4ã€æ”¯æŒæ–¹"></a>7.4.4ã€æ”¯æŒæ–¹</h3><h4 id="7-4-4-1ã€ATI-Stream"><a href="#7-4-4-1ã€ATI-Stream" class="headerlink" title="7.4.4.1ã€ATI Stream"></a>7.4.4.1ã€ATI Stream</h4><p>â€‹    é¦–å…ˆæå‡ºGPGPUå®ç°çš„å‚å•†æ˜¯è¢«AMDæ”¶è´­å‰çš„ATIï¼Œå¹¶ä¸“é—¨æä¾›äº†ä¸€å¥—å¼€å‘å·¥å…·åŒ…ï¼ˆSDKï¼‰ï¼Œè®©ç¨‹åºå‘˜ç”¨è¯¥å¥—å·¥å…·è°ƒç”¨GPUæ¥å‚ä¸è®¡ç®—çš„èƒ½åŠ›ã€‚ä¸è¿‡ç”±äºå„ç§é™åˆ¶å’ŒAMDæ”¶è´­ATIåæ”¯æŒä¸è¶³ï¼Œå½“æ—¶ç®¡ç†ä¹Ÿæ¯”è¾ƒæ··ä¹±ï¼Œè¿™å¥—SDKåœ¨ä¸Nvidia CUDAçš„ç«äº‰ä¸­å¤„äºä¸‹é£ï¼Œåæ¥AMDå®˜æ–¹è½¬å‘æ”¯æŒ    OpenCLï¼Œè¿™å¥—SDKæœ€ç»ˆåœæ­¢äº†å¼€å‘ã€‚ä»Šå¤©å¾ˆå°‘æœ‰äººå¬åˆ°è¿™å¥—å¹¶è¡Œè®¡ç®—æ¡†æ¶</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150205.png" alt="img"></p>
<p>â€‹    ATI Stream Logo</p>
<h4 id="7-4-4-2ã€CUDA"><a href="#7-4-4-2ã€CUDA" class="headerlink" title="7.4.4.2ã€CUDA"></a>7.4.4.2ã€CUDA</h4><p>â€‹    CUDAæ˜¯Nvidiaåœ¨G80æ—¶ä»£æ¨å‡ºçš„ä¸€é¡¹æŠ€æœ¯ï¼Œä¹Ÿæ˜¯ä»Šå¤©æœ€æµè¡Œçš„æŠ€æœ¯ã€‚å…¨ç§°Compute Unified Device Architechtureï¼Œç»Ÿä¸€è®¡ç®—æ¶æ„ã€‚ä»G80æ ¸å¿ƒå¼€å§‹ï¼ŒNvidiaç‡å…ˆé‡‡ç”¨äº†ä¸€ç§ç»Ÿä¸€è®¾è®¡çš„æ¶æ„ï¼Œå°†åŸæœ¬ç®¡çº¿åˆ†å·¥å¼è®¾è®¡è½¬å˜ä¸ºç»Ÿä¸€åŒ–çš„å¤„ç†å™¨è®¾è®¡ã€‚</p>
<p>â€‹    CUDAä¼´éšç€G80æ ¸å¿ƒçš„å‘å¸ƒä¸€èµ·å…¬ä¹‹äºä¼—ï¼Œè®©ç¨‹åºå‘˜ç”¨Cå’ŒC++æ¥ç¼–å†™ç”¨GPUè¿è¡Œçš„ç¨‹åºï¼Œå­¦ä¹ æˆæœ¬æ¯”ATI Streamè¦ä½ä¸€äº›ã€‚ä»Šå¤©åœ¨å¹¶è¡Œè®¡ç®—é›†ç¾¤é¢†åŸŸï¼ŒCUDAæœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚ä¾‹å¦‚TensorFlowå’Œå„ç§éŸ³è§†é¢‘å¼•æ“å¹³å°ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150197.png" alt="img"></p>
<p>â€‹    Nvidia CUDA Logo</p>
<p>â€‹    CUDAæ˜¯ç›®å‰åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§GPGPUå®ç°ï¼Œ Nvidiaçš„å¼ºåŠ›æ¨å¹¿ä¹‹ä¸‹ï¼ŒCUDAåœ¨è®¸å¤šé¢†åŸŸå¤§æ”¾å¼‚å½©ï¼Œä»Šå¤©æ‹¥æœ‰æœ€å…‰å¤§çš„å¸‚åœºã€‚è‹±ä¼Ÿè¾¾æ›¾ç»è®¾è®¡è¿‡æ— æ•°æˆåŠŸçš„ç¡¬ä»¶ï¼ŒCUDAå¯ä»¥è¯´æ˜¯è‹±ä¼Ÿè¾¾è®¾è®¡çš„æœ€æˆåŠŸçš„å¹¶è¡Œè®¡ç®—å¹³å°ã€‚CUDAåŒæ—¶æ¨åŠ¨äº†è‹±ä¼Ÿè¾¾ç¡¬ä»¶æŠ€æœ¯çš„åº”ç”¨</p>
<h4 id="7-4-4-3ã€OpenCL"><a href="#7-4-4-3ã€OpenCL" class="headerlink" title="7.4.4.3ã€OpenCL"></a>7.4.4.3ã€OpenCL</h4><p>â€‹    ä¸Šé¢ä¸¤ä¸ªGPGPUçš„å®ç°éƒ½æ˜¯æœ‰å¹³å°é’ˆå¯¹æ€§çš„ï¼Œè¦æƒ³ç”¨ä»–ä»¬çš„è§£å†³æ–¹æ¡ˆä½ å°±å¾—ç”¨AMDå’Œè‹±ä¼Ÿè¾¾çš„ç¡¬ä»¶ï¼Œè€ŒOpenCLå°±ä¸ä¸€æ ·äº†ã€‚æ‰€è°“Openå°±æ˜¯ä¸€ä¸ªå¼€æ”¾çš„æ ‡å‡†ï¼Œä½†æ˜¯éœ€è¦å„å®¶ç¡¬ä»¶å‚å•†ä¸ºOpenCLæä¾›é©±åŠ¨ç¨‹åºã€‚</p>
<p>â€‹    OpenCLæœ€æ—©ç”±è‹¹æœå…¬å¸å¼€å‘å‡ºçš„å¼‚æ„è®¡ç®—æ¡†æ¶ï¼Œè‹¹æœå…¬å¸å°†è¿™å¥—æ¡†æ¶çš„è‰æ¡ˆæäº¤åˆ°Khronos ç»„ç»‡ï¼Œä½œä¸ºå¼€æ”¾æ ‡å‡†ä¾›ä¸šç•Œä½¿ç”¨ã€‚åœ¨2008å¹´æœ«ï¼Œ1.0ç‰ˆæœ¬æ­£å¼å…¬å¼€ï¼Œç›®å‰Intelã€AMDä¸Nvidiaçš„GPUéƒ½æ”¯æŒè¿™å¥—æ¡†æ¶ã€‚è¿™æ˜¯é™¤äº†CUDAä¹‹åï¼Œå¦ä¸€ä¸ªæµè¡Œçš„GPGPUè®¡ç®—æ¡†æ¶ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150202.png" alt="img"></p>
<p>â€‹    OpenCLä¸ä»…é™äºx86å¹³å°ä¸Šæä¾›çš„å¼‚æ„è®¡ç®—æ¡†æ¶ï¼Œè·¨å¹³å°å’Œå¼€æ”¾æ ‡æ³¨çš„ç‰¹æ€§ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸“é—¨çš„å¯ç¼–ç¨‹ç”µè·¯æ¥åŠ é€Ÿè®¡ç®—ã€‚æœ‰å¹¿æ³›çš„æ”¯æŒç©ºé—´ï¼Œä¸šç•Œå¯¹äºå®ƒçš„æ”¯æŒéå¸¸å¹¿æ³›ï¼Œä¸‹å›¾æ˜¯OpenCLè”ç›Ÿæˆå‘˜ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150253.png" alt="img"></p>
<p>â€‹    OpenCLè”ç›Ÿ</p>
<h4 id="7-4-4-4ã€DirectCompute"><a href="#7-4-4-4ã€DirectCompute" class="headerlink" title="7.4.4.4ã€DirectCompute"></a>7.4.4.4ã€DirectCompute</h4><p>â€‹    å¾®è½¯æ˜¯è½¯ä»¶è¡Œä¸šçš„è€å¤§ï¼Œåœ¨å¹¶è¡Œè®¡ç®—é¢†åŸŸï¼Œå¾®è½¯ä¹Ÿåœ¨è¿›è¡Œç§¯æçš„æ¢ç´¢ã€‚DirectComputeæ˜¯å¾®è½¯ä»DirectX 10å¼€å§‹åŠ å…¥çš„ç”¨äºé€šç”¨è®¡ç®—ç›®çš„çš„APIé›†ï¼Œè°ƒç”¨GPUè¿›è¡ŒåŠ é€Ÿè®¡ç®—ã€‚</p>
<p>â€‹    ä»Vistaå¼€å§‹ï¼ŒWindowsçš„å„ç§æ¡Œé¢ç‰¹æ•ˆå°±å¼€å§‹é‡‡ç”¨DirectComputeæ¥åŠ é€Ÿè®¡ç®—ã€‚åœ¨DirectX 11ä¸­ï¼Œå¾®è½¯å®Œå–„äº†è¿™å¥—APIï¼Œå¹¶ä¸”åœ¨Windowsç³»ç»Ÿä¸Šæ›´å¤šåœ°ä½¿ç”¨GPUæ¥åŠ é€Ÿè®¡ç®—ç³»ç»Ÿç•Œé¢çš„å„ç§ç‰¹æ•ˆã€‚</p>
<p>â€‹    ä¸ä»…ä»…æ˜¯ä¸“ä¸šçš„å›¾å½¢å›¾åƒã€éŸ³è§†é¢‘é¢†åŸŸï¼Œåœ¨æ“ä½œç³»ç»Ÿé¢†åŸŸï¼Œå¯¹å¹¶è¡Œè®¡ç®—çš„è¦æ±‚ä¹Ÿå¾ˆå¥½ã€‚å½“æˆ‘ä»¬åœ¨ä½¿ç”¨å¾®è½¯çš„VSæŠ€æœ¯æ—¶é—´ï¼ŒVSæŠ€æœ¯çš„ä¸€å¤§æŠ€æœ¯æ”¯æŸ±å°±æ˜¯å¹¶è¡Œè®¡ç®—æŠ€æœ¯ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150332.png" alt="img"></p>
<p>â€‹    GPU-Zæ˜¾ç¤ºè¯¥GPUæ”¯æŒçš„é€šç”¨è®¡ç®—ç‰¹æ€§</p>
<h3 id="7-4-5ã€åª’ä½“ç¼–ç åŠ é€Ÿ"><a href="#7-4-5ã€åª’ä½“ç¼–ç åŠ é€Ÿ" class="headerlink" title="7.4.5ã€åª’ä½“ç¼–ç åŠ é€Ÿ"></a>7.4.5ã€åª’ä½“ç¼–ç åŠ é€Ÿ</h3><p>â€‹    åå¹´å‰ï¼ŒH.264ç­‰é¢å‘é«˜æ¸…åº”ç”¨çš„è§†é¢‘ç¼–ç åˆšæµè¡Œï¼ŒCPUçš„æ€§èƒ½é™åˆ¶ï¼Œç¼–ç ä¸€æ®µH.264çš„è§†é¢‘æ˜¯ä¸€ä»¶ç›¸å½“è€—è´¹æ—¶é—´çš„äº‹æƒ…ï¼Œæ‰€ä»¥äººä»¬æƒ³åˆ°äº†ç”¨GPUæ¥åŠ é€Ÿè§†é¢‘çš„ç¼–ç ã€‚</p>
<p>â€‹    Nvidiaåˆšæ¨å‡ºCUDAçš„æ—¶å€™ï¼Œå°±å°†åŠ é€Ÿè§†é¢‘ç¼–ç ä½œä¸ºè¯¥æŠ€æœ¯çš„ä¸€å¤§å–ç‚¹ï¼Œå…è´¹æä¾›äº†ä¸€ä¸ªæ”¯æŒCUDAæŠ€æœ¯æ¥è½¬ç çš„è½¯ä»¶BadaBoomã€‚åæ¥ï¼ŒNvidiaåœ¨æ˜¾å¡ä¸ŠåŠ å…¥äº†ä¸“é—¨ç”¨äºè§†é¢‘ç¼–è§£ç çš„ç¡¬ä»¶ç”µè·¯ï¼Œå¼€æ”¾äº†åä¸ºNVENCçš„ç¼–ç APIä¾›è½¯ä»¶å·¥ç¨‹å¸ˆè°ƒç”¨ï¼Œé€šç”¨è®¡ç®—ä¹Ÿå°±æ­¤ç¦»å¼€äº†è¿™ä¸ªè·ç¦»æˆ‘ä»¬æœ€è¿‘çš„é¢†åŸŸã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150434.png" alt="img"></p>
<p>â€‹    BadaBoomåŠ é€Ÿè§†é¢‘è½¬ç </p>
<p>â€‹    Adobeæ˜¯å›¾å½¢å›¾åƒã€éŸ³è§†é¢‘æŠ€æœ¯çš„éœ¸ä¸»ã€‚å¾ˆæ—©å°±åœ¨æ——ä¸‹çš„CSå’ŒCCè½¯ä»¶ä¸­åŠ å…¥äº†GPGPUçš„æ”¯æŒï¼ŒPremiere Proå’ŒAfter Effectéƒ½æ”¯æŒOpenCLæ¥åŠ é€Ÿè§†é¢‘å®æ—¶é¢„è§ˆå’Œç‰¹æ•ˆã€‚Adodeå¯¹å¹¶è¡Œè®¡ç®—æŠ€æœ¯çš„åº”ç”¨èµ°åœ¨å„å®¶å…¬å¸å‰åˆ—ã€‚</p>
<h3 id="7-4-6ã€è§†é¢‘è¡¥å¸§ä¸ç”»é¢ä¼˜åŒ–"><a href="#7-4-6ã€è§†é¢‘è¡¥å¸§ä¸ç”»é¢ä¼˜åŒ–" class="headerlink" title="7.4.6ã€è§†é¢‘è¡¥å¸§ä¸ç”»é¢ä¼˜åŒ–"></a>7.4.6ã€è§†é¢‘è¡¥å¸§ä¸ç”»é¢ä¼˜åŒ–</h3><p>â€‹    è‹±ä¼Ÿè¾¾ã€è‹±ç‰¹å°”å’ŒAMDä¸‰å®¶ç›¸ç»§åœ¨è‡ªå·±çš„GPUä¸­åŠ å…¥ä¸“ç”¨è®¡ç®—ç”µè·¯ç”¨ä»¥åŠ é€Ÿç¼–è§£ç è§†é¢‘ä¹‹åï¼Œé€šç”¨è®¡ç®—å°±ç¦»å¼€äº†è¿™ä¸ªé¢†åŸŸã€‚ä¸æ»¡è¶³äºæ—¢æœ‰çš„è§†é¢‘å“è´¨çš„äººä»¬ï¼Œåˆç›¸ç»§å¼€å‘å‡ºäº†æ–°çš„å¯ä»¥åˆ©ç”¨GPGPUçš„åŠŸèƒ½ï¼šè§†é¢‘è¡¥å¸§ã€‚å¤§å¤§æ”¹å–„äº†è§†é¢‘è´¨é‡ã€‚</p>
<p>â€‹    è§†é¢‘è¡¥å¸§ï¼šæ˜¯åŸæœ¬ä½å¸§æ•°çš„è§†é¢‘ï¼Œé€šè¿‡ä¸Šä¸‹å¸§çš„è®¡ç®—ï¼Œæ¸²æŸ“å‡ºä¸€å¸§åŸæœ¬ä¸å­˜åœ¨çš„ç”»é¢è¡¥åœ¨ä¸¤å¸§ä¹‹é—´ï¼Œä½¿å…¶è§‚æ„Ÿæ›´åŠ æµç•…ã€‚</p>
<p>â€‹    æ¯”å¦‚å°†24å¸§çš„è§†é¢‘è¡¥å¸§è‡³60å¸§ï¼Œè§†é¢‘è´¨é‡åœ†æ¶¦æµç•…ã€‚å› ä¸ºè¿™ä¸ªè¿‡ç¨‹è®¡ç®—é‡è¿‡äºåºå¤§ï¼Œä½¿ç”¨CPUè·Ÿä¸ä¸Šè§†é¢‘æ’­æ”¾çš„é€Ÿåº¦ï¼Œæ²¡æ³•åšåˆ°å®æ—¶è¡¥å¸§ï¼Œå¼€å‘è€…å°±å°†è¿™ä¸ªåŠŸèƒ½æ¬åˆ°äº†GPUä¸Šæ¥è¿è¡Œï¼Œå¾ˆå¤šäººéƒ½æ›¾ç»ä½¿ç”¨çš„SVP4ï¼Œå°±æ˜¯ä¸€ä¸ªåˆ©ç”¨GPGPUçš„è¡¥å¸§è½¯ä»¶ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150467.png" alt="img"></p>
<p>â€‹    SVP4è¡¥å¸§è½¯ä»¶ç•Œé¢</p>
<p>â€‹    ç§‘æŠ€å‘å±•æ°¸æ— æ­¢å¢ƒï¼Œè§†é¢‘æŠ€æœ¯ä¹Ÿä¸ä¾‹å¤–ã€‚è§†é¢‘ç”»é¢ä¼˜åŒ–é¢†åŸŸï¼Œå¼ºå¤§çš„è§†é¢‘æ¸²æŸ“å™¨MadVRä¹Ÿæ˜¯åˆ©ç”¨GPGPUæ¥ä¼˜åŒ–è§†é¢‘ç”»é¢ã€‚</p>
<p>â€‹    æ¯”å¦‚è§†é¢‘æ’­æ”¾ä¸­å‡ºç°çš„è‰²å¸¦ã€è‰²ç¯ï¼Œåœ¨å‹åˆ¶è¿‡ç¨‹ä¸­å‡ºç°çš„ç‘•ç–µç­‰ï¼Œå¯ä»¥ä½¿ç”¨GPGPUåœ¨è§†é¢‘æ’­æ”¾è¿‡ç¨‹ä¸­è¿›è¡Œå®æ—¶çš„å¼¥è¡¥ã€‚ä½¿è§†é¢‘æ›´åŠ åœ†æ¶¦ä¸é«˜æ¸…ï¼Œè§†é¢‘æŠ€æœ¯çš„å‘å±•æ°¸æ— æ­¢å¢ƒã€‚</p>
<h3 id="7-4-7ã€äººå·¥æ™ºèƒ½ä¸æ·±åº¦å­¦ä¹ "><a href="#7-4-7ã€äººå·¥æ™ºèƒ½ä¸æ·±åº¦å­¦ä¹ " class="headerlink" title="7.4.7ã€äººå·¥æ™ºèƒ½ä¸æ·±åº¦å­¦ä¹ "></a>7.4.7ã€äººå·¥æ™ºèƒ½ä¸æ·±åº¦å­¦ä¹ </h3><p>â€‹    äººå·¥æ™ºèƒ½ä¸æ·±åº¦å­¦ä¹ æ˜¯è¿‘å¹´æ¥éå¸¸çƒ­é—¨çš„ä¸¤ä¸ªæœ‰å…³è”çš„é¢†åŸŸï¼Œè®­ç»ƒäººå·¥æ™ºèƒ½éœ€è¦éå¸¸å¤§çš„æ•°æ®è®¡ç®—é‡ï¼Œè¿™æ—¶å€™å°±å¯ä»¥åˆ©ç”¨ä¸ŠGPUçš„å¼ºå¤§åŠŸèƒ½ï¼Œè°·æ­Œçš„æ·±åº¦å­¦ä¹ æ¡†æ¶TensorFlowï¼Œä»¥åŠFaceBookçš„Pytorchå°±ä½¿ç”¨CUDAæ¥åŠ é€Ÿå­¦ä¹ ã€‚</p>
<p>â€‹    Nvidiaè¿™ä¸¤å¹´ä¸æ–­å±•ç¤ºäº†å®ƒä»¬åœ¨æœºå™¨å­¦ä¹ æ–¹é¢çš„ä¸€äº›ç»“æœï¼Œåœ¨RTXç³»åˆ—ä¸Šå¼•å…¥çš„DLSSï¼ˆæ·±åº¦å­¦ä¹ æŠ—é”¯é½¿ï¼‰æŠ€æœ¯å°±æ˜¯åˆ©ç”¨æœºå™¨å­¦ä¹ æ¥è¾¾æˆçš„ã€‚</p>
<p>â€‹    è‹±ä¼Ÿè¾¾ä»Šå¤©åœ¨äººå·¥æ™ºèƒ½é¢†åŸŸå æ®ç€é‡è¦çš„ä½ç½®ï¼Œåœ¨ç§‘æŠ€å‘å±•è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šå…¬å¸é è½¯ä»¶é©±åŠ¨æŠ€æœ¯å‘å±•ï¼Œè‹±ä¼Ÿè¾¾é ç¡¬ä»¶é©±åŠ¨æŠ€æœ¯çš„å‘å±•ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150471.png" alt="img"></p>
<p>â€‹    DLSSæŠ€æœ¯</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150487.png" alt="img"></p>
<p>â€‹    ä¸Šå›¾æ˜¯CUDAåœ¨ç§‘ç ”é¢†åŸŸçš„ä¸€äº›åº”ç”¨ï¼Œå¯ä»¥çœ‹åˆ°GPUå°±åœ¨æˆ‘ä»¬çš„èº«è¾¹ã€‚</p>
<h3 id="7-4-8ã€è¶…çº§è®¡ç®—æœº"><a href="#7-4-8ã€è¶…çº§è®¡ç®—æœº" class="headerlink" title="7.4.8ã€è¶…çº§è®¡ç®—æœº"></a>7.4.8ã€è¶…çº§è®¡ç®—æœº</h3><p>â€‹    è‹±ä¼Ÿè¾¾åœ¨G80å¼€å§‹å°±æ¨å‡ºåŒæ¶æ„çš„é«˜å“è´¨è®¡ç®—å¡ï¼ŒTeslaå“ç‰Œä¹‹ä¸‹ã€‚è¯ç”Ÿäº†å¾ˆå¤šç”¨Teslaè®¡ç®—å¡æ¥ç»„å»ºçš„è¶…çº§è®¡ç®—æœºã€‚ç¡¬ä»¶æŠ€æœ¯çš„ä¼˜åŠ¿ï¼Œå¯¼è‡´è‹±ä¼Ÿè¾¾åœ¨è¶…ç®—é¢†åŸŸé¢†è·‘å…¨çƒã€‚</p>
<p>â€‹    äººå·¥æ™ºèƒ½æ˜¯è‹±ä¼Ÿè¾¾çš„å‘å±•æ–¹å‘ï¼Œç›¸ä¿¡è¿‘å‡ å¹´ï¼Œä½¿ç”¨è‹±ä¼Ÿè¾¾æŠ€æœ¯çš„è®¡ç®—æœºä¼šé€æ¸å¢å¤šã€‚ä¼šæ›¾ç»ç«äº‰è´å°”Â·æˆˆç™»å¥–çš„å…­ä¸ªå…¥å›´è€…ä¸­ï¼Œäº”ä¸ªä½¿ç”¨äº†NVIDIA GPUæä¾›æ”¯æŒçš„è¶…çº§è®¡ç®—æœºã€‚</p>
<p>â€‹    è‹±ä¼Ÿè¾¾è”æ‰‹ARMï¼Œåœ¨è¶…çº§è®¡ç®—æœºé¢†åŸŸä¸­ç»§ç»­å‘åŠ›ï¼Œé¢„è®¡æœªæ¥é‡‡ç”¨GPGPUæŠ€æœ¯çš„è¶…çº§è®¡ç®—æœºå°†ä¼šè¶Šæ¥è¶Šå¤šã€‚</p>
<p>â€‹    è¿‘äº›å¹´ï¼Œè¶…çº§è®¡ç®—æœºç¡¬ä»¶é¢†åŸŸï¼Œè‹±ä¼Ÿè¾¾æœ‰ç€å¼ºå¤§çš„æŠ€æœ¯å®åŠ›ã€‚åœ¨äº‘å¹³å°ä¸Šï¼Œè‹±ä¼Ÿè¾¾è¶…çº§è®¡ç®—ç¡¬ä»¶åº”ç”¨è¾ƒå¤šã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150578.png" alt="img"></p>
<p>â€‹    GPGPUç›¸å¯¹äºPCï¼Œæ˜¯æ–°çš„æ¦‚å¿µï¼Œåä½™å¹´çš„å‘å±•å·²ç»ä¸ä»…å±€é™äºPCï¼Œè¿˜èµ°å‘äº†å…¶å®ƒé¢†åŸŸï¼Œæ‰æ ¹äºæˆ‘ä»¬ç”Ÿæ´»çš„æ¯ä¸ªè§’è½ã€‚GPGPUå·²ç»åœ¨è®¸å¤šäº‘è®¡ç®—å¹³å°ä¸Šå¾—åˆ°äº†åº”ç”¨ï¼Œç›¸ä¿¡åœ¨ä»¥åï¼ŒGPUä¼šæ›´åŠ æ·±å…¥ç”Ÿæ´»çš„æ›´å¤šæ–¹é¢ï¼Œå°¤å…¶ä¸äººå·¥æ™ºèƒ½æŠ€æœ¯çš„ç»“åˆï¼Œå…·æœ‰ç€å·¨å¤§çš„åº”ç”¨ç©ºé—´ã€‚</p>
<h3 id="7-4-9ã€ç¤ºä¾‹ä»£ç "><a href="#7-4-9ã€ç¤ºä¾‹ä»£ç " class="headerlink" title="7.4.9ã€ç¤ºä¾‹ä»£ç "></a>7.4.9ã€ç¤ºä¾‹ä»£ç </h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;CL/cl.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line">#include &lt;fstream&gt;</span><br><span class="line">#include &quot;tool.h&quot;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">/** convert the kernel file into a string */</span><br><span class="line">int convertToString(const char *filename, std::string&amp; s)</span><br><span class="line">&#123;</span><br><span class="line">    size_t size;</span><br><span class="line">    char*  str;</span><br><span class="line">    std::fstream f(filename, (std::fstream::in | std::fstream::binary));</span><br><span class="line"></span><br><span class="line">    if(f.is_open())</span><br><span class="line">    &#123;</span><br><span class="line">        size_t fileSize;</span><br><span class="line">        f.seekg(0, std::fstream::end);</span><br><span class="line">        size = fileSize = (size_t)f.tellg();</span><br><span class="line">        f.seekg(0, std::fstream::beg);</span><br><span class="line">        str = new char[size+1];</span><br><span class="line">        if(!str)</span><br><span class="line">        &#123;</span><br><span class="line">            f.close();</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        f.read(str, fileSize);</span><br><span class="line">        f.close();</span><br><span class="line">        str[size] = &#x27;\0&#x27;;</span><br><span class="line">        s = str;</span><br><span class="line">        delete[] str;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;&quot;Error: failed to open file\n:&quot;&lt;&lt;filename&lt;&lt;endl;</span><br><span class="line">    return -1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**Getting platforms and choose an available one.*/</span><br><span class="line">int getPlatform(cl_platform_id &amp;platform)</span><br><span class="line">&#123;</span><br><span class="line">    platform = NULL;//the chosen platform</span><br><span class="line"></span><br><span class="line">    cl_uint numPlatforms;//the NO. of platforms</span><br><span class="line">    cl_int    status = clGetPlatformIDs(0, NULL, &amp;numPlatforms);</span><br><span class="line">    if (status != CL_SUCCESS)</span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;&quot;Error: Getting platforms!&quot;&lt;&lt;endl;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**For clarity, choose the first available platform. */</span><br><span class="line">    if(numPlatforms &gt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        cl_platform_id* platforms =</span><br><span class="line">            (cl_platform_id* )malloc(numPlatforms* sizeof(cl_platform_id));</span><br><span class="line">        status = clGetPlatformIDs(numPlatforms, platforms, NULL);</span><br><span class="line">        platform = platforms[0];</span><br><span class="line">        free(platforms);</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">        return -1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**Step 2:Query the platform and choose the first GPU device if has one.*/</span><br><span class="line">cl_device_id *getCl_device_id(cl_platform_id &amp;platform)</span><br><span class="line">&#123;</span><br><span class="line">    cl_uint numDevices = 0;</span><br><span class="line">    cl_device_id *devices=NULL;</span><br><span class="line">    cl_int    status = clGetDeviceIDs(platform, CL_DEVICE_TYPE_GPU, 0, NULL, &amp;numDevices);</span><br><span class="line">    if (numDevices &gt; 0) //GPU available.</span><br><span class="line">    &#123;</span><br><span class="line">        devices = (cl_device_id*)malloc(numDevices * sizeof(cl_device_id));</span><br><span class="line">        status = clGetDeviceIDs(platform, CL_DEVICE_TYPE_GPU, numDevices, devices, NULL);</span><br><span class="line">    &#125;</span><br><span class="line">    return devices;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-4-10ã€æ€»ç»“"><a href="#7-4-10ã€æ€»ç»“" class="headerlink" title="7.4.10ã€æ€»ç»“"></a>7.4.10ã€æ€»ç»“</h3><p>â€‹    GPGPUï¼Œå¸¦CPUå¤„ç†èƒ½åŠ›çš„GPUã€‚ä¸»è¦æ˜¯GPUçš„å·¥ä½œï¼ŒGPUçš„èƒ½åŠ›ï¼Œå¯ä»¥ååŠ©CPUè¿›è¡Œè¿ç®—åŠ›ï¼ŒGPGPUï¼ˆé€šç”¨å›¾å½¢å¤„ç†ï¼‰è¶…å‡ºGPUçš„èƒ½åŠ›èŒƒå›´ï¼Œå®Œå…¨å…·å¤‡é€šç”¨çš„æ•°æ®å¤„ç†ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150634.png" alt="img"></p>
<p>â€‹    GPUï¼Œç”¨äºå›¾å½¢å¤„ç†çš„èŠ¯ç‰‡ã€‚ï¼ˆGPUä¹Ÿæ˜¯ä¸€ç§CPUï¼Œç›¸å¯¹äºæ˜¾å¡ï¼‰æ—©æœŸæ˜¾å¡æ˜¯æ²¡æœ‰ä¸“é—¨ç”¨åšå›¾å½¢å¤„ç†çš„GPUçš„ï¼Œä¸æ”¯æŒ3Dã€‚</p>
<p>â€‹    CPUï¼Œç”¨äºæ•°æ®å¤„ç†çš„èŠ¯ç‰‡ï¼ˆå›¾å½¢ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯æ•°æ®ï¼‰ã€‚ä¸­å¤®å¤„ç†å™¨ï¼Œä¸€ç§ç›¸å¯¹çš„æ¦‚å¿µã€‚æ½œç§»é»˜åŒ–è¢«è®¤å®šæ˜¯æ”¾åœ¨ä¸»æ¿ä¸Šï¼Œé€šè¿‡å‘GPUä¼ é€æŒ‡ä»¤ï¼Œæ§åˆ¶GPUã€‚</p>
<p>â€‹    AMD-APUï¼ŒåŠ é€Ÿå¤„ç†å™¨ã€‚é›†æˆGPUæ ¸å¿ƒçš„CPUï¼Œå¹¶ä¸”èåˆã€‚ä¸åŒäºIntel Iç³»ï¼ˆGPUä¸CPUç‹¬ç«‹å·¥ä½œï¼‰ã€‚</p>
<p>â€‹    ç¾æ‘„SDKï¼Œé‡‡ç”¨CUDAã€OpenCLã€DirectComputeå¹¶è¡Œè®¡ç®—æŠ€æœ¯ã€‚åŸºäºCPUã€GPUã€GPGPUç¡¬ä»¶å¹³å°ï¼Œä¼˜ç§€çš„éŸ³è§†é¢‘å¼•æ“ï¼Œæ¨åŠ¨éŸ³è§†é¢‘æŠ€æœ¯å‘å±•ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150707.png" alt="img"></p>
<h2 id="7-5-TPU"><a href="#7-5-TPU" class="headerlink" title="7.5 TPU"></a>7.5 TPU</h2><p>  TPUï¼ˆTensor Processing Unitï¼‰å¼ é‡å¤„ç†å•å…ƒï¼Œä¸ºæœºå™¨å­¦ä¹ å®šåˆ¶çš„èŠ¯ç‰‡ï¼Œç»è¿‡ä¸“é—¨æ·±åº¦æœºå™¨å­¦ä¹ æ–¹é¢çš„è®­ç»ƒï¼Œå®ƒæœ‰æ›´é«˜æ•ˆèƒ½ï¼ˆæ¯ç“¦è®¡ç®—èƒ½åŠ›ï¼‰ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150029.png" alt="img"></p>
<p>â€‹    è°·æ­Œï¼Œ2015å¹´6æœˆï¼ŒI&#x2F;Oå¼€å‘è€…å¤§ä¼šä¸Šæ¨å‡ºçš„è®¡ç®—ç¥ç»ç½‘ç»œä¸“ç”¨èŠ¯ç‰‡ï¼Œä¸ºä¼˜åŒ–è‡ªèº«çš„TensorFlowæœºå™¨å­¦ä¹ æ¡†æ¶è€Œæ‰“é€ ï¼Œä¸»è¦ç”¨äºAlphaGoç³»ç»Ÿï¼Œè°·æ­Œåœ°å›¾ã€è°·æ­Œç›¸å†Œå’Œè°·æ­Œç¿»è¯‘ç­‰åº”ç”¨ä¸­ã€‚è¿›è¡Œæœç´¢ã€å›¾åƒã€è¯­éŸ³ç­‰æ¨¡å‹å’ŒæŠ€æœ¯çš„å¹¶è¡Œå¤„ç†ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150999.png" alt="img"></p>
<h3 id="7-5-1ã€TPUå‘å±•å²"><a href="#7-5-1ã€TPUå‘å±•å²" class="headerlink" title="7.5.1ã€TPUå‘å±•å²"></a>7.5.1ã€TPUå‘å±•å²</h3><p>â€‹    2016 å¹´ï¼ŒAlphaGoä»¥4:1æ€»åˆ†æ‰“è´¥å›´æ£‹ä¸–ç•Œå† å†›æä¸–çŸ³ï¼Œéšåç‹¬æˆ˜ç¾¤é›„ï¼Œåœ¨ä¸æ’åä¸–ç•Œç¬¬ä¸€å›´æ£‹çš„å† å†›æŸ¯æ´å¯¹æˆ˜èƒœåˆ©åå®£å¸ƒâ€œéšé€€æ±Ÿæ¹–â€ï¼ŒèƒŒåçš„èŠ¯ç‰‡å¼€å¯äº†èŠ¯ç‰‡äº§ä¸šçš„æ–°ç¯‡ç« ã€‚</p>
<p>â€‹    åœ°è¦†å¤©ç¿»çš„å››å¹´ï¼ŒAIèŠ¯ç‰‡é¢†åŸŸï¼Œå°¤å…¶æ˜¯äº‘ç«¯AIèŠ¯ç‰‡ï¼Œå¸‚åœºè§„æ¨¡ä¸€è·¯æ‰¶æ‘‡ç›´ä¸Šï¼Œæˆä¸ºèŠ¯ç‰‡å·¨å¤´å’Œæ–°åŠ¿åŠ›è™è§†çœˆçœˆä¹‹åœ°ã€‚</p>
<p>â€‹    èµ›è¿ª2019å¹´8æœˆå‘å¸ƒçš„ã€Šä¸­å›½äººå·¥æ™ºèƒ½èŠ¯ç‰‡äº§ä¸šå‘å±•ç™½çš®ä¹¦ã€‹ï¼Œ2018å¹´å…¨çƒäº‘ç«¯AIèŠ¯ç‰‡å¸‚åœºè§„æ¨¡ä¸º62.1äº¿ç¾å…ƒï¼Œè¿™ä¸€æ•°å€¼é¢„è®¡åœ¨2021å¹´è¾¾åˆ°221.5äº¿ç¾å…ƒï¼Œå·¨å¤§çš„å¸‚åœºå°†å¦‚ç«å±±çˆ†å‘èˆ¬å‘ˆç°åœ¨ä¼—äººçœ¼å‰ï¼ŒèŠ¯ç‰‡åˆ¶é€ çš„é«˜å…‰æ—¶åˆ»åˆ°æ¥äº†ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150983.png" alt="img"></p>
<p>â€‹    è¿™ç‰‡è“æµ·ä¸­ï¼Œæœ‰ä¸€ä¸ªè§’è‰²èµ·åˆ°äº†åˆ’æ—¶ä»£çš„æ„ä¹‰ï¼Œå®ƒå°±æ˜¯è°·æ­ŒTPUï¼ˆTensor Processing Unitï¼Œå¼ é‡å¤„ç†å•å…ƒï¼‰ã€‚</p>
<p>â€‹    ä¸æä¸–çŸ³ã€æŸ¯æ´ï¼Œä»¥åŠä¸­æ—¥éŸ©æ•°åä½å›´æ£‹é«˜æ‰‹çš„å›´æ£‹å¯¹æˆ˜ä¸­è„±é¢–è€Œå‡ºåï¼Œè°·æ­ŒTPUæ›¾ä¸€è·¯ç‹‚é£™çªè¿›ï¼Œç‹¬æ­¥å¤©ä¸‹ï¼Œç°åœ¨å·²æ¼”è¿›åˆ°äº†ç¬¬å››ä»£ã€‚å®ƒçš„å‡ºç°ï¼Œæ— ç–‘æ‰“ç ´äº†GPUã€GPGPUæ›¾ä¸€åº¦ç§°éœ¸ç¥ç»ç½‘ç»œæ¨ç†å’Œè®­ç»ƒå¸‚åœºçš„å±€é¢ã€‚åœ¨å¤§æ•°æ®ã€äººå·¥æ™ºèƒ½é¢†åŸŸï¼Œè°·æ­Œçš„ç‹è€…ä¹‹é£é€æ¸æ˜¾ç°ã€‚</p>
<p>â€‹    2019å¹´5æœˆï¼Œè°·æ­ŒI&#x2F;Oå¼€å‘è€…å¤§ä¼šä¸Šï¼Œä¸‡ä¼—ç©ç›®çš„ç¬¬å››ä»£TPUæ„å¤–ç¼ºå¸­ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä»¥1000ä¸ªTPUv3ç»„æˆçš„TPUv3 Podï¼Œä»¥åŠè¾¹ç¼˜AIèŠ¯ç‰‡Edge TPUã€‚å³ä¾¿å¦‚æ­¤ï¼Œå®ƒä»é€šè¿‡ä¸€å®šç¨‹åº¦çš„å¯¹å¤–å¼€æ”¾ï¼Œä»¥åŠè¾…åŠ©è°·æ­Œå†…éƒ¨æœåŠ¡å™¨åº”ç”¨æ·±åˆ»åœ°å½±å“ç€äº‘ç«¯AIèŠ¯ç‰‡å¸‚åœºã€‚é‚£æ¬¡å¤§ä¼šï¼ŒåçŸ¥åè§‰çš„äººä»¬æ„è¯†åˆ°ï¼Œè°·æ­Œå–çš„æ˜¯æ–¹æ¡ˆä¸æ€æƒ³ï¼Œè°·æ­Œå·²ç»è„±ç¦»äº†æŠ€æœ¯ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150023.png" alt="img"></p>
<p>â€‹    ä»å¸‚åœºè§’åº¦çœ‹ï¼Œæœªæ¥äº‘ç«¯AIèŠ¯ç‰‡å·¨å¤§çš„å‘å±•æ½œåŠ›å’Œå¸‚åœºæœºé‡ä¸ºè°·æ­ŒTPUæä¾›äº†è‚¥æ²ƒçš„åœŸå£¤ï¼›å¦ä¸€æ–¹é¢ï¼Œç´§è¿«çš„ç®—åŠ›ç“¶é¢ˆå’Œæ‘©å°”å®šå¾‹æ”¾ç¼“ç­‰é—®é¢˜ä¹Ÿè¶Šæ¥è¶Šéš¾ä»¥å¿½è§†ã€‚è°·æ­Œå±äºæœªæ¥ç§‘æŠ€å…¬å¸ï¼Œæœ‰æ— ç©·çš„å¯èƒ½ã€‚</p>
<h4 id="7-5-1-1ã€å§‹äºç®—åŠ›ç“¶é¢ˆï¼Œé¦–ç§€äººç±»å›´æ£‹ç•Œ"><a href="#7-5-1-1ã€å§‹äºç®—åŠ›ç“¶é¢ˆï¼Œé¦–ç§€äººç±»å›´æ£‹ç•Œ" class="headerlink" title="7.5.1.1ã€å§‹äºç®—åŠ›ç“¶é¢ˆï¼Œé¦–ç§€äººç±»å›´æ£‹ç•Œ"></a>7.5.1.1ã€å§‹äºç®—åŠ›ç“¶é¢ˆï¼Œé¦–ç§€äººç±»å›´æ£‹ç•Œ</h4><p>â€‹    åŒºåˆ«äºGPUã€GPGPUï¼Œè°·æ­ŒTPUæ˜¯ä¸€ç§ASICèŠ¯ç‰‡æ–¹æ¡ˆã€‚ASICå…¨ç§°ä¸ºApplication-Specific Integrated Circuitï¼ˆåº”ç”¨å‹ä¸“ç”¨é›†æˆç”µè·¯ï¼‰ï¼Œæ˜¯ä¸“ä¸ºæŸç§ç‰¹å®šåº”ç”¨éœ€æ±‚è€Œå®šåˆ¶çš„èŠ¯ç‰‡ã€‚ä½†ä¸€èˆ¬æ¥è¯´ï¼ŒASICèŠ¯ç‰‡çš„å¼€å‘ä¸ä»…éœ€è¦èŠ±è´¹æ•°å¹´çš„æ—¶é—´ï¼Œä¸”ç ”å‘æˆæœ¬ä¹Ÿæé«˜ï¼Œä¸€ç›´æ˜¯ä¸ªåˆ«å…¬å¸çš„é˜µåœ°ã€‚</p>
<p>â€‹    å¯¹äºæ•°æ®ä¸­å¿ƒæœºæˆ¿ä¸­AIå·¥ä½œè´Ÿè½½çš„é«˜ç®—åŠ›éœ€æ±‚ï¼Œè®¸å¤šå‚å•†æ›´æ„¿æ„ç»§ç»­é‡‡ç”¨ç°æœ‰çš„GPUé›†ç¾¤æˆ–GPU+CPUå¼‚æ„è®¡ç®—è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿç”šå°‘åœ¨ASICé¢†åŸŸå†’é™©ã€‚ä½†è°·æ­Œè¯´ä¸äº†ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150008.png" alt="img"></p>
<p>â€‹    è°·æ­Œ2006å¹´èµ·äº§ç”Ÿäº†è¦ä¸ºç¥ç»ç½‘ç»œç ”å‘ä¸€æ¬¾ä¸“ç”¨èŠ¯ç‰‡çš„æƒ³æ³•ï¼Œè€Œè¿™ä¸€éœ€æ±‚åœ¨2013å¹´ä¹Ÿå¼€å§‹å˜å¾—æ„ˆå‘æ€¥è¿«ã€‚è°·æ­Œè¿™å®¶è¶…å‰çš„å…¬å¸ï¼Œåœ¨æœªé›¨ç»¸ç¼ªã€‚å½“æ—¶ï¼Œè°·æ­Œæä¾›çš„è°·æ­Œå›¾åƒæœç´¢ã€è°·æ­Œç…§ç‰‡ã€è°·æ­Œäº‘è§†è§‰APIã€è°·æ­Œç¿»è¯‘ç­‰å¤šç§äº§å“å’ŒæœåŠ¡ï¼Œéƒ½éœ€è¦ç”¨åˆ°æ·±åº¦ç¥ç»ç½‘ç»œã€‚</p>
<p>â€‹    åºå¤§çš„åº”ç”¨è§„æ¨¡ä¸‹ï¼Œè°·æ­Œæ„è¯†åˆ°ï¼Œå¤œä»¥ç»§æ—¥è¿è¡Œçš„æ•°ç™¾ä¸‡å°æœåŠ¡å™¨ï¼Œå®ƒä»¬å†…éƒ¨å¿«é€Ÿå¢é•¿çš„è®¡ç®—éœ€æ±‚ï¼Œä½¿å¾—æ•°æ®ä¸­å¿ƒçš„æ•°é‡éœ€è¦å†ç¿»ä¸€å€æ‰èƒ½å¾—åˆ°æ»¡è¶³ã€‚ç„¶è€Œï¼Œä»æˆæœ¬è¿˜æ˜¯ä»ç®—åŠ›ä¸Šçœ‹ï¼Œå†…éƒ¨ä¸­å¿ƒå·²ä¸èƒ½ä¾é GPUå’ŒCPUæ¥ç»´æŒã€‚åˆ¶é€ èŠ¯ç‰‡çš„å†²åŠ¨å˜æˆäº†ç°å®ã€‚</p>
<p>â€‹    ç§ç§å› ç´ çš„æ¨åŠ¨ä¸‹ï¼Œä¸å·®é’±çš„è°·æ­Œæ­£å¼å¼€å§‹äº†TPUçš„ç ”å‘ä¹‹æ—…ã€‚ç»è¿‡ç ”å‘äººå‘˜15ä¸ªæœˆçš„è®¾è®¡ã€éªŒè¯å’Œæ„å»ºï¼ŒTPU 2014å¹´ç ”å‘å®Œæˆï¼Œç‡å…ˆéƒ¨ç½²åœ¨è°·æ­Œå†…éƒ¨çš„æ•°æ®ä¸­å¿ƒã€‚è°·æ­Œå¼ºå¤§çš„è´¢åŠ›ä¿è¯äº†ç ”å‘çš„æˆåŠŸï¼ŒæˆåŠŸå¾ˆå¤§ç¨‹åº¦æºäºä¸å·®é’±ã€‚</p>
<p>â€‹    å†…éƒ¨ç§˜å¯†è¿è¡Œäº†ä¸€å¹´å¤–ï¼Œè°·æ­ŒTPUè¿˜åœ¨å›´æ£‹ç•Œâ€œå¤§æ€å››æ–¹â€ï¼Œæ–©è·â€œäººæœºå¤§æˆ˜â€çš„ç¥è¯ã€‚åœ¨ä»Šå¤©ï¼Œè°·æ­Œè¿˜æœ‰å¤šå°‘æŠ€æœ¯ï¼Œè¿˜è£…åœ¨é»‘åŒ£å­ä¸­å‘¢ï¼Ÿ</p>
<p>â€‹    ä½¿ç”¨TPUä¹‹å‰ï¼ŒAlphaGoå†…ç½®1202ä¸ªCPUå’Œ176ä¸ªGPUå‡»è´¥æ¬§æ´²å† å†›èŒƒæƒ ã€‚2015å¹´ä¸æä¸–çŸ³å¯¹æˆ˜æ—¶ï¼ŒAlphaGoæ‰å¼€å§‹ä½¿ç”¨TPUï¼Œè€Œå½“æ—¶éƒ¨ç½²çš„TPUæ•°é‡ï¼Œåªæœ‰48ä¸ªã€‚TPUå¤§å¼€æ€æˆ’ï¼Œè¿›å…¥æ— äººä¹‹å¢ƒã€‚</p>
<p>â€‹    è¿™åœºå¯¹æˆ˜èƒœåˆ©çš„â€œç§˜å¯†æ­¦å™¨â€ä¹Ÿåœ¨ä¸€å¹´åçš„è°·æ­ŒI&#x2F;Oå¼€å‘è€…å¤§ä¼šä¸Šè¢«æ­å¼€ç¥ç§˜é¢çº±ï¼ŒTPUæ­£å¼é¢ä¸–ã€‚åœ¨æŠ€æœ¯ä¸Šï¼Œè°·æ­Œéšè—çš„å¤ªæ·±ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150990.png" alt="img"></p>
<h4 id="7-5-1-2ã€è°·æ­ŒTPUçš„è¿­ä»£ã€äº‘ç«¯æ„å»ºã€ç»ˆç«¯åº”ç”¨"><a href="#7-5-1-2ã€è°·æ­ŒTPUçš„è¿­ä»£ã€äº‘ç«¯æ„å»ºã€ç»ˆç«¯åº”ç”¨" class="headerlink" title="7.5.1.2ã€è°·æ­ŒTPUçš„è¿­ä»£ã€äº‘ç«¯æ„å»ºã€ç»ˆç«¯åº”ç”¨"></a>7.5.1.2ã€è°·æ­ŒTPUçš„è¿­ä»£ã€äº‘ç«¯æ„å»ºã€ç»ˆç«¯åº”ç”¨</h4><p>â€‹    é¢ä¸–åçŸ­çŸ­ä¸¤å¹´ï¼Œè°·æ­ŒTPUå·²ç»è¿­ä»£åˆ°äº†ç¬¬å››ä»£ï¼Œæ€§èƒ½äº¦ä¸æ–­è·ƒå‡ã€‚éšç€ç ”å‘çš„æŠ•å…¥å’Œå¹¿æ³›åº”ç”¨ï¼Œè°·æ­Œä¹Ÿé€æ­¥æ¨å‡ºå¯æ‰©å±•äº‘ç«¯è¶…çº§è®¡ç®—æœºTPU Podï¼Œä»¥åŠEdge TPUã€‚è°·æ­Œæœ€ç»ˆç›®çš„æ˜¯è¶…ç®—é¢†åŸŸä¸äººå·¥æ™ºèƒ½ã€‚ä»Šå¤©ï¼Œè°·æ­Œä¸è‹±ä¼Ÿè¾¾æˆä¸ºè¶…ç®—é¢†åŸŸçš„å¤´ç‹¼ã€‚    </p>
<table>
<thead>
<tr>
<th><strong>åç§°</strong></th>
<th><strong>å‘å¸ƒæ—¥æœŸ</strong></th>
<th><strong>æ€§èƒ½</strong></th>
<th><strong>åº”ç”¨</strong></th>
</tr>
</thead>
<tbody><tr>
<td>TPU V1</td>
<td>2016å¹´</td>
<td>28nm åŠŸè€—40wï¼Œä¸»é¢‘700MHZ</td>
<td>æ·±åº¦å­¦ä¹ æ¨ç†</td>
</tr>
<tr>
<td>TPU V2</td>
<td>2017å¹´</td>
<td>180TFLOPsæµ®ç‚¹è¿ç®—ã€64GBé«˜å¸¦å®½å†…å­˜(HBM)</td>
<td>æœºå™¨å­¦ä¹ è®­ç»ƒå’Œæ¨ç†ï¼Œå¼€å§‹åœ¨Google Compute Engineä¸Šè¿è¡Œï¼Œä»¥ç”¨äºTensorFlowåº”ç”¨ç¨‹åº</td>
</tr>
<tr>
<td>TPU V3</td>
<td>2018å¹´</td>
<td>420TFLOPsæµ®ç‚¹è¿ç®—ï¼Œ128GB(HBM)</td>
<td>æ‰©å±•è‡³æ›´å¹¿æ³›çš„æ·±åº¦å­¦ä¹ è®­ç»ƒå’Œæ¨ç†é¢†åŸŸï¼Œå·²è¿›å…¥Alphaæµ‹è¯•é˜¶æ®µã€‚</td>
</tr>
<tr>
<td>EDGE TPU</td>
<td>2018å¹´</td>
<td>å†…å»ºEDGE TPUã€ç½‘ç»œåŠŸèƒ½å’ŒåŠ å¯†èŠ¯ç‰‡ï¼Œå…·æœ‰é«˜ååé‡ã€‚</td>
<td>ä¼ä¸šä¸­çš„æœºå™¨å­¦ä¹ ä»»åŠ¡è€Œè®¾è®¡ï¼Œä¸»è¦æ‰§è¡ŒAIæ¨ç†ã€‚</td>
</tr>
<tr>
<td>TPU V2 POD</td>
<td>2019å¹´</td>
<td>æ¯ç§’11.5åƒä¸‡äº¿æ¬¡æµ®ç‚¹è¿ç®—ï¼Œ4TB (HBM)ã€ç¯é¢ç½‘çŠ¶ç½‘ç»œ</td>
<td>æ·±åº¦å­¦ä¹ é¢†åŸŸ</td>
</tr>
<tr>
<td>TPU V3 POD</td>
<td>2019å¹´</td>
<td>æ¯ç§’100åƒä¸‡äº¿æ¬¡æµ®ç‚¹è¿ç®—ã€32TB(HBM)ï¼Œç¯é¢ç½‘çŠ¶ç½‘ç»œã€‚</td>
<td>æ·±åº¦å­¦ä¹ é¢†åŸŸ</td>
</tr>
</tbody></table>
<h5 id="7-5-1-2-1ã€2016å¹´ï¼šç¬¬ä¸€ä»£TPU"><a href="#7-5-1-2-1ã€2016å¹´ï¼šç¬¬ä¸€ä»£TPU" class="headerlink" title="7.5.1.2.1ã€2016å¹´ï¼šç¬¬ä¸€ä»£TPU"></a>7.5.1.2.1ã€2016å¹´ï¼šç¬¬ä¸€ä»£TPU</h5><p>â€‹    ä¸ºç¥ç»ç½‘ç»œè€Œç ”å‘ï¼Œä½†è°·æ­Œæœ€åˆçš„ç¬¬ä¸€ä»£TPUä»…ç”¨äºæ·±åº¦å­¦ä¹ æ¨ç†ã€‚ä»æ€§èƒ½ä¸Šçœ‹ï¼Œç¬¬ä¸€ä»£è°·æ­ŒTPUé‡‡ç”¨äº†28nmå·¥è‰ºåˆ¶é€ ï¼ŒåŠŸè€—çº¦ä¸º40Wï¼Œä¸»é¢‘700MHzã€‚</p>
<p>â€‹    ç ”å‘ä¹‹åˆï¼Œè°·æ­Œéœ€è¦å°½å¿«å°†TPUéƒ¨ç½²åˆ°å†…éƒ¨ç°æœ‰çš„æœåŠ¡å™¨ä¸­ï¼Œå› æ­¤ç ”å‘äººå‘˜é€‰æ‹©å°†å¤„ç†å™¨æ‰“åŒ…æˆå¤–éƒ¨åŠ é€Ÿå¡ï¼Œä»¥æ’å…¥SATAç¡¬ç›˜æ’æ§½åè¿›è¡ŒåµŒå…¥å¼å®‰è£…ã€‚æ¯«æ— ç–‘é—®çš„æ˜¯ï¼Œè¿™ç§è®¾è®¡æ˜¯æˆåŠŸçš„ï¼Œå¹¶å¾ˆå¿«æŠ•å…¥äº†åº”ç”¨ã€‚</p>
<p>â€‹    TPUé€šè¿‡PCIe Gen3 x16æ€»çº¿è¿æ¥åˆ°ä¸»æœºï¼Œå®ç°äº†12.5GB&#x2F;sçš„æœ‰æ•ˆå¸¦å®½ã€‚é™¤äº†åœ¨AlphaGoä¸Šåº”ç”¨ä¹‹å¤–ï¼Œè°·æ­Œç¬¬ä¸€ä»£TPUè¿˜ç”¨äºè°·æ­Œçš„æœç´¢ã€ç¿»è¯‘å’Œç›¸å†Œç­‰åº”ç”¨çš„æœºå™¨å­¦ä¹ æ¨¡å‹ä¸­ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150272.png" alt="img"></p>
<p>â€‹    â–²Googleç¬¬ä¸€ä»£TPUï¼ˆå·¦ï¼‰ï¼Œåœ¨è°·æ­Œæ•°æ®ä¸­å¿ƒä¸­éƒ¨ç½²çš„TPUï¼ˆå³ï¼‰</p>
<h5 id="7-5-1-2-2ã€2017å¹´ï¼šç¬¬äºŒä»£TPUï¼Œå¼•å…¥Google-Cloud"><a href="#7-5-1-2-2ã€2017å¹´ï¼šç¬¬äºŒä»£TPUï¼Œå¼•å…¥Google-Cloud" class="headerlink" title="7.5.1.2.2ã€2017å¹´ï¼šç¬¬äºŒä»£TPUï¼Œå¼•å…¥Google Cloud"></a>7.5.1.2.2ã€2017å¹´ï¼šç¬¬äºŒä»£TPUï¼Œå¼•å…¥Google Cloud</h5><p>â€‹    ä¸€å¹´æ›´æ–°ã€ç ”å‘å’Œè¿­ä»£ï¼Œè°·æ­Œåœ¨2017å¹´5æœˆå‘å¸ƒäº†ç¬¬äºŒä»£TPUï¼Œå¹¶ä»è¿™ä¸€ä»£èµ·èƒ½å¤Ÿç”¨äºæœºå™¨å­¦ä¹ æ¨¡å‹çš„è®­ç»ƒå’Œæ¨ç†ã€‚</p>
<p>â€‹    ä¸ç¬¬ä¸€ä»£ç›¸æ¯”ï¼Œç¬¬äºŒä»£TPUå®ç°180TFLOPsæµ®ç‚¹è¿ç®—çš„è®¡ç®—èƒ½åŠ›ï¼ŒåŒæ—¶å…¶é«˜å¸¦å®½å†…å­˜ï¼ˆHBMï¼‰ä¹Ÿæå‡åˆ°äº†64GBï¼Œè§£å†³äº†ç¬¬ä¸€ä»£TPUå†…å­˜å—å¸¦å®½é™åˆ¶çš„é—®é¢˜ã€‚ç”µå­ç¡¬ä»¶çš„å‘å±•å ªç§°ç¥é€Ÿã€‚</p>
<p>â€‹    è¿è¡ŒAIå·¥ä½œè´Ÿè½½ä¸Šï¼Œè°·æ­Œç¬¬äºŒä»£TPUä¸åŒæœŸçš„CPUã€GPUç›¸æ¯”ï¼Œæ€§èƒ½æ¯”ä¼ ç»Ÿçš„GPUé«˜äº†15å€ï¼Œæ¯”CPUé«˜äº†30å€ï¼Œæ¯ç“¦æ€§èƒ½äº¦æé«˜äº†30è‡³80å€ã€‚ç¡¬ä»¶æœ‰å¼ºå¤§çš„æå‡ç©ºé—´ï¼Œä¿éšœè°·æ­Œæ€æƒ³çš„å®ç°ã€‚</p>
<p>â€‹    ä»ç¬¬äºŒä»£TPUèµ·ï¼Œè°·æ­Œç¬¬äºŒä»£TPUå¼•å…¥Google Cloudï¼Œåº”ç”¨åœ¨è°·æ­Œè®¡ç®—å¼•æ“ï¼ˆGoogle Compute Engine ï¼Œç®€ç§°GCEï¼‰ä¸­ï¼Œä¹Ÿç§°ä¸ºCloud TPUï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–è°·æ­Œæœç´¢å¼•æ“ã€Gmailã€YouTubeå’Œå…¶ä»–æœåŠ¡çš„è¿è¡Œã€‚è°·æ­Œé€šè¿‡K8Sè¿›è¡Œäº‘ç«¯è½¯ä»¶æŠ€æœ¯å¤„ç†ï¼ŒTPUæä¾›ç¡¬ä»¶ä¿éšœã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150286.png" alt="img"></p>
<p>â€‹    åŒæ—¶ï¼ŒCloud TPUé€šè¿‡TensorFlowè¿›è¡Œç¼–ç¨‹ï¼Œå¹¶ä¸CPUã€GPUåŠåŸºç¡€è®¾æ–½å’ŒæœåŠ¡ç»“åˆï¼Œä»¥æ ¹æ®ç”¨æˆ·åº”ç”¨éœ€æ±‚æ„å»ºå’Œä¼˜åŒ–æœºå™¨å­¦ä¹ ç³»ç»Ÿã€‚è°·æ­Œåœ¨äº‘ä¸Šçš„æŠ€æœ¯é“ºå«æ·±åšï¼Œè°·æ­Œæœªæ¥çš„ä¸»æˆ˜åœºæ˜¯äº‘ç«¯ã€‚</p>
<p>â€‹    è°·æ­Œç¬¬äºŒä»£TPUçš„å‘å¸ƒï¼Œæ–°ä¸€è½®çš„äººæœºå¤§æˆ˜ä¹Ÿå†æ¬¡æ­å¼€åºå¹•ã€‚è€Œè¿™ä¸€ä»£AlphaGoçš„èŠ¯ç‰‡é…ç½®ï¼Œä»…ç”¨äº†4å—TPUv2ï¼Œå‡»è´¥å½“æ—¶çš„ä¸–ç•Œå›´æ£‹å† å†›æŸ¯æ´ã€‚</p>
<p>â€‹    è°·æ­Œé™¤äº†æ¨å‡ºç¬¬äºŒä»£TPUå¤–ï¼Œè¿˜å®£å¸ƒè®¡åˆ’ç ”å‘å¯æ‰©å±•äº‘ç«¯è¶…çº§è®¡ç®—æœºTPU Podsï¼Œé€šè¿‡æ–°çš„è®¡ç®—æœºç½‘ç»œå°†64å—Cloud TPUç›¸ç»“åˆï¼Œèƒ½å¤Ÿæä¾›çº¦11500ä¸‡äº¿æ¬¡æµ®ç‚¹è¿ç®—èƒ½åŠ›ã€‚å¼ºå¤§çš„è¿ç®—èƒ½åŠ›ä¸ºè°·æ­Œå¹³å°æä¾›äº†æŠ€æœ¯ä¿éšœã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150307.png" alt="img"></p>
<h5 id="7-5-1-2-3ã€2018å¹´ï¼šç¬¬ä¸‰ä»£TPUï¼Œè¾¹ç¼˜AIèŠ¯ç‰‡Edge-TPU"><a href="#7-5-1-2-3ã€2018å¹´ï¼šç¬¬ä¸‰ä»£TPUï¼Œè¾¹ç¼˜AIèŠ¯ç‰‡Edge-TPU" class="headerlink" title="7.5.1.2.3ã€2018å¹´ï¼šç¬¬ä¸‰ä»£TPUï¼Œè¾¹ç¼˜AIèŠ¯ç‰‡Edge TPU"></a>7.5.1.2.3ã€2018å¹´ï¼šç¬¬ä¸‰ä»£TPUï¼Œè¾¹ç¼˜AIèŠ¯ç‰‡Edge TPU</h5><p>â€‹    2018å¹´5æœˆï¼Œè°·æ­Œä¸å‡ºæ„å¤–åœ°å‘å¸ƒäº†ç¬¬ä¸‰ä»£TPUï¼Œå…¶å„æ–¹é¢æ€§èƒ½ä¸ä»…å®ç°äº†å‡çº§ï¼Œä¹Ÿè¿›ä¸€æ­¥æ‰©å±•åˆ°æ›´å¹¿æ³›çš„æ·±åº¦å­¦ä¹ è®­ç»ƒå’Œæ¨ç†é¢†åŸŸã€‚æˆ‘ä»¬æ€€ç–‘çš„æ˜¯ï¼Œç¬¬ä¸‰ä»£TPUåº”è¯¥åœ¨2017å¹´ç ”å‘å®Œæˆã€‚</p>
<p>â€‹    è°·æ­Œè¡¨ç¤ºï¼Œç¬¬ä¸‰ä»£TPUçš„æ€§èƒ½å‡æ˜¯ç¬¬äºŒä»£TPUçš„ä¸¤å€ï¼Œå¯å®ç°420TFLOPsæµ®ç‚¹è¿ç®—ï¼Œä»¥åŠ128GBçš„é«˜å¸¦å®½å†…å­˜ã€‚åŒæ—¶ï¼Œå®ƒè¿˜å¯éƒ¨ç½²åœ¨åŸºäºäº‘è®¡ç®—çš„è¶…çº§è®¡ç®—æœºTPU Podä¸­ï¼Œå…¶ä¸­çš„èŠ¯ç‰‡æ•°é‡æ˜¯ä¸Šä¸€ä»£çš„å››å€ã€‚è¿™äº›æ•°æ®è¡¨æ˜ï¼Œå¾®ç”µå­æŠ€æœ¯çš„å‘å±•æ–¹å…´æœªè‰¾ã€‚</p>
<p>â€‹    ä¸ç¬¬äºŒä»£TPU Podçš„éƒ¨ç½²ç›¸æ¯”ï¼Œç¬¬ä¸‰ä»£æ¯ä¸ªPodçš„æ€§èƒ½æé«˜äº†8å€ï¼Œä¸”æ¯ä¸ªPodæœ€å¤šæ‹¥æœ‰1024ä¸ªèŠ¯ç‰‡ã€‚è¿™äº›TPUçš„é›†ç¾¤ï¼Œå½¢æˆäº†å¼ºå¤§çš„ç‹¼ç¾¤å¹¶è¡Œå¤„ç†èƒ½åŠ›ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150437.png" alt="img"></p>
<p>â€‹    è°·æ­Œ2018å¹´å‘å¸ƒäº†ç”¨äºè¾¹ç¼˜æ¨ç†çš„å¾®å‹AIåŠ é€ŸèŠ¯ç‰‡â€”â€”Edge TPUï¼Œä¸“ä¸ºä¼ä¸šæœºå™¨å­¦ä¹ ä»»åŠ¡è€Œè®¾è®¡ï¼Œç”¨äºIoTè®¾å¤‡ä¸­ã€‚å¸‚åœºæ˜¯ç»†åˆ†çš„ï¼ŒæŠ€æœ¯å¿…é¡»æ ¹æ®å¸‚åœºå˜åŠ¨ã€‚</p>
<p>â€‹    Edge TPUåŒæ ·æ˜¯ä¸€æ¬¾ASICèŠ¯ç‰‡ã€‚ä»åº”ç”¨ä¸Šçœ‹ï¼Œå®ƒä¸Cloud TPUç›¸äº’è¡¥ï¼Œç”¨æˆ·èƒ½å¤Ÿå…ˆä½¿ç”¨Cloud TPUå¯¹æœºå™¨å­¦ä¹ æ¨¡å‹è¿›è¡ŒåŠ é€Ÿè®­ç»ƒï¼Œå†å°†è®­ç»ƒå¥½çš„æ¨¡å‹æ”¾å…¥ç›¸å…³è®¾å¤‡ä¸­ï¼Œè¿›ä¸€æ­¥ç”¨Edge TPUè¿›è¡Œæœºå™¨å­¦ä¹ æ¨ç†ã€‚TPUçš„èŠ¯ç‰‡å‘çºµæ·±å‘å±•ã€‚</p>
<p>â€‹    æ®äº†è§£ï¼ŒEdge TPUèƒ½å¤Ÿè®©IoTè®¾å¤‡ä»¥æ¯ç§’30å¸§ä»¥ä¸Šçš„é€Ÿåº¦ï¼Œåœ¨é«˜åˆ†è¾¨ç‡è§†é¢‘ä¸Šè¿è¡Œå¤šä¸ªå…ˆè¿›çš„è®¡ç®—æœºè§†è§‰æ¨¡å‹ã€‚æ•°æ®å¤„ç†é‡è¦çš„ä¸€éƒ¨åˆ†æ˜¯è®¡ç®—æœºè§†è§‰ï¼Œè°·æ­ŒTPUè¿™ç§æŠ€æœ¯ï¼Œå¾ˆå¯èƒ½åœ¨æœªæ¥çš„æŸä¸€å¤©ï¼Œè¿™äº›ç¡¬ä»¶äº§å“å‡ºç°åœ¨æˆ‘ä»¬èº«è¾¹ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150332.png" alt="img"></p>
<p>â€‹    è°·æ­Œè¿˜ä¸ºEdge TPUæ¨å‡ºäº†ä¸€å¥—åä¸ºCloud IoT Edgeçš„è½¯ä»¶å¹³å°ï¼Œè¯¥å¹³å°æ‹¥æœ‰Edge IoT Coreå’ŒEdge MLä¸¤å¤§ä¸»è¦ç»„ä»¶ï¼Œèƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·å°†åœ¨Google Cloudä¸Šæ„å»ºå’Œè®­ç»ƒçš„æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œé€šè¿‡Edge TPUæ‰©å±•åˆ°è¾¹ç¼˜è®¾å¤‡ä¸­è¿è¡Œã€‚æŠ€æœ¯çš„å¼€æºæ˜¯æœªæ¥çš„å‘å±•è¶‹åŠ¿ï¼Œè½¯ä»¶å¹³å°çš„å‡ºç°ï¼Œä¸ºè°·æ­ŒæŠ€æœ¯çš„æ¨å¹¿æ¨æ³¢åŠ©æ¾œã€‚</p>
<h5 id="7-5-1-2-4ã€2019å¹´ï¼šç¬¬äºŒ-ä¸‰ä»£TPU-Pod"><a href="#7-5-1-2-4ã€2019å¹´ï¼šç¬¬äºŒ-ä¸‰ä»£TPU-Pod" class="headerlink" title="7.5.1.2.4ã€2019å¹´ï¼šç¬¬äºŒ&#x2F;ä¸‰ä»£TPU Pod"></a>7.5.1.2.4ã€2019å¹´ï¼šç¬¬äºŒ&#x2F;ä¸‰ä»£TPU Pod</h5><p>â€‹    è¿™ä¸€å¹´è°·æ­Œå¹¶æœªå‘å¸ƒç¬¬å››ä»£TPUï¼Œå´ä¸Šæ¼”äº†å¦ä¸€ä¸ªé‡å¤´æˆâ€”â€”å‘å¸ƒç¬¬äºŒä»£å’Œç¬¬ä¸‰ä»£TPU Podï¼Œå¯ä»¥é…ç½®è¶…è¿‡1000é¢—TPUã€‚å¼ºå¤§çš„é›†ç¾¤å¸¦æ¥äº†å¼ºå¤§çš„æ€§èƒ½ï¼Œåœ¨ç¡¬ä»¶æŠ€æœ¯çªç ´çš„åŒæ—¶ï¼Œè°·æ­Œåœ¨è½¯ä»¶é›†ç¾¤æŠ€æœ¯ä¸Šä¹Ÿåœ¨è¿›è¡Œç€å‘å±•ã€‚</p>
<p>â€‹    ä½œä¸ºTPUçš„â€œå‡çº§ç‰ˆâ€ï¼Œè°·æ­Œç¬¬äºŒä»£TPU Podèƒ½å¤Ÿå®¹çº³512ä¸ªå†…æ ¸ï¼Œå®ç°æ¯ç§’11.5åƒä¸‡äº¿æ¬¡æµ®ç‚¹è¿ç®—ï¼›ç¬¬ä¸‰ä»£TPU Podé€Ÿåº¦åˆ™æ›´å¿«ï¼Œå¯å®ç°æ¯ç§’è¶…è¿‡100åƒä¸‡äº¿æ¬¡æµ®ç‚¹è¿ç®—ã€‚è¿™æ¬¡å‡çº§ä¹‹åï¼Œæˆ‘ä»¬æœŸå¾…ç€è°·æ­Œæ–°ä¸€ä»£TPUçš„å‘å¸ƒï¼Œç›¸ä¿¡å¸¦æ¥æ›´å¼ºå¤§çš„æ€§èƒ½ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150336.png" alt="img"></p>
<p>â€‹    æ®æ‚‰ï¼Œåœ¨ç›¸åŒé…ç½®ï¼ˆ265å—TPUï¼‰ä¸‹è®­ç»ƒResNet-50æ¨¡å‹æ—¶ï¼Œç¬¬äºŒä»£TPU Podéœ€è¦11.3åˆ†é’Ÿï¼Œè€Œç¬¬ä¸‰ä»£TPU Podåªéœ€7.1åˆ†é’Ÿã€‚è¿™äº›æ•°æ®çš„èƒŒåï¼Œæ˜¯TPUé›†ç¾¤å¿«é€Ÿå¢é•¿çš„ç»“æœã€‚è®©æˆ‘ä»¬å¾ˆéš¾æƒ³è±¡çš„æ˜¯ï¼Œè°·æ­ŒTPUåœ¨é›†ç¾¤æŠ€æœ¯è·¯ä¸Šè¿˜èƒ½èµ°å¤šè¿œã€‚</p>
<h4 id="7-5-1-3ã€æ¶æ„åˆ›æ–°ï¼Œæ€èµ·äº‘ç«¯é€ èŠ¯å¤§æµªæ½®"><a href="#7-5-1-3ã€æ¶æ„åˆ›æ–°ï¼Œæ€èµ·äº‘ç«¯é€ èŠ¯å¤§æµªæ½®" class="headerlink" title="7.5.1.3ã€æ¶æ„åˆ›æ–°ï¼Œæ€èµ·äº‘ç«¯é€ èŠ¯å¤§æµªæ½®"></a>7.5.1.3ã€æ¶æ„åˆ›æ–°ï¼Œæ€èµ·äº‘ç«¯é€ èŠ¯å¤§æµªæ½®</h4><p>â€‹    è°·æ­ŒTPUç³»åˆ—èŠ¯ç‰‡çš„å‡ºç°ï¼Œä¸ä»…çªç ´äº†æœ€åˆæ·±åº¦å­¦ä¹ ç¡¬ä»¶æ‰§è¡Œçš„ç“¶é¢ˆï¼Œè¿˜åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ’¼åŠ¨äº†è‹±ä¼Ÿè¾¾ã€è‹±ç‰¹å°”ç­‰ä¼ ç»ŸGPUèŠ¯ç‰‡å·¨å¤´çš„åœ°ä½ã€‚è‹±ä¼Ÿè¾¾ã€AMDã€INTELåœ¨PCå¸‚åœºä¸Šè¿™äº›ä¼ ç»Ÿéœ¸ä¸»åœ°ä½å—åˆ°äº†æŒ‘æˆ˜ã€‚</p>
<p>â€‹    2015å¹´ä»¥æ¥ï¼Œä¸AIèŠ¯ç‰‡ç›¸å…³çš„ç ”å‘é€æ¸æˆä¸ºæ•´ä¸ªèŠ¯ç‰‡è¡Œä¸šçš„çƒ­ç‚¹ï¼Œåœ¨äº‘ç«¯çš„æ·±åº¦å­¦ä¹ è®­ç»ƒå’Œæ¨ç†é¢†åŸŸï¼Œå·²ç„¶ä¸æ˜¯GPUï¼Œå°¤å…¶æ˜¯è‹±ä¼Ÿè¾¾ç‹¬éœ¸ä¸€æ–¹ã€‚</p>
<p>â€‹    è°·æ­ŒTPUçš„è¯ç”Ÿï¼Œè¶Šæ¥è¶Šå¤šçš„å…¬å¸å‰èµ´åç»§åœ°å°è¯•è®¾è®¡GPUä¹‹å¤–çš„ä¸“ç”¨AIèŠ¯ç‰‡ï¼Œè¿›ä¸€æ­¥å®ç°æ›´é«˜æ•ˆçš„æ€§èƒ½ã€‚è¿™æ˜¯ä¸€æ¡æˆåŠŸçš„è·¯çº¿ï¼Œç§‘æŠ€å·¨å¤´éƒ½åœ¨è¿›è¡Œç€å°è¯•ã€‚</p>
<p>â€‹    æŠ€æœ¯å±‚é¢çœ‹ï¼Œè°·æ­ŒTPUçš„å‡ºç°åœ¨æ¶æ„åˆ›æ–°ä¸Šä¹Ÿä¸ºè¡Œä¸šå¸¦æ¥äº†ä»¥ä¸‹æ€è€ƒã€‚è¿™ç§å½±å“ï¼Œåœ¨æœªæ¥å‡ åå¹´å°†ä¼šæ·±åˆ»çš„æ„Ÿå—åˆ°ã€‚</p>
<h5 id="7-5-1-3-1ã€å¤§è§„æ¨¡ç‰‡ä¸Šå†…å­˜"><a href="#7-5-1-3-1ã€å¤§è§„æ¨¡ç‰‡ä¸Šå†…å­˜" class="headerlink" title="7.5.1.3.1ã€å¤§è§„æ¨¡ç‰‡ä¸Šå†…å­˜"></a>7.5.1.3.1ã€å¤§è§„æ¨¡ç‰‡ä¸Šå†…å­˜</h5><p>â€‹    è°·æ­Œçœ‹æ¥ï¼Œç‰‡å¤–å†…å­˜ä½æ˜¯GPUèƒ½æ•ˆæ¯”ä½çš„ä¸»è¦åŸå› ã€‚ä¸€äº›GPUç”±äºç‰‡ä¸Šå†…å­˜è¾ƒå°‘ï¼Œå› æ­¤åœ¨è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦ä¸æ–­åœ°å»è®¿é—®ç‰‡å¤–åŠ¨æ€éšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆDRAMï¼‰ï¼Œä»è€Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šæµªè´¹äº†ä¸å¿…è¦çš„èƒ½è€—ã€‚åœ¨ä»å‰ï¼Œå…³äºCPUä¸GPUä¸Šçš„å†…å­˜æ˜¯äº‰è®ºçš„å–‹å–‹ä¸ä¼‘çš„è¯é¢˜ï¼Œåœ¨åŠŸè€—ç­‰å„æ–¹é¢éƒ½æœ‰è€ƒé‡ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150499.png" alt="img"></p>
<p>â€‹    å› æ­¤ï¼Œè°·æ­Œåœ¨æœ€åˆè®¾è®¡TPUæ—¶ï¼Œæ€»å…±è®¾è®¡äº†å æ€»èŠ¯ç‰‡é¢ç§¯37%çš„å†…å­˜ï¼Œå…¶ä¸­åŒ…æ‹¬24MBçš„å±€éƒ¨å†…å­˜ã€6MBçš„ç´¯åŠ å™¨å†…å­˜ï¼Œä»¥åŠç”¨äºä¸ä¸»æ§å¤„ç†å™¨å¯¹æ¥çš„å†…å­˜ã€‚è°·æ­Œåå…¶é“è€Œè¡Œä¹‹ï¼Œç”¨åŠŸè€—æ¢å–æ•ˆç‡ã€‚</p>
<h5 id="7-5-1-3-2ã€ç”¨é‡åŒ–æŠ€æœ¯è¿›è¡Œæ•´æ•°è¿ç®—"><a href="#7-5-1-3-2ã€ç”¨é‡åŒ–æŠ€æœ¯è¿›è¡Œæ•´æ•°è¿ç®—" class="headerlink" title="7.5.1.3.2ã€ç”¨é‡åŒ–æŠ€æœ¯è¿›è¡Œæ•´æ•°è¿ç®—"></a>7.5.1.3.2ã€ç”¨é‡åŒ–æŠ€æœ¯è¿›è¡Œæ•´æ•°è¿ç®—</h5><p>â€‹    ä¸€èˆ¬æ¥è¯´ï¼Œç¥ç»ç½‘ç»œçš„é¢„æµ‹å¹¶ä¸éœ€è¦32ä½æˆ–16ä½çš„æµ®ç‚¹è®¡ç®—ç²¾åº¦ï¼Œå› æ­¤å®ƒå¯ä»¥é€šè¿‡8ä½ä½ç²¾åº¦è¿ç®—çš„æ–¹æ³•ï¼Œåœ¨ä¿è¯é€‚å½“å‡†ç¡®åº¦çš„åŒæ—¶ï¼Œå¯¹ç¥ç»ç½‘ç»œè¿›è¡Œé¢„æµ‹ã€‚è¿™ç§ç²¾ç»†åŒ–çš„è®¾è®¡ï¼Œé€‚åº”äº†ç¥ç»ç½‘ç»œæŠ€æœ¯çš„éœ€æ±‚ã€‚</p>
<p>â€‹    é€šè¿‡é‡åŒ–æŠ€æœ¯ï¼Œç¥ç»ç½‘ç»œé¢„æµ‹çš„æˆæœ¬å¤§å¤§å‡å°‘ï¼Œç›¸åº”å‡å°‘äº†å†…å­˜çš„ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå½“ç ”å‘äººå‘˜å°†é‡åŒ–åº”ç”¨äºæµè¡Œçš„å›¾åƒè¯†åˆ«æ¨¡å‹Inceptionæ—¶ï¼ŒèŠ¯ç‰‡å†…å­˜ä»91MBå‹ç¼©åˆ°äº†23MBï¼Œçº¦ä¸ºå…¶åŸå§‹å¤§å°çš„å››åˆ†ä¹‹ä¸€ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150592.png" alt="img"></p>
<p>â€‹    äººå·¥æ™ºèƒ½æ—¶ä»£æ¯ä¸€ç§ç®—æ³•æ•°æ®éƒ½æœ‰è‡ªå·±çš„ç‰¹ç‚¹ï¼Œç¥ç»ç½‘ç»œä½œä¸ºäººå·¥æ™ºèƒ½çš„ä¸»æµç®—æ³•ï¼Œæœ‰è‡ªå·±çš„è®¡ç®—ç‰¹ç‚¹ï¼Œè°·æ­Œæ·±è°™æ­¤é“ï¼Œå¹¶å¯¹ç¡¬ä»¶æ”¹è¿›ï¼Œå–å¾—äº†GPUçš„æˆåŠŸã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150581.png" alt="img"></p>
<h5 id="7-5-1-3-3ã€å¯ç¼–ç¨‹æ€§"><a href="#7-5-1-3-3ã€å¯ç¼–ç¨‹æ€§" class="headerlink" title="7.5.1.3.3ã€å¯ç¼–ç¨‹æ€§"></a>7.5.1.3.3ã€å¯ç¼–ç¨‹æ€§</h5><p>â€‹    è™½ç„¶è°·æ­ŒTPUæ˜¯ASICèŠ¯ç‰‡ï¼Œä½†å´ä¸FPGAåˆæœ‰äº›ç±»ä¼¼ï¼Œå®ƒå…·å¤‡ä¸€å®šçš„å¯ç¼–ç¨‹æ€§èƒ½åŠ›ã€‚è°·æ­Œçœ‹æ¥ï¼ŒTPUçš„ç ”å‘å¹¶éåªç”¨äºè¿è¡Œä¸€ç§ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚å› æ­¤ï¼Œè°·æ­Œé€‰æ‹©é‡‡ç”¨äº†å¤æ‚æŒ‡ä»¤é›†ï¼ˆCISCï¼‰ä½œä¸ºTPUæŒ‡ä»¤é›†çš„åŸºç¡€ï¼Œèƒ½å¤Ÿè¾ƒä¸ºä¾§é‡åœ°è¿è¡Œæ›´å¤æ‚çš„ä»»åŠ¡ã€‚è½¯ç¡¬ä»¶æŠ€æœ¯çš„ç»“åˆæ˜¯TPUæˆåŠŸçš„å…³é”®å› ç´ ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150636.png" alt="img"></p>
<p>â€‹    è°·æ­Œè¿˜å®šä¹‰äº†åäºŒä¸ªä¸“é—¨ä¸ºç¥ç»ç½‘ç»œæ¨ç†è€Œè®¾è®¡çš„é«˜çº§æŒ‡ä»¤ï¼Œèƒ½å¤Ÿåœ¨è¾“å…¥æ•°æ®å’Œæƒé‡ä¹‹é—´æ‰§è¡ŒçŸ©é˜µä¹˜æ³•ï¼Œå¹¶åº”ç”¨æ¿€æ´»å‡½æ•°ã€‚ä»Šå¤©ï¼Œå›½å†…çš„å­¦ä¹ æ˜¯ä»æŒ‡ä»¤å¼€å§‹èµ·æ­¥ã€‚</p>
<p>â€‹    ä¸ºäº†èƒ½è¿›ä¸€æ­¥å¯¹TPUè¿›è¡Œç¼–ç¨‹ï¼Œè°·æ­Œè¿˜åˆ›å»ºäº†ä¸€ä¸ªç¼–è¯‘å™¨å’Œè½¯ä»¶å †æ ˆï¼Œèƒ½å¤Ÿè°ƒç”¨TensorFlowå›¾ä¸­çš„APIï¼Œè½¬åŒ–æˆTPUæŒ‡ä»¤ã€‚TPUä¸TensorFlowçš„èåˆï¼Œè®©TPUå¼€å§‹æ¥åº•æ°”ï¼Œå¹¶ä¸ºTensorFlowåšå¤§è§„æ¨¡çš„ç¥ç»ç½‘ç»œæ•°æ®è®­ç»ƒæ‰“ä¸‹åŸºç¡€ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150632.png" alt="img"></p>
<h5 id="7-5-1-3-4ã€å¹¶è¡Œè®¡ç®—"><a href="#7-5-1-3-4ã€å¹¶è¡Œè®¡ç®—" class="headerlink" title="7.5.1.3.4ã€å¹¶è¡Œè®¡ç®—"></a>7.5.1.3.4ã€å¹¶è¡Œè®¡ç®—</h5><p>â€‹    è°·æ­Œä¸ºTPUè®¾è®¡äº†çŸ©é˜µä¹˜æ³•å•å…ƒï¼ˆMXUï¼‰çš„å¹¶è¡Œè®¡ç®—ã€‚å¹¶è¡Œè®¡ç®—æ˜¯æ•°æ®å‘å±•çš„è¦æ±‚ï¼Œä»Šå¤©å¹¶è¡Œè®¡ç®—æ˜¯äººå·¥æ™ºèƒ½é¢ä¸´çš„ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150715.png" alt="img"></p>
<p>â€‹    å®ƒèƒ½å¤Ÿåœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…å¤„ç†æ•°åä¸‡æ¬¡çŸ©é˜µè¿ç®—ï¼Œç›¸å½“äºä¸€æ¬¡æ‰“å°ä¸€ä¸ªå­—ç¬¦ã€ä¸€æ¬¡æ‰“å°ä¸€è¡Œå­—æˆ–ä¸€æ¬¡æ‰“å°ä¸€é¡µæ–‡æ¡£ã€‚è¿™ç§é«˜æ•ˆçš„å½¢å¼ï¼Œæ˜¯æˆåŠŸçš„å…³é”®å› ç´ æ‰€åœ¨ã€‚</p>
<h5 id="7-5-1-3-5ã€è„‰åŠ¨é˜µåˆ—è®¾è®¡"><a href="#7-5-1-3-5ã€è„‰åŠ¨é˜µåˆ—è®¾è®¡" class="headerlink" title="7.5.1.3.5ã€è„‰åŠ¨é˜µåˆ—è®¾è®¡"></a>7.5.1.3.5ã€è„‰åŠ¨é˜µåˆ—è®¾è®¡</h5><p>â€‹    MXUå…·æœ‰ä¸ä¼ ç»ŸCPUå’ŒGPUæˆªç„¶ä¸åŒçš„æ¶æ„ï¼Œåˆç§°ä¸ºè„‰åŠ¨é˜µåˆ—ï¼ˆsystolic arrayï¼‰ã€‚ä¸åŒç¡¬ä»¶è®¾è®¡å¸¦æ¥çš„æ•ˆæœæ˜¯æƒŠäººçš„ã€‚</p>
<p>â€‹    è„‰åŠ¨é˜µåˆ—ä½¿å¾—åœ¨æ¯æ¬¡è¿ç®—è¿‡ç¨‹ä¸­ï¼Œè°·æ­ŒTPUèƒ½å¤Ÿå°†å¤šä¸ªè¿ç®—é€»è¾‘å•å…ƒï¼ˆALUï¼‰ä¸²è”åœ¨ä¸€èµ·ï¼Œå¹¶å¤ç”¨ä»ä¸€ä¸ªå¯„å­˜å™¨ä¸­éƒ½å–å¾—ç»“æœã€‚è„‰åŠ¨é˜µåˆ—è®¾è®¡å½¢å¼ï¼Œå¤§å¤§æé«˜äº†æ•ˆç‡ã€‚</p>
<p>â€‹    è¿™ç§è®¾è®¡ï¼Œä¸ä»…èƒ½å¤Ÿå°†æ•°æ®å¤ç”¨å®ç°æœ€å¤§åŒ–ï¼Œå‡å°‘èŠ¯ç‰‡åœ¨è¿ç®—è¿‡ç¨‹ä¸­çš„å†…å­˜è®¿é—®æ¬¡æ•°ï¼ŒåŒæ—¶ä¹Ÿé™ä½äº†å†…å­˜å¸¦å®½å‹åŠ›ï¼Œè¿›è€Œé™ä½å†…å­˜è®¿é—®çš„èƒ½è€—ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150733.png" alt="img"></p>
<p>â€‹    â–²TPUçš„çŸ©é˜µä¹˜æ³•å™¨å•å…ƒï¼ˆMXUï¼‰</p>
<p>â€‹    è°·æ­ŒTPUçš„ä¸€é¸£æƒŠäººï¼Œä¸ä»…ä¸ºAIèŠ¯ç‰‡é¢†åŸŸå¸¦æ¥äº†æ¶æ„åˆ›æ–°ï¼ŒåŒæ—¶äºšé©¬é€Šã€å¾®è½¯ç­‰ä¸€ä¼—ç§‘æŠ€å·¨å¤´ï¼Œä»¥åŠå¯’æ­¦çºªã€å¤©æ•°æ™ºèŠ¯ç­‰æ–°åŠ¿åŠ›äº¦å¼€å§‹çº·çº·å…¥å±€ï¼Œäº‘ç«¯AIèŠ¯ç‰‡å¸‚åœºå¼€å§‹é£èµ·äº‘æ¶Œï¼Œæ€èµ·è¡Œä¸šäº‘ç«¯é€ èŠ¯å¤§æµªæ½®ã€‚</p>
<p>â€‹    è¿™æ˜¯ä¸€ä¸ªèŠ¯ç‰‡åˆ¶é€ çš„å¹´ä»£ï¼Œå¦‚æœæ²¡æœ‰æŠ€æœ¯çš„ç§¯æ·€ä¸é›„åšèµ„æœ¬çš„æ”¯æŒï¼ŒèŠ¯ç‰‡åˆ¶é€ æ˜¯æ°´ä¸­èŠ±ã€é•œä¸­æœˆï¼Œé©å‘½æ€§èŠ¯ç‰‡çš„ç ”å‘æŠ•å…¥åœ¨ç™¾äº¿ä»¥ä¸Šã€‚å›½å†…çš„å¼˜èŠ¯ã€é¾™èŠ¯å€¼å¾—æˆ‘ä»¬æ·±æ€ã€‚</p>
<h3 id="7-5-2ã€TPUä¸æœºå™¨å­¦ä¹ "><a href="#7-5-2ã€TPUä¸æœºå™¨å­¦ä¹ " class="headerlink" title="7.5.2ã€TPUä¸æœºå™¨å­¦ä¹ "></a>7.5.2ã€TPUä¸æœºå™¨å­¦ä¹ </h3><p>â€‹    TPUçš„å‡ºç°ï¼ŒåŠ é€Ÿäº†ç¬¬äºŒä»£äººå·¥æ™ºèƒ½ç³»ç»ŸTensorFlowçš„è¿è¡Œï¼Œæ•ˆç‡ä¹Ÿå¤§å¤§è¶…è¿‡GPU,Googleçš„æ·±å±‚ç¥ç»ç½‘ç»œç”±TensorFlowå¼•æ“é©±åŠ¨ã€‚TPUæ˜¯ä¸“ä¸ºæœºå™¨å­¦ä¹ é‡èº«å®šåšï¼Œæ‰§è¡Œæ¯ä¸ªæ“ä½œæ‰€éœ€çš„æ™¶ä½“ç®¡æ•°é‡æ›´å°‘ï¼Œè‡ªç„¶æ•ˆç‡æ›´é«˜ã€‚è¡¥å……è¯´æ˜çš„æ˜¯ï¼Œèƒ½è€—ä¹Ÿæ›´é«˜ã€‚</p>
<p>â€‹    TPUä¸åŒæœŸçš„CPUå’ŒGPUç›¸æ¯”ï¼Œå¯ä»¥æä¾›15-30å€çš„æ€§èƒ½æå‡ï¼Œä»¥åŠ30-80å€çš„æ•ˆç‡ï¼ˆæ€§èƒ½&#x2F;ç“¦ç‰¹ï¼‰æå‡ã€‚åœ¨äººå·¥æ™ºèƒ½å‘å±•è¿‡ç¨‹ä¸­ï¼Œæ•ˆç‡çš„æå‡å¯ä»¥å¯¹ç®—æ³•è¿›è¡Œæœ‰æ•ˆçš„æµ‹è¯•ã€‚ç”±äºæ•ˆç‡é—®é¢˜ï¼Œå¾ˆå¤šç®—æ³•æš‚æ—¶æ— æ³•æµ‹è¯•ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150794.png" alt="img"></p>
<p>â€‹    TPUæ¯ç“¦èƒ½ä¸ºæœºå™¨å­¦ä¹ æä¾›æ¯”æ‰€æœ‰å•†ç”¨GPUå’ŒFPGAæ›´é«˜çš„é‡çº§æŒ‡ä»¤ï¼Œé«˜æ€§èƒ½è®¡ç®—å¾—ä»¥åœ¨æ°‘é—´åº”ç”¨ã€‚TPUä¸ºæœºå™¨å­¦ä¹ åº”ç”¨ç‰¹åˆ«å¼€å‘ï¼Œä½¿èŠ¯ç‰‡åœ¨è®¡ç®—ç²¾åº¦é™ä½çš„æƒ…å†µä¸‹æ›´è€ç”¨ã€‚</p>
<p>â€‹    åœ¨äººå·¥æ™ºèƒ½å¹´ä»£ï¼Œæœªæ¥ï¼ŒæŒ‡ä»¤çº§ç¼–ç¨‹å°†ç§°ä¸ºå¸¸æ€ã€‚å¯¹äºå›½å†…å¤§å¤šæ•°æŠ€æœ¯äººå‘˜è€Œè¨€ï¼Œå¯¹æŒ‡ä»¤çš„ç†Ÿæ‚‰ç¨‹åº¦å½±å“ç€ä¸ªäººæŠ€æœ¯çš„å‘å±•ã€‚</p>
<p>â€‹    æ¯ä¸€ä¸ªæ“ä½œåªéœ€è¦æ›´å°‘çš„æ™¶ä½“ç®¡ï¼Œç”¨æ›´å¤šç²¾å¯†ä¸”å¤§åŠŸç‡çš„æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œå¹¶å¿«é€Ÿåº”ç”¨è¿™äº›æ¨¡å‹ï¼Œå› æ­¤ç”¨æˆ·ä¾¿èƒ½å¾—åˆ°æ›´æ­£ç¡®çš„ç»“æœã€‚</p>
<h3 id="7-5-3ã€å¯¹æ¯”è¯´æ˜"><a href="#7-5-3ã€å¯¹æ¯”è¯´æ˜" class="headerlink" title="7.5.3ã€å¯¹æ¯”è¯´æ˜"></a>7.5.3ã€å¯¹æ¯”è¯´æ˜</h3><p>â€‹    CPUå’ŒGPUéƒ½æ˜¯è¾ƒä¸ºé€šç”¨çš„èŠ¯ç‰‡ï¼Œä½†æ˜¯æœ‰å¥è€è¯æ˜¯è¿™æ ·è®²çš„ï¼šä¸‡èƒ½å·¥å…·çš„æ•ˆç‡æ°¸è¿œæ¯”ä¸ä¸Šä¸“ç”¨å·¥å…·ã€‚è€ŒTPUå°±æ˜¯ä¸€ä¸ªä¸“ä¸šå·¥å…·ã€‚</p>
<p>â€‹    éšç€ç¤¾ä¼šçš„è®¡ç®—éœ€æ±‚è¶Šæ¥è¶Šä¸“ä¸šåŒ–ï¼ŒèŠ¯ç‰‡çš„ä¸“ä¸šåŒ–éœ€æ±‚åœ¨å¢å¼ºã€‚ä¾¿äº§ç”Ÿäº†ASICï¼ˆä¸“ç”¨é›†æˆç”µè·¯ï¼‰çš„æ¦‚å¿µã€‚è¿™ä¸ªæ¦‚å¿µå…¶å®å¾ˆæ—©å°±å‡ºç°äº†ï¼Œä½†æ˜¯ASICä¸æ˜¯ä»»ä½•ä¸€å®¶å…¬å¸éƒ½èƒ½å°è¯•çš„ï¼Œå…¶å¤æ‚ç¨‹åº¦ã€é›†æˆç¨‹åº¦å ªç§°æŠ€æœ¯çš„å ¡å’ã€‚</p>
<p>â€‹    ASICæ˜¯æŒ‡ä¾äº§å“éœ€æ±‚ä¸åŒè€Œå®šåˆ¶åŒ–çš„ç‰¹æ®Šè§„æ ¼é›†æˆç”µè·¯ï¼Œç”±ç‰¹å®šä½¿ç”¨è€…è¦æ±‚å’Œç‰¹å®šç”µå­ç³»ç»Ÿçš„éœ€è¦è€Œè®¾è®¡ã€åˆ¶é€ ã€‚è¿™äº›æ˜¯å®šåˆ¶åŒ–çš„èŠ¯ç‰‡å¼€å‘ï¼Œå®šåˆ¶åŒ–çš„èŠ¯ç‰‡å¼€å‘ä¸€ç›´å¹¿æ³›å­˜åœ¨ã€‚åœ¨è¿™ä¸ªé¢†åŸŸï¼Œè°·æ­Œçš„TPUæŠ€æœ¯æ˜¯æˆåŠŸçš„å°è¯•ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150880.png" alt="img"></p>
<p>â€‹    å› ä¸ºASICå¾ˆâ€œä¸“ä¸€â€ï¼Œåªåšä¸€ä»¶äº‹ï¼Œå®ƒå°±æ¯”CPUã€GPUç­‰èƒ½åšå¾ˆå¤šä»¶äº‹çš„èŠ¯ç‰‡åœ¨æŸä»¶äº‹ä¸Šåšçš„æ›´å¥½ï¼Œå®ç°æ›´é«˜çš„å¤„ç†é€Ÿåº¦å’Œæ›´ä½çš„èƒ½è€—ã€‚ç›¸åº”çš„ï¼ŒASICçš„ç”Ÿäº§æˆæœ¬ä¹Ÿéå¸¸é«˜ã€‚</p>
<p>â€‹    TPUå°±æ˜¯è°·æ­Œä¸“é—¨ä¸ºåŠ é€Ÿæ·±å±‚ç¥ç»ç½‘ç»œè¿ç®—èƒ½åŠ›è€Œç ”å‘çš„ä¸€æ¬¾èŠ¯ç‰‡ï¼Œå…¶å®ä¹Ÿæ˜¯ä¸€æ¬¾ASICã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150903.png" alt="img"></p>
<p>â€‹    å›¾ï¼šè°·æ­Œç¬¬äºŒä»£TPU</p>
<p>â€‹    åŸæ¥å¾ˆå¤šçš„æœºå™¨å­¦ä¹ ä»¥åŠå›¾åƒå¤„ç†ç®—æ³•å¤§éƒ¨åˆ†éƒ½è·‘åœ¨GPUä¸FPGAï¼ˆåŠå®šåˆ¶åŒ–èŠ¯ç‰‡ï¼‰ä¸Šé¢ï¼Œä½†è¿™ä¸¤ç§èŠ¯ç‰‡éƒ½è¿˜æ˜¯ä¸€ç§é€šç”¨æ€§èŠ¯ç‰‡ï¼Œåœ¨æ•ˆèƒ½ä¸åŠŸè€—ä¸Šä¸èƒ½æ›´ç´§å¯†çš„é€‚é…æœºå™¨å­¦ä¹ ç®—æ³•ã€‚ç¡¬ä»¶æ”¹å˜çš„åˆè¡·ä¾¿å½¢æˆäº†</p>
<p>â€‹    Googleä¸€ç›´åšä¿¡ä¼Ÿå¤§çš„è½¯ä»¶å°†åœ¨ä¼Ÿå¤§çš„ç¡¬ä»¶çš„å¸®åŠ©ä¸‹æ›´åŠ å¤§æ”¾å¼‚å½©ï¼Œæ‰€ä»¥Googleä¾¿æƒ³ï¼Œå¯ä¸å¯ä»¥åšå‡ºä¸€æ¬¾ä¸“ç”¨æœºæœºå™¨å­¦ä¹ ç®—æ³•çš„ä¸“ç”¨èŠ¯ç‰‡ï¼ŒTPUä¾¿è¯ç”Ÿäº†ã€‚</p>
<p>â€‹    æ®ç§°ï¼ŒTPUä¸åŒæœŸçš„CPUå’ŒGPUç›¸æ¯”ï¼Œå¯æä¾›15-30å€çš„æ€§èƒ½æå‡ï¼Œä»¥åŠ30-80å€çš„æ•ˆç‡ï¼ˆæ€§èƒ½&#x2F;ç“¦ç‰¹ï¼‰æå‡ã€‚ç¬¬ä¸€ä»£TPUåªèƒ½åšæ¨ç†ï¼Œä¾é Googleäº‘å®æ—¶æ”¶é›†æ•°æ®å¹¶äº§ç”Ÿç»“æœï¼Œè®­ç»ƒè¿‡ç¨‹è¿˜éœ€è¦é¢å¤–çš„èµ„æºï¼›ç¬¬äºŒä»£TPUæ—¢å¯ä»¥ç”¨äºè®­ç»ƒç¥ç»ç½‘ç»œï¼Œåˆå¯ä»¥ç”¨äºæ¨ç†ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150940.png" alt="img"></p>
<p>â€‹    å›¾ï¼šTPU å„æ¨¡å—çš„æ¡†å›¾</p>
<p>â€‹    å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒTPUåœ¨èŠ¯ç‰‡ä¸Šä½¿ç”¨äº†é«˜è¾¾24MBçš„å±€éƒ¨å†…å­˜ï¼Œ6MBçš„ç´¯åŠ å™¨å†…å­˜ä»¥åŠç”¨äºä¸ä¸»æ§å¤„ç†å™¨è¿›è¡Œå¯¹æ¥çš„å†…å­˜ï¼Œæ€»å…±å èŠ¯ç‰‡é¢ç§¯çš„37%ï¼ˆå›¾ä¸­è“è‰²éƒ¨åˆ†ï¼‰ã€‚è¿™åœ¨ä»å‰æ˜¯ä¸å¯æƒ³è±¡çš„ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150992.png" alt="img"></p>
<p>â€‹    å›¾ï¼šTPUèŠ¯ç‰‡å¸ƒå±€å›¾</p>
<p>â€‹    è¿™è¡¨ç¤ºè°·æ­Œå……åˆ†æ„è¯†åˆ°äº†ç‰‡å¤–å†…å­˜è®¿é—®æ˜¯GPUèƒ½æ•ˆæ¯”ä½çš„é—®é¢˜æ‰€åœ¨ï¼Œä¸æƒœæˆæœ¬çš„åœ¨èŠ¯ç‰‡ä¸Šæ”¾äº†å·¨å¤§çš„å†…å­˜ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒåŒæ—¶æœŸè‹±ä¼Ÿè¾¾çš„K80åªæœ‰8MBç‰‡ä¸Šå†…å­˜ï¼Œéœ€è¦ä¸æ–­åœ°å»è®¿é—®ç‰‡å¤–DRAMã€‚è¿™ç§è®¾è®¡ï¼Œå’Œä¼ ç»Ÿç¡¬ä»¶è®¾è®¡æœ‰å·¨å¤§çš„åŒºåˆ«ï¼Œä¹Ÿè®¸åªæœ‰è°·æ­Œè´¢å¤§æ°”ç²—çš„å…¬å¸æ‰æœ‰å¦‚æ­¤çš„é­„åŠ›å§ã€‚</p>
<h3 id="7-5-4ã€TPUæ€§èƒ½ä¸åº”ç”¨"><a href="#7-5-4ã€TPUæ€§èƒ½ä¸åº”ç”¨" class="headerlink" title="7.5.4ã€TPUæ€§èƒ½ä¸åº”ç”¨"></a>7.5.4ã€TPUæ€§èƒ½ä¸åº”ç”¨</h3><p>â€‹    TPUçš„é«˜æ€§èƒ½è¿˜æ¥æºäºå¯¹äºä½è¿ç®—ç²¾åº¦çš„å®¹å¿ã€‚ç ”ç©¶ç»“æœè¡¨æ˜ï¼Œä½ç²¾åº¦è¿ç®—å¸¦æ¥çš„ç®—æ³•å‡†ç¡®ç‡æŸå¤±å¾ˆå°ï¼Œä½†æ˜¯åœ¨ç¡¬ä»¶å®ç°ä¸Šå´å¯ä»¥å¸¦æ¥å·¨å¤§çš„ä¾¿åˆ©ï¼ŒåŒ…æ‹¬åŠŸè€—æ›´ä½ã€é€Ÿåº¦æ›´å¿«ã€å èŠ¯ç‰‡é¢ç§¯æ›´å°çš„è¿ç®—å•å…ƒã€æ›´å°çš„å†…å­˜å¸¦å®½éœ€æ±‚ç­‰ã€‚TPUé‡‡ç”¨äº†8æ¯”ç‰¹çš„ä½ç²¾åº¦è¿ç®—ã€‚</p>
<p>â€‹    ä¸åŒçš„æŠ€æœ¯æœ‰ä¸åŒçš„åº”ç”¨ï¼Œä¸åŒçš„åº”ç”¨æœ‰ä¸åŒçš„ç®—æ³•ï¼Œä¸åŒçš„ç®—æ³•æœ‰ä¸åŒçš„ç²¾åº¦ï¼ŒTPUçš„ç¥ç»ç½‘ç»œä¸éœ€è¦ä¼ ç»Ÿçš„ç²¾åº¦ï¼Œè¿™å’Œä»å‰çš„å¾ˆå¤šè®¾è®¡æ€è·¯æ˜¯æœ‰åŒºåˆ«çš„ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150043.png" alt="img"></p>
<p>â€‹    ç›®å‰ä¸ºæ­¢ï¼ŒTPUå·²ç»å¹²äº†å¾ˆå¤šæƒŠå¤©åŠ¨åœ°çš„äº‹æƒ…ï¼Œå¹¶ä¸”ä¸ºæˆ‘ä»¬æœåŠ¡äº†å¾ˆå¤šå¹´ã€‚å¹¶ä¸”åœ¨æ›´å¤šé¢†åŸŸåº”ç”¨ã€‚</p>
<p>â€‹    æœºå™¨å­¦ä¹ äººå·¥æ™ºèƒ½ç³»ç»ŸRankBrainï¼Œå¸®åŠ©Googleç”¨æˆ·å¤„ç†æœç´¢ç»“æœï¼›è¡—æ™¯Street Viewï¼Œæé«˜åœ°å›¾ä¸å¯¼èˆªçš„å‡†ç¡®æ€§ï¼›ä¸‹å›´æ£‹çš„è®¡ç®—æœºç¨‹åºAlphaGoã€‚è¿™äº›å¤§äº‹è®°èƒŒåï¼Œä»£è¡¨ç€äººå·¥æ™ºèƒ½æ—¶ä»£åˆ°æ¥äº†ã€‚</p>
<h3 id="7-5-5ã€ç¤ºä¾‹ä»£ç "><a href="#7-5-5ã€ç¤ºä¾‹ä»£ç " class="headerlink" title="7.5.5ã€ç¤ºä¾‹ä»£ç "></a>7.5.5ã€ç¤ºä¾‹ä»£ç </h3><h4 id="7-5-5-1ã€å˜åˆ†ç¨‹åº"><a href="#7-5-5-1ã€å˜åˆ†ç¨‹åº" class="headerlink" title="7.5.5.1ã€å˜åˆ†ç¨‹åº"></a>7.5.5.1ã€å˜åˆ†ç¨‹åº</h4><p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150067.png" alt="img"></p>
<h4 id="7-5-5-2ã€å¹¶è¡ŒVAEç¨‹åº"><a href="#7-5-5-2ã€å¹¶è¡ŒVAEç¨‹åº" class="headerlink" title="7.5.5.2ã€å¹¶è¡ŒVAEç¨‹åº"></a>7.5.5.2ã€å¹¶è¡ŒVAEç¨‹åº</h4><p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150095.png" alt="img"></p>
<h3 id="7-5-6ã€æ€»ç»“"><a href="#7-5-6ã€æ€»ç»“" class="headerlink" title="7.5.6ã€æ€»ç»“"></a>7.5.6ã€æ€»ç»“</h3><p>â€‹    ä»CPUåˆ°GPUï¼Œå†åˆ°å¦‚ä»ŠASICå’ŒFPGAç›¸ç»§å…¥å±€ï¼Œäº‘ç«¯AIèŠ¯ç‰‡å¸‚åœºç™¾èŠ±é½æ”¾ï¼Œä¸è°·æ­ŒTPUçš„æ¨åŠ¨æ¯æ¯ç›¸å…³ã€‚</p>
<p>â€‹    ä»Šå¤©ï¼Œäº‘ç«¯AIèŠ¯ç‰‡å¸‚åœºæ€å¾—çƒ­ç«æœå¤©ï¼Œå‰æœ‰èµ›çµæ€å’Œå¯’æ­¦çºªç­‰æ–°è€åŠ¿åŠ›ä¸æ–­å´›èµ·ï¼Œè¿›ä¸€æ­¥èš•é£ŸéGPUé¢†åŸŸçš„å¸‚åœºï¼Œåæœ‰ç§‘æŠ€å·¨å¤´å››å¤„æ‰¾å¯»æœºä¼šâ€œå¤§é±¼åƒå°é±¼â€ï¼Œåˆå¹¶æœ‰æ½œåŠ›çš„æ–°ç©å®¶ï¼Œæ•´ç‰‡å¸‚åœºå‘ˆä¸€æ´¾å‰²æ®æ··æˆ˜ã€ç™¾å®¶äº‰é¸£ä¹‹åŠ¿ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150188.png" alt="img"></p>
<p>â€‹    ä¸å®¹å¿½è§†çš„æ˜¯ï¼Œéšç€äº‘ç«¯AIèŠ¯ç‰‡ä¸æ–­å‘å±•ï¼Œå¤§æ•°æ®ã€äº‘å¹³å°æŒç»­çˆ†å‘ï¼Œä»¥åŠæ‘©å°”å®šå¾‹é€æ¸æ”¾ç¼“ï¼Œç®—åŠ›ä¹Ÿå†æ¬¡æ¥åˆ°æ–°çš„ç“¶é¢ˆã€‚</p>
<p>â€‹    ç©å®¶æ˜¯é€šè¿‡å…ˆè¿›åˆ¶ç¨‹å†æ¬¡æ’•å¼€äº‘ç«¯AIèŠ¯ç‰‡çš„æ–°æŠ€æœ¯é¢†åŸŸï¼Œè¿˜æ˜¯ä¾é ç ”å‘åˆ›æ–°æ¶æ„æ¥å®ç°ç®—åŠ›çš„é£è·ƒï¼Œä¸ç®¡èµ°å‘å“ªæ¡è·¯éƒ½éœ€ç›´é¢ç§ç§æŒ‘æˆ˜ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150244.png" alt="img"></p>
<p>â€‹    åœ¨AIèŠ¯ç‰‡å¸‚åœºå¼€è¾Ÿä¹‹åˆï¼Œè°·æ­Œå‡­å€ŸTPUé€æ¸æ‰“å¼€äº‘ç«¯AIèŠ¯ç‰‡å¸‚åœºæ–°çš„ç«äº‰æ ¼å±€ï¼Œä½†å½“äº‘ç«¯AIèŠ¯ç‰‡å¼€å§‹è¿›å…¥æ–°æ—¶ä»£ï¼Œè°·æ­Œåœ¨äº‘å¹³å°å¤§æ•°æ®çš„æŠ€æœ¯ä¼˜åŠ¿ï¼Œç›¸ä¿¡TPUèƒ½å†æ¬¡å»¶ç»­è¿‡å¾€è¾‰ç…Œï¼Œä¸ºå¸‚åœºå¼€è¾Ÿæ–°çš„æ–¹å‘å’Œè·¯å¾„ã€‚</p>
<p>â€‹    TPUç”±è°·æ­Œç‹¬å®¶æå‡ºï¼Œç‹¬å®¶ç ”å‘ï¼Œç‹¬å®¶åº”ç”¨ï¼Œè¿™äº›èƒ½ç»™æˆ‘ä»¬å¤šå°‘å¯ç¤ºå‘¢ï¼Ÿè°·æ­Œä»ä¸€ä¸ªæœç´¢ç§‘æŠ€å…¬å¸ï¼Œè¿‡æ¸¡åˆ°å¤§æ•°æ®ã€äº‘è®¡ç®—å…¬å¸ï¼Œè¿›è€Œèµ°åœ¨äººå·¥æ™ºèƒ½ã€ç¡¬ä»¶ç§‘æŠ€çš„å¤§é“ä¸Šã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192150287.png" alt="img"></p>
<h2 id="7-6-npu"><a href="#7-6-npu" class="headerlink" title="7.6 npu"></a>7.6 npu</h2><p>NPUï¼ˆNeural network Processing Unitï¼‰ï¼Œ å³ç¥ç»ç½‘ç»œå¤„ç†å™¨ã€‚ç”¨ç”µè·¯æ¨¡æ‹Ÿäººç±»çš„ç¥ç»å…ƒå’Œçªè§¦ç»“æ„ã€‚NPUä¸ºç¥ç»ç½‘ç»œè€Œç”Ÿï¼Œå¯¹ç¥ç»ç½‘ç»œè¿›è¡Œç¡¬ä»¶æ”¯æŒã€‚</p>
<p>â€‹    åµŒå…¥å¼ç¥ç»ç½‘ç»œå¤„ç†å™¨ï¼ˆNPUï¼‰é‡‡ç”¨â€œæ•°æ®é©±åŠ¨å¹¶è¡Œè®¡ç®—â€çš„æ¶æ„ï¼Œç‰¹åˆ«æ“…é•¿å¤„ç†è§†é¢‘ã€å›¾åƒç±»çš„æµ·é‡å¤šåª’ä½“æ•°æ®ã€‚è§†é¢‘ä¸å›¾åƒæ˜¯äººå·¥æ™ºèƒ½æ•°æ®çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œåœ¨ä»Šå¤©æœ‰ç€æœ€å¹¿æ³›çš„åº”ç”¨ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151451.png" alt="img"></p>
<p>â€‹    NPUæ˜¯ç½‘ç»œå¤„ç†å™¨ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªç»„ä»¶ï¼ˆæˆ–è€…å­ç³»ç»Ÿï¼‰ï¼Œæœ‰æ—¶å€™ä¹Ÿç§°ä¸ºNPUåå¤„ç†å™¨ã€‚NPUå’ŒTPUä¸€æ ·ï¼Œåå‘äºå¹¶è¡Œæ¶æ„è®¾è®¡ã€‚</p>
<h3 id="7-6-1ã€ç”Ÿç‰©ç¥ç»ç½‘ç»œ"><a href="#7-6-1ã€ç”Ÿç‰©ç¥ç»ç½‘ç»œ" class="headerlink" title="7.6.1ã€ç”Ÿç‰©ç¥ç»ç½‘ç»œ"></a>7.6.1ã€ç”Ÿç‰©ç¥ç»ç½‘ç»œ</h3><p>â€‹    ç”Ÿç‰©ç¥ç»ç³»ç»Ÿæ˜¯ä¸€ä¸ªé«˜åº¦ç»„ç»‡å’Œç›¸äº’ä½œç”¨çš„æ•°é‡å·¨å¤§çš„ç»†èƒç»„ç»‡ç¾¤ä½“ã€‚äººç±»å¤§è„‘çš„ç¥ç»ç»†èƒå¤§çº¦åœ¨1011â€“1013ä¸ªå·¦å³ã€‚ç¥ç»ç»†èƒä¹Ÿç§°ç¥ç»å…ƒï¼Œæ˜¯ç¥ç»ç³»ç»Ÿçš„åŸºæœ¬å•å…ƒï¼ŒæŒ‰ä¸åŒçš„ç»“åˆæ–¹å¼æ„æˆå¤æ‚çš„ç¥ç»ç½‘ç»œã€‚é€šè¿‡ç¥ç»å…ƒåŠå…¶è”æ¥çš„å¯å¡‘æ€§ï¼Œä½¿å¤§è„‘å…·æœ‰å­¦ä¹ ã€è®°å¿†å’Œè®¤çŸ¥ç­‰å„ç§æ™ºèƒ½ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151471.png" alt="img"></p>
<p>â€‹    ç”Ÿç‰©ç¥ç»ç½‘ç»œç”±è‹¥å¹²äººå·¥ç¥ç»å…ƒç»“ç‚¹ç›¸äº’è¿æ¥ï¼Œç¥ç»å…ƒä¹‹é—´é€šè¿‡çªè§¦ä¸¤ä¸¤è¿æ¥ï¼Œçªè§¦è®°å½•äº†ç¥ç»å…ƒä¹‹é—´çš„è”ç³»ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151523.png" alt="img"></p>
<p>â€‹    ç”Ÿç‰©ç¥ç»å…ƒä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>
<p>â€‹    èƒä½“ï¼Œæ˜¯ç¥ç»ç»†èƒçš„æœ¬ä½“;</p>
<p>â€‹    æ ‘çªï¼Œç”¨ä»¥æ¥å—æ¥è‡ªå…¶å®ƒç»†èƒå…ƒçš„ä¿¡å·;</p>
<p>â€‹    è½´çªï¼Œç”¨ä»¥è¾“å‡ºä¿¡å·ï¼Œä¸å¤šä¸ªç¥ç»å…ƒè¿æ¥;</p>
<p>â€‹    çªè§¦ï¼Œæ˜¯ä¸€ä¸ªç¥ç»å…ƒä¸å¦ä¸€ä¸ªç¥ç»å…ƒç›¸è”ç³»çš„ç‰¹æ®Šéƒ¨ä½ï¼Œç¥ç»å…ƒè½´çªçš„ç«¯éƒ¨é åŒ–å­¦æ¥è§¦å’Œç”µæ¥è§¦å°†ä¿¡å·ä¼ é€’ç»™ä¸‹ä¸€ä¸ªç¥ç»å…ƒçš„æ ‘çªæˆ–èƒä½“ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151461.png" alt="img"></p>
<h3 id="7-6-2ã€äººç±»ç¥ç»ç½‘ç»œ"><a href="#7-6-2ã€äººç±»ç¥ç»ç½‘ç»œ" class="headerlink" title="7.6.2ã€äººç±»ç¥ç»ç½‘ç»œ"></a>7.6.2ã€äººç±»ç¥ç»ç½‘ç»œ</h3><p>â€‹    ç”µè·¯æ¨¡ä»¿äººç±»ç¥ç»å…ƒï¼ŒæŠŠæ¯ä¸ªç¥ç»å…ƒæŠ½è±¡ä¸ºä¸€ä¸ªæ¿€åŠ±å‡½æ•°ï¼Œå‡½æ•°è¾“å…¥ç”±ä¸å…¶ç›¸è¿çš„ç¥ç»å…ƒè¾“å‡ºä»¥åŠè¿æ¥ç¥ç»å…ƒçš„çªè§¦å…±åŒå†³å®šã€‚</p>
<p>â€‹    ä¸ºäº†è¡¨è¾¾ç‰¹å®šçš„çŸ¥è¯†ï¼Œä½¿ç”¨è€…é€šè¿‡æŸäº›ç‰¹å®šçš„ç®—æ³•ï¼Œè°ƒæ•´äººå·¥ç¥ç»ç½‘ç»œä¸­çªè§¦çš„å–å€¼ã€ç½‘ç»œçš„æ‹“æ‰‘ç»“æ„ç­‰ã€‚è¯¥è¿‡ç¨‹ç§°ä¸ºâ€œå­¦ä¹ â€ã€‚å­¦ä¹ æ–¹æ³•æœ‰å¾ˆå¤šï¼Œè¿™ç§æ–¹æ³•ï¼Œä¹Ÿå«ç®—æ³•ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151511.png" alt="img"></p>
<p>â€‹    å­¦ä¹ ä¹‹åï¼Œäººå·¥ç¥ç»ç½‘ç»œé€šè¿‡ä¹ å¾—çš„çŸ¥è¯†æ¥è§£å†³ç‰¹å®šçš„é—®é¢˜ã€‚ç”Ÿç‰©ç¥ç»ç½‘ç»œçš„æ·±åº¦å­¦ä¹ ï¼ŒåŸºæœ¬æ“ä½œæ˜¯ç¥ç»å…ƒå’Œçªè§¦çš„å¤„ç†ã€‚ç°åœ¨å˜æˆè®¡ç®—æœºå¤„ç†ï¼Œä¼ ç»Ÿçš„å¤„ç†å™¨æŒ‡ä»¤é›†ï¼ˆåŒ…æ‹¬x86å’ŒARMç­‰ï¼‰æ˜¯ä¸ºäº†è¿›è¡Œé€šç”¨è®¡ç®—å‘å±•èµ·æ¥çš„ï¼Œå…¶åŸºæœ¬æ“ä½œä¸ºç®—æœ¯æ“ä½œï¼ˆåŠ å‡ä¹˜é™¤ï¼‰å’Œé€»è¾‘æ“ä½œï¼ˆä¸æˆ–éï¼‰ï¼Œéœ€è¦æ•°ç™¾ä¸ŠåƒæŒ‡ä»¤æ‰èƒ½å®Œæˆä¸€ä¸ªç¥ç»å…ƒçš„å¤„ç†ï¼Œæ·±åº¦å­¦ä¹ çš„å¤„ç†æ•ˆç‡ä¸é«˜ã€‚</p>
<p>â€‹    ä»é€šç”¨è®¡ç®—åˆ°å¹¶è¡Œè®¡ç®—ï¼Œå†åˆ°ç¥ç»ç½‘ç»œè®¡ç®—ï¼Œæ˜¯è¿‘äº›å¹´è®¡ç®—å‘å±•çš„ä¸€ä¸ªé‡è¦ç‰¹å¾ã€‚ç¥ç»ç½‘ç»œå¯¹äººå·¥æ™ºèƒ½çš„å‘å±•å½±å“æ·±è¿œï¼Œäººå·¥æ™ºèƒ½ç§‘æŠ€å…¬å¸çš„brainè®¡åˆ’ï¼Œç¥ç»ç½‘ç»œå¾€å¾€å æœ‰è¾ƒå¤§æˆåˆ†ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151486.png" alt="img"></p>
<p>â€‹    ç»å…¸çš„å†¯Â·è¯ºä¼Šæ›¼ç»“æ„ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œç¥ç»ç½‘ç»œä¸­å­˜å‚¨å’Œå¤„ç†æ˜¯ä¸€ä½“åŒ–çš„ï¼Œé€šè¿‡çªè§¦æƒé‡æ¥ä½“ç°ã€‚å†¯Â·è¯ºä¼Šæ›¼ç»“æ„ä¸­ï¼Œå­˜å‚¨å’Œå¤„ç†æ˜¯åˆ†ç¦»çš„ï¼Œç”±å­˜å‚¨å™¨å’Œè¿ç®—å™¨å®ç°ï¼ŒäºŒè€…ä¹‹é—´å­˜åœ¨å·¨å¤§çš„å·®å¼‚ã€‚åœ¨TPUè®¾è®¡ä¸Šï¼Œå…³äºå­˜å‚¨ä¸è¿ç®—ä¹Ÿè¿›è¡Œäº†æ·±åˆ»çš„è®ºè¯ã€‚</p>
<p>â€‹    ç°æœ‰çš„åŸºäºå†¯Â·è¯ºä¼Šæ›¼ç»“æ„çš„ç»å…¸è®¡ç®—æœºï¼ˆå¦‚X86å¤„ç†å™¨å’Œè‹±ä¼Ÿè¾¾GPUï¼‰æ¥è·‘ç¥ç»ç½‘ç»œåº”ç”¨æ—¶ï¼Œä¸å¯é¿å…åœ°å—åˆ°å­˜å‚¨å’Œå¤„ç†åˆ†ç¦»å¼ç»“æ„çš„åˆ¶çº¦ï¼Œå½±å“æ•ˆç‡ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸“é—¨é’ˆå¯¹äººå·¥æ™ºèƒ½çš„ä¸“ä¸šèŠ¯ç‰‡ï¼Œèƒ½å¤Ÿå¯¹ä¼ ç»ŸèŠ¯ç‰‡æœ‰ä¸€å®šå…ˆå¤©ä¼˜åŠ¿çš„åŸå› ä¹‹ä¸€ï¼ŒNPUå®ç°äº†è®¡ç®—ä¸å­˜å‚¨çš„ç»“åˆã€‚ã€‚</p>
<h3 id="7-6-3ã€å‡ºç°"><a href="#7-6-3ã€å‡ºç°" class="headerlink" title="7.6.3ã€å‡ºç°"></a>7.6.3ã€å‡ºç°</h3><p>â€‹    å›½å†…NPUå…¸å‹ä»£è¡¨æœ‰å¯’æ­¦çºªèŠ¯ç‰‡å’Œå›½å¤–IBMçš„TrueNorthèŠ¯ç‰‡ã€‚ä»¥å¯’æ­¦çºªä¸ºä¾‹ï¼ŒDianNaoYuæŒ‡ä»¤ç›´æ¥é¢å¯¹å¤§è§„æ¨¡ç¥ç»å…ƒå’Œçªè§¦çš„å¤„ç†ï¼Œä¸€æ¡æŒ‡ä»¤å³å®Œæˆä¸€ç»„ç¥ç»å…ƒçš„å¤„ç†ï¼Œå¹¶å¯¹ç¥ç»å…ƒå’Œçªè§¦æ•°æ®åœ¨èŠ¯ç‰‡ä¸Šçš„ä¼ è¾“æä¾›äº†ä¸€ç³»åˆ—ä¸“é—¨çš„æ”¯æŒã€‚</p>
<p>â€‹    æŒ‡ä»¤ç¼–ç¨‹ä¸è®ºå¯¹äºäººå·¥æ™ºèƒ½ï¼Œå¯¹äºå¤§æ•°æ®å¤„ç†ã€å¯¹äºéŸ³è§†é¢‘å’Œå›¾å½¢å›¾åƒéƒ½æœ‰ç€é‡è¦çš„æ„ä¹‰ã€‚</p>
<p>â€‹    CPUã€GPUã€NPUç›¸æ¯”ï¼Œæœ‰ç™¾å€ä»¥ä¸Šæ€§èƒ½æˆ–èƒ½è€—æ¯”å·®è·ã€‚å¯’æ­¦çºªå›¢é˜Ÿå’ŒInriaè”åˆå‘è¡¨çš„DianNaoè®ºæ–‡ä¸ºä¾‹â€”â€”DianNaoä¸ºå•æ ¸å¤„ç†å™¨ï¼Œä¸»é¢‘ä¸º0.98GHzï¼Œå³°å€¼è¾¾æ¯ç§’4520äº¿æ¬¡ç¥ç»ç½‘ç»œåŸºæœ¬è¿ç®—ï¼Œ65nmå·¥è‰ºä¸‹åŠŸè€—ä¸º0.485Wï¼Œé¢ç§¯3.02å¹³æ–¹æ¯«ç±³mmã€‚è¿™å°±æ˜¯ä¸“ä¸šè®¾è®¡çš„ä¼˜åŠ¿æ‰€åœ¨ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151735.png" alt="img"></p>
<p>â€‹    mate10ä¸­çš„éº’éºŸ970èŠ¯ç‰‡ï¼Œé›†æˆäº†å¯’æ­¦çºªçš„NPUï¼Œå®ç°æ‰€è°“çš„ç…§ç‰‡ä¼˜åŒ–åŠŸèƒ½ï¼Œä¿è¯æ‰‹æœºç”¨äº†å¾ˆé•¿æ—¶é—´åè¿˜èƒ½ä¸å¡ã€‚</p>
<p>â€‹    åä¸ºä»éº’éºŸ810èŠ¯ç‰‡å¼€å§‹ï¼Œä½¿ç”¨è‡ªå®¶ç ”å‘çš„è¾¾èŠ¬å¥‡æ¶æ„é›†æˆNPUï¼Œå¤§å¤§æå‡äº†èŠ¯ç‰‡çš„AIå¤„ç†èƒ½åŠ›ï¼Œè‡³ä»Šé‡‡ç”¨äº†åä¸ºNPUçš„æ‰‹æœºAIé«˜æ€§èƒ½è®¡ç®—ä»æ˜¯å–ç‚¹ä¹‹ä¸€ã€‚2018å¹´10æœˆï¼Œåä¸ºå‘å¸ƒäº†æœ€æ–°çš„NPUèŠ¯ç‰‡ï¼ŒåŒ…æ‹¬ç”¨äºäº‘ç«¯è®­ç»ƒçš„æ™Ÿè…¾910å’Œç”¨äºç»ˆç«¯æ¨ç†çš„æ™Ÿè…¾310ï¼Œæ™Ÿè…¾ç³»åˆ—NPUæ­£å¼èµ°å…¥äººä»¬çš„è§†é‡ã€‚</p>
<p>â€‹    åä¸ºæ‰‹æœºä½¿ç”¨NPUèŠ¯ç‰‡ï¼Œä¹Ÿæ˜¯åä¸ºæ‰‹æœºçš„æˆåŠŸè¦ç´ ä¹‹ä¸€ã€‚æ‰‹æœºæ˜¯ç»ˆç«¯ï¼Œå¯¹è§†éŸ³é¢‘å›¾å½¢å›¾åƒæœ‰ç€æ›´å¤šçš„åº”ç”¨ï¼ŒNPUçš„æ”¯æŒï¼Œä¿éšœåº”ç”¨çš„é¡ºåˆ©è¿›è¡Œã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151721.png" alt="img"></p>
<p>â€‹    2019å¹´9æœˆ25æ—¥ï¼Œâ€œäº‘æ –å¤§ä¼šâ€ä¸Šé˜¿é‡Œæ­£å¼å¯¹å¤–å‘å¸ƒäº†å…¨æ–°çš„å«å…‰800èŠ¯ç‰‡ã€‚å«å…‰800æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„é‡‡ç”¨ASICæŠ€æœ¯çš„ç”¨äºäº‘ç«¯æ¨ç†çš„AIèŠ¯ç‰‡NPUã€‚</p>
<p>â€‹    1é¢—å«å…‰800çš„ç®—åŠ›ç›¸å½“äº10é¢—GPUï¼Œå«å…‰800æ¨ç†æ€§èƒ½è¾¾åˆ°78563 IPSï¼Œèƒ½æ•ˆæ¯”500 IPS&#x2F;Wã€‚ç›¸æ¯”ä¼ ç»ŸGPUç®—åŠ›ï¼Œæ€§ä»·æ¯”æå‡100%ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151789.png" alt="img"></p>
<p>â€‹    ä¸¾å›½é€ èŠ¯æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»åˆ°æ¥äº†ï¼Œè´¢å¤§æ°”ç²—çš„é˜¿é‡Œä¸å†æ²‰é»˜ï¼Œè¾¾æ‘©é™¢é‡è¦çš„ä½¿å‘½ä¹‹ä¸€ï¼Œå°±æ˜¯é€ èŠ¯ï¼Œèµ„æœ¬çš„æŠ•å…¥æ¨åŠ¨èŠ¯ç‰‡æŠ€æœ¯çš„å‘å±•ã€‚</p>
<p>â€‹    åµŒå…¥å¼ç¥ç»ç½‘ç»œå¤„ç†å™¨ï¼ˆNPUï¼‰é‡‡ç”¨â€œæ•°æ®é©±åŠ¨å¹¶è¡Œè®¡ç®—â€æ¶æ„ï¼Œæ“…é•¿å¤„ç†è§†é¢‘ã€å›¾åƒç±»çš„æµ·é‡å¤šåª’ä½“æ•°æ®ã€‚</p>
<p>â€‹    NPUå¤„ç†å™¨ä¸“é—¨ä¸ºç‰©è”ç½‘äººå·¥æ™ºèƒ½è€Œè®¾è®¡ï¼Œç”¨äºåŠ é€Ÿç¥ç»ç½‘ç»œçš„è¿ç®—ï¼Œè§£å†³ä¼ ç»ŸèŠ¯ç‰‡åœ¨ç¥ç»ç½‘ç»œè¿ç®—æ—¶æ•ˆç‡ä½ä¸‹çš„é—®é¢˜ã€‚è¿‘äº›å¹´ï¼Œç¥ç»ç½‘ç»œç§°ä¸ºäººå·¥æ™ºèƒ½ç®—æ³•çš„é‡è¦æ”¯æŸ±ã€‚</p>
<p>â€‹    NPUå¯ä»¥å’ŒCPUã€GPUã€MCUç»“åˆï¼Œæˆä¸ºå…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼ŒNPUè¿™ç§ç»„åˆçš„æ¨¡å¼ï¼Œå·²ç»å¹¿æ³›ä½¿ç”¨ã€‚NPUä¹Ÿå¯ä»¥è¿›è¡Œå®šåˆ¶ï¼Œå¤§å¤§åŠ å¼ºäº†NPUçš„èŒƒå›´åº”ç”¨ã€‚</p>
<p>â€‹    GX8010ä¸­ï¼ŒCPUå’ŒMCUå„æœ‰ä¸€ä¸ªNPUï¼ŒMCUä¸­çš„NPUç›¸å¯¹è¾ƒå°ï¼Œä¹Ÿè¢«ç§°ä¸ºSNPUã€‚NPUçš„åº”ç”¨å·²ç»æ­¥å…¥å®¶å®¶æˆ·æˆ·ï¼Œæœªæ¥è¿˜æœ‰å¾ˆå¤§çš„å‘å±•ç©ºé—´ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151773.png" alt="img"></p>
<h3 id="7-6-4ã€ç»„æˆ"><a href="#7-6-4ã€ç»„æˆ" class="headerlink" title="7.6.4ã€ç»„æˆ"></a>7.6.4ã€ç»„æˆ</h3><p>â€‹    NPUçš„ç»“æ„å……åˆ†è€ƒè™‘äº†ç¥ç»ç½‘ç»œè¿ç®—çš„ç‰¹ç‚¹ï¼Œä¸“ä¸ºç¥ç»ç½‘ç»œè¿ç®—è€Œè®¾è®¡ï¼Œå„ä¸ªæ¨¡å—é€šåŠ›ç»“åˆï¼Œä¿éšœäº†ç¥ç»ç½‘ç»œç®—æ³•çš„é«˜æ•ˆæ‰§è¡Œã€‚</p>
<p>â€‹    NPUå¤„ç†å™¨æœ‰å¦‚ä¸‹å‡ éƒ¨åˆ†ç»„æˆï¼šä¹˜åŠ ã€æ¿€æ´»å‡½æ•°ã€äºŒç»´æ•°æ®è¿ç®—ã€è§£å‹ç¼©ç­‰æ¨¡å—ã€‚</p>
<p>â€‹    ä¹˜åŠ æ¨¡å—ç”¨äºè®¡ç®—çŸ©é˜µä¹˜åŠ ã€å·ç§¯ã€ç‚¹ä¹˜ç­‰åŠŸèƒ½ï¼ŒNPUå†…éƒ¨æœ‰64ä¸ªMACï¼ŒSNPUæœ‰32ã€‚</p>
<p>â€‹    æ¿€æ´»å‡½æ•°æ¨¡å—é‡‡ç”¨æœ€é«˜12é˜¶å‚æ•°æ‹Ÿåˆçš„æ–¹å¼å®ç°ç¥ç»ç½‘ç»œä¸­çš„æ¿€æ´»å‡½æ•°ï¼ŒNPUå†…éƒ¨æœ‰6ä¸ªMACï¼ŒSNPUæœ‰3ä¸ªã€‚</p>
<p>â€‹    äºŒç»´æ•°æ®è¿ç®—æ¨¡å—ç”¨äºå®ç°å¯¹ä¸€ä¸ªå¹³é¢è¿ç®—ï¼Œå¦‚é™é‡‡æ ·ã€å¹³é¢æ•°æ®æ‹·è´ç­‰ï¼ŒNPUå†…éƒ¨æœ‰1ä¸ªMACï¼ŒSNPUæœ‰1ä¸ªã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151815.png" alt="img"></p>
<p>â€‹    è§£å‹ç¼©æ¨¡å—ç”¨äºå¯¹æƒé‡æ•°æ®çš„è§£å‹ã€‚ä¸ºè§£å†³ç‰©è”ç½‘è®¾å¤‡ä¸­å†…å­˜å¸¦å®½å°çš„ç‰¹ç‚¹ï¼Œåœ¨NPUç¼–è¯‘å™¨ä¸­ä¼šå¯¹ç¥ç»ç½‘ç»œä¸­çš„æƒé‡è¿›è¡Œå‹ç¼©ï¼Œåœ¨ä¸å½±å“ç²¾åº¦çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å®ç°6-10å€çš„å‹ç¼©æ•ˆæœã€‚</p>
<p>â€‹    ä¸“ä¸šçš„è®¾è®¡ï¼Œè€ƒè™‘äº†è¿ç®—çš„æ–¹æ–¹é¢é¢ï¼Œç®€å•ç›´æ¥ï¼Œé¢å‘é—®é¢˜ã€‚å¯¹é€šç”¨ä¸“ä¸šç¡¬ä»¶è®¾è®¡æœ‰ä¸€å®šçš„å€Ÿé‰´ä½œç”¨ã€‚ä¸‹å›¾ä¸ºé«˜é€šçš„NPUèŠ¯ç‰‡ï¼Œé«˜é€šä¸€ç›´æ˜¯åµŒå…¥å¼é¢†åŸŸçš„ç‹è€…ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151847.png" alt="img"></p>
<h3 id="7-6-5ã€ä»£ç ç¤ºä¾‹"><a href="#7-6-5ã€ä»£ç ç¤ºä¾‹" class="headerlink" title="7.6.5ã€ä»£ç ç¤ºä¾‹"></a>7.6.5ã€ä»£ç ç¤ºä¾‹</h3><p>â€‹    åä¸ºNPUç¼–ç¨‹ç¤ºä¾‹ä»£ç ï¼š</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151042.png" alt="img"></p>
<h3 id="7-6-6ã€æ€»ç»“"><a href="#7-6-6ã€æ€»ç»“" class="headerlink" title="7.6.6ã€æ€»ç»“"></a>7.6.6ã€æ€»ç»“</h3><p>â€‹    NPUåœ¨ç°å®ä¸­æœ‰ç€å¹¿æ³›åº”ç”¨ï¼Œå°¤å…¶åœ¨æ™ºèƒ½è®¡ç®—ã€å›¾å½¢AIè¯†åˆ«é¢†åŸŸã€‚ä¸‹é¢æ€»ç»“AIåœºæ™¯ï¼Œå¯¹NPUåº”ç”¨è¿›è¡Œæ•´ç†ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151053.png" alt="img"></p>
<p>â€‹    æ‹ç…§æ—¶é€šè¿‡NPUå®ç°AIåœºæ™¯è¯†åˆ«ï¼Œå¹¶åˆ©ç”¨NPUè¿ç®—ä¿®å›¾ã€.NPUåˆ¤æ–­å…‰æºå’Œæš—å…‰ç»†èŠ‚åˆæˆè¶…çº§å¤œæ™¯ã€é€šè¿‡NPUå®ç°è¯­éŸ³åŠ©æ‰‹çš„è¿è¡Œã€.ä½¿ç”¨NPUè®°å½•ç”¨æˆ·ä½¿ç”¨ä¹ æƒ¯æ€åå°ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151073.png" alt="img"></p>
<p>â€‹    NPUé…åˆGPU Turboé¢„åˆ¤ä¸‹ä¸€å¸§å®ç°æå‰æ¸²æŸ“æé«˜æ¸¸æˆæµç•…åº¦ã€NPUé¢„åˆ¤è§¦æ§æé«˜è·Ÿæ‰‹åº¦å’Œçµæ•åº¦ã€NPUåˆ¤æ–­å‰å°åå°ç½‘é€Ÿéœ€æ±‚å·®å¼‚é…åˆå®ç°Link Turboã€è·‘åˆ†ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151075.png" alt="img"></p>
<p>â€‹    NPUåˆ¤æ–­æ¸¸æˆæ¸²æŸ“è´Ÿè½½æ™ºèƒ½è°ƒæ•´åˆ†è¾¨ç‡ã€NPUè¾…åŠ©æ¸…ç†ç³»ç»Ÿ18æœˆä¸å¡ã€æŠŠé™ä½æ¸¸æˆæ—¶AIçš„è¿ç®—è´Ÿè½½äº¤ç»™NPUä»¥çœç”µã€NPUå®ç°CPUå’ŒGPUçš„åŠ¨æ€è°ƒåº¦ã€‚</p>
<p>â€‹    åˆ©ç”¨NPUå’Œäººå·¥æ™ºèƒ½ç®—æ³•å®šæœŸæ›´æ¢å£çº¸çš„åŠŸèƒ½ã€NPUè¾…åŠ©å¤§æ•°æ®å¹¿å‘Šæ¨é€ã€NPUå®ç°è¾“å…¥æ³•AIæ™ºèƒ½è”æƒ³è¯çš„åŠŸèƒ½ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151129.png" alt="img"></p>
<p>â€‹    åº”ç”¨åœºæ™¯çš„æ”¯æŒä¸‹ï¼ŒNPUå·²ç»æˆä¸ºæœ€é‡è¦çš„èŠ¯ç‰‡ã€‚ç›®å‰ï¼ŒNPUæŠ€æœ¯å·²ç»æˆç†Ÿï¼Œå·²ç»å¹¿æ³›åº”ç”¨æ„ˆäº¤äº’é¢†åŸŸã€‚åœ¨æ‰‹æœºã€å†›å·¥ã€åµŒå…¥å¼é¢†åŸŸå¹¿æ³›åº”ç”¨ã€‚</p>
<p>â€‹    ç¾æ‘„SDKï¼Œå®Œç¾æ”¯æŒCPUã€GPUã€NPUè¿ç®—ã€‚20å¹´è§†éŸ³é¢‘æŠ€æœ¯ç§¯æ·€ï¼Œåœ¨çŸ­è§†é¢‘é¢†åŸŸï¼ŒæŠŠäººå·¥æ™ºèƒ½åº”ç”¨åšåˆ°æè‡´ã€‚</p>
<p>â€‹    <img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151207.png" alt="img"></p>
<p>  æ—¶å…‰å˜å¹»ï¼Œå²æœˆæ¨ªæµï¼Œè®¡ç®—æœºåº”ç”¨çš„æ·±åº¦ä¸å¹¿åº¦å¢å¤§ï¼Œå¯¹å›¾å½¢å›¾åƒå¤„ç†ä¹Ÿæå‡ºäº†æ›´é«˜çš„è¦æ±‚ã€‚ä¼ ç»Ÿçš„ç¡¬ä»¶è®¾è®¡ã€è®¡ç®—æ¡†æ¶ã€è¿ç®—ç†è®ºã€è½¯ä»¶æ¥å£éƒ½é¢ä¸´ç€æå¤§çš„æŒ‘æˆ˜ã€‚ä¸ºäº†é€‚åº”äººå·¥æ™ºèƒ½æŠ€æœ¯çš„å‘å±•ï¼Œè½¯ç¡¬ä»¶æŠ€æœ¯éƒ½åœ¨è¿›è¡Œç€å·¨å˜ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151523.png" alt="img"></p>
<p>â€‹    æ™ºèƒ½æ—¶ä»£åˆ›é€ äº†å¾ˆå¤šæœºä¼šï¼Œå¡‘é€ äº†æ— æ•°çš„ç§‘æŠ€å·¨å¤´ï¼Œå…¬å¸æœ‰æ›´å¤§çš„ç§‘æŠ€è‡ªç”±åº¦ã€‚æ™ºèƒ½æ—¶ä»£æŠ€æœ¯ç™¾èŠ±é½æ”¾ï¼Œç¡¬ä»¶è¾ˆå‡ºã€æ¡†æ¶äº‰é¸£ã€å¹³å°æ˜¾ç°ã€ä¸‡é©¬å¥”è…¾ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151543.png" alt="img"></p>
<p>â€‹    ä¸åŒçš„ç¡¬ä»¶æ¡†æ¶é€‚åº”æ˜¾ç¤ºçš„éœ€æ±‚ã€‚æ˜¾ç¤ºæŠ€æœ¯çš„åé¢ï¼Œæœ‰ç€GPUæ¶æ„å’Œå¹¶è¡Œè®¡ç®—æ¶æ„åœ¨æ”¯æŒã€‚åœ¨ç›¸å…³ä¸“é¢˜ã€‚é˜è¿°ä¸»æµçš„CPUã€GPUæ¶æ„ï¼ŒCPUã€GPUå¹¶è¡Œè®¡ç®—æ¨¡å‹ã€‚</p>
<p>â€‹    è®¡ç®—æ˜¾ç¤ºç¡¬ä»¶å‘å±•çš„å†å²ï¼Œå¯ä»¥çœ‹å‡ºï¼Œä¸“ä¸šè®¡ç®—æ˜¾ç¤ºç¡¬ä»¶å¾€å¾€æ˜¯æ°‘é—´è®¡ç®—æ˜¾ç¤ºç¡¬ä»¶å‘å±•çš„å‰å¥ï¼Œä¸“ä¸šç¡¬ä»¶å‘å±•æˆç†Ÿæ—¶ï¼Œæ°‘é—´æ¶ˆè´¹åº”ç”¨çš„æ˜¥å¤©åˆ°æ¥äº†ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151495.png" alt="img"></p>
<p>â€‹    ä¸“ä¸šæ€§å¼€å‘æ‰¿æ‹…ç€æ›´å¤šçš„ç ”å‘æˆæœ¬ï¼Œå„å®¶å…¬å¸é“è·¯ä¸å°½ç›¸åŒï¼Œæˆæœ¬ç›¸å¯¹é«˜çš„é¡¹ç›®ï¼Œæ‰¿æ‹…ç€å·¨å¤§çš„é£é™©ã€‚äººå·¥æ™ºèƒ½æ—¶ä»£ä¸ä»…ä»…æ˜¯æ–°çš„è½¯ä»¶ç†è®ºï¼Œè®¡ç®—æ¡†æ¶ï¼Œæ›´æ˜¯ç¡¬ä»¶æŠ€æœ¯çš„è¿›æ­¥ã€‚</p>
<h1 id="8-å‰ç½®è¯´æ˜ï¼š"><a href="#8-å‰ç½®è¯´æ˜ï¼š" class="headerlink" title="8 å‰ç½®è¯´æ˜ï¼š"></a>8 å‰ç½®è¯´æ˜ï¼š</h1><p>â€‹     è‡³æ­¤ã€æ•´ä¸ªä¸»é¢˜å…¨éƒ¨ç»“æŸï¼Œå€Ÿé‰´äº†ä¸€äº›èµ„æ–™ï¼Œå¦‚æœ‰å¼‚è®®ï¼Œè¯·è”ç³»ä½œè€…ã€‚ä¸‹é¢ä¸»é¢˜ï¼Œå¼€å§‹è®²è¿°å¤„ç†å™¨æ¶æ„ä¸æŒ‡ä»¤ã€‚</p>
<p>â€‹    ææ–™ä¸åˆ¶é€ æŠ€æœ¯çš„è¿›æ­¥æ¨åŠ¨äº†å¾®ç”µå­æŠ€æœ¯çš„å‘å±•ï¼Œå¾®ç”µå­æŠ€æœ¯çš„è¿›æ­¥æ¨åŠ¨é›†æˆç”µè·¯çš„å‘å±•ï¼Œé›†æˆç”µè·¯çš„å‘å±•æ¨åŠ¨äº†æ˜¾ç¤ºèŠ¯ç‰‡çš„å‘å±•ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151795.png" alt="img"></p>
<p>â€‹    æ˜¾ç¤ºæŠ€æœ¯å‘å±•è¿‡ç¨‹ä¸­ï¼Œéµä»äº†åŒè‰²èŠ¯ç‰‡ï¼Œ2DèŠ¯ç‰‡ï¼Œ3DèŠ¯ç‰‡ï¼Œå†åˆ°æ™ºèƒ½èŠ¯ç‰‡çš„å‘å±•è¿‡ç¨‹ï¼Œåœ¨èŠ¯ç‰‡å‘å±•çš„èƒŒåï¼Œè®¡ç®—æœºå›¾å½¢å­¦ä»æ—©æœŸçš„æ–‡æœ¬æ˜¾ç¤ºåˆ°åæ¥2Dã€3Dä¸–ç•Œçš„å‘ˆç°ï¼Œå†åˆ°ä»Šå¤©æœºå™¨è§†è§‰æŠ€æœ¯çš„å‘å±•ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151793.png" alt="img"></p>
<p>â€‹    ç¡¬ä»¶æŠ€æœ¯çš„æå‡ï¼Œå¸¦æ¥äº†æ˜¾ç¤ºæ ‡å‡†çš„å˜åŒ–ã€‚æ˜¾ç¤ºæ ‡å‡†ä»æ—©æœŸçš„MDAï¼ŒEGAã€VGAã€V-Syncåˆ°ä»Šå¤©çš„G-Syncå’ŒFreesync 2ã€‚æ ‡å‡†çš„å‡ºç°æŒ‡å¯¼ç€ç¡¬ä»¶çš„å‘å±•ï¼Œä¸ºå›¾å½¢å›¾åƒAPIã€å¼•æ“çš„å‡ºç°åšäº†é“ºå«ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151796.png" alt="img"></p>
<p>â€‹    ä»æ—©æœŸé©±åŠ¨ç¼–ç¨‹ï¼Œåˆ°APIç¼–ç¨‹(GDIï¼ŒGDI+ï¼ŒD2Dï¼ŒAGGï¼ŒCairoï¼ŒCocoa Drawing)ï¼Œåˆ°ä¸“ä¸šå›¾å½¢å¼•æ“ç¼–ç¨‹(Glideï¼ŒOpenGLï¼ŒD3D)ï¼Œä»£è¡¨ç€å›¾å½¢å›¾åƒæŠ€æœ¯çš„ç¹è£ï¼Œå›¾å½¢å›¾åƒå¼•æ“æ¨åŠ¨äº†éŸ³è§†é¢‘æŠ€æœ¯çš„å‘å±•ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151796.png" alt="img"></p>
<p>â€‹    ä¸åŒçš„æ˜¾ç¤ºæ ‡å‡†å¸¦æ¥è®¡ç®—æœºå›¾å½¢å­¦çš„å‘å±•å˜åŒ–ã€‚å›¾å½¢å›¾åƒç¡¬ä»¶å˜é©ä¸Šï¼ŒAMDæ¨å‡ºAPUçš„æ¦‚å¿µï¼ŒåŒæ—¶æ¨å‡ºAPPå¹¶è¡Œè¿ç®—æ¡†æ¶ï¼Œå¹¶å¯¹OpenCIå¤§åŠ›æ”¯æŒï¼Œæ¨å‡ºVEGAæ¶æ„çš„æ˜¾å¡ã€‚è‹±ä¼Ÿè¾¾æ¨å‡ºè‡ªå·±çš„CUDAå¹¶è¡Œè®¡ç®—æŠ€æœ¯ã€‚Intelæ¨å‡ºäº†Xeå›¾å½¢æ¶æ„çš„æ˜¾å¡ï¼Œæ¨å‡ºå›¾å½¢åº“TBBï¼Œpaforç¼–ç¨‹åŒ…ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151823.png" alt="img"></p>
<p>â€‹    ç¡¬ä»¶æ¶æ„ã€è¿ç®—å¹³å°ã€è½¯ä»¶æ¶æ„ã€ç¼–ç¨‹æ¡†æ¶æ˜¯ç¡¬ä»¶å‚å•†çš„é—®é¢˜ï¼Œè½¯ä»¶æ¶æ„ã€ç¼–ç¨‹æ¡†æ¶é¢å‘ç»ˆç«¯å¸‚åœºã€‚</p>
<p>â€‹    å›½å†…å¤§åŠ›æ¿€åŠ±åŠå¯¼ä½“äº§ä¸šå‘å±•ï¼Œå¯»æ±‚åŠå¯¼ä½“æŠ€æœ¯çš„è‡ªä¸»å¯æ§ï¼ŒèŠ¯ç‰‡IPäº§ä¸šæœ‰æœ›è¿›å…¥é»„é‡‘æ—¶ä»£ã€‚å¯¹äºè¿™ä¸ªæ—¶ä»£æ¥è¯´ï¼Œé€‰æ‹©ä»å¤´åšç ”å‘æ˜¯å¾ˆå›°éš¾çš„äº‹ï¼Œå°†å·²æœ‰çš„IPæ”¾åˆ°èŠ¯ç‰‡ä¸­åˆ™å®¹æ˜“å¾—å¤šã€‚</p>
<p>â€‹    ç±»ä¼¼Imaginationçš„è¿™ç§æ€»éƒ¨åœ¨æ¬§æ´²ã€å…·æœ‰ä¸­èµ„èƒŒæ™¯ï¼Œä¸”å…·æœ‰å‡ åå¹´GPU IPç§¯æ·€çš„åŠå¯¼ä½“IPä¼ä¸šæœ‰æœ›è¿æ¥æ–°çš„å¥‘æœºã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151807.jpeg" alt="img"></p>
<p>â€‹    äººå·¥æ™ºèƒ½å‘å±•å¤§èƒŒæ™¯ä¸‹ï¼Œç¥ç»ç½‘ç»œå¼‚å†›çªèµ·ã€‚ä¸ºéŸ³è§†é¢‘å‘å±•æ³¨å…¥äº†æ™ºèƒ½å› ç´ ï¼ŒæŠŠéŸ³è§†é¢‘æ·±åº¦åº”ç”¨æ¨å‘ä¸€ä¸ªæ–°çš„é«˜åº¦ã€‚</p>
<p>â€‹    ç¾æ‘„ç§‘æŠ€ï¼Œä»¥éŸ³è§†é¢‘æŠ€æœ¯ä¸ºåŸºç¡€ï¼Œä»¥å¹¶è¡Œè®¡ç®—ä¸ºä¾æ‰˜ï¼Œä»¥äººå·¥æ™ºèƒ½æŠ€æœ¯ã€å›¾å½¢å›¾åƒæŠ€æœ¯ä¸ºåŒç¿¼ï¼Œæ¨åŠ¨èåª’æŠ€æœ¯å‘å±•ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151835.jpeg" alt="img"></p>
<h1 id="9-å¸¸ç”¨æœ¯è¯­"><a href="#9-å¸¸ç”¨æœ¯è¯­" class="headerlink" title="9 å¸¸ç”¨æœ¯è¯­"></a>9 å¸¸ç”¨æœ¯è¯­</h1><h2 id="9-1ã€APU"><a href="#9-1ã€APU" class="headerlink" title="9.1ã€APU"></a>9.1ã€APU</h2><p>â€‹    APUï¼šAccelerated Processing Unitï¼ŒåŠ é€Ÿå¤„ç†å™¨ã€‚AMDå…¬å¸æ¨å‡ºåŠ é€Ÿå›¾åƒå¤„ç†èŠ¯ç‰‡äº§å“ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151273.png" alt="img"></p>
<h2 id="9-2ã€BPU"><a href="#9-2ã€BPU" class="headerlink" title="9.2ã€BPU"></a>9.2ã€BPU</h2><p>â€‹    BPUï¼š Brain Processing Unitï¼Œå¤§è„‘å¤„ç†å™¨ã€‚åœ°å¹³çº¿ç§‘æŠ€æå‡ºçš„åµŒå…¥å¼äººå·¥æ™ºèƒ½å¤„ç†å™¨æ¶æ„ã€‚ç¬¬ä¸€ä»£æ˜¯é«˜æ–¯æ¶æ„ï¼Œç¬¬äºŒä»£æ˜¯ä¼¯åŠªåˆ©æ¶æ„ï¼Œç¬¬ä¸‰ä»£æ˜¯è´å¶æ–¯æ¶æ„ã€‚ç›®å‰åœ°å¹³çº¿å·²ç»è®¾è®¡å‡ºäº†ç¬¬ä¸€ä»£é«˜æ–¯æ¶æ„ï¼Œå¹¶ä¸è‹±ç‰¹å°”åœ¨2017å¹´CESå±•ä¼šä¸Šè”åˆæ¨å‡ºäº†ADASç³»ç»Ÿï¼ˆé«˜çº§é©¾é©¶è¾…åŠ©ç³»ç»Ÿï¼‰ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151290.png" alt="img"></p>
<h2 id="9-3ã€CPU"><a href="#9-3ã€CPU" class="headerlink" title="9.3ã€CPU"></a>9.3ã€CPU</h2><p>â€‹    CPUï¼šCentral Processing Unitï¼Œä¸­å¤®å¤„ç†å™¨ã€‚ç›®å‰PC æ ¸å¿ƒä¸»æµäº§å“ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151313.png" alt="img"></p>
<h2 id="9-4ã€DPU"><a href="#9-4ã€DPU" class="headerlink" title="9.4ã€DPU"></a>9.4ã€DPU</h2><p>â€‹    DPUï¼šDeep learning Processing Unitï¼Œæ·±åº¦å­¦ä¹ å¤„ç†å™¨ã€‚æœ€æ—©å›½å†…æ·±é‰´ç§‘æŠ€æå‡ºï¼ŒåŸºäºXilinxå¯é‡æ„ç‰¹æ€§çš„FPGAèŠ¯ç‰‡ï¼Œè®¾è®¡ä¸“ç”¨çš„æ·±åº¦å­¦ä¹ å¤„ç†å•å…ƒï¼Œå¯åŸºäºå·²æœ‰çš„é€»è¾‘å•å…ƒï¼Œè®¾è®¡å¹¶è¡Œé«˜æ•ˆçš„ä¹˜æ³•å™¨åŠé€»è¾‘ç”µè·¯ï¼Œå±äºIPèŒƒç•´ï¼ŒæŠ½è±¡å‡ºå®šåˆ¶åŒ–çš„æŒ‡ä»¤é›†å’Œç¼–è¯‘å™¨ï¼Œè€Œéä½¿ç”¨OpenCLï¼Œä»è€Œå®ç°å¿«é€Ÿçš„å¼€å‘ä¸äº§å“è¿­ä»£ã€‚äº‹å®ä¸Šï¼Œæ·±é‰´æå‡ºçš„DPUå±äºåŠå®šåˆ¶åŒ–çš„FPGAã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151420.png" alt="img"></p>
<h2 id="9-5ã€FPU"><a href="#9-5ã€FPU" class="headerlink" title="9.5ã€FPU"></a>9.5ã€FPU</h2><p>â€‹    FPUï¼šFloating Processing Unitï¼Œæµ®ç‚¹è®¡ç®—å•å…ƒã€‚é€šç”¨å¤„ç†å™¨ä¸­çš„æµ®ç‚¹è¿ç®—æ¨¡å—ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151333.png" alt="img"></p>
<h2 id="9-6ã€GPU"><a href="#9-6ã€GPU" class="headerlink" title="9.6ã€GPU"></a>9.6ã€GPU</h2><p>â€‹    GPUï¼šGraphics Processing Unitï¼Œå›¾å½¢å¤„ç†å™¨ã€‚é‡‡ç”¨å¤šçº¿ç¨‹SIMDæ¶æ„ï¼Œä¸ºå›¾å½¢å¤„ç†è€Œç”Ÿã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151452.png" alt="img"></p>
<h2 id="9-7ã€HPU"><a href="#9-7ã€HPU" class="headerlink" title="9.7ã€HPU"></a>9.7ã€HPU</h2><p>â€‹    HPUï¼šHolographics Processing Unitï¼Œå…¨æ¯å›¾åƒå¤„ç†å™¨ã€‚å¾®è½¯å‡ºå“çš„å…¨æ¯è®¡ç®—èŠ¯ç‰‡ä¸è®¾å¤‡ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151596.png" alt="img"></p>
<h2 id="9-8ã€IPU"><a href="#9-8ã€IPU" class="headerlink" title="9.8ã€IPU"></a>9.8ã€IPU</h2><p>â€‹    IPUï¼šIntelligence Processing Unitæˆ–è€…Image Processing Unitã€‚ä¸ç›¸æœºï¼Œæ˜¾ç¤ºç›¸å…³ã€‚Deep MindæŠ•èµ„çš„Graphcoreå…¬å¸ï¼Œå¼€å‘å‡ºçš„AIå¤„ç†å™¨ã€‚åŒ…æ‹¬ï¼šDisplayã€Cameraã€Image Rotation, Inversion, Color Space Conversionã€Image quality enhancementã€ Video&#x2F;graphics combiningã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151623.png" alt="img"></p>
<h4 id="9-9ã€MPU"><a href="#9-9ã€MPU" class="headerlink" title="9.9ã€MPU"></a>9.9ã€MPU</h4><p>â€‹    MPU&#x2F;MCUï¼šMicroprocessor&#x2F;Micro controller Unitï¼Œå¾®å¤„ç†å™¨&#x2F;å¾®æ§åˆ¶å™¨ã€‚ç”¨äºä½è®¡ç®—åº”ç”¨çš„RISCè®¡ç®—æœºä½“ç³»æ¶æ„äº§å“ï¼Œå¦‚ARM-Mç³»åˆ—å¤„ç†å™¨ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151616.png" alt="img"></p>
<h2 id="9-10ã€NPU"><a href="#9-10ã€NPU" class="headerlink" title="9.10ã€NPU"></a>9.10ã€NPU</h2><p>â€‹    NPUï¼šNeural Network Processing Unitï¼Œç¥ç»ç½‘ç»œå¤„ç†å™¨ã€‚åŸºäºç¥ç»ç½‘ç»œç®—æ³•ä¸åŠ é€Ÿçš„æ–°å‹å¤„ç†å™¨æ€»ç§°ï¼Œå¦‚ä¸­ç§‘é™¢è®¡ç®—æ‰€&#x2F;å¯’æ­¦çºªå…¬å¸å‡ºå“çš„diannaoç³»åˆ—ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151718.png" alt="img"></p>
<h2 id="9-11ã€RPU"><a href="#9-11ã€RPU" class="headerlink" title="9.11ã€RPU"></a>9.11ã€RPU</h2><p>â€‹    RPUï¼šRadio Processing Unitï¼Œæ— çº¿ç”µå¤„ç†å™¨ã€‚Imagination Technologieså…¬å¸æ¨å‡ºçš„é›†åˆé›†Wifi&#x2F;è“ç‰™&#x2F;FM&#x2F;å¤„ç†å™¨ä¸ºå•ç‰‡çš„å¤„ç†å™¨ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151782.png" alt="img"></p>
<h2 id="9-12ã€TPU"><a href="#9-12ã€TPU" class="headerlink" title="9.12ã€TPU"></a>9.12ã€TPU</h2><p>â€‹    TPUï¼šTensor Processing Unitï¼Œå¼ é‡å¤„ç†å™¨ã€‚Google å…¬å¸æ¨å‡ºçš„åŠ é€Ÿäººå·¥æ™ºèƒ½ç®—æ³•çš„ä¸“ç”¨å¤„ç†å™¨ã€‚ç›®å‰ä¸€ä»£TPUé¢å‘Inferenceï¼Œç¬¬äºŒä»£é¢å‘è®­ç»ƒã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151725.png" alt="img"></p>
<h2 id="9-13ã€VPU"><a href="#9-13ã€VPU" class="headerlink" title="9.13ã€VPU"></a>9.13ã€VPU</h2><p>â€‹    VPUï¼šVector Processing Unitï¼ŒçŸ¢é‡å¤„ç†å™¨ã€‚Intelæ”¶è´­çš„Movidiuså…¬å¸æ¨å‡ºçš„å›¾åƒå¤„ç†ä¸äººå·¥æ™ºèƒ½çš„ä¸“ç”¨èŠ¯ç‰‡çš„åŠ é€Ÿè®¡ç®—æ ¸å¿ƒã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151878.png" alt="img"></p>
<h2 id="9-14ã€WPU"><a href="#9-14ã€WPU" class="headerlink" title="9.14ã€WPU"></a>9.14ã€WPU</h2><p>â€‹    WPUï¼šWearable Processing Unitï¼Œå¯ç©¿æˆ´å¤„ç†å™¨ã€‚Ineda Systemså…¬å¸æ¨å‡ºçš„å¯ç©¿æˆ´ç‰‡ä¸Šç³»ç»Ÿäº§å“ï¼ŒåŒ…å«GPU&#x2F;MIPS CPUç­‰IPã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151933.png" alt="img"></p>
<h4 id="9-15ã€XPU"><a href="#9-15ã€XPU" class="headerlink" title="9.15ã€XPU"></a>9.15ã€XPU</h4><p>â€‹    XPUï¼šç™¾åº¦ä¸Xilinxå…¬å¸åœ¨2017å¹´Hotchipså¤§ä¼šä¸Šå‘å¸ƒçš„FPGAæ™ºèƒ½äº‘åŠ é€Ÿï¼Œå«256æ ¸ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151944.png" alt="img"></p>
<h2 id="9-16ã€ZPU"><a href="#9-16ã€ZPU" class="headerlink" title="9.16ã€ZPU"></a>9.16ã€ZPU</h2><p>â€‹    ZPUï¼šZylin Processing Unitã€‚ ç”±æŒªå¨Zylin å…¬å¸æ¨å‡ºçš„ä¸€æ¬¾32ä½å¼€æºå¤„ç†å™¨ã€‚</p>
<h2 id="9-17ã€å‡¸å‡¹è´´å›¾"><a href="#9-17ã€å‡¸å‡¹è´´å›¾" class="headerlink" title="9.17ã€å‡¸å‡¹è´´å›¾"></a>9.17ã€å‡¸å‡¹è´´å›¾</h2><p>â€‹    å‡¹å‡¸è´´å›¾ï¼šè®¡ç®—æœºå›¾å½¢å­¦åœ¨ä¸‰ç»´åœºæ™¯ä¸­å‡¸å‡¹å¤„ç†çš„ä¸€ä¸ªæŠ€æœ¯ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192151998.png" alt="img"></p>
<h2 id="9-18ã€åƒç´ å¡«å……ç‡"><a href="#9-18ã€åƒç´ å¡«å……ç‡" class="headerlink" title="9.18ã€åƒç´ å¡«å……ç‡"></a>9.18ã€åƒç´ å¡«å……ç‡</h2><p>â€‹    åƒç´ å¡«å……ç‡ï¼šæ¯ç§’æ¸²æŸ“çš„åƒç´ æ•°é‡ï¼Œæ—©æœŸ10äº¿çº§åˆ«ï¼Œç°åœ¨100äº¿çº§åˆ«ã€‚</p>
<h2 id="9-19ã€ä¸‰è§’å½¢ç”Ÿæˆé€Ÿåº¦"><a href="#9-19ã€ä¸‰è§’å½¢ç”Ÿæˆé€Ÿåº¦" class="headerlink" title="9.19ã€ä¸‰è§’å½¢ç”Ÿæˆé€Ÿåº¦"></a>9.19ã€ä¸‰è§’å½¢ç”Ÿæˆé€Ÿåº¦</h2><p>â€‹    ä¸‰è§’å½¢ç”Ÿæˆé€Ÿåº¦ï¼šä¸‰è§’å½¢æ˜¯ä¸‰ç»´å›¾å½¢æ¸²æŸ“çš„é‡è¦å•å…ƒï¼Œå½“å‰ä»åƒä¸‡åˆ°äº¿çº§åˆ«ä¸ç­‰ã€‚</p>
<h2 id="9-20ã€ç¡¬ä»¶T-L"><a href="#9-20ã€ç¡¬ä»¶T-L" class="headerlink" title="9.20ã€ç¡¬ä»¶T&amp;L"></a>9.20ã€ç¡¬ä»¶T&amp;L</h2><p>â€‹    ç¡¬ä»¶T&amp;Lï¼šæ˜¾å¡åæ ‡è½¬æ¢å’Œå…‰æºç¼–ç¨‹ã€‚</p>
<h2 id="9-21ã€DDR-æ˜¾å­˜"><a href="#9-21ã€DDR-æ˜¾å­˜" class="headerlink" title="9.21ã€DDR æ˜¾å­˜"></a>9.21ã€DDR æ˜¾å­˜</h2><p>â€‹    DDR æ˜¾å­˜ï¼šæ˜¾å¡çš„é«˜é€Ÿé¢—ç²’ï¼Œæœ‰æ›´å¿«çš„æ•°æ®äº¤äº’é€Ÿåº¦ã€‚</p>
<h2 id="9-22ã€HyperZ-æŠ€æœ¯"><a href="#9-22ã€HyperZ-æŠ€æœ¯" class="headerlink" title="9.22ã€HyperZ æŠ€æœ¯"></a>9.22ã€HyperZ æŠ€æœ¯</h2><p>â€‹    HyperZ æŠ€æœ¯ï¼šæ˜¾å­˜ä¼˜åŒ–ç®¡ç†å•å…ƒï¼Œé€šè¿‡å¿«é€ŸZè½´æ¸…é™¤ç­‰æ‰‹æ®µä¼˜åŒ–æ˜¾å­˜çš„åˆ©ç”¨æ•ˆç‡ã€‚</p>
<h2 id="9-23ã€æ˜¾å¡æµæ°´çº¿"><a href="#9-23ã€æ˜¾å¡æµæ°´çº¿" class="headerlink" title="9.23ã€æ˜¾å¡æµæ°´çº¿"></a>9.23ã€æ˜¾å¡æµæ°´çº¿</h2><p>â€‹    æ˜¾å¡æµæ°´çº¿ï¼šæ•°é‡çš„å¤šå°‘å†³å®šæ˜¾å¡æ€§èƒ½é«˜ä½çš„ä¸€ä¸ªå¾ˆé‡è¦çš„æŒ‡æ ‡ï¼ŒNvidiaå’ŒAMD-ATIä¹Ÿåœ¨ä¸æ–­åœ°å¢åŠ æ˜¾å¡çš„æµå¤„ç†å™¨æ•°é‡ä½¿æ˜¾å¡çš„æ€§èƒ½è¾¾åˆ°è·³è·ƒå¼å¢é•¿ã€‚è¿™ä¸ªå’Œæ ¸å¿ƒæ„å»ºï¼Œæ˜¾å­˜å¸¦å®½ç­‰å› ç´ é…åˆï¼Œå•ä¸€å¤šï¼Œæ„ä¹‰ä¸å¤§ã€‚</p>
<h2 id="9-24ã€F-Buffer"><a href="#9-24ã€F-Buffer" class="headerlink" title="9.24ã€F-Buffer"></a>9.24ã€F-Buffer</h2><p>â€‹    F-Bufferï¼šç‰‡æ–­æµç¼“å†²åŒºæŠ€æœ¯ï¼Œå¤„ç†æ— é™åˆ¶æŒ‡ä»¤é•¿åº¦çš„é˜´å½±ç€è‰²ç¨‹åºã€‚æ‰§è¡ŒåŸç†ï¼šæŠŠéœ€è¦ç»è¿‡æ¸²æŸ“å¼•æ“å¤šæ¬¡å¤„ç†çš„åƒç´ ä¸´æ—¶å­˜å‚¨èµ·æ¥ï¼Œè€Œä¸æ˜¯æŠŠå®ƒä»¬å†™åˆ°å¸§ç¼“å†²é‡Œé¢ã€‚åªæœ‰é‚£äº›éœ€è¦å•é€šé“å¤„ç†çš„æ•°æ®è¢«å†™åˆ°å¸§ç¼“å†²ã€‚è¿™æ ·èŠ‚çœæ˜¾å­˜çš„å¸¦å®½ï¼Œä»è€Œä½¿VPUå·¥ä½œå¾—æ›´åŠ æœ‰æ•ˆç‡ã€‚ç¼ºç‚¹ï¼šF-Bufferåªèƒ½å¯¹æ‰€æœ‰æµç¨‹éƒ½æ˜¯åŸºäºåŒä¸€è§†ç‚¹çš„å¤šæµç¨‹æ¸²æŸ“æœ‰æ•ˆï¼Œå¯¹äºç”¨äºç”Ÿæˆä¸åŒè§†ç‚¹å›¾åƒçš„å¤šæµç¨‹æ¸²æŸ“æ²¡ç”¨ï¼Œåœ¨æ—¥å¸¸3Dåº”ç”¨ä¸­ï¼Œä¸åŒè§†ç‚¹çš„å¤šæµç¨‹æ¸²æŸ“ååˆ†æ™®éã€‚å…¶æ¬¡F-Bufferçš„æ‰§è¡Œè¿‡ç¨‹æœ‰å¯èƒ½äº§ç”Ÿæº¢å‡ºï¼Œä¸€æ—¦äº§ç”Ÿæº¢å‡ºå…¶å¤„ç†è¿‡ç¨‹ååˆ†å¤æ‚ï¼Œä¼šå½±å“GPUçš„æ‰§è¡Œæ•ˆç‡ã€‚</p>
<h2 id="9-25ã€FPGA"><a href="#9-25ã€FPGA" class="headerlink" title="9.25ã€FPGA"></a>9.25ã€FPGA</h2><p>FPGAï¼šå¯ç¼–ç¨‹é€»è¾‘ï¼Œè®¡ç®—æ•ˆç‡é«˜ï¼Œæ›´æ¥è¿‘åº•å±‚IOï¼Œé€šè¿‡å†—ä½™æ™¶ä½“ç®¡å’Œè¿çº¿å®ç°é€»è¾‘å¯ç¼–è¾‘ã€‚æœ¬è´¨ä¸Šæ˜¯æ— æŒ‡ä»¤ã€æ— éœ€å…±äº«å†…å­˜ï¼Œè®¡ç®—æ•ˆç‡æ¯”CPUã€GPUé«˜ã€‚ä¸»è¦åº”ç”¨äºæ™ºèƒ½æ‰‹æœºã€ä¾¿æºå¼ç§»åŠ¨è®¾å¤‡ã€æ±½è½¦ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
  </entry>
  <entry>
    <title>éŸ³è§†é¢‘ç¼–è§£ç ç›¸å…³çŸ¥è¯†å­¦ä¹ </title>
    <url>/2023/11/19/8%20%E9%9F%B3%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å‰äº›å¤©ä¸€ç›´åœ¨ç ”ç©¶å…³äºGPUiç›¸å…³çš„çŸ¥è¯†ï¼Œåœ¨å‘¨å…­çš„æ—¶å€™ç»ˆäºæ˜¯å†™å¥½äº†ç›¸åº”çš„æµ‹è¯•æ‰‹å†Œï¼Œå‘¨ä¸€æ³•å¸ˆæ£€æµ‹å‡ºé—®é¢˜çš„è¯æˆ‘å†åŠ ï¼Œå…¶å®ä¹Ÿæ²¡å•¥å¯ä»¥åŠ çš„ä¸œè¥¿äº†ï¼Œä¸ç®¡æ˜¯OPENGLè¿˜æ˜¯OPENCLï¼Œåªè¦ç›¸åº”çš„maliåº“æˆåŠŸå³å¯ï¼Œå…¶ä»–çš„å€’æ˜¯æ²¡å•¥ï¼Œç„¶åå‘¢æˆ‘ä¹Ÿè¯¥å»æä¸€ä¸‹mpp éŸ³è§†é¢‘ç¼–è§£ç ç›¸å…³çš„ä¸œè¥¿äº†ï¼Œåé¢å…¶å®è¿˜æœ‰æ‘„åƒå¤´å•¥çš„ï¼Œè¿™äº›éƒ½æ˜¯è¦æçš„ï¼Œè‡³å°‘è½¯ä»¶é‡Œé¢æ˜¯è¦é€‚é…çš„å¯¹å§ï¼Œè¿˜æœ‰é‚£ä¸ªç¼ ç»•æˆ‘å¥½ä¹…çš„buildroot opencvçš„é—®é¢˜ï¼Œé—®é¢˜å¤ªå¤šäº†ï¼Œä½†æ˜¯æ€»è¦ä¸€ç‚¹ä¸€ç‚¹æ¥ï¼Œé—®é¢˜æ˜¯ä¸€ä¸ªä¸€ä¸ªè§£å†³çš„ï¼Œæ€»ä¸å¯èƒ½ä¸€è¹´è€Œå°±ï¼Œæ…¢æ…¢æ¥å‘—</p>
<h1 id="éŸ³è§†é¢‘çš„åŸºæœ¬æ¦‚å¿µ"><a href="#éŸ³è§†é¢‘çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="éŸ³è§†é¢‘çš„åŸºæœ¬æ¦‚å¿µ"></a>éŸ³è§†é¢‘çš„åŸºæœ¬æ¦‚å¿µ</h1><h2 id="ä¸€-è§†é¢‘"><a href="#ä¸€-è§†é¢‘" class="headerlink" title="ä¸€ è§†é¢‘"></a>ä¸€ è§†é¢‘</h2><h3 id="1ã€ç ç‡âˆš"><a href="#1ã€ç ç‡âˆš" class="headerlink" title="1ã€ç ç‡âˆš"></a>1ã€ç ç‡âˆš</h3><p>ç ç‡ï¼Œåˆå«æ¯”ç‰¹ç‡ï¼Œå•ä½æ—¶é—´å†…ä¼ è¾“çš„æ•°æ®é‡ï¼Œå•ä½ä¸€èˆ¬ä¸ºkbps(åƒä½æ¯ç§’)ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œbä»£è¡¨bitï¼Œè€Œä¸æ˜¯Byteï¼Œè¿™é‡Œä¹˜ä»¥8æ˜¯Byteè½¬æˆbitã€‚è®¡ç®—å…¬å¼ï¼šå¹³å‡ç ç‡(kbps)&#x3D;æ–‡ä»¶å¤§å°(kB)*8&#x2F;æ—¶é—´(s)ã€‚åŠ¨æ€ç ç‡(kbps)&#x3D;æ¯ç§’ä¼ è¾“æ•°æ®é‡(kB)*8ã€‚</p>
<p>â€œbpsâ€ æ˜¯ â€œbits per secondâ€ çš„ç¼©å†™ï¼ŒæŒ‡çš„æ˜¯æ•°æ®ä¼ è¾“é€Ÿç‡æˆ–æ¯”ç‰¹ç‡ï¼Œç”¨äºæµ‹é‡æ•°æ®åœ¨é€šä¿¡æˆ–å­˜å‚¨ç³»ç»Ÿä¸­çš„ä¼ è¾“é€Ÿåº¦ã€‚å®ƒè¡¨ç¤ºæ¯ç§’ä¼ è¾“çš„æ¯”ç‰¹æ•°ï¼Œå…¶ä¸­æ¯”ç‰¹æ˜¯è®¡ç®—æœºä¸­æœ€å°çš„æ•°æ®å•ä½ã€‚æ¯”ç‰¹ç‡é€šå¸¸ç”¨äºæè¿°ç½‘ç»œå¸¦å®½ã€è°ƒåˆ¶è§£è°ƒå™¨é€Ÿåº¦ã€æ•°å­—éŸ³é¢‘&#x2F;è§†é¢‘æµçš„ä¼ è¾“é€Ÿåº¦ç­‰ã€‚</p>
<p>æ’å®šç ç‡ï¼šCBRï¼Œç ç‡ç¨³å®šå¯æ§ï¼Œå¸¦å®½è¦æ±‚ä¸é«˜ï¼Œå›¾åƒå˜åŒ–é‡æ¯”è¾ƒå¤§æ—¶æ–¹å—æ•ˆåº”æ¯”è¾ƒæ˜æ˜¾ã€‚</p>
<p>åŠ¨æ€ç ç‡ï¼šVBRï¼Œç ç‡æ³¢åŠ¨è¾ƒå¤§ï¼Œå¸¦å®½è¦æ±‚è¾ƒé«˜ï¼Œå›¾åƒå˜åŒ–é‡æ¯”è¾ƒå¤§æ—¶æ–¹å—æ•ˆåº”æœ‰æ‰€æ”¹å–„ã€‚å‘ç”Ÿç½‘ç»œæŠ–åŠ¨æ—¶ï¼Œæ¯”è¾ƒå®¹æ˜“ä¸¢åŒ…ï¼Œéœ€è¦é‡ä¼ ï¼Œæˆ–è€…FECå‰å‘çº é”™ï¼Œä»è€Œå¸¦æ¥å»¶æ—¶ã€‚</p>
<h3 id="2ã€åˆ†è¾¨ç‡"><a href="#2ã€åˆ†è¾¨ç‡" class="headerlink" title="2ã€åˆ†è¾¨ç‡"></a>2ã€åˆ†è¾¨ç‡</h3><p>åˆ†è¾¨ç‡åˆç§°ä¸ºè§£æåº¦ï¼Œåˆ†è¾¨ç‡è¶Šé«˜ï¼Œåƒç´ è¶Šå¤šï¼Œå›¾åƒè¶Šæ¸…æ™°ã€‚</p>
<p>è§†é¢‘åˆ†è¾¨ç‡ï¼šåˆç§°ä¸ºå›¾åƒåˆ†è¾¨ç‡ï¼Œç”±è§†é¢‘çš„å®½é«˜ç»„æˆï¼Œè¡¨ç¤ºå½¢å¼å®½xé«˜ï¼Œå¸¸è§çš„è§†é¢‘åˆ†è¾¨ç‡æœ‰480Pã€720Pã€1080Pã€2K(2048x1080&#x2F;2160x1440)ã€4K(4096x2160&#x2F;3840x2160)ï¼Œå…·ä½“å¦‚ä¸‹è¡¨1æ‰€ç¤ºã€‚</p>
<p>å±å¹•åˆ†è¾¨ç‡ï¼šåˆç§°ä¸ºæ˜¾ç¤ºåˆ†è¾¨ç‡ï¼Œæè¿°å±å¹•åˆ†è¾¨ç‡çš„å•ä½æ˜¯ppi(pixel per inchï¼Œæ¯è‹±å¯¸çš„åƒç´ æ•°)ã€‚</p>
<p>ä½åˆ†è¾¨ç‡ï¼šåˆç§°ä¸ºä½æ·±(BitDepth)ï¼Œæ¯ä¸ªåƒç´ ç‚¹å­˜å‚¨ä¿¡æ¯çš„ä½æ•°ã€‚å¸¸è§çš„æœ‰ï¼š8ä½ã€16ä½ã€24ä½ã€32ä½è‰²å½©ã€‚Androidçš„Bitmapå¸¸è§çš„æœ‰ALPHA_8ã€RGB_565ã€ARGB_4444ã€ARGB_8888ã€‚</p>
<table>
<thead>
<tr>
<th align="left">æ˜¾ç¤ºæ¨¡å¼</th>
<th align="left">æ°´å¹³åƒç´ xå‚ç›´åƒç´ </th>
<th align="left">å®½é«˜æ¯”</th>
</tr>
</thead>
<tbody><tr>
<td align="left">QCIF</td>
<td align="left">176x144</td>
<td align="left">11:9</td>
</tr>
<tr>
<td align="left">QVGA</td>
<td align="left">320x240</td>
<td align="left">4:3</td>
</tr>
<tr>
<td align="left">CIF</td>
<td align="left">352x288</td>
<td align="left">11:9</td>
</tr>
<tr>
<td align="left">nHD</td>
<td align="left">640x360</td>
<td align="left">16:9</td>
</tr>
<tr>
<td align="left">VGA</td>
<td align="left">640x480</td>
<td align="left">4:3</td>
</tr>
<tr>
<td align="left">HD</td>
<td align="left">1280x720</td>
<td align="left">16:9</td>
</tr>
<tr>
<td align="left">Full HD</td>
<td align="left">1920x1080</td>
<td align="left">16:9</td>
</tr>
<tr>
<td align="left">2K(FHD+)</td>
<td align="left">2048x1080</td>
<td align="left">17:9</td>
</tr>
<tr>
<td align="left">4K(UHD)</td>
<td align="left">3840x2160</td>
<td align="left">16:9</td>
</tr>
</tbody></table>
<h3 id="3ã€å¸§ç‡"><a href="#3ã€å¸§ç‡" class="headerlink" title="3ã€å¸§ç‡"></a>3ã€å¸§ç‡</h3><p>è§†é¢‘å¸§ç‡ï¼šæµ‹é‡æ˜¾ç¤ºå¸§æ•°çš„é‡åº¦ï¼Œå•ä½ä¸ºæ¯ç§’æ˜¾ç¤ºå¸§æ•°(FPSï¼Œå…¨ç§°ä¸ºFrame Per Second)ã€‚ä¸€èˆ¬è§†é¢‘å¸§ç‡ä¸º24fpsï¼ŒPåˆ¶(PALï¼Œå¾·å›½æå‡ºï¼Œä¸­å›½ã€å°åº¦ã€å·´åŸºæ–¯å¦ç­‰å›½å®¶ä½¿ç”¨)ä¸º25fpsï¼Œä¹Ÿå°±æ˜¯æ¯å¸§æ˜¾ç¤º40msï¼ŒNåˆ¶(NTSCï¼Œç¾å›½æ ‡å‡†å§”å‘˜ä¼šæå‡ºï¼Œç¾å›½ã€æ—¥æœ¬ã€éŸ©å›½ç­‰å›½å®¶ä½¿ç”¨)ä¸º30fpsã€‚æœ‰äº›è¶…é«˜å¸§ç‡çš„è§†é¢‘è¾¾åˆ°60fpsã€‚</p>
<p>æ˜¾ç¤ºå¸§ç‡ï¼šä»¥å¸§ä¸ºå•ä½çš„ä½å›¾å›¾åƒè¿ç»­å‡ºç°åœ¨æ˜¾ç¤ºå™¨çš„é¢‘ç‡ï¼Œä¹Ÿç§°ä¸ºåˆ·æ–°é€Ÿç‡ã€‚Androidè®¾å¤‡åˆ·æ–°ç‡ä¸€èˆ¬ä¸º60Hzï¼Œä¹Ÿå°±æ˜¯å¸§ç‡ä¸º60fpsï¼Œæ¯å¸§ä¸º16msï¼Œè¶…è¿‡16msèƒ½ç»™äººçš„è‚‰çœ¼å¸¦æ¥å»¶è¿Ÿå¡é¡¿çš„æ„Ÿè§‰ã€‚åšæ€§èƒ½ä¼˜åŒ–æ–¹é¢ï¼Œä¹Ÿå°±æ˜¯ä¿è¯ä»æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶ã€ä¸Šä¼ æŒ‡ä»¤ã€ä¸GPUäº¤æ¢ç¼“å†²åŒºç­‰ä¸€ç³»åˆ—åŠ¨ä½œåœ¨16mså®Œæˆã€‚Android11æ”¯æŒ120Hzçš„æ›´é«˜å¸§ç‡ï¼Œä¸€èˆ¬ä¸ºå¯¹å¸§ç‡è¦æ±‚æé«˜çš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚äº’åŠ¨æ¸¸æˆã€‚</p>
<h3 id="4ã€åƒç´ æ ¼å¼"><a href="#4ã€åƒç´ æ ¼å¼" class="headerlink" title="4ã€åƒç´ æ ¼å¼"></a>4ã€åƒç´ æ ¼å¼</h3><p>åƒç´ æ ¼å¼ï¼šåƒç´ è‰²å½©åˆ†é‡çš„æ’åˆ—ï¼Œç”±æ¯ä¸ªåƒç´ ä½¿ç”¨çš„æ€»ä½æ•°ä»¥åŠå„åˆ†é‡çš„ä½æ•°å†³å®šã€‚å›¾åƒçš„åƒç´ æ ¼å¼ä¸€èˆ¬æ˜¯RGBAå››ä¸ªåˆ†é‡é€šé“å„å 8bitsï¼Œç»„æˆä¸€ä¸ª32ä½çš„åƒç´ ã€‚å…¶ä¸­Rä»£è¡¨Redã€Gä»£è¡¨Greenã€Bä»£è¡¨Blueã€Aä»£è¡¨Alphaã€‚ä½†æ˜¯ï¼Œè§†é¢‘å‹ç¼©å­˜å‚¨çš„åƒç´ æ ¼å¼ä¸æ˜¯RGBAï¼Œè€Œæ˜¯YUVï¼Œå…¶ä¸­Yä»£è¡¨äº®åº¦(Luma)ï¼ŒUä»£è¡¨è‰²åº¦(Chroma)ï¼ŒVä»£è¡¨å¯¹æ¯”åº¦(Contrast)ã€‚</p>
<h3 id="5ã€ç”»è´¨"><a href="#5ã€ç”»è´¨" class="headerlink" title="5ã€ç”»è´¨"></a>5ã€ç”»è´¨</h3><p>ç”»è´¨ï¼šç”»é¢è´¨é‡ï¼Œç”±æ¸…æ™°åº¦ã€é”åº¦ã€è§£æåº¦ã€è‰²å½©çº¯åº¦ã€è‰²å½©å¹³è¡¡ç­‰æŒ‡æ ‡æ„æˆã€‚</p>
<p>æ¸…æ™°åº¦ï¼šæŒ‡å›¾åƒç»†èŠ‚çº¹ç†åŠå…¶è¾¹ç•Œçš„æ¸…æ™°ç¨‹åº¦ã€‚</p>
<p>é”åº¦ï¼šååº”å›¾åƒå¹³é¢æ¸…æ™°ç¨‹åº¦ï¼Œä»¥åŠå›¾åƒè¾¹ç¼˜çš„é”åˆ©ç¨‹åº¦ã€‚</p>
<p>è§£æåº¦ï¼šæŒ‡åƒç´ ç‚¹çš„æ•°é‡ï¼Œä¸åˆ†è¾¨ç‡å¯¹åº”ï¼Œåˆ†è¾¨ç‡è¶Šé«˜ï¼Œè§£æåº¦è¶Šé«˜ã€‚</p>
<p>è‰²å½©çº¯åº¦ï¼šæŒ‡è‰²å½©çš„é²œè‰³ç¨‹åº¦ã€‚æ‰€æœ‰è‰²å½©éƒ½æ˜¯ä¸‰åŸè‰²ç»„æˆï¼Œå…¶ä»–é¢œè‰²éƒ½æ˜¯ä¸‰åŸè‰²æ··åˆè€Œæˆï¼Œç†è®ºä¸Šå¯ä»¥æ··åˆå‡º256ç§é¢œè‰²ã€‚åŸè‰²çš„çº¯åº¦æœ€é«˜ã€‚è‰²å½©çº¯åº¦æ˜¯æŒ‡åŸè‰²åœ¨è‰²å½©ä¸­çš„ç™¾åˆ†æ¯”ã€‚</p>
<p>è‰²å½©å¹³è¡¡ï¼šç”¨æ¥æ§åˆ¶å›¾åƒçš„è‰²å½©åˆ†å¸ƒï¼Œä½¿å¾—å›¾åƒæ•´ä½“è¾¾åˆ°è‰²å½©å¹³è¡¡ã€‚</p>
<h3 id="6ã€è‰²åŸŸä¸HDR"><a href="#6ã€è‰²åŸŸä¸HDR" class="headerlink" title="6ã€è‰²åŸŸä¸HDR"></a>6ã€è‰²åŸŸä¸HDR</h3><p>è‰²åŸŸï¼šæŒ‡æŸç§è¡¨è‰²æ¨¡å¼æ‰€èƒ½è¡¨è¾¾çš„é¢œè‰²æ„æˆçš„èŒƒå›´åŒºåŸŸï¼Œè‰²åŸŸç©ºé—´è¶Šå¤§ï¼Œæ‰€èƒ½è¡¨ç°çš„é¢œè‰²è¶Šå¤šã€‚</p>
<p>HDRï¼šHigh Danamic Rangeï¼Œé«˜åŠ¨æ€èŒƒå›´ï¼Œæ¯”æ™®é€šå›¾åƒæä¾›æ›´å¤šåŠ¨æ€èŒƒå›´å’Œå›¾åƒç»†èŠ‚ï¼Œèƒ½å¤Ÿæ›´å¥½ååº”çœŸå®ç¯å¢ƒçš„è§†è§‰æ•ˆæœã€‚é¢œè‰²å€¼ç»è¿‡å½’ä¸€åŒ–åï¼ŒèŒƒå›´ä¸€èˆ¬æ˜¯[0,1]ã€‚è€ŒHDRå¯ä»¥è¡¨è¾¾è¶…å‡º1çš„é¢œè‰²å€¼ï¼Œæ‹¥æœ‰æ›´å¤§çš„é¢œè‰²èŒƒå›´ã€‚</p>
<h3 id="7ã€æ—‹è½¬è§’åº¦"><a href="#7ã€æ—‹è½¬è§’åº¦" class="headerlink" title="7ã€æ—‹è½¬è§’åº¦"></a>7ã€æ—‹è½¬è§’åº¦</h3><p>æ—‹è½¬è§’åº¦ï¼šè§†é¢‘çš„YUVå‚¨å­˜æ–¹å‘ã€‚ä¸€èˆ¬çš„è§†é¢‘æ—‹è½¬è§’åº¦æ˜¯0Â°ï¼Œå¯¹åº”çš„æ˜¯æ¨ªå±æ˜¾ç¤ºã€‚åç½®æ‘„åƒå¤´ç«–å±æ‹çš„è§†é¢‘ï¼Œæ—‹è½¬è§’åº¦ä¸º90Â°ï¼Œå¯¹åº”çš„æ˜¯ç«–å±æ˜¾ç¤ºã€‚Androidä¸­å¯ä»¥é€šè¿‡MediaMetaDataRetrieverè·å–æ—‹è½¬è§’åº¦ã€‚</p>
<h3 id="8ã€æ—¶é•¿"><a href="#8ã€æ—¶é•¿" class="headerlink" title="8ã€æ—¶é•¿"></a>8ã€æ—¶é•¿</h3><p>è§†é¢‘æ‰€æœ‰å›¾åƒæ’­æ”¾æ‰€éœ€è¦çš„æ—¶é—´ç§°ä¸ºè§†é¢‘æ—¶é•¿ã€‚è®¡ç®—å…¬å¼ï¼šæ—¶é•¿(s)&#x3D;å¸§æ•°xæ¯å¸§æ—¶é•¿&#x3D;å¸§æ•°x(1&#x2F;å¸§ç‡)ã€‚å‡è®¾ä¸€ä¸ªè§†é¢‘å¸§æ•°ä¸º1000ï¼Œå¸§ç‡ä¸º25fpsï¼Œé‚£ä¹ˆæ—¶é•¿ä¸º40sã€‚</p>
<h3 id="9ã€å°è£…æ ¼å¼"><a href="#9ã€å°è£…æ ¼å¼" class="headerlink" title="9ã€å°è£…æ ¼å¼"></a>9ã€å°è£…æ ¼å¼</h3><p>å°è£…æ ¼å¼ï¼ˆContainer Formatï¼‰ï¼Œä¹Ÿè¢«ç§°ä¸ºå®¹å™¨æ ¼å¼ã€å¤šåª’ä½“å®¹å™¨æˆ–å°è£…åè®®ï¼Œæ˜¯ç”¨äºå°†éŸ³é¢‘ã€è§†é¢‘ã€å­—å¹•ç­‰å¤šç§åª’ä½“æ•°æ®è¿›è¡Œå°è£…å’Œå­˜å‚¨çš„æ–‡ä»¶æ ¼å¼ã€‚å®ƒå°†ä¸åŒç±»å‹çš„åª’ä½“æ•°æ®ç»„åˆåœ¨ä¸€èµ·ï¼ŒåŒæ—¶æä¾›äº†æ–‡ä»¶ç»“æ„ã€å…ƒæ•°æ®ã€åŒæ­¥ä¿¡æ¯å’Œç´¢å¼•ç­‰ï¼Œä»¥ä¾¿æ’­æ”¾å™¨æˆ–è§£ç å™¨èƒ½å¤Ÿæ­£ç¡®è§£æå’Œæ’­æ”¾åª’ä½“å†…å®¹ã€‚</p>
<p>å°è£…æ ¼å¼é€šå¸¸ç”±ä»¥ä¸‹å‡ ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†æ„æˆï¼š</p>
<ol>
<li>ç‰¹å®šæ ¼å¼å¤´ï¼ˆFormat Headerï¼‰ï¼šå°è£…æ ¼å¼çš„æ–‡ä»¶å¤´éƒ¨åˆ†åŒ…å«äº†å…³äºæ–‡ä»¶æœ¬èº«çš„é‡è¦ä¿¡æ¯ï¼Œå¦‚æ–‡ä»¶ç±»å‹ã€ç‰ˆæœ¬ã€æ€»ä½“æ–‡ä»¶å¤§å°ç­‰ã€‚è¿™äº›ä¿¡æ¯åœ¨è§£æå’Œå¤„ç†æ–‡ä»¶æ—¶èµ·åˆ°äº†å…³é”®ä½œç”¨ã€‚</li>
<li>åª’ä½“ä¿¡æ¯ï¼ˆMetadataï¼‰ï¼šå°è£…æ ¼å¼å¯ä»¥åŒ…å«æœ‰å…³åª’ä½“å†…å®¹çš„é™„åŠ ä¿¡æ¯ï¼Œä¾‹å¦‚æ ‡é¢˜ã€ä½œè€…ã€æè¿°ã€æ—¶é•¿ã€åˆ†è¾¨ç‡ã€é‡‡æ ·ç‡ç­‰ã€‚è¿™äº›å…ƒæ•°æ®æä¾›äº†æœ‰å…³åª’ä½“æ–‡ä»¶çš„æè¿°å’Œæ ‡è¯†ï¼Œä½¿å…¶èƒ½å¤Ÿè¢«æ­£ç¡®åœ°è¯†åˆ«å’Œåˆ†ç±»ã€‚</li>
<li>éŸ³è§†é¢‘è½¨ï¼ˆTrackï¼‰ï¼šå°è£…æ ¼å¼å¯ä»¥å®¹çº³å¤šä¸ªéŸ³é¢‘ã€è§†é¢‘æˆ–å­—å¹•è½¨é“ã€‚æ¯ä¸ªè½¨é“åŒ…å«ç›¸åº”åª’ä½“æ•°æ®çš„ç¼–ç ä¿¡æ¯ã€æ—¶é—´æˆ³å’Œç›¸å…³å‚æ•°ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè§†é¢‘è½¨é“å¯èƒ½åŒ…å«è§†é¢‘å¸§çš„å‹ç¼©ç¼–ç æ•°æ®ï¼Œè€Œä¸€ä¸ªéŸ³é¢‘è½¨é“å¯èƒ½åŒ…å«éŸ³é¢‘æ ·æœ¬çš„ç¼–ç æ•°æ®ã€‚</li>
<li>ç´¢å¼•ï¼ˆIndexï¼‰ï¼šä¸ºäº†å¿«é€Ÿå®šä½å’Œè®¿é—®åª’ä½“æ•°æ®ï¼Œå°è£…æ ¼å¼é€šå¸¸åŒ…å«ä¸€ä¸ªç´¢å¼•è¡¨ã€‚ç´¢å¼•è¡¨è®°å½•äº†æ–‡ä»¶ä¸­å„ä¸ªéƒ¨åˆ†çš„ä½ç½®ã€æ—¶é—´æˆ³å’Œé•¿åº¦ç­‰ä¿¡æ¯ï¼Œä»¥ä¾¿æ’­æ”¾å™¨èƒ½å¤Ÿå¿«é€Ÿå®šä½åˆ°éœ€è¦çš„æ•°æ®ä½ç½®ã€‚é€šè¿‡ç´¢å¼•ï¼Œæ’­æ”¾å™¨å¯ä»¥è·³è½¬åˆ°ç‰¹å®šæ—¶é—´ç‚¹æˆ–è½¨é“çš„ç‰¹å®šä½ç½®ã€‚</li>
<li>å…¶ä»–æ•°æ®ï¼šé™¤äº†ä¸Šè¿°ä¸»è¦ç»„æˆéƒ¨åˆ†ä¹‹å¤–ï¼Œå°è£…æ ¼å¼è¿˜å¯ä»¥åŒ…å«å…¶ä»–æ•°æ®ï¼Œå¦‚å­—å¹•è½¨é“ã€ç« èŠ‚ä¿¡æ¯ã€æè¿°æ–‡æœ¬ã€å°é¢å›¾åƒç­‰ã€‚è¿™äº›é™„åŠ æ•°æ®æä¾›äº†æ›´ä¸°å¯Œçš„åª’ä½“ä½“éªŒå’Œäº¤äº’åŠŸèƒ½ã€‚</li>
</ol>
<p>ä¸åŒçš„å°è£…æ ¼å¼å…·æœ‰ä¸åŒçš„ç‰¹ç‚¹å’ŒåŠŸèƒ½ã€‚ä¸€äº›å°è£…æ ¼å¼å…·æœ‰æ›´å¹¿æ³›çš„å…¼å®¹æ€§å’Œæµè¡Œåº¦ï¼Œä¾‹å¦‚MP4ï¼ˆMPEG-4 Part 14ï¼‰å’ŒMKVï¼ˆMatroskaï¼‰ã€‚è¿™äº›å°è£…æ ¼å¼æ”¯æŒå¤šç§ç¼–ç æ ¼å¼ã€å¤šä¸ªè½¨é“å’Œå¹¿æ³›çš„å…ƒæ•°æ®æ”¯æŒã€‚å…¶ä»–å°è£…æ ¼å¼å¦‚AVIã€MOVã€FLVç­‰ä¹Ÿæœ‰å„è‡ªçš„ç‰¹ç‚¹å’Œåº”ç”¨é¢†åŸŸã€‚</p>
<p>å°è£…æ ¼å¼åœ¨æ•°å­—åª’ä½“çš„å­˜å‚¨ã€ä¼ è¾“å’Œæ’­æ”¾ä¸­èµ·åˆ°äº†é‡è¦çš„ä½œç”¨ã€‚å®ƒä»¬æä¾›äº†ä¸€ç§æ ‡å‡†åŒ–çš„æ–¹å¼æ¥ç»„ç»‡å’Œç®¡ç†å¤šåª’ä½“æ•°æ®ï¼Œä½¿å¾—ä¸åŒç±»å‹çš„åª’ä½“å¯ä»¥åœ¨å„ç§è®¾å¤‡å’Œå¹³å°ä¸Šè¿›è¡Œå…¼å®¹æ€§æ’­æ”¾å’Œäº¤äº’ã€‚ã€‚</p>
<h3 id="10ã€ç¼–ç åè®®"><a href="#10ã€ç¼–ç åè®®" class="headerlink" title="10ã€ç¼–ç åè®®"></a>10ã€ç¼–ç åè®®</h3><p>ç¼–ç åè®®æ˜¯æŒ‡ç”¨äºå°†åŸå§‹è§†é¢‘æ•°æ®è¿›è¡Œå‹ç¼©å’Œç¼–ç çš„ç‰¹å®šç®—æ³•å’Œè§„èŒƒã€‚è¿™äº›ç¼–ç åè®®çš„ç›®çš„æ˜¯å‡å°è§†é¢‘æ–‡ä»¶çš„å¤§å°å¹¶æé«˜ä¼ è¾“å’Œå­˜å‚¨æ•ˆç‡ï¼ŒåŒæ—¶å°½é‡ä¿æŒè¾ƒé«˜çš„è§†é¢‘è´¨é‡ã€‚ä»¥ä¸‹æ˜¯å¯¹å‡ ç§å¸¸è§çš„è§†é¢‘ç¼–ç åè®®çš„è¯¦ç»†ä»‹ç»ï¼š</p>
<ol>
<li>H.264 &#x2F; AVCï¼šH.264ï¼ˆä¹Ÿç§°ä¸ºé«˜çº§è§†é¢‘ç¼–ç ï¼ŒAdvanced Video Codingï¼‰æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„è§†é¢‘ç¼–ç åè®®ã€‚å®ƒé‡‡ç”¨äº†å…ˆè¿›çš„å‹ç¼©æŠ€æœ¯ï¼Œèƒ½å¤Ÿæä¾›è¾ƒé«˜çš„è§†é¢‘è´¨é‡å’Œæ›´ä½çš„æ¯”ç‰¹ç‡ã€‚H.264å¹¿æ³›åº”ç”¨äºå„ç§é¢†åŸŸï¼ŒåŒ…æ‹¬äº’è”ç½‘è§†é¢‘æµåª’ä½“ã€è“å…‰å…‰ç›˜ã€è§†é¢‘ä¼šè®®ç­‰ã€‚</li>
<li>H.265 &#x2F; HEVCï¼šH.265ï¼ˆHigh Efficiency Video Codingï¼‰æ˜¯H.264çš„åç»§è€…ï¼Œä¹Ÿæ˜¯ä¸€ç§å…ˆè¿›çš„è§†é¢‘ç¼–ç åè®®ã€‚ç›¸æ¯”äºH.264ï¼ŒH.265èƒ½å¤Ÿè¿›ä¸€æ­¥å‡å°è§†é¢‘æ–‡ä»¶å¤§å°ï¼Œå¹¶æä¾›æ›´é«˜çš„è§†é¢‘è´¨é‡ã€‚å®ƒåœ¨ä¿æŒç›¸åŒè§†é¢‘è´¨é‡çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿå°†æ¯”ç‰¹ç‡é™ä½çº¦50%ã€‚H.265å¸¸ç”¨äº4Kå’Œ8Ké«˜åˆ†è¾¨ç‡è§†é¢‘ã€æµåª’ä½“æœåŠ¡ç­‰ã€‚</li>
<li>VP8 &#x2F; VP9ï¼šVP8å’ŒVP9æ˜¯ç”±Googleå¼€å‘çš„å¼€æ”¾æºä»£ç è§†é¢‘ç¼–ç åè®®ã€‚å®ƒä»¬æä¾›äº†é«˜æ•ˆçš„è§†é¢‘å‹ç¼©å’Œè¾ƒé«˜çš„è§†é¢‘è´¨é‡ï¼Œå¹¶è¢«å¹¿æ³›åº”ç”¨äºWebRTCã€WebMç­‰äº’è”ç½‘æ ‡å‡†ä¸­ã€‚VP9ç›¸æ¯”VP8è¿›ä¸€æ­¥æå‡äº†å‹ç¼©æ€§èƒ½ï¼Œèƒ½å¤Ÿåœ¨æ›´ä½çš„æ¯”ç‰¹ç‡ä¸‹ä¿æŒè¾ƒé«˜çš„è§†é¢‘è´¨é‡ã€‚</li>
<li>MPEG-4ï¼šMPEG-4æ˜¯ä¸€ç³»åˆ—çš„è§†é¢‘ç¼–ç åè®®ï¼ŒåŒ…æ‹¬MPEG-4 Part 2å’ŒMPEG-4 Part 10ï¼ˆä¹Ÿç§°ä¸ºH.264ï¼‰ã€‚MPEG-4 Part 2å¸¸ç”¨äºè§†é¢‘çš„å­˜å‚¨å’Œä¼ è¾“ï¼Œè€ŒMPEG-4 Part 10ï¼ˆH.264ï¼‰è¢«å¹¿æ³›ä½¿ç”¨äºå„ç§åº”ç”¨ï¼ŒåŒ…æ‹¬äº’è”ç½‘è§†é¢‘ã€ç§»åŠ¨è§†é¢‘ç­‰ã€‚</li>
<li>MJPEGï¼šMJPEGï¼ˆMotion JPEGï¼‰æ˜¯ä¸€ç§å°†è§†é¢‘ä¸­çš„æ¯ä¸€å¸§éƒ½ä½œä¸ºç‹¬ç«‹çš„JPEGå›¾åƒè¿›è¡Œå‹ç¼©çš„ç¼–ç åè®®ã€‚å®ƒé€‚ç”¨äºä¸€äº›ç‰¹å®šåº”ç”¨ï¼Œå¦‚æ‘„åƒå¤´å’Œè§†é¢‘ç›‘æ§ç³»ç»Ÿã€‚å°½ç®¡MJPEGåœ¨å‹ç¼©ç‡å’Œå­˜å‚¨æ•ˆç‡æ–¹é¢æ¯”è¾ƒä½ï¼Œä½†è§£ç è¿‡ç¨‹ç›¸å¯¹ç®€å•ï¼Œé¿å…äº†å¸§é—´é¢„æµ‹ç­‰å¤æ‚çš„ç®—æ³•ã€‚</li>
<li>WMV3ï¼šWMV3ï¼ˆWindows Media Video 3ï¼‰æ˜¯ç”±å¾®è½¯å¼€å‘çš„ä¸€ç§è§†é¢‘ç¼–ç åè®®ã€‚å®ƒå¹¿æ³›ç”¨äºWindows Media Playerå’Œå…¶ä»–å¾®è½¯äº§å“ä¸­ï¼Œæä¾›äº†è¾ƒå¥½çš„è§†é¢‘è´¨é‡å’Œå‹ç¼©æ•ˆç‡ã€‚WMV3æ”¯æŒå„ç§åˆ†è¾¨ç‡å’Œæ¯”ç‰¹ç‡ï¼Œå¹¶å…·æœ‰è¾ƒå¥½çš„å…¼å®¹æ€§ã€‚</li>
</ol>
<p>è¿™äº›ç¼–ç åè®®åœ¨è§†é¢‘å‹ç¼©æ–¹é¢é‡‡ç”¨äº†ä¸åŒçš„ç®—æ³•å’ŒæŠ€æœ¯ï¼Œä»¥å¹³è¡¡è§†é¢‘è´¨é‡ã€å‹ç¼©æ¯”å’Œè§£ç å¤æ‚æ€§ã€‚ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œè®¾å¤‡å¯èƒ½é€‰æ‹©ä¸åŒçš„ç¼–ç åè®®ï¼Œæ ¹æ®éœ€æ±‚å’Œé™åˆ¶æ¥å¹³è¡¡è§†é¢‘è´¨é‡å’Œæ€§èƒ½ã€‚</p>
<h3 id="11ã€è§†é¢‘æ’­æ”¾æ•´ä½“æµç¨‹"><a href="#11ã€è§†é¢‘æ’­æ”¾æ•´ä½“æµç¨‹" class="headerlink" title="11ã€è§†é¢‘æ’­æ”¾æ•´ä½“æµç¨‹"></a>11ã€è§†é¢‘æ’­æ”¾æ•´ä½“æµç¨‹</h3><p>å½“æ‚¨åœ¨ç”µè„‘ä¸Šæ‰“å¼€ä¸€ä¸ªè§†é¢‘æ–‡ä»¶æ—¶ï¼Œæ¶‰åŠåˆ°äº†å¤šä¸ªæ­¥éª¤å’Œç»„ä»¶ï¼Œä»¥ç¡®ä¿è§†é¢‘èƒ½å¤Ÿè¢«æ­£ç¡®è§£ç å’Œæ˜¾ç¤ºã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªè¯¦ç»†çš„è§†é¢‘æ–‡ä»¶åœ¨ç”µè„‘ä¸Šæ˜¾ç¤ºçš„å…¸å‹æµç¨‹ï¼š</p>
<ol>
<li>æ–‡ä»¶è¯»å–ï¼šè®¡ç®—æœºé¦–å…ˆä¼šè¯»å–è§†é¢‘æ–‡ä»¶çš„æ•°æ®ã€‚è¿™æ¶‰åŠä»ç¡¬ç›˜æˆ–å…¶ä»–å­˜å‚¨è®¾å¤‡ä¸­è¯»å–æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶å°†å…¶åŠ è½½åˆ°è®¡ç®—æœºçš„å†…å­˜ä¸­ä»¥ä¾›åç»­å¤„ç†ã€‚</li>
<li>å°è£…æ ¼å¼è§£æï¼šè®¡ç®—æœºä¼šæ ¹æ®è§†é¢‘æ–‡ä»¶çš„å°è£…æ ¼å¼ï¼ˆå¦‚MP4ã€MKVç­‰ï¼‰æ¥è§£ææ–‡ä»¶çš„ç»“æ„å’Œå…ƒæ•°æ®ã€‚è¿™åŒ…æ‹¬è¯»å–æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯ã€ç´¢å¼•è¡¨å’Œåª’ä½“è½¨é“çš„æè¿°ç­‰ã€‚é€šè¿‡è§£æå°è£…æ ¼å¼ï¼Œè®¡ç®—æœºå¯ä»¥äº†è§£è§†é¢‘æ–‡ä»¶çš„æ•´ä½“ç»“æ„å’Œå†…å®¹ã€‚</li>
<li>è§†é¢‘è§£ç ï¼šè§†é¢‘è§£ç å™¨å¼€å§‹å¯¹è§†é¢‘è½¨é“è¿›è¡Œè§£ç ã€‚å®ƒæ ¹æ®å°è£…æ ¼å¼ä¸­å­˜å‚¨çš„è§†é¢‘ç¼–ç å™¨ä¿¡æ¯ï¼Œè§£ç å‹ç¼©çš„è§†é¢‘æ•°æ®å¹¶å°†å…¶è½¬æ¢ä¸ºåŸå§‹çš„åƒç´ æ•°æ®ã€‚è§£ç è¿‡ç¨‹æ¶‰åŠå¯¹è§†é¢‘å¸§è¿›è¡Œé€å¸§è§£å‹ç¼©å’Œé‡æ„ï¼Œä»¥è¿˜åŸå‡ºåŸå§‹çš„å›¾åƒæ•°æ®ã€‚</li>
<li>éŸ³é¢‘è§£ç ï¼šå¦‚æœè§†é¢‘æ–‡ä»¶åŒ…å«éŸ³é¢‘è½¨é“ï¼ŒéŸ³é¢‘è§£ç å™¨å°†å¯¹éŸ³é¢‘è½¨é“è¿›è¡Œè§£ç ã€‚ç±»ä¼¼äºè§†é¢‘è§£ç è¿‡ç¨‹ï¼ŒéŸ³é¢‘è§£ç å™¨æ ¹æ®å°è£…æ ¼å¼ä¸­çš„éŸ³é¢‘ç¼–ç å™¨ä¿¡æ¯ï¼Œè§£ç å‹ç¼©çš„éŸ³é¢‘æ•°æ®å¹¶å°†å…¶è½¬æ¢ä¸ºåŸå§‹çš„éŸ³é¢‘æ ·æœ¬æ•°æ®ã€‚</li>
<li>åŒæ­¥å’Œæ’­æ”¾ï¼šè§†é¢‘è§£ç å™¨å’ŒéŸ³é¢‘è§£ç å™¨çš„è¾“å‡ºéœ€è¦è¿›è¡ŒåŒæ­¥ï¼Œä»¥ç¡®ä¿è§†é¢‘å’ŒéŸ³é¢‘çš„æ’­æ”¾ä¿æŒä¸€è‡´ã€‚è®¡ç®—æœºä½¿ç”¨æ—¶é—´æˆ³ã€å¸§ç‡å’Œé‡‡æ ·ç‡ç­‰ä¿¡æ¯æ¥ç¡®ä¿è§†é¢‘å’ŒéŸ³é¢‘æµçš„åŒæ­¥ï¼Œå¹¶æ ¹æ®æ˜¾ç¤ºè®¾å¤‡çš„åˆ·æ–°ç‡æ¥è¿›è¡Œé€‚å½“çš„å¸§ç‡è°ƒæ•´ã€‚</li>
<li>å›¾åƒæ¸²æŸ“ï¼šè®¡ç®—æœºä½¿ç”¨å›¾åƒæ¸²æŸ“å™¨å°†è§£ç åçš„è§†é¢‘åƒç´ æ•°æ®è½¬æ¢ä¸ºé€‚åˆæ˜¾ç¤ºçš„å›¾åƒæ ¼å¼ã€‚è¿™å¯èƒ½æ¶‰åŠè‰²å½©ç©ºé—´è½¬æ¢ã€è°ƒæ•´å›¾åƒå¤§å°ã€åº”ç”¨æ»¤é•œæˆ–æ•ˆæœç­‰å¤„ç†ã€‚</li>
<li>éŸ³é¢‘æ¸²æŸ“ï¼šç±»ä¼¼åœ°ï¼ŒéŸ³é¢‘æ¸²æŸ“å™¨å°†è§£ç åçš„éŸ³é¢‘æ ·æœ¬æ•°æ®è½¬æ¢ä¸ºé€‚åˆéŸ³é¢‘è¾“å‡ºè®¾å¤‡çš„éŸ³é¢‘æ ¼å¼ã€‚è¿™å¯èƒ½åŒ…æ‹¬éŸ³é¢‘æ··åˆã€éŸ³é‡è°ƒæ•´ã€ç©ºé—´æ•ˆæœç­‰å¤„ç†ã€‚</li>
<li>æ˜¾ç¤ºè¾“å‡ºï¼šæœ€åï¼Œè®¡ç®—æœºå°†æ¸²æŸ“åçš„è§†é¢‘å›¾åƒå’ŒéŸ³é¢‘æ•°æ®å‘é€åˆ°æ˜¾ç¤ºè®¾å¤‡å’Œæ‰¬å£°å™¨ï¼Œä»¥è¿›è¡Œå®é™…çš„æ’­æ”¾ã€‚è¿™å¯èƒ½æ¶‰åŠå°†è§†é¢‘å›¾åƒä¼ è¾“åˆ°æ˜¾ç¤ºå™¨ï¼Œå¹¶é€šè¿‡æ˜¾ç¤ºå™¨çš„ç¡¬ä»¶å’Œè½¯ä»¶è¿›è¡Œæ˜¾ç¤ºã€‚åŒæ—¶ï¼ŒéŸ³é¢‘æ•°æ®ä¹Ÿä¼šè¢«å‘é€åˆ°æ‰¬å£°å™¨æˆ–éŸ³é¢‘è¾“å‡ºè®¾å¤‡è¿›è¡Œæ’­æ”¾ã€‚</li>
</ol>
<h2 id="äºŒ-éŸ³é¢‘"><a href="#äºŒ-éŸ³é¢‘" class="headerlink" title="äºŒ éŸ³é¢‘"></a>äºŒ éŸ³é¢‘</h2><h3 id="1ã€é‡‡æ ·ç‡"><a href="#1ã€é‡‡æ ·ç‡" class="headerlink" title="1ã€é‡‡æ ·ç‡"></a>1ã€é‡‡æ ·ç‡</h3><p>é‡‡æ ·ç‡ï¼šå¯¹å£°éŸ³ä¿¡å·æ¯ç§’çš„é‡‡æ ·æ¬¡æ•°ï¼Œé‡‡æ ·ç‡è¶Šé«˜ï¼Œå£°éŸ³çš„è¿˜åŸè¶ŠçœŸå®ã€‚é‡‡æ ·ç‡å•ä½ä¸ºHzï¼Œå¸¸è§çš„é‡‡æ ·ç‡æœ‰ï¼š8000Hzã€16000Hzã€44100Hzã€48000Hzã€‚äººç±»ä¸€èˆ¬èƒ½å¤Ÿå¬åˆ°çš„å£°éŸ³èŒƒå›´ï¼š20Hzï½20000Hzã€‚æ ¹æ®å¥ˆå¥æ–¯ç‰¹é‡‡æ ·å®šç†ï¼šå½“é‡‡æ ·é¢‘ç‡å¤§äºä¿¡å·ä¸­æœ€é«˜é¢‘ç‡çš„2å€æ—¶ï¼Œé‡‡æ ·åçš„æ•°å­—ä¿¡å·èƒ½å¤Ÿå®Œæ•´ä¿ç•™åŸå§‹ä¿¡å·çš„ä¿¡æ¯ã€‚</p>
<h3 id="2ã€å£°é“"><a href="#2ã€å£°é“" class="headerlink" title="2ã€å£°é“"></a>2ã€å£°é“</h3><p>å£°é“ï¼šæŒ‡å£°éŸ³åœ¨å½•åˆ¶æˆ–æ’­æ”¾æ—¶ï¼Œåœ¨ä¸åŒç©ºé—´ä½ç½®é‡‡é›†æˆ–å›æ”¾çš„ç›¸äº’ç‹¬ç«‹éŸ³é¢‘ä¿¡å·ã€‚å£°é“æ•°æŒ‡åœ¨å½•éŸ³æ—¶çš„éŸ³æºæ•°é‡ï¼Œæˆ–è€…åœ¨æ’­æ”¾æ—¶çš„æ‰¬å£°å™¨æ•°é‡ã€‚</p>
<h3 id="3ã€å£°é“å¸ƒå±€"><a href="#3ã€å£°é“å¸ƒå±€" class="headerlink" title="3ã€å£°é“å¸ƒå±€"></a>3ã€å£°é“å¸ƒå±€</h3><p>ä¸åŒå£°é“æ•°å¯¹åº”ä¸åŒå£°é“å¸ƒå±€ã€‚å¸¸è§çš„å£°é“å¸ƒå±€æœ‰å•å£°é“(mono)ã€ç«‹ä½“å£°é“(stereo)ã€å››å£°ç¯ç»•ã€5.1å£°é“ã€‚</p>
<p>å•å£°é“ï¼šåªæœ‰ä¸€ä¸ªå£°é“ï¼Œä¼˜ç‚¹æ•°æ®é‡å°ï¼Œamr_nbå’Œamr_wbé»˜è®¤ä¸ºå•å£°é“ï¼Œç¼ºç‚¹æ˜¯ç¼ºä¹å¯¹å£°éŸ³ä½ç½®å®šä½ã€‚</p>
<p>ç«‹ä½“å£°é“ï¼šä¸€èˆ¬ä¸ºä¸¤ä¸ªå£°é“ï¼Œç”±å·¦å£°é“ã€å³å£°é“ç»„æˆï¼Œæ”¹å–„å¯¹å£°éŸ³ä½ç½®å®šä½çš„çŠ¶å†µã€‚</p>
<p>å››å£°ç¯ç»•ï¼šç”±å‰å·¦ã€å‰å³ã€åå·¦ã€åå³ç»„æˆï¼Œå½¢æˆç«‹ä½“ç¯ç»•ã€‚4.1å£°é“æ˜¯åœ¨å››å£°ç¯ç»•åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªä½éŸ³ã€‚</p>
<p>5.1å£°é“ï¼šåœ¨4.1åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªä¸­åœºå£°é“ï¼Œæœæ¯”AC3å°±æ˜¯é‡‡ç”¨5.1å£°é“ï¼Œä¹Ÿå°±æ˜¯å½±é™¢å®£ä¼ çš„æœæ¯”éŸ³æ•ˆã€‚</p>
<h3 id="4ã€éŸ³è´¨"><a href="#4ã€éŸ³è´¨" class="headerlink" title="4ã€éŸ³è´¨"></a>4ã€éŸ³è´¨</h3><p>éŸ³è´¨ï¼šå£°éŸ³çš„è´¨é‡ï¼Œç»è¿‡ç¼–ç å‹ç¼©åçš„éŸ³é¢‘ä¿¡å·ä¿çœŸåº¦ï¼Œç”±éŸ³é‡ã€éŸ³é«˜å’ŒéŸ³è‰²ç»„æˆã€‚</p>
<p>éŸ³é‡ï¼šéŸ³é¢‘çš„å¼ºåº¦ï¼Œæ•°å€¼èŒƒå›´0-100ï¼Œé™éŸ³æ—¶ä¸º0ï¼Œæœ€å¤§å€¼ä¸º100ã€‚Androidä¸­æœ‰æä¾›éŸ³é‡å¢å¼ºLoudnessEnhancerï¼Œè°ƒèŠ‚å£°éŸ³åˆ†è´å€¼ã€‚</p>
<p>éŸ³é«˜ï¼šå£°éŸ³çš„éŸ³è°ƒï¼Œå³éŸ³é¢‘é¢‘ç‡æˆ–æ¯ç§’å˜åŒ–æ¬¡æ•°ã€‚</p>
<p>éŸ³è‰²ï¼šéŸ³é¢‘æ³›éŸ³ï¼Œåˆç§°ä¸ºéŸ³å“ï¼Œä¸åŒå£°éŸ³è¡¨ç°åœ¨æ³¢å½¢æ–¹é¢ä¸ä¼—ä¸åŒçš„ç‰¹æ€§ã€‚</p>
<h3 id="5ã€å°è£…æ ¼å¼"><a href="#5ã€å°è£…æ ¼å¼" class="headerlink" title="5ã€å°è£…æ ¼å¼"></a>5ã€å°è£…æ ¼å¼</h3><p>éŸ³é¢‘çš„å°è£…æ ¼å¼ï¼Œä¸è§†é¢‘å°è£…æ ¼å¼ç±»ä¼¼ï¼Œç”±ç‰¹å®šæ ¼å¼å¤´+åª’ä½“ä¿¡æ¯+éŸ³é¢‘è½¨æ•°æ®ç»„æˆã€‚å¸¸è§çš„å°è£…æ ¼å¼æœ‰ï¼šmp3ã€m4aã€oggã€amrã€wmaã€wavã€flacã€aacã€apeç­‰ã€‚</p>
<ol>
<li>MP3ï¼ˆMPEG Audio Layer IIIï¼‰ï¼šMP3 æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„éŸ³é¢‘å°è£…æ ¼å¼ï¼Œå…·æœ‰è¾ƒé«˜çš„å‹ç¼©æ¯”å’ŒéŸ³è´¨ï¼Œé€‚ç”¨äºéŸ³ä¹å’Œè¯­éŸ³çš„å­˜å‚¨å’Œä¼ è¾“ã€‚</li>
<li>M4Aï¼ˆMPEG-4 Audioï¼‰ï¼šM4A æ˜¯è‹¹æœå…¬å¸ä½¿ç”¨çš„éŸ³é¢‘å°è£…æ ¼å¼ï¼Œå®ƒå¯ä»¥åŒ…å«å¤šç§ç¼–ç æ ¼å¼çš„éŸ³é¢‘æ•°æ®ï¼Œå¦‚ AACï¼ˆAdvanced Audio Codingï¼‰å’Œ ALACï¼ˆApple Lossless Audio Codecï¼‰ã€‚M4A æ ¼å¼é€šå¸¸ä¸ iTunes å’Œ Apple è®¾å¤‡ç›¸å…³è”ã€‚</li>
<li>OGGï¼šOGG æ˜¯ä¸€ç§è‡ªç”±å¼€æ”¾çš„éŸ³é¢‘å°è£…æ ¼å¼ï¼Œæ”¯æŒå¤šç§ç¼–ç æ ¼å¼ï¼Œå¦‚ Vorbisã€Opus ç­‰ã€‚å®ƒå…·æœ‰è¾ƒå¥½çš„éŸ³è´¨å’Œå‹ç¼©æ¯”ï¼Œå¸¸ç”¨äºç½‘ç»œæµåª’ä½“å’Œæ¸¸æˆéŸ³æ•ˆã€‚</li>
<li>AMRï¼ˆAdaptive Multi-Rateï¼‰ï¼šAMR æ˜¯ä¸€ç§ç”¨äºè¯­éŸ³ç¼–ç å’Œå°è£…çš„æ ¼å¼ï¼Œä¸»è¦ç”¨äºæ‰‹æœºé€šè¯å’Œè¯­éŸ³å½•åˆ¶ã€‚å®ƒå…·æœ‰è¾ƒé«˜çš„å‹ç¼©æ¯”ï¼Œé€‚åˆåœ¨ä½æ¯”ç‰¹ç‡ä¸‹ä¼ è¾“è¯­éŸ³æ•°æ®ã€‚</li>
<li>WMAï¼ˆWindows Media Audioï¼‰ï¼šWMA æ˜¯å¾®è½¯å¼€å‘çš„éŸ³é¢‘å°è£…æ ¼å¼ï¼Œæ”¯æŒå¤šç§ç¼–ç æ ¼å¼ï¼Œå¦‚ WMA æ ‡å‡†ã€WMA Pro å’Œ WMA Losslessã€‚å®ƒåœ¨ Windows å¹³å°ä¸Šå¾—åˆ°å¹¿æ³›åº”ç”¨ï¼Œå¸¸ç”¨äºéŸ³ä¹å’ŒéŸ³é¢‘æµåª’ä½“ã€‚</li>
<li>WAVï¼ˆWaveform Audio File Formatï¼‰ï¼šWAV æ˜¯ä¸€ç§æ— æŸéŸ³é¢‘å°è£…æ ¼å¼ï¼Œå®ƒå­˜å‚¨åŸå§‹éŸ³é¢‘æ•°æ®ï¼Œä¸è¿›è¡Œå‹ç¼©ã€‚WAV æ ¼å¼å…·æœ‰è¾ƒé«˜çš„éŸ³è´¨ï¼Œå¸¸ç”¨äºéŸ³ä¹åˆ¶ä½œå’ŒéŸ³é¢‘ç¼–è¾‘ã€‚</li>
<li>FLACï¼ˆFree Lossless Audio Codecï¼‰ï¼šFLAC æ˜¯ä¸€ç§æ— æŸéŸ³é¢‘å°è£…æ ¼å¼ï¼Œå®ƒå¯ä»¥å®ç°æ— æŸçš„éŸ³é¢‘å‹ç¼©å’Œè§£å‹ç¼©ï¼Œä¿ç•™äº†åŸå§‹éŸ³é¢‘æ•°æ®çš„å®Œæ•´æ€§ã€‚FLAC æ ¼å¼é€‚ç”¨äºéŸ³ä¹å­˜å‚¨å’ŒéŸ³é¢‘ä¼ è¾“ã€‚</li>
<li>AACï¼ˆAdvanced Audio Codingï¼‰ï¼šAAC æ˜¯ä¸€ç§é«˜çº§éŸ³é¢‘ç¼–ç æ ¼å¼ï¼Œå¸¸ç”¨äºéŸ³ä¹å’Œè§†é¢‘çš„å­˜å‚¨å’Œä¼ è¾“ã€‚å®ƒå…·æœ‰è¾ƒé«˜çš„éŸ³è´¨å’Œå‹ç¼©æ•ˆç‡ï¼Œæ˜¯ç›®å‰å¹¿æ³›æ”¯æŒçš„éŸ³é¢‘ç¼–ç æ ¼å¼ã€‚</li>
<li>APEï¼ˆMonkeyâ€™s Audioï¼‰ï¼šAPE æ˜¯ä¸€ç§æ— æŸéŸ³é¢‘å°è£…æ ¼å¼ï¼Œç±»ä¼¼äº FLACï¼Œä½†å‹ç¼©æ¯”ç•¥ä½ã€‚å®ƒå¸¸ç”¨äºéŸ³ä¹å­˜å‚¨å’ŒéŸ³é¢‘ä¼ è¾“ï¼Œæä¾›äº†è¾ƒé«˜çš„éŸ³è´¨å’Œæ–‡ä»¶å‹ç¼©ç‡ã€‚</li>
</ol>
<h3 id="6ã€ç¼–ç åè®®"><a href="#6ã€ç¼–ç åè®®" class="headerlink" title="6ã€ç¼–ç åè®®"></a>6ã€ç¼–ç åè®®</h3><p>éŸ³é¢‘ç»è¿‡è§£å°è£…å¾—åˆ°çš„éŸ³é¢‘è½¨æ•°æ®ï¼Œä¹Ÿæ˜¯ç»è¿‡ç¼–ç çš„ã€‚å¸¸è§çš„éŸ³é¢‘ç¼–ç åè®®æœ‰ï¼šmp3ã€aacã€amr_nbã€amr_wbã€ac3ã€vorbisã€opusã€flacã€wmav2ç­‰ã€‚</p>
<ol>
<li>MP3ï¼ˆMPEG Audio Layer IIIï¼‰ï¼šMP3 æ˜¯ä¸€ç§å¸¸è§çš„æœ‰æŸéŸ³é¢‘ç¼–ç æ ¼å¼ï¼Œå®ƒé€šè¿‡ç§»é™¤äººè€³å¬ä¸åˆ°æˆ–å¯¹éŸ³è´¨å½±å“è¾ƒå°çš„éŸ³é¢‘ä¿¡å·ï¼Œå®ç°äº†è¾ƒé«˜çš„å‹ç¼©æ¯”ã€‚MP3 æ ¼å¼å¹¿æ³›ç”¨äºéŸ³ä¹å­˜å‚¨å’Œä¼ è¾“ã€‚</li>
<li>AACï¼ˆAdvanced Audio Codingï¼‰ï¼šAAC æ˜¯ä¸€ç§å…ˆè¿›çš„éŸ³é¢‘ç¼–ç æ ¼å¼ï¼Œå®ƒåœ¨éŸ³è´¨å’Œå‹ç¼©æ•ˆç‡ä¸Šä¼˜äº MP3ã€‚AAC å¸¸ç”¨äºéŸ³ä¹ã€è§†é¢‘å’Œæµåª’ä½“çš„å­˜å‚¨å’Œä¼ è¾“ï¼Œè¢«å¹¿æ³›æ”¯æŒã€‚</li>
<li>AMR-NBï¼ˆAdaptive Multi-Rate Narrowbandï¼‰ï¼šAMR-NB æ˜¯ä¸€ç§çª„å¸¦è‡ªé€‚åº”å¤šé€Ÿç‡ç¼–ç æ ¼å¼ï¼Œç”¨äºè¯­éŸ³ç¼–ç å’Œä¼ è¾“ã€‚å®ƒåœ¨ä½æ¯”ç‰¹ç‡ä¸‹å®ç°äº†è¾ƒé«˜çš„è¯­éŸ³è´¨é‡ï¼Œå¸¸ç”¨äºæ‰‹æœºé€šè¯ã€‚</li>
<li>AMR-WBï¼ˆAdaptive Multi-Rate Widebandï¼‰ï¼šAMR-WB æ˜¯ä¸€ç§å®½å¸¦è‡ªé€‚åº”å¤šé€Ÿç‡ç¼–ç æ ¼å¼ï¼Œä¹Ÿç”¨äºè¯­éŸ³ç¼–ç å’Œä¼ è¾“ã€‚ç›¸æ¯”äº AMR-NBï¼ŒAMR-WB åœ¨æ›´å®½çš„é¢‘ç‡èŒƒå›´å†…æä¾›äº†æ›´å¥½çš„è¯­éŸ³è´¨é‡ã€‚</li>
<li>AC3ï¼ˆAudio Coding 3ï¼‰ï¼šAC3 æ˜¯ä¸€ç§æœ‰æŸéŸ³é¢‘ç¼–ç æ ¼å¼ï¼Œå¸¸ç”¨äºå½±ç‰‡éŸ³è½¨å’Œ DVD è§†é¢‘ä¸­ã€‚AC3 æ ¼å¼æ”¯æŒå¤šå£°é“éŸ³é¢‘ï¼Œæä¾›äº†è¾ƒé«˜çš„éŸ³è´¨å’Œç¯ç»•å£°æ•ˆæœã€‚</li>
<li>Vorbisï¼šVorbis æ˜¯ä¸€ç§å¼€æ”¾çš„æ— æŸéŸ³é¢‘ç¼–ç æ ¼å¼ï¼Œé‡‡ç”¨äº†æ— æŸå‹ç¼©ç®—æ³•ï¼Œå¯ä»¥æä¾›é«˜éŸ³è´¨å’Œè¾ƒå°çš„æ–‡ä»¶å¤§å°ã€‚Vorbis å¸¸ç”¨äºéŸ³ä¹å­˜å‚¨å’Œç½‘ç»œæµåª’ä½“ã€‚</li>
<li>Opusï¼šOpus æ˜¯ä¸€ç§å¼€æ”¾çš„éŸ³é¢‘ç¼–ç æ ¼å¼ï¼Œå…·æœ‰ä½å»¶è¿Ÿã€é«˜éŸ³è´¨å’Œè¾ƒé«˜çš„å‹ç¼©æ•ˆç‡ã€‚Opus æ”¯æŒå¤šç§åº”ç”¨åœºæ™¯ï¼ŒåŒ…æ‹¬éŸ³ä¹ã€è¯­éŸ³é€šä¿¡å’Œç½‘ç»œæµåª’ä½“ã€‚</li>
<li>FLACï¼ˆFree Lossless Audio Codecï¼‰ï¼šFLAC æ˜¯ä¸€ç§å¼€æ”¾çš„æ— æŸéŸ³é¢‘ç¼–ç æ ¼å¼ï¼Œå¯ä»¥å®ç°æ— æŸçš„éŸ³é¢‘å‹ç¼©å’Œè§£å‹ç¼©ã€‚FLAC æ ¼å¼ä¿ç•™äº†åŸå§‹éŸ³é¢‘æ•°æ®çš„å®Œæ•´æ€§ï¼Œæä¾›äº†è¾ƒé«˜çš„éŸ³è´¨ã€‚</li>
<li>WMAï¼ˆWindows Media Audioï¼‰ï¼šWMA æ˜¯å¾®è½¯å¼€å‘çš„éŸ³é¢‘ç¼–ç æ ¼å¼ï¼Œæ”¯æŒå¤šç§ç¼–ç é…ç½®ï¼Œå¦‚ WMA æ ‡å‡†ã€WMA Pro å’Œ WMA Losslessã€‚WMA å¸¸ç”¨äº Windows å¹³å°ä¸Šçš„éŸ³ä¹å’ŒéŸ³é¢‘æµåª’ä½“ã€‚</li>
</ol>
<h3 id="7ã€é‡‡æ ·æ•°"><a href="#7ã€é‡‡æ ·æ•°" class="headerlink" title="7ã€é‡‡æ ·æ•°"></a>7ã€é‡‡æ ·æ•°</h3><p>é‡‡æ ·æ•°ï¼Œå³æ¯å¸§é‡‡æ ·çš„æ•°é‡ã€‚åœ¨FFmpegçš„AVFrameä¸­ï¼Œå®šä¹‰ä¸ºnb_samplesã€‚</p>
<h3 id="8ã€é‡‡æ ·ä½æ•°"><a href="#8ã€é‡‡æ ·ä½æ•°" class="headerlink" title="8ã€é‡‡æ ·ä½æ•°"></a>8ã€é‡‡æ ·ä½æ•°</h3><p>é‡‡æ ·ä½æ•°ï¼Œå³æ¯ä¸ªé‡‡æ ·å ç”¨å¤šå°‘ä½ã€‚åœ¨RIFF(Resource Interchange File Format)èµ„æºäº¤æ¢æ–‡ä»¶æ ¼å¼æœ‰ä¸ªå­—æ®µbits_per_sampleè¡¨ç¤ºé‡‡æ ·ä½æ•°ï¼Œåœ¨FFmpegä¹Ÿæ˜¯ç”¨è¿™ä¸ªå­—æ®µè¡¨ç¤ºé‡‡æ ·ä½æ•°ã€‚</p>
<h3 id="9ã€å­˜å‚¨ç©ºé—´"><a href="#9ã€å­˜å‚¨ç©ºé—´" class="headerlink" title="9ã€å­˜å‚¨ç©ºé—´"></a>9ã€å­˜å‚¨ç©ºé—´</h3><p>éŸ³é¢‘çš„æ¯ç§’å­˜å‚¨ç©ºé—´ç”±ï¼šé‡‡æ ·ç‡ã€å£°é“æ•°ã€æ¯ä¸ªé‡‡æ ·ä½æ•°ã€‚å‡è®¾é‡‡æ ·ç‡ä¸º44.1kï¼Œå£°é“æ•°ä¸º2ï¼Œé‡‡æ ·ä½æ•°ä¸º16ã€‚é‚£ä¹ˆï¼Œæ¯ç§’æ‰€å å­˜å‚¨ç©ºé—´å­—èŠ‚æ•°&#x3D;44100 * 2 * 16 &#x2F; 8</p>
<h3 id="10ã€å¸§æ—¶é•¿"><a href="#10ã€å¸§æ—¶é•¿" class="headerlink" title="10ã€å¸§æ—¶é•¿"></a>10ã€å¸§æ—¶é•¿</h3><p>éŸ³é¢‘çš„å¸§æ—¶é•¿&#x3D;é‡‡æ ·æ•° &#x2F; é‡‡æ ·ç‡ã€‚å‡è®¾é‡‡æ ·ç‡ä¸º44.1kï¼Œé‡‡æ ·æ•°ä¸º1024ã€‚é‚£ä¹ˆæ¯å¸§æ—¶é•¿çº¦ç­‰äº23msã€‚</p>
<h4 id="11ã€é‡‡æ ·æ ¼å¼"><a href="#11ã€é‡‡æ ·æ ¼å¼" class="headerlink" title="11ã€é‡‡æ ·æ ¼å¼"></a>11ã€é‡‡æ ·æ ¼å¼</h4><p>éŸ³é¢‘çš„é‡‡æ ·æ ¼å¼åˆ†ä¸ºå¤§ç«¯å­˜å‚¨å’Œå°ç«¯å­˜å‚¨ã€‚æŒ‰ç…§ç¬¦å·åˆ’åˆ†æœ‰ï¼šæœ‰ç¬¦å·ä¸æ— ç¬¦å·ã€‚æŒ‰ç…§ç±»å‹åˆ’åˆ†æœ‰ï¼šæ•´å‹ä¸æµ®ç‚¹å‹ã€‚æŒ‰ç…§å­˜å‚¨ä½æ•°åˆ’åˆ†æœ‰ï¼š8ä½ã€16ä½ã€32ä½ã€64ä½ï¼Œéƒ½æ˜¯8çš„å€æ•°ã€‚åœ¨FFmpegçš„AVSampleFormatæšä¸¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">AVSampleFormat</span> &#123;</span></span><br><span class="line">    AV_SAMPLE_FMT_NONE = <span class="number">-1</span>,</span><br><span class="line">    AV_SAMPLE_FMT_U8,          <span class="comment">// unsigned 8 bits</span></span><br><span class="line">    AV_SAMPLE_FMT_S16,         <span class="comment">// signed 16 bits</span></span><br><span class="line">    AV_SAMPLE_FMT_S32,         <span class="comment">// signed 32 bits</span></span><br><span class="line">    AV_SAMPLE_FMT_FLT,         <span class="comment">// float</span></span><br><span class="line">    AV_SAMPLE_FMT_DBL,         <span class="comment">// double</span></span><br><span class="line"> </span><br><span class="line">    AV_SAMPLE_FMT_U8P,         <span class="comment">// unsigned 8 bits, planar</span></span><br><span class="line">    AV_SAMPLE_FMT_S16P,        <span class="comment">// signed 16 bits, planar</span></span><br><span class="line">    AV_SAMPLE_FMT_S32P,        <span class="comment">// signed 32 bits, planar</span></span><br><span class="line">    AV_SAMPLE_FMT_FLTP,        <span class="comment">// float, planar</span></span><br><span class="line">    AV_SAMPLE_FMT_DBLP,        <span class="comment">// double, planar</span></span><br><span class="line">    AV_SAMPLE_FMT_S64,         <span class="comment">// signed 64 bits</span></span><br><span class="line">    AV_SAMPLE_FMT_S64P,        <span class="comment">// signed 64 bits, planar</span></span><br><span class="line"> </span><br><span class="line">    AV_SAMPLE_FMT_NB           <span class="comment">// Number of sample formats</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="è§†é¢‘å°è£…æ ¼å¼"><a href="#è§†é¢‘å°è£…æ ¼å¼" class="headerlink" title="è§†é¢‘å°è£…æ ¼å¼"></a>è§†é¢‘å°è£…æ ¼å¼</h1><p>   éŸ³è§†é¢‘çš„æ—¶é•¿æ€ä¹ˆè·å–ï¼ŒéŸ³è§†é¢‘çš„å°é¢æ€ä¹ˆè·å–ï¼ŒéŸ³è§†é¢‘çš„æ ¼å¼æ€ä¹ˆè·å–å‘¢ï¼Ÿè¿™äº›ä¿¡æ¯éƒ½ä»¥ç‰¹å®šæ ¼å¼å­˜å‚¨åœ¨æ–‡ä»¶å¼€å¤´æˆ–è€…ç»“å°¾ï¼Œç§°ä¸ºå¤šåª’ä½“ä¿¡æ¯æˆ–è€…å¤šåª’ä½“å…ƒæ•°æ®ã€‚é€šç”¨çš„å°è£…æ ¼å¼ç”±ï¼šæ–‡ä»¶æ ‡è¯†å¤´+å¤šåª’ä½“ä¿¡æ¯+éŸ³è§†é¢‘(å­—å¹•)è½¨+è§†é¢‘å¸§ç´¢å¼•å—ç»„æˆï¼Œå¦‚æœæ˜¯çº¯éŸ³é¢‘ï¼Œåé¢å¯èƒ½è¿˜æœ‰æ­Œè¯ã€‚éŸ³è§†é¢‘çš„å°è£…æ ¼å¼å°±æ˜¯é€šè¿‡è§£ææ–‡ä»¶æ ‡è¯†å¤´è¿›è¡Œåˆ¤æ–­çš„ï¼Œç„¶åè§£æå¤šåª’ä½“ä¿¡æ¯ä»è€Œè·å–æ—¶é•¿ï¼Œå†è§£æè§†é¢‘å¸§ç´¢å¼•å—ï¼Œæœ€åæ ¹æ®ç´¢å¼•å—å»è·å–å¯¹åº”æ—¶é—´æˆ³çš„è§†é¢‘å¸§ã€‚</p>
<p>   éŸ³è§†é¢‘å°è£…æ ¼å¼å­˜å‚¨çš„å­—æ®µåŒ…æ‹¬ï¼šæ—¶é•¿ã€ç ç‡ã€éŸ³è§†é¢‘ç¼–ç å™¨ã€åˆ†è¾¨ç‡(å®½xé«˜)ã€å¸§ç‡ã€åƒç´ æ ¼å¼ã€æ—‹è½¬è§’åº¦ã€é‡‡æ ·ç‡ã€å£°é“æ•°ç­‰ç­‰ã€‚å…¶ä¸­è§†é¢‘ä¸“æœ‰çš„å­—æ®µæ˜¯åˆ†è¾¨ç‡ã€å¸§ç‡ã€åƒç´ æ ¼å¼ã€æ—‹è½¬è§’åº¦ï¼Œè€ŒéŸ³é¢‘ä¸“æœ‰çš„å­—æ®µæ˜¯é‡‡æ ·ç‡ã€å£°é“æ•°ã€‚</p>
<p> å¸¸è§çš„è§†é¢‘æ ¼å¼æœ‰ï¼šmp4ã€movã€3gpã€mkvã€webmã€flvã€aviã€mpgã€wmvã€tsç­‰ç­‰ã€‚å…¶ä¸­mp4ã€movã€3gpåŒå±ä¸€ä¸ªåè®®ç°‡ï¼Œç›®å‰mp4æœ€ä¸ºæµè¡Œï¼Œmp4å…¨ç§°ä¸ºMPEG-4ï¼Œç”±å›½é™…æ ‡å‡†åŒ–ç»„ç»‡å’Œå›½é™…ç”µå·¥å§”å‘˜ä¼šä¸‹å±çš„åŠ¨æ€å›¾åƒä¸“å®¶ç»„(Moving Picture Experts Group)åˆ¶å®šï¼Œå…·ä½“åè®®å¯å‚è€ƒï¼šISO&#x2F;IEC14496-14åè®®ï¼›mkvä¸webmå…¬ç”¨å°è£…æ ¼å¼ï¼šmatroskaï¼Œå¯¹äºé«˜æ¸…è§†é¢‘è€Œè¨€ï¼Œmkv&#x2F;webmæœ€å—æ¬¢è¿ï¼›è€Œaviæ˜¯æ¯”è¾ƒå¤è€çš„æ ¼å¼ï¼ŒéŸ³è§†é¢‘æµäº¤é”™(Audio Video Interleave)ï¼Œå¯ä»¥å°è£…å„ç§ç¼–ç æ ¼å¼çš„éŸ³è§†é¢‘æµï¼›mpgå±äºpsçš„ä¸€ç§å°è£…æ ¼å¼ï¼›wmv(Windows Media Video)æ˜¯å¾®è½¯æ¨å‡ºçš„è§†é¢‘ç¼–è§£ç æ ¼å¼ç»Ÿç§°ï¼Œé‡‡ç”¨ASF(Advance System Format)ä½œä¸ºå®¹å™¨ï¼ŒåŸºäºObjectå¯¹è±¡è¿›è¡Œå°è£…ï¼›è€Œtsçš„å…¨ç§°ä¸ºMPEG2-TSï¼Œå³ä¸ºTransport Streamçš„ç¼©å†™ï¼Œå…·ä½“å¯å‚è€ƒISO&#x2F;IEC13818-1åè®®ï¼Œä½œç”¨äºä¼ è¾“å±‚ï¼Œä¸»è¦ç”¨äºå®æ—¶ä¼ è¾“çš„èŠ‚ç›®ï¼ŒHLSç›´æ’­åè®®å°±æ˜¯åŸºäºtsåˆ‡ç‰‡æ¥ä¼ è¾“è§†é¢‘æµçš„ï¼Œä¸»è¦ç‰¹ç‚¹æ˜¯ä»è§†é¢‘æµä»»ä¸€ç‰‡æ®µéƒ½å¯ç‹¬ç«‹è§£ç æ’­æ”¾ï¼›psä¸tsç±»ä¼¼ï¼Œå…¨ç§°ä¸ºMPEG-PSï¼Œå³ä¸ºProgram Streamçš„ç¼©å†™ï¼Œç”¨äºå­˜å‚¨å›ºå®šæ—¶é•¿çš„èŠ‚ç›®ã€‚è§†é¢‘æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p>  æ•´ä¸ªè§£å°è£…æµç¨‹ï¼šä»è¯»å–æ–‡ä»¶å¤´åˆ¤æ–­è§†é¢‘æ ¼å¼å¼€å§‹ï¼Œç„¶åé€‰æ‹©å¯¹åº”çš„Extractorï¼Œè§£æå¤šåª’ä½“ä¿¡æ¯ï¼Œå†è§£æè§†é¢‘å¸§çš„ç´¢å¼•å—ï¼Œæœ€åæ ¹æ®ç´¢å¼•å»å®šä½å¹¶è¯»å–éŸ³è§†é¢‘æ•°æ®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192038669.png" alt="20200907235506737 (1)"></p>
<ol>
<li><p>è¯»å–æ–‡ä»¶å¤´ï¼š<br>è¯»å–æ–‡ä»¶å¤´æ˜¯ä¸ºäº†è·å–æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯å’Œæ ‡è¯†ã€‚æ–‡ä»¶å¤´é€šå¸¸æ˜¯æ–‡ä»¶çš„å‰å‡ ä¸ªå­—èŠ‚ï¼Œå®ƒåŒ…å«äº†æ–‡ä»¶çš„æ ¼å¼ä¿¡æ¯ä»¥åŠå…¶ä»–å…ƒæ•°æ®ã€‚è¯»å–æ–‡ä»¶å¤´å¯ä»¥é€šè¿‡æ‰“å¼€æ–‡ä»¶å¹¶è¯»å–å‰å‡ ä¸ªå­—èŠ‚çš„æ–¹å¼å®ç°ã€‚</p>
</li>
<li><p>åˆ¤æ–­æ–‡ä»¶æ ¼å¼ï¼š<br>é€šè¿‡è¯»å–æ–‡ä»¶å¤´ä¸­çš„ä¿¡æ¯ï¼Œå¯ä»¥åˆ¤æ–­æ–‡ä»¶çš„æ ¼å¼ã€‚åœ¨æä¾›çš„æ–‡ä»¶æ ¼å¼ä¸­ï¼Œå¸¸è§çš„æ–‡ä»¶æ ¼å¼æœ‰ï¼š</p>
<ul>
<li>è§†é¢‘æ ¼å¼ï¼šmp4ã€aviã€mkvã€flvã€wmv</li>
<li>éŸ³é¢‘æ ¼å¼ï¼šmp3ã€m4aã€flacã€amr</li>
</ul>
</li>
<li><p>é€‰æ‹©å¯¹åº”çš„è§£æå™¨ï¼ˆExtractorï¼‰ï¼š<br>æ ¹æ®åˆ¤æ–­å‡ºçš„æ–‡ä»¶æ ¼å¼ï¼Œé€‰æ‹©å¯¹åº”çš„è§£æå™¨ï¼ˆExtractorï¼‰ã€‚è§£æå™¨æ˜¯ç”¨äºè§£ææ–‡ä»¶çš„å·¥å…·æˆ–åº“ï¼Œå®ƒèƒ½å¤Ÿæå–å‡ºæ–‡ä»¶ä¸­çš„ç‰¹å®šä¿¡æ¯ã€‚ä¸åŒçš„æ–‡ä»¶æ ¼å¼é€šå¸¸éœ€è¦ä½¿ç”¨ä¸åŒçš„è§£æå™¨è¿›è¡Œè§£æã€‚</p>
</li>
<li><p>è§£æå¤šåª’ä½“ä¿¡æ¯ï¼š<br>ä½¿ç”¨é€‰æ‹©çš„è§£æå™¨ï¼Œå¯¹æ–‡ä»¶è¿›è¡Œè§£æä»¥è·å–å¤šåª’ä½“ä¿¡æ¯ã€‚å¤šåª’ä½“ä¿¡æ¯åŒ…æ‹¬è§†é¢‘çš„åˆ†è¾¨ç‡ã€å¸§ç‡ã€ç¼–ç æ ¼å¼ç­‰ï¼ŒéŸ³é¢‘çš„é‡‡æ ·ç‡ã€å£°é“æ•°ã€ç¼–ç æ ¼å¼ç­‰ã€‚è§£æå¤šåª’ä½“ä¿¡æ¯å¯ä»¥é€šè¿‡è§£æå™¨æä¾›çš„å‡½æ•°æˆ–æ–¹æ³•æ¥å®ç°ã€‚</p>
</li>
<li><p>è§£æè§†é¢‘å¸§ç´¢å¼•ï¼š<br>å¦‚æœæ–‡ä»¶æ˜¯è§†é¢‘æ–‡ä»¶ï¼Œå¯ä»¥è¿›ä¸€æ­¥è§£æè§†é¢‘çš„å¸§ç´¢å¼•ã€‚è§†é¢‘å¸§ç´¢å¼•åŒ…å«äº†è§†é¢‘ä¸­æ¯ä¸€å¸§çš„ä½ç½®å’Œæ—¶é—´ä¿¡æ¯ã€‚è§£æè§†é¢‘å¸§ç´¢å¼•å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®šä½å’Œæå–ç‰¹å®šçš„è§†é¢‘å¸§ã€‚</p>
</li>
<li><p>è¯»å–éŸ³è§†é¢‘æ•°æ®ï¼š<br>æœ€åï¼Œé€šè¿‡è§£æå™¨æä¾›çš„å‡½æ•°æˆ–æ–¹æ³•ï¼Œè¯»å–éŸ³è§†é¢‘æ•°æ®ã€‚éŸ³è§†é¢‘æ•°æ®æ˜¯æ–‡ä»¶ä¸­å®é™…å­˜å‚¨çš„éŸ³é¢‘å’Œè§†é¢‘å†…å®¹ã€‚å¯ä»¥æ ¹æ®éœ€è¦ï¼Œé€å¸§è¯»å–è§†é¢‘æ•°æ®æˆ–é€æ ·æœ¬è¯»å–éŸ³é¢‘æ•°æ®ã€‚</p>
<p>mp4ä½œä¸ºç›®å‰æœ€æµè¡Œçš„è§†é¢‘å°è£…æ ¼å¼ï¼Œä¹Ÿæ˜¯æœ¬ç¯‡æ–‡ç« çš„ç”·ä¸€å·ä¸»è§’ï¼Œä¸‹é¢å°†å›´ç»•mp4æ ¼å¼è¿›è¡Œå±•å¼€åˆ†æã€‚mp4æ˜¯ç”±ä¸€ç³»åˆ—çš„boxç»„æˆ(åœ¨quick timeåè®®ä¸­ï¼Œç§°ä¸ºatom)ï¼Œboxåˆç”±Headerå’ŒDataç»„æˆï¼Œboxçš„ç»“æ„å¦‚å›¾2æ‰€ç¤ºï¼š</p>
</li>
</ol>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192040157.png" alt="img"></p>
<p> è€ŒHeaderç”±sizeã€typeã€largeSizeã€extendTypeç»„æˆï¼Œå…¶ä¸­sizeå’Œtypeæ˜¯å¿…è¦å­—æ®µï¼Œå¦‚è¡¨1æ‰€ç¤ºï¼š   </p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192040107.png" alt="image-20231119204029085"></p>
<p>â€‹    full boxçš„Headerå¤šä¸¤ä¸ªå­—æ®µï¼šversionã€flagï¼Œä¸€èˆ¬æ˜¯track boxé‡‡ç”¨full boxå½¢å¼ï¼Œå¦‚è¡¨2æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192040249.png" alt="image-20231119204051236"></p>
<p>   boxåˆ†ä¸ºnormal boxã€full boxã€large boxã€extend boxã€‚å¦‚æœsizeä¸º1ï¼Œé‚£ä¹ˆè¡¨æ˜è¯¥boxä¸ºlarge boxï¼Œä½¿ç”¨largeSizeæ¥å­˜å‚¨boxçš„å¤§å°ï¼›å¦‚æœsizeä¸º0ï¼Œé‚£ä¹ˆè¡¨æ˜è¯¥boxæ˜¯æ–‡ä»¶çš„æœ€åä¸€ä¸ªboxï¼›å¦‚æœboxçš„ç±»å‹ä¸ºuuidï¼Œé‚£ä¹ˆè¡¨æ˜è¯¥boxæ˜¯æ‰©å±•boxã€‚å¦‚ä¸‹é¢ä»£ç æ®µæ‰€ç¤ºï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">aligned(<span class="number">8</span>) class <span class="title function_">Box</span> <span class="params">(<span class="type">unsigned</span> <span class="type">int</span>(<span class="number">32</span>) boxtype,</span></span><br><span class="line"><span class="params">    optional <span class="type">unsigned</span> <span class="type">int</span>(<span class="number">8</span>)[<span class="number">16</span>] extended_type)</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="title function_">int</span><span class="params">(<span class="number">32</span>)</span> size;</span><br><span class="line">    <span class="type">unsigned</span> <span class="title function_">int</span><span class="params">(<span class="number">32</span>)</span> type = boxtype;</span><br><span class="line">    <span class="keyword">if</span> (size==<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="title function_">int</span><span class="params">(<span class="number">64</span>)</span> largesize;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (size==<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// box extends to end of file</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (boxtype==â€˜uuidâ€™) &#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span>(<span class="number">8</span>)[<span class="number">16</span>] usertype = extended_type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> moov boxä½œä¸ºmp4æ ¼å¼çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œæ ¹æ®moov boxä¸mdat boxçš„ç›¸å¯¹ä½ç½®ï¼Œåˆ†ä¸ºmoovå‰ç½®å’Œmoovåç½®ã€‚å¦‚ä¸‹é¢å›¾3ã€å›¾4æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192041850.jpeg" alt="img"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192041782.jpeg" alt="img"></p>
<p>   é€šå¸¸æƒ…å†µä¸‹ï¼Œmp4çš„moovéƒ½æ˜¯åœ¨mdatå‰é¢çš„ï¼›ä¸€èˆ¬åªæœ‰å®æ—¶å½•åˆ¶çš„mp4è§†é¢‘ï¼Œmoovæ‰åœ¨mdatçš„åé¢ã€‚</p>
<p>  ftyp boxï¼šmp4è§†é¢‘æ ‡è¯†å¤´ï¼ŒåŒ…å«major brandã€minor versionã€compatible brandsã€‚å…¶ä¸­major brandä¸€èˆ¬ä¸ºisomï¼Œè€Œcompatible brandsåŒ…æ‹¬isomã€iso2ã€avcã€mp41ã€mp42ç­‰ã€‚</p>
<p>   moov boxï¼šå­˜å‚¨å¤šåª’ä½“ä¿¡æ¯ï¼ŒåµŒå¥—ç€movie box(mvhd)ã€track box(trak box)ã€usedata box(udat)ï¼›è€Œtrack boxåˆ†ä¸ºè§†é¢‘è½¨ã€éŸ³é¢‘è½¨ã€å­—å¹•è½¨ï¼Œå¦‚æœæœ‰å¤šè¯­è¨€ï¼Œå°±ä¼šå¯¹åº”æœ‰å¤šéŸ³è½¨ï¼›trak&#x2F;mdia&#x2F;minf&#x2F;stbl&#x2F;stsdå­˜å‚¨çš„æ˜¯éŸ³è§†é¢‘ç¼–ç å™¨ä¿¡æ¯ï¼Œæ¯”å¦‚è§†é¢‘è½¨çš„æ˜¯avcï¼ŒéŸ³é¢‘è½¨æ˜¯mp4aï¼›trak&#x2F;mdia&#x2F;minf&#x2F;stbl&#x2F;stszå­˜å‚¨çš„æ˜¯è§†é¢‘å¸§sizeï¼›trak&#x2F;mdia&#x2F;minf&#x2F;stbl&#x2F;stcoå­˜å‚¨çš„æ˜¯chunk offsetã€‚</p>
<p>   mdat boxï¼šéŸ³è§†é¢‘æ•°æ®ï¼Œæ ¹æ®moovåŠå…¶åµŒå¥—boxè§£æå‡ºæ¥çš„è§†é¢‘å¸§ç´¢å¼•ï¼Œå»å®šä½å…³é”®å¸§ï¼Œç„¶åæ ¹æ®å¸§ç±»å‹è¯»å–éŸ³è§†é¢‘æ•°æ®ã€‚</p>
<h1 id="éŸ³é¢‘å°è£…æ ¼å¼"><a href="#éŸ³é¢‘å°è£…æ ¼å¼" class="headerlink" title="éŸ³é¢‘å°è£…æ ¼å¼"></a>éŸ³é¢‘å°è£…æ ¼å¼</h1><p> éŸ³é¢‘å°è£…æ ¼å¼ä¸€èˆ¬ç”±ï¼šå¤šåª’ä½“ä¿¡æ¯+éŸ³é¢‘æµ+å°é¢æµ+æ­Œè¯æµç»„æˆã€‚æœ‰äº›éŸ³ä¹ä¼šåŒ…å«å°é¢å’Œæ­Œè¯ï¼Œåˆ™å¯¹åº”æœ‰å°é¢æµã€æ­Œè¯æµã€‚å¤šåª’ä½“ä¿¡æ¯åŒ…æ‹¬ï¼šæ ‡é¢˜ã€è‰ºæœ¯å®¶ã€ä¸“è¾‘ã€ä½œæ›²ã€éŸ³ä¹é£æ ¼ã€æ—¥æœŸã€ç ç‡ã€æ—¶é•¿ã€å£°é“å¸ƒå±€ã€é‡‡æ ·ç‡ã€éŸ³é¢‘ç¼–ç å™¨ç­‰ã€‚è€ŒéŸ³é¢‘å°è£…åŒ…æ‹¬ï¼šmp3ã€m4aã€oggã€amrã€wmaã€aacã€wavã€flacã€apeç­‰ã€‚å‰é¢ä¸¤ç¯‡æ–‡ç« ä»‹ç»è¿‡ç›¸å…³æ¦‚å¿µï¼šèµ°è¿›éŸ³è§†é¢‘çš„ä¸–ç•Œâ€”â€”éŸ³è§†é¢‘åŸºæœ¬æ¦‚å¿µã€èµ°è¿›éŸ³è§†é¢‘ä¸–ç•Œâ€”â€”è§†é¢‘å°è£…æ ¼å¼ã€‚éŸ³é¢‘æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p>ä»¥ä¸‹é¢é—®é¢˜ä¸ºå‡ºå‘ç‚¹ï¼Œæ­å¼€éŸ³é¢‘å°è£…æ ¼å¼çš„é¢çº±ï¼š</p>
<p>â‘  éŸ³ä¹å°é¢å¦‚ä½•è·å–ï¼Ÿ</p>
<p>â‘¡ éŸ³ä¹æ­Œè¯å¦‚ä½•è·å–ä¸æ˜¾ç¤ºï¼Ÿ</p>
<p>â‘¢ æœ‰æŸæ ¼å¼ä¸æ— æŸæ ¼å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<p>â‘£ ä¸åŒå°è£…æ ¼å¼æœ‰ä»€ä¹ˆè”ç³»ï¼Œåˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<p>å…ˆä»FFprobeæ£€æµ‹åˆ°çš„éŸ³é¢‘metadataè¯´èµ·ï¼Œå¦‚ä¸‹å›¾1æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192045466.jpeg" alt="img"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œå‰åŠéƒ¨åˆ†æ˜¯titleæ ‡é¢˜ã€artistè‰ºæœ¯å®¶ã€albumä¸“è¾‘ã€album_artistè‰ºæœ¯å®¶ä¸“è¾‘ã€composerä½œæ›²è€…ã€genreéŸ³ä¹é£æ ¼å¼ï¼›ä¸­é—´éƒ¨åˆ†æ˜¯lyricsæ­Œè¯ï¼Œæ¯å¥æ­Œè¯å‰é¢æœ‰å¯¹åº”çš„æ—¶é—´æˆ³ï¼›ååŠéƒ¨åˆ†æ˜¯ä¸¤ä¸ªæµï¼Œç¬¬0ç¼–å·çš„æµæ˜¯éŸ³é¢‘è½¨ï¼ŒåŒ…å«ï¼šéŸ³é¢‘ç¼–ç å™¨ã€é‡‡æ ·ç‡ã€å£°é“å¸ƒå±€ã€ç ç‡ï¼Œç¬¬1ç¼–å·çš„æµæ˜¯å°é¢ï¼Œå…¶å®æ˜¯ä¸€å¸§å›¾åƒï¼ŒåŒ…å«ï¼šå›¾åƒç¼–ç å™¨ã€åƒç´ æ ¼å¼ã€åˆ†è¾¨ç‡ã€‚æ¥ä¸‹æ¥æ ¹æ®ä¸Šé¢æå‡ºçš„é—®é¢˜è¿›è¡Œå±•å¼€åˆ†æã€‚</p>
<p>1ã€è·å–éŸ³ä¹çš„å°é¢<br>éŸ³ä¹å°é¢ä¿å­˜åœ¨è§†é¢‘å›¾åƒæµä¸­ï¼Œå…ˆè§£æå‡ºå›¾åƒç¼–ç å™¨ã€åƒç´ æ ¼å¼ã€åˆ†è¾¨ç‡ç­‰å‚æ•°ï¼Œç„¶åæ ¹æ®ç¼–ç å™¨å»å¯»æ‰¾å¯¹åº”çš„è§£ç å™¨ï¼Œå¹¶æ‰“å¼€è§£ç å™¨ï¼Œå¯¹å›¾åƒç¼–ç å‹ç¼©æ•°æ®è¿›è¡Œè§£ç ï¼Œæœ€ç»ˆè§£ç å‡ºæ¥çš„å›¾åƒå°±æ˜¯å°é¢äº†ã€‚</p>
<p>2ã€éŸ³ä¹æ­Œè¯çš„è·å–ä¸æ˜¾ç¤º<br>ä¸Šé¢æœ‰æåŠï¼Œæ¯å¥æ­Œè¯å‰é¢æœ‰æ˜¾ç¤ºçš„æ—¶é—´æˆ³ï¼Œä»¥éŸ³é¢‘æ—¶é’Ÿä¸ºåŸºå‡†ï¼Œæ­Œè¯æ—¶é—´æˆ³åŒæ­¥äºéŸ³é¢‘æ—¶é—´æˆ³ã€‚ä¹Ÿå°±æ˜¯æ ¹æ®éŸ³é¢‘æ—¶é—´æˆ³æ¥åŒæ­¥è§£ææ­Œè¯ï¼Œç„¶åæŠŠæ­Œè¯å›è°ƒåˆ°åº”ç”¨å±‚æ¸²æŸ“æ˜¾ç¤ºã€‚å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œå½“å‰æ­Œè¯ä»€ä¹ˆæ—¶å€™è¯¥æ¶ˆå¤±å‘¢ï¼Ÿæ­Œè¯æ²¡æœ‰å…·ä½“çš„æ˜¾ç¤ºæ—¶é•¿ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªæ­Œè¯çš„åˆ°æ¥ï¼ŒæŠŠå½“å‰æ­Œè¯è¦†ç›–ã€‚</p>
<p>3ã€æœ‰æŸæ ¼å¼ä¸æ— æŸæ ¼å¼çš„åŒºåˆ«<br>(1) æ— æŸéŸ³ä¹æ ¼å¼</p>
<p>æ— æŸéŸ³ä¹æ ¼å¼æœ‰apeã€wavã€flacä¸‰ç§ï¼Œå…¶ä¸­apeã€flacéƒ½æ˜¯åŸºäºwavè¿›è¡Œå‹ç¼©ã€‚è€Œwavæ˜¯å¾®è½¯ä¸“é—¨ä¸ºWindowså¼€å‘çš„ä¸€ç§æ ‡å‡†æ•°å­—éŸ³é¢‘æ–‡ä»¶ï¼Œæ–‡ä»¶æ‰©å±•åwavï¼Œæ˜¯WaveFormçš„ç¼©å†™ï¼Œæ–‡ä»¶å¤§å°è®¡ç®—å…¬å¼ï¼šsize&#x3D;(é‡‡æ ·ç‡<em>é‡åŒ–ä½æ•°</em>å£°é“&#x2F;8)&#x2F;æ—¶é—´(ç§’)ã€‚ä¸€èˆ¬é‡‡æ ·ç‡æ˜¯44100Hzï¼Œé‡åŒ–ä½æ•°ä¸º16ä½ï¼Œå£°é“æ•°ä¸º2ï¼ˆå³ç«‹ä½“å£°é“ï¼‰ï¼Œ1åˆ†é’Ÿçš„éŸ³é¢‘å ç”¨å­˜å‚¨ç©ºé—´çº¦ä¸º10Mã€‚</p>
<p>åœ¨Windowsç¯å¢ƒä¸‹ï¼Œå¤§å¤šæ•°åª’ä½“æ–‡ä»¶éƒ½æ˜¯æŒ‰ç…§èµ„æºäº’æ¢æ–‡ä»¶æ ¼å¼(Resource Interchange File Format)æ¥å‚¨å­˜ä¿¡æ¯çš„ï¼Œç®€ç§°ä¸ºRIFFæ ¼å¼ã€‚æ„æˆRIFFçš„åŸºæœ¬å•ä½æˆä¸ºå—(Chunk)ï¼Œæ¯ä¸ªRIFFæ–‡ä»¶ç”±è‹¥å¹²å—ç»„æˆï¼ŒwavåŸºæœ¬ç»“æ„å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192045766.png" alt="image-20231119204555747"></p>
<p>æ¯ä¸ªå—ç”±å—æ ‡è¯†ã€é•¿åº¦ã€æ•°æ®ç»„æˆï¼Œå¦‚ä¸‹ä»£ç æ®µï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">struct chunk &#123;</span><br><span class="line">    u32 id; //å—æ ‡è¯†</span><br><span class="line">    u32 size; //å—å¤§å°</span><br><span class="line">    u8 data[size]; //å—å†…å®¹</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p> å…¶ä¸­fmtå—ç”±å£°é“æ•°ã€é‡‡æ ·ç‡ã€ç ç‡ã€å—å¯¹é½ã€é‡åŒ–ä½æ•°äº”ä¸ªå‚æ•°ç»„æˆï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Num Channels	         2 Bytes	           å°ç«¯å­˜å‚¨</span><br><span class="line">SampleRate	         4 Bytes	           å°ç«¯å­˜å‚¨</span><br><span class="line">ByteRate	         4 Bytes	           å°ç«¯å­˜å‚¨</span><br><span class="line">Block Align	         2 Bytes	           å°ç«¯å­˜å‚¨</span><br><span class="line">BitsPerSample	         2 Bytes	           å°ç«¯å­˜å‚¨</span><br></pre></td></tr></table></figure>

<p>(2) æœ‰æŸéŸ³ä¹æ ¼å¼</p>
<p>æœ‰æŸéŸ³ä¹æ ¼å¼åŒ…æ‹¬ï¼šmp3ã€m4aã€oggã€amrã€wmaã€aacç­‰ã€‚ç›®å‰æœ€ä¸ºæµè¡Œçš„æ˜¯mp3(MPEG-1 audio layer3)ï¼Œæœ‰ç€mp3çš„ä¸‹ä¸€ä»£ä¹‹ç§°çš„æ˜¯aac(Advance Audio Coding)ã€‚æœ‰æŸæ ¼å¼å‹ç¼©ç‡æ¯”æ— æŸçš„é«˜ï¼Œæ–‡ä»¶å ç”¨å­˜å‚¨ç©ºé—´å°ï¼Œä½†æ˜¯å£°éŸ³è¿˜åŸåº¦ä¸å¦‚æ— æŸæ ¼å¼ã€‚æˆ‘ä»¬ä¸‹è½½éŸ³ä¹æ—¶ï¼Œç¢°åˆ°é«˜å“è´¨æˆ–è€…æ— æŸéŸ³è´¨çš„éŸ³ä¹ï¼Œé€šå¸¸è¦VIPä¼šå‘˜æˆ–æŒ‰éœ€æ”¶è´¹ï¼Œå› ä¸ºè¶Šé«˜å“è´¨è¶Šæ¥è¿‘åŸå£°ã€‚è€Œæ— æŸéŸ³ä¹ä»ç†è®ºä¸Šèƒ½å¤Ÿ100%ä¿ç•™å£°éŸ³ç»†èŠ‚ï¼Œ100%è¿˜åŸåŸå£°ã€‚æ— æŸéŸ³è´¨è‹±æ–‡ç®€ç§°ä¸ºSQ(Super Qualityï¼Œè¶…éŸ³è´¨)ã€‚å…³äºæ— æŸæ ¼å¼ä¸æœ‰æŸæ ¼å¼å¯¹æ¯”å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192046184.png" alt="image-20231119204633159"></p>
<h4 id="4ã€ä¸åŒå°è£…æ ¼å¼çš„è”ç³»ä¸åŒºåˆ«"><a href="#4ã€ä¸åŒå°è£…æ ¼å¼çš„è”ç³»ä¸åŒºåˆ«" class="headerlink" title="4ã€ä¸åŒå°è£…æ ¼å¼çš„è”ç³»ä¸åŒºåˆ«"></a>4ã€ä¸åŒå°è£…æ ¼å¼çš„è”ç³»ä¸åŒºåˆ«</h4><p>å°è£…æ ¼å¼å…±åŒç‚¹æ˜¯åŸºæœ¬ç»“æ„æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯ç”±å¤šåª’ä½“ä¿¡æ¯+éŸ³é¢‘æµ+å°é¢æµ+æ­Œè¯æµç»„æˆã€‚åŒºåˆ«æ˜¯ä¸åŒå°è£…æ ¼å¼ï¼Œé‡‡ç”¨ç¼–ç æ–¹å¼ä¸ä¸€æ ·ï¼Œå‹ç¼©ç‡ä¸ä¸€æ ·ï¼ŒéŸ³é¢‘æµå­ç»“æ„ä¸ä¸€æ ·ã€‚ä¸‹é¢æ˜¯ä¸åŒå°è£…æ ¼å¼çš„å¤šæ–¹ä½å¯¹æ¯”ï¼Œå¦‚è¡¨4æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192047768.png" alt="image-20231119204702747"></p>
<h1 id="éŸ³è§†é¢‘ç¼–ç "><a href="#éŸ³è§†é¢‘ç¼–ç " class="headerlink" title="éŸ³è§†é¢‘ç¼–ç "></a>éŸ³è§†é¢‘ç¼–ç </h1><p>éŸ³è§†é¢‘æµæ˜¯é€šè¿‡ç‰¹å®šç¼–ç å™¨å‹ç¼©ï¼Œç”±ä¸€ç³»åˆ—çš„å‹ç¼©å›¾åƒ&#x2F;è¯­éŸ³å¸§ç»„æˆã€‚å½“ç„¶å¯èƒ½å­˜åœ¨å¤šç§è¯­è¨€å¤šéŸ³è½¨ï¼Œæ¯ä¸ªéŸ³è½¨ä¹‹é—´çš„éŸ³é¢‘æµç›¸äº’ç‹¬ç«‹ã€‚è¿˜å¯èƒ½å­˜åœ¨å†…ç½®å­—å¹•ï¼Œå¸¸è§çš„å­—å¹•æ ¼å¼æœ‰subã€smiã€ssaã€srtç­‰ã€‚ä½†æ˜¯ï¼Œæœ¬ç¯‡æ–‡ç« è®¨è®ºçš„ä¸»è§’æ˜¯éŸ³è§†é¢‘ç¼–ç ï¼Œå¸¸è§çš„è§†é¢‘ç¼–ç æœ‰h264ã€h265ã€vp9ã€mpeg4ã€mjpegã€wmv3ã€av1(Alliance for Open Media Video 1ï¼Œç”±å¼€æ”¾åª’ä½“è”ç›Ÿæ¨å‡ºï¼Œå¯¹æ ‡h265ï¼Œæ—¨åœ¨æˆä¸ºä¸‹ä¸€ä»£è§†é¢‘ç¼–ç æŠ€æœ¯æ ‡å‡†)ï¼Œå¸¸è§çš„éŸ³é¢‘ç¼–ç æœ‰mp3ã€aacã€amr_nbã€amr_wbã€ac3ã€vorbisã€opusã€flacã€wmav2ç­‰ç­‰ã€‚éŸ³è§†é¢‘æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192049496.png" alt="img"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192049324.png" alt="img"></p>
<h2 id="ä¸€ã€è§†é¢‘ç¼–ç "><a href="#ä¸€ã€è§†é¢‘ç¼–ç " class="headerlink" title="ä¸€ã€è§†é¢‘ç¼–ç "></a>ä¸€ã€è§†é¢‘ç¼–ç </h2><p>è§†é¢‘ç¼–ç æ˜¯å°†åŸå§‹è§†é¢‘ä¿¡å·è¿›è¡Œå‹ç¼©å’Œç¼–ç çš„è¿‡ç¨‹ï¼Œä»¥ä¾¿åœ¨å­˜å‚¨å’Œä¼ è¾“ä¸­å‡å°‘æ•°æ®é‡ã€‚ä¸‹é¢è¯¦ç»†è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦å¯¹è§†é¢‘è¿›è¡Œç¼–ç ä»¥åŠè§†é¢‘ç¼–ç çš„åŸç†å’Œè¿‡ç¨‹ã€‚</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œè§†é¢‘ç¼–ç ï¼Ÿ<br>è§†é¢‘æ•°æ®é€šå¸¸ç”±è¿ç»­çš„å›¾åƒå¸§ç»„æˆï¼Œæ¯ä¸€å¸§éƒ½åŒ…å«äº†å¤§é‡çš„åƒç´ æ•°æ®ã€‚åŸå§‹çš„è§†é¢‘æ•°æ®ä»¥YUVæˆ–RGBæ ¼å¼å­˜å‚¨ï¼Œå…¶ä¸­Yè¡¨ç¤ºäº®åº¦åˆ†é‡ï¼ŒUå’ŒVè¡¨ç¤ºè‰²åº¦åˆ†é‡ã€‚è¿™äº›åŸå§‹æ•°æ®éå¸¸å¤§ï¼Œç‰¹åˆ«æ˜¯å¯¹äºé«˜åˆ†è¾¨ç‡å’Œé«˜å¸§ç‡çš„è§†é¢‘æ¥è¯´ï¼Œå®ƒä»¬éœ€è¦å¤§é‡çš„å­˜å‚¨ç©ºé—´å’Œä¼ è¾“å¸¦å®½ã€‚ä¸ºäº†æœ‰æ•ˆåœ°å­˜å‚¨å’Œä¼ è¾“è§†é¢‘ï¼Œéœ€è¦å¯¹è§†é¢‘è¿›è¡Œå‹ç¼©ï¼Œè€Œè§†é¢‘ç¼–ç å°±æ˜¯å®ç°è§†é¢‘å‹ç¼©çš„ä¸€ç§æ–¹å¼ã€‚</p>
<h3 id="1ã€å˜æ¢ä¸é‡åŒ–"><a href="#1ã€å˜æ¢ä¸é‡åŒ–" class="headerlink" title="1ã€å˜æ¢ä¸é‡åŒ–"></a>1ã€å˜æ¢ä¸é‡åŒ–</h3><p>å˜æ¢ï¼šæŠŠç©ºé—´åŸŸçš„å›¾åƒä¿¡å·å˜æ¢åˆ°é¢‘ç‡åŸŸã€‚å¸¸è§çš„å˜æ¢æœ‰ç¦»æ•£ä½™å¼¦å˜æ¢ã€å‚…é‡Œå¶å˜æ¢ã€‚å…¶ä¸­ï¼Œç¦»æ•£ä½™å¼¦å˜æ¢åˆç§°ä¸ºDCTå˜æ¢ï¼Œåœ¨è§†é¢‘å‹ç¼©ä¸­å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚</p>
<p>é‡åŒ–ï¼šäººç±»å¯¹å›¾åƒçš„ä½é¢‘ç‰¹æ€§çš„ä¿¡æ¯æ•æ„Ÿ(æ¯”å¦‚äº®åº¦)ï¼Œå¯¹é«˜é¢‘ç‰¹æ€§çš„ä¿¡æ¯ä¸æ•æ„Ÿ(æ¯”å¦‚è‰²åº¦ã€å¯¹æ¯”åº¦)ï¼Œæ‰€ä»¥æ‰ç¼–ç è¿‡ç¨‹ä¸­å¯ä»¥å°‘ç”¨é«˜é¢‘ä¿¡æ¯ï¼Œå…¨ä¿ç•™ä½é¢‘ä¿¡æ¯ã€‚é‡åŒ–è¿‡ç¨‹æ˜¯å¯¹ä½é¢‘åŒºè¿›è¡Œç»†é‡åŒ–ï¼Œå¯¹é«˜é¢‘åŒºè¿›è¡Œç²—é‡åŒ–ï¼Œå‡å°‘äººçœ¼ä¸å¤ªæ•æ„Ÿçš„å›¾åƒä¿¡æ¯ï¼Œä»è€Œå‡å°æ•°æ®é‡ã€æé«˜å‹ç¼©ç‡ã€‚é‡åŒ–æ˜¯æœ‰æŸçš„ï¼Œé‡åŒ–å‚æ•°(Quantization Parameter)è¶Šå¤§ï¼Œå›¾åƒè´¨é‡è¶Šä½ã€‚</p>
<h3 id="2ã€è¿åŠ¨è¡¥å¿ä¸è¿åŠ¨ä¼°è®¡"><a href="#2ã€è¿åŠ¨è¡¥å¿ä¸è¿åŠ¨ä¼°è®¡" class="headerlink" title="2ã€è¿åŠ¨è¡¥å¿ä¸è¿åŠ¨ä¼°è®¡"></a>2ã€è¿åŠ¨è¡¥å¿ä¸è¿åŠ¨ä¼°è®¡</h3><p>è¿åŠ¨ä¼°è®¡ï¼šæŠŠå›¾åƒåˆ†å‰²æˆäº’ä¸é‡å çš„å­å—ï¼Œç„¶åä»¥ä¸€å®šå¤§å°çš„çª—å£ï¼Œåœ¨å‰ä¸€å›¾åƒæˆ–åä¸€å›¾åƒå»ç§»åŠ¨æœç´¢ç›¸ä¼¼çš„å›¾åƒå—ï¼Œè¿™ä¸ªæœç´¢è¿‡ç¨‹ç§°ä¸ºè¿åŠ¨ä¼°è®¡ã€‚</p>
<p>è¿åŠ¨è¡¥å¿ï¼šé€šè¿‡å…ˆå‰çš„å±€éƒ¨å›¾åƒæ¥é¢„æµ‹ã€è¡¥å¿å½“å‰çš„å±€éƒ¨å›¾åƒï¼›</p>
<h3 id="3ã€ç†µç¼–ç "><a href="#3ã€ç†µç¼–ç " class="headerlink" title="3ã€ç†µç¼–ç "></a>3ã€ç†µç¼–ç </h3><p>ç†µç¼–ç æ˜¯åŸºäºå˜é•¿ç¼–ç ï¼Œå‡ºç°æ¦‚ç‡å¤§çš„ç¬¦å·é‡‡ç”¨çŸ­ç ï¼Œå‡ºç°æ¦‚ç‡å°çš„ç¬¦å·é‡‡ç”¨é•¿ç ï¼Œæœ€ç»ˆçš„å¹³å‡ç é•¿æ¥è¿‘ä¿¡æºç†µå€¼ã€‚å…¶ä»–çš„å˜é•¿ç¼–ç è¿˜åŒ…æ‹¬ï¼šå“ˆå¤«æ›¼ç¼–ç ã€æ¸¸ç¨‹ç¼–ç ã€ç®—æœ¯ç¼–ç ç­‰ã€‚</p>
<h3 id="4ã€å¸§å†…å‹ç¼©ä¸å¸§é—´å‹ç¼©"><a href="#4ã€å¸§å†…å‹ç¼©ä¸å¸§é—´å‹ç¼©" class="headerlink" title="4ã€å¸§å†…å‹ç¼©ä¸å¸§é—´å‹ç¼©"></a>4ã€å¸§å†…å‹ç¼©ä¸å¸§é—´å‹ç¼©</h3><p>å¸§å†…å‹ç¼©ï¼šæ¯å¸§å›¾åƒå†…éƒ¨å­˜åœ¨æ•°æ®å†—ä½™ã€‚æ¯”å¦‚ä¸€å‰¯å›¾åƒä¸­æœ‰ä¸€å—é¢œè‰²ç›¸åŒçš„ç”»å¸ƒï¼Œç¼–ç æ—¶æŒ‰ç…§nxnå¤§å°çš„å®å—è¿›è¡Œåˆ’åˆ†ï¼Œé‚£ä¹ˆå®å—ä¹‹é—´å­˜åœ¨ç›¸ä¼¼æ€§ï¼Œè¿™å°±ä½¿å¾—å¯ä»¥ä»ç©ºé—´å±‚é¢è¿›è¡Œå‹ç¼©ï¼Œå³å¸§å†…å‹ç¼©ï¼›</p>
<p>å¸§é—´å‹ç¼©ï¼šè¿ç»­å›¾åƒä¹‹é—´å­˜åœ¨è®¸å¤šç›¸ä¼¼ç»†èŠ‚ã€‚æ¯”å¦‚ä¸€è¾†è¿åŠ¨ä¸­çš„æ±½è½¦ï¼Œä»å½“å‰æ—¶åˆ»åˆ°ä¸‹ä¸€æ—¶åˆ»å‘ç”Ÿç›¸å¯¹ä½ç§»ï¼Œä»å¦å¤–ä¸€ä¸ªè§’åº¦æ¥è¯´ï¼Œæ˜¯å‘¨è¾¹ç¯å¢ƒå‘ç”Ÿç›¸å¯¹ä½ç§»è€Œæ±½è½¦æœ¬èº«æ²¡æœ‰å˜åŒ–ï¼Œè¿™å°±ä½¿å¾—å¯ä»¥ä»æ—¶é—´å±‚é¢è¿›è¡Œå‹ç¼©ï¼Œå³å¸§é—´å‹ç¼©ï¼›</p>
<h3 id="5ã€Iå¸§ã€På¸§ã€Bå¸§"><a href="#5ã€Iå¸§ã€På¸§ã€Bå¸§" class="headerlink" title="5ã€Iå¸§ã€På¸§ã€Bå¸§"></a>5ã€Iå¸§ã€På¸§ã€Bå¸§</h3><p>Iå¸§ï¼šå†…éƒ¨ç¼–ç å¸§ï¼Œåˆç§°ä¸ºå…³é”®å¸§ï¼Œä½¿ç”¨Iå¸§ç¼–ç å¯ä»¥å®Œæ•´è¿˜åŸä¸€å‰¯å›¾åƒï¼Œå¸§çš„æ•°æ®é‡ä¼šæ¯”è¾ƒå¤§ï¼›</p>
<p>På¸§ï¼šå‰å‘é¢„æµ‹å¸§ï¼Œåˆç§°ä¸ºå‰å‘å‚è€ƒå¸§ï¼Œéœ€è¦å‚è€ƒå‰ä¸€ä¸ªIå¸§è¿›è¡Œç¼–ç ï¼Œæ•°æ®é‡ä¼šæ¯”Iå¸§å°ã€‚åŒç†ï¼Œè§£ç æ—¶ä¹Ÿéœ€è¦å‚è€ƒå‰ä¸€ä¸ªIå¸§è¿›è¡Œè§£ç ï¼›</p>
<p>Bå¸§ï¼šåŒå‘å†…æ’å¸§ï¼Œåˆç§°ä¸ºåŒå‘å‚è€ƒå¸§ï¼Œéœ€è¦å‚è€ƒå‰åçš„Iå¸§æˆ–På¸§è¿›è¡Œç¼–ç ï¼Œå‹ç¼©ç‡ä¼šæ¯”På¸§æ›´é«˜ï¼Œæ•°æ®é‡æ¯”På¸§æ›´å°ã€‚ä½†æ˜¯ï¼Œè§£ç æ—¶éœ€è¦ä¸‹ä¸€ä¸ªIå¸§æˆ–è€…På¸§çš„åˆ°æ¥ï¼Œè§£ç æ—¶åºéœ€è¦ä¸¥æ ¼æ§åˆ¶ï¼Œè§£ç å¤æ‚åº¦ä¹Ÿç›¸å¯¹é«˜ã€‚</p>
<h3 id="6ã€GOPä¸å…³é”®å¸§é—´éš”"><a href="#6ã€GOPä¸å…³é”®å¸§é—´éš”" class="headerlink" title="6ã€GOPä¸å…³é”®å¸§é—´éš”"></a>6ã€GOPä¸å…³é”®å¸§é—´éš”</h3><p>GOP(å…¨ç§°Group Of Pictures)ï¼Œå›¾åƒåºåˆ—ç»„ï¼Œç”±ä¸€ä¸ªå…³é”®å¸§å’Œè‹¥å¹²ä¸ªéå…³é”®å¸§ç»„æˆã€‚åœ¨ç¼–ç å™¨å‚æ•°è®¾ç½®ä¸­ï¼Œæœ‰ä¸€ä¸ªå‚æ•°è®¾ç½®GOPå¤§å°ã€‚ä»¥Androidçš„mediacodecä¸ºä¾‹ï¼Œè®¾ç½®å…³é”®å¸§é—´éš”æ—¶é—´Key_Frame_Intervalï¼Œä¹Ÿå°±æ˜¯è®¾ç½®å¤šå°‘ç§’æ¥ä¸€ä¸ªå…³é”®å¸§ã€‚å¦å¤–æœ‰ä¸€ä¸ªç±»ä¼¼çš„å‚æ•°ï¼Œå…³é”®å¸§é—´éš”ï¼šå¤šå°‘å¸§æ¥ä¸€ä¸ªå…³é”®å¸§ã€‚</p>
<h3 id="7ã€ç ç‡æ§åˆ¶"><a href="#7ã€ç ç‡æ§åˆ¶" class="headerlink" title="7ã€ç ç‡æ§åˆ¶"></a>7ã€ç ç‡æ§åˆ¶</h3><p>ç ç‡æ§åˆ¶ï¼Œæ˜¯æŒ‡ç½‘ç»œè¯·æ±‚ç æµæ—¶ï¼Œæ ¹æ®ç½‘ç»œå¸¦å®½çŠ¶å†µæ¥æ§åˆ¶ç ç‡å¤§å°ã€‚åˆ†ä¸ºäº”ç§æ§åˆ¶æ–¹å¼ï¼šæ’å®šç ç‡ã€åŠ¨æ€ç ç‡ã€å¹³å‡ç ç‡ã€æ’å®šè´¨é‡å› å­ã€æ’å®šé‡åŒ–å‚æ•°ã€‚è€ŒYoutubeè¯·æ±‚ç½‘ç»œæµæ—¶ï¼Œä¼šæ ¹æ®ç½‘ç»œæ‹¥æŒ¤ç¨‹åº¦æ¥åŠ¨æ€è°ƒæ•´ç ç‡ï¼Œå¾—ç›Šäºä¸€ç§æ–°çš„å¤šåª’ä½“ä¼ è¾“æ§åˆ¶åè®®â€”â€”DASHï¼Œå…¨ç§°ä¸ºDanymic Adaptive Streaming over HTTPï¼Œå³åŸºäºHTTPçš„åŠ¨æ€è‡ªé€‚åº”åª’ä½“æµã€‚æ¥ä¸‹æ¥å¯¹ç ç‡æ§åˆ¶æ–¹å¼è¿›è¡Œå±•å¼€åˆ†æã€‚</p>
<p>æ’å®šç ç‡ï¼šCBR(Constant Bitrate)ï¼Œä»¥æ’å®šçš„ç ç‡å»ç¼–ç ï¼Œæ³¢åŠ¨å°ï¼Œç¼–ç è´¨é‡æ¬ ä½³ï¼›</p>
<p>åŠ¨æ€ç ç‡ï¼šVBR(Variable Bitrate)ï¼Œä»¥åŠ¨æ€çš„ç ç‡å»ç¼–ç ï¼Œæ³¢åŠ¨å¤§ï¼Œç¼–ç è´¨é‡æ¯”è¾ƒç¨³å®šï¼›</p>
<p>å¹³å‡ç ç‡ï¼šABR(Average Bitrate)ï¼Œä»¥å¹³å‡çš„ç ç‡å»ç¼–ç ï¼Œç¼–ç è´¨é‡å‚å·®ä¸é½ï¼›</p>
<p>æ’å®šè´¨é‡å› å­ï¼šCQF(Constant Quality Factor)ï¼Œåˆç§°ä¸ºCRF(Constant Rate Factor)ï¼Œåœ¨x264å’Œx265ç¼–ç é»˜è®¤é‡‡ç”¨CRFï¼Œå–å€¼èŒƒå›´ä¸º[0,51]ï¼Œæ•°å€¼è¶Šå¤§è¡¨ç¤ºè§†é¢‘å‹ç¼©ç‡è¶Šé«˜ï¼Œç¼–ç è´¨é‡è¶Šä½ï¼›</p>
<p>æ’å®šé‡åŒ–å‚æ•°ï¼šCQP(Constant Quantization Parameter)ï¼Œç¬æ—¶ç ç‡ä¼šéšåœºæ™¯å¤æ‚åº¦æœ‰æ‰€æ³¢åŠ¨ï¼Œåœ¨H264å®šä¹‰çš„QPèŒƒå›´ä¸º[0,51]ï¼Œæ•°å€¼è¶Šå¤§è¡¨ç¤ºé‡åŒ–æ­¥é•¿è¶Šå¤§ï¼Œç¼–ç è´¨é‡è¶Šä½ã€‚å½“ä¸ºQP&#x3D;0æ—¶ï¼Œè¡¨ç¤ºæ— æŸç¼–ç ï¼›</p>
<h3 id="8ã€SVCåˆ†çº§ç¼–ç "><a href="#8ã€SVCåˆ†çº§ç¼–ç " class="headerlink" title="8ã€SVCåˆ†çº§ç¼–ç "></a>8ã€SVCåˆ†çº§ç¼–ç </h3><p>SVC(å…¨ç§°Scalable Video Coding)ï¼Œå¯æ‰©å±•çš„è§†é¢‘ç¼–ç ï¼Œä¹Ÿç§°ä¸ºåˆ†çº§ç¼–ç ã€‚å…·æœ‰ä¸‰å¤§ç‰¹æ€§ï¼šæ—¶é—´å¯åˆ†çº§ã€ç©ºé—´å¯åˆ†çº§ã€è´¨é‡å¯åˆ†çº§ã€‚</p>
<p>æ—¶é—´å¯åˆ†çº§ï¼šåˆ†ä¸ºT0ã€T1ã€T2ã€T3ï¼Œç”¨æ¥è®¾ç½®å¸§ç‡ï¼Œä¸¢å¼ƒæ£•ã€ç»¿ã€è“å¾—åˆ°ä¸åŒå¸§ç‡ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192050136.png" alt="img"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192050965.png" alt="img"></p>
<p>è´¨é‡å¯åˆ†çº§ï¼šå¯ä»¥ä»ç æµæå–ä¸åŒå›¾åƒè´¨é‡çš„å­ç æµã€‚</p>
<p>   åº”ç”¨é¢†åŸŸï¼šè§†é¢‘ç›‘æ§ã€æµåª’ä½“ç›´æ’­ã€è§†é¢‘ä¼šè®®ã€‚</p>
<p>   ä¼˜ç‚¹ï¼šåˆ†çº§ç æµåº”ç”¨çµæ´»ï¼Œä¸€æ¬¡ç¼–ç å¤šæ¬¡ä½¿ç”¨ï¼Œå¯å¾—åˆ°ä¸åŒå¸§ç‡ã€åˆ†è¾¨ç‡ã€è´¨é‡ï¼›</p>
<p>   ç¼ºç‚¹ï¼šåˆ†çº§ç æµçš„è§£ç å¤æ‚åº¦å¢åŠ ï¼Œæ¯”å•å±‚ç æµçš„å‹ç¼©ç‡ä½10%å·¦å³ï¼›</p>
<h3 id="9ã€YUV"><a href="#9ã€YUV" class="headerlink" title="9ã€YUV"></a>9ã€YUV</h3><p>è§†é¢‘å‹ç¼©ç¼–ç åï¼Œæ˜¯ä»¥YUVæ ¼å¼è¿›è¡Œå­˜å‚¨çš„ï¼ŒYä»£è¡¨äº®åº¦(Chroma)ï¼ŒUä»£è¡¨è‰²åº¦(Luma)ï¼ŒVä»£è¡¨å¯¹æ¯”åº¦(Contrast)ã€‚å¸¸è§çš„YUVæ’åˆ—æ ¼å¼æœ‰YUV444ã€YUV422ã€YUV420ï¼ŒåŒºåˆ«å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192050879.png" alt="image-20231119205039862"></p>
<p>YUV420åˆ†ä¸ºYUV420På’ŒYUV420SPã€‚å…¶ä¸­ï¼ŒYUV420Påˆç§°ä¸ºI420ï¼ŒPä»£è¡¨Planarå¹³é¢ï¼ŒæŒ‰ç…§Yã€Uã€Vé¡ºåºæ’åˆ—ï¼Œå­˜å‚¨ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192050280.png" alt="image-20231119205051265"></p>
<p> è€ŒYUV420SPï¼Œå…¶ä¸­SPä»£è¡¨Semi PlanaråŠç‹¬ç«‹å¹³é¢ï¼ŒUå’ŒVæ˜¯äº¤é”™å­˜å‚¨çš„ï¼Œå­˜å‚¨ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192050526.png" alt="img"></p>
<p>èƒ½ä¸èƒ½ä¸¾ä¸ªä¾‹å­ï¼Œç»è¿‡ç¼–ç å’Œä¸åº”è¯¥ç¼–ç çš„ä¸€éƒ¨ç”µå½±ä»–ä»¬çš„å¤§å°èƒ½å·®å¤šå°‘ï¼Ÿ</p>
<p>å½“æ¶‰åŠåˆ°è§†é¢‘ç¼–ç çš„å‹ç¼©æ•ˆæœæ—¶ï¼Œå®é™…çš„å‹ç¼©æ¯”ä¾‹ä¼šå—åˆ°å¤šä¸ªå› ç´ çš„å½±å“ï¼ŒåŒ…æ‹¬è§†é¢‘å†…å®¹ã€ç¼–ç å‚æ•°å’Œå‹ç¼©ç®—æ³•ç­‰ã€‚å› æ­¤ï¼Œæ— æ³•ç»™å‡ºå…·ä½“çš„æ•°å­—æ¥è¡¨ç¤ºç¼–ç å‰åè§†é¢‘å¤§å°çš„å·®å¼‚ï¼Œå› ä¸ºç»“æœä¼šå› æƒ…å†µè€Œå¼‚ã€‚ç„¶è€Œï¼Œæˆ‘å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­æ¥è¯´æ˜è§†é¢‘ç¼–ç å¯¹æ–‡ä»¶å¤§å°çš„å½±å“ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€éƒ¨ç”µå½±ï¼ŒæŒç»­æ—¶é—´ä¸º2å°æ—¶ï¼Œåˆ†è¾¨ç‡ä¸º1920x1080åƒç´ ï¼Œå¸§ç‡ä¸º24å¸§&#x2F;ç§’ã€‚æˆ‘ä»¬å°†æ¯”è¾ƒåŸå§‹æœªç»ç¼–ç çš„è§†é¢‘ï¼ˆRaw Videoï¼‰å’Œç»è¿‡å¸¸è§æœ‰æŸå‹ç¼©ç®—æ³•ï¼ˆå¦‚H.264ï¼‰ç¼–ç åçš„è§†é¢‘çš„æ–‡ä»¶å¤§å°ã€‚</p>
<ol>
<li>åŸå§‹æœªç»ç¼–ç çš„è§†é¢‘ï¼ˆRaw Videoï¼‰ï¼š<br>å¯¹äºæ¯ä¸€å¸§ï¼Œå‡è®¾ä½¿ç”¨RGBé¢œè‰²ç©ºé—´ï¼Œæ¯ä¸ªåƒç´ éœ€è¦3ä¸ªå­—èŠ‚ï¼ˆä¸€ä¸ªå­—èŠ‚ç”¨äºçº¢è‰²é€šé“ï¼Œä¸€ä¸ªå­—èŠ‚ç”¨äºç»¿è‰²é€šé“ï¼Œä¸€ä¸ªå­—èŠ‚ç”¨äºè“è‰²é€šé“ï¼‰ã€‚å› æ­¤ï¼Œæ¯ä¸€å¸§çš„æ•°æ®å¤§å°ä¸ºï¼š1920 x 1080 x 3 &#x3D; 6,220,800å­—èŠ‚ã€‚è€ƒè™‘åˆ°24å¸§&#x2F;ç§’ï¼Œ2å°æ—¶é•¿çš„è§†é¢‘å°†éœ€è¦éå¸¸å¤§çš„å­˜å‚¨ç©ºé—´ã€‚</li>
<li>ç»è¿‡æœ‰æŸå‹ç¼©ç¼–ç çš„è§†é¢‘ï¼š<br>ä½¿ç”¨å¸¸è§çš„æœ‰æŸå‹ç¼©ç®—æ³•ï¼ˆå¦‚H.264ï¼‰å¯¹è§†é¢‘è¿›è¡Œç¼–ç æ—¶ï¼Œä¼šåº”ç”¨å˜æ¢ã€é‡åŒ–ã€è¿åŠ¨ä¼°è®¡ã€è¿åŠ¨è¡¥å¿å’Œç†µç¼–ç ç­‰æŠ€æœ¯ã€‚è¿™äº›æŠ€æœ¯å°†å‡å°‘å†—ä½™æ•°æ®å’Œèˆå¼ƒè§†è§‰ä¸Šè¾ƒä¸é‡è¦çš„ä¿¡æ¯ï¼Œä»è€Œæ˜¾è‘—å‡å°æ–‡ä»¶å¤§å°ã€‚å…·ä½“çš„å‹ç¼©æ¯”ä¾‹å°†å–å†³äºç¼–ç å‚æ•°å’Œè§†é¢‘å†…å®¹ã€‚</li>
</ol>
<p>æ¯ä¸€å¸§çš„æ•°æ®å¤§å°ä¸ºï¼š1920 x 1080 x 3 &#x3D; 6,220,800 å­—èŠ‚ã€‚</p>
<p>è€ƒè™‘åˆ°è§†é¢‘çš„å¸§ç‡ä¸º 24 å¸§&#x2F;ç§’ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è®¡ç®—æ¯ç§’çš„æ•°æ®å¤§å°ï¼š<br>æ¯ç§’çš„æ•°æ®å¤§å° &#x3D; æ¯å¸§çš„æ•°æ®å¤§å° x å¸§ç‡ &#x3D; 6,220,800 å­—èŠ‚ x 24 &#x3D; 149,299,200 å­—èŠ‚&#x3D; 0.1389636993408203 GBã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®¡ç®—æ•´ä¸ªè§†é¢‘çš„æ•°æ®å¤§å°ã€‚è§†é¢‘çš„é•¿åº¦ä¸º 2 å°æ—¶ï¼Œå³ 2 x 60 x 60 &#x3D; 7,200 ç§’ï¼š<br>è§†é¢‘çš„æ•°æ®å¤§å° &#x3D; æ¯ç§’çš„æ•°æ®å¤§å° x è§†é¢‘é•¿åº¦ &#x3D; 149,299,200 å­—èŠ‚ x 7,200 &#x3D; 1,074,681,600,000 å­—èŠ‚ã€‚</p>
<p>å°†å­—èŠ‚è½¬æ¢ä¸ºæ›´å¸¸è§çš„å•ä½ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼š<br>è§†é¢‘çš„æ•°æ®å¤§å°çº¦ä¸º 1.07 TBï¼ˆ1 TB &#x3D; 1,099,511,627,776 å­—èŠ‚ï¼‰ã€‚</p>
<p>è¿™æ„å‘³ç€å¯¹äºä¸€éƒ¨æŒç»­ 2 å°æ—¶çš„è§†é¢‘ï¼Œå¦‚æœæ¯å¸§ä½¿ç”¨ RGB é¢œè‰²ç©ºé—´å¹¶ä¸”æ¯ä¸ªåƒç´ éœ€è¦ 3 ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œæœªç»è¿‡ä»»ä½•ç¼–ç å‹ç¼©çš„è§†é¢‘å°†éœ€è¦çº¦ 1.07 TB çš„å­˜å‚¨ç©ºé—´ã€‚</p>
<p>è¿™ä¸ªæ•°å­—æ˜¾ç¤ºäº†ä¸ºä»€ä¹ˆè§†é¢‘ç¼–ç åœ¨å­˜å‚¨å’Œä¼ è¾“è§†é¢‘æ—¶éå¸¸é‡è¦ï¼Œå› ä¸ºåŸå§‹è§†é¢‘æ•°æ®çš„å¤§å°æ˜¯éå¸¸åºå¤§çš„ã€‚è§†é¢‘ç¼–ç å¯ä»¥æ˜¾è‘—å‡å°è§†é¢‘æ–‡ä»¶çš„å¤§å°ï¼Œä»è€Œé™ä½å­˜å‚¨æˆæœ¬å’Œä¼ è¾“å¸¦å®½éœ€æ±‚ã€‚</p>
<h2 id="äºŒã€éŸ³é¢‘ç¼–ç "><a href="#äºŒã€éŸ³é¢‘ç¼–ç " class="headerlink" title="äºŒã€éŸ³é¢‘ç¼–ç "></a>äºŒã€éŸ³é¢‘ç¼–ç </h2><p>äººç±»çš„å¬è§‰èŒƒå›´ä¸º20Hz~20KHzï¼Œé‚£ä¹ˆä½äº20Hzæˆ–è€…é«˜äº20KHzï¼Œè¿™äº›ä½é¢‘æˆ–é«˜é¢‘ä¿¡å·åŸºæœ¬å¬ä¸åˆ°ï¼Œå¯ä»¥ä½œä¸ºå†—ä½™æ•°æ®ï¼Œé€šè¿‡ç‰¹å®šé‡‡æ ·ç‡è¿›è¡Œé‡‡æ ·ã€ç¼–ç ã€‚</p>
<h3 id="1ã€é‡‡æ ·ç‡-1"><a href="#1ã€é‡‡æ ·ç‡-1" class="headerlink" title="1ã€é‡‡æ ·ç‡"></a>1ã€é‡‡æ ·ç‡</h3><p>é‡‡æ ·ç‡æè¿°çš„æ˜¯æ¯ç§’å¯¹åŸå§‹å£°éŸ³ä¿¡å·çš„é‡‡æ ·æ¬¡æ•°ï¼Œå¸¸è§çš„é‡‡æ ·ç‡8000Hzã€16000Hzã€44100Hzã€48000Hzï¼Œç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„æ˜¯44100Hzï¼Œå³44.1KHzã€‚</p>
<h3 id="2ã€æ³¢å½¢ç¼–ç "><a href="#2ã€æ³¢å½¢ç¼–ç " class="headerlink" title="2ã€æ³¢å½¢ç¼–ç "></a>2ã€æ³¢å½¢ç¼–ç </h3><p>ç›´æ¥æŠŠæ—¶åŸŸä¿¡å·è½¬æ¢ä¸ºæ•°å­—ç¼–ç ï¼Œä¸åˆ©ç”¨ä»»ä½•å‚æ•°ï¼Œä½¿å¾—é‡æ„åçš„æ³¢å½¢ä¸åŸå§‹ä¿¡å·çš„æ³¢å½¢å½¢çŠ¶å°½å¯èƒ½ä¿æŒä¸€è‡´ã€‚åŸºæœ¬åŸç†æ˜¯åœ¨æ—¶é—´è½´å¯¹æ¨¡æ‹Ÿè¯­éŸ³ä¿¡å·æŒ‰ç…§ä¸€å®šé€Ÿç‡é‡‡æ ·ï¼Œç„¶åæŠŠå¹…åº¦æ ·æœ¬é‡åŒ–ï¼Œå¹¶ç”¨ä»£ç è¡¨ç¤ºã€‚</p>
<h3 id="3ã€å‚æ•°ç¼–ç "><a href="#3ã€å‚æ•°ç¼–ç " class="headerlink" title="3ã€å‚æ•°ç¼–ç "></a>3ã€å‚æ•°ç¼–ç </h3><p>ä»è¯­éŸ³æ³¢å½¢ä¿¡å·ä¸­æå–ç”Ÿæˆè¯­éŸ³çš„å‚æ•°ï¼Œä½¿ç”¨è¿™äº›å‚æ•°é€šè¿‡è¯­éŸ³ç”Ÿæˆæ¨¡å‹é‡æ„å‡ºè¯­éŸ³ã€‚éŸ³è´¨æ¯”è¾ƒä½ï¼Œä½†æ˜¯ä¿å¯†æ€§è‰¯å¥½ï¼Œå¹¿æ³›åº”ç”¨äºå†›äº‹æŠ€æœ¯ä¸­ï¼Œå…¸å‹çš„å‚æ•°ç¼–ç ä¸ºLPC(Linear Predictive Coding)ã€‚</p>
<h3 id="4ã€æ··åˆç¼–ç "><a href="#4ã€æ··åˆç¼–ç " class="headerlink" title="4ã€æ··åˆç¼–ç "></a>4ã€æ··åˆç¼–ç </h3><p>æ··åˆç¼–ç æ˜¯æŒ‡é‡‡ç”¨ä¸¤ç§ä»¥ä¸Šç¼–ç æŠ€æœ¯ï¼Œæ¯”å¦‚æ³¢å½¢ç¼–ç ä¸å‚æ•°ç¼–ç ç»“åˆï¼Œå½¢æˆä¼˜åŠ¿äº’è¡¥ã€‚</p>
<h3 id="5ã€PCM"><a href="#5ã€PCM" class="headerlink" title="5ã€PCM"></a>5ã€PCM</h3><p>PCM(Pulse Code Modulation è„‰å†²ç¼–ç è°ƒåˆ¶)ï¼Œæ˜¯å¯¹è¿ç»­å˜åŒ–çš„æ¨¡å‹ä¿¡å·æŠ½æ ·ã€é‡åŒ–ã€ç¼–ç çš„è¿‡ç¨‹ï¼Œæœ€ç»ˆè½¬æ¢ä¸ºæ•°å­—ä¿¡å·ã€‚</p>
<h1 id="éŸ³è§†é¢‘è§£ç "><a href="#éŸ³è§†é¢‘è§£ç " class="headerlink" title="éŸ³è§†é¢‘è§£ç "></a>éŸ³è§†é¢‘è§£ç </h1><p>éŸ³è§†é¢‘æ–‡ä»¶æ˜¯ç»è¿‡ç¼–ç ã€å°è£…è€Œæˆçš„ã€‚é‚£ä¹ˆåè¿‡æ¥ï¼Œè¦æ’­æ”¾éŸ³è§†é¢‘æ–‡ä»¶ï¼Œé¦–å…ˆå¾—è§£å°è£…ã€è§£ç ã€‚ä¸Šä¸€ç¯‡åšå®¢è®¨è®ºåˆ°éŸ³è§†é¢‘ç¼–ç ï¼šèµ°è¿›éŸ³è§†é¢‘çš„ä¸–ç•Œâ€”â€”éŸ³è§†é¢‘ç¼–ç ï¼Œæˆ‘ä»¬æ¥ä¸ªä¸Šä¸‹å‘¼åº”ï¼Œæœ¬æ–‡ä¸å¤§å®¶æ¢è®¨ä¸€ä¸‹éŸ³è§†é¢‘è§£ç ã€‚æœ¬è´¨ä¸Šï¼Œæ˜¯æŒ‰ç…§æ—¢å®šçš„è§£ç åè®®å»è§£æç¼–ç å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ç¼–ç çš„é€†è¿‡ç¨‹ã€‚å¸¸è§çš„è§†é¢‘è§£ç å™¨æœ‰ï¼šH264ã€H265ã€VP8ã€VP9ã€MPEG4ã€MJPEGã€WMV3ã€MSMPEG4V3ï¼Œå¸¸è§çš„éŸ³é¢‘è§£ç å™¨æœ‰ï¼šMP3ã€AACã€FLACã€AC3ã€OPUSã€VORBISã€AMRã€WMAã€‚</p>
<h2 id="ä¸€ã€è§†é¢‘è§£ç "><a href="#ä¸€ã€è§†é¢‘è§£ç " class="headerlink" title="ä¸€ã€è§†é¢‘è§£ç "></a>ä¸€ã€è§†é¢‘è§£ç </h2><h3 id="1ã€ptsä¸dts"><a href="#1ã€ptsä¸dts" class="headerlink" title="1ã€ptsä¸dts"></a>1ã€ptsä¸dts</h3><p>dtsï¼šDecode Timestampï¼Œè§£ç æ—¶é—´æˆ³ï¼Œå†³å®šä»€ä¹ˆæ—¶å€™è§£ç è¯¥å¸§æ•°æ®ã€‚</p>
<p>ptsï¼šPresentation Timestampï¼Œæ˜¾ç¤ºæ—¶é—´æˆ³ï¼Œå†³å®šä»€ä¹ˆæ—¶å€™æ˜¾ç¤ºè¯¥å¸§å›¾åƒã€‚ä»¥å‚è€ƒæ—¶é’Ÿä¸ºåŸºå‡†ï¼Œè¶…å‰å‚è€ƒæ—¶é’Ÿåˆ™ç­‰å¾…ï¼Œè½åï¼ˆåœ¨30msä¸500msä¹‹é—´ï¼‰å‚è€ƒæ—¶é’Ÿåˆ™å¿«é€Ÿæ¸²æŸ“ï¼Œååˆ†è½åï¼ˆè¶…è¿‡500msï¼‰å‚è€ƒæ—¶é’Ÿåˆ™ä¸¢å¼ƒè¯¥å¸§ã€‚å‚è€ƒæ—¶é’Ÿåˆ†ä¸ºä¸‰ç§ï¼šç³»ç»Ÿæ—¶é’Ÿã€éŸ³é¢‘æ—¶é’Ÿã€è§†é¢‘æ—¶é’Ÿã€‚ä¸€èˆ¬ä»¥éŸ³é¢‘æ—¶é’Ÿä½œä¸ºå‚è€ƒæ—¶é’Ÿï¼Œå› ä¸ºäººç±»å¯¹å£°éŸ³æ›´åŠ æ•æ„Ÿï¼Œç›¸å¯¹å›¾åƒè€Œè¨€ã€‚</p>
<h3 id="2ã€å…³é”®å¸§ä¸éå…³é”®å¸§"><a href="#2ã€å…³é”®å¸§ä¸éå…³é”®å¸§" class="headerlink" title="2ã€å…³é”®å¸§ä¸éå…³é”®å¸§"></a>2ã€å…³é”®å¸§ä¸éå…³é”®å¸§</h3><p>å…³é”®å¸§ï¼šIå¸§ä¸ºå…³é”®å¸§ï¼Œæ‰€ä»¥Iå¸§å¯ä»¥ç›´æ¥è§£ç è¿˜åŸå‡ºä¸€ä¸ªå›¾åƒã€‚</p>
<p>éå…³é”®å¸§ï¼šPå¸§ä¸Bå¸§ä¸ºéå…³é”®å¸§ï¼Œéœ€è¦ä¾èµ–å…³é”®å¸§æ‰èƒ½è§£ç ã€‚è€ŒBå¸§æ˜¯åŒå‘é¢„æµ‹å¸§ï¼Œè¿˜è¦å¦å¤–ç­‰å¾…ä¸‹ä¸€ä¸ªIå¸§æˆ–På¸§ï¼Œæ‰å¯ä»¥æˆåŠŸè§£ç å‡ºæ¥ã€‚Bå¸§å‹ç¼©ç‡æ¯”è¾ƒé«˜ï¼Œä½†æ˜¯ç¼–è§£ç å¤æ‚åº¦ä¹Ÿç›¸å¯¹é«˜ã€‚</p>
<h3 id="3ã€ç»„åŒ…ä¸æ‹¼å¸§"><a href="#3ã€ç»„åŒ…ä¸æ‹¼å¸§" class="headerlink" title="3ã€ç»„åŒ…ä¸æ‹¼å¸§"></a>3ã€ç»„åŒ…ä¸æ‹¼å¸§</h3><p>æœ‰äº›å°è£…æ ¼å¼ä¼šæŠŠä¸€å¸§æ•°æ®æ‹†æˆè‹¥å¹²åŒ…ï¼Œå› ä¸ºå…³é”®å¸§æ•°æ®å¯èƒ½æ¯”è¾ƒå¤§ï¼›RTPå°è£…æ•°æ®æ—¶ï¼Œä¹Ÿä¼šæŠŠä¸€å¸§æ‹†æˆè‹¥å¹²åŒ…ï¼Œå› ä¸ºMTUè§„å®šç½‘ç»œå±‚æœ€å¤§ä¼ è¾“å•å…ƒä¸º1500bytesã€‚å› æ­¤ï¼Œåœ¨è§£å°è£…æˆ–è€…æ¥æ”¶ç½‘ç»œæ•°æ®åŒ…æ—¶ï¼Œéœ€è¦æ ¹æ®åºå·æ’åˆ—ï¼ŒæŠŠè‹¥å¹²ä¸ªåŒ…ç»„æˆä¸€ä¸ªå®Œæ•´åŒ…ï¼Œç„¶åå†è§£ç ã€‚ä¾‹å¦‚FFmpegè¯»å–ä¸€å¸§æ•°æ®è¿‡ç¨‹ï¼Œæºç åœ¨avformat&#x2F;utils.cä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º(å‚è€ƒé›·ç¥åšå®¢)ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192115640.png" alt="img"></p>
<h3 id="4ã€ç‰¹å®šå¸§å¤´"><a href="#4ã€ç‰¹å®šå¸§å¤´" class="headerlink" title="4ã€ç‰¹å®šå¸§å¤´"></a>4ã€ç‰¹å®šå¸§å¤´</h3><p>åœ¨è§£æh264&#x2F;h265ç¼–ç çš„è§†é¢‘å¸§æ—¶ï¼Œéœ€è¦åœ¨å¸§å¤´æ·»åŠ èµ·å§‹ç ï¼Œä¸€èˆ¬èµ·å§‹ç ä¸º0x00 0x00 0x01æˆ–è€…0x00 0x00 0x00 0x01ã€‚æ¯”å¦‚mp4å°è£…æ ¼å¼ï¼Œä¸€èˆ¬æ˜¯ä»¥h264ä¸º<a href="https://so.csdn.net/so/search?q=%E8%A7%86%E9%A2%91%E7%BC%96%E7%A0%81&spm=1001.2101.3001.7020">è§†é¢‘ç¼–ç </a>ã€aacä¸ºéŸ³é¢‘ç¼–ç ã€‚</p>
<h2 id="äºŒã€éŸ³é¢‘è§£ç "><a href="#äºŒã€éŸ³é¢‘è§£ç " class="headerlink" title="äºŒã€éŸ³é¢‘è§£ç "></a>äºŒã€éŸ³é¢‘è§£ç </h2><h3 id="1ã€planarä¸packedå­˜å‚¨"><a href="#1ã€planarä¸packedå­˜å‚¨" class="headerlink" title="1ã€planarä¸packedå­˜å‚¨"></a>1ã€planarä¸packedå­˜å‚¨</h3><p>planarï¼šæ¯ä¸ªå£°é“æ•°æ®å•ç‹¬å­˜å‚¨ã€‚ä»¥ç«‹ä½“å£°é“ä¸ºä¾‹ï¼ŒLè¡¨ç¤ºå·¦å£°é“ï¼ŒRè¡¨ç¤ºå³å£°é“ã€‚é‚£ä¹ˆå­˜å‚¨æ ¼å¼ä¸ºLLLLRRRRã€‚åœ¨FFmpegä¸­ï¼Œç¬¬iä¸ªå£°é“æ•°æ®å­˜å‚¨åœ¨frame-&gt;data[i]ã€‚ç±»ä¼¼è§†é¢‘çš„åƒç´ æ ¼å¼YUV420Pï¼ŒYã€Uã€Vä¸‰ä¸ªåˆ†é‡å•ç‹¬å­˜å‚¨ï¼Œ4ä¸ªYåˆ†é‡å¯¹åº”ä¸€ä¸ªUåˆ†é‡ä¸ä¸€ä¸ªVåˆ†é‡ã€‚</p>
<p>packedï¼šæ‰€æœ‰å£°é“æ•°æ®äº¤é”™å­˜å‚¨ã€‚åŒæ ·åœ°ï¼Œä»¥ç«‹ä½“å£°é“æ•°æ®ä¸ºä¾‹ã€‚é‚£ä¹ˆå­˜å‚¨æ ¼å¼ä¸ºLRLRLRLRã€‚åœ¨FFmpegä¸­ï¼Œæ‰€æœ‰å£°é“æ•°æ®éƒ½å­˜å‚¨åœ¨frame-&gt;data[0]ã€‚ç±»ä¼¼è§†é¢‘çš„YUV420SPï¼ŒYç‹¬ç«‹å­˜å‚¨ï¼ŒUVäº¤é”™å­˜å‚¨ï¼Œ4ä¸ªYåˆ†é‡å¯¹åº”ä¸€ç»„UVåˆ†é‡ã€‚</p>
<h3 id="2ã€é‡åŒ–ä½æ•°"><a href="#2ã€é‡åŒ–ä½æ•°" class="headerlink" title="2ã€é‡åŒ–ä½æ•°"></a>2ã€é‡åŒ–ä½æ•°</h3><p>é‡åŒ–ä½æ•°ï¼šé‡åŒ–ä½æ˜¯å¯¹æ¨¡æ‹ŸéŸ³é¢‘ä¿¡å·çš„å¹…åº¦è½´æ•°å­—åŒ–ï¼Œå®ƒå†³å®šäº†æ¨¡æ‹Ÿä¿¡å·æ•°å­—åŒ–çš„åŠ¨æ€èŒƒå›´ã€‚é‡åŒ–ä½æ•°è¶Šå¤§ï¼Œè´¨é‡è¶Šå¥½ã€‚bitsPerSampleï¼Œå 2bytesï¼Œä¸€èˆ¬ä¸º8bitsã€16bitsã€32bitsã€64bitsã€‚åœ¨WAVEçš„Format chunkæœ‰å®šä¹‰ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192115938.png" alt="image-20231119211557915"></p>
<h3 id="3ã€é‡‡æ ·ç‡"><a href="#3ã€é‡‡æ ·ç‡" class="headerlink" title="3ã€é‡‡æ ·ç‡"></a>3ã€é‡‡æ ·ç‡</h3><p>éŸ³é¢‘é‡‡æ ·ç‡æ˜¯æŒ‡å½•éŸ³è®¾å¤‡åœ¨1ç§’æ—¶é—´å†…å¯¹å£°éŸ³ä¿¡å·çš„é‡‡æ ·æ¬¡æ•°ï¼Œé‡‡æ ·é¢‘ç‡è¶Šé«˜ï¼Œé‚£ä¹ˆå£°éŸ³çš„è¿˜åŸè¶ŠçœŸå®è‡ªç„¶ã€‚å¸¸è§çš„é‡‡æ ·ç‡æœ‰8000Hzã€16000Hzã€32000Hzã€44100Hzã€48000Hzã€‚å…¶ä¸­44100Hzå¯è¾¾åˆ°CDéŸ³è´¨æ ‡å‡†ï¼Œä¹Ÿæ˜¯ç›®å‰æœ€ä¸ºå¸¸ç”¨çš„é‡‡æ ·ç‡ã€‚</p>
<h3 id="4ã€å£°é“æ•°ä¸å£°é“å¸ƒå±€"><a href="#4ã€å£°é“æ•°ä¸å£°é“å¸ƒå±€" class="headerlink" title="4ã€å£°é“æ•°ä¸å£°é“å¸ƒå±€"></a>4ã€å£°é“æ•°ä¸å£°é“å¸ƒå±€</h3><p>å¸¸è§å£°é“æ•°æœ‰ï¼šå•å£°é“ã€ç«‹ä½“å£°é“ã€3å£°é“ã€4å£°é“ã€5å£°é“ã€6å£°é“ã€7å£°é“ã€8å£°é“ã€‚å…¶ä¸­3å£°é“ä»¥ä¸Šï¼Œåˆç§°ä¸ºç«‹ä½“ç¯ç»•å£°é“ï¼Œå…¶ä¸­æœæ¯”éŸ³æ•ˆå°±æ˜¯é‡‡ç”¨å¤šå£°é“åŒæ—¶è¾“å‡ºï¼Œå®ç°ç«‹ä½“ç¯ç»•æ•ˆæœã€‚</p>
<p>å£°é“å¸ƒå±€çš„å„ä¸ªå£°é“æè¿°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FC: front center</span><br><span class="line">BC: back center</span><br><span class="line">FL/FR: front left/right</span><br><span class="line">FCL/FCR: front center left/right</span><br><span class="line">FTL/FTR: front top left/right</span><br><span class="line">SL/SR: back surround left/right</span><br><span class="line">BL/BR: back left/right</span><br><span class="line">LFE: low frequency effects</span><br></pre></td></tr></table></figure>

<p>å£°é“æ•°ä¸å£°é“å¸ƒå±€å…³ç³»ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311192116640.png" alt="image-20231119211617624"></p>
<h1 id="VPU"><a href="#VPU" class="headerlink" title="VPU"></a>VPU</h1>]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
  </entry>
  <entry>
    <title>rkdebåŒ…çš„åˆ¶ä½œ</title>
    <url>/2023/11/14/7%20rk%20deb%E5%8C%85%E7%9A%84%E5%88%B6%E4%BD%9C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å…ˆè¯´ä¸€ä¸‹å‰æƒ…æè¦ï¼š<br>    æœ€è¿‘è¿™ä¸€ä¸ªæœˆä¸€ç›´åœ¨åˆ¶ä½œdebianå’Œubuntuæ–‡ä»¶ç³»ç»Ÿï¼Œrkå®˜æ–¹é»˜è®¤æƒ…å†µä¸‹åªæ˜¯æ„å»ºäº†debianï¼Œå¥½åƒæ˜¯å› ä¸ºç‰ˆæƒé—®é¢˜ï¼Œç„¶è€Œå‘¢ï¼Œæˆ‘è‚¯å®šæ˜¯è¦æ„å»ºubuntué•œåƒçš„ï¼Œè€Œæˆ‘è¦åšçš„ï¼Œå°±æ˜¯æ ¹æ®rkæä¾›çš„debianç³»ç»Ÿçš„æ„å»ºæ–¹æ³•ï¼Œæ¥è¿›è¡Œubuntuçš„æ„å»ºã€‚</p>
<p>â€‹	æœ€å¤§çš„é—®é¢˜å‡ºç°åœ¨debåŒ…çš„æ„å»º,ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™äº›debåŒ…ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132050152.png" alt="image-20231113205017093"></p>
<p>å¾ˆå¤šå¾ˆå¤šçš„åŒ…ï¼Œæ ¹æœ¬ä¸çŸ¥é“ä»å“ªé‡Œæ¥çš„~~ï¼Œè€Œç°åœ¨å‘¢å¤§çº¦çŸ¥é“äº†ï¼Œé¦–å…ˆå‘¢å…ˆæ¥åˆ†æä¸€ä¸‹å„ä¸ªdockerfileæ–‡ä»¶ã€‚</p>
<p>å‡ ä¸ªå¾ˆé‡è¦çš„githubé“¾æ¥ï¼š</p>
<p><strong>dockerç¯å¢ƒçš„å¤§ä½¬é“¾æ¥</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/Caesar-github</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132057450.png" alt="image-20231113205704425"></p>
<p>å„ç§åº“çš„å¤§ä½¬é“¾æ¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/JeffyCN?tab=repositories</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132058219.png" alt="image-20231113205817179"></p>
<p>é¦™æ©™æ´¾çš„ä»“åº“é“¾æ¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/orangepi-xunlong/rk-rootfs-build</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132205565.png" alt="image-20231113220515527"></p>
<h1 id="1-dockerfile-æ–‡ä»¶"><a href="#1-dockerfile-æ–‡ä»¶" class="headerlink" title="1 dockerfile æ–‡ä»¶"></a>1 dockerfile æ–‡ä»¶</h1><h2 id="1-1-debian10"><a href="#1-1-debian10" class="headerlink" title="1.1 debian10"></a>1.1 debian10</h2><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:buster</span><br><span class="line"><span class="keyword">MAINTAINER</span> Caesar Wang <span class="string">&quot;wxt@rock-chips.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¤šæ¶æ„ç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg --add-architecture arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½® apt é…ç½®ä»¥è·³è¿‡ SSL éªŒè¯</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">touch</span> /etc/apt/apt.conf.d/99verify-peer.conf &amp;&amp; <span class="built_in">echo</span> &gt;&gt;/etc/apt/apt.conf.d/99verify-peer.conf <span class="string">&quot;Acquire &#123; https::Verify-Peer false &#125;&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ æºåˆ—è¡¨</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> sources.list /etc/apt/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°å¹¶å®‰è£…äº¤å‰ç¼–è¯‘æ‰€éœ€çš„åŸºæœ¬è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y crossbuild-essential-arm64 apt-transport-https</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ  overlay ç›®å½•</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> ./overlay/  /</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y sudo locales git fakeroot devscripts cmake vim qemu-user-static:arm64 binfmt-support \</span></span><br><span class="line"><span class="language-bash">        dh-make dh-exec pkg-kde-tools device-tree-compiler:arm64 bc cpio parted dosfstools mtools libssl-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        g++-aarch64-linux-gnu dpkg-dev meson debhelper pkgconf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… arm64 æ¶æ„ä¸‹ libdrm çš„æ„å»ºä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 libdrm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… arm64 æ¶æ„ä¸‹ xorg-server çš„æ„å»ºä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 xorg-server</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… arm64 æ¶æ„ä¸‹çš„ gstreamer ç›¸å…³è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y gstreamer1.0-plugins-bad:arm64 gstreamer1.0-plugins-base:arm64 gstreamer1.0-tools:arm64 \</span></span><br><span class="line"><span class="language-bash">        gstreamer1.0-alsa:arm64 gstreamer1.0-plugins-base-apps:arm64 qtmultimedia5-examples:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… libdrm-dev:arm64</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libdrm-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… gstreamer-rockchip ç›¸å…³è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libx11-dev:arm64 libdrm-dev:arm64 libgstreamer1.0-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        libgstreamer-plugins-base1.0-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… libmali ç›¸å…³è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libstdc++6:arm64 libgbm-dev:arm64 libdrm-dev:arm64 libx11-xcb1:arm64 libxcb-dri2-0:arm64 libxdamage1:arm64 \</span></span><br><span class="line"><span class="language-bash">        libxext6:arm64 libwayland-client0:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… drm-cursor ç›¸å…³è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libgbm-dev:arm64 libegl1-mesa-dev:arm64 libgles2-mesa-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… glmark2 ç›¸å…³è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y debhelper-compat libjpeg-dev:arm64 libpng-dev:arm64 libudev-dev:arm64  libxcb1-dev:arm64 python3 wayland-protocols libwayland-dev libwayland-bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… rktoolkit ç›¸å…³è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="comment">#RUN apt install -y libmad-ocaml-dev libmad0-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… lib4l2 ç›¸å…³è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="comment">#RUN apt update -y</span></span><br><span class="line"><span class="comment">#RUN apt build-dep -y libv4l-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… blueman çš„æ„å»ºä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get build-dep -y blueman</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆ en_US.UTF-8 æœ¬åœ°åŒ–è®¾ç½®</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> locale-gen en_US.UTF-8</span></span><br><span class="line"><span class="keyword">ENV</span> LANG en_US.UTF-<span class="number">8</span></span><br><span class="line"><span class="keyword">ENV</span> LANGUAGE en_US:en</span><br><span class="line"><span class="keyword">ENV</span> LC_ALL en_US.UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;s/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/&#x27;</span> /etc/locale.gen &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&#x27;LANG=&quot;en_US.UTF-8&quot;&#x27;</span>&gt;/etc/default/locale &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    dpkg-reconfigure --frontend=nonäº¤äº’å¼ locales &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    update-locale LANG=en_US.UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Update Headers!&quot;</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg -i /packages/arm64/rga/*.deb</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg -i /packages/arm64/mpp/*.deb</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/gst-rkmpp/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gstreamer/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-base1.0/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-bad1.0/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-good1.0/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/libv4l/*.deb</span></span><br><span class="line"><span class="comment">#RUN dpkg -i /packages/arm64/gst-rkmpp/*.deb</span></span><br><span class="line"><span class="comment">#RUN dpkg -i /packages/arm64/ffmpeg/*.deb</span></span><br><span class="line"><span class="comment">#RUN dpkg -i /packages/arm64/libmali/libmali-midgard-t86x-r18p0-x11*.deb</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> find /packages/arm64/libdrm -name <span class="string">&#x27;*.deb&#x27;</span> | sudo xargs -I&#123;&#125; dpkg -x &#123;&#125; /</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;deb https://mirrors.ustc.edu.cn/debian/ bullseye main contrib non-free&quot;</span> &gt;&gt; /etc/apt/sources.list</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt install -y meson=0.56.2-1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y -f</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°é root ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> useradd -c <span class="string">&#x27;rk user&#x27;</span> -m -d /home/rk -s /bin/bash rk</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;/\%sudo/ c \%sudo ALL=(ALL) NOPASSWD: ALL&#x27;</span> /etc/sudoers</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> usermod -a -G sudo rk</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> rk</span><br></pre></td></tr></table></figure>



<h2 id="1-2-debian11"><a href="#1-2-debian11" class="headerlink" title="1.2 debian11"></a>1.2 debian11</h2><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:bookworm</span><br><span class="line"><span class="keyword">MAINTAINER</span> Caesar Wang <span class="string">&quot;wxt@rock-chips.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¤šæ¶æ„ç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg --add-architecture arm64</span></span><br><span class="line"><span class="comment">#RUN echo &quot;deb-src http://deb.debian.org/debian bullseye main&quot; &gt;&gt; /etc/apt/sources.list</span></span><br><span class="line"><span class="comment">#RUN echo &quot;deb-src http://deb.debian.org/debian bullseye-updates main&quot; &gt;&gt; /etc/apt/sources.list</span></span><br><span class="line"><span class="comment">#RUN echo &quot;deb-src http://security.debian.org bullseye/updates main&quot; &gt;&gt; /etc/apt/sources.list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œapt-get updateå¹¶å®‰è£…ca-certificates</span></span><br><span class="line"><span class="comment">#RUN apt-get update &amp;&amp; apt-get install -y ca-certificates</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">touch</span> /etc/apt/apt.conf.d/99verify-peer.conf &amp;&amp; <span class="built_in">echo</span> &gt;&gt;/etc/apt/apt.conf.d/99verify-peer.conf <span class="string">&quot;Acquire &#123; https::Verify-Peer false &#125;&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ sources.listæ–‡ä»¶åˆ°/etc/apt/ç›®å½•</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> sources.list /etc/apt/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y crossbuild-essential-arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ overlayç›®å½•åˆ°æ ¹ç›®å½•</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> ./overlay/  /</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y sudo locales git fakeroot devscripts cmake vim qemu-user-static:arm64 binfmt-support \</span></span><br><span class="line"><span class="language-bash">        dh-make dh-exec pkg-kde-tools device-tree-compiler:arm64 bc cpio parted dosfstools mtools libssl-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        g++-aarch64-linux-gnu dpkg-dev meson debhelper pkgconf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 libdrm</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 xorg-server</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y gstreamer1.0-plugins-bad:arm64 gstreamer1.0-plugins-base:arm64 gstreamer1.0-tools:arm64 \</span></span><br><span class="line"><span class="language-bash">        gstreamer1.0-alsa:arm64 gstreamer1.0-plugins-base-apps:arm64 qtmultimedia5-examples:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…rgaæ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libdrm-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…gstreamer-rockchipæ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libx11-dev:arm64 libdrm-dev:arm64 libgstreamer1.0-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        libgstreamer-plugins-base1.0-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libmaliæ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libstdc++6:arm64 libgbm-dev:arm64 libdrm-dev:arm64 libx11-xcb1:arm64 libxcb-dri2-0:arm64 libxdamage1:arm64 \</span></span><br><span class="line"><span class="language-bash">        libxext6:arm64 libwayland-client0:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…drm-cursoræ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libgbm-dev:arm64 libegl1-mesa-dev:arm64 libgles2-mesa-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…glmark2æ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y debhelper-compat libjpeg-dev:arm64 libpng-dev:arm64 libudev-dev:arm64  libxcb1-dev:arm64 python3 wayland-protocols libwayland-dev libwayland-bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…rktoolkitæ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="comment">#RUN apt install -y libmad-ocaml-dev libmad0-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…lib4l2æ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="comment">#RUN apt update -y</span></span><br><span class="line"><span class="comment">#RUN apt build-dep -y libv4l-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆen_US.UTF-8æœ¬åœ°åŒ–</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> locale-gen en_US.UTF-8</span></span><br><span class="line"><span class="keyword">ENV</span> LANG en_US.UTF-<span class="number">8</span></span><br><span class="line"><span class="keyword">ENV</span> LANGUAGE en_US:en</span><br><span class="line"><span class="keyword">ENV</span> LC_ALL en_US.UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;s/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/&#x27;</span> /etc/locale.gen &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&#x27;LANG=&quot;en_US.UTF-8&quot;&#x27;</span>&gt;/etc/default/locale &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    dpkg-reconfigure --frontend=noninteractive locales &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    update-locale LANG=en_US.UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Update Headers!&quot;</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg -i /packages/arm64/rga/*.deb</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg -i /packages/arm64/mpp/*.deb</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/gst-rkmpp/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gstreamer/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-base1.0/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-bad1.0/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-good1.0/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/libv4l/*.deb</span></span><br><span class="line"><span class="comment">#RUN dpkg -i /packages/arm64/gst-rkmpp/*.deb</span></span><br><span class="line"><span class="comment">#RUN dpkg -i /packages/arm64/ffmpeg/*.deb</span></span><br><span class="line"><span class="comment">#RUN dpkg -i /packages/arm64/libmali/libmali-midgard-t86x-r18p0-x11*.deb</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> find /packages/arm64/libdrm -name <span class="string">&#x27;*.deb&#x27;</span> | sudo xargs -I&#123;&#125; dpkg -x &#123;&#125; /</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y -f</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°érootç”¨æˆ·</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> useradd -c <span class="string">&#x27;rk user&#x27;</span> -m -d /home/rk -s /bin/bash rk</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;/\%sudo/ c \%sudo ALL=(ALL) NOPASSWD: ALL&#x27;</span> /etc/sudoers</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> usermod -a -G sudo rk</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> rk</span><br></pre></td></tr></table></figure>



<h2 id="1-3-debian12"><a href="#1-3-debian12" class="headerlink" title="1.3 debian12"></a>1.3 debian12</h2><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨Debian bookwormä½œä¸ºåŸºç¡€é•œåƒ</span></span><br><span class="line"><span class="keyword">FROM</span> debian:bookworm</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®é•œåƒçš„ç»´æŠ¤è€…ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> Caesar Wang <span class="string">&quot;wxt@rock-chips.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ arm64æ¶æ„æ”¯æŒ</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg --add-architecture arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®aptï¼Œç¦ç”¨HTTPSçš„è¯ä¹¦éªŒè¯</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">touch</span> /etc/apt/apt.conf.d/99verify-peer.conf &amp;&amp; <span class="built_in">echo</span> &gt;&gt;/etc/apt/apt.conf.d/99verify-peer.conf <span class="string">&quot;Acquire &#123; https::Verify-Peer false &#125;&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ è‡ªå®šä¹‰çš„sources.listæ–‡ä»¶åˆ°å®¹å™¨çš„/etc/apt/ç›®å½•</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> sources.list /etc/apt/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°aptæºå¹¶å®‰è£…crossbuild-essential-arm64è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y crossbuild-essential-arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å½“å‰ç›®å½•ä¸‹çš„overlayç›®å½•æ·»åŠ åˆ°é•œåƒçš„æ ¹ç›®å½•</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> ./overlay/  /</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºè¿‡ç¨‹ä¸­éœ€è¦çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt install -fy sudo locales git fakeroot devscripts cmake vim qemu-user-static:arm64 binfmt-support \</span></span><br><span class="line"><span class="language-bash">        dh-make dh-exec device-tree-compiler:arm64 bc:arm64 cpio:arm64 parted dosfstools:arm64 mtools:arm64 libssl-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        g++-aarch64-linux-gnu dpkg-dev:arm64 meson:arm64 debhelper:arm64 pkgconf:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºlibdrmåº“æ‰€éœ€çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 libdrm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºxorg-serveræ‰€éœ€çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 xorg-server</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…GStreamerç›¸å…³çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y gstreamer1.0-plugins-bad:arm64 gstreamer1.0-plugins-base:arm64 gstreamer1.0-tools:arm64 \</span></span><br><span class="line"><span class="language-bash">        gstreamer1.0-alsa:arm64 gstreamer1.0-plugins-base-apps:arm64 qtmultimedia5-examples:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libdrm-devä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libdrm-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libx11-devã€libdrm-devã€libgstreamer1.0-devã€libgstreamer-plugins-base1.0-devç­‰ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libx11-dev:arm64 libdrm-dev:arm64 libgstreamer1.0-dev:arm64 libgstreamer-plugins-base1.0-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        libgstreamer-plugins-base1.0-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libstdc++6ã€libgbm-devã€libdrm-devã€libx11-xcb1ã€libxcb-dri2-0ã€libxdamage1ã€libxext6ã€libwayland-client0ç­‰ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libstdc++6:arm64 libgbm-dev:arm64 libdrm-dev:arm64 libx11-xcb1:arm64 libxcb-dri2-0:arm64 libxdamage1:arm64 \</span></span><br><span class="line"><span class="language-bash">        libxext6:arm64 libwayland-client0:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libgbm-devã€libegl1-mesa-devã€libgles2-mesa-devä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libgbm-dev:arm64 libegl1-mesa-dev:arm64 libgles2-mesa-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…debhelper-compatã€libjpeg-devã€libpng-devã€libudev-devã€libxcb1-devã€python3ã€wayland-protocolsã€libwayland-devã€libwayland-binç­‰ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y debhelper-compat libjpeg-dev:arm64 libpng-dev:arm64 libudev-dev:arm64  libxcb1-dev:arm64 python3 wayland-protocols libwayland-dev libwayland-bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºwestonæ‰€éœ€çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt build-dep -y weston:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆå¹¶è®¾ç½®ç³»ç»Ÿçš„localeä¸ºen_US.UTF-8</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> locale-gen en_US.UTF-8</span></span><br><span class="line"><span class="keyword">ENV</span> LANG en_US.UTF-<span class="number">8</span></span><br><span class="line"><span class="keyword">ENV</span> LANGUAGE en_US:en</span><br><span class="line"><span class="keyword">ENV</span> LC_ALL en_US.UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹locale.genæ–‡ä»¶å¹¶é‡æ–°é…ç½®localesï¼Œæ›´æ–°localeè®¾ç½®</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;s/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/&#x27;</span> /etc/locale.gen &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&#x27;LANG=&quot;en_US.UTF-8&quot;&#x27;</span>&gt;/etc/default/locale &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    dpkg-reconfigure --frontend=noninteractive locales &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    update-locale LANG=en_US.UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°æ—¥å¿—ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Update Headers!&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…rga2è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg -i /packages/arm64/rga2/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…mppè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg -i /packages/arm64/mpp/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…gst-rkmppè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/gst-rkmpp/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…gst-plugins-base1.0è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-base1.0/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libv4lè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/libv4l/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹libdrmè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> find /packages/arm64/libdrm -name <span class="string">&#x27;*.deb&#x27;</span> | sudo xargs -I&#123;&#125; dpkg -x &#123;&#125; /</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°aptæºå¹¶å®‰è£…ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y -f</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºåä¸ºrkçš„ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> useradd -c <span class="string">&#x27;rk user&#x27;</span> -m -d /home/rk -s /bin/bash rk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹sudoersæ–‡ä»¶ï¼Œå…è®¸rkç”¨æˆ·ä½¿ç”¨sudoå‘½ä»¤æ— éœ€å¯†ç éªŒè¯</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;/\%sudo/ c \%sudo ALL=(ALL) NOPASSWD: ALL&#x27;</span> /etc/sudoers</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†rkç”¨æˆ·æ·»åŠ åˆ°sudoç”¨æˆ·ç»„ä¸­</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> usermod -a -G sudo rk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°rkç”¨æˆ·</span></span><br><span class="line"><span class="keyword">USER</span> rk</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="2-é—®é¢˜æ¢ç©¶"><a href="#2-é—®é¢˜æ¢ç©¶" class="headerlink" title="2.é—®é¢˜æ¢ç©¶"></a>2.é—®é¢˜æ¢ç©¶</h1><p>é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸å¯ä»¥ä¸‹è½½è½¯ä»¶æºç çš„ï¼Œå½“å–æ¶ˆä¸€äº›ç‰¹å®šçš„æ³¨é‡Šä¹‹åï¼Œæ˜¯å¯ä»¥ä½¿ç”¨apt-get sourceå‘½ä»¤è¿›è¡Œè½¯ä»¶åŒ…æºç çš„ä¸‹è½½çš„ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt-get source xorg-server</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132118169.png" alt="image-20231113211818133"></p>
<p>æœ€åä¸€å¥è¯å¿½ç•¥å³å¯</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132118188.png" alt="image-20231113211831167"></p>
<ul>
<li><code>xorg-server-1.20.13</code>ï¼šè¿™æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå…¶ä¸­åŒ…å«äº†<code>xorg-server</code>è½¯ä»¶åŒ…çš„æºä»£ç æ–‡ä»¶å’Œå…¶ä»–ç›¸å…³æ–‡ä»¶ã€‚</li>
<li><code>xorg-server_1.20.13-1ubuntu1~20.04.9.diff.gz</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†å¯¹æºä»£ç è¿›è¡Œä¿®æ”¹çš„è¡¥ä¸æ–‡ä»¶ï¼ˆdiffæ–‡ä»¶ï¼‰ã€‚</li>
<li><code>xorg-server_1.20.13-1ubuntu1~20.04.9.dsc</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†è½¯ä»¶åŒ…çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œä¾‹å¦‚è½¯ä»¶åŒ…çš„åç§°ã€ç‰ˆæœ¬å·ã€ç»´æŠ¤è€…ç­‰ã€‚</li>
<li><code>xorg-server_1.20.13.orig.tar.gz</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†è½¯ä»¶åŒ…çš„åŸå§‹æºä»£ç æ–‡ä»¶ï¼Œå³æœªç»è¿‡ä»»ä½•ä¿®æ”¹çš„åŸå§‹æ–‡ä»¶ã€‚</li>
<li><code>xorg-server_1.20.13.orig.tar.gz.asc</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæ•°å­—ç­¾åæ–‡ä»¶ï¼Œç”¨äºéªŒè¯è½¯ä»¶åŒ…çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</li>
</ul>
<p>ç”±äºæˆ‘æ˜¯è™šæ‹Ÿæœºä¸Šè¿›è¡Œæµ‹è¯•çš„æ‰€ä»¥æˆ‘åº”è¯¥å®‰è£…ç”µè„‘amd64çš„ï¼Œè¿™é‡Œå…ˆå®‰è£…æ„å»ºxorg-serverçš„è½¯ä»¶åŒ…ï¼Œä¸‹é¢éœ€è¦æ³¨æ„çš„æ˜¯build-depè¿™ä¸ªå‚æ•°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a amd64 xorg-server</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132125078.png" alt="image-20231113212511030"></p>
<p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»ºdebåŒ…</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">DEB_BUILD_OPTIONS=nocheck dpkg-buildpackage -rfakeroot -b -d -uc -us -aamd64</span><br></pre></td></tr></table></figure>

<ul>
<li><code>DEB_BUILD_OPTIONS=nocheck</code>ï¼šè¿™ä¸ªé€‰é¡¹è®¾ç½®æ„å»ºè¿‡ç¨‹ä¸­ä¸è¿è¡Œè‡ªåŠ¨åŒ–çš„æµ‹è¯•ã€‚</li>
<li><code>dpkg-buildpackage</code>ï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºæ„å»º Debian è½¯ä»¶åŒ…ã€‚</li>
<li><code>-rfakeroot</code>ï¼šè¿™ä¸ªé€‰é¡¹åœ¨æ„å»ºè¿‡ç¨‹ä¸­æ¨¡æ‹Ÿ root æƒé™ï¼Œä»¥ä¾¿å¯ä»¥åœ¨éç‰¹æƒç”¨æˆ·ä¸‹è¿›è¡Œæ„å»ºã€‚</li>
<li><code>-b</code>ï¼šè¿™ä¸ªé€‰é¡¹å‘Šè¯‰ <code>dpkg-buildpackage</code> æ„å»ºäºŒè¿›åˆ¶è½¯ä»¶åŒ…ï¼ˆå³ç”Ÿæˆ .deb æ–‡ä»¶ï¼‰ã€‚</li>
<li><code>-d</code>ï¼šè¿™ä¸ªé€‰é¡¹å‘Šè¯‰ <code>dpkg-buildpackage</code> å¿½ç•¥æ„å»ºä¾èµ–å…³ç³»ï¼Œå³ä¸æ£€æŸ¥æ„å»ºä¾èµ–å…³ç³»æ˜¯å¦æ»¡è¶³ã€‚</li>
<li><code>-uc</code>ï¼šè¿™ä¸ªé€‰é¡¹å‘Šè¯‰ <code>dpkg-buildpackage</code> ä¸ä½¿ç”¨è½¯ä»¶åŒ…çš„ç»´æŠ¤è€…å¯†é’¥è¿›è¡Œç­¾åã€‚</li>
<li><code>-us</code>ï¼šè¿™ä¸ªé€‰é¡¹å‘Šè¯‰ <code>dpkg-buildpackage</code> ä¸ç”Ÿæˆæºç è½¯ä»¶åŒ…ï¼ˆå³ä¸ç”Ÿæˆ .dsc æ–‡ä»¶ï¼‰ã€‚</li>
<li><code>-aamd64</code>ï¼šè¿™ä¸ªé€‰é¡¹æŒ‡å®šäº†ç›®æ ‡æ¶æ„ä¸º amd64ï¼Œå³æ„å»ºé€‚ç”¨äº amd64 æ¶æ„çš„è½¯ä»¶åŒ…ã€‚</li>
</ul>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132126611.png" alt="image-20231113212628562"></p>
<p>æ„å»ºå®Œæˆä¹‹åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132130327.png" alt="image-20231113213003305"></p>
<p>æ ¹æ®æä¾›çš„è½¯ä»¶åŒ…åˆ—è¡¨ï¼Œå¯ä»¥å°†å®ƒä»¬åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p>
<ol>
<li><strong>xorg-server ç›¸å…³</strong>ï¼š<ul>
<li><code>xorg-server-source_1.20.13-1ubuntu1~20.04.9_all.deb</code>ï¼šxorg-server çš„æºä»£ç åŒ…ã€‚</li>
<li><code>xorg-server_1.20.13-1ubuntu1~20.04.9_amd64.deb</code>ï¼šxorg-server çš„äºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚</li>
<li><code>xorg-server-dbgsym_1.20.13-1ubuntu1~20.04.9_amd64.ddeb</code>ï¼šxorg-server çš„è°ƒè¯•ç¬¦å·åŒ…ã€‚</li>
</ul>
</li>
<li><strong>xserver-xorg-core ç›¸å…³</strong>ï¼š<ul>
<li><code>xserver-xorg-core_1.20.13-1ubuntu1~20.04.9_amd64.deb</code>ï¼šxserver-xorg-core çš„äºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚</li>
<li><code>xserver-xorg-core-dbgsym_1.20.13-1ubuntu1~20.04.9_amd64.ddeb</code>ï¼šxserver-xorg-core çš„è°ƒè¯•ç¬¦å·åŒ…ã€‚</li>
<li><code>xserver-xorg-core-udeb_1.20.13-1ubuntu1~20.04.9_amd64.udeb</code>ï¼šxserver-xorg-core çš„ç”¨äº Debian å®‰è£…ç¨‹åºçš„æœ€å°åŒ–äºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚</li>
</ul>
</li>
<li><strong>xserver-xephyr ç›¸å…³</strong>ï¼š<ul>
<li><code>xserver-xephyr_1.20.13-1ubuntu1~20.04.9_amd64.deb</code>ï¼šxserver-xephyr çš„äºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚</li>
<li><code>xserver-xephyr-dbgsym_1.20.13-1ubuntu1~20.04.9_amd64.ddeb</code>ï¼šxserver-xephyr çš„è°ƒè¯•ç¬¦å·åŒ…ã€‚</li>
</ul>
</li>
<li><strong>xserver-xorg-legacy ç›¸å…³</strong>ï¼š<ul>
<li><code>xserver-xorg-legacy_1.20.13-1ubuntu1~20.04.9_amd64.deb</code>ï¼šxserver-xorg-legacy çš„äºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚</li>
<li><code>xserver-xorg-legacy-dbgsym_1.20.13-1ubuntu1~20.04.9_amd64.ddeb</code>ï¼šxserver-xorg-legacy çš„è°ƒè¯•ç¬¦å·åŒ…ã€‚</li>
</ul>
</li>
<li><strong>å…¶ä»–ç»„ä»¶</strong>ï¼š<ul>
<li><code>xdmx_1.20.13-1ubuntu1~20.04.9_amd64.deb</code>ï¼šxdmx çš„äºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚</li>
<li><code>xdmx-dbgsym_1.20.13-1ubuntu1~20.04.9_amd64.ddeb</code>ï¼šxdmx çš„è°ƒè¯•ç¬¦å·åŒ…ã€‚</li>
<li><code>xdmx-tools_1.20.13-1ubuntu1~20.04.9_amd64.deb</code>ï¼šxdmx-tools çš„äºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚</li>
<li><code>xdmx-tools-dbgsym_1.20.13-1ubuntu1~20.04.9_amd64.ddeb</code>ï¼šxdmx-tools çš„è°ƒè¯•ç¬¦å·åŒ…ã€‚</li>
<li><code>xnest_1.20.13-1ubuntu1~20.04.9_amd64.deb</code>ï¼šxnest çš„äºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚</li>
<li><code>xnest-dbgsym_1.20.13-1ubuntu1~20.04.9_amd64.ddeb</code>ï¼šxnest çš„è°ƒè¯•ç¬¦å·åŒ…ã€‚</li>
<li><code>xwayland_1.20.13-1ubuntu1~20.04.9_amd64.deb</code>ï¼šxwayland çš„äºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚</li>
<li><code>xwayland-dbgsym_1.20.13-1ubuntu1~20.04.9_amd64.ddeb</code>ï¼šxwayland çš„è°ƒè¯•ç¬¦å·åŒ…ã€‚</li>
<li><code>xserver-common_1.20.13-1ubuntu1~20.04.9_all.deb</code>ï¼šxserver çš„å…¬å…±æ–‡ä»¶åŒ…ã€‚</li>
<li><code>xserver-xorg-dev_1.20.13-1ubuntu1~20.04.9_amd64.deb</code>ï¼šxserver-xorg-dev çš„äºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚</li>
<li><code>xvfb_1.20.13-1ubuntu1~20.04.9_amd64.deb</code>ï¼šxvfb çš„äºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚</li>
<li><code>xvfb-dbgsym_1.20.13-1ubuntu1~20.04.9_amd64.ddeb</code>ï¼šxvfb çš„è°ƒè¯•ç¬¦å·åŒ…ã€‚</li>
</ul>
</li>
</ol>
<p>&#x3D;&#x3D;ä¸ºä»€ä¹ˆä¼šæœ‰deb udeb ddebå‘¢æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&#x3D;&#x3D;</p>
<p>åœ¨ Debian ç³»ç»Ÿä¸­ï¼Œè½¯ä»¶åŒ…æ–‡ä»¶çš„æ‰©å±•åå¯ä»¥æœ‰ä¸åŒçš„å½¢å¼ï¼Œå¦‚ .debã€.udeb å’Œ .ddebã€‚è¿™äº›æ‰©å±•åä»£è¡¨äº†ä¸åŒç±»å‹çš„è½¯ä»¶åŒ…ã€‚</p>
<ol>
<li><strong>.deb</strong>ï¼š.deb æ˜¯æœ€å¸¸è§çš„ Debian è½¯ä»¶åŒ…æ‰©å±•åï¼Œç”¨äºäºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚è¿™äº›è½¯ä»¶åŒ…åŒ…å«å·²ç»ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥å®‰è£…å’Œä½¿ç”¨ã€‚é€šå¸¸ç”¨äºå¸¸è§„çš„åº”ç”¨ç¨‹åºã€åº“å’Œå·¥å…·ç­‰ã€‚</li>
<li><strong>.udeb</strong>ï¼š.udeb æ˜¯ç”¨äº Debian å®‰è£…ç¨‹åºçš„ç‰¹æ®Šç±»å‹çš„è½¯ä»¶åŒ…æ‰©å±•åï¼Œå®ƒè¡¨ç¤ºå¾®å‹äºŒè¿›åˆ¶è½¯ä»¶åŒ…ï¼ˆmicrodebï¼‰ã€‚è¿™äº›è½¯ä»¶åŒ…é€šå¸¸éå¸¸å°ï¼Œå¹¶åŒ…å«äº†åœ¨ç³»ç»Ÿå®‰è£…è¿‡ç¨‹ä¸­æ‰€éœ€çš„æœ€å°åŒ–ç»„ä»¶ã€‚.udeb æ–‡ä»¶ä¸»è¦ç”¨äº Debian å®‰è£…ç¨‹åºï¼ˆå¦‚ Debian Installerï¼‰æœŸé—´çš„ç³»ç»Ÿå®‰è£…å’Œé…ç½®ï¼Œå®ƒä»¬é€šå¸¸åŒ…å«ä¸€äº›æ ¸å¿ƒç»„ä»¶å’Œé©±åŠ¨ç¨‹åºã€‚</li>
<li><strong>.ddeb</strong>ï¼š.ddeb æ˜¯è°ƒè¯•ç¬¦å·è½¯ä»¶åŒ…çš„æ‰©å±•åã€‚è°ƒè¯•ç¬¦å·åŒ…åŒ…å«äº†ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸è°ƒè¯•ä¿¡æ¯çš„æ˜ å°„å…³ç³»ï¼Œå®ƒä»¬ç”¨äºåœ¨è°ƒè¯•è½¯ä»¶æ—¶è¿›è¡Œç¬¦å·è§£æå’Œè°ƒè¯•ã€‚é€šè¿‡å°†è°ƒè¯•ç¬¦å·åŒ…ä¸ç›¸åº”çš„äºŒè¿›åˆ¶è½¯ä»¶åŒ…ç»“åˆä½¿ç”¨ï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­è·å–æ›´è¯¦ç»†å’Œæœ‰ç”¨çš„è°ƒè¯•ä¿¡æ¯ã€‚.ddeb æ–‡ä»¶é€šå¸¸ç”¨äºå¼€å‘å’Œè°ƒè¯•ç›®çš„ã€‚</li>
</ol>
<p>ä¹Ÿå°±æ˜¯è¯´è¿™äº›æ‰æ˜¯æœ€é‡è¦çš„ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132134590.png" alt="image-20231113213434571"></p>
<p>é‚£ä¹ˆç°åœ¨æˆ‘ä¸Šé¢çš„é‚£äº›dockeré•œåƒç»ˆäºæœ‰ä½œç”¨äº†ã€‚</p>
<p>ç„¶åæ‹‰å–å¤§ä½¬çš„xserveræºç ï¼Œæ‹‰å–å®Œæˆå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/JeffyCN/xorg-xserver.git</span><br></pre></td></tr></table></figure>



<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132213321.png" alt="image-20231113221319299"></p>
<p>ç„¶ååˆ‡æ¢åˆ†æ”¯åˆ°1.20.4</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git chechout remotes/origin/rockchip/debian/1.20.4</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132217566.png" alt="image-20231113221707543"></p>
<p>ç„¶åæŸ¥çœ‹ä¸€ä¸‹åˆ†æ”¯ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132217464.png" alt="image-20231113221726438"></p>
<p>æœ€åä½¿ç”¨dockeråŠ è½½ä¸€ä¸‹è¯¥æºç </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --privileged -it -v /home/topeet/Linux/xorg-xserver:/home/topeet/xorg-xserver debian10</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132220805.png" alt="image-20231113222045776"></p>
<p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»ºdebåŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo DEB_BUILD_OPTIONS=nocheck dpkg-buildpackage -rfakeroot -b -d -uc -us -aarm64</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;æˆ‘è¿˜ä»¥ä¸ºè¿™æ˜¯aarch64ï¼Œæˆ‘è¯´å’‹ä¸€ç›´ä¸å¯¹~~~&#x3D;&#x3D;ï¼Œæ„å»ºå®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132226598.png" alt="image-20231113222638562"></p>
<p>ç„¶åå¼€å§‹åœ¨ä¸Šä¸€èŠ‚ç›®å½•ä¸‹ç”Ÿæˆäº†å¯¹åº”çš„debåŒ…ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311132227725.png" alt="image-20231113222742691"></p>
<h1 id="1-debian10-dockerfile"><a href="#1-debian10-dockerfile" class="headerlink" title="1.debian10 dockerfile"></a>1.debian10 dockerfile</h1><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:buster</span><br><span class="line"><span class="keyword">MAINTAINER</span> Caesar Wang <span class="string">&quot;wxt@rock-chips.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¤šæ¶æ„ç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg --add-architecture arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½® apt é…ç½®ä»¥è·³è¿‡ SSL éªŒè¯</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">touch</span> /etc/apt/apt.conf.d/99verify-peer.conf &amp;&amp; <span class="built_in">echo</span> &gt;&gt;/etc/apt/apt.conf.d/99verify-peer.conf <span class="string">&quot;Acquire &#123; https::Verify-Peer false &#125;&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ æºåˆ—è¡¨</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> sources.list /etc/apt/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°å¹¶å®‰è£…äº¤å‰ç¼–è¯‘æ‰€éœ€çš„åŸºæœ¬è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y crossbuild-essential-arm64 apt-transport-https</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ  overlay ç›®å½•</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> ./overlay/  /</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y sudo locales git fakeroot devscripts cmake vim qemu-user-static:arm64 binfmt-support \</span></span><br><span class="line"><span class="language-bash">        dh-make dh-exec pkg-kde-tools device-tree-compiler:arm64 bc cpio parted dosfstools mtools libssl-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        g++-aarch64-linux-gnu dpkg-dev meson debhelper pkgconf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… arm64 æ¶æ„ä¸‹ libdrm çš„æ„å»ºä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 libdrm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… arm64 æ¶æ„ä¸‹ xorg-server çš„æ„å»ºä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 xorg-server</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… arm64 æ¶æ„ä¸‹çš„ gstreamer ç›¸å…³è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y gstreamer1.0-plugins-bad:arm64 gstreamer1.0-plugins-base:arm64 gstreamer1.0-tools:arm64 \</span></span><br><span class="line"><span class="language-bash">        gstreamer1.0-alsa:arm64 gstreamer1.0-plugins-base-apps:arm64 qtmultimedia5-examples:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… libdrm-dev:arm64</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libdrm-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… gstreamer-rockchip ç›¸å…³è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libx11-dev:arm64 libdrm-dev:arm64 libgstreamer1.0-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        libgstreamer-plugins-base1.0-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… libmali ç›¸å…³è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libstdc++6:arm64 libgbm-dev:arm64 libdrm-dev:arm64 libx11-xcb1:arm64 libxcb-dri2-0:arm64 libxdamage1:arm64 \</span></span><br><span class="line"><span class="language-bash">        libxext6:arm64 libwayland-client0:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… drm-cursor ç›¸å…³è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libgbm-dev:arm64 libegl1-mesa-dev:arm64 libgles2-mesa-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… glmark2 ç›¸å…³è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y debhelper-compat libjpeg-dev:arm64 libpng-dev:arm64 libudev-dev:arm64  libxcb1-dev:arm64 python3 wayland-protocols libwayland-dev libwayland-bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… rktoolkit ç›¸å…³è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="comment">#RUN apt install -y libmad-ocaml-dev libmad0-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… lib4l2 ç›¸å…³è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="comment">#RUN apt update -y</span></span><br><span class="line"><span class="comment">#RUN apt build-dep -y libv4l-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… blueman çš„æ„å»ºä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get build-dep -y blueman</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆ en_US.UTF-8 æœ¬åœ°åŒ–è®¾ç½®</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> locale-gen en_US.UTF-8</span></span><br><span class="line"><span class="keyword">ENV</span> LANG en_US.UTF-<span class="number">8</span></span><br><span class="line"><span class="keyword">ENV</span> LANGUAGE en_US:en</span><br><span class="line"><span class="keyword">ENV</span> LC_ALL en_US.UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;s/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/&#x27;</span> /etc/locale.gen &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&#x27;LANG=&quot;en_US.UTF-8&quot;&#x27;</span>&gt;/etc/default/locale &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    dpkg-reconfigure --frontend=nonäº¤äº’å¼ locales &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    update-locale LANG=en_US.UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Update Headers!&quot;</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg -i /packages/arm64/rga/*.deb</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg -i /packages/arm64/mpp/*.deb</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/gst-rkmpp/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gstreamer/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-base1.0/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-bad1.0/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-good1.0/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/libv4l/*.deb</span></span><br><span class="line"><span class="comment">#RUN dpkg -i /packages/arm64/gst-rkmpp/*.deb</span></span><br><span class="line"><span class="comment">#RUN dpkg -i /packages/arm64/ffmpeg/*.deb</span></span><br><span class="line"><span class="comment">#RUN dpkg -i /packages/arm64/libmali/libmali-midgard-t86x-r18p0-x11*.deb</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> find /packages/arm64/libdrm -name <span class="string">&#x27;*.deb&#x27;</span> | sudo xargs -I&#123;&#125; dpkg -x &#123;&#125; /</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;deb https://mirrors.ustc.edu.cn/debian/ bullseye main contrib non-free&quot;</span> &gt;&gt; /etc/apt/sources.list</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt install -y meson=0.56.2-1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y -f</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°é root ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> useradd -c <span class="string">&#x27;topeet user&#x27;</span> -m -d /home/topeet -s /bin/bash topeet</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;/\%sudo/ c \%sudo ALL=(ALL) NOPASSWD: ALL&#x27;</span> /etc/sudoers</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> usermod -a -G sudo topeet</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> topeet</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /home/topeet</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [ <span class="string">&quot;/bin/bash&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œé•œåƒçš„æ„å»ºï¼Œä¹‹å‰éƒ½æ„å»ºäº†ä¸€æ¬¡äº†æ‰€ä»¥è¿™æ¬¡åº”è¯¥æŒºå¿«çš„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker build -t debian10 .</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043237.png" alt="image-20231114101013852"></p>
<p>å‘ç°é—®é¢˜ï¼Œæºä¸å¤ªå¯¹äº†ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆæ”¹ä¸€ä¸‹æºï¼Œå¥½åƒä¸æ”¹ä¹Ÿå¯ä»¥ï¼Œæ˜¯æˆ‘è‡ªå·±çš„ç”µè„‘é—®é¢˜ï¼Œé‡å¯å°±å¥½äº†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deb https://mirrors.huaweicloud.com/repository/debian/ buster main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free</span><br><span class="line">deb https://mirrors.huaweicloud.com/repository/debian/ buster-updates main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free</span><br><span class="line">deb https://mirrors.huaweicloud.com/repository/debian/ buster-backports main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free</span><br><span class="line">deb https://mirrors.huaweicloud.com/repository/debian-security buster/updates main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043278.png" alt="image-20231114102245237"></p>
<p>æ„å»ºå®Œæˆå¦‚ä¸Šæ‰€ç¤ºï¼Œç„¶åæ‰“åŒ…è¯¥é•œåƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker save -o debian10.tar.gz debian10</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043250.png" alt="image-20231114102532308"></p>
<p>æœ€åæ•´ä½“æ‰“åŒ…ä¸€ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zcvf docker-rockchip-debian-buster.tar.gz docker-rockchip-debian-buster/</span><br></pre></td></tr></table></figure>



<h1 id="2-debian11-dockerfile"><a href="#2-debian11-dockerfile" class="headerlink" title="2.debian11 dockerfile"></a>2.debian11 dockerfile</h1><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:bookworm</span><br><span class="line"><span class="keyword">MAINTAINER</span> Caesar Wang <span class="string">&quot;wxt@rock-chips.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¤šæ¶æ„ç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg --add-architecture arm64</span></span><br><span class="line"><span class="comment">#RUN echo &quot;deb-src http://deb.debian.org/debian bullseye main&quot; &gt;&gt; /etc/apt/sources.list</span></span><br><span class="line"><span class="comment">#RUN echo &quot;deb-src http://deb.debian.org/debian bullseye-updates main&quot; &gt;&gt; /etc/apt/sources.list</span></span><br><span class="line"><span class="comment">#RUN echo &quot;deb-src http://security.debian.org bullseye/updates main&quot; &gt;&gt; /etc/apt/sources.list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œapt-get updateå¹¶å®‰è£…ca-certificates</span></span><br><span class="line"><span class="comment">#RUN apt-get update &amp;&amp; apt-get install -y ca-certificates</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">touch</span> /etc/apt/apt.conf.d/99verify-peer.conf &amp;&amp; <span class="built_in">echo</span> &gt;&gt;/etc/apt/apt.conf.d/99verify-peer.conf <span class="string">&quot;Acquire &#123; https::Verify-Peer false &#125;&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ sources.listæ–‡ä»¶åˆ°/etc/apt/ç›®å½•</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> sources.list /etc/apt/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y crossbuild-essential-arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ overlayç›®å½•åˆ°æ ¹ç›®å½•</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> ./overlay/  /</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y sudo locales git fakeroot devscripts cmake vim qemu-user-static:arm64 binfmt-support \</span></span><br><span class="line"><span class="language-bash">        dh-make dh-exec pkg-kde-tools device-tree-compiler:arm64 bc cpio parted dosfstools mtools libssl-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        g++-aarch64-linux-gnu dpkg-dev meson debhelper pkgconf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 libdrm</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 xorg-server</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y gstreamer1.0-plugins-bad:arm64 gstreamer1.0-plugins-base:arm64 gstreamer1.0-tools:arm64 \</span></span><br><span class="line"><span class="language-bash">        gstreamer1.0-alsa:arm64 gstreamer1.0-plugins-base-apps:arm64 qtmultimedia5-examples:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…rgaæ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libdrm-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…gstreamer-rockchipæ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libx11-dev:arm64 libdrm-dev:arm64 libgstreamer1.0-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        libgstreamer-plugins-base1.0-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libmaliæ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libstdc++6:arm64 libgbm-dev:arm64 libdrm-dev:arm64 libx11-xcb1:arm64 libxcb-dri2-0:arm64 libxdamage1:arm64 \</span></span><br><span class="line"><span class="language-bash">        libxext6:arm64 libwayland-client0:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…drm-cursoræ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libgbm-dev:arm64 libegl1-mesa-dev:arm64 libgles2-mesa-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…glmark2æ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y debhelper-compat libjpeg-dev:arm64 libpng-dev:arm64 libudev-dev:arm64  libxcb1-dev:arm64 python3 wayland-protocols libwayland-dev libwayland-bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…rktoolkitæ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="comment">#RUN apt install -y libmad-ocaml-dev libmad0-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…lib4l2æ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="comment">#RUN apt update -y</span></span><br><span class="line"><span class="comment">#RUN apt build-dep -y libv4l-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆen_US.UTF-8æœ¬åœ°åŒ–</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> locale-gen en_US.UTF-8</span></span><br><span class="line"><span class="keyword">ENV</span> LANG en_US.UTF-<span class="number">8</span></span><br><span class="line"><span class="keyword">ENV</span> LANGUAGE en_US:en</span><br><span class="line"><span class="keyword">ENV</span> LC_ALL en_US.UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;s/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/&#x27;</span> /etc/locale.gen &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&#x27;LANG=&quot;en_US.UTF-8&quot;&#x27;</span>&gt;/etc/default/locale &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    dpkg-reconfigure --frontend=noninteractive locales &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    update-locale LANG=en_US.UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Update Headers!&quot;</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg -i /packages/arm64/rga/*.deb</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg -i /packages/arm64/mpp/*.deb</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/gst-rkmpp/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gstreamer/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-base1.0/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-bad1.0/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-good1.0/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/libv4l/*.deb</span></span><br><span class="line"><span class="comment">#RUN dpkg -i /packages/arm64/gst-rkmpp/*.deb</span></span><br><span class="line"><span class="comment">#RUN dpkg -i /packages/arm64/ffmpeg/*.deb</span></span><br><span class="line"><span class="comment">#RUN dpkg -i /packages/arm64/libmali/libmali-midgard-t86x-r18p0-x11*.deb</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> find /packages/arm64/libdrm -name <span class="string">&#x27;*.deb&#x27;</span> | sudo xargs -I&#123;&#125; dpkg -x &#123;&#125; /</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y -f</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°é root ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> useradd -c <span class="string">&#x27;topeet user&#x27;</span> -m -d /home/topeet -s /bin/bash topeet</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;/\%sudo/ c \%sudo ALL=(ALL) NOPASSWD: ALL&#x27;</span> /etc/sudoers</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> usermod -a -G sudo topeet</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> topeet</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /home/topeet</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [ <span class="string">&quot;/bin/bash&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œé•œåƒçš„æ„å»ºï¼Œä¹‹å‰éƒ½æ„å»ºäº†ä¸€æ¬¡äº†æ‰€ä»¥è¿™æ¬¡åº”è¯¥æŒºå¿«çš„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker build -t debian11 .</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043356.png" alt="image-20231114103043179"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043290.png" alt="image-20231114103238803"></p>
<p>æ„å»ºå®Œæˆå¦‚ä¸Šæ‰€ç¤ºï¼Œç„¶åæ‰“åŒ…è¯¥é•œåƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker save -o debian11.tar.gz debian11</span><br></pre></td></tr></table></figure>

<p>æœ€åæ•´ä½“æ‰“åŒ…ä¸€ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zcvf docker-rockchip-debian-bullseye.tar.gz docker-rockchip-debian-bullseye</span><br></pre></td></tr></table></figure>



<h1 id="3-debian12-dockerfile"><a href="#3-debian12-dockerfile" class="headerlink" title="3.debian12 dockerfile"></a>3.debian12 dockerfile</h1><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨Debian bookwormä½œä¸ºåŸºç¡€é•œåƒ</span></span><br><span class="line"><span class="keyword">FROM</span> debian:bookworm</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®é•œåƒçš„ç»´æŠ¤è€…ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> Caesar Wang <span class="string">&quot;wxt@rock-chips.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ arm64æ¶æ„æ”¯æŒ</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg --add-architecture arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®aptï¼Œç¦ç”¨HTTPSçš„è¯ä¹¦éªŒè¯</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">touch</span> /etc/apt/apt.conf.d/99verify-peer.conf &amp;&amp; <span class="built_in">echo</span> &gt;&gt;/etc/apt/apt.conf.d/99verify-peer.conf <span class="string">&quot;Acquire &#123; https::Verify-Peer false &#125;&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ è‡ªå®šä¹‰çš„sources.listæ–‡ä»¶åˆ°å®¹å™¨çš„/etc/apt/ç›®å½•</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> sources.list /etc/apt/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°aptæºå¹¶å®‰è£…crossbuild-essential-arm64è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y crossbuild-essential-arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å½“å‰ç›®å½•ä¸‹çš„overlayç›®å½•æ·»åŠ åˆ°é•œåƒçš„æ ¹ç›®å½•</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> ./overlay/  /</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºè¿‡ç¨‹ä¸­éœ€è¦çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt install -fy sudo locales git fakeroot devscripts cmake vim qemu-user-static:arm64 binfmt-support \</span></span><br><span class="line"><span class="language-bash">        dh-make dh-exec device-tree-compiler:arm64 bc:arm64 cpio:arm64 parted dosfstools:arm64 mtools:arm64 libssl-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        g++-aarch64-linux-gnu dpkg-dev:arm64 meson:arm64 debhelper:arm64 pkgconf:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºlibdrmåº“æ‰€éœ€çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 libdrm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºxorg-serveræ‰€éœ€çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 xorg-server</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…GStreamerç›¸å…³çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y gstreamer1.0-plugins-bad:arm64 gstreamer1.0-plugins-base:arm64 gstreamer1.0-tools:arm64 \</span></span><br><span class="line"><span class="language-bash">        gstreamer1.0-alsa:arm64 gstreamer1.0-plugins-base-apps:arm64 qtmultimedia5-examples:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libdrm-devä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libdrm-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libx11-devã€libdrm-devã€libgstreamer1.0-devã€libgstreamer-plugins-base1.0-devç­‰ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libx11-dev:arm64 libdrm-dev:arm64 libgstreamer1.0-dev:arm64 libgstreamer-plugins-base1.0-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        libgstreamer-plugins-base1.0-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libstdc++6ã€libgbm-devã€libdrm-devã€libx11-xcb1ã€libxcb-dri2-0ã€libxdamage1ã€libxext6ã€libwayland-client0ç­‰ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libstdc++6:arm64 libgbm-dev:arm64 libdrm-dev:arm64 libx11-xcb1:arm64 libxcb-dri2-0:arm64 libxdamage1:arm64 \</span></span><br><span class="line"><span class="language-bash">        libxext6:arm64 libwayland-client0:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libgbm-devã€libegl1-mesa-devã€libgles2-mesa-devä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libgbm-dev:arm64 libegl1-mesa-dev:arm64 libgles2-mesa-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…debhelper-compatã€libjpeg-devã€libpng-devã€libudev-devã€libxcb1-devã€python3ã€wayland-protocolsã€libwayland-devã€libwayland-binç­‰ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y debhelper-compat libjpeg-dev:arm64 libpng-dev:arm64 libudev-dev:arm64  libxcb1-dev:arm64 python3 wayland-protocols libwayland-dev libwayland-bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºwestonæ‰€éœ€çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt build-dep -y weston:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆå¹¶è®¾ç½®ç³»ç»Ÿçš„localeä¸ºen_US.UTF-8</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> locale-gen en_US.UTF-8</span></span><br><span class="line"><span class="keyword">ENV</span> LANG en_US.UTF-<span class="number">8</span></span><br><span class="line"><span class="keyword">ENV</span> LANGUAGE en_US:en</span><br><span class="line"><span class="keyword">ENV</span> LC_ALL en_US.UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹locale.genæ–‡ä»¶å¹¶é‡æ–°é…ç½®localesï¼Œæ›´æ–°localeè®¾ç½®</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;s/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/&#x27;</span> /etc/locale.gen &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&#x27;LANG=&quot;en_US.UTF-8&quot;&#x27;</span>&gt;/etc/default/locale &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    dpkg-reconfigure --frontend=noninteractive locales &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    update-locale LANG=en_US.UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°æ—¥å¿—ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Update Headers!&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…rga2è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg -i /packages/arm64/rga2/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…mppè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg -i /packages/arm64/mpp/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…gst-rkmppè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/gst-rkmpp/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…gst-plugins-base1.0è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-base1.0/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libv4lè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/libv4l/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹libdrmè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> find /packages/arm64/libdrm -name <span class="string">&#x27;*.deb&#x27;</span> | sudo xargs -I&#123;&#125; dpkg -x &#123;&#125; /</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°aptæºå¹¶å®‰è£…ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y -f</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°é root ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> useradd -c <span class="string">&#x27;topeet user&#x27;</span> -m -d /home/topeet -s /bin/bash topeet</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;/\%sudo/ c \%sudo ALL=(ALL) NOPASSWD: ALL&#x27;</span> /etc/sudoers</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> usermod -a -G sudo topeet</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> topeet</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /home/topeet</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [ <span class="string">&quot;/bin/bash&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œé•œåƒçš„æ„å»ºï¼Œä¹‹å‰éƒ½æ„å»ºäº†ä¸€æ¬¡äº†æ‰€ä»¥è¿™æ¬¡åº”è¯¥æŒºå¿«çš„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker build -t debian12 .</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043237.png" alt="image-20231114101013852"></p>
<p>æ„å»ºå®Œæˆå¦‚ä¸Šæ‰€ç¤ºï¼Œç„¶åæ‰“åŒ…è¯¥é•œåƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker save -o debian12.tar.gz debian12</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043250.png" alt="image-20231114102532308"></p>
<p>æœ€åæ•´ä½“æ‰“åŒ…ä¸€ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zcvf docker-rockchip-debian-bookworm.tar.gz docker-rockchip-debian-bookworm</span><br></pre></td></tr></table></figure>

<h1 id="4-ubuntu20-dockerfile"><a href="#4-ubuntu20-dockerfile" class="headerlink" title="4.ubuntu20 dockerfile"></a>4.ubuntu20 dockerfile</h1><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> arm64v8/ubuntu:<span class="number">20.04</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¤šæ¶æ„ç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg --add-architecture arm64</span></span><br><span class="line"><span class="comment"># è¿è¡Œapt-get updateå¹¶å®‰è£…ca-certificates</span></span><br><span class="line"><span class="comment">#RUN apt-get update &amp;&amp; apt-get install -y ca-certificates</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">touch</span> /etc/apt/apt.conf.d/99verify-peer.conf &amp;&amp; <span class="built_in">echo</span> &gt;&gt;/etc/apt/apt.conf.d/99verify-peer.conf <span class="string">&quot;Acquire &#123; https::Verify-Peer false &#125;&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ sources.listæ–‡ä»¶åˆ°/etc/apt/ç›®å½•</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> sources.list /etc/apt/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y crossbuild-essential-arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ overlayç›®å½•åˆ°æ ¹ç›®å½•</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> ./overlay/  /</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y sudo locales git fakeroot devscripts cmake vim qemu-user-static:arm64 binfmt-support \</span></span><br><span class="line"><span class="language-bash">        dh-make dh-exec pkg-kde-tools device-tree-compiler:arm64 bc cpio parted dosfstools mtools libssl-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        g++-aarch64-linux-gnu dpkg-dev meson debhelper pkgconf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 libdrm</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 xorg-server</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y gstreamer1.0-plugins-bad:arm64 gstreamer1.0-plugins-base:arm64 gstreamer1.0-tools:arm64 \</span></span><br><span class="line"><span class="language-bash">        gstreamer1.0-alsa:arm64 gstreamer1.0-plugins-base-apps:arm64 qtmultimedia5-examples:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…rgaæ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libdrm-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…gstreamer-rockchipæ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libx11-dev:arm64 libdrm-dev:arm64 libgstreamer1.0-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        libgstreamer-plugins-base1.0-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libmaliæ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libstdc++6:arm64 libgbm-dev:arm64 libdrm-dev:arm64 libx11-xcb1:arm64 libxcb-dri2-0:arm64 libxdamage1:arm64 \</span></span><br><span class="line"><span class="language-bash">        libxext6:arm64 libwayland-client0:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…drm-cursoræ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libgbm-dev:arm64 libegl1-mesa-dev:arm64 libgles2-mesa-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…glmark2æ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y debhelper-compat libjpeg-dev:arm64 libpng-dev:arm64 libudev-dev:arm64  libxcb1-dev:arm64 python3 wayland-protocols libwayland-dev libwayland-bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…rktoolkitæ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="comment">#RUN apt install -y libmad-ocaml-dev libmad0-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…lib4l2æ‰€éœ€çš„ä¾èµ–é¡¹</span></span><br><span class="line"><span class="comment">#RUN apt update -y</span></span><br><span class="line"><span class="comment">#RUN apt build-dep -y libv4l-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆen_US.UTF-8æœ¬åœ°åŒ–</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> locale-gen en_US.UTF-8</span></span><br><span class="line"><span class="keyword">ENV</span> LANG en_US.UTF-<span class="number">8</span></span><br><span class="line"><span class="keyword">ENV</span> LANGUAGE en_US:en</span><br><span class="line"><span class="keyword">ENV</span> LC_ALL en_US.UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;s/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/&#x27;</span> /etc/locale.gen &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&#x27;LANG=&quot;en_US.UTF-8&quot;&#x27;</span>&gt;/etc/default/locale &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    dpkg-reconfigure --frontend=noninteractive locales &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    update-locale LANG=en_US.UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Update Headers!&quot;</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/rga/*.deb</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/mpp/*.deb</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/gst-rkmpp/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gstreamer/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-base1.0/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-bad1.0/*.deb</span></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-good1.0/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#RUN apt-get install -fy --allow-downgrades /packages/arm64/libv4l/*.deb</span></span><br><span class="line"><span class="comment">#RUN dpkg -i /packages/arm64/gst-rkmpp/*.deb</span></span><br><span class="line"><span class="comment">#RUN dpkg -i /packages/arm64/ffmpeg/*.deb</span></span><br><span class="line"><span class="comment">#RUN dpkg -i /packages/arm64/libmali/libmali-midgard-t86x-r18p0-x11*.deb</span></span><br><span class="line"><span class="comment">#RUN find /packages/arm64/libdrm -name &#x27;*.deb&#x27; | sudo xargs -I&#123;&#125; dpkg -x &#123;&#125; /</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y -f</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°é root ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> useradd -c <span class="string">&#x27;topeet user&#x27;</span> -m -d /home/topeet -s /bin/bash topeet</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;/\%sudo/ c \%sudo ALL=(ALL) NOPASSWD: ALL&#x27;</span> /etc/sudoers</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> usermod -a -G sudo topeet</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> topeet</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /home/topeet</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [ <span class="string">&quot;/bin/bash&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œé•œåƒçš„æ„å»ºï¼Œä¹‹å‰éƒ½æ„å»ºäº†ä¸€æ¬¡äº†æ‰€ä»¥è¿™æ¬¡åº”è¯¥æŒºå¿«çš„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker build -t debian11 .</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043356.png" alt="image-20231114103043179"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043290.png" alt="image-20231114103238803"></p>
<p>æ„å»ºå®Œæˆå¦‚ä¸Šæ‰€ç¤ºï¼Œç„¶åæ‰“åŒ…è¯¥é•œåƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker save -o ubuntu20.tar.gz ubuntu20</span><br></pre></td></tr></table></figure>

<h1 id="5-ubuntu22-dockerfile"><a href="#5-ubuntu22-dockerfile" class="headerlink" title="5.ubuntu22 dockerfile"></a>5.ubuntu22 dockerfile</h1><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> arm64v8/ubuntu:<span class="number">22.04</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ arm64æ¶æ„æ”¯æŒ</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg --add-architecture arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®aptï¼Œç¦ç”¨HTTPSçš„è¯ä¹¦éªŒè¯</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">touch</span> /etc/apt/apt.conf.d/99verify-peer.conf &amp;&amp; <span class="built_in">echo</span> &gt;&gt;/etc/apt/apt.conf.d/99verify-peer.conf <span class="string">&quot;Acquire &#123; https::Verify-Peer false &#125;&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ è‡ªå®šä¹‰çš„sources.listæ–‡ä»¶åˆ°å®¹å™¨çš„/etc/apt/ç›®å½•</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> sources.list /etc/apt/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°aptæºå¹¶å®‰è£…crossbuild-essential-arm64è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y crossbuild-essential-arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å½“å‰ç›®å½•ä¸‹çš„overlayç›®å½•æ·»åŠ åˆ°é•œåƒçš„æ ¹ç›®å½•</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> ./overlay/  /</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºè¿‡ç¨‹ä¸­éœ€è¦çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt install -fy sudo locales git fakeroot devscripts cmake vim qemu-user-static:arm64 binfmt-support \</span></span><br><span class="line"><span class="language-bash">        dh-make dh-exec device-tree-compiler:arm64 bc:arm64 cpio:arm64 parted dosfstools:arm64 mtools:arm64 libssl-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        g++-aarch64-linux-gnu dpkg-dev:arm64 meson:arm64 debhelper:arm64 pkgconf:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºlibdrmåº“æ‰€éœ€çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 libdrm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºxorg-serveræ‰€éœ€çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get build-dep -y -a arm64 xorg-server</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…GStreamerç›¸å…³çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y gstreamer1.0-plugins-bad:arm64 gstreamer1.0-plugins-base:arm64 gstreamer1.0-tools:arm64 \</span></span><br><span class="line"><span class="language-bash">        gstreamer1.0-alsa:arm64 gstreamer1.0-plugins-base-apps:arm64 qtmultimedia5-examples:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libdrm-devä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libdrm-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libx11-devã€libdrm-devã€libgstreamer1.0-devã€libgstreamer-plugins-base1.0-devç­‰ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libx11-dev:arm64 libdrm-dev:arm64 libgstreamer1.0-dev:arm64 libgstreamer-plugins-base1.0-dev:arm64 \</span></span><br><span class="line"><span class="language-bash">        libgstreamer-plugins-base1.0-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libstdc++6ã€libgbm-devã€libdrm-devã€libx11-xcb1ã€libxcb-dri2-0ã€libxdamage1ã€libxext6ã€libwayland-client0ç­‰ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libstdc++6:arm64 libgbm-dev:arm64 libdrm-dev:arm64 libx11-xcb1:arm64 libxcb-dri2-0:arm64 libxdamage1:arm64 \</span></span><br><span class="line"><span class="language-bash">        libxext6:arm64 libwayland-client0:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libgbm-devã€libegl1-mesa-devã€libgles2-mesa-devä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get install -y libgbm-dev:arm64 libegl1-mesa-dev:arm64 libgles2-mesa-dev:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…debhelper-compatã€libjpeg-devã€libpng-devã€libudev-devã€libxcb1-devã€python3ã€wayland-protocolsã€libwayland-devã€libwayland-binç­‰ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y debhelper-compat libjpeg-dev:arm64 libpng-dev:arm64 libudev-dev:arm64  libxcb1-dev:arm64 python3 wayland-protocols libwayland-dev libwayland-bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ„å»ºwestonæ‰€éœ€çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt build-dep -y weston:arm64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆå¹¶è®¾ç½®ç³»ç»Ÿçš„localeä¸ºen_US.UTF-8</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> locale-gen en_US.UTF-8</span></span><br><span class="line"><span class="keyword">ENV</span> LANG en_US.UTF-<span class="number">8</span></span><br><span class="line"><span class="keyword">ENV</span> LANGUAGE en_US:en</span><br><span class="line"><span class="keyword">ENV</span> LC_ALL en_US.UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹locale.genæ–‡ä»¶å¹¶é‡æ–°é…ç½®localesï¼Œæ›´æ–°localeè®¾ç½®</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;s/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/&#x27;</span> /etc/locale.gen &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&#x27;LANG=&quot;en_US.UTF-8&quot;&#x27;</span>&gt;/etc/default/locale &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    dpkg-reconfigure --frontend=noninteractive locales &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    update-locale LANG=en_US.UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°æ—¥å¿—ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Update Headers!&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…rga2è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg -i /packages/arm64/rga2/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…mppè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg -i /packages/arm64/mpp/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…gst-rkmppè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -fy --allow-downgrades /packages/arm64/gst-rkmpp/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…gst-plugins-base1.0è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="comment"># RUN apt-get install -fy --allow-downgrades /packages/arm64/gst-plugins-base1.0/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libv4lè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="comment"># RUN apt-get install -fy --allow-downgrades /packages/arm64/libv4l/*.deb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹libdrmè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="comment"># RUN find /packages/arm64/libdrm -name &#x27;*.deb&#x27; | sudo xargs -I&#123;&#125; dpkg -x &#123;&#125; /</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°aptæºå¹¶å®‰è£…ä¾èµ–åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y -f</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°é root ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> useradd -c <span class="string">&#x27;topeet user&#x27;</span> -m -d /home/topeet -s /bin/bash topeet</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i -e <span class="string">&#x27;/\%sudo/ c \%sudo ALL=(ALL) NOPASSWD: ALL&#x27;</span> /etc/sudoers</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> usermod -a -G sudo topeet</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> topeet</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /home/topeet</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [ <span class="string">&quot;/bin/bash&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œé•œåƒçš„æ„å»ºï¼Œä¹‹å‰éƒ½æ„å»ºäº†ä¸€æ¬¡äº†æ‰€ä»¥è¿™æ¬¡åº”è¯¥æŒºå¿«çš„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker build -t debian12 .</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043237.png" alt="image-20231114101013852"></p>
<p>æ„å»ºå®Œæˆå¦‚ä¸Šæ‰€ç¤ºï¼Œç„¶åæ‰“åŒ…è¯¥é•œåƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker save -o ubuntu22.tar.gz ubuntu22</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043250.png" alt="image-20231114102532308"></p>
<h1 id="6-ç»§ç»­æ„å»º"><a href="#6-ç»§ç»­æ„å»º" class="headerlink" title="6.ç»§ç»­æ„å»º"></a>6.ç»§ç»­æ„å»º</h1><p>dockeræå®Œäº†ï¼Œç„¶åç»§ç»­ædebåŒ…çš„æ„å»ºã€‚å…ˆä½¿ç”¨debian10 æ„å»ºxserverçš„ï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --privileged -it -v /home/topeet/Linux/xorg-xserver:/home/topeet/ubuntu20_build debian10</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043305.png" alt="image-20231114125740932"></p>
<p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»ºdebåŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo DEB_BUILD_OPTIONS=nocheck dpkg-buildpackage -rfakeroot -b -d -uc -us -aarm64</span><br></pre></td></tr></table></figure>

<p>æ„å»ºæˆåŠŸäº†ï¼Œä½†æ˜¯æˆ‘ç›®å‰ä»æ—§ä¸çŸ¥é“å…·ä½“çš„åŒºåˆ«æ‰€åœ¨ã€‚</p>
<p>X server æ˜¯ä¸€ç§å®ç°å›¾å½¢ç”¨æˆ·ç•Œé¢çš„æœåŠ¡å™¨è½¯ä»¶ï¼Œå®ƒå…è®¸å›¾å½¢åº”ç”¨ç¨‹åºåœ¨è®¡ç®—æœºä¸Šè¿è¡Œå¹¶ä¸æ˜¾ç¤ºè®¾å¤‡äº¤äº’ã€‚â€œglamorâ€ æ˜¯ X server ä¸­çš„ä¸€ä¸ªåŠ é€Ÿæ¶æ„ï¼Œå®ƒæä¾›äº†å¯¹OpenGL ES 2.0çš„æ”¯æŒï¼Œå¯ä»¥åŠ é€Ÿå›¾å½¢æ¸²æŸ“ã€‚â€œrgaâ€ æ˜¯ä¸€ç§åŸºäº Arm Mali GPU çš„å›¾å½¢åŠ é€Ÿå™¨ï¼Œå¯ä»¥æé«˜å›¾å½¢æ¸²æŸ“æ€§èƒ½ã€‚â€œexaâ€ æ˜¯ X server çš„ä¸€ä¸ªå›¾å½¢åŠ é€Ÿæ¶æ„ï¼Œå¯ä»¥æé«˜ 2D å›¾å½¢æ“ä½œçš„æ€§èƒ½ã€‚å› æ­¤ï¼Œâ€œX server with glamor hacks for gles2 and rga based exaâ€ æ„å‘³ç€æŸç§é’ˆå¯¹ OpenGL ES 2.0ã€rga å›¾å½¢åŠ é€Ÿå’Œ exa å›¾å½¢åŠ é€Ÿçš„ X server çš„æ”¹è¿›ç‰ˆæœ¬æˆ–é…ç½®ã€‚è¿™å¯èƒ½æ˜¯ä¸€ç§ä¼˜åŒ–åçš„ X serverï¼Œå¯ä»¥æä¾›æ›´å¥½çš„å›¾å½¢æ¸²æŸ“æ€§èƒ½å’ŒåŠŸèƒ½ã€‚</p>
<h1 id="7-æµ‹è¯•xserver"><a href="#7-æµ‹è¯•xserver" class="headerlink" title="7.æµ‹è¯•xserver"></a>7.æµ‹è¯•xserver</h1><p>æµ‹è¯•çš„çµæ„Ÿæ¥è‡ªè¿™ä¸ªcsdn <a href="https://blog.csdn.net/Neutionwei/article/details/111411023">https://blog.csdn.net/Neutionwei/article/details/111411023</a></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043592.png" alt="image-20231114135548345"></p>
<p>æˆ‘å…ˆæ¥å‡ ä¸ªç–‘é—®ï¼Ÿ</p>
<p><strong>1.ä»€ä¹ˆæ˜¯glamor</strong>ï¼Ÿ</p>
<p>Glamor æ˜¯ä¸€ä¸ªç”¨äºåŠ é€Ÿ 2D å›¾å½¢æ¸²æŸ“çš„å¼€æºåº“å’ŒæŠ€æœ¯ã€‚å®ƒæœ€åˆæ˜¯ä¸º X.Org æœåŠ¡å™¨å¼€å‘çš„ï¼Œæ—¨åœ¨æä¾›æ›´é«˜æ•ˆçš„å›¾å½¢æ¸²æŸ“æ–¹å¼ã€‚Glamor çš„ç›®æ ‡æ˜¯é€šè¿‡åˆ©ç”¨ç°ä»£å›¾å½¢ç¡¬ä»¶çš„èƒ½åŠ›ï¼Œæä¾›å¿«é€Ÿå’Œé«˜æ•ˆçš„å›¾å½¢æ¸²æŸ“ï¼Œä»è€Œæ”¹å–„ç”¨æˆ·ç•Œé¢çš„æ€§èƒ½å’Œå“åº”èƒ½åŠ›ã€‚</p>
<p>ä¼ ç»Ÿä¸Šï¼ŒX.Org æœåŠ¡å™¨ä½¿ç”¨è½¯ä»¶æ¸²æŸ“æ¥å¤„ç†å›¾å½¢æ“ä½œï¼Œè¿™å¯¹äºå¤æ‚çš„å›¾å½¢å’ŒåŠ¨ç”»æ•ˆæœå¯èƒ½æ•ˆç‡è¾ƒä½ã€‚Glamor çš„å‡ºç°è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå®ƒåˆ©ç”¨äº†ç°ä»£å›¾å½¢ç¡¬ä»¶ä¸­çš„ 2D åŠ é€ŸåŠŸèƒ½ï¼Œä»è€Œåœ¨æ”¯æŒç¡¬ä»¶åŠ é€Ÿçš„ç³»ç»Ÿä¸Šæä¾›æ›´å¿«çš„å›¾å½¢æ¸²æŸ“æ€§èƒ½ã€‚</p>
<p>Glamor çš„å·¥ä½œåŸç†æ˜¯å°†é«˜çº§çš„ 2D å›¾å½¢æ“ä½œè½¬æ¢ä¸ºåº•å±‚çš„å›¾å½¢åŠ é€Ÿæ¥å£è°ƒç”¨ï¼Œå¦‚ OpenGL æˆ– Vulkanã€‚å®ƒé€šè¿‡å°†å›¾å½¢æ“ä½œè½¬å‘ç»™åº•å±‚ç¡¬ä»¶åŠ é€Ÿæ¥å£ï¼Œåˆ©ç”¨ GPU å¼ºå¤§çš„å¹¶è¡Œå¤„ç†èƒ½åŠ›æ¥åŠ é€Ÿå›¾å½¢æ¸²æŸ“ã€‚è¿™ç§æ–¹å¼æ¯”ä¼ ç»Ÿçš„è½¯ä»¶æ¸²æŸ“æ›´é«˜æ•ˆï¼Œå¯ä»¥æ˜¾è‘—æå‡å›¾å½¢æ¸²æŸ“çš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚</p>
<p>Glamor æä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥æ–¹ä¾¿åœ°åœ¨æ”¯æŒ Glamor çš„ç³»ç»Ÿä¸Šä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„å›¾å½¢æ¸²æŸ“ã€‚å®ƒå¯ä»¥ä¸å¤šç§å›¾å½¢åº“å’Œçª—å£ç³»ç»Ÿé›†æˆï¼Œå¦‚ Xlibã€Wayland å’Œ DirectFBã€‚å¼€å‘è€…å¯ä»¥ä½¿ç”¨ Glamor æä¾›çš„ API æ¥ç»˜åˆ¶å›¾å½¢ï¼Œè€Œæ— éœ€ç›´æ¥æ“ä½œåº•å±‚çš„ç¡¬ä»¶åŠ é€Ÿæ¥å£ã€‚</p>
<p><strong>2.ä¸Šé¢æåˆ°äº†glamoræ˜¯ä¸€ä¸ªç¡¬ä»¶åŠ é€ŸæŠ€æœ¯ï¼Œé‚£åœ¨rk3568ä¸Šæˆ‘è¦å¦‚ä½•å®ç°glamorç¡¬ä»¶åŠ é€Ÿå‘¢ï¼Ÿ</strong></p>
<p>ç¡®è®¤ç¡¬ä»¶æ”¯æŒï¼šé¦–å…ˆï¼Œç¡®ä¿ RK3568 å¹³å°çš„å›¾å½¢ç¡¬ä»¶æ”¯æŒç¡¬ä»¶åŠ é€Ÿã€‚RK3568 æ˜¯ä¸€æ¬¾æ­è½½äº† Mali-G52 GPU çš„èŠ¯ç‰‡ï¼ŒMali-G52 æ˜¯ä¸€æ¬¾æ”¯æŒ OpenGL ESã€Vulkan å’Œ OpenCL ç­‰æ ‡å‡†çš„å›¾å½¢å¤„ç†å™¨ã€‚ä½ éœ€è¦ç¡®ä¿è¯¥èŠ¯ç‰‡åœ¨ Linux ç³»ç»Ÿä¸Šçš„é©±åŠ¨ç¨‹åºæ­£ç¡®å®‰è£…å’Œé…ç½®ï¼Œå¹¶æ”¯æŒç¡¬ä»¶åŠ é€ŸåŠŸèƒ½ã€‚</p>
<p>å®‰è£…ç›¸å…³è½¯ä»¶ï¼šä¸ºäº†ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿï¼Œä½ éœ€è¦å®‰è£…æ”¯æŒ Glamor çš„å›¾å½¢åº“å’Œé©±åŠ¨ç¨‹åºã€‚é€šå¸¸ï¼Œè¿™åŒ…æ‹¬ Mesa 3D å›¾å½¢åº“ã€X.Org æœåŠ¡å™¨å’Œç›¸åº”çš„ DRM&#x2F;KMS é©±åŠ¨ç¨‹åºã€‚ä½ å¯ä»¥æ ¹æ®å…·ä½“çš„ Linux å‘è¡Œç‰ˆå’Œç³»ç»Ÿé…ç½®ï¼Œä½¿ç”¨åŒ…ç®¡ç†å™¨æ¥å®‰è£…è¿™äº›è½¯ä»¶åŒ…ã€‚</p>
<p>é…ç½® X.Org æœåŠ¡å™¨ï¼šGlamor æ˜¯ä¸º X.Org æœåŠ¡å™¨è®¾è®¡çš„ï¼Œå› æ­¤ä½ éœ€è¦é…ç½® X.Org æœåŠ¡å™¨ä»¥å¯ç”¨ Glamorã€‚ä½ å¯ä»¥ç¼–è¾‘ X.Org æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ <code>/etc/X11/xorg.conf</code> æˆ– <code>/etc/X11/xorg.conf.d/</code> ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼‰ï¼Œæ·»åŠ æˆ–ä¿®æ”¹ç›¸å…³çš„é…ç½®é€‰é¡¹æ¥å¯ç”¨ Glamorã€‚å…·ä½“çš„é…ç½®é€‰é¡¹å¯èƒ½ä¼šå› ä¸åŒçš„ç³»ç»Ÿå’Œé©±åŠ¨ç¨‹åºè€Œæœ‰æ‰€å·®å¼‚ï¼Œä½ å¯ä»¥å‚è€ƒç›¸å…³æ–‡æ¡£æˆ–å®˜æ–¹æŒ‡å—æ¥äº†è§£å¦‚ä½•æ­£ç¡®é…ç½® Glamorã€‚</p>
<p>æµ‹è¯•å’ŒéªŒè¯ï¼šå®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªç®€å•çš„æµ‹è¯•ç¨‹åºæ¥éªŒè¯ç¡¬ä»¶åŠ é€Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œã€‚ä½ å¯ä»¥ä½¿ç”¨ OpenGL æˆ– Vulkan ç­‰å›¾å½¢åº“æ¥è¿›è¡Œç»˜å›¾æ“ä½œï¼Œå¹¶é€šè¿‡æ€§èƒ½æµ‹è¯•æˆ–å…¶ä»–æŒ‡æ ‡æ¥è¯„ä¼°å›¾å½¢æ¸²æŸ“æ€§èƒ½çš„æå‡ã€‚ä½ ä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨ Glamor æä¾›çš„ API æ¥è¿›è¡Œå›¾å½¢ç»˜åˆ¶ï¼Œä»¥éªŒè¯ Glamor çš„åŠŸèƒ½å’Œæ€§èƒ½ã€‚</p>
<p><strong>3.é‚£æˆ‘ç”¨é»˜è®¤çš„ubuntuè½¯ä»¶åŒ…å’Œ Mali-G52é©±åŠ¨èƒ½æ­£å¸¸ä½¿ç”¨glamorå—ï¼Ÿ</strong></p>
<p>åœ¨ä½¿ç”¨é»˜è®¤çš„ Ubuntu è½¯ä»¶åŒ…å’Œ Mali-G52 é©±åŠ¨æ—¶ï¼Œä½¿ç”¨ Glamor åº”è¯¥æ˜¯å¯è¡Œçš„ã€‚Ubuntu æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„ Linux å‘è¡Œç‰ˆï¼Œå®ƒé€šå¸¸åŒ…å«äº† Mesa 3D å›¾å½¢åº“å’Œ X.Org æœåŠ¡å™¨ç­‰ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶å¯¹äºä½¿ç”¨ Glamor æ˜¯å¿…è¦çš„ã€‚</p>
<p>Mali-G52 æ˜¯ ARM å…¬å¸çš„å›¾å½¢å¤„ç†å™¨ï¼Œå®ƒåœ¨ Linux ç³»ç»Ÿä¸Šæœ‰å¯¹åº”çš„ DRM&#x2F;KMS é©±åŠ¨ç¨‹åºï¼Œç”¨äºä¸ X.Org æœåŠ¡å™¨å’Œå›¾å½¢åº“è¿›è¡Œäº¤äº’ã€‚è¿™äº›é©±åŠ¨ç¨‹åºé€šå¸¸ä¼šéšç€æ“ä½œç³»ç»Ÿçš„æ›´æ–°å’Œå‘å¸ƒè€Œæ›´æ–°ï¼Œä»¥ç¡®ä¿å…¼å®¹æ€§å’Œæ€§èƒ½ä¼˜åŒ–ã€‚</p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå½“ä½ ä½¿ç”¨é»˜è®¤çš„ Ubuntu è½¯ä»¶åŒ…å’Œ Mali-G52 é©±åŠ¨æ—¶ï¼ŒGlamor åº”è¯¥å·²ç»é¢„å…ˆé…ç½®å¹¶å¯ç”¨äº†ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç›´æ¥é€šè¿‡ X.Org æœåŠ¡å™¨å’Œç›¸å…³å›¾å½¢åº“ï¼ˆå¦‚ OpenGLï¼‰æ¥è¿›è¡Œå›¾å½¢æ¸²æŸ“ï¼Œè€Œæ— éœ€é¢å¤–çš„é…ç½®æ­¥éª¤ã€‚</p>
<p><strong>4.ä½†æˆ‘çœ‹ç‘èŠ¯å¾®å·²ç»å¯¹drm xserverç­‰è½¯ä»¶åŒ…è¿›è¡Œäº†é­”æ”¹ï¼Œè¿™æ˜¯ä¸ºå•¥å‘¢ï¼Ÿ</strong></p>
<p>ç‘èŠ¯å¾®å¯¹ DRMï¼ˆDirect Rendering Managerï¼‰å’Œ X.Org æœåŠ¡å™¨ç­‰è½¯ä»¶åŒ…è¿›è¡Œé­”æ”¹çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½åœ°é€‚é…å’Œä¼˜åŒ–ä»–ä»¬çš„èŠ¯ç‰‡å’Œç¡¬ä»¶ã€‚è¿™ç§é­”æ”¹é€šå¸¸æ˜¯ä¸ºäº†è§£å†³ç‰¹å®šçš„ç¡¬ä»¶åŠŸèƒ½ã€æ€§èƒ½æˆ–å…¼å®¹æ€§é—®é¢˜ï¼Œå¹¶ç¡®ä¿åœ¨ç‰¹å®šçš„ç‘èŠ¯å¾®å¹³å°ä¸Šèƒ½å¤Ÿè·å¾—æœ€ä½³çš„å›¾å½¢æ¸²æŸ“æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½çš„åŸå› å’ŒåŠ¨æœºï¼š</p>
<ol>
<li>ç¡¬ä»¶ä¼˜åŒ–ï¼šç‘èŠ¯å¾®å¯èƒ½ä¼šå¯¹ DRM å’Œ X.Org æœåŠ¡å™¨è¿›è¡Œä¿®æ”¹ï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°åˆ©ç”¨ä»–ä»¬çš„èŠ¯ç‰‡ä¸­çš„ç¡¬ä»¶åŠ é€ŸåŠŸèƒ½ã€‚é€šè¿‡ç›´æ¥è®¿é—®ç¡¬ä»¶ç‰¹æ€§å’ŒåŠŸèƒ½ï¼Œä»–ä»¬å¯ä»¥å®ç°æ›´é«˜æ•ˆçš„å›¾å½¢æ¸²æŸ“å’Œå¤„ç†ï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½å’Œå“åº”èƒ½åŠ›ã€‚</li>
<li>å…¼å®¹æ€§å’Œç¨³å®šæ€§ï¼šç‘èŠ¯å¾®å¯èƒ½ä¼šå¯¹è½¯ä»¶åŒ…è¿›è¡Œä¿®æ”¹ï¼Œä»¥ç¡®ä¿å…¶ä¸ä»–ä»¬çš„èŠ¯ç‰‡å’Œç¡¬ä»¶ä¹‹é—´çš„å…¼å®¹æ€§ã€‚è¿™å¯èƒ½æ¶‰åŠå¯¹é©±åŠ¨ç¨‹åºçš„ä¿®æ”¹ã€å‚æ•°çš„è°ƒæ•´æˆ–ç‰¹å®šç¡¬ä»¶åŠŸèƒ½çš„æ”¯æŒã€‚é€šè¿‡è¿™äº›ä¿®æ”¹ï¼Œä»–ä»¬å¯ä»¥æä¾›æ›´ç¨³å®šå’Œå¯é çš„å›¾å½¢æ¸²æŸ“ç¯å¢ƒï¼Œå‡å°‘ä¸ç¡¬ä»¶ç›¸å…³çš„é—®é¢˜å’Œå…¼å®¹æ€§å†²çªã€‚</li>
<li>å®šåˆ¶åŒ–éœ€æ±‚ï¼šç‘èŠ¯å¾®çš„å®¢æˆ·å¯èƒ½æœ‰ç‰¹å®šçš„éœ€æ±‚ï¼Œéœ€è¦å®šåˆ¶åŒ–çš„å›¾å½¢æ¸²æŸ“è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡å¯¹è½¯ä»¶åŒ…è¿›è¡Œé­”æ”¹ï¼Œä»–ä»¬å¯ä»¥æ»¡è¶³å®¢æˆ·çš„å®šåˆ¶éœ€æ±‚ï¼Œæä¾›é’ˆå¯¹ç‰¹å®šåº”ç”¨åœºæ™¯å’Œç¡¬ä»¶å¹³å°çš„ä¼˜åŒ–å’Œå®šåˆ¶åŒ–åŠŸèƒ½ã€‚</li>
</ol>
<p>æµ‹è¯•ç¨‹åºå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;X11/Xlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawRectangleWithGlamor</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height, <span class="type">int</span> drawCount)</span> </span>&#123;</span><br><span class="line">    Display* display = <span class="built_in">XOpenDisplay</span>(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (display == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;æ— æ³•æ‰“å¼€ X æœåŠ¡å™¨è¿æ¥&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Window rootWindow = <span class="built_in">DefaultRootWindow</span>(display);</span><br><span class="line">    Window window = <span class="built_in">XCreateSimpleWindow</span>(display, rootWindow, <span class="number">0</span>, <span class="number">0</span>, width, height, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">XSelectInput</span>(display, window, StructureNotifyMask);</span><br><span class="line">    <span class="built_in">XMapWindow</span>(display, window);</span><br><span class="line">    XEvent event;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="built_in">XNextEvent</span>(display, &amp;event);</span><br><span class="line">    &#125; <span class="keyword">while</span> (event.type != MapNotify);</span><br><span class="line"></span><br><span class="line">    GC gc = <span class="built_in">XCreateGC</span>(display, window, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> startTime = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; drawCount; ++i) &#123;</span><br><span class="line">        <span class="built_in">XSetForeground</span>(display, gc, <span class="built_in">WhitePixel</span>(display, <span class="built_in">DefaultScreen</span>(display)));</span><br><span class="line">        <span class="built_in">XFillRectangle</span>(display, window, gc, <span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">        <span class="built_in">XFlush</span>(display);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> endTime = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line">    <span class="type">double</span> drawTime = std::chrono::<span class="built_in">duration</span>&lt;<span class="type">double</span>, std::milli&gt;(endTime - startTime).<span class="built_in">count</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> drawRate = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(drawCount) / (drawTime / <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">XFreeGC</span>(display, gc);</span><br><span class="line">    <span class="built_in">XDestroyWindow</span>(display, window);</span><br><span class="line">    <span class="built_in">XCloseDisplay</span>(display);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; width &lt;&lt; <span class="string">&quot;x&quot;</span> &lt;&lt; height &lt;&lt; <span class="string">&quot;å¤§å°çš„çŸ©å½¢ï¼ˆä½¿ç”¨ glamorï¼‰ï¼š&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; drawCount &lt;&lt; <span class="string">&quot;æ¬¡ç»˜åˆ¶ï¼Œæ¯æ¬¡ç»˜åˆ¶è€—æ—¶&quot;</span> &lt;&lt; drawTime / drawCount &lt;&lt; <span class="string">&quot;æ¯«ç§’ï¼Œæ¯ç§’ç»˜åˆ¶æ¬¡æ•°ä¸º&quot;</span> &lt;&lt; drawRate &lt;&lt; <span class="string">&quot;æ¬¡ã€‚&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawRectangleWithoutGlamor</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height, <span class="type">int</span> drawCount)</span> </span>&#123;</span><br><span class="line">    Display* display = <span class="built_in">XOpenDisplay</span>(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (display == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;æ— æ³•æ‰“å¼€ X æœåŠ¡å™¨è¿æ¥&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Window rootWindow = <span class="built_in">DefaultRootWindow</span>(display);</span><br><span class="line">    Window window = <span class="built_in">XCreateSimpleWindow</span>(display, rootWindow, <span class="number">0</span>, <span class="number">0</span>, width, height, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">XSelectInput</span>(display, window, StructureNotifyMask);</span><br><span class="line">    <span class="built_in">XMapWindow</span>(display, window);</span><br><span class="line">    XEvent event;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="built_in">XNextEvent</span>(display, &amp;event);</span><br><span class="line">    &#125; <span class="keyword">while</span> (event.type != MapNotify);</span><br><span class="line"></span><br><span class="line">    GC gc = <span class="built_in">XCreateGC</span>(display, window, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> startTime = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; drawCount; ++i) &#123;</span><br><span class="line">        <span class="built_in">XSetForeground</span>(display, gc, <span class="built_in">WhitePixel</span>(display, <span class="built_in">DefaultScreen</span>(display)));</span><br><span class="line">        <span class="built_in">XDrawRectangle</span>(display, window, gc, <span class="number">0</span>, <span class="number">0</span>, width - <span class="number">1</span>, height - <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">XFillRectangle</span>(display, window, gc, <span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">        <span class="built_in">XFlush</span>(display);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> endTime = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line">    <span class="type">double</span> drawTime = std::chrono::<span class="built_in">duration</span>&lt;<span class="type">double</span>, std::milli&gt;(endTime - startTime).<span class="built_in">count</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> drawRate = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(drawCount) / (drawTime / <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">XFreeGC</span>(display, gc);</span><br><span class="line">    <span class="built_in">XDestroyWindow</span>(display, window);</span><br><span class="line">    <span class="built_in">XCloseDisplay</span>(display);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; width &lt;&lt; <span class="string">&quot;x&quot;</span> &lt;&lt; height &lt;&lt; <span class="string">&quot;å¤§å°çš„çŸ©å½¢ï¼ˆä¸ä½¿ç”¨ glamorï¼‰ï¼š&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; drawCount &lt;&lt; <span class="string">&quot;æ¬¡ç»˜åˆ¶ï¼Œæ¯æ¬¡ç»˜åˆ¶è€—æ—¶&quot;</span> &lt;&lt; drawTime / drawCount &lt;&lt; <span class="string">&quot;æ¯«ç§’ï¼Œæ¯ç§’ç»˜åˆ¶æ¬¡æ•°ä¸º&quot;</span> &lt;&lt; drawRate &lt;&lt; <span class="string">&quot;æ¬¡ã€‚&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawRectangle</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height, <span class="type">int</span> drawCount, <span class="type">bool</span> useGlamor)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (useGlamor) &#123;</span><br><span class="line">        <span class="built_in">drawRectangleWithGlamor</span>(width, height, drawCount);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">drawRectangleWithoutGlamor</span>(width, height, drawCount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸ä½¿ç”¨ glamor çš„æµ‹è¯•</span></span><br><span class="line">    <span class="built_in">drawRectangle</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">50000</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">drawRectangle</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">50000</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">drawRectangle</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">50000</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">drawRectangle</span>(<span class="number">500</span>, <span class="number">500</span>, <span class="number">50000</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ glamor çš„æµ‹è¯•</span></span><br><span class="line">    <span class="built_in">drawRectangle</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">50000</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="built_in">drawRectangle</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">50000</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="built_in">drawRectangle</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">50000</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="built_in">drawRectangle</span>(<span class="number">500</span>, <span class="number">500</span>, <span class="number">50000</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">g++ test.cpp -o test -lX11</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043661.png" alt="image-20231114140810933"></p>
<p>ç„¶åè¿è¡Œæµ‹è¯•ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043817.png"></p>
<p>å¾—å‡ºçš„ç»“è®ºå¦‚ä¸‹æ‰€ç¤ºï¼šä½¿ç”¨åŠ é€Ÿï¼ˆglamorï¼‰ï¼š</p>
<ul>
<li>å¯¹äº1x1ã€10x10ã€100x100å’Œ500x500å¤§å°çš„çŸ©å½¢ï¼Œæ¯æ¬¡ç»˜åˆ¶çš„è€—æ—¶éƒ½åœ¨0.0057æ¯«ç§’åˆ°0.0061æ¯«ç§’ä¹‹é—´ã€‚</li>
<li>æ¯ç§’ç»˜åˆ¶æ¬¡æ•°åœ¨162242åˆ°175190ä¹‹é—´ã€‚</li>
</ul>
<p>ä¸ä½¿ç”¨åŠ é€Ÿï¼š</p>
<ul>
<li>å¯¹äº1x1ã€10x10ã€100x100å’Œ500x500å¤§å°çš„çŸ©å½¢ï¼Œæ¯æ¬¡ç»˜åˆ¶çš„è€—æ—¶åœ¨0.0028æ¯«ç§’åˆ°0.0087æ¯«ç§’ä¹‹é—´ã€‚</li>
<li>æ¯ç§’ç»˜åˆ¶æ¬¡æ•°åœ¨114430åˆ°357260ä¹‹é—´ã€‚</li>
</ul>
<p>ä»è¿™äº›æ•°æ®ä¸­å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨åŠ é€Ÿï¼ˆglamorï¼‰ç›¸å¯¹äºä¸ä½¿ç”¨åŠ é€Ÿï¼Œç»˜åˆ¶çŸ©å½¢çš„è€—æ—¶æ›´ç¨³å®šä¸”æ›´å¿«ã€‚è€Œä¸ä½¿ç”¨åŠ é€Ÿçš„æƒ…å†µä¸‹ï¼Œç»˜åˆ¶è€—æ—¶æœ‰è¾ƒå¤§çš„æ³¢åŠ¨ï¼Œå¹¶ä¸”éšç€çŸ©å½¢å¤§å°çš„å¢åŠ ï¼Œç»˜åˆ¶æ¬¡æ•°å‘ˆç°ä¸åŒç¨‹åº¦çš„ä¸‹é™ã€‚</p>
<p>æ€»ä½“è€Œè¨€ï¼Œä½¿ç”¨åŠ é€Ÿï¼ˆglamorï¼‰å¯ä»¥æä¾›æ›´ç¨³å®šå’Œé«˜æ•ˆçš„ç»˜åˆ¶æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†è¾ƒå¤§å°ºå¯¸çš„çŸ©å½¢æ—¶ã€‚ç„¶è€Œï¼Œè¦æ³¨æ„è¿™äº›ç»“è®ºä»…åŸºäºä½ æä¾›çš„æ•°æ®ï¼Œå…·ä½“çš„æ€§èƒ½å·®å¼‚å¯èƒ½ä¼šå› ä¸åŒçš„ç¯å¢ƒå’Œé…ç½®è€Œæœ‰æ‰€å˜åŒ–ã€‚</p>
<p>ä¸Šé¢æ˜¯é€šè¿‡ç¨‹åºæµ‹è¯•çš„ï¼Œä¹Ÿæœ‰ä¸€ä¸ªä¸“é—¨çš„å‘½ä»¤è¡Œè¿›è¡ŒæŸ¥çœ‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /var/log/Xorg.0.log | grep glamor</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043734.png" alt="image-20231114145330988"></p>
<p>æ˜¾ç¤ºâ€œglamor initializedâ€ï¼Œåˆ™è¡¨ç¤ºå·²å¯ç”¨åŠ é€Ÿã€‚</p>
<h1 id="8-æµ‹è¯•opencl"><a href="#8-æµ‹è¯•opencl" class="headerlink" title="8.æµ‹è¯•opencl"></a>8.æµ‹è¯•opencl</h1><p>æ‰“å°åŸºç¡€ä¿¡æ¯</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> CL_TARGET_OPENCL_VERSION 220</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;CL/cl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span> <span class="comment">// ä½¿ç”¨æ ‡å‡†åº“å‡½æ•°éœ€åŒ…å«è¯¥å¤´æ–‡ä»¶</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cl_platform_id *platform;</span><br><span class="line">    cl_uint num_platform;</span><br><span class="line">    cl_int err;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¹³å°æ•°é‡</span></span><br><span class="line">    err = <span class="built_in">clGetPlatformIDs</span>(<span class="number">0</span>, <span class="literal">NULL</span>, &amp;num_platform);</span><br><span class="line">    <span class="keyword">if</span> (err != CL_SUCCESS) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;æ— æ³•è·å–å¹³å°æ•°é‡\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> err;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    platform = (cl_platform_id *)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(cl_platform_id) * num_platform);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¹³å°ID</span></span><br><span class="line">    err = <span class="built_in">clGetPlatformIDs</span>(num_platform, platform, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (err != CL_SUCCESS) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;æ— æ³•è·å–å¹³å°ID\n&quot;</span>);</span><br><span class="line">        <span class="built_in">free</span>(platform);</span><br><span class="line">        <span class="keyword">return</span> err;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num_platform; i++) &#123;</span><br><span class="line">        <span class="type">size_t</span> size;</span><br><span class="line">        <span class="type">char</span> *name, *vendor, *version, *profile, *extensions;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¹³å°åç§°</span></span><br><span class="line">        err = <span class="built_in">clGetPlatformInfo</span>(platform[i], CL_PLATFORM_NAME, <span class="number">0</span>, <span class="literal">NULL</span>, &amp;size);</span><br><span class="line">        name = (<span class="type">char</span> *)<span class="built_in">malloc</span>(size);</span><br><span class="line">        err = <span class="built_in">clGetPlatformInfo</span>(platform[i], CL_PLATFORM_NAME, size, name, <span class="literal">NULL</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;CL_PLATFORM_NAME: %s\n&quot;</span>, name);</span><br><span class="line">        <span class="built_in">free</span>(name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¹³å°ä¾›åº”å•†</span></span><br><span class="line">        err = <span class="built_in">clGetPlatformInfo</span>(platform[i], CL_PLATFORM_VENDOR, <span class="number">0</span>, <span class="literal">NULL</span>, &amp;size);</span><br><span class="line">        vendor = (<span class="type">char</span> *)<span class="built_in">malloc</span>(size);</span><br><span class="line">        err = <span class="built_in">clGetPlatformInfo</span>(platform[i], CL_PLATFORM_VENDOR, size, vendor, <span class="literal">NULL</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;CL_PLATFORM_VENDOR: %s\n&quot;</span>, vendor);</span><br><span class="line">        <span class="built_in">free</span>(vendor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¹³å°ç‰ˆæœ¬</span></span><br><span class="line">        err = <span class="built_in">clGetPlatformInfo</span>(platform[i], CL_PLATFORM_VERSION, <span class="number">0</span>, <span class="literal">NULL</span>, &amp;size);</span><br><span class="line">        version = (<span class="type">char</span> *)<span class="built_in">malloc</span>(size);</span><br><span class="line">        err = <span class="built_in">clGetPlatformInfo</span>(platform[i], CL_PLATFORM_VERSION, size, version, <span class="literal">NULL</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;CL_PLATFORM_VERSION: %s\n&quot;</span>, version);</span><br><span class="line">        <span class="built_in">free</span>(version);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¹³å°é…ç½®æ–‡ä»¶</span></span><br><span class="line">        err = <span class="built_in">clGetPlatformInfo</span>(platform[i], CL_PLATFORM_PROFILE, <span class="number">0</span>, <span class="literal">NULL</span>, &amp;size);</span><br><span class="line">        profile = (<span class="type">char</span> *)<span class="built_in">malloc</span>(size);</span><br><span class="line">        err = <span class="built_in">clGetPlatformInfo</span>(platform[i], CL_PLATFORM_PROFILE, size, profile, <span class="literal">NULL</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;CL_PLATFORM_PROFILE: %s\n&quot;</span>, profile);</span><br><span class="line">        <span class="built_in">free</span>(profile);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¹³å°æ‰©å±•</span></span><br><span class="line">        err = <span class="built_in">clGetPlatformInfo</span>(platform[i], CL_PLATFORM_EXTENSIONS, <span class="number">0</span>, <span class="literal">NULL</span>, &amp;size);</span><br><span class="line">        extensions = (<span class="type">char</span> *)<span class="built_in">malloc</span>(size);</span><br><span class="line">        err = <span class="built_in">clGetPlatformInfo</span>(platform[i], CL_PLATFORM_EXTENSIONS, size, extensions, <span class="literal">NULL</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;CL_PLATFORM_EXTENSIONS: %s\n&quot;</span>, extensions);</span><br><span class="line">        <span class="built_in">free</span>(extensions);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(platform);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gcc opencl.cpp -o opencl_test -lmali -L/usr/lib/aarch64-linux-gnu/  -I/usr/include/CL/</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œâ€œ<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142043741.png" alt="image-20231114160309270"></p>
<p>ç„¶åä½¿ç”¨clinfoå‘½ä»¤ä¹Ÿå¯ä»¥æ‰“å°openclçš„ä¿¡æ¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@topeet:/home/topeet$ clinfo</span><br><span class="line">Number of platforms                               1</span><br><span class="line">  Platform Name                                   ARM Platform</span><br><span class="line">  Platform Vendor                                 ARM</span><br><span class="line">  Platform Version                                OpenCL 2.1 v1.g6p0-01eac0.efb75e2978d783a80fe78be1bfb0efc1</span><br><span class="line">  Platform Profile                                FULL_PROFILE</span><br><span class="line">  Platform Extensions                             cl_khr_global_int32_base_atomics cl_khr_global_int32_extended_atomics cl_khr_local_int32_base_atomics cl_khr_local_int32_extended_atomics cl_khr_byte_addressable_store cl_khr_3d_image_writes cl_khr_int64_base_atomics cl_khr_int64_extended_atomics cl_khr_fp16 cl_khr_icd cl_khr_egl_image cl_khr_image2d_from_buffer cl_khr_depth_images cl_khr_subgroups cl_khr_subgroup_extended_types cl_khr_subgroup_non_uniform_vote cl_khr_subgroup_ballot cl_khr_il_program cl_khr_priority_hints cl_khr_create_command_queue cl_khr_spirv_no_integer_wrap_decoration cl_khr_extended_versioning cl_khr_device_uuid cl_arm_core_id cl_arm_printf cl_arm_non_uniform_work_group_size cl_arm_import_memory cl_arm_import_memory_dma_buf cl_arm_import_memory_host cl_arm_integer_dot_product_int8 cl_arm_integer_dot_product_accumulate_int8 cl_arm_integer_dot_product_accumulate_saturate_int8 cl_arm_scheduling_controls cl_arm_controlled_kernel_termination cl_ext_cxx_for_opencl</span><br><span class="line">  Platform Extensions function suffix             ARM</span><br><span class="line">  Platform Host timer resolution                  1ns</span><br><span class="line"></span><br><span class="line">  Platform Name                                   ARM Platform</span><br><span class="line">Number of devices                                 1</span><br><span class="line">arm_release_ver of this libmali is &#x27;g6p0-01eac0&#x27;, rk_so_ver is &#x27;5&#x27;.</span><br><span class="line">  Device Name                                     Mali-LODX r0p0</span><br><span class="line">  Device Vendor                                   ARM</span><br><span class="line">  Device Vendor ID                                0xa8670000</span><br><span class="line">  Device Version                                  OpenCL 2.1 v1.g6p0-01eac0.efb75e2978d783a80fe78be1bfb0efc1</span><br><span class="line">  Device UUID                                     000067a8-0100-0000-0000-000000000000</span><br><span class="line">  Driver UUID                                     d9495bef-ea91-7c52-8a43-8a3c2f7b49cc</span><br><span class="line">  Valid Device LUID                               No</span><br><span class="line">  Device LUID                                     0000-000000000000</span><br><span class="line">  Device Node Mask                                0</span><br><span class="line">  Device Numeric Version                          0x801000 (2.1.0)</span><br><span class="line">  Driver Version                                  2.1</span><br><span class="line">  Device OpenCL C Version                         OpenCL C 2.0 v1.g6p0-01eac0.efb75e2978d783a80fe78be1bfb0efc1</span><br><span class="line">  Device C++ for OpenCL Numeric Version           0x400000 (1.0.0)</span><br><span class="line">  Device Type                                     GPU</span><br><span class="line">  Device Profile                                  FULL_PROFILE</span><br><span class="line">  Device Available                                Yes</span><br><span class="line">  Compiler Available                              Yes</span><br><span class="line">  Linker Available                                Yes</span><br><span class="line">  Max compute units                               4</span><br><span class="line">  Available core IDs                              0, 2, 16, 18</span><br><span class="line">  Max clock frequency                             1000MHz</span><br><span class="line">  Device Partition                                (core)</span><br><span class="line">    Max number of sub-devices                     0</span><br><span class="line">    Supported partition types                     None</span><br><span class="line">    Supported affinity domains                    (n/a)</span><br><span class="line">  Max work item dimensions                        3</span><br><span class="line">  Max work item sizes                             1024x1024x1024</span><br><span class="line">  Max work group size                             1024</span><br><span class="line">  Preferred work group size multiple (kernel)     16</span><br></pre></td></tr></table></figure>

<p>clpeakæµ‹è¯•ï¼Œè¿™ä¸ªæºé‡Œé¢æ˜¯æ²¡æœ‰çš„ï¼Œæ‰€ä»¥éœ€è¦å…ˆgit</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/krrishnarraj/clpeak</span><br><span class="line">mkdir clpeak/build</span><br><span class="line">cd clpeak/build</span><br><span class="line">cmake ..</span><br><span class="line">make -j$(nproc)</span><br><span class="line">./clpeak</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">oot@topeet:/home/topeet/clpeak/build$ ./clpeak</span><br><span class="line"></span><br><span class="line">Platform: ARM Platform</span><br><span class="line">arm_release_ver of this libmali is &#x27;g6p0-01eac0&#x27;, rk_so_ver is &#x27;5&#x27;.</span><br><span class="line">  Device: Mali-LODX r0p0</span><br><span class="line">    Driver version  : 2.1 (Linux ARM64)</span><br><span class="line">    Compute units   : 4</span><br><span class="line">    Clock frequency : 1000 MHz</span><br><span class="line"></span><br><span class="line">    Global memory bandwidth (GBPS)</span><br><span class="line">      float   : 23.15</span><br><span class="line">      float2  : 24.43</span><br><span class="line">      float4  : 25.12</span><br><span class="line">      float8  : 12.74</span><br><span class="line">      float16 : 12.29</span><br><span class="line"></span><br><span class="line">    Single-precision compute (GFLOPS)</span><br><span class="line">      float   : 439.08</span><br><span class="line">      float2  : 467.79</span><br><span class="line">      float4  : 463.03</span><br><span class="line">      float8  : 432.98</span><br><span class="line">      float16 : 408.58</span><br><span class="line"></span><br><span class="line">    Half-precision compute (GFLOPS)</span><br><span class="line">      half   : 439.79</span><br><span class="line">      half2  : 867.20</span><br><span class="line">      half4  : 898.12</span><br><span class="line">      half8  : 875.33</span><br><span class="line">      half16 : 835.56</span><br><span class="line"></span><br><span class="line">    No double precision support! Skipped</span><br><span class="line"></span><br><span class="line">    Integer compute (GIOPS)</span><br><span class="line">      int   : 124.79</span><br><span class="line">      int2  : 125.28</span><br><span class="line">      int4  : 124.83</span><br><span class="line">      int8  : 123.36</span><br><span class="line">      int16 : 123.81</span><br><span class="line"></span><br><span class="line">    Integer compute Fast 24bit (GIOPS)</span><br><span class="line">      int   : 124.67</span><br><span class="line">      int2  : 125.32</span><br><span class="line">      int4  : 124.79</span><br><span class="line">      int8  : 123.36</span><br><span class="line">      int16 : 123.82</span><br><span class="line"></span><br><span class="line">    Transfer bandwidth (GBPS)</span><br><span class="line">      enqueueWriteBuffer              : 2.73</span><br><span class="line">      enqueueReadBuffer               : 7.82</span><br><span class="line">      enqueueWriteBuffer non-blocking : 7.26</span><br><span class="line">      enqueueReadBuffer non-blocking  : 8.16</span><br><span class="line">      enqueueMapBuffer(for read)      : 60.05</span><br><span class="line">        memcpy from mapped ptr        : 9.09</span><br><span class="line">      enqueueUnmap(after write)       : 56.96</span><br><span class="line">        memcpy to mapped ptr          : 8.79</span><br><span class="line"></span><br><span class="line">    Kernel launch latency : 40.79 us</span><br><span class="line"></span><br><span class="line">root@topeet:/home/topeet/clpeak/build$</span><br></pre></td></tr></table></figure>



<p>è¿™ä¸ªè¾“å‡ºæ˜¾ç¤ºäº†åœ¨ ARM å¹³å°ä¸Šçš„ OpenCL æ€§èƒ½æµ‹è¯•ç»“æœã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒæä¾›äº†ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>å¹³å°ä¿¡æ¯ï¼šARM å¹³å°ã€‚</li>
<li>è®¾å¤‡ä¿¡æ¯ï¼šMali-LODX r0p0 è®¾å¤‡ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š<ul>
<li>é©±åŠ¨ç‰ˆæœ¬ï¼š2.1 (Linux ARM64)ã€‚</li>
<li>è®¡ç®—å•å…ƒæ•°é‡ï¼š4ã€‚</li>
<li>æ—¶é’Ÿé¢‘ç‡ï¼š1000 MHzã€‚</li>
</ul>
</li>
</ul>
<p>ç„¶åï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—æ€§èƒ½æŒ‡æ ‡ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>å…¨å±€å†…å­˜å¸¦å®½ï¼ˆå•ä½ï¼šGBPSï¼‰ï¼šæµ®ç‚¹æ•°è¿ç®—çš„å¸¦å®½ã€‚<ul>
<li><code>float</code>ï¼š23.15 GBPS</li>
<li><code>float2</code>ï¼š24.43 GBPS</li>
<li><code>float4</code>ï¼š25.12 GBPS</li>
<li><code>float8</code>ï¼š12.74 GBPS</li>
<li><code>float16</code>ï¼š12.29 GBPS</li>
</ul>
</li>
<li>å•ç²¾åº¦æµ®ç‚¹æ•°è®¡ç®—æ€§èƒ½ï¼ˆå•ä½ï¼šGFLOPSï¼‰ï¼š<ul>
<li><code>float</code>ï¼š439.08 GFLOPS</li>
<li><code>float2</code>ï¼š467.79 GFLOPS</li>
<li><code>float4</code>ï¼š463.03 GFLOPS</li>
<li><code>float8</code>ï¼š432.98 GFLOPS</li>
<li><code>float16</code>ï¼š408.58 GFLOPS</li>
</ul>
</li>
<li>åŠç²¾åº¦æµ®ç‚¹æ•°è®¡ç®—æ€§èƒ½ï¼ˆå•ä½ï¼šGFLOPSï¼‰ï¼š<ul>
<li><code>half</code>ï¼š439.79 GFLOPS</li>
<li><code>half2</code>ï¼š867.20 GFLOPS</li>
<li><code>half4</code>ï¼š898.12 GFLOPS</li>
<li><code>half8</code>ï¼š875.33 GFLOPS</li>
<li><code>half16</code>ï¼š835.56 GFLOPS</li>
</ul>
</li>
<li>ä¸æ”¯æŒåŒç²¾åº¦æµ®ç‚¹æ•°è®¡ç®—ã€‚</li>
<li>æ•´æ•°è®¡ç®—æ€§èƒ½ï¼ˆå•ä½ï¼šGIOPSï¼‰ï¼š<ul>
<li><code>int</code>ï¼š124.79 GIOPS</li>
<li><code>int2</code>ï¼š125.28 GIOPS</li>
<li><code>int4</code>ï¼š124.83 GIOPS</li>
<li><code>int8</code>ï¼š123.36 GIOPS</li>
<li><code>int16</code>ï¼š123.81 GIOPS</li>
</ul>
</li>
<li>å¿«é€Ÿ 24 ä½æ•´æ•°è®¡ç®—æ€§èƒ½ï¼ˆå•ä½ï¼šGIOPSï¼‰ï¼š<ul>
<li><code>int</code>ï¼š124.67 GIOPS</li>
<li><code>int2</code>ï¼š125.32 GIOPS</li>
<li><code>int4</code>ï¼š124.79 GIOPS</li>
<li><code>int8</code>ï¼š123.36 GIOPS</li>
<li><code>int16</code>ï¼š123.82 GIOPS</li>
</ul>
</li>
<li>ä¼ è¾“å¸¦å®½ï¼ˆå•ä½ï¼šGBPSï¼‰ï¼šä¸åŒç±»å‹çš„å†…å­˜ä¼ è¾“æ“ä½œçš„å¸¦å®½ã€‚<ul>
<li><code>enqueueWriteBuffer</code>ï¼š2.73 GBPS</li>
<li><code>enqueueReadBuffer</code>ï¼š7.82 GBPS</li>
<li><code>enqueueWriteBuffer non-blocking</code>ï¼š7.26 GBPS</li>
<li><code>enqueueReadBuffer non-blocking</code>ï¼š8.16 GBPS</li>
<li><code>enqueueMapBuffer(for read)</code>ï¼š60.05 GBPS</li>
<li><code>memcpy from mapped ptr</code>ï¼š9.09 GBPS</li>
<li><code>enqueueUnmap(after write)</code>ï¼š56.96 GBPS</li>
<li><code>memcpy to mapped ptr</code>ï¼š8.79 GBPS</li>
</ul>
</li>
<li>å†…æ ¸å¯åŠ¨å»¶è¿Ÿï¼š40.79 å¾®ç§’ã€‚</li>
</ul>
<h1 id="9-å¯¹æ¯”æµ‹è¯•ï¼ˆç¼–è¯‘ä¸€ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ubuntuï¼‰"><a href="#9-å¯¹æ¯”æµ‹è¯•ï¼ˆç¼–è¯‘ä¸€ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ubuntuï¼‰" class="headerlink" title="9.å¯¹æ¯”æµ‹è¯•ï¼ˆç¼–è¯‘ä¸€ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ubuntuï¼‰"></a>9.å¯¹æ¯”æµ‹è¯•ï¼ˆç¼–è¯‘ä¸€ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ubuntuï¼‰</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="10-openglå­¦ä¹ "><a href="#10-openglå­¦ä¹ " class="headerlink" title="10 openglå­¦ä¹ "></a>10 openglå­¦ä¹ </h1><p>å­¦ä¹ ç½‘å€ï¼š<a href="https://blog.csdn.net/XscKernel/article/details/50158329?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169996845316800211564994%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=169996845316800211564994&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-50158329-null-null.142">https://blog.csdn.net/XscKernel/article/details/50158329?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169996845316800211564994%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=169996845316800211564994&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-50158329-null-null.142</a></p>
<p>&#x3D;&#x3D;ä»€ä¹ˆæ˜¯openglï¼Ÿ&#x3D;&#x3D;</p>
<p>OpenGLï¼ˆOpen Graphics Libraryï¼‰æ˜¯ä¸€ä¸ªç”¨äºæ¸²æŸ“2Då’Œ3Då›¾å½¢çš„è·¨å¹³å°å›¾å½¢ç¼–ç¨‹æ¥å£ã€‚å®ƒæä¾›äº†ä¸€å¥—å‡½æ•°å’Œå‘½ä»¤ï¼Œç”¨äºç®¡ç†å›¾å½¢æ•°æ®ã€æ‰§è¡ŒåŸºæœ¬ç»˜å›¾æ“ä½œå’Œå®ç°é«˜çº§çš„å›¾å½¢æ•ˆæœã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€äº›å…³äºOpenGLçš„è¯¦ç»†è¯´æ˜ï¼š</p>
<ol>
<li><strong>è·¨å¹³å°æ€§</strong>: OpenGLæ˜¯è·¨å¹³å°çš„ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼ˆå¦‚Windowsã€MacOSã€Linuxï¼‰ä¸Šè¿è¡Œã€‚è¿™ä½¿å¾—å¼€å‘è€…å¯ä»¥ç¼–å†™ä¸ç‰¹å®šæ“ä½œç³»ç»Ÿæ— å…³çš„å›¾å½¢åº”ç”¨ç¨‹åºã€‚</li>
<li><strong>ç¡¬ä»¶åŠ é€Ÿ</strong>: OpenGLå¯ä»¥åˆ©ç”¨è®¡ç®—æœºä¸­çš„å›¾å½¢ç¡¬ä»¶ï¼ˆå¦‚æ˜¾å¡ï¼‰è¿›è¡Œç¡¬ä»¶åŠ é€Ÿï¼Œä»¥æé«˜å›¾å½¢æ¸²æŸ“çš„æ€§èƒ½ã€‚è¿™ä½¿å¾—OpenGLåœ¨å¤„ç†å¤æ‚çš„3Då›¾å½¢æ—¶å…·æœ‰å‡ºè‰²çš„æ€§èƒ½ã€‚</li>
<li><strong>å›¾å½¢æ¸²æŸ“ç®¡çº¿</strong>: OpenGLä½¿ç”¨å›¾å½¢æ¸²æŸ“ç®¡çº¿æ¥å¤„ç†å›¾å½¢æ•°æ®ã€‚å›¾å½¢æ¸²æŸ“ç®¡çº¿æ˜¯ä¸€ç³»åˆ—çš„å¤„ç†é˜¶æ®µï¼Œå°†è¾“å…¥çš„3Då›¾å½¢æ•°æ®è½¬æ¢ä¸ºæœ€ç»ˆåœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„2Då›¾åƒã€‚å®ƒåŒ…æ‹¬å‡ ä½•å¤„ç†ã€å…‰æ …åŒ–ã€ç€è‰²å’Œè¾“å‡ºç­‰é˜¶æ®µã€‚</li>
<li><strong>åŸºæœ¬å‡ ä½•å›¾å…ƒ</strong>: OpenGLæ”¯æŒç»˜åˆ¶åŸºæœ¬å‡ ä½•å›¾å…ƒï¼Œå¦‚ç‚¹ã€çº¿å’Œä¸‰è§’å½¢ã€‚è¿™äº›å›¾å…ƒæ„æˆäº†ç»˜åˆ¶å¤æ‚3Då¯¹è±¡çš„åŸºç¡€ã€‚</li>
<li><strong>ç€è‰²å™¨ç¼–ç¨‹</strong>: OpenGLä½¿ç”¨ç€è‰²å™¨æ¥å¤„ç†å›¾å½¢çš„é¡¶ç‚¹å’Œåƒç´ ã€‚é¡¶ç‚¹ç€è‰²å™¨è´Ÿè´£å¯¹æ¯ä¸ªé¡¶ç‚¹è¿›è¡Œå˜æ¢å’Œå¤„ç†ï¼Œè€Œåƒç´ ç€è‰²å™¨åˆ™åœ¨å…‰æ …åŒ–é˜¶æ®µå¯¹æ¯ä¸ªåƒç´ è¿›è¡Œå¤„ç†ã€‚è¿™ä½¿å¾—å¼€å‘è€…å¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰å›¾å½¢çš„å¤–è§‚å’Œæ•ˆæœã€‚</li>
<li><strong>çº¹ç†æ˜ å°„</strong>: OpenGLæ”¯æŒå°†çº¹ç†æ˜ å°„åˆ°3Dæ¨¡å‹çš„è¡¨é¢ï¼Œä»¥å®ç°æ›´åŠ çœŸå®å’Œè¯¦ç»†çš„å›¾å½¢æ•ˆæœã€‚çº¹ç†å¯ä»¥åŒ…å«å›¾åƒã€é¢œè‰²æˆ–å…¶ä»–æ•°æ®ï¼Œå¯ä»¥ç”¨äºæ¨¡æ‹Ÿæè´¨ã€æ·»åŠ ç»†èŠ‚å’Œå®ç°çº¹ç†æ˜ å°„æ•ˆæœã€‚</li>
<li><strong>å…‰ç…§å’Œé˜´å½±</strong>: OpenGLæä¾›äº†ç¯å…‰æ¨¡å‹å’Œé˜´å½±æŠ€æœ¯ï¼Œå¯ä»¥æ¨¡æ‹Ÿå…‰çš„äº¤äº’å’Œå¯¹è±¡ä¹‹é—´çš„é˜´å½±å…³ç³»ã€‚è¿™ä½¿å¾—å›¾å½¢æ›´åŠ é€¼çœŸå’ŒçœŸå®ã€‚</li>
<li><strong>æ‰©å±•å’Œç‰ˆæœ¬</strong>: OpenGLä¸æ–­å‘å±•å’Œæ›´æ–°ï¼Œå¼•å…¥æ–°çš„åŠŸèƒ½å’Œæ‰©å±•ï¼Œä»¥é€‚åº”ä¸æ–­å¢é•¿çš„å›¾å½¢éœ€æ±‚ã€‚æ¯ä¸ªOpenGLç‰ˆæœ¬éƒ½æœ‰å…¶ç‰¹å®šçš„åŠŸèƒ½å’Œæ”¯æŒçš„ç¡¬ä»¶çº§åˆ«ã€‚</li>
</ol>
<h2 id="10-1-ç¯å¢ƒæ­å»º"><a href="#10-1-ç¯å¢ƒæ­å»º" class="headerlink" title="10.1 ç¯å¢ƒæ­å»º"></a>10.1 ç¯å¢ƒæ­å»º</h2><p>å®‰è£…OpenGL Library</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install libgl1-mesa-dev</span><br></pre></td></tr></table></figure>

<p>å®‰è£…OpenGL Utilities</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install libglu1-mesa-dev</span><br></pre></td></tr></table></figure>

<p>â€ƒâ€ƒOpenGL Utilities æ˜¯ä¸€ç»„å»ºæ„äº OpenGL Library ä¹‹ä¸Šçš„å·¥å…·ç»„ï¼Œæä¾›è®¸å¤šå¾ˆæ–¹ä¾¿çš„å‡½å¼ï¼Œä½¿ OpenGL æ›´å¼ºå¤§ä¸”æ›´å®¹æ˜“ä½¿ç”¨ã€‚</p>
<p>â€ƒâ€ƒå®‰è£…OpenGL Utility Toolkit</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install freeglut3-dev</span><br></pre></td></tr></table></figure>

<p>â€ƒâ€ƒOpenGL Utility Toolkit æ˜¯å»ºç«‹åœ¨ OpenGL Utilities ä¸Šé¢çš„å·¥å…·ç®±ï¼Œé™¤äº†å¼ºåŒ–äº† OpenGL Utilities çš„ä¸è¶³ä¹‹å¤–ï¼Œä¹Ÿå¢åŠ äº† OpenGL å¯¹äºè§†çª—ä»‹é¢æ”¯æ´ã€‚</p>
<p>æµ‹è¯•ç¨‹åº</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glut.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myDisplay</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line">    glRectf(<span class="number">-0.5f</span>, <span class="number">-0.5f</span>, <span class="number">0.5f</span>, <span class="number">0.5f</span>);</span><br><span class="line">    glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    glutInit(&amp;argc, argv);</span><br><span class="line">    glutInitDisplayMode(GLUT_RGB | GLUT_SINGLE);</span><br><span class="line">    glutInitWindowPosition(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    glutInitWindowSize(<span class="number">400</span>, <span class="number">400</span>);</span><br><span class="line">    glutCreateWindow(<span class="string">&quot;the first opengL test&quot;</span>);</span><br><span class="line">    glutDisplayFunc(&amp;myDisplay);</span><br><span class="line">    glutMainLoop();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gcc -o test test.c -lGL -lGLU -lglut</span><br></pre></td></tr></table></figure>

<p>æ¼”ç¤ºæ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142139102.png" alt="image-20231114213934062"></p>
<h2 id="10-2ï¼šç”»ä¸€ä¸ªåœ†"><a href="#10-2ï¼šç”»ä¸€ä¸ªåœ†" class="headerlink" title="10.2ï¼šç”»ä¸€ä¸ªåœ†"></a>10.2ï¼šç”»ä¸€ä¸ªåœ†</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glut.h&gt;</span>  <span class="comment">// å¼•å…¥OpenGLåº“</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> n = <span class="number">20</span>;  <span class="comment">// å®šä¹‰å¤šè¾¹å½¢çš„è¾¹æ•°</span></span><br><span class="line"><span class="type">const</span> GLfloat R = <span class="number">0.5f</span>;  <span class="comment">// å¤šè¾¹å½¢çš„åŠå¾„</span></span><br><span class="line"><span class="type">const</span> GLfloat Pi = <span class="number">3.1415926536f</span>;  <span class="comment">// åœ†å‘¨ç‡Pi</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myDisplay</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    glClear(GL_COLOR_BUFFER_BIT);  <span class="comment">// æ¸…ç©ºé¢œè‰²ç¼“å†²åŒº</span></span><br><span class="line"></span><br><span class="line">    glBegin(GL_POLYGON);  <span class="comment">// å¼€å§‹ç»˜åˆ¶å¤šè¾¹å½¢</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è®¡ç®—å¤šè¾¹å½¢æ¯ä¸ªé¡¶ç‚¹çš„åæ ‡</span></span><br><span class="line">        GLfloat x = R * <span class="built_in">cos</span>(<span class="number">2</span> * Pi / n * i);</span><br><span class="line">        GLfloat y = R * <span class="built_in">sin</span>(<span class="number">2</span> * Pi / n * i);</span><br><span class="line">        glVertex2f(x, y);  <span class="comment">// æ·»åŠ é¡¶ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line">    glEnd();  <span class="comment">// ç»“æŸç»˜åˆ¶å¤šè¾¹å½¢</span></span><br><span class="line"></span><br><span class="line">    glFlush();  <span class="comment">// æ¸…ç©ºOpenGLå‘½ä»¤ç¼“å†²åŒºï¼Œå¼ºåˆ¶æ‰§è¡Œç»˜å›¾å‘½ä»¤</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    glutInit(&amp;argc, argv);  <span class="comment">// åˆå§‹åŒ–GLUTåº“</span></span><br><span class="line"></span><br><span class="line">    glutInitDisplayMode(GLUT_RGB);  <span class="comment">// è®¾ç½®æ˜¾ç¤ºæ¨¡å¼ä¸ºRGBé¢œè‰²æ¨¡å¼</span></span><br><span class="line">    glutInitWindowSize(<span class="number">400</span>, <span class="number">400</span>);  <span class="comment">// è®¾ç½®çª—å£å¤§å°</span></span><br><span class="line">    glutCreateWindow(<span class="string">&quot;OpenGL Polygon&quot;</span>);  <span class="comment">// åˆ›å»ºçª—å£ï¼Œå¹¶è®¾ç½®æ ‡é¢˜ä¸º &quot;OpenGL Polygon&quot;</span></span><br><span class="line"></span><br><span class="line">    glutDisplayFunc(myDisplay);  <span class="comment">// æ³¨å†Œæ˜¾ç¤ºå›è°ƒå‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    glutMainLoop();  <span class="comment">// è¿›å…¥ä¸»å¾ªç¯ï¼Œå¼€å§‹äº‹ä»¶å¤„ç†</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gcc -o test test.c -lGL -lGLU -lglut</span><br></pre></td></tr></table></figure>



<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142142229.png" alt="image-20231114214250208"></p>
<h2 id="10-3-ç”»ä¸€ä¸ªäº”è§’æ˜Ÿ"><a href="#10-3-ç”»ä¸€ä¸ªäº”è§’æ˜Ÿ" class="headerlink" title="10.3 ç”»ä¸€ä¸ªäº”è§’æ˜Ÿ"></a>10.3 ç”»ä¸€ä¸ªäº”è§’æ˜Ÿ</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glut.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> GLfloat Pi = <span class="number">3.1415926536f</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myDisplay</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// è®¡ç®—äº”è§’æ˜Ÿçš„ç›¸å…³åæ ‡</span></span><br><span class="line">    GLfloat a = <span class="number">1</span> / (<span class="number">2</span> - <span class="number">2</span> * <span class="built_in">cos</span>(<span class="number">72</span> * Pi / <span class="number">180</span>));</span><br><span class="line">    GLfloat bx = a * <span class="built_in">cos</span>(<span class="number">18</span> * Pi / <span class="number">180</span>);</span><br><span class="line">    GLfloat by = a * <span class="built_in">sin</span>(<span class="number">18</span> * Pi / <span class="number">180</span>);</span><br><span class="line">    GLfloat cy = -a * <span class="built_in">cos</span>(<span class="number">18</span> * Pi / <span class="number">180</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰äº”ä¸ªé¡¶ç‚¹çš„åæ ‡</span></span><br><span class="line">    GLfloat PointA[<span class="number">2</span>] = &#123;<span class="number">0</span>, a&#125;;</span><br><span class="line">    GLfloat PointB[<span class="number">2</span>] = &#123;bx, by&#125;;</span><br><span class="line">    GLfloat PointC[<span class="number">2</span>] = &#123;<span class="number">0.5</span>, cy&#125;;</span><br><span class="line">    GLfloat PointD[<span class="number">2</span>] = &#123;<span class="number">-0.5</span>, cy&#125;;</span><br><span class="line">    GLfloat PointE[<span class="number">2</span>] = &#123;-bx, by&#125;;</span><br><span class="line"></span><br><span class="line">    glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒ‰ç…§A-&gt;C-&gt;E-&gt;B-&gt;D-&gt;Açš„é¡ºåºï¼Œç»˜åˆ¶äº”è§’æ˜Ÿ</span></span><br><span class="line">    glBegin(GL_LINE_LOOP);</span><br><span class="line">    glVertex2fv(PointA);</span><br><span class="line">    glVertex2fv(PointC);</span><br><span class="line">    glVertex2fv(PointE);</span><br><span class="line">    glVertex2fv(PointB);</span><br><span class="line">    glVertex2fv(PointD);</span><br><span class="line">    glEnd();</span><br><span class="line"></span><br><span class="line">    glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    glutInit(&amp;argc, argv);</span><br><span class="line">    glutInitDisplayMode(GLUT_RGB);</span><br><span class="line">    glutInitWindowSize(<span class="number">400</span>, <span class="number">400</span>);</span><br><span class="line">    glutCreateWindow(<span class="string">&quot;OpenGL Star&quot;</span>);</span><br><span class="line"></span><br><span class="line">    glutDisplayFunc(myDisplay);</span><br><span class="line"></span><br><span class="line">    glutMainLoop();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gcc -o test test.c -lm -lGL -lGLU -lglut</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142146381.png" alt="image-20231114214602345"></p>
<h2 id="10-4-ç”»ä¸€ä¸ªæ­£å¼¦"><a href="#10-4-ç”»ä¸€ä¸ªæ­£å¼¦" class="headerlink" title="10.4 ç”»ä¸€ä¸ªæ­£å¼¦"></a>10.4 ç”»ä¸€ä¸ªæ­£å¼¦</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glut.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> GLfloat factor = <span class="number">0.1f</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myDisplay</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    GLfloat x;</span><br><span class="line"></span><br><span class="line">    glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»˜åˆ¶åæ ‡è½´</span></span><br><span class="line">    glBegin(GL_LINES);</span><br><span class="line">    glVertex2f(<span class="number">-1.0f</span>, <span class="number">0.0f</span>); <span class="comment">// xè½´èµ·ç‚¹</span></span><br><span class="line">    glVertex2f(<span class="number">1.0f</span>, <span class="number">0.0f</span>);  <span class="comment">// xè½´ç»ˆç‚¹</span></span><br><span class="line">    glVertex2f(<span class="number">0.0f</span>, <span class="number">-1.0f</span>); <span class="comment">// yè½´èµ·ç‚¹</span></span><br><span class="line">    glVertex2f(<span class="number">0.0f</span>, <span class="number">1.0f</span>);  <span class="comment">// yè½´ç»ˆç‚¹</span></span><br><span class="line">    glEnd();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»˜åˆ¶æ­£å¼¦æ›²çº¿</span></span><br><span class="line">    glBegin(GL_LINE_STRIP);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">-1.0f</span> / factor; x &lt; <span class="number">1.0f</span> / factor; x += <span class="number">0.01f</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        glVertex2f(x * factor, <span class="built_in">sin</span>(x) * factor);</span><br><span class="line">    &#125;</span><br><span class="line">    glEnd();</span><br><span class="line"></span><br><span class="line">    glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    glutInit(&amp;argc, argv);</span><br><span class="line">    glutInitDisplayMode(GLUT_RGB);</span><br><span class="line">    glutInitWindowSize(<span class="number">400</span>, <span class="number">400</span>);</span><br><span class="line">    glutCreateWindow(<span class="string">&quot;OpenGL Sine Curve&quot;</span>);</span><br><span class="line"></span><br><span class="line">    glutDisplayFunc(myDisplay);</span><br><span class="line"></span><br><span class="line">    glutMainLoop();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gcc -o test test.c -lm -lGL -lGLU -lglut</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142147823.png" alt="image-20231114214746801"></p>
<h2 id="10-5-æŒ‡å®šç€è‰²æ¨¡å‹"><a href="#10-5-æŒ‡å®šç€è‰²æ¨¡å‹" class="headerlink" title="10.5 æŒ‡å®šç€è‰²æ¨¡å‹"></a>10.5 æŒ‡å®šç€è‰²æ¨¡å‹</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glut.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> GLdouble Pi = <span class="number">3.1415926536</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myDisplay</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    glBegin(GL_TRIANGLE_FAN);</span><br><span class="line"></span><br><span class="line">    glColor3f(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">    glVertex2f(<span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">8</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        glColor3f((i &amp; <span class="number">0x04</span>) ? <span class="number">1.0f</span> : <span class="number">0.0f</span>, (i &amp; <span class="number">0x02</span>) ? <span class="number">1.0f</span> : <span class="number">0.0f</span>, (i &amp; <span class="number">0x01</span>) ? <span class="number">1.0f</span> : <span class="number">0.0f</span>);</span><br><span class="line">        glVertex2f(<span class="built_in">cos</span>(i * Pi / <span class="number">4</span>), <span class="built_in">sin</span>(i * Pi / <span class="number">4</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    glEnd();</span><br><span class="line"></span><br><span class="line">    glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    glutInit(&amp;argc, argv);</span><br><span class="line">    glutInitDisplayMode(GLUT_RGB);</span><br><span class="line">    glutInitWindowSize(<span class="number">400</span>, <span class="number">400</span>);</span><br><span class="line">    glutCreateWindow(<span class="string">&quot;OpenGL Colorful Triangle&quot;</span>);</span><br><span class="line"></span><br><span class="line">    glutDisplayFunc(myDisplay);</span><br><span class="line"></span><br><span class="line">    glutMainLoop();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gcc -o test test.c -lm -lGL -lGLU -lglut</span><br></pre></td></tr></table></figure>



<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142149974.png" alt="image-20231114214959931"></p>
<p>è¿™ä¸ªå›¾å½¢æ¸²æŸ“å‡ºæ¥å°±å¾ˆæ…¢ï¼Œè¿™å¯èƒ½å°±æ˜¯GPUçš„ä½œç”¨äº†</p>
<h2 id="10-6-ä¸‰ç»´å˜æ¢"><a href="#10-6-ä¸‰ç»´å˜æ¢" class="headerlink" title="10.6 ä¸‰ç»´å˜æ¢"></a>10.6 ä¸‰ç»´å˜æ¢</h2><p>æ¨¡å‹å˜æ¢å’Œè§†å›¾å˜æ¢</p>
<p>æŠ•å½±å˜æ¢</p>
<p>è§†å£å˜æ¢</p>
<p>æ“ä½œçŸ©é˜µå †æ ˆ</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glut.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> day = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myDisplay</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    glEnable(GL_DEPTH_TEST);</span><br><span class="line">    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    glMatrixMode(GL_PROJECTION);</span><br><span class="line">    glLoadIdentity();</span><br><span class="line">    gluPerspective(<span class="number">75</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">400000000</span>);</span><br><span class="line"></span><br><span class="line">    glMatrixMode(GL_MODELVIEW);</span><br><span class="line">    glLoadIdentity();</span><br><span class="line">    gluLookAt(<span class="number">0</span>, <span class="number">-200000000</span>, <span class="number">200000000</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    glColor3f(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line">    glutSolidSphere(<span class="number">69600000</span>, <span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">    glColor3f(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">    glRotatef(day / <span class="number">360.0f</span> * <span class="number">360.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-1.0f</span>);</span><br><span class="line">    glTranslatef(<span class="number">150000000</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line">    glutSolidSphere(<span class="number">15945000</span>, <span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">    glColor3f(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line">    glRotatef(day / <span class="number">30.0f</span> * <span class="number">360.0f</span> - day / <span class="number">360.0f</span> * <span class="number">360.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-1.0f</span>);</span><br><span class="line">    glTranslatef(<span class="number">38000000</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line">    glutSolidSphere(<span class="number">4345000</span>, <span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">    glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    glutInit(&amp;argc, argv);</span><br><span class="line">    glutInitDisplayMode(GLUT_RGB | GLUT_DEPTH);</span><br><span class="line">    glutInitWindowSize(<span class="number">800</span>, <span class="number">800</span>);</span><br><span class="line">    glutCreateWindow(<span class="string">&quot;Solar System&quot;</span>);</span><br><span class="line"></span><br><span class="line">    glutDisplayFunc(myDisplay);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ æ·±åº¦æµ‹è¯•å‡½æ•°</span></span><br><span class="line">    glEnable(GL_DEPTH_TEST);</span><br><span class="line">    glDepthFunc(GL_EQUAL);</span><br><span class="line"></span><br><span class="line">    glutMainLoop();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gcc -o test test.c -lm -lGL -lGLU -lglut</span><br></pre></td></tr></table></figure>

<h2 id="10-7-åŠ¨èµ·æ¥"><a href="#10-7-åŠ¨èµ·æ¥" class="headerlink" title="10.7 åŠ¨èµ·æ¥"></a>10.7 åŠ¨èµ·æ¥</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;GL/glut.h&gt;</span><br><span class="line"></span><br><span class="line">// å¤ªé˜³ã€åœ°çƒå’Œæœˆäº®</span><br><span class="line">// å‡è®¾æ¯ä¸ªæœˆéƒ½æ˜¯30å¤©</span><br><span class="line">// ä¸€å¹´12ä¸ªæœˆï¼Œå…±æ˜¯360å¤©</span><br><span class="line">static int day = 200; // dayçš„å˜åŒ–ï¼šä»0åˆ°359</span><br><span class="line"></span><br><span class="line">void myDisplay(void)</span><br><span class="line">&#123;</span><br><span class="line">    glEnable(GL_DEPTH_TEST);</span><br><span class="line">    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    glMatrixMode(GL_PROJECTION);</span><br><span class="line">    glLoadIdentity();</span><br><span class="line">    gluPerspective(75, 1, 1, 400000000);</span><br><span class="line"></span><br><span class="line">    glMatrixMode(GL_MODELVIEW);</span><br><span class="line">    glLoadIdentity();</span><br><span class="line">    gluLookAt(0, -200000000, 200000000, 0, 0, 0, 0, 0, 1);</span><br><span class="line"></span><br><span class="line">    // ç»˜åˆ¶çº¢è‰²çš„â€œå¤ªé˜³â€</span><br><span class="line">    glColor3f(1.0f, 0.0f, 0.0f);</span><br><span class="line">    glutSolidSphere(69600000, 20, 20);</span><br><span class="line"></span><br><span class="line">    // ç»˜åˆ¶è“è‰²çš„â€œåœ°çƒâ€</span><br><span class="line">    glColor3f(0.0f, 0.0f, 1.0f);</span><br><span class="line">    glRotatef(day / 360.0f * 360.0f, 0.0f, 0.0f, -1.0f);</span><br><span class="line">    glTranslatef(150000000, 0.0f, 0.0f);</span><br><span class="line">    glutSolidSphere(15945000, 20, 20);</span><br><span class="line"></span><br><span class="line">    // ç»˜åˆ¶é»„è‰²çš„â€œæœˆäº®â€</span><br><span class="line">    glColor3f(1.0f, 1.0f, 0.0f);</span><br><span class="line">    glRotatef(day / 30.0f * 360.0f - day / 360.0f * 360.0f, 0.0f, 0.0f, -1.0f);</span><br><span class="line">    glTranslatef(38000000, 0.0f, 0.0f);</span><br><span class="line">    glutSolidSphere(4345000, 20, 20);</span><br><span class="line"></span><br><span class="line">    glFlush();</span><br><span class="line">    glutSwapBuffers();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void myIdle(void)</span><br><span class="line">&#123;</span><br><span class="line">    /* æ–°çš„å‡½æ•°ï¼Œåœ¨ç©ºé—²æ—¶è°ƒç”¨ï¼Œä½œç”¨æ˜¯æŠŠæ—¥æœŸå¾€åç§»åŠ¨ä¸€å¤©å¹¶é‡æ–°ç»˜åˆ¶ï¼Œè¾¾åˆ°åŠ¨ç”»æ•ˆæœ */</span><br><span class="line">    ++day;</span><br><span class="line">    if (day &gt;= 360)</span><br><span class="line">        day = 0;</span><br><span class="line">    glutPostRedisplay(); // é€šçŸ¥ç³»ç»Ÿé‡æ–°ç»˜åˆ¶çª—å£ï¼Œè§¦å‘æ˜¾ç¤ºå›è°ƒå‡½æ•° myDisplay()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    glutInit(&amp;argc, argv);</span><br><span class="line">    glutInitDisplayMode(GLUT_RGB | GLUT_DOUBLE);</span><br><span class="line">    glutInitWindowPosition(100, 100);</span><br><span class="line">    glutInitWindowSize(400, 400);</span><br><span class="line">    glutCreateWindow(&quot;å¤ªé˜³ï¼Œåœ°çƒå’Œæœˆäº®&quot;);</span><br><span class="line"></span><br><span class="line">    glutDisplayFunc(myDisplay);</span><br><span class="line">    glutIdleFunc(myIdle);</span><br><span class="line"></span><br><span class="line">    glutMainLoop();</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gcc -o test test.c -lm -lGL -lGLU -lglut</span><br></pre></td></tr></table></figure>



<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142156920.png" alt="image-20231114215605879"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glut.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setLight</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> GLfloat light_position[] = &#123;<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> GLfloat light_ambient[] = &#123;<span class="number">0.2f</span>, <span class="number">0.2f</span>, <span class="number">0.2f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> GLfloat light_diffuse[] = &#123;<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> GLfloat light_specular[] = &#123;<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"></span><br><span class="line">    glLightfv(GL_LIGHT0, GL_POSITION, light_position);</span><br><span class="line">    glLightfv(GL_LIGHT0, GL_AMBIENT, light_ambient);</span><br><span class="line">    glLightfv(GL_LIGHT0, GL_DIFFUSE, light_diffuse);</span><br><span class="line">    glLightfv(GL_LIGHT0, GL_SPECULAR, light_specular);</span><br><span class="line"></span><br><span class="line">    glEnable(GL_LIGHT0);</span><br><span class="line">    glEnable(GL_LIGHTING);</span><br><span class="line">    glEnable(GL_DEPTH_TEST);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setMaterial</span><span class="params">(<span class="type">const</span> GLfloat mat_diffuse[<span class="number">4</span>], GLfloat mat_shininess)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> GLfloat mat_specular[] = &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> GLfloat mat_emission[] = &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"></span><br><span class="line">    glMaterialfv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, mat_diffuse);</span><br><span class="line">    glMaterialfv(GL_FRONT, GL_SPECULAR, mat_specular);</span><br><span class="line">    glMaterialfv(GL_FRONT, GL_EMISSION, mat_emission);</span><br><span class="line">    glMaterialf(GL_FRONT, GL_SHININESS, mat_shininess);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myDisplay</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€äº›æè´¨é¢œè‰²</span></span><br><span class="line">    <span class="type">const</span> <span class="type">static</span> GLfloat red_color[] = &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line">    <span class="type">const</span> <span class="type">static</span> GLfloat green_color[] = &#123;<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.3333f</span>&#125;;</span><br><span class="line">    <span class="type">const</span> <span class="type">static</span> GLfloat blue_color[] = &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.5f</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¸…é™¤å±å¹•</span></span><br><span class="line">    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯åŠ¨æ··åˆå¹¶è®¾ç½®æ··åˆå› å­</span></span><br><span class="line">    glEnable(GL_BLEND);</span><br><span class="line">    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å…‰æº</span></span><br><span class="line">    setLight();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥(0, 0, 0.5)ä¸ºä¸­å¿ƒï¼Œç»˜åˆ¶ä¸€ä¸ªåŠå¾„ä¸º0.3çš„ä¸é€æ˜çº¢è‰²çƒä½“ï¼ˆç¦»è§‚å¯Ÿè€…æœ€è¿œï¼‰</span></span><br><span class="line">    setMaterial(red_color, <span class="number">30.0</span>);</span><br><span class="line">    glPushMatrix();</span><br><span class="line">    glTranslatef(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>);</span><br><span class="line">    glutSolidSphere(<span class="number">0.3</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">    glPopMatrix();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹é¢å°†ç»˜åˆ¶åŠé€æ˜ç‰©ä½“äº†ï¼Œå› æ­¤å°†æ·±åº¦ç¼“å†²è®¾ç½®ä¸ºåªè¯»</span></span><br><span class="line">    glDepthMask(GL_FALSE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥(0.2, 0, -0.5)ä¸ºä¸­å¿ƒï¼Œç»˜åˆ¶ä¸€ä¸ªåŠå¾„ä¸º0.2çš„åŠé€æ˜è“è‰²çƒä½“ï¼ˆç¦»è§‚å¯Ÿè€…æœ€è¿‘ï¼‰</span></span><br><span class="line">    setMaterial(blue_color, <span class="number">30.0</span>);</span><br><span class="line">    glPushMatrix();</span><br><span class="line">    glTranslatef(<span class="number">0.2f</span>, <span class="number">0.0f</span>, <span class="number">-0.5f</span>);</span><br><span class="line">    glutSolidSphere(<span class="number">0.2</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">    glPopMatrix();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥(0.1, 0, 0)ä¸ºä¸­å¿ƒï¼Œç»˜åˆ¶ä¸€ä¸ªåŠå¾„ä¸º0.15çš„åŠé€æ˜ç»¿è‰²çƒä½“ï¼ˆåœ¨å‰ä¸¤ä¸ªçƒä½“ä¹‹é—´ï¼‰</span></span><br><span class="line">    setMaterial(green_color, <span class="number">30.0</span>);</span><br><span class="line">    glPushMatrix();</span><br><span class="line">    glTranslatef(<span class="number">0.1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    glutSolidSphere(<span class="number">0.15</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">    glPopMatrix();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ŒæˆåŠé€æ˜ç‰©ä½“çš„ç»˜åˆ¶ï¼Œå°†æ·±åº¦ç¼“å†²åŒºæ¢å¤ä¸ºå¯è¯»å¯å†™çš„å½¢å¼</span></span><br><span class="line">    glDepthMask(GL_TRUE);</span><br><span class="line"></span><br><span class="line">    glutSwapBuffers();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">    glutInit(&amp;argc, argv);</span><br><span class="line">    glutInitDisplayMode(GLUT_RGB | GLUT_DOUBLE | GLUT_DEPTH);</span><br><span class="line">    glutInitWindowPosition(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    glutInitWindowSize(<span class="number">800</span>, <span class="number">600</span>);</span><br><span class="line">    glutCreateWindow(<span class="string">&quot;Transparent Objects&quot;</span>);</span><br><span class="line"></span><br><span class="line">    glClearColor(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line"></span><br><span class="line">    glutDisplayFunc(myDisplay);</span><br><span class="line"></span><br><span class="line">    glutMainLoop();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gcc -o test test.c -lm -lGL -lGLU -lglut</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311142203186.png" alt="image-20231114220315130"></p>
<h1 id="11-openclå­¦ä¹ "><a href="#11-openclå­¦ä¹ " class="headerlink" title="11.openclå­¦ä¹ "></a>11.openclå­¦ä¹ </h1><p>&#x3D;&#x3D;ä»€ä¹ˆæ˜¯openclï¼Ÿ&#x3D;&#x3D;</p>
<p>OpenCLï¼ˆOpen Computing Languageï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾çš„è·¨å¹³å°ç¼–ç¨‹æ¡†æ¶ï¼Œç”¨äºå®ç°å¹¶è¡Œè®¡ç®—å’Œé€šç”¨è®¡ç®—ä»»åŠ¡çš„åŠ é€Ÿã€‚å®ƒå…è®¸å¼€å‘è€…åˆ©ç”¨å¤šæ ¸ CPUã€GPUã€FPGAå’Œå…¶ä»–åŠ é€Ÿå™¨ç­‰å¼‚æ„è®¡ç®—èµ„æºï¼Œä»¥é«˜æ•ˆåœ°æ‰§è¡Œå¹¶è¡Œè®¡ç®—ä»»åŠ¡ã€‚</p>
<p>ä¸‹é¢æ˜¯å¯¹OpenCLçš„è¯¦ç»†è§£é‡Šï¼š</p>
<ol>
<li><strong>è·¨å¹³å°æ€§</strong>: OpenCLæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ç¼–ç¨‹æ¡†æ¶ï¼Œå¯åœ¨å„ç§æ“ä½œç³»ç»Ÿï¼ˆå¦‚Windowsã€MacOSã€Linuxï¼‰å’Œç¡¬ä»¶å¹³å°ä¸Šè¿è¡Œã€‚è¿™ä½¿å¾—å¼€å‘è€…å¯ä»¥ç¼–å†™ä¸ç‰¹å®šå¹³å°å’Œç¡¬ä»¶æ— å…³çš„å¹¶è¡Œè®¡ç®—ä»£ç ã€‚</li>
<li><strong>å¼‚æ„è®¡ç®—</strong>: OpenCLæ”¯æŒå¼‚æ„è®¡ç®—ï¼Œåˆ©ç”¨å¤šç§è®¡ç®—è®¾å¤‡ï¼ˆå¦‚CPUã€GPUã€FPGAç­‰ï¼‰çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ã€‚è¿™äº›è®¾å¤‡ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†æ•°æ®å’Œæ‰§è¡Œè®¡ç®—ä»»åŠ¡ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿå……åˆ†åˆ©ç”¨å„ç§ç¡¬ä»¶èµ„æºã€‚</li>
<li><strong>å¹¶è¡Œè®¡ç®—æ¨¡å‹</strong>: OpenCLé‡‡ç”¨åŸºäºä»»åŠ¡å’Œæ•°æ®å¹¶è¡Œçš„è®¡ç®—æ¨¡å‹ã€‚å¼€å‘è€…å¯ä»¥å°†è®¡ç®—ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªç‹¬ç«‹çš„å­ä»»åŠ¡ï¼Œç„¶åå¹¶è¡Œæ‰§è¡Œè¿™äº›å­ä»»åŠ¡ã€‚è¿™ç§å¹¶è¡Œè®¡ç®—æ¨¡å‹å¯ä»¥åœ¨ä¸åŒçš„è®¾å¤‡ä¸ŠåŒæ—¶æ‰§è¡Œä»»åŠ¡ï¼Œå®ç°é«˜æ•ˆçš„å¹¶è¡Œè®¡ç®—ã€‚</li>
<li><strong>å†…æ ¸å‡½æ•°</strong>: OpenCLä½¿ç”¨å†…æ ¸å‡½æ•°æ¥æè¿°å¹¶è¡Œè®¡ç®—ä»»åŠ¡ã€‚å†…æ ¸å‡½æ•°æ˜¯ç¨‹åºå‘˜ç¼–å†™çš„å¹¶è¡Œè®¡ç®—ä»£ç ï¼Œè¿è¡Œåœ¨OpenCLè®¾å¤‡ä¸Šçš„å¹¶è¡Œå¤„ç†å•å…ƒä¸Šã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡ç¼–å†™å†…æ ¸å‡½æ•°æ¥å®šä¹‰è¦æ‰§è¡Œçš„è®¡ç®—ä»»åŠ¡ã€‚</li>
<li><strong>å†…å­˜æ¨¡å‹</strong>: OpenCLæä¾›äº†å…¨å±€å†…å­˜ã€å±€éƒ¨å†…å­˜å’Œç§æœ‰å†…å­˜ç­‰ä¸åŒç±»å‹çš„å†…å­˜æ¥ç®¡ç†æ•°æ®ã€‚å…¨å±€å†…å­˜å¯¹æ‰€æœ‰å†…æ ¸å‡½æ•°å¯è§ï¼Œå±€éƒ¨å†…å­˜ç”¨äºå…±äº«æ•°æ®å’ŒååŒå·¥ä½œï¼Œè€Œç§æœ‰å†…å­˜ç”¨äºæ¯ä¸ªå·¥ä½œé¡¹çš„ç§æœ‰æ•°æ®ã€‚å¼€å‘è€…å¯ä»¥æ ¹æ®è®¡ç®—éœ€æ±‚æ¥é€‰æ‹©åˆé€‚çš„å†…å­˜ç±»å‹ã€‚</li>
<li><strong>ä»»åŠ¡è°ƒåº¦å’Œå¹¶è¡Œæ‰§è¡Œ</strong>: OpenCLä½¿ç”¨å·¥ä½œç»„ï¼ˆwork-groupï¼‰å’Œå·¥ä½œé¡¹ï¼ˆwork-itemï¼‰çš„æ¦‚å¿µæ¥ç®¡ç†ä»»åŠ¡çš„è°ƒåº¦å’Œå¹¶è¡Œæ‰§è¡Œã€‚å·¥ä½œç»„æ˜¯ä¸€ç»„ç›¸å…³çš„å·¥ä½œé¡¹ï¼Œå®ƒä»¬å¯ä»¥ååŒå·¥ä½œå’Œå…±äº«æ•°æ®ã€‚å·¥ä½œé¡¹æ˜¯æœ€å°çš„å¹¶è¡Œæ‰§è¡Œå•å…ƒï¼Œæ¯ä¸ªå·¥ä½œé¡¹ç‹¬ç«‹æ‰§è¡Œå†…æ ¸å‡½æ•°ã€‚</li>
<li><strong>è¿è¡Œæ—¶ç³»ç»Ÿ</strong>: OpenCLé€šè¿‡è¿è¡Œæ—¶ç³»ç»Ÿæ¥ç®¡ç†å’Œè°ƒåº¦å¹¶è¡Œè®¡ç®—ä»»åŠ¡ã€‚è¿è¡Œæ—¶ç³»ç»Ÿè´Ÿè´£åŠ è½½å’Œåˆå§‹åŒ–è®¾å¤‡é©±åŠ¨ç¨‹åºï¼Œåˆ†é…å’Œç®¡ç†å†…å­˜ï¼Œè°ƒåº¦å¹¶è¡Œä»»åŠ¡çš„æ‰§è¡Œï¼Œä»¥åŠåœ¨è®¾å¤‡ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</li>
<li><strong>æ‰©å±•å’Œç‰ˆæœ¬</strong>: OpenCLä¸æ–­å‘å±•å’Œæ›´æ–°ï¼Œå¼•å…¥æ–°çš„åŠŸèƒ½å’Œæ‰©å±•ï¼Œä»¥é€‚åº”ä¸æ–­å¢é•¿çš„å¹¶è¡Œè®¡ç®—éœ€æ±‚ã€‚æ¯ä¸ªOpenCLç‰ˆæœ¬éƒ½æœ‰å…¶ç‰¹å®šçš„åŠŸèƒ½å’Œæ”¯æŒçš„ç¡¬ä»¶çº§åˆ«ã€‚</li>
</ol>
<h1 id="12-rgaç¼–è¯‘"><a href="#12-rgaç¼–è¯‘" class="headerlink" title="12.rgaç¼–è¯‘"></a>12.rgaç¼–è¯‘</h1><p>RGAï¼ˆRaster Graphic Acceleration Unitï¼‰å…‰æ …å›¾å½¢åŠ é€Ÿå•å…ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç¡¬ä»¶åŠ é€Ÿå™¨ï¼Œä¸“é—¨ç”¨äºåŠ é€Ÿ2Då›¾å½¢æ“ä½œã€‚å®ƒæä¾›äº†é«˜æ•ˆçš„ç‚¹&#x2F;çº¿ç»˜åˆ¶ã€å›¾åƒç¼©æ”¾ã€æ—‹è½¬ã€ä½å—ä¼ è¾“ï¼ˆbitBltï¼‰ã€Alphaæ··åˆç­‰å¸¸è§çš„2Då›¾å½¢æ“ä½œåŠŸèƒ½ã€‚</p>
<p>RGA çš„è®¾è®¡ç›®æ ‡æ˜¯é€šè¿‡ç¡¬ä»¶åŠ é€Ÿæ¥æé«˜2Då›¾å½¢å¤„ç†çš„æ€§èƒ½å’Œæ•ˆç‡ï¼Œå‡è½»CPUçš„è´Ÿæ‹…ã€‚å®ƒå…·æœ‰ç‹¬ç«‹çš„ç¡¬ä»¶æ¨¡å—ï¼Œå¯ä»¥é€šè¿‡ç”¨æˆ·ç©ºé—´é©±åŠ¨ç¨‹åºè¿›è¡Œè®¿é—®å’Œæ§åˆ¶ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ RGA çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ï¼š</p>
<ol>
<li>ç‚¹&#x2F;çº¿ç»˜åˆ¶åŠ é€Ÿï¼šRGA æä¾›äº†ç¡¬ä»¶åŠ é€Ÿçš„ç‚¹å’Œçº¿ç»˜åˆ¶åŠŸèƒ½ï¼Œå¯ä»¥å¿«é€Ÿç»˜åˆ¶å›¾å½¢ä¸­çš„ç‚¹å’Œçº¿æ¡ï¼Œæä¾›æ›´é«˜çš„ç»˜åˆ¶æ€§èƒ½ã€‚</li>
<li>å›¾åƒç¼©æ”¾å’Œæ—‹è½¬ï¼šRGA æ”¯æŒç¡¬ä»¶åŠ é€Ÿçš„å›¾åƒç¼©æ”¾å’Œæ—‹è½¬ï¼Œå¯ä»¥å¿«é€Ÿæ‰§è¡Œå›¾åƒçš„æ”¾å¤§ã€ç¼©å°å’Œæ—‹è½¬æ“ä½œï¼Œé€‚ç”¨äºå›¾åƒå¤„ç†å’Œæ˜¾ç¤ºåº”ç”¨ã€‚</li>
<li>ä½å—ä¼ è¾“ï¼ˆbitBltï¼‰ï¼šRGA æä¾›äº†ç¡¬ä»¶åŠ é€Ÿçš„ä½å—ä¼ è¾“åŠŸèƒ½ï¼Œå¯ä»¥é«˜æ•ˆåœ°åœ¨å†…å­˜ä¹‹é—´ä¼ è¾“å›¾åƒæ•°æ®ï¼ŒåŒ…æ‹¬å¤åˆ¶ã€å¡«å……å’Œè£å‰ªç­‰æ“ä½œã€‚</li>
<li>Alphaæ··åˆï¼šRGA æ”¯æŒç¡¬ä»¶åŠ é€Ÿçš„Alphaæ··åˆæ“ä½œï¼Œå¯ä»¥å®ç°å›¾åƒçš„é€æ˜åº¦æ··åˆï¼Œä»¥å®ç°å›¾åƒå åŠ å’Œç‰¹æ•ˆæ•ˆæœã€‚</li>
<li>ç”¨æˆ·ç©ºé—´é©±åŠ¨ç¨‹åºï¼šRGA æä¾›äº†ç”¨æˆ·ç©ºé—´é©±åŠ¨ç¨‹åºï¼Œå…è®¸åº”ç”¨ç¨‹åºé€šè¿‡APIè®¿é—®å’Œæ§åˆ¶RGAç¡¬ä»¶åŠ é€Ÿå™¨ã€‚è¿™æ ·ï¼Œå¼€å‘è€…å¯ä»¥æ–¹ä¾¿åœ°åˆ©ç”¨RGAçš„åŠŸèƒ½æ¥åŠ é€Ÿ2Då›¾å½¢æ“ä½œã€‚</li>
</ol>
<p>RGA çš„ä¼˜åŠ¿åœ¨äºå®ƒæä¾›äº†é«˜æ•ˆçš„ç¡¬ä»¶åŠ é€Ÿï¼Œèƒ½å¤ŸåŠ é€Ÿå¸¸è§çš„2Då›¾å½¢æ“ä½œï¼Œä»è€Œæé«˜å›¾å½¢å¤„ç†å’Œæ˜¾ç¤ºçš„æ€§èƒ½ã€‚åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ä½¿ç”¨RGAçš„ç”¨æˆ·ç©ºé—´é©±åŠ¨ç¨‹åºæ¥åˆ©ç”¨è¿™äº›åŠŸèƒ½ï¼Œå®ç°æ›´å¿«é€Ÿã€æµç•…çš„å›¾å½¢å¤„ç†å’Œæ˜¾ç¤ºæ•ˆæœã€‚</p>
<p>RGAï¼ˆRaster Graphic Acceleration Unitï¼‰å¹¶ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç¡¬ä»¶åŠ é€Ÿå™¨ã€‚å®é™…ä¸Šï¼ŒRGAæ˜¯ä¸€ç§è½¯ä»¶æŠ€æœ¯ï¼Œä¹Ÿå¯ä»¥æŒ‡ä»£ä¸€ç»„ç›¸å…³çš„è½¯ä»¶åº“å’Œé©±åŠ¨ç¨‹åºã€‚</p>
<p>RGAæ˜¯Rockchipï¼ˆç‘èŠ¯å¾®ç”µå­ï¼‰å…¬å¸å¼€å‘çš„å›¾åƒå¤„ç†æŠ€æœ¯ï¼Œä¸»è¦åº”ç”¨äºä»–ä»¬çš„ç³»ç»ŸèŠ¯ç‰‡ä¸­ã€‚RGAæŠ€æœ¯åœ¨Rockchipçš„èŠ¯ç‰‡ä¸­é›†æˆäº†ä¸€ä¸ªä¸“é—¨çš„ç¡¬ä»¶æ¨¡å—ï¼Œç”¨äºåŠ é€Ÿ2Då›¾å½¢æ“ä½œã€‚è¿™ä¸ªç¡¬ä»¶æ¨¡å—é€šå¸¸è¢«ç§°ä¸ºRGAç¡¬ä»¶åŠ é€Ÿå™¨ã€‚</p>
<p>ç„¶è€Œï¼ŒRGAå¹¶ä¸æ˜¯åƒGPUï¼ˆå›¾å½¢å¤„ç†å•å…ƒï¼‰è¿™æ ·çš„ç‹¬ç«‹ç¡¬ä»¶è®¾å¤‡ã€‚å®ƒæ˜¯ä¸Rockchipç³»ç»ŸèŠ¯ç‰‡é›†æˆçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæä¾›2Då›¾å½¢å¤„ç†çš„åŠ é€ŸåŠŸèƒ½ã€‚RGAçš„é©±åŠ¨ç¨‹åºå’Œè½¯ä»¶åº“å…è®¸å¼€å‘è€…é€šè¿‡APIæ¥è®¿é—®å’Œåˆ©ç”¨è¿™ä¸ªç¡¬ä»¶åŠ é€Ÿå™¨ã€‚</p>
<p>å› æ­¤ï¼ŒRGAå®é™…ä¸Šæ˜¯RockchipèŠ¯ç‰‡ä¸­çš„ä¸€ä¸ªç‰¹å®šåŠŸèƒ½æ¨¡å—ï¼Œç”¨äºåŠ é€Ÿ2Då›¾å½¢æ“ä½œï¼Œå¹¶é€šè¿‡è½¯ä»¶é©±åŠ¨ç¨‹åºæä¾›å¯¹è¯¥æ¨¡å—çš„è®¿é—®å’Œæ§åˆ¶ã€‚</p>
<p>rockchip çš„github <a href="https://github.com/orgs/rockchip-linux/repositories?type=all">https://github.com/orgs/rockchip-linux/repositories?type=all</a></p>
<p>rgaçš„github <a href="https://github.com/JeffyCN/mirrors/tree/linux-rga-multi">https://github.com/JeffyCN/mirrors/tree/linux-rga-multi</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/Caesar-github/linux-rga.git</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --privileged -it -v /home/topeet/:/home/topeet/ ubuntu20</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»ºdebåŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo DEB_BUILD_OPTIONS=nocheck dpkg-buildpackage -b -d -uc -us -aarm64</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>DEB_BUILD_OPTIONS=nocheck</code>: è¿™æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡è®¾ç½®ï¼ŒæŒ‡å®šåœ¨æ„å»ºè½¯ä»¶åŒ…æ—¶ä¸è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚<code>nocheck</code> é€‰é¡¹å‘Šè¯‰æ„å»ºç³»ç»Ÿè·³è¿‡è‡ªåŠ¨åŒ–æµ‹è¯•é˜¶æ®µï¼Œä»¥åŠ å¿«æ„å»ºè¿‡ç¨‹ã€‚</p>
</li>
<li><p><code>dpkg-buildpackage</code>: è¿™æ˜¯ç”¨äºæ„å»º Debian è½¯ä»¶åŒ…çš„å·¥å…·ã€‚å®ƒä¼šæ ¹æ®å½“å‰ç›®å½•ä¸­çš„æºä»£ç å’Œç›¸å…³æ–‡ä»¶æ„å»ºä¸€ä¸ª .deb æ–‡ä»¶ã€‚</p>
</li>
<li><p><code>-b</code>: è¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼ŒæŒ‡å®šåªæ„å»ºäºŒè¿›åˆ¶è½¯ä»¶åŒ…ï¼Œä¸åŒ…æ‹¬æºä»£ç ã€‚</p>
</li>
<li><p><code>-d</code>: è¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œå‘Šè¯‰ dpkg-buildpackage åœ¨æ„å»ºè¿‡ç¨‹ä¸­å¤„ç†ä¾èµ–å…³ç³»ã€‚</p>
</li>
<li><p><code>-uc -us</code>: è¿™æ˜¯ä¸¤ä¸ªé€‰é¡¹ï¼Œç”¨äºæŒ‡å®šåœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¸ç­¾åè½¯ä»¶åŒ…ã€‚<code>-uc</code> è¡¨ç¤ºä¸å¯¹æºä»£ç åŒ…è¿›è¡Œç­¾åï¼Œ<code>-us</code> è¡¨ç¤ºä¸å¯¹äºŒè¿›åˆ¶è½¯ä»¶åŒ…è¿›è¡Œç­¾åã€‚</p>
</li>
<li><p><code>-aarm64</code>: è¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼ŒæŒ‡å®šè¦æ„å»ºçš„ç›®æ ‡æ¶æ„ä¸º arm64ï¼ˆARM 64ä½æ¶æ„ï¼‰ã€‚</p>
</li>
</ul>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311152100173.png" alt="image-20231115152331453"></p>
<p>è¿™å°±ç¼–è¯‘æˆåŠŸäº†ï¼Œå¾—åˆ°äº†ä¸‰ä¸ªåŒ…ã€‚</p>
<h1 id="13-mppç¼–è¯‘"><a href="#13-mppç¼–è¯‘" class="headerlink" title="13.mppç¼–è¯‘"></a>13.mppç¼–è¯‘</h1><p>MPPï¼ˆMedia Processing Platformï¼‰æ˜¯ä¸€ç§å¤šåª’ä½“å¤„ç†å¹³å°ï¼Œç”¨äºå®ç°éŸ³é¢‘å’Œè§†é¢‘æ•°æ®çš„å¤„ç†ã€ç¼–è§£ç å’Œå¤„ç†ã€‚MPP æä¾›äº†ä¸€ç»„ä¸°å¯Œçš„åŠŸèƒ½å’Œç®—æ³•ï¼Œç”¨äºå¤„ç†å„ç§å¤šåª’ä½“æ•°æ®ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨ç¡¬ä»¶åŠ é€Ÿçš„ç¯å¢ƒä¸‹æä¾›é«˜æ•ˆçš„å¤„ç†æ€§èƒ½ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ MPP çš„ä¸»è¦ä½œç”¨ï¼š</p>
<p>è§†é¢‘ç¼–è§£ç ï¼šMPP æä¾›äº†å„ç§è§†é¢‘ç¼–è§£ç å™¨ï¼Œå¦‚ H.264ã€H.265ã€MPEG-2 ç­‰ã€‚è¿™äº›ç¼–è§£ç å™¨èƒ½å¤Ÿå°†è§†é¢‘æ•°æ®è¿›è¡Œå‹ç¼©ï¼ˆç¼–ç ï¼‰å’Œè§£å‹ç¼©ï¼ˆè§£ç ï¼‰ï¼Œä»¥æ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯å¯¹è§†é¢‘æ•°æ®çš„å­˜å‚¨å’Œä¼ è¾“éœ€æ±‚ã€‚é€šè¿‡ç¡¬ä»¶åŠ é€Ÿï¼ŒMPP å¯ä»¥æä¾›é«˜æ•ˆçš„è§†é¢‘ç¼–è§£ç æ€§èƒ½ï¼Œå‡è½» CPU çš„è´Ÿæ‹…ã€‚</p>
<p>å›¾åƒå¤„ç†ï¼šMPP åŒ…å«äº†ä¸€ç³»åˆ—å›¾åƒå¤„ç†ç®—æ³•ï¼Œå¦‚å›¾åƒç¼©æ”¾ã€æ—‹è½¬ã€è£å‰ªã€è‰²å½©ç©ºé—´è½¬æ¢ç­‰ã€‚è¿™äº›ç®—æ³•å¯ä»¥å¯¹å›¾åƒè¿›è¡Œå„ç§æ“ä½œå’Œè½¬æ¢ï¼Œä»¥æ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯å¯¹å›¾åƒå¤„ç†çš„éœ€æ±‚ã€‚MPP çš„ç¡¬ä»¶åŠ é€Ÿèƒ½åŠ›å¯ä»¥åŠ å¿«å›¾åƒå¤„ç†çš„é€Ÿåº¦ï¼Œå¹¶æä¾›æ›´é«˜çš„æ•ˆç‡ã€‚</p>
<p>éŸ³é¢‘ç¼–è§£ç ï¼šé™¤äº†è§†é¢‘ç¼–è§£ç ï¼ŒMPP è¿˜æä¾›äº†éŸ³é¢‘ç¼–è§£ç çš„åŠŸèƒ½ã€‚å®ƒæ”¯æŒå¸¸è§çš„éŸ³é¢‘ç¼–ç æ ¼å¼ï¼Œå¦‚ AACã€MP3ã€AC3 ç­‰ã€‚é€šè¿‡ MPPï¼Œå¯ä»¥å¯¹éŸ³é¢‘æ•°æ®è¿›è¡Œé«˜æ•ˆçš„å‹ç¼©å’Œè§£å‹ç¼©ï¼Œå®ç°éŸ³é¢‘çš„å­˜å‚¨ã€ä¼ è¾“å’Œå¤„ç†ã€‚</p>
<p>å¤šåª’ä½“å¤„ç†æµç¨‹ç®¡ç†ï¼šMPP æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¡†æ¶å’Œæ¥å£ï¼Œç”¨äºç®¡ç†å’Œæ§åˆ¶å¤šåª’ä½“å¤„ç†æµç¨‹ã€‚å®ƒå¯ä»¥å¯¹å¤šä¸ªåª’ä½“å¤„ç†å•å…ƒè¿›è¡Œè°ƒåº¦å’Œåè°ƒï¼Œå®ç°å¤æ‚çš„å¤šåª’ä½“å¤„ç†ä»»åŠ¡ã€‚MPP è¿˜æä¾›äº†ä¸°å¯Œçš„é…ç½®é€‰é¡¹å’Œå‚æ•°è®¾ç½®ï¼Œä»¥æ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚</p>
<p>æ€»ä¹‹ï¼ŒMPP æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¤šåª’ä½“å¤„ç†å¹³å°ï¼Œæä¾›äº†è§†é¢‘ç¼–è§£ç ã€å›¾åƒå¤„ç†ã€éŸ³é¢‘ç¼–è§£ç ç­‰åŠŸèƒ½ã€‚å®ƒé€šè¿‡ç¡¬ä»¶åŠ é€Ÿï¼Œèƒ½å¤Ÿå®ç°é«˜æ•ˆçš„å¤šåª’ä½“æ•°æ®å¤„ç†å’Œå¤„ç†æ€§èƒ½ï¼Œæ»¡è¶³å„ç§åº”ç”¨åœºæ™¯å¯¹å¤šåª’ä½“å¤„ç†çš„éœ€æ±‚ã€‚</p>
<p> <a href="https://github.com/rockchip-linux/mpp">https://github.com/rockchip-linux/mpp</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone  https://github.com/rockchip-linux/mpp</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --privileged -it -v /home/topeet/:/home/topeet/ ubuntu20</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»ºdebåŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo DEB_BUILD_OPTIONS=nocheck dpkg-buildpackage -b -d -uc -us -aarm64</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311152100221.png" alt="image-20231115153242539"></p>
<h1 id="14-drm-cursorç¼–è¯‘"><a href="#14-drm-cursorç¼–è¯‘" class="headerlink" title="14.drm-cursorç¼–è¯‘"></a>14.drm-cursorç¼–è¯‘</h1><p>drm-cursor æ¨¡å—çš„ä½œç”¨æ˜¯åœ¨ Linux å†…æ ¸ä¸­ç®¡ç†å’Œæ§åˆ¶ç¡¬ä»¶å…‰æ ‡çš„æ˜¾ç¤ºå’Œæ“ä½œã€‚å®ƒæä¾›äº†å¯¹ç¡¬ä»¶å…‰æ ‡å¹³é¢ï¼ˆcursor planeï¼‰çš„æ”¯æŒï¼Œå…è®¸ç”¨æˆ·åœ¨å›¾å½¢ç•Œé¢ä¸­æ˜¾ç¤ºå’Œæ“ä½œç¡¬ä»¶åŠ é€Ÿçš„å…‰æ ‡ã€‚</p>
<p>å…·ä½“è€Œè¨€ï¼Œdrm-cursor æ¨¡å—è´Ÿè´£ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ol>
<li>ç¡¬ä»¶å…‰æ ‡ä½ç½®æ§åˆ¶ï¼šå®ƒå…è®¸ç”¨æˆ·åœ¨å±å¹•ä¸Šdrm-cursor æ¨¡å—çš„ä½œç”¨æ˜¯åœ¨ Linux å†…æ ¸ä¸­ç®¡ç†å’Œæ§åˆ¶ç¡¬ä»¶å…‰æ ‡çš„æ˜¾ç¤ºå’Œæ“ä½œã€‚å®ƒæä¾›äº†å¯¹ç¡¬ä»¶å…‰æ ‡å¹³é¢ï¼ˆcursor planeï¼‰çš„æ”¯æŒï¼Œå…è®¸ç”¨æˆ·åœ¨å›¾å½¢ç•Œé¢ä¸­æ˜¾ç¤ºå’Œæ“ä½œç¡¬ä»¶åŠ é€Ÿçš„å…‰æ ‡ã€‚</li>
</ol>
<p>å…·ä½“è€Œè¨€ï¼Œdrm-cursor æ¨¡å—è´Ÿè´£ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ol>
<li>ç¡¬ä»¶å…‰æ ‡ä½ç½®æ§åˆ¶ï¼šå®ƒå…è®¸ç”¨æˆ·åœ¨å±å¹•ä¸Šè®¾ç½®å…‰æ ‡çš„ä½ç½®ï¼Œä½¿å…‰æ ‡èƒ½å¤Ÿéšç€é¼ æ ‡ç§»åŠ¨è€Œç§»åŠ¨ã€‚</li>
<li>ç¡¬ä»¶å…‰æ ‡å¤–è§‚è®¾ç½®ï¼šå®ƒå…è®¸ç”¨æˆ·å®šä¹‰å…‰æ ‡çš„å¤–è§‚ï¼ŒåŒ…æ‹¬å…‰æ ‡çš„å½¢çŠ¶ã€å¤§å°ã€é¢œè‰²ç­‰ã€‚</li>
<li>ç¡¬ä»¶å…‰æ ‡çš„æ˜¾ç¤ºå’Œæ›´æ–°ï¼šå®ƒè´Ÿè´£å°†å…‰æ ‡çš„å›¾åƒæ•°æ®ä¼ é€’ç»™æ˜¾ç¤ºç¡¬ä»¶ï¼Œä»¥ä¾¿åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå…‰æ ‡ã€‚å®ƒè¿˜è´Ÿè´£åœ¨å…‰æ ‡ä½ç½®å‘ç”Ÿå˜åŒ–æ—¶æ›´æ–°å…‰æ ‡çš„æ˜¾ç¤ºã€‚</li>
<li>ç¡¬ä»¶å…‰æ ‡çš„äº¤äº’å“åº”ï¼šå®ƒç›‘å¬ç”¨æˆ·çš„é¼ æ ‡è¾“å…¥ï¼Œå¹¶å°†ç›¸åº”çš„äº‹ä»¶ä¼ é€’ç»™åº”ç”¨ç¨‹åºï¼Œä»¥å®ç°å…‰æ ‡çš„äº¤äº’æ“ä½œï¼Œå¦‚ç‚¹å‡»ã€æ‹–åŠ¨ç­‰ã€‚</li>
</ol>
<p>é€šè¿‡ç¡¬ä»¶åŠ é€Ÿçš„å…‰æ ‡æ˜¾ç¤ºå’Œæ“ä½œï¼Œdrm-cursor æ¨¡å—æä¾›äº†æ›´é«˜æ•ˆã€æ›´å¹³æ»‘å’Œæ›´å“åº”çš„å…‰æ ‡ä½“éªŒï¼Œä»è€Œæå‡äº†å›¾å½¢ç•Œé¢çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<p><a href="https://github.com/JeffyCN/drm-cursor.git">https://github.com/JeffyCN/drm-cursor.git</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone  https://github.com/JeffyCN/drm-cursor.git</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --privileged -it -v /home/topeet/:/home/topeet/ ubuntu20</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»ºdebåŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo DEB_BUILD_OPTIONS=nocheck dpkg-buildpackage -b -d -uc -us -aarm64</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311152100215.png" alt="image-20231115173657884"></p>
<h1 id="15-maliç¼–è¯‘"><a href="#15-maliç¼–è¯‘" class="headerlink" title="15.maliç¼–è¯‘"></a>15.maliç¼–è¯‘</h1><p><a href="https://github.com/JeffyCN/mirrors/tree/libmali">https://github.com/JeffyCN/mirrors/tree/libmali</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/JeffyCN/mirrors/tree/libmali</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --privileged -it -v /home/topeet/:/home/topeet/ ubuntu20</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»ºdebåŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo DEB_BUILD_OPTIONS=nocheck dpkg-buildpackage -b -d -uc -us -aarm64</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apt-get install pip</span><br><span class="line">pip3 install meson==0.54.0 -i https://pypi.mirrors.ustc.edu.cn/simple/</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311152100218.png" alt="image-20231115173447296"></p>
<h1 id="16-libv4l-mppç¼–è¯‘-ç›®å‰æ²¡è¿™ä¸ªï¼Œè¿˜ä¸éœ€è¦"><a href="#16-libv4l-mppç¼–è¯‘-ç›®å‰æ²¡è¿™ä¸ªï¼Œè¿˜ä¸éœ€è¦" class="headerlink" title="16.libv4l-mppç¼–è¯‘(ç›®å‰æ²¡è¿™ä¸ªï¼Œè¿˜ä¸éœ€è¦)"></a>16.libv4l-mppç¼–è¯‘(ç›®å‰æ²¡è¿™ä¸ªï¼Œè¿˜ä¸éœ€è¦)</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/JeffyCN/libv4l-rkmpp.git</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --privileged -it -v /home/topeet/:/home/topeet/ ubuntu20</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo DEB_BUILD_OPTIONS=nocheck dpkg-buildpackage -b -d -uc -us -aarm64</span><br></pre></td></tr></table></figure>



<h1 id="17-gst-rkç¼–è¯‘-ç›®å‰æ²¡è¿™ä¸ªï¼Œè¿˜ä¸éœ€è¦"><a href="#17-gst-rkç¼–è¯‘-ç›®å‰æ²¡è¿™ä¸ªï¼Œè¿˜ä¸éœ€è¦" class="headerlink" title="17.gst-rkç¼–è¯‘(ç›®å‰æ²¡è¿™ä¸ªï¼Œè¿˜ä¸éœ€è¦)"></a>17.gst-rkç¼–è¯‘(ç›®å‰æ²¡è¿™ä¸ªï¼Œè¿˜ä¸éœ€è¦)</h1><p><a href="https://github.com/JeffyCN/mirrors/tree/gstreamer-rockchip">https://github.com/JeffyCN/mirrors/tree/gstreamer-rockchip</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone  https://github.com/JeffyCN/mirrors/tree/gstreamer-rockchip</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --privileged -it -v /home/topeet/:/home/topeet/ ubuntu20</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»ºdebåŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo DEB_BUILD_OPTIONS=nocheck dpkg-buildpackage -b -d -uc -us -aarm64</span><br></pre></td></tr></table></figure>

<h1 id="18-xserverç¼–è¯‘"><a href="#18-xserverç¼–è¯‘" class="headerlink" title="18.xserverç¼–è¯‘"></a>18.xserverç¼–è¯‘</h1><p>xserverè¿™ä¸ªæˆ‘çœ‹ç‘èŠ¯å¾®å¹¶æ²¡æœ‰æä¾›ubuntu20 å’Œubuntu22çš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä½¿ç”¨å®ƒæä¾›å¥½çš„xserveræ¥ä»£æ›¿ã€‚ç°åœ¨å°±å…ˆè¿™æ ·äº†ï¼Œä¹Ÿæ²¡æœ‰å…¶ä»–å¥½åŠæ³•ã€‚é¦–å…ˆæ‹‰å–æä¾›å¥½çš„æºç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/JeffyCN/xorg-xserver.git</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;ä¸Šé¢çš„ä¸å¯¹ï¼Œçœ‹äº†çœ‹ç‘èŠ¯å¾®çš„ç›´æ’­è¯¾æ‰¾åˆ°äº†æ–¹æ³•&#x3D;&#x3D;</p>
<p>è·å–ubuntuçš„xserveræºç </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apt-get source xorg-server</span><br></pre></td></tr></table></figure>

<p>è·å–rkçš„xserveræºç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/JeffyCN/xorg-xserver.git</span><br></pre></td></tr></table></figure>

<p>åˆ‡æ¢ç‰ˆæœ¬ï¼Œè¿™é‡Œåˆ‡æ¢åˆ°1.20.11ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git checkout remotes/origin/rockchip/debian/1.20.11</span><br></pre></td></tr></table></figure>

<p>è·å–è¡¥ä¸åŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git format-patch e4f4521ca</span><br></pre></td></tr></table></figure>

<p>æ‰“è¡¥ä¸çš„è„šæœ¬</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">PATCHES_DIR=&quot;$1&quot;  # è¡¥ä¸æ–‡ä»¶æ‰€åœ¨ç›®å½•</span><br><span class="line">SOURCE_DIR=&quot;$2&quot;  # æºç ç›®å½•</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥è¡¥ä¸æ–‡ä»¶ç›®å½•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">if [ ! -d &quot;$PATCHES_DIR&quot; ]; then</span><br><span class="line">  echo &quot;è¡¥ä¸æ–‡ä»¶ç›®å½•ä¸å­˜åœ¨: $PATCHES_DIR&quot;</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥æºç ç›®å½•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">if [ ! -d &quot;$SOURCE_DIR&quot; ]; then</span><br><span class="line">  echo &quot;æºç ç›®å½•ä¸å­˜åœ¨: $SOURCE_DIR&quot;</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–è¡¥ä¸æ–‡ä»¶åˆ—è¡¨ï¼Œå¹¶æŒ‰æ–‡ä»¶åæ’åº</span></span><br><span class="line">PATCH_FILES=$(find &quot;$PATCHES_DIR&quot; -type f -name &quot;*.patch&quot; | sort)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åº”ç”¨æ¯ä¸ªè¡¥ä¸æ–‡ä»¶åˆ°æºç ä¸­</span></span><br><span class="line">for PATCH_FILE in $PATCH_FILES; do</span><br><span class="line">  echo &quot;åº”ç”¨è¡¥ä¸æ–‡ä»¶: $PATCH_FILE&quot;</span><br><span class="line">  patch -d &quot;$SOURCE_DIR&quot; -p1 --no-backup-if-mismatch -f &lt; &quot;$PATCH_FILE&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">æ£€æŸ¥åº”ç”¨è¡¥ä¸æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">  if [ $? -eq 0 ]; then</span><br><span class="line">    echo &quot;è¡¥ä¸æ–‡ä»¶å·²æˆåŠŸåº”ç”¨&quot;</span><br><span class="line">  else</span><br><span class="line">    echo &quot;åº”ç”¨è¡¥ä¸æ–‡ä»¶æ—¶å‡ºé”™&quot;</span><br><span class="line">  fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>è„šæœ¬è¿è¡Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311162144402.png" alt="image-20231116173059788"></p>
<p>åˆ°è¿™é‡Œå°±ä¿®æ”¹å®Œæˆäº†ï¼Œç„¶ååŠ è½½dockeré•œåƒï¼ŒæŒ‚è½½ç›¸åº”çš„ç›®å½•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --privileged -it -v /home/topeet/tmp/xorg:/home/topeet/ ubuntu20</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ä¿®æ”¹ä¸€äº›ç‰ˆæœ¬å·ï¼Œé¦–å…ˆæ˜¯configure.acï¼Œå°†åŸæ¥çš„1.20.8ä¿®æ”¹ä¸º1.20.13</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo vim configure.ac</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311162144390.png" alt="image-20231116141046609"></p>
<p>ç„¶åä¿®æ”¹meson.buildæ–‡ä»¶ï¼Œé€šæ ·ä¿®æ”¹ç‰ˆæœ¬å·ï¼Œä¿®æ”¹å®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311162144393.png" alt="image-20231116141249595"></p>
<p>æœ€åä¿®æ”¹æ„å»ºdebåŒ…çš„debainæ–‡ä»¶ï¼Œå…¶ä¸­çš„debian&#x2F;changelogç”¨æ¥æ§åˆ¶æ„å»ºçš„åç§°ï¼Œç„¶åæ·»åŠ ä¸Šä¸‹é¢è¿™ä¸ªï¼Œè¿™æ ·æœ€åç”Ÿæˆçš„å°±æ˜¯å¯¹åº”åç§°çš„çš„åŒ…äº†ã€‚</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">xorg-server (2:1.20.13-1ubuntu1~20.04.9) focal-security; urgency=medium</span><br><span class="line"></span><br><span class="line">  * SECURITY UPDATE: OOB write in XIChangeDeviceProperty and</span><br><span class="line">    RRChangeOutputProperty</span><br><span class="line">    - debian/patches/CVE-2023-5367.patch: fix handling of PropModeAppend</span><br><span class="line">      and PropModePrepend in Xi/xiproperty.c, randr/rrproperty.c.</span><br><span class="line">    - CVE-2023-5367</span><br><span class="line">  * SECURITY UPDATE: Use-after-free bug in DestroyWindow</span><br><span class="line">    - debian/patches/CVE-2023-5380.patch: reset the PointerWindows</span><br><span class="line">      reference on screen switch in dix/enterleave.h, <span class="keyword">include</span>/eventstr.h,</span><br><span class="line">      mi/mipointer.c.</span><br><span class="line">    - CVE-2023-5380</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œå°±ä¿®æ”¹å®Œæˆäº†ï¼Œç„¶ååŠ è½½dockeré•œåƒï¼ŒæŒ‚è½½ç›¸åº”çš„ç›®å½•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --privileged -it -v /home/topeet/:/home/topeet/ ubuntu20</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿›è¡Œæ„å»ºå³å¯ï¼Œæ„å»ºå®Œæˆå¦‚ä¸‹æ‰€ç¤º	</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo quilt refresh -f</span><br><span class="line">sudo quilt pop -a -f</span><br><span class="line">sudo debian/rules clean</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo DEB_BUILD_OPTIONS=nocheck dpkg-buildpackage -b -d -uc -us -aarm64</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311162144432.png" alt="image-20231116142000186"></p>
<p>æ— è®ºæ˜¯ubuntu20è¿˜æ˜¯ubutnu22åº”è¯¥éƒ½èƒ½ä»¥åŒæ ·çš„æ–¹å¼è¿›è¡Œæ„å»ºxserverçš„åŒ…ï¼Œå®‰è£…gpué©±åŠ¨ä¹‹åä¼šé»‘å±ï¼Œè¿™æ—¶å€™ä¸Šé¢æ„å»ºçš„debåŒ…å°±éœ€è¦å®‰è£…äº†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo DEB_BUILD_OPTIONS=nocheck dpkg-buildpackage -b -d -uc -us -aarm64</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311162144432.png" alt="image-20231116142000186"></p>
<p>è‡ªå·±åšçš„debåŒ…ï¼š<br>1.20.13</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1237Qxwq0u7s6cJwTDF5oyQ </span><br><span class="line">æå–ç ï¼šgh2p </span><br><span class="line">--æ¥è‡ªç™¾åº¦ç½‘ç›˜è¶…çº§ä¼šå‘˜V6çš„åˆ†äº«</span><br></pre></td></tr></table></figure>

<p>æ˜å¤©å†åšubuntu22çš„</p>
<h1 id="19-firefly-ç½‘å€"><a href="#19-firefly-ç½‘å€" class="headerlink" title="19.firefly ç½‘å€"></a>19.firefly ç½‘å€</h1><p><a href="https://wiki.t-firefly.com/zh_CN/Firefly-Linux-Guide/manual_ubuntu.html#shi-pin-ying-jian-bian-jie-ma-zhi-chi">https://wiki.t-firefly.com/zh_CN/Firefly-Linux-Guide/manual_ubuntu.html#shi-pin-ying-jian-bian-jie-ma-zhi-chi</a></p>
<h1 id="20-Rockchip-Graphicsä»‹ç»"><a href="#20-Rockchip-Graphicsä»‹ç»" class="headerlink" title="20.Rockchip Graphicsä»‹ç»"></a>20.Rockchip Graphicsä»‹ç»</h1><p><a href="https://bbs.elecfans.com/jishu_2275817_1_1.html">https://bbs.elecfans.com/jishu_2275817_1_1.html</a></p>
<h1 id="21-ubuntu20-qtçš„ç¼–è¯‘"><a href="#21-ubuntu20-qtçš„ç¼–è¯‘" class="headerlink" title="21.ubuntu20 qtçš„ç¼–è¯‘"></a>21.ubuntu20 qtçš„ç¼–è¯‘</h1><p>dockeråŠ è½½é•œåƒå’Œæºç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --privileged -it -v /home/topeet/Linux/qt/:/home/topeet/ ubuntu20</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311162144377.png" alt="image-20231116143753225"></p>
<h1 id="22-å¼€å‘è°ƒè¯•æµç¨‹ç®€ä»‹"><a href="#22-å¼€å‘è°ƒè¯•æµç¨‹ç®€ä»‹" class="headerlink" title="22.å¼€å‘è°ƒè¯•æµç¨‹ç®€ä»‹"></a>22.å¼€å‘è°ƒè¯•æµç¨‹ç®€ä»‹</h1><p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311162144550.png" alt="image-20231116162242671"></p>
<p>Rockchip_Developer_Guide_Third_Party_System_Adaptation_CN.pdf<br>è¿™ä¸ªpdfæ–‡ä»¶å¾ˆé‡è¦ã€‚</p>
]]></content>
      <categories>
        <category>ç‘èŠ¯å¾®</category>
      </categories>
  </entry>
  <entry>
    <title>PCBå­¦ä¹ </title>
    <url>/2023/11/12/6%20ad%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ä»ä»Šå¤©å¼€å§‹å­¦ä¹ ä¸€ä¸‹PCBçš„å­¦ä¹ ï¼Œæˆ‘å½“ç„¶ä¹Ÿæ˜¯æƒ³ç”»ä¸€äº›é«˜é€ŸPCBæ¿å­ï¼Œé‚£äº›8å±‚çš„ã€10å±‚çš„ï¼Œä½†æ˜¯è·¯è¿˜å¾ˆè¿œï¼Œå¾ˆé•¿ï¼Œæ‰€ä»¥æ…¢æ…¢çš„åŠ æ²¹å§ã€‚</p>
<p>11æœˆ12 æ—¥ï¼Œä»Šå¤©æ¥å­¦ä¹ ç¬¬ä¸€éƒ¨åˆ†ï¼Œè½¯ä»¶çš„å®‰è£…ï¼Œç”±äºä½¿ç”¨çš„æ˜¯ä¸¤å±‚æ¿ï¼Œç‰ˆæœ¬æ˜¯AD19,æ‰€ä»¥è¿™é‡Œè¦å…ˆè¿›è¡Œè½¯ä»¶çš„å®‰è£…å’Œè®¾ç½®ï¼Œåç»­çš„å†…å®¹ï¼Œä¸‹ä¸€ä¸ªæ˜ŸæœŸæ—¥å†è§ã€‚</p>
<h1 id="1-AD-19è½¯ä»¶å®‰è£…å’Œé…ç½®"><a href="#1-AD-19è½¯ä»¶å®‰è£…å’Œé…ç½®" class="headerlink" title="1 AD 19è½¯ä»¶å®‰è£…å’Œé…ç½®"></a>1 AD 19è½¯ä»¶å®‰è£…å’Œé…ç½®</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1gznZRe00REAmoUThExJrCQ </span><br><span class="line">æå–ç ï¼šgtqh </span><br><span class="line">--æ¥è‡ªç™¾åº¦ç½‘ç›˜è¶…çº§ä¼šå‘˜V6çš„åˆ†äº«</span><br></pre></td></tr></table></figure>

<p>ä¸‹è½½ä¹‹åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122054070.png" alt="image-20231112205457032"></p>
<p>å…ˆæ¥å®‰è£…ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122058090.png" alt="image-20231112205829074"></p>
<p>è¿™é‡Œçš„å®‰è£…å€’æ˜¯æ²¡å•¥ï¼Œæ¢ä¸ªä¸­æ–‡ç„¶åä¸‹ä¸€æ­¥å³å¯ï¼Œç­‰å¾…å®‰è£…å®Œæˆï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122059776.png" alt="image-20231112205938748"></p>
<p>ç„¶åæ¥åˆ°Licenseæ–‡ä»¶</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122100769.png" alt="image-20231112210025754"></p>
<p>å°†ä¸¤ä¸ªç”¨äºç ´è§£å’ŒéªŒè¯çš„æ–‡ä»¶æ”¾åˆ°å®‰è£…çš„ADç›®å½•ï¼Œ</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122118366.png" alt="image-20231112211807344"></p>
<p>ç„¶åæ‰“å¼€ADè½¯ä»¶ï¼Œæ‰¾åˆ°add licence</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122119378.png" alt="image-20231112211923345"></p>
<p>ç„¶åæ‰¾åˆ°æ‹·è´è¿‡å»çš„alfæ–‡ä»¶ï¼Œç‚¹å‡»ç¡®å®šï¼Œç ´è§£å®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122123467.png" alt="image-20231112212333451"></p>
<p>ç„¶åè¿›è¡Œä¸­æ–‡çš„åˆ‡æ¢ï¼Œç‚¹å‡»å³ä¸Šè§’çš„å°é½¿è½®ï¼Œè¿›å…¥è®¾ç½®ç•Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122124175.png" alt="image-20231112212448161"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122125573.png" alt="image-20231112212500549"></p>
<p>ç‚¹å‡»ä½¿ç”¨æœ¬åœ°èµ„æºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122125233.png" alt="image-20231112212529208"></p>
<p>è®¾ç½®å®Œæˆä¹‹åï¼Œé‡å¯adè½¯ä»¶å³å¯ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æ˜¯ä¸­æ–‡äº†ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122126032.png" alt="image-20231112212617017"></p>
<p> <a href="http://www.baidu.com/link?url=g5y-7qzhA8Qmd06DRFxhB5NMwanpnh580e8Dyaa7qAnmN373vLCa5UQZL42gPzCSzdfLiKF4PSbBsMfZ7DzTnq"><em>navigation</em></a> å¯¼èˆªï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡åŸç†å›¾å»å¯»æ‰¾PCBï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å³é¢åªæ˜¯ä¿å­˜äº†å…ƒä»¶ï¼Œå…¶ä»–ä¸¤ä¸ªå¯èƒ½å¹¶ä¸å¥½ç”¨</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122130017.png" alt="image-20231112213052978"></p>
<p>ç„¶åæ˜¯design insightï¼Œå°†è¿™äº›å…¨éƒ¨å–æ¶ˆå‹¾é€‰</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122132319.png" alt="image-20231112213241293"></p>
<p>ç„¶åæ˜¯data çš„è‡ªåŠ¨ä¿å­˜ï¼Œè¿™é‡Œè®¾ç½®ååˆ†é’Ÿè‡ªåŠ¨ä¿å­˜ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122133235.png" alt="image-20231112213355211"></p>
<p>åŸç†å›¾ä¸­çš„\ä»£è¡¨è´Ÿä¿¡å·ï¼Œè¿›è¡Œå‹¾é€‰</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122135497.png" alt="image-20231112213527468"></p>
<p>PCBä¸­çš„è®¾ç½®ï¼Œè¿™é‡Œçš„å…‰æ ‡ç±»å‹é€‰æ‹©Large 90ï¼Œç„¶åæ–‡ä»¶æŠ¥å‘Šå¿½ç•¥éƒ½æ‰“å¼€<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122137017.png" alt="image-20231112213743978"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122138876.png" alt="image-20231112213854832"></p>
<p>æ˜¾ç¤ºæŠ¬å¤´é¢œè‰²è¿™é‡Œå–æ¶ˆï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122140678.png" alt="image-20231112214002651"></p>
<p>é¢œè‰²é€‰æ‹©å®å¿ƒè¦†ç›–ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122140402.png" alt="image-20231112214048376"></p>
<p>è¿‡å­”å¤§å°è®¾ç½®ä¸º12 å’Œ 24ï¼Œå¹¶ä¸”iå‹¾é€‰ç›–æ²¹</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122143733.png" alt="image-20231112214328703"></p>
<p>é“œçš®æ“ä½œï¼Œè®¾ç½®å¤§å°ä¸º4å’Œ5ï¼Œç§»é™¤æ­»é“œ</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311122144991.png" alt="image-20231112214442963"></p>
<p>ä¿å­˜å¥½çš„adé…ç½®ç½‘ç›˜é“¾æ¥å¦‚ä¸‹æ‰€ç¤ºï¼š<br>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1EKzwbSOtfkkl_NPCFTDGCw">https://pan.baidu.com/s/1EKzwbSOtfkkl_NPCFTDGCw</a><br>æå–ç ï¼šsd8a<br>â€“æ¥è‡ªç™¾åº¦ç½‘ç›˜è¶…çº§ä¼šå‘˜V6çš„åˆ†äº«</p>
<p>å¯ä»¥ç›´æ¥è¿›è¡Œå¯¼å…¥å³å¯ï¼Œçœå»äº†è¿™ä¸€ç³»åˆ—çš„è®¾ç½®ï¼Œè¿˜æ˜¯æŒºæ–¹ä¾¿çš„ã€‚</p>
<p>&#x3D;&#x3D;11æœˆ12æ—¥ 21ï¼š48å­¦ä¹ å®Œæˆï¼Œä¸‹ä¸€æ¬¡å­¦ä¹ å°±æ˜¯ä¸‹ä¸ªå‘¨æ—¥äº†ï¼Œå¸Œæœ›ä¸ä¼šå¿˜è®°&#x3D;&#x3D;</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
  </entry>
  <entry>
    <title>dockerå­¦ä¹ </title>
    <url>/2023/11/09/5%20docker%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>è¿™æ˜¯æˆ‘å­¦ä¹ dockerçš„ä¸€ä¸ªå‰ææ¡ä»¶ï¼Œåœ¨ä¹‹å‰çš„ä¸€äº›æ—¶é—´ï¼Œæˆ‘ä¹Ÿæ˜¯ç®€å•çš„çœ‹äº†ä¸€ä¸‹dockerï¼Œå½“æ—¶æˆ‘æ˜¯æƒ³ç”¨dockeræ¥è¿›è¡ŒdebåŒ…çš„æ„å»ºçš„ï¼Œä¸ºä»€ä¹ˆæƒ³åˆ°ç”¨dockeräº†å‘¢ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘çœ‹å¤§ä½¬çš„githubå’Œç‘èŠ¯å¾®çš„æŒ‡å¯¼æ‰‹å†Œé‡Œéƒ½ä½¿ç”¨çš„dockerï¼Œå…¶å®è¿™ä¸ªå°±è·Ÿå¼€å‘æ¿ç›´æ¥ç¼–è¯‘çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯dockeræ˜¯åœ¨æœ¬æœºä¸Šï¼Œæ‰€ä»¥æ“ä½œæ›´æµç•…ä¸€äº›ï¼Œè€Œä¸”å¼€å‘æ¿çš„ç¼–è¯‘é€Ÿåº¦ä»¥åŠæ–¹ä¾¿ç¨‹åº¦ï¼Œæ˜¯æœ‰äº›åŒºåˆ«çš„ï¼Œæ‰€ä»¥dockerå°±å‡ºç°äº†ï¼Œå†ç„¶åæˆ‘å‘ç°æºç çš„ç¼–è¯‘é‡Œä¹Ÿæ˜¯å¯ä»¥ç”¨åˆ°dockerçš„ï¼Œæ¯•ç«Ÿä¹Ÿå°±ä»…ä»…æ˜¯ä¸€äº›ç¯å¢ƒè€Œå·²ï¼Œæ‰€ä»¥æˆ‘åˆèŒå‘äº†ç”¨dockerç¼–è¯‘æºç çš„æƒ³æ³•ï¼Œæ‰€ä»¥dockerçš„å­¦ä¹ æ­£å¼å¼€å§‹ã€‚</p>
<p><strong>å¼±å°å’Œæ— çŸ¥ä¸æ˜¯ç”Ÿå­˜çš„éšœç¢ï¼Œå‚²æ…¢æ‰æ˜¯</strong></p>
<p><strong>å”¯æœ‰å‡ºç°éœ€æ±‚ï¼Œä½ çš„ç›®æ ‡å’Œéœ€æ±‚ç›¸åŒ¹é…ï¼Œæ‰æ˜¯å­¦ä¹ æœ€å¿«é€Ÿçš„è·¯å¾„ã€‚</strong></p>
<h1 id="Dockerä¸ºä»€ä¹ˆå‡ºç°"><a href="#Dockerä¸ºä»€ä¹ˆå‡ºç°" class="headerlink" title="Dockerä¸ºä»€ä¹ˆå‡ºç°"></a>Dockerä¸ºä»€ä¹ˆå‡ºç°</h1><p>åœ¨æˆ‘çœ‹æ¥ï¼Œæˆ‘ä¸æ˜¯è¿ç»´äººå‘˜ï¼Œæˆ‘æ˜¯åµŒå…¥å¼è½¯ä»¶å·¥ç¨‹å¸ˆï¼Œç°åœ¨ç¼–è¯‘ä¸€ä¸ªç³»ç»Ÿï¼Œæ¢ä¸€ä¸ªå¼€å‘æ¿ï¼Œä»–ä»¬çš„ç¯å¢ƒéƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™å°±å¾ˆçƒ¦ï¼Œç„¶è€Œdockerå‘¢å°±å¾ˆæ–¹ä¾¿çš„è§£å†³äº†ä¾èµ–è¿™äº›ç›¸å…³çš„é—®é¢˜ï¼Œè€Œä¸”è¿˜å¾ˆå°ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘å­¦ä¹ dockerçš„åŸå› ã€‚</p>
<p>Dockerçš„æ€æƒ³æ¥è‡ªäºé›†è£…ç®±ï¼Œé›†è£…ç®±è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿåœ¨ä¸€è‰˜å¤§èˆ¹ä¸Šï¼Œå¯ä»¥æŠŠè´§ç‰©è§„æ•´çš„æ‘†æ”¾èµ·æ¥ã€‚å¹¶ä¸”å„ç§å„æ ·çš„è´§ç‰©è¢«é›†è£…ç®±æ ‡å‡†åŒ–äº†ï¼Œé›†è£…ç®±å’Œé›†è£…ç®±ä¹‹é—´ä¸ä¼šäº’ç›¸å½±å“ã€‚é‚£ä¹ˆæˆ‘å°±ä¸éœ€è¦ä¸“é—¨è¿é€æ°´æœçš„èˆ¹å’Œä¸“é—¨è¿é€åŒ–å­¦å“çš„èˆ¹äº†ã€‚åªè¦è¿™äº›è´§ç‰©åœ¨é›†è£…ç®±é‡Œå°è£…çš„å¥½å¥½çš„ï¼Œé‚£æˆ‘å°±å¯ä»¥ç”¨ä¸€è‰˜å¤§èˆ¹æŠŠä»–ä»¬éƒ½è¿èµ°ã€‚</p>
<p>Dockeræ˜¯åŸºäºGoè¯­è¨€å®ç°çš„äº‘å¼€æºé¡¹ç›®ã€‚</p>
<p>Dockerçš„ä¸»è¦ç›®æ ‡æ˜¯â€œBuildï¼ŒShip and Run Any App , Anywhereâ€ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡å¯¹åº”ç”¨ç»„ä»¶çš„å°è£…ã€åˆ†å‘ã€éƒ¨ç½²ã€è¿è¡Œç­‰ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ï¼Œä½¿ç”¨æˆ·çš„APPï¼ˆå¯ä»¥æ˜¯ä¸€ä¸ªWEBåº”ç”¨æˆ–æ•°æ®åº“åº”ç”¨ç­‰ç­‰ï¼‰åŠå…¶è¿è¡Œç¯å¢ƒèƒ½å¤Ÿåšåˆ°â€œä¸€æ¬¡å°è£…ï¼Œåˆ°å¤„è¿è¡Œâ€ã€‚Linux å®¹å™¨æŠ€æœ¯çš„å‡ºç°å°±è§£å†³äº†è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œè€Œ Docker å°±æ˜¯åœ¨å®ƒçš„åŸºç¡€ä¸Šå‘å±•è¿‡æ¥çš„ã€‚å°†åº”ç”¨è¿è¡Œåœ¨Docker å®¹å™¨ä¸Šé¢ï¼Œè€Œ Docker å®¹å™¨åœ¨ä»»ä½•æ“ä½œç³»ç»Ÿä¸Šéƒ½æ˜¯ä¸€è‡´çš„ï¼Œè¿™å°±å®ç°äº†è·¨å¹³å°ã€è·¨æœåŠ¡å™¨ã€‚åªéœ€è¦ä¸€æ¬¡é…ç½®å¥½ç¯å¢ƒï¼Œæ¢åˆ°åˆ«çš„æœºå­ä¸Šå°±å¯ä»¥ä¸€é”®éƒ¨ç½²å¥½ï¼Œå¤§å¤§ç®€åŒ–äº†æ“ä½œã€‚</p>
<p><strong>è™šæ‹Ÿæœºçš„ç¼ºç‚¹ï¼š</strong></p>
<p>1ã€èµ„æºå ç”¨å¤š</p>
<p>2ã€å†—ä½™æ­¥éª¤å¤š</p>
<p>3 ã€å¯åŠ¨æ…¢</p>
<p>å®¹å™¨è™šæ‹ŸåŒ–æŠ€æœ¯</p>
<p>ç”±äºå‰é¢è™šæ‹Ÿæœºå­˜åœ¨è¿™äº›ç¼ºç‚¹ï¼ŒLinux å‘å±•å‡ºäº†å¦ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼šLinux å®¹å™¨ï¼ˆLinux Containersï¼Œç¼©å†™ä¸º LXCï¼‰ã€‚</p>
<p>Linux å®¹å™¨ä¸æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯å¯¹è¿›ç¨‹è¿›è¡Œéš”ç¦»ã€‚æœ‰äº†å®¹å™¨ï¼Œå°±å¯ä»¥å°†è½¯ä»¶è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰èµ„æºæ‰“åŒ…åˆ°ä¸€ä¸ªéš”ç¦»çš„å®¹å™¨ä¸­ã€‚å®¹å™¨ä¸è™šæ‹Ÿæœºä¸åŒï¼Œä¸éœ€è¦æ†ç»‘ä¸€æ•´å¥—æ“ä½œç³»ç»Ÿï¼Œåªéœ€è¦è½¯ä»¶å·¥ä½œæ‰€éœ€çš„åº“èµ„æºå’Œè®¾ç½®ã€‚ç³»ç»Ÿå› æ­¤è€Œå˜å¾—é«˜æ•ˆè½»é‡å¹¶ä¿è¯éƒ¨ç½²åœ¨ä»»ä½•ç¯å¢ƒä¸­çš„è½¯ä»¶éƒ½èƒ½å§‹ç»ˆå¦‚ä¸€åœ°è¿è¡Œã€‚</p>
<p>æ¯”è¾ƒäº† Docker å’Œä¼ ç»Ÿè™šæ‹ŸåŒ–æ–¹å¼çš„ä¸åŒä¹‹å¤„ï¼š</p>
<ul>
<li>ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ˜¯è™šæ‹Ÿå‡ºä¸€å¥—ç¡¬ä»¶åï¼Œåœ¨å…¶ä¸Šè¿è¡Œä¸€ä¸ªå®Œæ•´æ“ä½œç³»ç»Ÿï¼Œåœ¨è¯¥ç³»ç»Ÿä¸Šå†è¿è¡Œæ‰€éœ€åº”ç”¨è¿›ç¨‹ï¼›</li>
<li>è€Œå®¹å™¨å†…çš„åº”ç”¨è¿›ç¨‹ç›´æ¥è¿è¡Œäºå®¿ä¸»çš„å†…æ ¸ï¼Œå®¹å™¨å†…æ²¡æœ‰è‡ªå·±çš„å†…æ ¸ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰è¿›è¡Œç¡¬ä»¶è™šæ‹Ÿã€‚å› æ­¤å®¹å™¨è¦æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ›´ä¸ºè½»ä¾¿ã€‚</li>
<li>æ¯ä¸ªå®¹å™¨ä¹‹é—´äº’ç›¸éš”ç¦»ï¼Œæ¯ä¸ªå®¹å™¨æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿ ï¼Œå®¹å™¨ä¹‹é—´è¿›ç¨‹ä¸ä¼šç›¸äº’å½±å“ï¼Œèƒ½åŒºåˆ†è®¡ç®—èµ„æºã€‚</li>
</ul>
<p>å­¦ä¹ é€”å¾„</p>
<p>Dockerå®˜ç½‘ï¼š<a href="http://www.docker.com/">http://www.docker.com</a></p>
<p>Dockerä¸­æ–‡ç½‘ç«™ï¼š<a href="https://www.docker-cn.com/">https://www.docker-cn.com</a></p>
<p>Docker Hubå®˜ç½‘ï¼š<a href="https://hub.docker.com/">https://hub.docker.com</a> ï¼ˆä»“åº“ï¼‰</p>
<p>è¿˜æ˜¯æˆ‘é‚£å¥è¯ï¼Œåªè¦å­¦ä¸æ­»ï¼Œå°±å¾€æ­»é‡Œå­¦ï¼</p>
<h1 id="Dockerå®‰è£…"><a href="#Dockerå®‰è£…" class="headerlink" title="Dockerå®‰è£…"></a>Dockerå®‰è£…</h1><p>æˆ‘è¿™é‡Œå°±ç›´æ¥ä½¿ç”¨ubuntu20 ï¼Œä¹Ÿå°±æ˜¯3588çš„è™šæ‹Ÿæœºäº†ï¼Œæˆ‘è¦è™šæ‹Ÿä¸€ä¸ªubuntu20çš„dockerå®¹å™¨ï¼Œè¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªç›®çš„ã€‚</p>
<p>1.å®‰è£…gcc g++ç›¸å…³ç¯å¢ƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apt-get -y install gcc g++</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028310.png" alt="image-20231110095659265"></p>
<p>ç¡®ä¿ä¹‹å‰çš„dockeråˆ é™¤æ‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for pkg in docker.io docker-doc docker-compose docker-compose-v2 podman-docker containerd runc; do sudo apt-get remove $pkg; done</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028358.png" alt="image-20231110100326456"></p>
<p>ç„¶åè®¾ç½®é•œåƒä»“åº“</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Add Docker<span class="string">&#x27;s official GPG key:</span></span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install ca-certificates curl gnupg</span><br><span class="line">sudo install -m 0755 -d /etc/apt/keyrings</span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span><br><span class="line">sudo chmod a+r /etc/apt/keyrings/docker.gpg</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Add the repository to Apt sources:</span></span></span><br><span class="line">echo \</span><br><span class="line">  &quot;deb [arch=&quot;$(dpkg --print-architecture)&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \</span><br><span class="line">  &quot;$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;)&quot; stable&quot; | \</span><br><span class="line">  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028368.png" alt="image-20231110100407513"></p>
<p>æ¥ä¸‹æ¥å®‰è£…docker</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028314.png" alt="image-20231110100446286"></p>
<p>æµ‹è¯•docker helloworld</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028319.png" alt="image-20231110100628135"></p>
<p>é¦–å…ˆæœ¬åœ°æ˜¯æ²¡æœ‰dockerçš„helloworldé•œåƒçš„ï¼Œæ‰€ä»¥ä»–ä¼šé¦–å…ˆä»dockerhubæ‹‰å–helloworldé•œåƒï¼Œç„¶åå¼€å§‹è¿è¡Œï¼Œåˆ°è¿™é‡Œdockerå°±å®‰è£…å®Œæˆäº†ã€‚</p>
<p>ç„¶åå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç›®å‰ç³»ç»Ÿä¸­æœ‰å“ªäº›dockeré•œåƒã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028329.png" alt="image-20231110101205930"></p>
<h1 id="é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ"><a href="#é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ" class="headerlink" title="é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ"></a>é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ</h1><p>ç”±äºå›½å¤–çš„dockerhubå¤ªæ…¢äº†ã€‚æ‹‰å–ä¸€äº›é•œåƒéå¸¸æ…¢ï¼Œæ‰€ä»¥å°±éœ€è¦æ›´æ¢å›½å†…çš„æºæ¥è¿›è¡ŒåŠ é€Ÿ</p>
<p>1ã€ä»‹ç»ï¼š<a href="https://www.aliyun.com/product/acr">https://www.aliyun.com/product/acr</a></p>
<p>2ã€æ³¨å†Œä¸€ä¸ªå±äºè‡ªå·±çš„é˜¿é‡Œäº‘è´¦æˆ·(å¯å¤ç”¨æ·˜å®è´¦å·)</p>
<p>3ã€è¿›å…¥ç®¡ç†æ§åˆ¶å°è®¾ç½®å¯†ç ï¼Œå¼€é€š</p>
<p>4ã€æŸ¥çœ‹é•œåƒåŠ é€Ÿå™¨è‡ªå·±çš„</p>
<p><a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p>
<p>é’ˆå¯¹Dockerå®¢æˆ·ç«¯ç‰ˆæœ¬å¤§äº 1.10.0 çš„ç”¨æˆ·</p>
<p>æ‚¨å¯ä»¥é€šè¿‡ä¿®æ”¹daemoné…ç½®æ–‡ä»¶&#x2F;etc&#x2F;docker&#x2F;daemon.jsonæ¥ä½¿ç”¨åŠ é€Ÿå™¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://4cmfmhps.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028744.png" alt="image-20231110101800496"></p>
<h1 id="Dockerå¸¸ç”¨å‘½ä»¤"><a href="#Dockerå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Dockerå¸¸ç”¨å‘½ä»¤"></a>Dockerå¸¸ç”¨å‘½ä»¤</h1><h2 id="å¸®åŠ©å‘½ä»¤"><a href="#å¸®åŠ©å‘½ä»¤" class="headerlink" title="å¸®åŠ©å‘½ä»¤"></a>å¸®åŠ©å‘½ä»¤</h2><p>docker version # æ˜¾ç¤º Docker ç‰ˆæœ¬ä¿¡æ¯ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028784.png" alt="image-20231110101930475"></p>
<p>docker info # æ˜¾ç¤º Docker ç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬é•œåƒå’Œå®¹å™¨æ•°ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028763.png" alt="image-20231110101954091"></p>
<p>docker â€“help # å¸®åŠ©</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028769.png" alt="image-20231110102010973"></p>
<h2 id="é•œåƒå‘½ä»¤"><a href="#é•œåƒå‘½ä»¤" class="headerlink" title="é•œåƒå‘½ä»¤"></a>é•œåƒå‘½ä»¤</h2><h3 id="docker-images"><a href="#docker-images" class="headerlink" title="docker images"></a>docker images</h3><p>åˆ—å‡ºæœ¬åœ°ä¸»æœºä¸Šçš„é•œåƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028775.png" alt="image-20231110102117914"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Š</span></span><br><span class="line">REPOSITORY é•œåƒçš„ä»“åº“æº</span><br><span class="line">TAG é•œåƒçš„æ ‡ç­¾</span><br><span class="line">IMAGE ID é•œåƒçš„ID</span><br><span class="line">CREATED é•œåƒåˆ›å»ºæ—¶é—´</span><br><span class="line">SIZE é•œåƒå¤§å°</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŒä¸€ä¸ªä»“åº“æºå¯ä»¥æœ‰å¤šä¸ª TAGï¼Œä»£è¡¨è¿™ä¸ªä»“åº“æºçš„ä¸åŒç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä½¿ç”¨REPOSITORYï¼šTAG å®šä¹‰ä¸åŒ</span></span><br><span class="line">çš„é•œåƒï¼Œå¦‚æœä½ ä¸å®šä¹‰é•œåƒçš„æ ‡ç­¾ç‰ˆæœ¬ï¼Œdockerå°†é»˜è®¤ä½¿ç”¨ lastest é•œåƒï¼</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯é€‰é¡¹</span></span><br><span class="line">-aï¼š åˆ—å‡ºæœ¬åœ°æ‰€æœ‰é•œåƒ</span><br><span class="line">-qï¼š åªæ˜¾ç¤ºé•œåƒid</span><br><span class="line">--digestsï¼š æ˜¾ç¤ºé•œåƒçš„æ‘˜è¦ä¿¡æ¯</span><br></pre></td></tr></table></figure>

<h3 id="docker-search"><a href="#docker-search" class="headerlink" title="docker search"></a>docker search</h3><p>æœç´¢é•œåƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker search mysql</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028862.png" alt="image-20231110102407460"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker search æŸä¸ªé•œåƒçš„åç§° å¯¹åº”DockerHubä»“åº“ä¸­çš„é•œåƒ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯é€‰é¡¹</span></span><br><span class="line">--filter=stars=50 ï¼š åˆ—å‡ºæ”¶è—æ•°ä¸å°äºæŒ‡å®šå€¼çš„é•œåƒã€‚</span><br></pre></td></tr></table></figure>

<h3 id="docker-pull"><a href="#docker-pull" class="headerlink" title="docker pull"></a>docker pull</h3><p>ä¸‹è½½é•œåƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker pull mysql</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028173.png" alt="image-20231110102532256"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">ä¸å†™tagï¼Œé»˜è®¤æ˜¯latest</span></span><br><span class="line"> sha256:61a2a33f4b8b4bc93b7b6b9e65e64044aaec594809f818aeffbff69a893d1944 #</span><br><span class="line">ç­¾å</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest # çœŸå®ä½ç½®</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŒ‡å®šç‰ˆæœ¬ä¸‹è½½</span></span><br><span class="line">docker pull mysql:5.7</span><br></pre></td></tr></table></figure>



<h3 id="docker-rmi"><a href="#docker-rmi" class="headerlink" title="docker rmi"></a>docker rmi</h3><p>åˆ é™¤é•œåƒ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤é•œåƒ</span></span><br><span class="line">docker rmi -f é•œåƒid # åˆ é™¤å•ä¸ª</span><br><span class="line">docker rmi -f é•œåƒå:tag é•œåƒå:tag # åˆ é™¤å¤šä¸ª</span><br><span class="line">docker rmi -f $(docker images -qa) # åˆ é™¤å…¨éƒ¨</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028206.png" alt="image-20231110102733970"></p>
<h2 id="å®¹å™¨å‘½ä»¤"><a href="#å®¹å™¨å‘½ä»¤" class="headerlink" title="å®¹å™¨å‘½ä»¤"></a>å®¹å™¨å‘½ä»¤</h2><p>æœ‰é•œåƒæ‰èƒ½åˆ›å»ºå®¹å™¨ï¼Œç‹‚ç¥çš„æ˜¯cenosï¼Œæˆ‘è¿™é‡Œè‚¯å®šç”¨ubuntuï¼Œçº¿æœç´¢ä¸€ä¸‹ubuntu</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028184.png" alt="image-20231110103746806"></p>
<p>ç„¶åæˆ‘è¿™é‡Œæ‹‰å–ubuntu20.04çš„é•œåƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker pull ubuntu:20.04</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028215.png" alt="image-20231110103933502"></p>
<h3 id="docker-run"><a href="#docker-run" class="headerlink" title="docker run"></a>docker run</h3><p>æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‘½ä»¤</span></span><br><span class="line">docker run [OPTIONS] IMAGE [COMMAND][ARG...]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¸¸ç”¨å‚æ•°è¯´æ˜</span></span><br><span class="line">--name=&quot;Name&quot; # ç»™å®¹å™¨æŒ‡å®šä¸€ä¸ªåå­—</span><br><span class="line">-d # åå°æ–¹å¼è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨çš„idï¼</span><br><span class="line">-i # ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šè¿‡å’Œ -t ä¸€èµ·ä½¿ç”¨</span><br><span class="line">-t # ç»™å®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªç»ˆç«¯ï¼Œé€šå¸¸å’Œ -i ä¸€èµ·ä½¿ç”¨</span><br><span class="line">-P # éšæœºç«¯å£æ˜ å°„ï¼ˆå¤§å†™ï¼‰</span><br><span class="line">-p # æŒ‡å®šç«¯å£æ˜ å°„ï¼ˆå°ç»“ï¼‰ï¼Œä¸€èˆ¬å¯ä»¥æœ‰å››ç§å†™æ³•</span><br><span class="line">ip:hostPort:containerPort</span><br><span class="line">ip::containerPort</span><br><span class="line">hostPort:containerPort (å¸¸ç”¨)</span><br><span class="line">containerPort</span><br></pre></td></tr></table></figure>

<p>å…ˆä½¿ç”¨ docker imageså‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹æ‹‰å–çš„é•œåƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028178.png" alt="image-20231110104246665"></p>
<p>ä½¿ç”¨ubuntuè¿›è¡Œç”¨äº¤äº’æ¨¡å¼å¯åŠ¨å®¹å™¨ï¼Œåœ¨å®¹å™¨å†…æ‰§è¡Œ&#x2F;bin&#x2F;bashå‘½ä»¤ï¼</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it ubuntu:20.04 /bin/bash</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028212.png" alt="image-20231110104414762"></p>
<p>&#x3D;&#x3D;æ³¨æ„ï¼Œè¿™é‡Œè¦æ·»åŠ tagæ ‡ç­¾ï¼Œä¸ç„¶æ— æ³•æˆåŠŸ&#x3D;&#x3D;</p>
<p>æœ€åä½¿ç”¨exité€€å‡ºé•œåƒå³å¯ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028464.png" alt="image-20231110104527685"></p>
<h3 id="docker-ps"><a href="#docker-ps" class="headerlink" title="docker ps"></a>docker ps</h3><p>åˆ—å‡ºæ‰€æœ‰å®¹å™¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‘½ä»¤</span></span><br><span class="line">docker ps [OPTIONS]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¸¸ç”¨å‚æ•°è¯´æ˜</span></span><br><span class="line">-a # åˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ + å†å²è¿è¡Œè¿‡çš„å®¹å™¨</span><br><span class="line">-l # æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨</span><br><span class="line">-n=? # æ˜¾ç¤ºæœ€è¿‘nä¸ªåˆ›å»ºçš„å®¹å™¨</span><br><span class="line">-q # é™é»˜æ¨¡å¼ï¼Œåªæ˜¾ç¤ºå®¹å™¨ç¼–å·ã€‚</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028606.png" alt="image-20231110104629549"></p>
<h3 id="exit"><a href="#exit" class="headerlink" title="exit"></a>exit</h3><p>é€€å‡ºå®¹å™¨</p>
<h3 id="docker-start"><a href="#docker-start" class="headerlink" title="docker start"></a>docker start</h3><p>å¯åŠ¨å®¹å™¨</p>
<p>éœ€è¦æ³¨æ„ï¼š&#x3D;&#x3D;<code>docker run</code>ç”¨äºåˆ›å»ºå’Œå¯åŠ¨æ–°çš„å®¹å™¨ï¼Œå¹¶å¯ä»¥æŒ‡å®šè¦åœ¨å®¹å™¨å†…æ‰§è¡Œçš„å‘½ä»¤ï¼Œè€Œ<code>docker start</code>ä»…ç”¨äºå¯åŠ¨å·²ç»å­˜åœ¨ä½†ç›®å‰åœæ­¢çš„å®¹å™¨ã€‚&#x3D;&#x3D;</p>
<h3 id="docker-restart"><a href="#docker-restart" class="headerlink" title="docker restart"></a>docker restart</h3><p> é‡å¯å®¹å™¨</p>
<h3 id="docker-stop"><a href="#docker-stop" class="headerlink" title="docker stop"></a>docker stop</h3><p>åœæ­¢å®¹å™¨</p>
<h3 id="docker-kill"><a href="#docker-kill" class="headerlink" title="docker kill"></a>docker kill</h3><p> å¼ºåˆ¶åœæ­¢å®¹å™¨</p>
<h3 id="docker-rm"><a href="#docker-rm" class="headerlink" title="docker rm"></a>docker rm</h3><p>åˆ é™¤å®¹å™¨</p>
<h2 id="å…¶ä»–å¸¸ç”¨å‘½ä»¤"><a href="#å…¶ä»–å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å…¶ä»–å¸¸ç”¨å‘½ä»¤"></a>å…¶ä»–å¸¸ç”¨å‘½ä»¤</h2><h3 id="docker-run-d"><a href="#docker-run-d" class="headerlink" title="docker run -d"></a>docker run -d</h3><p>åå°å¯åŠ¨å®¹å™¨</p>
<h3 id="docker-logs-f-t-â€“tail"><a href="#docker-logs-f-t-â€“tail" class="headerlink" title="docker logs -f -t â€“tail"></a>docker logs -f -t â€“tail</h3><p>æŸ¥çœ‹æ—¥å¿—</p>
<h3 id="docker-top"><a href="#docker-top" class="headerlink" title="docker top"></a>docker top</h3><p>æŸ¥çœ‹å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯</p>
<h3 id="docker-inspect"><a href="#docker-inspect" class="headerlink" title="docker inspect"></a>docker inspect</h3><p>æŸ¥çœ‹å®¹å™¨&#x2F;é•œåƒçš„å…ƒæ•°æ®</p>
<h3 id="docker-exec-it"><a href="#docker-exec-it" class="headerlink" title="docker exec -it"></a>docker exec -it</h3><p>è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨</p>
<h3 id="docker-cp"><a href="#docker-cp" class="headerlink" title="docker cp"></a>docker cp</h3><p>ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š</p>
<p>&#x3D;&#x3D;ä¸€èˆ¬ç”¨çš„ä¸å¤šå§ï¼Œä¸€èˆ¬éƒ½æ˜¯ç›´æ¥å·çš„æŒ‚è½½&#x3D;&#x3D;</p>
<h1 id="docker-commit"><a href="#docker-commit" class="headerlink" title="docker commit"></a><strong>docker commit</strong></h1><p>ä»å®¹å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒï¼Œç±»ä¼¼äºè™šæ‹Ÿæœºçš„å¿«ç…§ç›¸å…³çš„ä¸œè¥¿ï¼Œä½†æ˜¯åé¢çš„dockerfileå®ç°çš„æ˜¯ä¸€ä¸ªå½¢åŒçš„ç›®çš„ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥å»åˆ°dockerfile</p>
<h1 id="æŒ‚è½½å·"><a href="#æŒ‚è½½å·" class="headerlink" title="æŒ‚è½½å·"></a>æŒ‚è½½å·</h1><p>è¿™ä¸ªæ–¹æ³•å¾ˆé‡è¦ï¼Œä»¥åçš„æŒ‚è½½æ„å»ºé•œåƒä»¥åŠæ„ç³»ç»Ÿæºç è¿›è¡Œç¼–è¯‘éƒ½è¦ç”¨è¿™ä¸ªï¼Œä½†æ˜¯åé¢çš„æŒ‚è½½æˆ‘è¿˜ä¸æ˜¯å¾ˆæ‡‚ï¼Œè¿™é‡Œåé¢è¦åœ¨çœ‹çœ‹ã€‚</p>
<h1 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h1><p>dockerfileæ˜¯ç”¨æ¥æ„å»ºDockeré•œåƒçš„æ„å»ºæ–‡ä»¶ï¼Œæ˜¯ç”±ä¸€ç³»åˆ—å‘½ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ã€‚</p>
<p>æ„å»ºæ­¥éª¤ï¼š</p>
<p>1ã€ç¼–å†™DockerFileæ–‡ä»¶</p>
<p>2ã€docker build æ„å»ºé•œåƒ</p>
<p>3ã€docker run</p>
<p><strong>DockerFile****æ„å»ºè¿‡ç¨‹</strong></p>
<p><strong>åŸºç¡€çŸ¥è¯†ï¼š</strong></p>
<p>1ã€æ¯æ¡ä¿ç•™å­—æŒ‡ä»¤éƒ½å¿…é¡»ä¸ºå¤§å†™å­—æ¯ä¸”åé¢è¦è·Ÿéšè‡³å°‘ä¸€ä¸ªå‚æ•°</p>
<p>2ã€æŒ‡ä»¤æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹ï¼Œé¡ºåºæ‰§è¡Œ</p>
<p>3ã€# è¡¨ç¤ºæ³¨é‡Š</p>
<p>4ã€æ¯æ¡æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚ï¼Œå¹¶å¯¹é•œåƒè¿›è¡Œæäº¤</p>
<p><strong>æµç¨‹ï¼š</strong></p>
<p>1ã€dockerä»åŸºç¡€é•œåƒè¿è¡Œä¸€ä¸ªå®¹å™¨</p>
<p>2ã€æ‰§è¡Œä¸€æ¡æŒ‡ä»¤å¹¶å¯¹å®¹å™¨åšå‡ºä¿®æ”¹</p>
<p>3ã€æ‰§è¡Œç±»ä¼¼ docker commit çš„æ“ä½œæäº¤ä¸€ä¸ªæ–°çš„é•œåƒå±‚</p>
<p>4ã€Dockerå†åŸºäºåˆšæäº¤çš„é•œåƒè¿è¡Œä¸€ä¸ªæ–°å®¹å™¨</p>
<p>5ã€æ‰§è¡Œdockerfileä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ç›´åˆ°æ‰€æœ‰æŒ‡ä»¤éƒ½æ‰§è¡Œå®Œæˆï¼</p>
<p><strong>è¯´æ˜ï¼š</strong></p>
<p>ä»åº”ç”¨è½¯ä»¶çš„è§’åº¦æ¥çœ‹ï¼ŒDockerFileï¼Œdockeré•œåƒä¸dockerå®¹å™¨åˆ†åˆ«ä»£è¡¨è½¯ä»¶çš„ä¸‰ä¸ªä¸åŒé˜¶æ®µã€‚</p>
<p>DockerFile æ˜¯è½¯ä»¶çš„åŸææ–™ ï¼ˆä»£ç ï¼‰</p>
<p>Docker é•œåƒåˆ™æ˜¯è½¯ä»¶çš„äº¤ä»˜å“ ï¼ˆ.apkï¼‰</p>
<p>Docker å®¹å™¨åˆ™æ˜¯è½¯ä»¶çš„è¿è¡ŒçŠ¶æ€ ï¼ˆå®¢æˆ·ä¸‹è½½å®‰è£…æ‰§è¡Œï¼‰</p>
<p>DockerFile é¢å‘å¼€å‘ï¼ŒDockeré•œåƒæˆä¸ºäº¤ä»˜æ ‡å‡†ï¼ŒDockerå®¹å™¨åˆ™æ¶‰åŠéƒ¨ç½²ä¸è¿ç»´ï¼Œä¸‰è€…ç¼ºä¸€ä¸å¯ï¼</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FROM # åŸºç¡€é•œåƒï¼Œå½“å‰æ–°é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒçš„</span><br><span class="line">MAINTAINER # é•œåƒç»´æŠ¤è€…çš„å§“åæ··åˆé‚®ç®±åœ°å€</span><br><span class="line">RUN # å®¹å™¨æ„å»ºæ—¶éœ€è¦è¿è¡Œçš„å‘½ä»¤</span><br><span class="line">EXPOSE # å½“å‰å®¹å™¨å¯¹å¤–ä¿ç•™å‡ºçš„ç«¯å£</span><br><span class="line">WORKDIR # æŒ‡å®šåœ¨åˆ›å»ºå®¹å™¨åï¼Œç»ˆç«¯é»˜è®¤ç™»å½•çš„è¿›æ¥å·¥ä½œç›®å½•ï¼Œä¸€ä¸ªè½è„šç‚¹</span><br><span class="line">ENV # ç”¨æ¥åœ¨æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡</span><br><span class="line">ADD # å°†å®¿ä¸»æœºç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´è¿›é•œåƒä¸”ADDå‘½ä»¤ä¼šè‡ªåŠ¨å¤„ç†URLå’Œè§£å‹tarå‹ç¼©åŒ…</span><br><span class="line">COPY # ç±»ä¼¼ADDï¼Œæ‹·è´æ–‡ä»¶å’Œç›®å½•åˆ°é•œåƒä¸­ï¼</span><br><span class="line">VOLUME # å®¹å™¨æ•°æ®å·ï¼Œç”¨äºæ•°æ®ä¿å­˜å’ŒæŒä¹…åŒ–å·¥ä½œ</span><br><span class="line">CMD # æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ï¼ŒdockerFileä¸­å¯ä»¥æœ‰å¤šä¸ªCMDæŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€</span><br><span class="line">åä¸€ä¸ªç”Ÿæ•ˆï¼</span><br><span class="line">ENTRYPOINT # æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ï¼å’ŒCMDä¸€æ ·</span><br><span class="line">ONBUILD # å½“æ„å»ºä¸€ä¸ªè¢«ç»§æ‰¿çš„DockerFileæ—¶è¿è¡Œå‘½ä»¤ï¼Œçˆ¶é•œåƒåœ¨è¢«å­é•œåƒç»§æ‰¿åï¼Œçˆ¶é•œåƒçš„</span><br><span class="line">ONBUILDè¢«è§¦å‘</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™å®Œä¸€ä¸ªå®Œæ•´çš„dockerfileæ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">20.04</span></span><br><span class="line"><span class="keyword">ARG</span> DEBIAN_FRONTEND=noninteractive</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; apt-get install -y --no-install-recommends \</span></span><br><span class="line"><span class="language-bash">       gnupg \</span></span><br><span class="line"><span class="language-bash">       gnupg1 \</span></span><br><span class="line"><span class="language-bash">       gpgv1 \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dpkg --add-architecture i386</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; apt-get -y upgrade \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; apt-get install -y --no-install-recommends \</span></span><br><span class="line"><span class="language-bash">       acl \</span></span><br><span class="line"><span class="language-bash">       aptly \</span></span><br><span class="line"><span class="language-bash">       aria2 \</span></span><br><span class="line"><span class="language-bash">       bc \</span></span><br><span class="line"><span class="language-bash">       binfmt-support \</span></span><br><span class="line"><span class="language-bash">       binutils \</span></span><br><span class="line"><span class="language-bash">       bison \</span></span><br><span class="line"><span class="language-bash">       btrfs-progs \</span></span><br><span class="line"><span class="language-bash">       build-essential \</span></span><br><span class="line"><span class="language-bash">       ca-certificates \</span></span><br><span class="line"><span class="language-bash">       ccache \</span></span><br><span class="line"><span class="language-bash">       cpio \</span></span><br><span class="line"><span class="language-bash">       cryptsetup \</span></span><br><span class="line"><span class="language-bash">       cryptsetup-bin \</span></span><br><span class="line"><span class="language-bash">       curl \</span></span><br><span class="line"><span class="language-bash">       debian-archive-keyring \</span></span><br><span class="line"><span class="language-bash">       debian-keyring \</span></span><br><span class="line"><span class="language-bash">       debootstrap \</span></span><br><span class="line"><span class="language-bash">       device-tree-compiler \</span></span><br><span class="line"><span class="language-bash">       dialog \</span></span><br><span class="line"><span class="language-bash">       dosfstools \</span></span><br><span class="line"><span class="language-bash">       f2fs-tools \</span></span><br><span class="line"><span class="language-bash">       fakeroot \</span></span><br><span class="line"><span class="language-bash">       flex \</span></span><br><span class="line"><span class="language-bash">       gawk \</span></span><br><span class="line"><span class="language-bash">       git \</span></span><br><span class="line"><span class="language-bash">       imagemagick \</span></span><br><span class="line"><span class="language-bash">       kmod \</span></span><br><span class="line"><span class="language-bash">       lib32ncurses6 \</span></span><br><span class="line"><span class="language-bash">       lib32stdc++6 \</span></span><br><span class="line"><span class="language-bash">       lib32tinfo6 \</span></span><br><span class="line"><span class="language-bash">       libbison-dev \</span></span><br><span class="line"><span class="language-bash">       libc6-dev-armhf-cross \</span></span><br><span class="line"><span class="language-bash">       libc6-i386 \</span></span><br><span class="line"><span class="language-bash">       libfile-fcntllock-perl \</span></span><br><span class="line"><span class="language-bash">       libfl-dev \</span></span><br><span class="line"><span class="language-bash">       liblz4-tool \</span></span><br><span class="line"><span class="language-bash">       libncurses5-dev \</span></span><br><span class="line"><span class="language-bash">       libpython2.7-dev \</span></span><br><span class="line"><span class="language-bash">       libpython3-dev \</span></span><br><span class="line"><span class="language-bash">       libssl-dev \</span></span><br><span class="line"><span class="language-bash">       libusb-1.0-0-dev \</span></span><br><span class="line"><span class="language-bash">       linux-base \</span></span><br><span class="line"><span class="language-bash">       locales \</span></span><br><span class="line"><span class="language-bash">       lsb-release \</span></span><br><span class="line"><span class="language-bash">       lzop \</span></span><br><span class="line"><span class="language-bash">       ncurses-base \</span></span><br><span class="line"><span class="language-bash">       ncurses-term \</span></span><br><span class="line"><span class="language-bash">       nfs-kernel-server \</span></span><br><span class="line"><span class="language-bash">       ntpdate \</span></span><br><span class="line"><span class="language-bash">       p7zip-full \</span></span><br><span class="line"><span class="language-bash">       parted \</span></span><br><span class="line"><span class="language-bash">       patchutils \</span></span><br><span class="line"><span class="language-bash">       pigz \</span></span><br><span class="line"><span class="language-bash">       pixz \</span></span><br><span class="line"><span class="language-bash">       pkg-config \</span></span><br><span class="line"><span class="language-bash">       psmisc \</span></span><br><span class="line"><span class="language-bash">       pv \</span></span><br><span class="line"><span class="language-bash">       python2 \</span></span><br><span class="line"><span class="language-bash">       python3 \</span></span><br><span class="line"><span class="language-bash">       python3-dev \</span></span><br><span class="line"><span class="language-bash">       python3-distutils \</span></span><br><span class="line"><span class="language-bash">       qemu-user-static \</span></span><br><span class="line"><span class="language-bash">       rsync \</span></span><br><span class="line"><span class="language-bash">       swig \</span></span><br><span class="line"><span class="language-bash">       systemd-container \</span></span><br><span class="line"><span class="language-bash">       tzdata \</span></span><br><span class="line"><span class="language-bash">       u-boot-tools \</span></span><br><span class="line"><span class="language-bash">       udev \</span></span><br><span class="line"><span class="language-bash">       unzip \</span></span><br><span class="line"><span class="language-bash">       uuid-dev \</span></span><br><span class="line"><span class="language-bash">       wget \</span></span><br><span class="line"><span class="language-bash">       whiptail \</span></span><br><span class="line"><span class="language-bash">       xxd \</span></span><br><span class="line"><span class="language-bash">       zip \</span></span><br><span class="line"><span class="language-bash">       zlib1g-dev \</span></span><br><span class="line"><span class="language-bash">       zlib1g:i386 \</span></span><br><span class="line"><span class="language-bash">       sudo \</span></span><br><span class="line"><span class="language-bash">       vim \</span></span><br><span class="line"><span class="language-bash">       uuid \</span></span><br><span class="line"><span class="language-bash">       uuid-dev \</span></span><br><span class="line"><span class="language-bash">       zlib1g-dev \</span></span><br><span class="line"><span class="language-bash">       liblz-dev \</span></span><br><span class="line"><span class="language-bash">       liblzo2-2 \</span></span><br><span class="line"><span class="language-bash">       liblzo2-dev \</span></span><br><span class="line"><span class="language-bash">       lzop \</span></span><br><span class="line"><span class="language-bash">       git \</span></span><br><span class="line"><span class="language-bash">       curl \</span></span><br><span class="line"><span class="language-bash">       u-boot-tools \</span></span><br><span class="line"><span class="language-bash">       mtd-utils \</span></span><br><span class="line"><span class="language-bash">       openjdk-8-jdk \</span></span><br><span class="line"><span class="language-bash">       device-tree-compiler \</span></span><br><span class="line"><span class="language-bash">       gdisk \</span></span><br><span class="line"><span class="language-bash">       m4 \</span></span><br><span class="line"><span class="language-bash">       zlib1g-dev \</span></span><br><span class="line"><span class="language-bash">       git \</span></span><br><span class="line"><span class="language-bash">       gnupg \</span></span><br><span class="line"><span class="language-bash">       flex \</span></span><br><span class="line"><span class="language-bash">       bison \</span></span><br><span class="line"><span class="language-bash">       gperf \</span></span><br><span class="line"><span class="language-bash">       libsdl1.2-dev \</span></span><br><span class="line"><span class="language-bash">       libesd-java \</span></span><br><span class="line"><span class="language-bash">       squashfs-tools \</span></span><br><span class="line"><span class="language-bash">       build-essential \</span></span><br><span class="line"><span class="language-bash">       zip \</span></span><br><span class="line"><span class="language-bash">       curl \</span></span><br><span class="line"><span class="language-bash">       libncurses5-dev \</span></span><br><span class="line"><span class="language-bash">       zlib1g-dev \</span></span><br><span class="line"><span class="language-bash">       pngcrush \</span></span><br><span class="line"><span class="language-bash">       schedtool \</span></span><br><span class="line"><span class="language-bash">       libxml2 \</span></span><br><span class="line"><span class="language-bash">       libxml2-utils \</span></span><br><span class="line"><span class="language-bash">       xsltproc \</span></span><br><span class="line"><span class="language-bash">       lzop \</span></span><br><span class="line"><span class="language-bash">       libc6-dev \</span></span><br><span class="line"><span class="language-bash">       schedtool \</span></span><br><span class="line"><span class="language-bash">       g++-multilib \</span></span><br><span class="line"><span class="language-bash">       lib32z1-dev \</span></span><br><span class="line"><span class="language-bash">       lib32ncurses-dev \</span></span><br><span class="line"><span class="language-bash">       lib32readline-dev \</span></span><br><span class="line"><span class="language-bash">       gcc-multilib \</span></span><br><span class="line"><span class="language-bash">       libswitch-perl \</span></span><br><span class="line"><span class="language-bash">       libssl-dev \</span></span><br><span class="line"><span class="language-bash">       unzip \</span></span><br><span class="line"><span class="language-bash">       zip \</span></span><br><span class="line"><span class="language-bash">       liblz4-tool \</span></span><br><span class="line"><span class="language-bash">       git \</span></span><br><span class="line"><span class="language-bash">       ssh \</span></span><br><span class="line"><span class="language-bash">       make \</span></span><br><span class="line"><span class="language-bash">       gcc \</span></span><br><span class="line"><span class="language-bash">       libssl-dev \</span></span><br><span class="line"><span class="language-bash">       liblz4-tool \</span></span><br><span class="line"><span class="language-bash">       vim \</span></span><br><span class="line"><span class="language-bash">       expect \</span></span><br><span class="line"><span class="language-bash">       g++ \</span></span><br><span class="line"><span class="language-bash">       patchelf \</span></span><br><span class="line"><span class="language-bash">       chrpath \</span></span><br><span class="line"><span class="language-bash">       gawk \</span></span><br><span class="line"><span class="language-bash">       texinfo \</span></span><br><span class="line"><span class="language-bash">       chrpath \</span></span><br><span class="line"><span class="language-bash">       diffstat \</span></span><br><span class="line"><span class="language-bash">       binfmt-support \</span></span><br><span class="line"><span class="language-bash">       qemu-user-static \</span></span><br><span class="line"><span class="language-bash">       live-build \</span></span><br><span class="line"><span class="language-bash">       bison \</span></span><br><span class="line"><span class="language-bash">       flex \</span></span><br><span class="line"><span class="language-bash">       fakeroot \</span></span><br><span class="line"><span class="language-bash">       cmake \</span></span><br><span class="line"><span class="language-bash">       gcc-multilib \</span></span><br><span class="line"><span class="language-bash">       g++-multilib \</span></span><br><span class="line"><span class="language-bash">       unzip \</span></span><br><span class="line"><span class="language-bash">       device-tree-compiler \</span></span><br><span class="line"><span class="language-bash">       python3-pip \</span></span><br><span class="line"><span class="language-bash">       libncurses5-dev \</span></span><br><span class="line"><span class="language-bash">       rsync \</span></span><br><span class="line"><span class="language-bash">       subversion \</span></span><br><span class="line"><span class="language-bash">       sed \</span></span><br><span class="line"><span class="language-bash">       make \</span></span><br><span class="line"><span class="language-bash">       binutils \</span></span><br><span class="line"><span class="language-bash">       build-essential \</span></span><br><span class="line"><span class="language-bash">       gcc \</span></span><br><span class="line"><span class="language-bash">       g++ \</span></span><br><span class="line"><span class="language-bash">       wget \</span></span><br><span class="line"><span class="language-bash">       python-is-python2 \</span></span><br><span class="line"><span class="language-bash">       libncurses5 \</span></span><br><span class="line"><span class="language-bash">       bzr \</span></span><br><span class="line"><span class="language-bash">       cvs \</span></span><br><span class="line"><span class="language-bash">       git \</span></span><br><span class="line"><span class="language-bash">       mercurial \</span></span><br><span class="line"><span class="language-bash">       patch \</span></span><br><span class="line"><span class="language-bash">       gzip \</span></span><br><span class="line"><span class="language-bash">       bzip2 \</span></span><br><span class="line"><span class="language-bash">       perl \</span></span><br><span class="line"><span class="language-bash">       tar \</span></span><br><span class="line"><span class="language-bash">       cpio \</span></span><br><span class="line"><span class="language-bash">       unzip \</span></span><br><span class="line"><span class="language-bash">       rsync \</span></span><br><span class="line"><span class="language-bash">       file \</span></span><br><span class="line"><span class="language-bash">       bc \</span></span><br><span class="line"><span class="language-bash">       wget \</span></span><br><span class="line"><span class="language-bash">       qemu-user-static \</span></span><br><span class="line"><span class="language-bash">       live-build \</span></span><br><span class="line"><span class="language-bash">       android-sdk-libsparse-utils \</span></span><br><span class="line"><span class="language-bash">       android-sdk-ext4-utils \</span></span><br><span class="line"><span class="language-bash">       time \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/* \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">rm</span> -rf /usr/bin/python \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; sudo <span class="built_in">ln</span> -s /usr/bin/python3 /usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> locale-gen en_US.UTF-8</span></span><br><span class="line"><span class="keyword">ENV</span> LANG=<span class="string">&#x27;en_US.UTF-8&#x27;</span> LANGUAGE=<span class="string">&#x27;en_US:en&#x27;</span> LC_ALL=<span class="string">&#x27;en_US.UTF-8&#x27;</span> TERM=screen</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /home/topeet</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [ <span class="string">&quot;/bin/bash&quot;</span>]</span></span><br></pre></td></tr></table></figure>



<p>è¿è¡Œæ„å»ºdockerçš„å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker build -f Dockerfile -t ubuntu20:1 .</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;æ³¨æ„æœ€åæœ‰ä¸ª.è¡¨ç¤ºå½“å‰ç›®å½•~~æˆ‘è¯´å‘¢&#x3D;&#x3D;</p>
<p>ç„¶åè¿è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -it ubuntu20:1</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028618.png" alt="image-20231110130235371"></p>
<p>è¿è¡ŒæˆåŠŸè¯æ˜æ„å»ºçš„æ²¡é—®é¢˜ï¼Œç„¶åæ‰“åŒ…ubuntu20ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker save -o image.tar.gz ubuntu20:1</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028624.png" alt="image-20231110135153759"></p>
<p>rç„¶ååœ¨å…¶ä»–ç”µè„‘ä¸Šåªéœ€è¦ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åŠ è½½é•œåƒå³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker load -i image.tar.gz</span><br></pre></td></tr></table></figure>

<p>æœ€åæµ‹è¯•æŒ‚è½½ç„¶åç¼–è¯‘ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --privileged -it -v /home/topeet/Linux/ubuntu20_build:/home/topeet/ubuntu20_build ubuntu20:1</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­  â€“privilegedæ˜¯å¿…é¡»è¦åŠ çš„ï¼Œå¦åˆ™æ„å»ºç³»ç»Ÿçš„æ—¶å€™ä¼šæœ‰æƒé™é—®é¢˜ã€‚æ„å»ºubuntu20æ–‡ä»¶ç³»ç»Ÿé€šè¿‡ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202311102028650.png" alt="image-20231110144134276"></p>
<p>ç„¶åæµ‹è¯•ç¼–è¯‘Linuxæºç </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --privileged -it -v /home/topeet/Linux/3588-linux:/home/topeet/3588-linux ubuntu20:1</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œç¼–è¯‘çš„æ—¶é—´å¤ªé•¿äº†ï¼Œæ™šä¸Šå†æµ‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --privileged -it -v /home/topeet/Android/3588-android12:/home/topeet/3588-android12 ubuntu20:1</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
  </entry>
  <entry>
    <title>éŸ³è§†é¢‘æµ‹è¯•</title>
    <url>/2023/10/26/4%20%E9%9F%B3%E8%A7%86%E9%A2%91%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="1-gst-play-1-0æµ‹è¯•"><a href="#1-gst-play-1-0æµ‹è¯•" class="headerlink" title="1.gst-play-1.0æµ‹è¯•"></a>1.gst-play-1.0æµ‹è¯•</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gst-play-1.0 --videosink=xvimagesink /usr/local/test.mp4</span><br></pre></td></tr></table></figure>

<p>GStreamer çš„ gst-play-1.0 å·¥å…·ä¼šåŠ è½½æŒ‡å®šçš„è§†é¢‘æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ xvimagesink æ’ä»¶å°†è§†é¢‘æ¸²æŸ“åˆ° X Window ç³»ç»Ÿä¸Šçš„æ˜¾ç¤ºè®¾å¤‡ä¸Šï¼Œä»¥å®ç°è§†é¢‘çš„æ’­æ”¾æ•ˆæœã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310260944983.png" alt="image-20231026094404955"></p>
<h1 id="2-mpvæµ‹è¯•"><a href="#2-mpvæµ‹è¯•" class="headerlink" title="2.mpvæµ‹è¯•"></a>2.mpvæµ‹è¯•</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mpv --hwdec=rkmpp --vd-lavc-software-fallback=no --vo=xv /usr/local/test.mp4        </span><br></pre></td></tr></table></figure>

<p>mpv åª’ä½“æ’­æ”¾å™¨å°†ä½¿ç”¨ Rockchip MPP ç¡¬ä»¶è§£ç å™¨è¿›è¡Œç¡¬ä»¶è§£ç ï¼Œç¦ç”¨è½¯ä»¶å›é€€ä»¥ç¡®ä¿åªä½¿ç”¨ç¡¬ä»¶è§£ç ï¼Œå¹¶ä½¿ç”¨ xv è§†é¢‘è¾“å‡ºæ’ä»¶æ¸²æŸ“è§†é¢‘ï¼Œä»¥å®ç°é«˜æ€§èƒ½çš„è§†é¢‘æ’­æ”¾æ•ˆæœã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310260945251.png" alt="image-20231026094504212"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mpv --hwdec=rkmpp --vo=opengl --gpu-hwdec-interop=drmprime-drm --gpu-context=x11egl /usr/local/test.mp4</span><br></pre></td></tr></table></figure>

<p>mpv åª’ä½“æ’­æ”¾å™¨å°†ä½¿ç”¨ Rockchip MPP ç¡¬ä»¶è§£ç å™¨è¿›è¡Œç¡¬ä»¶è§£ç ï¼Œä½¿ç”¨ OpenGL ä½œä¸ºè§†é¢‘è¾“å‡ºï¼ŒåŒæ—¶å¯ç”¨ DRM Prime ä¸ DRM ä¹‹é—´çš„ GPU ç¡¬ä»¶è§£ç å™¨äº’æ“ä½œæ€§ï¼Œå¹¶ä½¿ç”¨ X11 EGL ä¸Šä¸‹æ–‡è¿›è¡Œ GPU åŠ é€Ÿï¼Œä»¥å®ç°é«˜æ€§èƒ½çš„è§†é¢‘æ’­æ”¾æ•ˆæœã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310260943085.png" alt="image-20231026094341042"></p>
<h1 id="3-gst-launch-1-0-æµ‹è¯•"><a href="#3-gst-launch-1-0-æµ‹è¯•" class="headerlink" title="3. gst-launch-1.0 æµ‹è¯•"></a>3. gst-launch-1.0 æµ‹è¯•</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GST_DEBUG=fps*:7 gst-launch-1.0 uridecodebin uri=file:///usr/local/test.mp4 ! fpsdisplaysink video-sink=xvimagesink text-overlay=false signal-fps-measurements=true</span><br></pre></td></tr></table></figure>

<p>GStreamer çš„ gst-launch-1.0 å·¥å…·å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„æµæ°´çº¿ï¼Œå…¶ä¸­åŒ…å« <code>uridecodebin</code> å…ƒç´ ç”¨äºè§£ç æŒ‡å®šçš„è§†é¢‘æ–‡ä»¶ï¼Œå¹¶é€šè¿‡ <code>fpsdisplaysink</code> å…ƒç´ æ˜¾ç¤ºè§†é¢‘å’Œå¸§ç‡ä¿¡æ¯ã€‚å¸§ç‡ä¿¡æ¯å°†ä»¥è°ƒè¯•è¾“å‡ºçš„å½¢å¼æ˜¾ç¤ºåœ¨ç»ˆç«¯ä¸Šã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310261008898.png" alt="image-20231026100859800"></p>
<p>æµ‹è¯•æœ€å¤§çš„å¸§ç‡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GST_DEBUG=fps*:7 gst-launch-1.0 uridecodebin uri=file:///usr/local/test.mp4 ! fpsdisplaysink video-sink=fakesink text-overlay=false signal-fps-measurements=true sync=false</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310261010578.png" alt="image-20231026101009531"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gst-launch-1.0 uridecodebin uri=file:///usr/local/test.mp4 ! xvimagesink</span><br></pre></td></tr></table></figure>

<h1 id="4-è°·æ­Œæµè§ˆå™¨æµ‹è¯•"><a href="#4-è°·æ­Œæµè§ˆå™¨æµ‹è¯•" class="headerlink" title="4.è°·æ­Œæµè§ˆå™¨æµ‹è¯•"></a>4.è°·æ­Œæµè§ˆå™¨æµ‹è¯•</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo 0x100 &gt; /sys/module/rk_vcodec/parameters/mpp_dev_debug</span><br><span class="line">chromium --no-sandbox file:///usr/local/test.mp4</span><br></pre></td></tr></table></figure>

<p>Chromium æµè§ˆå™¨å°†åœ¨æ²¡æœ‰æ²™ç›’çš„æƒ…å†µä¸‹å¯åŠ¨ï¼Œå¹¶åŠ è½½æŒ‡å®šè·¯å¾„çš„ <code>test.mp4</code> è§†é¢‘æ–‡ä»¶ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ç›´æ¥æ’­æ”¾æœ¬åœ°è§†é¢‘æ–‡ä»¶ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310261014311.png" alt="image-20231026101406276"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310261018085.png" alt="image-20231026101842048"></p>
<p>æ’­æ”¾è§†é¢‘çš„æ—¶å€™æŸ¥çœ‹GPUçš„åˆ©ç”¨ç‡å‘ç°æ˜æ˜¾çš„ä¸Šå‡ï¼Œæ‰€ä»¥åˆ¤æ–­è°·æ­Œæµè§ˆå™¨ä¸ºç¡¬ä»¶è§£ç ã€‚</p>
<h1 id="5-æ‘„åƒå¤´æµ‹è¯•"><a href="#5-æ‘„åƒå¤´æµ‹è¯•" class="headerlink" title="5.æ‘„åƒå¤´æµ‹è¯•"></a>5.æ‘„åƒå¤´æµ‹è¯•</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib/aarch64-linux-gnu/gstreamer-1.0</span><br><span class="line">gst-launch-1.0 v4l2src device=/dev/video0 ! video/x-raw,format=NV12,width=1920,height=1080, framerate=30/1 ! xvimagesink</span><br><span class="line">gst-launch-1.0 v4l2src device=/dev/video1 ! video/x-raw,format=NV12,width=1920,height=1080, framerate=30/1 ! xvimagesink</span><br></pre></td></tr></table></figure>

<p>æˆ‘å‘ç°ä¸åŠ ä¸Šç¬¬ä¸€å¥çš„åº“çš„å¯¼å…¥ä¼šå‡ºç°å‘ç»¿çš„æƒ…å†µï¼Œè€Œä¸”æ˜¯0å‘ç»¿ï¼Œ1æ²¡äº‹ï¼Œä¸åŠ ç¬¬ä¸€å¥çš„è¯1çš„é¢œè‰²ä¸å¤ªå¯¹</p>
<p>gst-launch-1.0 v4l2src device&#x3D;&#x2F;dev&#x2F;video9 ! image&#x2F;jpeg, width&#x3D;640, height&#x3D;480, framerate&#x3D;30&#x2F;1 ! jpegparse ! mppjpegdec ! xvimagesink sync&#x3D;false</p>
<h1 id="6-mppæµ‹è¯•"><a href="#6-mppæµ‹è¯•" class="headerlink" title="6.mppæµ‹è¯•"></a>6.mppæµ‹è¯•</h1><p>é¦–å…ˆè¦ç›‘æ§è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tail -f /var/log/syslog</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨mpi_dec_testï¼Œè§£ç è§†é¢‘ï¼Œå°†<a href="https://so.csdn.net/so/search?q=h264&spm=1001.2101.3001.7020">h264</a>è½¬ä¸ºyuv</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mpi_dec_test -i /oem/200frames_count.h264 -t 7 -n 250 -o /home/topeet/test.yuv -w 640 -h 480</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310261707707.png" alt="image-20231026170732680"></p>
<p>è°ƒç”¨mpi_enc_testï¼Œç¼–ç è§†é¢‘ï¼Œå°†yuvè½¬ä¸ºh264</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mpi_enc_test -i /home/topeet/test.yuv -t 7 -n 250 -o /home/topeet/test.h264 -w 640 -h 480 -fps 25</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310261712235.png" alt="image-20231026171223218"></p>
]]></content>
      <categories>
        <category>ç‘èŠ¯å¾®</category>
      </categories>
  </entry>
  <entry>
    <title>å¦‚ä½•æ„å»ºdebåŒ…</title>
    <url>/2023/10/19/14%20%E6%9E%84%E5%BB%BAdeb%E5%8C%85.md/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="1-ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µ"><a href="#1-ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="1.ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µ"></a>1.ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µ</h1><p>ä¸‰ä¸ªæœ€æ ¸å¿ƒçš„æ¦‚å¿µä¸ºï¼š</p>
<ul>
<li>ä¸Šæ¸¸åŸå§‹ä»£ç åŒ…ï¼ˆupstream tarballï¼‰:<ul>
<li>é€šå¸¸ï¼Œäººä»¬ä¸ºä¸Šæ¸¸å¼€å‘è€…ï¼ˆé€šå¸¸ä¸ºç¬¬ä¸‰æ–¹ï¼‰ç¼–å†™çš„è½¯ä»¶æ‰“åŒ…ã€‚</li>
<li>ä¸Šæ¸¸å¼€å‘è€…ä¼šä½¿ç”¨æºä»£ç å½’æ¡£è½¯ä»¶æˆ–åŸå§‹ä»£ç åŒ…çš„æ–¹å¼å‘æ”¾ä»–ä»¬çš„è½¯ä»¶ã€‚</li>
<li>åŸå§‹ä»£ç åŒ…ä¸€èˆ¬æ˜¯ä¸Šæ¸¸åˆ¶ä½œçš„ <code>.tar.gz</code> æˆ– <code>.tgz</code> æ–‡ä»¶ï¼Œå®ƒä¹Ÿå¯èƒ½è¢«å‹ç¼©æˆ <code>.tar.bz2</code>ï¼Œ<code>.tb2</code> æˆ– <code>.tar.xz</code> æ ¼å¼ã€‚åŸå§‹ä»£ç åŒ…å°±æ˜¯ Debian æ„å»ºåŒ…æ—¶ä½¿ç”¨çš„åŸææ–™ã€‚</li>
</ul>
</li>
<li>æºç åŒ…ï¼š<ul>
<li>å½“æ‚¨æ‹¥æœ‰äº†ä¸Šæ¸¸åˆ¶ä½œçš„åŸå§‹ä»£ç åŒ…ï¼Œä¸‹ä¸€æ­¥å°±å¯ä»¥åˆ¶ä½œ Debian æºç åŒ…äº†ã€‚</li>
</ul>
</li>
<li>äºŒè¿›åˆ¶åŒ…ï¼š<ul>
<li>ä»æºç åŒ…æ‚¨å¯ä»¥æ„å»º Debian äºŒè¿›åˆ¶åŒ…ï¼Œå®ƒæ‰æ˜¯æ˜¯å®é™…ä¸Šä¼šè¢«å®‰è£…çš„åŒ…ã€‚</li>
</ul>
</li>
</ul>
<p>æœ€ç®€å•çš„æºç åŒ…ç”±3ä¸ªæ–‡ä»¶ç»„æˆï¼š</p>
<ul>
<li>ä¸Šæ¸¸åŸå§‹ä»£ç åŒ…ï¼Œéœ€è¦è¢«é‡å‘½åæ¥ç¬¦åˆä¸€ä¸ªç‰¹å®šçš„æ¨¡å¼ã€‚</li>
<li>ä¸€ä¸ª debian ç›®å½•ï¼Œå¸¦æœ‰æ‰€æœ‰ä¸Šæ¸¸æºä»£ç çš„æ›´æ”¹è®°å½•ï¼Œå¤–åŠ æ‰€æœ‰ä¸º Debian æ‰“åŒ…ç³»ç»Ÿç”Ÿæˆçš„æ‰€æœ‰æ–‡ä»¶ã€‚è¿™ç§åŒ…æ‹¥æœ‰ <code>.debian.tar.gz</code> çš„æ–‡ä»¶åã€‚</li>
<li>ä¸€ä¸ªæè¿°æ–‡ä»¶ï¼ˆä»¥ <code>.dsc</code> ç»“å°¾ï¼‰ï¼Œç½—åˆ—äº†å…¶ä»–ä¸¤ä¸ªæ–‡ä»¶ã€‚</li>
</ul>
<p>å¬èµ·æ¥æœ‰äº›è¿‡äºå¤æ‚ï¼Œäººä»¬çš„ç¬¬ä¸€å°è±¡æ˜¯ï¼šæ‰€æœ‰ä¸œè¥¿éƒ½æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œä¼šæ›´ç®€å•ã€‚ç„¶è€Œï¼Œä¿æŒä¸Šæ¸¸ä»£ç åŒ…ä¸ Debian ç‰¹å®šæ›´æ”¹åˆ†ç¦»å¯ä»¥èŠ‚çœå¤§é‡ç£ç›˜ç©ºé—´å’Œå¸¦å®½ã€‚å¯¹ Debian æ¥è¯´ï¼Œè¿½è¸ªå¿…è¦çš„ä¿®æ”¹ä¹Ÿæ›´åŠ ç®€å•ã€‚</p>
<h1 id="2-debåŒ…åˆ¶ä½œæµç¨‹"><a href="#2-debåŒ…åˆ¶ä½œæµç¨‹" class="headerlink" title="2. debåŒ…åˆ¶ä½œæµç¨‹"></a>2. debåŒ…åˆ¶ä½œæµç¨‹</h1><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªdebianç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> debian</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬éœ€è¦æä¾›ä¸å°‘æ–‡ä»¶ï¼Œè®©æˆ‘ä»¬æŒ‰é¡ºåºæ¥çœ‹ã€‚</p>
<h2 id="2-1-debian-changelog"><a href="#2-1-debian-changelog" class="headerlink" title="2.1 debian&#x2F;changelog"></a>2.1 debian&#x2F;changelog</h2><p>ç¬¬ä¸€ä¸ªæ–‡ä»¶æ˜¯ <code>debian/changelog</code>ï¼Œè¿™ä¸ªæ˜¯è®°å½• Debian åŒ…å˜åŒ–çš„æ—¥å¿—æ–‡ä»¶ã€‚å®ƒæ— éœ€ç½—åˆ—å‡ºä¸Šæ¸¸ä»£ç çš„æ¯ä¸€ä¸ªæ”¹å˜ï¼Œåªè¦å®ƒèƒ½å¸®åŠ©ç”¨æˆ·æ€»ç»“è¿™äº›å˜åŒ–å³å¯ã€‚æˆ‘ä»¬åœ¨åˆ¶ä½œç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ‰€ä»¥è¿™é‡Œåº”å½“ä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä»éœ€åˆ¶ä½œä¸€ä¸ªå˜åŒ–æ—¥å¿—çš„å…¥å£ï¼Œå› ä¸ºæ‰“åŒ…å·¥å…·ä¼šä»æ—¥å¿—é‡Œè¯»å–ç‰¹å®šä¿¡æ¯ã€‚æœ€é‡è¦çš„æ˜¯å®ƒä¼šè¯»å–åŒ…çš„ç‰ˆæœ¬ã€‚</p>
<p><code>debian/changelog</code> æ‹¥æœ‰ä¸€ä¸ªååˆ†ç‰¹æ®Šçš„æ ¼å¼ã€‚æœ€ç®€å•çš„åˆ›å»ºæ–¹å¼å°±æ˜¯ä½¿ç”¨ <code>dch</code> å·¥å…·ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apt install devscripts</span><br><span class="line">dch --create -v 1.0-1 --package hithere</span><br></pre></td></tr></table></figure>

<p>ä¼šåœ¨æ–‡ä»¶ä¸­äº§ç”Ÿä»¥ä¸‹å†…å®¹ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310092059083.png" alt="image-20231009205902071"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310092058676.png" alt="image-20231009205839642"></p>
<p>è¿™é‡Œæœ‰å¾ˆå¤šæ³¨æ„ç‚¹ï¼š</p>
<p><code>hithere</code> éƒ¨åˆ†å¿…é¡»ä¸æºä»£ç åŒ…çš„åå­—ç›¸åŒã€‚<code>1.0-1</code> æ˜¯ç‰ˆæœ¬å·ï¼Œ<code>1.0</code> éƒ¨åˆ†æ˜¯ä¸Šæ¸¸ç‰ˆæœ¬å·ã€‚<code>-1</code> éƒ¨åˆ†æ˜¯ Debian çš„ç‰ˆæœ¬ï¼šå®ƒæ˜¯ç¬¬ä¸€ä¸ªä¸Šæ¸¸ç‰ˆæœ¬ä¸º <code>1.0</code> çš„ Debian åŒ…ã€‚å¦‚æœè¿™ä¸ª Debian åŒ…æœ‰é”™è¯¯ï¼Œå¹¶ä¸”è¢«ä¿®å¤äº†ï¼Œé‚£ä¹ˆä¸Šæ¸¸ç‰ˆæœ¬å·ä»ä¿æŒç›¸åŒï¼Œä¸‹ä¸€ä¸ªç‰ˆæœ¬åº”å½“è¢«å«åš <code>1.0-2</code>ï¼Œæ¥ä¸‹æ¥æ˜¯ <code>1.0-3</code>ï¼Œä¾æ­¤ç±»æ¨ã€‚</p>
<p>UNRELEASED è¢«ç§°ä½œä¸Šä¼ ç›®æ ‡ã€‚å®ƒä¼šå‘Šè¯‰ä¸Šä¼ å·¥å…·è¿™ä¸ªäºŒè¿›åˆ¶åŒ…åº”å½“è¢«ä¸Šä¼ åˆ°å“ªé‡Œã€‚UNRELEASED æ„å‘³ç€è¿™ä¸ªåŒ…è¿˜æ²¡æœ‰åšå¥½ä¸Šä¼ çš„å‡†å¤‡ã€‚ä¿æŒ UNRELEASED æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œä»¥é¿å…æ‚¨é”™è¯¯ä¸Šä¼ å®ƒã€‚</p>
<p>ç›®å‰è¯·å…ˆå¿½ç•¥ <code>urgency=medium</code>ã€‚</p>
<p><code>(Closesï¼š#XXXXXX)</code> ä½œç”¨åœ¨äºä¸Šä¼ åŒ…æ—¶å…³é—­é”™è¯¯ã€‚è¿™æ˜¯åœ¨ Debian ä¸­å…³é—­é”™è¯¯çš„å¸¸ç”¨æ–¹æ³•ï¼šå½“ä¸Šä¼ ä¿®å¤é”™è¯¯çš„åŒ…æ—¶ï¼Œé”™è¯¯è·Ÿè¸ªå™¨ä¼šæ³¨æ„åˆ°è¿™ä¸€ç‚¹ï¼Œå¹¶å°†é”™è¯¯æ ‡è®°ä¸ºå·²å…³é—­ã€‚æˆ‘ä»¬å¯ä»¥åˆ é™¤ <code>(Closes...)</code> ä½</p>
<h2 id="2-2-debian-control"><a href="#2-2-debian-control" class="headerlink" title="2.2 debian&#x2F;control"></a>2.2 debian&#x2F;control</h2><p>æ§åˆ¶æ–‡ä»¶æè¿°ä»£ç å’ŒäºŒè¿›åˆ¶åŒ…ï¼Œå¹¶ç»™å‡ºä»–ä»¬çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚åç§°ã€åŒ…çš„ç»´æŠ¤è€…æ˜¯è°ï¼Œç­‰ç­‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Source: hithere</span><br><span class="line">Maintainer: Lars Wirzenius &lt;liw@liw.fi&gt;</span><br><span class="line">Section: misc</span><br><span class="line">Priority: optional</span><br><span class="line">Standards-Version: 3.9.2</span><br><span class="line">Build-Depends: debhelper (&gt;= 9)</span><br><span class="line"></span><br><span class="line">Package: hithere</span><br><span class="line">Architecture: any</span><br><span class="line">Depends: $&#123;shlibs:Depends&#125;, $&#123;misc:Depends&#125;</span><br><span class="line">Description: greet user</span><br><span class="line"> hithere greets the user, or the world.</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œæœ‰è®¸å¤šéœ€æ±‚çš„å­—æ®µï¼Œä½†æ˜¯ç°åœ¨æ‚¨å¯ä»¥åƒå¯¹å¾…é­”æ³•ä¸€æ ·å¯¹å¾…å®ƒã€‚é‚£ä¹ˆï¼Œåœ¨ <code>debian/control</code> ä¸­æœ‰ä¸¤æ®µæ–‡å­—ã€‚</p>
<p>ç¬¬ä¸€æ®µæ–‡å­—æè¿°äº†æºä»£ç åŒ…ï¼Œä½¿ç”¨ä»¥ä¸‹å­—æ®µï¼š</p>
<h3 id="2-2-1-Source"><a href="#2-2-1-Source" class="headerlink" title="2.2.1 Source"></a>2.2.1 Source</h3><p>æºä»£ç åŒ…åã€‚</p>
<h3 id="2-2-2-Maintainer"><a href="#2-2-2-Maintainer" class="headerlink" title="2.2.2 Maintainer"></a>2.2.2 Maintainer</h3><p>ç»´æŠ¤è€…çš„å§“åå’Œç”µå­é‚®ç®±ã€‚</p>
<h3 id="2-2-3-Priority"><a href="#2-2-3-Priority" class="headerlink" title="2.2.3 Priority"></a>2.2.3 Priority</h3><p>åŒ…çš„é‡è¦æ€§ï¼ˆâ€™required å¯é€‰çš„â€™, â€˜important é‡è¦çš„â€™, â€˜standard æ ‡å‡†â€™ æˆ– â€˜optionalâ€™ å…¶ä¸­ä¹‹ä¸€ï¼‰ã€‚é€šå¸¸ï¼ŒåŒ…æ˜¯â€œå¯é€‰â€çš„ï¼Œé™¤éå®ƒå¯¹äºæ ‡å‡†ç³»ç»ŸåŠŸèƒ½æ˜¯â€œå¿…ä¸å¯å°‘çš„â€ï¼Œå³å¯åŠ¨æˆ–ç½‘ç»œåŠŸèƒ½ã€‚ å¦‚æœåŒ…ä¸å¦ä¸€ä¸ªâ€œå¯é€‰â€åŒ…å†²çªï¼Œæˆ–è€…å®ƒä¸æ‰“ç®—ç”¨äºæ ‡å‡†æ¡Œé¢å®‰è£…ï¼Œåˆ™åº”è¯¥æ˜¯â€œé¢å¤–â€çš„è€Œä¸æ˜¯â€œå¯é€‰â€çš„ã€‚ â€œé¢å¤–â€åŒ…çš„æ˜¾ç€ä¾‹å­æ˜¯è°ƒè¯•åŒ…ã€‚ ï¼ˆç”±Sebastian Tennantæ·»åŠ ï¼‰ã€‚</p>
<h3 id="2-2-4-Build-Depends"><a href="#2-2-4-Build-Depends" class="headerlink" title="2.2.4 Build-Depends"></a>2.2.4 Build-Depends</h3><p>éœ€è¦å®‰è£…ä»¥æ„å»ºç¨‹åºåŒ…çš„ç¨‹åºåŒ…åˆ—è¡¨ã€‚å®é™…ä½¿ç”¨åŒ…æ—¶æœ‰å¯èƒ½éœ€è¦å®ƒä»¬ã€‚</p>
<p>ç¬¬ä¸€ä¸ªä¹‹åçš„æ‰€æœ‰æ®µè½éƒ½æè¿°äº†ä»æ­¤æºæ„å»ºçš„äºŒè¿›åˆ¶åŒ…ã€‚ å¯ä»¥æœ‰è®¸å¤šä»åŒä¸€æ¥æºæ„å»ºçš„äºŒè¿›åˆ¶åŒ…; ä½†å¯¹äºæˆ‘ä»¬çš„ä¾‹å­åªæœ‰ä¸€ä¸ªã€‚ æˆ‘ä»¬ä½¿ç”¨è¿™äº›å­—æ®µï¼š</p>
<h3 id="2-2-5-Package"><a href="#2-2-5-Package" class="headerlink" title="2.2.5 Package"></a>2.2.5 Package</h3><p>äºŒè¿›åˆ¶åŒ…çš„åç§°ã€‚ åç§°å¯èƒ½ä¸æºåŒ…åç§°ä¸åŒã€‚</p>
<h3 id="2-2-6-Architecture"><a href="#2-2-6-Architecture" class="headerlink" title="2.2.6 Architecture"></a>2.2.6 Architecture</h3><p>æŒ‡å®šäºŒè¿›åˆ¶åŒ…é¢„æœŸä½¿ç”¨çš„è®¡ç®—æœºä½“ç³»ç»“æ„ï¼šç”¨äº32ä½Intel CPUçš„i386ï¼Œç”¨äº64ä½çš„amd64ï¼Œç”¨äºARMå¤„ç†å™¨çš„armelç­‰ç­‰ã€‚ Debianæ€»å…±å¯ä»¥å¤„ç†å¤§çº¦åå‡ ç§è®¡ç®—æœºä½“ç³»ç»“æ„ï¼Œå› æ­¤è¿™ç§ä½“ç³»ç»“æ„æ”¯æŒè‡³å…³é‡è¦ã€‚ â€œArchitectureâ€å­—æ®µå¯ä»¥åŒ…å«ç‰¹å®šä½“ç³»ç»“æ„çš„åç§°ï¼Œä½†é€šå¸¸å®ƒåŒ…å«ä¸¤ä¸ªç‰¹æ®Šå€¼ä¸­çš„ä¸€ä¸ªã€‚</p>
<p>any<br> ï¼ˆæˆ‘ä»¬åœ¨ç¤ºä¾‹ä¸­çœ‹åˆ°ï¼‰æ„å‘³ç€å¯ä»¥ä¸ºä»»ä½•ä½“ç³»ç»“æ„æ„å»ºåŒ…ã€‚ æ¢å¥è¯è¯´ï¼Œä»£ç æ˜¯å¯ç§»æ¤çš„ï¼Œå› æ­¤å®ƒä¸ä¼šå¯¹ç¡¬ä»¶åšå¤ªå¤šå‡è®¾ã€‚ ä½†æ˜¯ï¼Œä»ç„¶éœ€è¦ä¸ºæ¯ä¸ªä½“ç³»ç»“æ„å•ç‹¬æ„å»ºäºŒè¿›åˆ¶åŒ…ã€‚</p>
<p>all<br> æ„å‘³ç€ç›¸åŒçš„äºŒè¿›åˆ¶åŒ…å°†é€‚ç”¨äºæ‰€æœ‰ä½“ç³»ç»“æ„ï¼Œè€Œæ— éœ€ä¸ºæ¯ä¸ªä½“ç³»ç»“æ„å•ç‹¬æ„å»ºã€‚ ä¾‹å¦‚ï¼Œä»…åŒ…å«shellè„šæœ¬çš„åŒ…å°†æ˜¯â€œallâ€ã€‚ Shellè„šæœ¬åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥å·¥ä½œï¼Œä¸éœ€è¦ç¼–è¯‘ã€‚</p>
<h3 id="2-2-7-Depends"><a href="#2-2-7-Depends" class="headerlink" title="2.2.7 Depends"></a>2.2.7 Depends</h3><p>ä¸ºäº†è®©äºŒè¿›åˆ¶åŒ…ä¸­ç¨‹åºèƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œéœ€è¦å®‰è£…çš„åŒ…åˆ—è¡¨ã€‚æ‰‹åŠ¨åˆ—å‡ºè¿™äº›ä¾èµ–é¡¹æ˜¯ç¹çä¸”å®¹æ˜“å‡ºé”™çš„å·¥ä½œã€‚ä¸ºäº†èƒ½å¤Ÿè®©å…¶å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç¥å¥‡çš„å°ä¸œè¥¿ <code>$&#123;shlibs:Depends&#125;</code>ã€‚å¦ä¸€ä¸ªç¥å¥‡çš„ä¸œè¥¿æ˜¯ç»™ <code>debhelper</code> çš„ï¼Œå®ƒæ˜¯ <code>$&#123;misc:Depends&#125;</code>ã€‚shlibs æ˜¯ä¸ºäº†åŠ¨æ€é“¾æ¥åº“ï¼Œè€Œ misc æ˜¯ä¸ºäº† <code>debherlper</code> çš„ä¸€äº›å·¥ä½œã€‚å¯¹äºåˆ«çš„ä¾èµ–ï¼Œæ‚¨å¯ä»¥å°†å…¶æ‰‹åŠ¨åŠ å…¥åˆ° <code>Depends</code> æˆ– <code>Build-Depends</code> ä¸­ã€‚ä½†è¯·æ³¨æ„ï¼Œ<code>$&#123;...&#125;</code> ä»…åœ¨ <code>Depends</code> ä¸­æœ‰æ•ˆã€‚</p>
<h3 id="2-2-8-Description"><a href="#2-2-8-Description" class="headerlink" title="2.2.8 Description"></a>2.2.8 Description</h3><p>äºŒè¿›åˆ¶åŒ…çš„å®Œæ•´æè¿°ã€‚å®ƒå¸Œæœ›å¯¹ç”¨æˆ·æœ‰æ‰€å¸®åŠ©ã€‚ç¬¬ä¸€è¡Œç”¨ä½œç®€è¦æ¦‚è¦ï¼ˆæ‘˜è¦ï¼‰æè¿°ï¼Œå…¶ä½™éƒ¨åˆ†æ˜¯åŒ…çš„æ›´é•¿çš„æè¿°ã€‚<br> å‘½ä»¤ <code>cme edit dpkg</code> æä¾›äº†ä¸€ä¸ªGUIèƒ½å¤Ÿç”¨æ¥ç¼–è¾‘å¤§å¤šæ•°æ‰“åŒ…æ–‡ä»¶ï¼ŒåŒ…æ‹¬ <code>debian/control</code>ã€‚ è¯·å‚é˜…ä½¿ç”¨ <code>cme</code> é¡µé¢ç®¡ç† <code>Debian</code> è½¯ä»¶åŒ…ã€‚<code>cme</code>å‘½ä»¤åœ¨ Debian ä¸­çš„ <code>cme</code> åŒ…ä¸­æä¾›ã€‚æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>cme edit dpkg-control</code> å‘½ä»¤ä»…ç¼–è¾‘ <code>debian/control</code> æ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Source: linux-rockchip-5.10.110</span><br><span class="line">Section: kernel</span><br><span class="line">Priority: optional</span><br><span class="line">Standards-Version: 4.6.0</span><br><span class="line">Build-Depends: bc, rsync, kmod, cpio, build-essential, u-boot-tools, bison, python3 | python, python-is-python3 | python-is-python2, flex | flex:native , , libssl-dev:native</span><br></pre></td></tr></table></figure>

<h2 id="2-3-debian-copyright"><a href="#2-3-debian-copyright" class="headerlink" title="2.3 debian&#x2F;copyright"></a>2.3 debian&#x2F;copyright</h2><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ–‡ä»¶ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬å°†å…ˆä½¿ç”¨ä¸€ä¸ªç©ºæ–‡ä»¶ã€‚<br> å¯¹äº Debian ï¼Œæ­¤æ–‡ä»¶ç”¨äºè·Ÿè¸ªæœ‰å…³åŒ…çš„åˆæ³•æ€§ã€ç‰ˆæƒç›¸å…³ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œä»æŠ€æœ¯è§’åº¦æ¥çœ‹ï¼Œè¿™å¹¶ä¸é‡è¦ã€‚ç›®å‰ï¼Œæˆ‘ä»¬å°†ä¸“æ³¨äºæŠ€æœ¯æ–¹é¢ã€‚å¦‚æœæœ‰å…´è¶£ï¼Œæˆ‘ä»¬å¯ä»¥ç¨åå†å›åˆ° <code>debian/copyright</code>ã€‚</p>
<h2 id="2-4-debian-rules"><a href="#2-4-debian-rules" class="headerlink" title="2.4 debian&#x2F;rules"></a>2.4 debian&#x2F;rules</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/usr/bin/make -f</span><br><span class="line">%:</span><br><span class="line">        dh $@</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼š æœ€åä¸€è¡Œåº”å½“ä½¿ç”¨ä¸€ä¸ª Tab å­—ç¬¦è¿›è¡Œç¼©è¿›ï¼Œè€Œä¸ä½¿ç”¨ç©ºæ ¼ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ª Makefileï¼Œå› æ­¤ Tab å­—ç¬¦æ˜¯ make æ‰€æœŸæœ›çš„ã€‚</strong></p>
<p>äº‹å®ä¸Š <code>debian/rules</code> å¯èƒ½æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„æ–‡ä»¶ã€‚ç„¶è€Œï¼Œåœ¨ <code>debhelper 7</code> ä¸­çš„ <code>dh</code> å‘½ä»¤è®©å®ƒå¯ä»¥åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å˜å¾—æ›´ç®€å•ã€‚</p>
<h2 id="2-5-debian-source-format"><a href="#2-5-debian-source-format" class="headerlink" title="2.5 debian&#x2F;source&#x2F;format"></a>2.5 debian&#x2F;source&#x2F;format</h2><p>æœ€åä¸€ä¸ªæˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶æ˜¯ <code>debian/source/format</code>ï¼Œå®ƒåº”å½“åŒ…å«æºä»£ç åŒ…çš„ç‰ˆæœ¬å·ï¼Œè¿™é‡Œä¸º <code>3.0 (quilt)</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">3.0 (quilt)</span><br></pre></td></tr></table></figure>

<h1 id="3-å®ä¾‹åˆ¶ä½œä¸€ä¸ªåŒ…"><a href="#3-å®ä¾‹åˆ¶ä½œä¸€ä¸ªåŒ…" class="headerlink" title="3.å®ä¾‹åˆ¶ä½œä¸€ä¸ªåŒ…"></a>3.å®ä¾‹åˆ¶ä½œä¸€ä¸ªåŒ…</h1><ul>
<li>changelog: æ–‡ä»¶è®°å½•äº†debåŒ…çš„ä½œè€…ã€ç‰ˆæœ¬ä»¥åŠæœ€åä¸€æ¬¡æ›´æ–°æ—¥æœŸç­‰ä¿¡æ¯ï¼›</li>
<li>control: æ–‡ä»¶è®°å½•äº†åŒ…åã€ç‰ˆæœ¬å·ã€æ¶æ„ã€ç»´æŠ¤è€…åŠæè¿°ç­‰ä¿¡æ¯ï¼›</li>
<li>copyright: æ–‡ä»¶è®°å½•äº†ä¸€äº›ç‰ˆæƒä¿¡æ¯ï¼›</li>
<li>postinst: è½¯ä»¶åœ¨è¿›è¡Œæ­£å¸¸ç›®å½•æ–‡ä»¶æ‹·è´åˆ°ç³»ç»Ÿåéœ€è¦æ‰§è¡Œçš„è„šæœ¬ã€‚</li>
<li>postrmæ–‡ä»¶: è½¯ä»¶å¸è½½åéœ€è¦æ‰§è¡Œçš„è„šæœ¬ã€‚</li>
</ul>
<p>è¿™é‡Œä»¥æ˜¨å¤©ç¼–è¯‘çš„opencvé™æ€åº“å’ŒåŠ¨æ€åº“ä¸ºä¾‹è¿›è¡Œdebçš„æ‰“åŒ…</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310192125627.png" alt="image-20231019212535607"></p>
<p>ä¸ºäº†ä¸å½±å“ä¸¤ä¸ªåŒ…ï¼Œæˆ‘è¿™é‡Œå°±å•ç‹¬åˆ›å»ºä¸€ä¸ªdebç›®å½•äº†ï¼Œç„¶åæ‹·è´åŠ¨æ€opencvåº“ï¼Œæ‹·è´å®Œæˆå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310192129240.png" alt="image-20231019212906221"></p>
<p>ç„¶ååˆ›å»ºDEBIANç›®å½•ï¼Œåœ¨DEBIANç›®å½•ä¸‹åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶ï¼Œå‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir DEBIAN </span><br><span class="line"></span><br><span class="line">touch DEBIAN/control</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æˆ‘æ„Ÿè§‰æˆ‘å¯ä»¥ä¸ç”¨è¿™äº›~~ï¼Œæˆ‘èƒ½å®‰è£…ä¸Šå°±è¡Œäº†ï¼Œä¸ºå•¥è¿˜è¦æœ‰è¿™äº›è¯´æ˜å‘¢ï¼Œç°åœ¨è¿˜ä¸éœ€è¦å‘¢ï¼Œå°±å…ˆè¿™æ ·.</p>
<p>ä½†æ˜¯controlè¿™ä¸ªæ˜¯å¿…é¡»è¦æ·»åŠ çš„,å‘DEBIAN&#x2F;controlæ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Package: opencv-deb</span><br><span class="line">Version: 1.0.0</span><br><span class="line">Section: free</span><br><span class="line">Priority: optional</span><br><span class="line">Essential: no</span><br><span class="line">Architecture: arm64</span><br><span class="line">Maintainer: topeet &lt;topeet@topeet&gt;</span><br><span class="line">Provides: opencv_deb</span><br><span class="line">Description: opencv 4.8.0</span><br></pre></td></tr></table></figure>

<p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»ºdebåŒ…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dpkg-deb -b ../deb ../opencv_4_8.0_arm64.deb</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310192137781.png" alt="image-20231019213754765"></p>
<p>åœ¨ä¸Šä¸€çº§çš„ç›®å½•ä¸‹å°±åˆ›å»ºäº†è¯¥ç›®å½•</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310192138990.png" alt="image-20231019213855976"></p>
<p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹debåŒ…çš„å†…å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dpkg -c opencv_4_8.0_arm64.deb</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310192141793.png" alt="image-20231019214105760"></p>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹debåŒ…çš„ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dpkg --info  opencv_4_8.0_arm64.deb</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¯¥åŒ…çš„ä¿¡æ¯å°±è¢«æ‰“å°äº†å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢å¡«å†™çš„DEBIAN&#x2F;controlçš„å†…å®¹</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310192142227.png" alt="image-20231019214247209"></p>
<p>æˆ‘ç°åœ¨è¿™ä¸ªåŒ…æ˜¯arm64æ¶æ„çš„ï¼Œä½†æ˜¯æˆ‘æƒ³åœ¨è™šæ‹Ÿæœºubuntuä¸Šç”¨ï¼Œé‚£æˆ‘è¦æ€ä¹ˆåŠå‘¢ï¼Œå®é™…ä¸Šæ˜¯å¯ä»¥å¼ºåˆ¶å®‰è£…çš„ï¼Œåœ¨-iå‚æ•°å‰é¢åŠ å…¥ä¸€ä¸ªâ€“force-depends å‚æ•°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dpkg --force-depends -i opencv_4_8.0_arm64.deb</span><br></pre></td></tr></table></figure>

<p>ç„¶é¹…å‘ç°è¿˜æ˜¯ä¸è¡Œï¼Œçœ‹æ¥è¿™ä¸ªæ¶æ„é—®é¢˜æ˜¯æ°¸è¿œæ”¹ä¸äº†çš„å‘€ï¼Œä¼¤å¿ƒäº†</p>
<p>è¿˜æ˜¯è§£åŒ…å§</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dpkg --unpack opencv_4_8.0_arm64.deb</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºä½“ç³»ä¸è¡Œè§£åŒ…éƒ½ä¸è¡Œï¼Œå› ä¸ºè¿™ä¸ªä¹Ÿç±»ä¼¼äºå®‰è£…</p>
<p>åªæ˜¯è§£å‹åº”è¯¥ç”¨è¿™ä¸ªå‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dpkg -x  opencv_4_8.0_arm64.deb opencv</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310192151417.png" alt="image-20231019215145390"></p>
<p>è¿™å°±å¥½äº†ï¼Œæåˆ°è¿™ä¸ªåœ°æ–¹åº”è¯¥å°±å¯ä»¥äº†ï¼Œæˆ‘è®¤ä¸ºã€‚okï¼Œé‚£å°±å…ˆè¿™æ ·ã€‚</p>
]]></content>
      <categories>
        <category>ç‘èŠ¯å¾®</category>
      </categories>
  </entry>
  <entry>
    <title>buildrootçš„å­¦ä¹ </title>
    <url>/2023/10/16/2%20buildroot%E7%9A%84%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>buildrootå®˜ç½‘åœ°å€ï¼š<a href="https://buildroot.org/">https://buildroot.org/</a></p>
<p>githubé“¾æ¥ï¼š<a href="https://github.com/buildroot/buildroot">https://github.com/buildroot/buildroot</a></p>
<p>ä¸¤ä¸ªæŒ‡å¯¼æ–‡æ¡£</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310162227581.png" alt="image-20231016222739549"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310162227750.png" alt="image-20231016222749732"></p>
<h1 id="1-æ‹‰å–buildroot"><a href="#1-æ‹‰å–buildroot" class="headerlink" title="1.æ‹‰å–buildroot"></a>1.æ‹‰å–buildroot</h1><p>æ‹‰å–ä¸‹è½½buildroot</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/buildroot/buildroot</span><br></pre></td></tr></table></figure>



<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310170757701.png" alt="image-20231017075747677"></p>
<p>å»ºè®®ä»¥æ™®é€šç”¨æˆ·æ¥è¿›è¡Œæ“ä½œï¼Œbuildrootç®¡é¥­æåŠ›æ¨èæ™®é€šç”¨æˆ·</p>
<h1 id="2-helpå¸®åŠ©èœå•"><a href="#2-helpå¸®åŠ©èœå•" class="headerlink" title="2.helpå¸®åŠ©èœå•"></a>2.helpå¸®åŠ©èœå•</h1><p>æ‰€æœ‰çš„äº¤äº’éƒ½æ˜¯é€šè¿‡åœ¨ä¸»æ„å»ºæ ¹æºç›®å½•ä¸­è°ƒç”¨makeæ¥å®ç°çš„ï¼Œå¯ä»¥é€šè¿‡make helpæ¥è·å–å¸®åŠ©ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><strong>æ¸…ç†ï¼š</strong><br>    clean - åˆ é™¤æ„å»ºç”Ÿæˆçš„æ‰€æœ‰æ–‡ä»¶<br>    distclean - åˆ é™¤æ‰€æœ‰éæºä»£ç æ–‡ä»¶ï¼ˆåŒ…æ‹¬.configæ–‡ä»¶ï¼‰</p>
<p><strong>æ„å»ºï¼š</strong><br>    all - æ„å»ºæ•´ä¸ªç³»ç»Ÿ<br>    toolchain - æ„å»ºå·¥å…·é“¾<br>    sdk - æ„å»ºå¯ç§»æ¤çš„SDK</p>
<p><strong>é…ç½®ï¼š</strong><br>    menuconfig - äº¤äº’å¼åŸºäºcursesçš„é…ç½®å·¥å…·<br>    nconfig - äº¤äº’å¼åŸºäºncursesçš„é…ç½®å·¥å…·<br>    xconfig - äº¤äº’å¼åŸºäºQtçš„é…ç½®å·¥å…·<br>    gconfig - äº¤äº’å¼åŸºäºGTKçš„é…ç½®å·¥å…·<br>    oldconfig - è§£å†³.configæ–‡ä»¶ä¸­çš„æœªè§£å†³ç¬¦å·<br>    syncconfig - ä¸oldconfigç›¸åŒï¼Œä½†é™é»˜æ‰§è¡Œï¼Œå¹¶æ›´æ–°ä¾èµ–å…³ç³»<br>    olddefconfig - ä¸syncconfigç›¸åŒï¼Œä½†å°†æ–°ç¬¦å·è®¾ç½®ä¸ºé»˜è®¤å€¼<br>    randconfig - éšæœºå›ç­”æ‰€æœ‰é€‰é¡¹çš„æ–°é…ç½®<br>    <strong>defconfig - æ‰€æœ‰é€‰é¡¹éƒ½ä½¿ç”¨é»˜è®¤ç­”æ¡ˆçš„æ–°é…ç½®ï¼›å¦‚æœåœ¨å‘½ä»¤è¡Œä¸Šè®¾ç½®äº†BR2_DEFCONFIGï¼Œåˆ™ä½¿ç”¨å…¶ä½œä¸ºè¾“å…¥</strong><br>    <strong>savedefconfig - å°†å½“å‰é…ç½®ä¿å­˜åˆ°BR2_DEFCONFIGï¼ˆæœ€å°é…ç½®ï¼‰</strong></p>
<p>â€‹		ä¸Šé¢çš„è¿™ä¸¤ä¸ªåº”è¯¥æ˜¯åœ¨é…ç½®é‡Œé¢æœ€æœ‰ç”¨çš„é‚£ä¸€ä¸ªï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªBR2_DEFCONFIGå¹¶ä¸ä¼šè¢«è®¾ç½®ï¼Œæ‰€ä»¥åªèƒ½æ˜¯é…ç½®å®Œæˆä¹‹åï¼Œç¬¬ä¸€æ¬¡æ˜¯ä¸€å®šè¦è®¾ç½®çš„ã€‚ç‰¹æ®Šè®°å¿†ä¸€ä¸‹ã€‚</p>
<p>â€‹	update-defconfig - ä¸savedefconfigç›¸åŒ<br>â€‹	allyesconfig - æ‰€æœ‰é€‰é¡¹éƒ½æ¥å—yesç­”æ¡ˆçš„æ–°é…ç½®<br>â€‹	allnoconfig - æ‰€æœ‰é€‰é¡¹éƒ½ä½¿ç”¨noç­”æ¡ˆçš„æ–°é…ç½®<br>â€‹	alldefconfig - æ‰€æœ‰é€‰é¡¹éƒ½è®¾ç½®ä¸ºé»˜è®¤å€¼çš„æ–°é…ç½®<br>â€‹	randpackageconfig - éšæœºå›ç­”åŒ…é€‰é¡¹çš„æ–°é…ç½®<br>â€‹	allyespackageconfig - æ‰€æœ‰åŒ…é€‰é¡¹éƒ½æ¥å—yesç­”æ¡ˆçš„æ–°é…ç½®<br>â€‹	allnopackageconfig - æ‰€æœ‰åŒ…é€‰é¡¹éƒ½ä½¿ç”¨noç­”æ¡ˆçš„æ–°é…ç½®</p>
<p><strong>é’ˆå¯¹ç‰¹å®šè½¯ä»¶åŒ…ï¼š</strong><br>    <pkg> - æ„å»ºå¹¶å®‰è£…<pkg>åŠå…¶æ‰€æœ‰ä¾èµ–é¡¹<br>    <pkg>-source - ä»…ä¸‹è½½<pkg>çš„æºä»£ç æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">make opencv4-source</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310170818453.png" alt="image-20231017081853414"></p>
<p>â€‹	<pkg>-extract - æå–<pkg>çš„æºä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">make opencv4-extract</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310170819393.png" alt="image-20231017081936374"></p>
<p>â€‹	<pkg>-patch - å¯¹<pkg>åº”ç”¨è¡¥ä¸</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">make opencv4-patch</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310170821298.png" alt="image-20231017082105272">	<pkg>-depends - æ„å»º<pkg>çš„ä¾èµ–é¡¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">make opencv4-depends</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310170821715.png" alt="image-20231017082141682"></p>
<p>â€‹	<pkg>-configure - æ„å»º<pkg>åˆ°é…ç½®é˜¶æ®µ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">make opencv4-configure</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310170830641.png" alt="image-20231017083044583"></p>
<p>â€‹	<pkg>-build - æ„å»º<pkg>åˆ°ç¼–è¯‘é˜¶æ®µ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">make opencv4-build</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310170831059.png" alt="image-20231017083149028"></p>
<p>â€‹	<pkg>-show-info - ç”Ÿæˆå…³äº<pkg>çš„ä¿¡æ¯ï¼Œä»¥JSONæ ¼å¼å‘ˆç°<br>â€‹	<pkg>-show-depends - åˆ—å‡º<pkg>ä¾èµ–çš„è½¯ä»¶åŒ…<br>â€‹	<pkg>-show-rdepends - åˆ—å‡ºä»¥<pkg>ä¸ºä¾èµ–çš„è½¯ä»¶åŒ…<br>â€‹	<pkg>-show-recursive-depends é€’å½’åˆ—å‡º<pkg>ä¾èµ–çš„è½¯ä»¶åŒ…<br>â€‹	<pkg>-show-recursive-rdepends  é€’å½’åˆ—å‡ºä»¥<pkg>ä¸ºä¾èµ–çš„è½¯ä»¶åŒ…<br>â€‹	<pkg>-graph-depends - ç”Ÿæˆ<pkg>ä¾èµ–å…³ç³»çš„å›¾å½¢<br>â€‹	<pkg>-graph-rdepends - ç”Ÿæˆ<pkg>åå‘ä¾èµ–å…³ç³»çš„å›¾å½¢<br>â€‹	<pkg>-dirclean - åˆ é™¤<pkg>çš„æ„å»ºç›®å½•<br>â€‹	<pkg>-reconfigure - ä»é…ç½®é˜¶æ®µé‡æ–°å¼€å§‹æ„å»º<br>â€‹	<pkg>-rebuild - ä»ç¼–è¯‘é˜¶æ®µé‡æ–°å¼€å§‹æ„å»º<br>â€‹	<pkg>-reinstall - ä»å®‰è£…é˜¶æ®µé‡æ–°å¼€å§‹æ„å»º</p>
<p><strong>æ–‡æ¡£ï¼š</strong><br>    manual - æ„å»ºæ‰€æœ‰æ ¼å¼çš„æ‰‹å†Œ<br>    manual-html - æ„å»ºHTMLæ ¼å¼çš„æ‰‹å†Œ<br>    manual-split-html - æ„å»ºæ‹†åˆ†çš„HTMLæ ¼å¼çš„æ‰‹å†Œ<br>    manual-pdf - æ„å»ºPDFæ ¼å¼çš„æ‰‹å†Œ<br>    manual-text - æ„å»ºæ–‡æœ¬æ ¼å¼çš„æ‰‹å†Œ<br>    manual-epub - æ„å»ºePubæ ¼å¼çš„æ‰‹å†Œ<br>    graph-build - ç”Ÿæˆæ„å»ºæ—¶é—´çš„å›¾è¡¨<br>    graph-depends - ç”Ÿæˆä¾èµ–æ ‘çš„å›¾è¡¨<br>    graph-size - ç”Ÿæˆæ–‡ä»¶ç³»ç»Ÿå¤§å°çš„ç»Ÿè®¡ä¿¡æ¯<br>    list-defconfigs - åˆ—å‡ºæ‰€æœ‰é¢„é…ç½®çš„æœ€å°ç³»ç»Ÿ</p>
<p><strong>æ‚é¡¹ï¼š</strong><br>source - ä¸‹è½½ç¦»çº¿æ„å»ºæ‰€éœ€çš„æ‰€æœ‰æºä»£ç <br>external-deps - åˆ—å‡ºä½¿ç”¨çš„å¤–éƒ¨è½¯ä»¶åŒ…<br>legal-info - ç”Ÿæˆæœ‰å…³è®¸å¯è¯åˆè§„æ€§çš„ä¿¡æ¯<br>show-info - ç”Ÿæˆå…³äºè½¯ä»¶åŒ…çš„ä¿¡æ¯ï¼Œä»¥JSONæ ¼å¼å‘ˆç°<br>pkg-stats - ä»¥JSONå’ŒHTMLæ ¼å¼ç”Ÿæˆæœ‰å…³è½¯ä»¶åŒ…çš„ä¿¡æ¯<br>printvars - å¯¼å‡ºé€šè¿‡VARS&#x3D;â€¦é€‰æ‹©çš„å†…éƒ¨å˜é‡<br>show-vars - ä»¥JSONæ ¼å¼å‘ˆç°æ‰€æœ‰å†…éƒ¨å˜é‡ï¼›ä½¿ç”¨VARS&#x3D;â€¦é™åˆ¶åˆ—è¡¨ä»¥åŒ¹é…è¯¥æ¨¡å¼</p>
<p>make V&#x3D;0|1 - 0 &#x3D;&gt; é™é»˜æ„å»ºï¼ˆé»˜è®¤ï¼‰ï¼Œ1 &#x3D;&gt; è¯¦ç»†æ„å»º<br>make O&#x3D;dir - å°†æ‰€æœ‰è¾“å‡ºæ–‡ä»¶å®šä½åœ¨â€dirâ€ä¸­ï¼ŒåŒ…æ‹¬.configæ–‡ä»¶</p>
<p>æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…READMEï¼Œç”ŸæˆBuildrootæ‰‹å†Œæˆ–åœ¨çº¿æŸ¥é˜…å®ƒï¼Œç½‘å€ä¸º<a href="http://buildroot.org/docs.html">http://buildroot.org/docs.html</a></p>
]]></content>
      <categories>
        <category>ç‘èŠ¯å¾®</category>
      </categories>
  </entry>
  <entry>
    <title>æŒ‚è½½é•œåƒæ–‡ä»¶</title>
    <url>/2023/10/08/18%20%E6%8C%82%E8%BD%BD%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç¼–è¯‘å®Œæˆä¹‹åçš„é•œåƒä¸ºubuntu-22.04.3-preinstalled-desktop-arm64.imgï¼Œè¿™é‡Œé¢åŒ…æ‹¬spl tpl uboot bootåˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿåˆ†åŒºï¼Œå…¶ä¸­spl tpl ubootæ˜¯é€šè¿‡ddå‘½ä»¤å†™å…¥çš„ï¼Œè€Œå¦å¤–ä¸¤ä¸ªæ˜¯åˆ›å»ºçš„åˆ†åŒºï¼Œç°åœ¨æˆ‘æƒ³çš„æ˜¯æŒ‚è½½ä¸Šè¿™ä¸ªimgé•œåƒï¼Œç„¶åæŸ¥çœ‹é‡Œé¢çš„ç³»ç»Ÿï¼Œåœ¨CSDNä¸Šæ‰¾åˆ°äº†è¿™æ ·ä¸€ä¸ªåšå®¢</p>
<p><a href="https://blog.csdn.net/yangleo1987/article/details/58603205?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169677013016800184112679%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=169677013016800184112679&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-2-58603205-null-null.142%5Ev95%5EchatgptT3_1&utm_term=linux%E4%B8%8B%E6%8C%82%E8%BD%BDimg%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6&spm=1018.2226.3001.4187">æŒ‚è½½imgåˆ†åŒº</a></p>
<p>é¦–å…ˆä½¿ç”¨fdiskå‘½ä»¤æŸ¥çœ‹imgé•œåƒåˆ†åŒº</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">fdisk ubuntu-22.04.3-preinstalled-desktop-arm64.img</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310082107478.png" alt="image-20231008210757445"></p>
<p>åˆ†åŒºæ˜¯ä»32768å’Œ1081344å¼€å§‹çš„ï¼Œç„¶åï¼Œå°±å¯ä»¥æŒ‚è½½åˆ†åŒºäº†ï¼Œè¿™é‡Œè¦ç”¨åˆ°offsetå‚æ•°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mount -o loop,offset=$((32768*512))  ubuntu-22.04.3-preinstalled-desktop-arm64.img    1 </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mount -o loop,offset=$((61440*512))  ubuntu-22.04.3-preinstalled-desktop-arm64.img    1 </span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mount -o loop,offset=$((1081344*512))  ubuntu-22.04.3-preinstalled-desktop-arm64.img    2 </span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/usr/bin/make -f ./Makefile intdeb-pkg \</span><br><span class="line">  KERNELRELEASE=5.10.160-rockchip \</span><br><span class="line">  KDEB_PKGVERSION=5.10.160-14 \</span><br><span class="line">  CROSS_COMPILE=aarch64-linux-gnu- \</span><br><span class="line">  ARCH=arm64 \</span><br><span class="line">  -j 32</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gzip -dc ../initrd.img | cpio -idm</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lz4 -dc ../initrd.img | cpio -idm</span><br></pre></td></tr></table></figure>




]]></content>
      <categories>
        <category>ç‘èŠ¯å¾®</category>
      </categories>
  </entry>
  <entry>
    <title>é€‚é…ç‘èŠ¯å¾®å®˜æ–¹SDK</title>
    <url>/2023/09/27/17%20%E9%80%82%E9%85%8D%E7%91%9E%E8%8A%AF%E5%BE%AE%E5%AE%98%E6%96%B9SDK/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272155420.jpeg" alt="Rockchip bootflow.jpg"></p>
<p>ç‘èŠ¯å¾®çš„åˆ†åŒºè¡¨å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè™½ç„¶åœ¨ç‘èŠ¯å¾®çš„wikiä¸­æä¾›äº†ä¸€äº›ç®€å•çš„å¼€æºä»‹ç»ï¼Œä½†æ˜¯æˆ‘æ˜¯æ²¡æœ‰è§è¿‡çš„ã€‚ï¼Œï¼Œå¾ˆå‘ï¼Œæ‰€ä»¥è¿˜æ˜¯ä»¥ç‘èŠ¯å¾®çš„å¼€æ”¾SDKè¿›è¡Œç§»æ¤</p>
<h1 id="1-miniloader"><a href="#1-miniloader" class="headerlink" title="1. miniloader"></a>1. miniloader</h1><p>ç‘èŠ¯å¾®å®˜æ–¹miniloaderè·¯å¾„ä¸º<a href="https://github.com/rockchip-linux/rkbin.git">https://github.com/rockchip-linux/rkbin.git</a></p>
<p>é¦–å…ˆå…‹éš†å®˜æ–¹çš„rkbinï¼Œç‘èŠ¯å¾®æä¾›äº†é—­æºçš„çš„äºŒè¿›åˆ¶æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/rockchip-linux/rkbin.git</span><br></pre></td></tr></table></figure>

<p>æ‹‰å–å®Œæˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272158411.png" alt="image-20230927215856386"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272159325.png" alt="image-20230927215908314"></p>
<p>ç‘èŠ¯å¾®çš„READMEå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Rockchip loader binaries naming rule</span><br><span class="line"></span><br><span class="line">æ€»åˆ™ï¼š</span><br><span class="line">ä¸ç®¡å•ä¸ªæ¨¡å—ï¼Œè¿˜æ˜¯åˆå¹¶åçš„loaderï¼Œå‘½åéƒ½é‡‡ç”¨</span><br><span class="line">[chip]_[module]_[feature]_[version].[postfix]</span><br><span class="line"></span><br><span class="line">chip: èŠ¯ç‰‡æˆ–èŠ¯ç‰‡ç³»åˆ—åç§°, å¿…é€‰é¡¹, ä¸æ‰€æœ‰kernel/uboot driverä¸­çš„åç§°ä¿æŒä¸€è‡´, å…·ä½“å‘½åæ–¹å¼ä¸åœ¨æ­¤è®¨è®º, å°å†™</span><br><span class="line">module: æ¨¡å—åç§°, å¿…é€‰é¡¹, å¦‚loader, ddr, miniloaderï¼Œusbplug,bl3x,tee,tee_taï¼Œå°å†™</span><br><span class="line">feature: æ¨¡å—ç‰¹å¾, å¯é€‰é¡¹, å¯å¤šä¸ª, å¦‚ddrä½¿ç”¨çš„é¢‘ç‡, æˆ–è€…åªæ”¯æŒæŸä¸ªç‰¹å®šçš„ddr, miniloaderçš„ç‰¹åˆ«é€‰é¡¹ç­‰, å°å†™</span><br><span class="line">version: ç‰ˆæœ¬ä¿¡æ¯, å¿…é€‰é¡¹, æ ¼å¼é‡‡ç”¨[v1.00,], æ­£å¼å‘å¸ƒä¹‹å‰ä¸º0.xx, æ­£å¼å‘å¸ƒåä¸º1.00ä»¥åï¼Œå°å†™</span><br><span class="line">postfix: åç¼€å, å¿…é€‰é¡¹, ä»£ç ç¼–è¯‘å‡ºæ¥çš„é»˜è®¤ä¸º.bin, ä¹Ÿæœ‰å¯èƒ½ä¸º.elf, åˆå¹¶åä¸º.imgï¼Œå°å†™</span><br><span class="line">è¿æ¥ç¬¦å·é‡‡ç”¨ä¸‹åˆ’çº¿â€œ_â€</span><br><span class="line">ä¾‹å¦‚ï¼š</span><br><span class="line">ddræ¨¡å—æä¾›çš„æ–‡ä»¶</span><br><span class="line">rk3228_ddr3_800MHz_v1.06.bin</span><br><span class="line"></span><br><span class="line">ç‰¹æ®Šè§„åˆ™ï¼š</span><br><span class="line">1. åˆå¹¶åçš„loaderå‘½å:</span><br><span class="line">    loader: ç”±ddrbin, usbplug, miniloaderåˆå¹¶è€Œæˆå¯ç”¨äºWindows RKå‡çº§å·¥å…·ä½¿ç”¨çš„loader;</span><br><span class="line">    ubootloader: ç”±ddrbin, usbplug, U-Bootåˆå¹¶è€Œæˆå¯ç”¨äºWindows RKå‡çº§å·¥å…·ä½¿ç”¨çš„loader;</span><br><span class="line">    idbloader: ç”±ddrbin, ä¸€çº§loader(miniloaderæˆ–uboot)æŒ‰IDBæ ¼å¼åˆå¹¶ç›´æ¥ç”¨äºçƒ§å†™åˆ°IDBåŒºçš„binary;</span><br><span class="line">    æ³¨: miniloaderçš„å‘½å, ä»…è¡¨ç¤ºminiloaderå·¥ç¨‹ç¼–è¯‘è¾“å‡ºçš„bin, ä¸å†å»¶ç»­åˆ°åˆå¹¶åçš„loaderä¸­ä½¿ç”¨;</span><br><span class="line">2. åˆå¹¶åçš„loaderçš„versionå®šä¹‰:</span><br><span class="line">    vx.yy.zzz</span><br><span class="line">v:  versionçš„æ„æ€ï¼Œä¸€ç›´é‡‡ç”¨è¿™ä¸ªå­—ç¬¦ï¼Œå°å†™</span><br><span class="line">x.yy: ddræ‰€æä¾›æ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼Œå°å†™</span><br><span class="line">zzz: [1]æ˜¯miniloaderæ‰€æä¾›æ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼Œå»æ‰ç‚¹å·çš„ï¼Œå°å†™</span><br><span class="line">     [2]ubootæä¾›çš„ç‰ˆæœ¬å·</span><br><span class="line"></span><br><span class="line">3. å‘½åå°å†™ä¼šå¼•èµ·æ­§ä¹‰çš„ï¼Œå°±ç”¨å¤§å†™</span><br><span class="line">å¦‚ddrçš„GBï¼Œä¸èƒ½å†™æˆgb</span><br><span class="line">ä¸¾ä¾‹ï¼š</span><br><span class="line">åˆå¹¶å¥½çš„loaderå‘½åï¼š</span><br><span class="line">rk3328_loader_v1.03.106.bin</span><br><span class="line">å…¶ä¸­çš„1.03æ˜¯ddrçš„ç‰ˆæœ¬å·v1.03</span><br><span class="line">106æ˜¯miniloaderçš„ç‰ˆæœ¬å·v1.06å»æ‰ç‚¹å·çš„</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å¯¹è¿™äº›ç›®å½•çš„å†…å®¹è¿›è¡Œä»‹ç»</p>
<ol>
<li>**bin&#x2F;**ï¼šé€šå¸¸ç”¨äºå­˜æ”¾å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰</li>
</ol>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272203645.png" alt="image-20230927220321625"></p>
<p>è¿›å…¥è¯¥ç›®å½•ä¹‹ååˆæœ‰ä¸€ç³»åˆ—çš„å­ç›®å½•ï¼Œæˆ‘ä»¬è¦é€‚é…çš„æ˜¯3588ï¼Œæ‰€ä»¥è¦è¿›å…¥rk35çš„ç›®å½•ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272204357.png" alt="image-20230927220422326"></p>
<p>æ ¹æ®åç§°æ¥çœ‹æ€»å…±æ˜¯æœ‰ä¸¤ç§ç±»å‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåˆ†åˆ«ä¸ºrk<strong>ddr*çš„tpl å’Œ rkâ€œ</strong>â€splçš„splï¼Œç¬¬ä¸€ä¸ªç”¨æ¥è¿›è¡Œåˆå§‹åŒ–å†…å­˜ï¼Œç„¶ååŠ è½½splï¼Œsplç”¨æ¥åˆå§‹åŒ–æ—¶é’Ÿç­‰å…¶ä»–å¤–è®¾ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨åˆ°çš„åº”è¯¥æ˜¯rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v1.12.binå’Œrk3588_spl_v1.12.binä¸¤äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œ</p>
<p>2.**doc&#x2F;**ç›®å½•ï¼Œé€šå¸¸ç”¨äºå­˜æ”¾æ–‡æ¡£æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œæœ‰ç€æ›´æ–°æ—¶å€™çš„ä¸€äº›è¯´æ˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272213894.png" alt="image-20230927221327879"></p>
<p>3.imgç›®å½•æ ¹3588æ— å…³ä¸ç”¨ç†ä¼šã€‚</p>
<p>4.<strong>LICENSE</strong>ï¼šé€šå¸¸ç”¨äºå­˜æ”¾è½¯ä»¶æˆ–é¡¹ç›®çš„è®¸å¯è¯ä¿¡æ¯</p>
<p>5.README**ï¼šæ˜¯ä¸€ä¸ªç®€è¦çš„è¯´æ˜æ–‡ä»¶</p>
<p>6.**RKBOOT&#x2F;**ï¼šå®ƒå¯èƒ½åŒ…å«ä¸å¼•å¯¼ï¼ˆBootï¼‰ç›¸å…³çš„æ–‡ä»¶ã€è„šæœ¬æˆ–é…ç½®ã€‚å…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272215234.png" alt="image-20230927221534210"></p>
<p>è¿™ä¸ªå…¶å®æ˜¯åé¢è®²åˆ°uboot make.shæ—¶å€™çš„è¯´æ˜ï¼Œç”¨æ¥å°†splå’Œtplæ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„miniloaderçš„ï¼Œæˆ‘ä»¬è¦ç”¨åˆ°çš„æ˜¯RK3588MINIALL.iniï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼šã€</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272217736.png" alt="image-20230927221754711"></p>
<p>Path1&#x3D;bin&#x2F;rk35&#x2F;rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v1.12.bin</p>
<p>FlashData&#x3D;bin&#x2F;rk35&#x2F;rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v1.12.bin</p>
<p>FlashBoot&#x3D;bin&#x2F;rk35&#x2F;rk3588_spl_v1.12.bin</p>
<p>PATH&#x3D;rk3588_spl_loader_v1.12.112.bin</p>
<p>7.<strong>RKBOOT.ini</strong>ï¼šä¸ç”¨ç®¡</p>
<p>8.**RKTRUST&#x2F;**ï¼šè¿™æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå¯èƒ½ä¸ Rockchip å¹³å°å®‰å…¨æ€§ï¼ˆTrustï¼‰ç›¸å…³ã€‚æ ¹æ®ç›®å½•åç§°ï¼Œå®ƒå¯èƒ½åŒ…å«ä¸å®‰å…¨å¯åŠ¨ã€å®‰å…¨å¼•å¯¼æˆ–å®‰å…¨è®¤è¯ç›¸å…³çš„æ–‡ä»¶ã€è„šæœ¬æˆ–é…ç½®ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272219951.png" alt="image-20230927221941937"></p>
<p>â€‹	è¿™ä¹Ÿæ˜¯ä¸€äº›iniæ–‡ä»¶ï¼Œè¿™æ˜¯åŸºäºå¼€æºçš„bl31å’Œbl32æ¥çš„ï¼Œä¸Šé¢çš„ä¸¤ä¸ªæµç¨‹å‘€ï¼Œå±äºç¬¬äºŒæ¡ï¼Œé—­æºçš„miniloaderå±äºç¬¬ä¸€æ¡ã€‚</p>
<ol>
<li>**scripts&#x2F;**ï¼šcheckpatch.shåªæœ‰è¿™ä¸€ä¸ªè„šæœ¬ï¼Œçœ‹äº†ä¸€ä¸‹åº”è¯¥æ²¡å•¥ç”¨ï¼Œåº”è¯¥æ˜¯ç‘èŠ¯å¾®ç”¨äºæ£€æŸ¥æ—¶å€™çš„ä¸€ä¸ªè„šæœ¬ï¼Œ</li>
<li>è¿™äº›è„šæœ¬å¯ä»¥ç”¨äºè‡ªåŠ¨åŒ–ä»»åŠ¡ã€é…ç½®è®¾ç½®ã€ç¼–è¯‘æ„å»ºç­‰ã€‚</li>
<li>**tools&#x2F;**ï¼šè¿™æ˜¯ä¸€ä¸ªç›®å½•ï¼Œé€šå¸¸ç”¨äºå­˜æ”¾å·¥å…·æ–‡ä»¶ã€‚å·¥å…·æ–‡ä»¶å¯ä»¥æ˜¯ç”¨äºç‰¹å®šä»»åŠ¡æˆ–ç›®çš„çš„å®ç”¨ç¨‹åºã€åº”ç”¨ç¨‹åºæˆ–è„šæœ¬ã€‚è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©ä½ å®Œæˆå„ç§æ“ä½œï¼Œå¦‚è°ƒè¯•ã€åˆ†æã€è½¬æ¢ç­‰ã€‚</li>
</ol>
<p>ddrbin_tool_user_guide.txt æ˜¯ddrbin_toolçš„ä½¿ç”¨è¯´æ˜ï¼Œå€’æ˜¯è¿˜æŒºè¯¦ç»†ï¼Œæˆ‘ä»¬è¦æ”¹çš„æ˜¯ddrç›¸å…³çš„tplï¼Œé‡è¦å†…å®¹æ•´ç†å¦‚ä¸‹</p>
<p><strong>åŠŸèƒ½ 1ï¼šä» ddrbin_param.txt ä¿®æ”¹ ddr.bin æ–‡ä»¶ã€‚</strong></p>
<ol>
<li>ä¿®æ”¹ â€˜ddrbin_param.txtâ€™ æ–‡ä»¶ï¼Œè®¾ç½®ä½ æƒ³è¦çš„ DDR é¢‘ç‡ã€UART ä¿¡æ¯ç­‰ã€‚å¦‚æœæƒ³ä¿æŒé»˜è®¤å€¼ï¼Œè¯·å°†è¿™äº›é¡¹ç›®ç•™ç©ºã€‚</li>
<li>è¿è¡Œ â€˜ddrbin_toolâ€™ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹å‚æ•°ï¼šå‚æ•° 1 ä¸º ddrbin_param.txtï¼Œå‚æ•° 2 ä¸º ddr.bin æ–‡ä»¶ã€‚<br>ä¾‹å¦‚ï¼š.&#x2F;ddrbin_tool ddrbin_param.txt px30_ddr_333MHz_v1.13.bin</li>
</ol>
<p><strong>åŠŸèƒ½ 2ï¼šå°† ddr.bin æ–‡ä»¶çš„é…ç½®ä¿å­˜åˆ° gen_param.txt æ–‡ä»¶ä¸­ã€‚</strong><br>å¦‚æœæƒ³è¦è·å– ddr.bin æ–‡ä»¶çš„é…ç½®ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š<br>.&#x2F;ddrbin_tool -g gen_param.txt px30_ddr_333MHz_v1.15.bin<br>é…ç½®ä¿¡æ¯å°†æ˜¾ç¤ºåœ¨ gen_param.txt æ–‡ä»¶ä¸­ã€‚</p>
<p>è€Œæˆ‘è¦ä¿®æ”¹çš„æ˜¯rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v1.12.binï¼Œæƒ³ç”¨åŠŸèƒ½2 ä¿å­˜åˆ° gen_param.txt</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./ddrbin_tool -g  gen_param.txt rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v1.12.bin</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031753004.png" alt="image-20231003175311976"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031753485.png" alt="image-20231003175354464"></p>
<p>ä¿®æ”¹ä¹‹åè¿˜éœ€è¦é‡æ–°ç”Ÿæˆbinæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./ddrbin_tool gen_param.txt rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v1.12.bin</span><br></pre></td></tr></table></figure>

<p><strong><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031756166.png" alt="image-20231003175617140"></strong></p>
<p>ä¿®æ”¹çš„åœ°æ–¹åªæœ‰è¿™é‡Œçš„115200ï¼Œå…¶ä»–å€’æ˜¯æ²¡å…³ï¼Œç„¶åå°±æ˜¯çœ‹çœ‹å¦‚ä½•æ•´åˆsplå’Œtpläº†ï¼Œæ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„loader.bin</p>
<p>è¿™é‡Œæˆ‘å°±ä¸ç”¨ubootçš„çš„make.shäº†ï¼Œè€Œæ˜¯æ‰¾åˆ°ä»–çš„å‘½ä»¤å’Œmakefileå…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">function pack_loader_image()</span><br><span class="line">&#123;</span><br><span class="line">	rm -f *loader*.bin *download*.bin *idblock*.img</span><br><span class="line">	cd $&#123;RKBIN&#125;</span><br><span class="line">	DEF_PATH=$&#123;RKBIN&#125;/`filt_val &quot;^PATH&quot; $&#123;INI_LOADER&#125;`</span><br><span class="line">	IDB_PATH=$&#123;RKBIN&#125;/`filt_val &quot;IDB_PATH&quot; $&#123;INI_LOADER&#125;`</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">&#123;SCRIPT_LOADER&#125; --ini <span class="variable">$&#123;INI_LOADER&#125;</span></span></span><br><span class="line">	cd -</span><br><span class="line">	if [ -f $&#123;DEF_PATH&#125; ]; then</span><br><span class="line">		mv $&#123;DEF_PATH&#125; ./</span><br><span class="line">	fi</span><br><span class="line">	if [ -f $&#123;IDB_PATH&#125; ]; then</span><br><span class="line">		mv $&#123;IDB_PATH&#125; ./</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Copyright (c) 2020 Rockchip Electronics Co., Ltd</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># SPDX-License-Identifier: GPL-2.0</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span></span><br><span class="line">set -e</span><br><span class="line"></span><br><span class="line">if [ $# -eq 0 ]; then</span><br><span class="line">	echo &quot;ERROR: No args of $0&quot;</span><br><span class="line">	exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">while [ $# -gt 0 ]; do</span><br><span class="line">	case $1 in</span><br><span class="line">		--ini)</span><br><span class="line">			INI=$2</span><br><span class="line">			shift 2</span><br><span class="line">			;;</span><br><span class="line">		*)</span><br><span class="line">			echo &quot;ERROR: Unknown arg: $1&quot;</span><br><span class="line">			exit 1</span><br><span class="line">			;;</span><br><span class="line">	esac</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">if [ ! -f $&#123;INI&#125; ]; then</span><br><span class="line">	echo &quot;pack loader failed! Can&#x27;t find: $&#123;INI&#125;&quot;</span><br><span class="line">	exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">COUNT=`cat $&#123;INI&#125; | wc -l`</span><br><span class="line">if [ $&#123;COUNT&#125; -eq 1 ]; then</span><br><span class="line">	IMG=`sed -n &quot;/PATH=/p&quot; $&#123;INI&#125; | tr -d &#x27;\r&#x27; | cut -d &#x27;=&#x27; -f 2`</span><br><span class="line">	cp $&#123;IMG&#125; ./</span><br><span class="line">else</span><br><span class="line">	./tools/boot_merger $&#123;INI&#125;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo &quot;pack loader okay! Input: $&#123;INI&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>æœ€åç”¨çš„è¿˜æ˜¯boot_mergerè¿™ä¸ªå·¥å…·ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./tools/boot_merger RKBOOT/RK3588MINIALL.ini</span><br></pre></td></tr></table></figure>



<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031810759.png" alt="image-20231003181000745"></p>
<p>å…³äºsplå’Œtplå°±è¿™æ ·äº†ï¼Œç„¶åæ˜¯uboot</p>
<h1 id="2-uboot"><a href="#2-uboot" class="headerlink" title="2.uboot"></a>2.uboot</h1><p>å…‹éš†æºç </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/rockchip-linux/u-boot.git</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031845388.png" alt="image-20231003184552359"></p>
<p>ä¿®æ”¹make menuconfigï¼Œrk3588çš„é»˜è®¤é…ç½®æ–‡ä»¶ä¸º.&#x2F;configs&#x2F;rk3588_defconfig</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031852329.png" alt="image-20231003185216305"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export arch=arm64</span><br><span class="line">make rk3588_defconfig</span><br><span class="line">make menuconfig</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031855129.png" alt="image-20231003185541087"></p>
<p>ç›®å‰åªéœ€è¦å°†è¿™é‡Œçš„ubootä¿®æ”¹ä¸º115200å³å¯ï¼Œç„¶åé‡æ–°ä¿å­˜configs&#x2F;rk3588_defconfigï¼Œé‡æ–°ç¼–è¯‘</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export arch=arm64</span><br><span class="line">make rk3588_defconfig</span><br><span class="line">make CROSS_COMPILE=&quot;aarch64-linux-gnu-&quot; -j32</span><br><span class="line">modules_install</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031858771.png" alt="image-20231003185809741"></p>
<p>ç¼–è¯‘å®Œè¿™é‡Œçš„uboot.imgå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„é•œåƒï¼Œä¸å¯¹ï¼Œåæ¥å‘ç°äº‹æƒ…å¹¶ä¸æ˜¯æƒ³çš„é‚£æ ·ï¼Œç†è®ºä¸Šåº”è¯¥æ˜¯uboot.imgè¿™é‡Œçš„é€‰æ‹©ä¸å¯¹ã€‚æ‰€ä»¥æ¥ä¸‹æ¥å»å¯»æ‰¾uboot.imgçš„ç”Ÿæˆæµç¨‹</p>
<p>å®é™…åº”è¯¥æ˜¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./make.sh rk3588 CROSS_COMPILE=aarch64-linux-gnu-</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031920218.png" alt="image-20231003192010183"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¯‘uboot.itb</span></span><br><span class="line">make CROSS_COMPILE=&quot;aarch64-linux-gnu-&quot; -j32 u-boot.itb</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310051037632.png" alt="image-20231005103717571"></p>
<p>ä½†æ˜¯å¹¶æ²¡æœ‰æ‰¾åˆ°æºå¤´ï¼Œç„¶åæ‰¾ä¸€ä¸‹make.shçš„å†…å®¹å…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“åŒ…ç”Ÿæˆubooté•œåƒ</span></span><br><span class="line">function pack_uboot_image()</span><br><span class="line">&#123;</span><br><span class="line">	rm u-boot.img u-boot-dtb.img -f</span><br><span class="line">	LOAD_ADDR=`sed -n &quot;/CONFIG_SYS_TEXT_BASE=/s/CONFIG_SYS_TEXT_BASE=//p&quot; include/autoconf.mk|tr -d &#x27;\r&#x27;`</span><br><span class="line">	if [ -z &quot;$&#123;LOAD_ADDR&#125;&quot; ]; then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">upstream U-Boot</span></span><br><span class="line">		LOAD_ADDR=`grep CONFIG_SYS_TEXT_BASE include/generated/autoconf.h | awk &#x27;&#123; print $3 &#125;&#x27; | tr -d &#x27;\r&#x27;`</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [ -z &quot;$&#123;LOAD_ADDR&#125;&quot; ]; then</span><br><span class="line">		echo &quot;ERROR: No CONFIG_SYS_TEXT_BASE for u-boot&quot;;</span><br><span class="line">		exit 1</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">&#123;SCRIPT_UBOOT&#125; --load <span class="variable">$&#123;LOAD_ADDR&#125;</span> <span class="variable">$&#123;PLAT_UBOOT_SIZE&#125;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SCRIPT_UBOOT&#x3D;â€${SRCTREE}&#x2F;scripts&#x2F;uboot.shâ€</p>
<p>LOAD_ADDR&#x3D;0x00200000</p>
<p>â€“size 2048 1</p>
<p>configs&#x2F;rk3588-ramboot.config:4:CONFIG_UBOOT_SIZE_KB&#x3D;2048</p>
<p>configs&#x2F;rk3588-ramboot.config:5:CONFIG_UBOOT_NUM&#x3D;1</p>
<p>å¯è¡Œçš„ä»£ç ä¸º</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./scripts/uboot.sh --load  0x00200000 --size 2048 1</span><br></pre></td></tr></table></figure>



<p>uboot.shå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Copyright (c) 2020 Rockchip Electronics Co., Ltd</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># SPDX-License-Identifier: GPL-2.0</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span></span><br><span class="line">set -e</span><br><span class="line"></span><br><span class="line">if [ $# -eq 0 ]; then</span><br><span class="line">        echo &quot;ERROR: No args of $0&quot;</span><br><span class="line">        exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">while [ $# -gt 0 ]; do</span><br><span class="line">        case $1 in</span><br><span class="line">                --load)</span><br><span class="line">                        LOAD_ADDR=$2</span><br><span class="line">                        shift 2</span><br><span class="line">                        ;;</span><br><span class="line">                --size)</span><br><span class="line">                        SIZE=&quot;$1 $2 $3&quot;</span><br><span class="line">                        shift 3</span><br><span class="line">                        ;;</span><br><span class="line">                *)</span><br><span class="line">                        echo &quot;ERROR: Unknown arg: $1&quot;</span><br><span class="line">                        exit 1</span><br><span class="line">                        ;;</span><br><span class="line">        esac</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">rm uboot.img -f</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$&#123;LOAD_ADDR&#125;&quot; ]; then</span><br><span class="line">        echo &quot;ERROR: No load address&quot;</span><br><span class="line">        exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">HEAD_KB=2</span><br><span class="line">BIN_KB=`ls -l u-boot.bin | awk &#x27;&#123; print $5 &#125;&#x27;`</span><br><span class="line">if [ -z &quot;$&#123;SIZE&#125;&quot; ]; then</span><br><span class="line">        MAX_KB=1046528</span><br><span class="line">else</span><br><span class="line">        MAX_KB=`echo $&#123;SIZE&#125; | awk &#x27;&#123;print strtonum($2)&#125;&#x27;`</span><br><span class="line">        MAX_KB=$(((MAX_KB-HEAD_KB)*1024))</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $&#123;BIN_KB&#125; -gt $&#123;MAX_KB&#125; ]; then</span><br><span class="line">        echo &quot;ERROR: pack uboot failed! u-boot.bin actual: $&#123;BIN_KB&#125; bytes, max limit: $&#123;MAX_KB&#125; bytes&quot;</span><br><span class="line">        exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">../rkbin/tools/loaderimage --pack --uboot u-boot.bin uboot.img $&#123;LOAD_ADDR&#125; $&#123;SIZE&#125;</span><br><span class="line">echo &quot;pack uboot okay! Input: u-boot.bin&quot;</span><br><span class="line">echo</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è€Œå®é™…ä¸Šä½¿ç”¨çš„å‘½ä»¤æ˜¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">../rkbin/tools/loaderimage --pack --uboot u-boot.bin uboot.img 0x00200000 --size 2048 1</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310032021655.png" alt="image-20231003202108625"></p>
<p>ä¸çŸ¥é“ä»–çš„æºç å‘€~~~~ï¼Œè¿™å°±æ²¡æ„æ€äº†ã€‚ã€‚ã€‚å…ˆè¿™æ ·å§ã€‚</p>
<h1 id="3-kernel"><a href="#3-kernel" class="headerlink" title="3.kernel"></a>3.kernel</h1><p>gitæ‹‰å–æºç </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/rockchip-linux/kernel.git</span><br></pre></td></tr></table></figure>



<p>æŸ¥çœ‹å…¨éƒ¨åˆ†æ”¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310032034502.png" alt="image-20231003203437480"></p>
<p>æˆ‘ç›´æ¥ä¸€æ­¥åˆ°ä½ï¼Œç›´æ¥åˆ°5.10å°±è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout develop-5.10</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310032036427.png" alt="image-20231003203633412"></p>
<p>ç„¶åå¯»æ‰¾kernelçš„ç¼–è¯‘è¿‡ç¨‹ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„å»º Kernel</span></span><br><span class="line">build_kernel()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥ RK_KERNEL_DTS å’Œ RK_KERNEL_DEFCONFIG é…ç½®æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿”å›</span></span><br><span class="line">	check_config RK_KERNEL_DTS RK_KERNEL_DEFCONFIG || return 0</span><br><span class="line"></span><br><span class="line">	echo &quot;============Start building kernel============&quot;</span><br><span class="line">	echo &quot;TARGET_KERNEL_ARCH   =$RK_KERNEL_ARCH&quot;</span><br><span class="line">	echo &quot;TARGET_KERNEL_CONFIG =$RK_KERNEL_DEFCONFIG&quot;</span><br><span class="line">	echo &quot;TARGET_KERNEL_DTS    =$RK_KERNEL_DTS&quot;</span><br><span class="line">	echo &quot;TARGET_KERNEL_CONFIG_FRAGMENT =$RK_KERNEL_DEFCONFIG_FRAGMENT&quot;</span><br><span class="line">	echo &quot;==========================================&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è®¾ç½®äº¤å‰ç¼–è¯‘å·¥å…·é“¾</span></span><br><span class="line">	setup_cross_compile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">ä½¿ç”¨ KMAKE æ„å»º Kernel</span></span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">KMAKE <span class="variable">$RK_KERNEL_DEFCONFIG</span> <span class="variable">$RK_KERNEL_DEFCONFIG_FRAGMENT</span></span></span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">KMAKE <span class="variable">$RK_KERNEL_DTS</span>.img</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥æ˜¯å¦å­˜åœ¨ Kernel FIT æ–‡ä»¶å¹¶ä½¿ç”¨ mk-fitimage.sh åˆ›å»ºé•œåƒ</span></span><br><span class="line">	ITS=&quot;$CHIP_DIR/$RK_KERNEL_FIT_ITS&quot;</span><br><span class="line">	if [ -f &quot;$ITS&quot; ]; then</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">COMMON_DIR/mk-fitimage.sh kernel/<span class="variable">$RK_BOOT_IMG</span> \</span></span><br><span class="line"><span class="language-bash">			<span class="string">&quot;<span class="variable">$ITS</span>&quot;</span> <span class="variable">$RK_KERNEL_IMG</span></span></span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">åˆ›å»ºé“¾æ¥åˆ° rockdev ç›®å½•çš„ boot.img</span></span><br><span class="line">	ln -rsf kernel/$RK_BOOT_IMG rockdev/boot.img</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å°† boot.img å¤åˆ¶åˆ° u-boot ç›®å½•ä¸‹ï¼Œç”¨äºå®‰å…¨æ€§è€ƒè™‘</span></span><br><span class="line">	cp rockdev/boot.img u-boot/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ„å»ºæ£€æŸ¥ç”µæºåŸŸ</span></span><br><span class="line">	build_check_power_domain</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®Œæˆæ„å»ºæµç¨‹</span></span><br><span class="line">	finish_build</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">KMAKE=&quot;make ARCH=arm64 -j32&quot; </span><br><span class="line">CROSS_COMPILE=aarch64-linux-gnu-</span><br></pre></td></tr></table></figure>





<pre><code>make ARCH=arm64 -j32  CROSS_COMPILE=aarch64-linux-gnu- rockchip_linux_defconfig rk3588_linux.config
make ARCH=arm64 -j32  CROSS_COMPILE=aarch64-linux-gnu- rk3588-evb7-lp4-v10-linux.img
</code></pre>
<p>ç¼–è¯‘æˆåŠŸï¼Œä½†æ˜¯è¿˜éœ€è¦ä¿®æ”¹æ³¢ç‰¹ç‡ï¼Œè¦ä¿®æ”¹çš„è®¾å¤‡æ ‘ä¸ºrk3588-linux.dtsi</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310032048880.png" alt="image-20231003204847848"></p>
<p>ç„¶åä¿®æ”¹rk3588-evb7-lp4.dtsiæ–‡ä»¶ï¼Œé‡Œé¢æœ‰PCIEç›¸å…³çš„å†…å®¹ï¼Œéœ€è¦disabledä¸ç„¶ä¼šå¡åœ¨å†…æ ¸</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310032056361.png" alt="image-20231003205604330"></p>
<p>åæ­£ç°åœ¨çš„dhmiå±å¹•é—®é¢˜ä¸å¤§ï¼Œå°±å…ˆè¿™æ ·äº†ã€‚</p>
<h1 id="4-image"><a href="#4-image" class="headerlink" title="4.image"></a>4.image</h1><p>é¦–å…ˆgitå¤§ä½¬çš„æºç </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/Joshua-Riek/ubuntu-rockchip.git</span><br></pre></td></tr></table></figure>

<p>æˆ‘è¿™é‡Œå…ˆä»¥é¦™æ©™æ´¾ä¸ºä¾‹è¿›è¡Œç¼–è¯‘</p>
<p>export VENDOR&#x3D;orangepi</p>
<p>export BOARD&#x3D;orangepi-5b</p>
<p>build-u-boot.shå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">set -eE </span><br><span class="line">trap &#x27;echo Error: in $0 on line $LINENO&#x27; ERR</span><br><span class="line"></span><br><span class="line">if [ &quot;$(id -u)&quot; -ne 0 ]; then</span><br><span class="line">    echo &quot;Please run as root&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">cd &quot;$(dirname -- &quot;$(readlink -f -- &quot;$0&quot;)&quot;)&quot; &amp;&amp; cd ..</span><br><span class="line">mkdir -p build &amp;&amp; cd build</span><br><span class="line"></span><br><span class="line">if [[ -z $&#123;VENDOR&#125; ]]; then</span><br><span class="line">    echo &quot;Error: VENDOR is not set&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ ! -d u-boot-&quot;$&#123;VENDOR&#125;&quot; ]; then</span><br><span class="line">    # shellcheck source=/dev/null</span><br><span class="line">    source ../packages/u-boot-&quot;$&#123;VENDOR&#125;&quot;-rk3588/debian/upstream</span><br><span class="line">    git clone --single-branch --progress -b &quot;$&#123;BRANCH&#125;&quot; &quot;$&#123;GIT&#125;&quot; u-boot-&quot;$&#123;VENDOR&#125;&quot;</span><br><span class="line">    git -C u-boot-&quot;$&#123;VENDOR&#125;&quot; checkout &quot;$&#123;COMMIT&#125;&quot;</span><br><span class="line">    cp -r ../packages/u-boot-&quot;$&#123;VENDOR&#125;&quot;-rk3588/debian u-boot-&quot;$&#123;VENDOR&#125;&quot;</span><br><span class="line">fi</span><br><span class="line">cd u-boot-&quot;$&#123;VENDOR&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Compile u-boot into a deb package</span></span><br><span class="line">dpkg-buildpackage -a &quot;$(cat debian/arch)&quot; -d -b -nc -uc</span><br><span class="line"></span><br><span class="line">rm -f ../*.buildinfo ../*.changes</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>build.shå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">mkdir -p build/logs</span><br><span class="line">exec &gt; &gt;(tee &quot;build/logs/build-$(date +&quot;%Y%m%d%H%M%S&quot;).log&quot;) 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">if [[ $&#123;KERNEL_ONLY&#125; == &quot;Y&quot; ]]; then</span><br><span class="line">    eval &quot;$&#123;DOCKER&#125;&quot; ./scripts/build-kernel.sh</span><br><span class="line">    exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;UBOOT_ONLY&#125; == &quot;Y&quot; ]]; then</span><br><span class="line">    eval &quot;$&#123;DOCKER&#125;&quot; ./scripts/build-u-boot.sh</span><br><span class="line">    exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;LAUNCHPAD&#125; != &quot;Y&quot; ]]; then</span><br><span class="line">    if [[ ! -e &quot;$(find build/linux-image-*.deb | sort | tail -n1)&quot; || ! -e &quot;$(find build/linux-headers-*.deb | sort | tail -n1)&quot; ]]; then</span><br><span class="line">        eval &quot;$&#123;DOCKER&#125;&quot; ./scripts/build-kernel.sh</span><br><span class="line">    fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;LAUNCHPAD&#125; != &quot;Y&quot; ]]; then</span><br><span class="line">    if [[ ! -e &quot;$(find build/u-boot-&quot;$&#123;BOARD&#125;&quot;_*.deb | sort | tail -n1)&quot; ]]; then</span><br><span class="line">        eval &quot;$&#123;DOCKER&#125;&quot; ./scripts/build-u-boot.sh</span><br><span class="line">    fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">eval &quot;$&#123;DOCKER&#125;&quot; ./scripts/build-rootfs.sh</span><br><span class="line">eval &quot;$&#123;DOCKER&#125;&quot; ./scripts/config-image.sh</span><br><span class="line"></span><br><span class="line">exit 0</span><br><span class="line">                                                                                                                                     </span><br></pre></td></tr></table></figure>



<p>boot.cmd</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">setenv bootargs &quot;console=ttyS2,115200 earlycon=uart8250,mmio32,0xff130000 root=/dev/mmcblk1p2 rw rootwait&quot;</span><br><span class="line">load mmc 1:1 $&#123;fdt_addr_r&#125; rk3588-evb7-lp4-v10-linux.dtb</span><br><span class="line">setenv kernel_comp_addr_r 0x0a000000</span><br><span class="line">load mmc 1:1 $&#123;kernel_addr_r&#125; Image.gz</span><br><span class="line">setenv kernel_comp_size $&#123;filesize&#125;</span><br><span class="line">booti $&#123;kernel_addr_r&#125; - $&#123;fdt_addr_r&#125;</span><br></pre></td></tr></table></figure>

<p>mkimage -A arm -O linux -T script -C none -a 0 -e 0 -d boot.cmd boot.scr</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310041050935.png" alt="image-20231004105004887"></p>
<p>å®‰è£…å†…æ ¸æ¨¡å—</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">make ARCH=arm64 CROSS_COMPILE=&quot;aarch64-linux-gnu-&quot; INSTALL_MOD_STRIP=1 INSTALL_MOD_PATH=&quot;/home/topeet/rockchip/image/lib&quot; modules_install -j32</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310041100339.png" alt="image-20231004110040296"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find -name &quot;*ko&quot; -exec cp &#123;&#125; /home/topeet/rockchip/image/rootfs/lib/modules/5.10.110 \;</span><br><span class="line">find -name &quot;*ko&quot; | xargs -I &#123;&#125; cp &#123;&#125; /home/topeet/rockchip/image/rootfs/lib/modules/5.10.110</span><br></pre></td></tr></table></figure>



<p>åˆ¶ä½œå®Œæ•´çš„é•œåƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./gen_image_generic.sh &lt;file&gt; &lt;kernel size&gt; &lt;kernel directory&gt; &lt;rootfs size&gt; &lt;rootfs image&gt; [&lt;align&gt;]</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>&lt;file&gt;</code>æ˜¯è¦ç”Ÿæˆçš„é•œåƒæ–‡ä»¶çš„åç§°ï¼Œ<code>&lt;kernel size&gt;</code>æ˜¯å†…æ ¸æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°ï¼Œ<code>&lt;kernel directory&gt;</code>æ˜¯åŒ…å«å†…æ ¸æ–‡ä»¶ç³»ç»Ÿå†…å®¹çš„ç›®å½•ï¼Œ<code>&lt;rootfs size&gt;</code>æ˜¯æ ¹æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°ï¼Œ<code>&lt;rootfs image&gt;</code>æ˜¯æ ¹æ–‡ä»¶ç³»ç»Ÿçš„é•œåƒæ–‡ä»¶ï¼Œ<code>&lt;align&gt;</code>æ˜¯å¯é€‰çš„å¯¹é½å‚æ•°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./gen_image_generic.sh system.img 100 boot 7144 rootfs.img 32768</span><br></pre></td></tr></table></figure>



<p>å†™å…¥uboot</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo dd if=uboot.img of=system.img seek=64 conv=notrunc</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo dd if=system.img of=/dev/sdc status=progress</span><br></pre></td></tr></table></figure>

<h1 id="5-æ‰“åŒ…"><a href="#5-æ‰“åŒ…" class="headerlink" title="5.æ‰“åŒ…"></a>5.æ‰“åŒ…</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">build_updateimg()</span><br><span class="line">&#123;</span><br><span class="line">	IMAGE_PATH=$TOP_DIR/rockdev   # è®¾ç½®IMAGE_PATHå˜é‡ä¸º$TOP_DIR/rockdevï¼Œç”¨äºå­˜å‚¨ç”Ÿæˆçš„é•œåƒæ–‡ä»¶è·¯å¾„</span><br><span class="line">	PACK_TOOL_DIR=$TOP_DIR/tools/linux/Linux_Pack_Firmware   # è®¾ç½®PACK_TOOL_DIRå˜é‡ä¸º$TOP_DIR/tools/linux/Linux_Pack_Firmwareï¼Œç”¨äºå­˜å‚¨æ‰“åŒ…å·¥å…·çš„è·¯å¾„</span><br><span class="line"></span><br><span class="line">	cd $PACK_TOOL_DIR/rockdev   # è¿›å…¥$PACK_TOOL_DIR/rockdevç›®å½•</span><br><span class="line"></span><br><span class="line">	if [ -f &quot;$RK_PACKAGE_FILE_AB&quot; ]; then   # å¦‚æœå­˜åœ¨$RK_PACKAGE_FILE_ABæ–‡ä»¶</span><br><span class="line">		build_sdcard_package   # è°ƒç”¨build_sdcard_packageå‡½æ•°ï¼Œæ„å»ºSDå¡åŒ…</span><br><span class="line">		build_otapackage   # è°ƒç”¨build_otapackageå‡½æ•°ï¼Œæ„å»ºOTAåŒ…</span><br><span class="line"></span><br><span class="line">		cd $PACK_TOOL_DIR/rockdev   # è¿”å›$PACK_TOOL_DIR/rockdevç›®å½•</span><br><span class="line">		echo &quot;Make Linux a/b update_ab.img.&quot;</span><br><span class="line">		source_package_file_name=`ls -lh package-file | awk -F &#x27; &#x27; &#x27;&#123;print $NF&#125;&#x27;`   # è·å–package-fileçš„æ–‡ä»¶å</span><br><span class="line">		ln -fs &quot;$RK_PACKAGE_FILE_AB&quot; package-file   # åˆ›å»ºè½¯é“¾æ¥ï¼Œå°†$RK_PACKAGE_FILE_ABé“¾æ¥åˆ°package-file</span><br><span class="line">		./mkupdate.sh   # è¿è¡Œmkupdate.shè„šæœ¬ï¼Œç”Ÿæˆupdate.img</span><br><span class="line">		mv update.img $IMAGE_PATH/update_ab.img   # å°†ç”Ÿæˆçš„update.imgç§»åŠ¨åˆ°$IMAGE_PATH/update_ab.img</span><br><span class="line">		ln -fs $source_package_file_name package-file   # åˆ›å»ºè½¯é“¾æ¥ï¼Œå°†source_package_file_nameé“¾æ¥åˆ°package-file</span><br><span class="line">	else</span><br><span class="line">		echo &quot;Make update.img&quot;</span><br><span class="line"></span><br><span class="line">		if [ -f &quot;$RK_PACKAGE_FILE&quot; ]; then   # å¦‚æœå­˜åœ¨$RK_PACKAGE_FILEæ–‡ä»¶</span><br><span class="line">			source_package_file_name=`ls -lh package-file | awk -F &#x27; &#x27; &#x27;&#123;print $NF&#125;&#x27;`   # è·å–package-fileçš„æ–‡ä»¶å</span><br><span class="line">			ln -fs &quot;$RK_PACKAGE_FILE&quot; package-file   # åˆ›å»ºè½¯é“¾æ¥ï¼Œå°†$RK_PACKAGE_FILEé“¾æ¥åˆ°package-file</span><br><span class="line">			./mkupdate.sh   # è¿è¡Œmkupdate.shè„šæœ¬ï¼Œç”Ÿæˆupdate.img</span><br><span class="line">			ln -fs $source_package_file_name package-file   # åˆ›å»ºè½¯é“¾æ¥ï¼Œå°†source_package_file_nameé“¾æ¥åˆ°package-file</span><br><span class="line">		else</span><br><span class="line">			./mkupdate.sh   # è¿è¡Œmkupdate.shè„šæœ¬ï¼Œç”Ÿæˆupdate.img</span><br><span class="line">		fi</span><br><span class="line">		mv update.img $IMAGE_PATH   # å°†ç”Ÿæˆçš„update.imgç§»åŠ¨åˆ°$IMAGE_PATH</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	finish_build   # è°ƒç”¨finish_buildå‡½æ•°ï¼Œè¿›è¡Œåç»­çš„æ¸…ç†å’Œå¤„ç†æ“ä½œ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç ”ç©¶äº†ä¸€ä¸‹è¿™ä¸ªç©æ„ï¼Œè¿™ä¸ªæ‰“åŒ…å®Œæˆç¡®å®æ˜¯é—®é¢˜ä¸å¤§ï¼Œç°åœ¨æˆ‘åªæƒ³çŸ¥é“boot.imgæ˜¯æ€æ ·ç¼–è¯‘å‡ºæ¥çš„</p>
<p>boot.img kernel.img resource.img zboot.img</p>
<p>æœ€åæ‰¾åˆ°å‘ç°æ˜¯åœ¨scripts&#x2F;mkimgè„šæœ¬é‡Œï¼Œé‡Œé¢æœ‰ä¸€ä¸ªrepack_boot_imgçš„å‡½æ•°</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make_boot_img()</span><br><span class="line">&#123;</span><br><span class="line">        RAMDISK_IMG_PATH=$&#123;objtree&#125;/ramdisk.img</span><br><span class="line">        [ -f $&#123;RAMDISK_IMG_PATH&#125; ] &amp;&amp; RAMDISK_IMG=ramdisk.img &amp;&amp; RAMDISK_ARG=&quot;--ramdisk $&#123;RAMDISK_IMG_PATH&#125;&quot;</span><br><span class="line"></span><br><span class="line">        $&#123;srctree&#125;/scripts/mkbootimg \</span><br><span class="line">                $&#123;KERNEL_IMAGE_ARG&#125; \</span><br><span class="line">                $&#123;RAMDISK_ARG&#125; \</span><br><span class="line">                --second resource.img \</span><br><span class="line">                -o boot.img &amp;&amp; \</span><br><span class="line">        echo &quot;  Image:  boot.img (with Image $&#123;RAMDISK_IMG&#125; resource.img) is ready&quot;;</span><br><span class="line">        echo                 $&#123;KERNEL_IMAGE_ARG&#125; \</span><br><span class="line">                $&#123;RAMDISK_ARG&#125; \</span><br><span class="line">                --second resource.img \</span><br><span class="line">                -o boot.img &amp;&amp; \</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        $&#123;srctree&#125;/scripts/mkbootimg \</span><br><span class="line">                $&#123;KERNEL_ZIMAGE_ARG&#125; \</span><br><span class="line">                $&#123;RAMDISK_ARG&#125; \</span><br><span class="line">                --second resource.img \</span><br><span class="line">                -o zboot.img &amp;&amp; \</span><br><span class="line">        echo &quot;  Image:  zboot.img (with $&#123;ZIMAGE&#125; $&#123;RAMDISK_IMG&#125; resource.img) is ready&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>resource.imgçš„ç”±æ¥</p>
<p>LOGO&#x3D;logo.bmp</p>
<p>LOGO_KERNEL&#x3D;logo_kernel.bmp</p>
<p>DTB_PATH&#x3D;${objtree}&#x2F;arch&#x2F;arm&#x2F;boot&#x2F;dts&#x2F;rk3588-evb7-lp4-v10-linux.dtb</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">scripts/resource_tool $&#123;DTB_PATH&#125; $&#123;LOGO&#125; $&#123;LOGO_KERNEL&#125;</span><br><span class="line">scripts/resource_tool arch/arm64/boot/dts/rockchip/rk3588-evb7-lp4-v10-linux.dtb logo.bmp logo_kernel.bmp</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤è§£åŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">scripts/resource_tool --verbose --unpack --image=resource.img</span><br></pre></td></tr></table></figure>



<p>è€Œæ˜¯å®é™…çš„æ‰“åŒ…å…¶å®æ˜¯repack-bootimgè¿™ä¸ªè„šæœ¬</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;srctree&#125;/scripts/mkbootimg \</span></span><br><span class="line"><span class="language-bash">        <span class="variable">$&#123;KERNEL_IMAGE_ARG&#125;</span> \</span></span><br><span class="line"><span class="language-bash">        <span class="variable">$&#123;RAMDISK_ARG&#125;</span> \</span></span><br><span class="line"><span class="language-bash">        --second resource.img \</span></span><br><span class="line"><span class="language-bash">        -o boot.img &amp;&amp; \</span></span><br></pre></td></tr></table></figure>

<p>æ‰“åŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">scripts/mkbootimg --kernel ./arch/arm64/boot/Image --second resource.img -o boot.img</span><br></pre></td></tr></table></figure>



<p>å†ä¸€ç»•å‘ç°æ˜¯mkbootimgè¿™ä¸ªè„šæœ¬ï¼Œï¼Œï¼ŒçœŸçš„6</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">srctree/scripts/mkbootimg \</span></span><br><span class="line"><span class="language-bash">--kernel <span class="variable">$kernel</span> \</span></span><br><span class="line"><span class="language-bash"><span class="variable">$SECOND</span> \</span></span><br><span class="line"><span class="language-bash">--ramdisk <span class="variable">$ramdisk</span> \</span></span><br><span class="line"><span class="language-bash"><span class="variable">$DTB</span> \</span></span><br><span class="line"><span class="language-bash"><span class="variable">$RECOVERY_DTBO</span> \</span></span><br><span class="line"><span class="language-bash">--cmdline <span class="string">&quot;<span class="variable">$&#123;cmdline&#125;</span><span class="variable">$&#123;extra_cmdline&#125;</span>&quot;</span> \</span></span><br><span class="line"><span class="language-bash">--header_version <span class="variable">$version</span> \</span></span><br><span class="line"><span class="language-bash">--os_version <span class="variable">$os_version</span> \</span></span><br><span class="line"><span class="language-bash">--os_patch_level <span class="variable">$os_patch_level</span> \</span></span><br><span class="line"><span class="language-bash">--output <span class="variable">$output</span></span></span><br><span class="line">                      </span><br></pre></td></tr></table></figure>

<p>ä¸€äº›ç›¸å…³å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkbootimgå‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œå®ƒç”¨äºåˆ›å»ºAndroidå¼•å¯¼é•œåƒã€‚</span><br><span class="line"></span><br><span class="line">å‘½ä»¤çš„ç”¨æ³•å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">shell</span><br><span class="line">Copy</span><br><span class="line">mkbootimg [-h] [--kernel KERNEL] [--ramdisk RAMDISK] [--second SECOND]</span><br><span class="line">          [--dtb DTB] [--recovery_dtbo RECOVERY_DTBO | --recovery_acpio RECOVERY_ACPIO]</span><br><span class="line">          [--cmdline CMDLINE] [--vendor_cmdline VENDOR_CMDLINE]</span><br><span class="line">          [--base BASE] [--kernel_offset KERNEL_OFFSET]</span><br><span class="line">          [--ramdisk_offset RAMDISK_OFFSET]</span><br><span class="line">          [--second_offset SECOND_OFFSET] [--dtb_offset DTB_OFFSET]</span><br><span class="line">          [--os_version OS_VERSION] [--os_patch_level OS_PATCH_LEVEL]</span><br><span class="line">          [--tags_offset TAGS_OFFSET] [--board BOARD]</span><br><span class="line">          [--pagesize &#123;2048,4096,8192,16384&#125;] [--id]</span><br><span class="line">          [--header_version HEADER_VERSION] [-o OUTPUT]</span><br><span class="line">          [--vendor_boot VENDOR_BOOT] [--vendor_ramdisk VENDOR_RAMDISK]</span><br><span class="line">ä»¥ä¸‹æ˜¯å‚æ•°çš„è¯´æ˜ï¼š</span><br><span class="line"></span><br><span class="line">-h, --helpï¼šæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡ºã€‚</span><br><span class="line">--kernel KERNELï¼šæŒ‡å®šå†…æ ¸æ–‡ä»¶çš„è·¯å¾„ã€‚</span><br><span class="line">--ramdisk RAMDISKï¼šæŒ‡å®šramdiskæ–‡ä»¶çš„è·¯å¾„ã€‚</span><br><span class="line">--second SECONDï¼šæŒ‡å®šç¬¬äºŒçº§å¼•å¯¼åŠ è½½ç¨‹åºæ–‡ä»¶çš„è·¯å¾„ã€‚</span><br><span class="line">--dtb DTBï¼šæŒ‡å®šè®¾å¤‡æ ‘äºŒè¿›åˆ¶æ–‡ä»¶çš„è·¯å¾„ã€‚</span><br><span class="line">--recovery_dtbo RECOVERY_DTBOï¼šæŒ‡å®šæ¢å¤DTBOæ–‡ä»¶çš„è·¯å¾„ã€‚</span><br><span class="line">--recovery_acpio RECOVERY_ACPIOï¼šæŒ‡å®šæ¢å¤ACPIOæ–‡ä»¶çš„è·¯å¾„ã€‚</span><br><span class="line">--cmdline CMDLINEï¼šæŒ‡å®šä¼ é€’ç»™å†…æ ¸å‘½ä»¤è¡Œçš„é¢å¤–å‚æ•°ã€‚</span><br><span class="line">--vendor_cmdline VENDOR_CMDLINEï¼šåŒ…å«åœ¨ä¾›åº”å•†å¼•å¯¼ä¸­çš„å†…æ ¸å‘½ä»¤è¡Œå‚æ•°ã€‚</span><br><span class="line">--base BASEï¼šæŒ‡å®šåŸºåœ°å€ã€‚</span><br><span class="line">--kernel_offset KERNEL_OFFSETï¼šæŒ‡å®šå†…æ ¸åç§»é‡ã€‚</span><br><span class="line">--ramdisk_offset RAMDISK_OFFSETï¼šæŒ‡å®šramdiskåç§»é‡ã€‚</span><br><span class="line">--second_offset SECOND_OFFSETï¼šæŒ‡å®šç¬¬äºŒçº§å¼•å¯¼åŠ è½½ç¨‹åºåç§»é‡ã€‚</span><br><span class="line">--dtb_offset DTB_OFFSETï¼šæŒ‡å®šè®¾å¤‡æ ‘åç§»é‡ã€‚</span><br><span class="line">--os_version OS_VERSIONï¼šæ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€‚</span><br><span class="line">--os_patch_level OS_PATCH_LEVELï¼šæ“ä½œç³»ç»Ÿè¡¥ä¸çº§åˆ«ã€‚</span><br><span class="line">--tags_offset TAGS_OFFSETï¼šæ ‡ç­¾åç§»é‡ã€‚</span><br><span class="line">--board BOARDï¼šæ¿çº§åç§°ã€‚</span><br><span class="line">--pagesize &#123;2048,4096,8192,16384&#125;ï¼šé¡µé¢å¤§å°ã€‚</span><br><span class="line">--idï¼šåœ¨æ ‡å‡†è¾“å‡ºä¸­æ‰“å°å›¾åƒIDã€‚</span><br><span class="line">--header_version HEADER_VERSIONï¼šå¼•å¯¼é•œåƒå¤´ç‰ˆæœ¬ã€‚</span><br><span class="line">-o OUTPUT, --output OUTPUTï¼šè¾“å‡ºæ–‡ä»¶åã€‚</span><br><span class="line">--vendor_boot VENDOR_BOOTï¼šä¾›åº”å•†å¼•å¯¼è¾“å‡ºæ–‡ä»¶åã€‚</span><br><span class="line">--vendor_ramdisk VENDOR_RAMDISKï¼šæŒ‡å®šä¾›åº”å•†ramdiskæ–‡ä»¶çš„è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ç‘èŠ¯å¾®</category>
      </categories>
  </entry>
  <entry>
    <title>U-Bootç¼–è¯‘è¿‡ç¨‹æµ…æ</title>
    <url>/2023/09/10/15%20U-Boot%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B%E6%B5%85%E6%9E%90/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ä¸€ã€U-Bootæºä»£ç è·å–"><a href="#ä¸€ã€U-Bootæºä»£ç è·å–" class="headerlink" title="ä¸€ã€U-Bootæºä»£ç è·å–"></a>ä¸€ã€U-Bootæºä»£ç è·å–</h2><p>å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰è¾“å‡ºçš„è¿™ç¯‡æ–‡ç« ï¼š</p>
<blockquote>
<p>[<a href="https://blog.csdn.net/Neutionwei/article/details/123462959">RK356x] [Firefly-Linux] 10minå¸¦ä½ è·å–ã€äº†è§£ä¸ç¼–è¯‘U-Bootæºä»£ç </a></p>
</blockquote>
<p>åˆ‡æ¢æˆ<code>linux_release_v1.2.3a</code>ç‰ˆæœ¬ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git remote update</span><br><span class="line">git checkout -b rk356x/linux_release_v1.2.3a rk356x/linux_release_v1.2.3a</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€ç¼–è¯‘RK3568"><a href="#äºŒã€ç¼–è¯‘RK3568" class="headerlink" title="äºŒã€ç¼–è¯‘RK3568"></a>äºŒã€ç¼–è¯‘RK3568</h2><p>RK356x é…ç½®æ–‡ä»¶æŸ¥çœ‹ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159362.png" alt="img">æ¸…é™¤å†å²ç¼–è¯‘çŠ¶æ€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">make clean</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>make.sh</code> é…ç½® <code>configs/rk3568_defconfig</code> å¹¶ç¼–è¯‘ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./make.sh rk3568</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€ç¼–è¯‘æ—¥å¿—åˆ†æ"><a href="#ä¸‰ã€ç¼–è¯‘æ—¥å¿—åˆ†æ" class="headerlink" title="ä¸‰ã€ç¼–è¯‘æ—¥å¿—åˆ†æ"></a>ä¸‰ã€ç¼–è¯‘æ—¥å¿—åˆ†æ</h2><p>å¸¸ç”¨ç¼–è¯‘å˜é‡è¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td><code>HOSTCC</code></td>
<td>PC æœº gcc ç¼–è¯‘å‘½ä»¤</td>
</tr>
<tr>
<td><code>HOSTCXX</code></td>
<td>PC æœº g++ ç¼–è¯‘å‘½ä»¤</td>
</tr>
<tr>
<td><code>HOSTLD</code></td>
<td>PC æœº ld é“¾æ¥å‘½ä»¤</td>
</tr>
<tr>
<td><code>CC</code></td>
<td>äº¤å‰å·¥å…·é“¾ gcc ç¼–è¯‘å‘½ä»¤</td>
</tr>
<tr>
<td><code>CPP</code></td>
<td>äº¤å‰å·¥å…·é“¾ gcc -E ç¼–è¯‘å‘½ä»¤</td>
</tr>
<tr>
<td><code>LD</code></td>
<td>äº¤å‰å·¥å…·é“¾ ld é“¾æ¥å‘½ä»¤</td>
</tr>
<tr>
<td><code>OBJCOPY</code></td>
<td>äº¤å‰å·¥å…·é“¾ objcopy å‘½ä»¤</td>
</tr>
<tr>
<td><code>OBJDUMP</code></td>
<td>äº¤å‰å·¥å…·é“¾ objdump é“¾æ¥å‘½ä»¤</td>
</tr>
<tr>
<td><code>DTC</code></td>
<td>è®¾å¤‡æ ‘ç¼–è¯‘å‘½ä»¤ dtc</td>
</tr>
<tr>
<td><code>CHECK</code></td>
<td>æ‰§è¡Œé™æ€æ£€æŸ¥ sparse</td>
</tr>
</tbody></table>
<p>æ‘˜è‡ªé¡¶å±‚<code>Makefile</code>ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159859.png" alt="img"><br>æ³¨æ„ï¼šä¸Šå›¾ä¸­çš„<code>cc</code>ä¸<code>gcc</code>æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159833.png" alt="img"></p>
<p>ç¼–è¯‘æ—¥å¿—ä¸»è¦åˆ†æˆä»¥ä¸‹å‡ éƒ¨åˆ†ï¼š</p>
<ol>
<li>é…ç½®æ–‡ä»¶ç”Ÿæˆ</li>
<li>å·¥å…·ç›®å½•ç¼–è¯‘</li>
<li>U-Bootæ ¸å¿ƒä»£ç äº¤å‰ç¼–è¯‘</li>
<li>U-Bootç›®æ ‡æ–‡ä»¶ç”Ÿæˆ</li>
<li>è®¾å¤‡æ ‘ç¼–è¯‘å¹¶è¿½åŠ åˆ°U-Bootç›®æ ‡æ–‡ä»¶</li>
<li>TPLä¸SPLä»£ç ç¼–è¯‘</li>
<li>TPLä¸SPLç›®æ ‡æ–‡ä»¶ç”Ÿæˆ</li>
<li>æœ€ç»ˆå›ºä»¶æ‰“åŒ…</li>
</ol>
<h3 id="3-1-é…ç½®æ–‡ä»¶ç”Ÿæˆ"><a href="#3-1-é…ç½®æ–‡ä»¶ç”Ÿæˆ" class="headerlink" title="3.1 é…ç½®æ–‡ä»¶ç”Ÿæˆ"></a>3.1 é…ç½®æ–‡ä»¶ç”Ÿæˆ</h3><p>æ‰§è¡Œ<code>make rk3568_defconfig -j8</code>å‘½ä»¤ï¼Œç”Ÿæˆ<code>.config</code>ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159751.png" alt="img"><br>æ‰§è¡Œ<code>scripts/kconfig/conf --silentoldconfig Kconfig</code>ï¼Œè¿™ä¸ªè¯ä¸»è¦æ˜¯æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„é…ç½®é¡¹ï¼Œè¿™é‡Œæ˜¯æ¸…é™¤å†å²è¾“å‡ºæ–‡ä»¶åè¿›è¡Œç¼–è¯‘ï¼Œå› æ­¤æ‰€æœ‰é…ç½®é¡¹éƒ½è®¤ä¸ºæ˜¯æ–°çš„ï¼</p>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹æ ¹æ®<code>config.h</code>æ–‡ä»¶é…ç½®<code>u-boot.cfg</code>ã€<code>spl/u-boot.cfg</code>ã€<code>	/u-boot.cfg</code>ç­‰æ–‡ä»¶ï¼Œç„¶åäº§ç”Ÿäº†å„è‡ªçš„<code>autoconf.mk</code>æ–‡ä»¶ã€‚ç¼–è¯‘<code>sam-offsets.s</code>äº§ç”Ÿ<code>u-boot.lds</code>é“¾æ¥è„šæœ¬ã€‚</p>
<p>å¦å¤–<code>include/generated/version_autogenerated.h</code>æ˜¯æè¿°ç‰ˆæœ¬ä¿¡æ¯çš„å¤´æ–‡ä»¶ã€‚<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159822.png" alt="img"></p>
<h3 id="3-2-å·¥å…·ç›®å½•ç¼–è¯‘"><a href="#3-2-å·¥å…·ç›®å½•ç¼–è¯‘" class="headerlink" title="3.2 å·¥å…·ç›®å½•ç¼–è¯‘"></a>3.2 å·¥å…·ç›®å½•ç¼–è¯‘</h3><p>å¯¹<code>tools</code>ä¸‹çš„å·¥å…·è¿›è¡Œä¸€ç³»åˆ—ç¼–è¯‘ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159815.png" alt="img"></p>
<h3 id="3-3-U-Bootæ ¸å¿ƒä»£ç äº¤å‰ç¼–è¯‘"><a href="#3-3-U-Bootæ ¸å¿ƒä»£ç äº¤å‰ç¼–è¯‘" class="headerlink" title="3.3 U-Bootæ ¸å¿ƒä»£ç äº¤å‰ç¼–è¯‘"></a>3.3 U-Bootæ ¸å¿ƒä»£ç äº¤å‰ç¼–è¯‘</h3><p>ç¼–è¯‘å®Œæˆ<code>tools</code>ç›®å½•åï¼Œå¼€å§‹äº¤å‰ç¼–è¯‘æ ¸å¿ƒä»£ç ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æœ‰éå¸¸å¤š<code>build-in.o</code>ï¼Œè¿™ä¸ªè¾“å‡ºæ–‡ä»¶å¾ˆæœ‰æ„æ€ï¼Œå®ƒæ˜¯è¯¥æ–‡ä»¶æ‰€å¤„ç›®å½•æ‰€æœ‰<code>*.o</code>æ–‡ä»¶çš„é›†åˆä½“ï¼Œä¾‹å¦‚<code>arch/arm/cpu/built-in.o</code>ï¼Œé‚£å®ƒå°±æ˜¯<code>arch/arm/cpu/</code>ç›®å½•æ‰€æœ‰<code>*.o</code>æ–‡ä»¶çš„é›†åˆä½“ï¼</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159840.png" alt="img"><br>æ ¸å¿ƒä»£ç çš„ç¼–è¯‘è¿‡ç¨‹ä¸»è¦æ¶‰åŠ<code>arch</code>æ¶æ„ä»£ç ç›®å½•ã€<code>common</code>é€šç”¨ç›®å½•ã€<code>cmd</code>å‘½ä»¤ç›®å½•ä¸<code>driver</code>é©±åŠ¨ç›®å½•ï¼Œå½“ç„¶è¿˜æœ‰<code>lib</code>å…¬å…±åº“ç›®å½•ä¸<code>examles</code>ä¾‹ç¨‹ç›®å½•ï¼Œæ³¨æ„è¿™ä¸ªç¼–è¯‘è¿‡ç¨‹ä¸æ˜¯æŒ‰ç…§é¡ºåºç¼–è¯‘æ‰“å°çš„ï¼Œè¿™ä¸ªå› ä¸ºå‰é¢ä½¿ç”¨<code>-j8</code>ç¼–è¯‘é€‰é¡¹ï¼Œè¿™ä¸ªé€‰é¡¹çš„æ„æ€æ˜¯æ‰“å¼€8ä¸ªçº¿ç¨‹å¹¶å‘ç¼–è¯‘ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159970.png" alt="img"><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159113.png" alt="img"><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159108.png" alt="img"></p>
<h3 id="3-4-U-Bootç›®æ ‡æ–‡ä»¶ç”Ÿæˆ"><a href="#3-4-U-Bootç›®æ ‡æ–‡ä»¶ç”Ÿæˆ" class="headerlink" title="3.4 U-Bootç›®æ ‡æ–‡ä»¶ç”Ÿæˆ"></a>3.4 U-Bootç›®æ ‡æ–‡ä»¶ç”Ÿæˆ</h3><p>æ ¸å¿ƒä»£ç äº¤å‰ç¼–è¯‘å®Œæ¯•åé“¾æ¥ä¹‹å‰æ‰€æœ‰çš„<code>built-in.o</code>æ–‡ä»¶ï¼Œé€šè¿‡<code>objcopy</code>å‘½ä»¤ç”Ÿæˆ<code>u-boot-nodtb.bin</code>æ–‡ä»¶ä¸<code>u-boot.sym</code>ç¬¦å·è¡¨ï¼Œå¹¶ä¸”ä½¿ç”¨<code>relocate-rela</code>å·¥å…·å¯¹<code>u-boot-nodtb.bin</code>é™æ€relocï¼ˆé™æ€<code>rela.dyn</code>ä¿®å¤ï¼‰ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159124.png" alt="img"></p>
<h3 id="3-5-è®¾å¤‡æ ‘ç¼–è¯‘å¹¶è¿½åŠ åˆ°U-Bootç›®æ ‡æ–‡ä»¶"><a href="#3-5-è®¾å¤‡æ ‘ç¼–è¯‘å¹¶è¿½åŠ åˆ°U-Bootç›®æ ‡æ–‡ä»¶" class="headerlink" title="3.5 è®¾å¤‡æ ‘ç¼–è¯‘å¹¶è¿½åŠ åˆ°U-Bootç›®æ ‡æ–‡ä»¶"></a>3.5 è®¾å¤‡æ ‘ç¼–è¯‘å¹¶è¿½åŠ åˆ°U-Bootç›®æ ‡æ–‡ä»¶</h3><p>æ¥ä¸‹æ¥æ˜¯ç¼–è¯‘è®¾å¤‡æ ‘<code>dts</code>ï¼Œå¹¶ä¸”äº§ç”Ÿ<code>dt.dtb</code>ï¼ˆu-bootè®¾å¤‡æ ‘<code>dtb</code>æ–‡ä»¶ï¼‰ã€<code>dt-spl.dtb</code>ï¼ˆsplè®¾å¤‡æ ‘<code>dtb</code>æ–‡ä»¶ï¼‰ã€<code>dt-tpl.dtb</code>ï¼ˆtplè®¾å¤‡æ ‘<code>dtb</code>æ–‡ä»¶ï¼‰ï¼Œå¹¶ä¸”æŠŠ<code>dtb</code>æ–‡ä»¶è¿½åŠ åˆ°u-bootæ–‡ä»¶ç”Ÿæˆ<code>u-boot.bin</code>æ–‡ä»¶ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159130.png" alt="img"></p>
<h3 id="3-6-TPLä¸SPLä»£ç ç¼–è¯‘"><a href="#3-6-TPLä¸SPLä»£ç ç¼–è¯‘" class="headerlink" title="3.6 TPLä¸SPLä»£ç ç¼–è¯‘"></a>3.6 TPLä¸SPLä»£ç ç¼–è¯‘</h3><p><code>spl</code>æ˜¯åˆå§‹åŒ–DDRå†…å­˜ä½¿ç”¨çš„ï¼Œè€Œ<code>spl</code>ç›¸å½“äºä¸€ä¸ªç²¾ç®€ç‰ˆu-bootï¼Œï¼Œåªä¸è¿‡å®ƒçš„ç›®çš„æ˜¯åŠ è½½u-bootå›ºä»¶ï¼Œå®ƒä»¬ç¼–è¯‘å¥—è·¯ä¸U-Bootæ ¸å¿ƒä»£ç ç±»ä¼¼ï¼Œæ³¨æ„çš„æ˜¯å®ƒä¼šæŠŠç¼–è¯‘ç”Ÿæˆçš„<code>*.o</code>æ¬åˆ°<code>tpl</code>ã€<code>spl</code>ç›®å½•ï¼Œ<code>tpl</code>ã€<code>spl</code>ç›®å½•æ ‘çš„æ’å¸ƒä¸U-Bootç›®å½•æ ‘ä¸€æ ·ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159177.png" alt="img"></p>
<h3 id="3-7-TPLä¸SPLç›®æ ‡æ–‡ä»¶ç”Ÿæˆ"><a href="#3-7-TPLä¸SPLç›®æ ‡æ–‡ä»¶ç”Ÿæˆ" class="headerlink" title="3.7 TPLä¸SPLç›®æ ‡æ–‡ä»¶ç”Ÿæˆ"></a>3.7 TPLä¸SPLç›®æ ‡æ–‡ä»¶ç”Ÿæˆ</h3><p><code>u-boot-spl.lds</code>æ˜¯<code>spl</code>çš„é“¾æ¥è„šæœ¬ï¼Œ<code>u-boot-spl.dtb</code>æ˜¯<code>spl</code>çš„è®¾å¤‡æ ‘<code>dtb</code>æ–‡ä»¶ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159221.png" alt="img"><br><code>u-boot-spl-nodtb.bin</code>æ˜¯<code>spl</code>ç›®æ ‡æ–‡ä»¶ï¼ŒåŒæ ·åœ°æŠŠè®¾å¤‡æ ‘<code>dtb</code>æ–‡ä»¶è¿½åŠ è¿›å»å¹¶äº§ç”Ÿ<code>u-boot-spl.bin</code>æ–‡ä»¶ï¼š<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159361.png" alt="img"><br><code>u-boot-tpl-nodtb.bin</code>æ˜¯<code>tpl</code>ç›®æ ‡æ–‡ä»¶ï¼Œæ³¨æ„è¿™é‡Œç›´æ¥å¤åˆ¶æˆ<code>u-boot-tpl.bin</code>ï¼ˆæ²¡æœ‰è¿½åŠ è®¾å¤‡æ ‘<code>dtb</code>æ–‡ä»¶ï¼‰ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159367.png" alt="img"></p>
<p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>u-boot-tpl.bin</code>æ˜¯ä¸èƒ½çƒ§å½•è¿›RK356xçš„ï¼Œè¿™æ˜¯å› ä¸º<code>tpl</code>ç›¸å…³ä»£ç ï¼ŒRKå®˜æ–¹å¹¶æ²¡æœ‰å¼€æºï¼æˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>rkbin</code>çš„<code>ddr.bin</code>æ–‡ä»¶æ›¿æ¢ï¼</p>
<h3 id="3-8-æœ€ç»ˆå›ºä»¶æ‰“åŒ…"><a href="#3-8-æœ€ç»ˆå›ºä»¶æ‰“åŒ…" class="headerlink" title="3.8 æœ€ç»ˆå›ºä»¶æ‰“åŒ…"></a>3.8 æœ€ç»ˆå›ºä»¶æ‰“åŒ…</h3><p>é¦–å…ˆé€šè¿‡<code>rkbin/RKTRUST/RK3568TRUST.ini</code>æ–‡ä»¶æè¿°çš„å†…å®¹æŠŠ<code>u-boot.bin</code>æ‰“åŒ…æˆ<code>u-boot.itb</code>ï¼Œç´§æ¥ç€æ ¹æ® FIT æè¿°æ–‡ä»¶çš„å†…å®¹æŠŠ ATFã€OP-TEEã€U-Bootã€MCU æ‰“åŒ…åˆ°ä¸€èµ·ï¼ˆå½“ç„¶ä¹ŸåŒ…æ‹¬è®¾å¤‡æ ‘ DTBï¼‰ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159407.png" alt="img"><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159412.png" alt="img"><br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159495.png" alt="img"><br>æœ€åç”Ÿæˆçš„å›ºä»¶ä¸º<code>uboot.img</code>ï¼Œå¹¶ä¸”æ ¹æ®<code>rkbin/RKBOOT/RK3568MINIALL.ini</code>æ–‡ä»¶ç”Ÿæˆ<code>rk356x_spl_loader_v1.12.112.bin</code>ï¼ˆæ³¨æ„è¿™é‡Œå¹¶æ²¡æœ‰æ‰“åŒ…æˆ‘ä»¬ç¼–è¯‘äº§ç”Ÿçš„<code>u-boot-spl.bin</code>æ–‡ä»¶ï¼Œè€Œæ˜¯æ‰“åŒ…å­˜æ”¾äº<code>rkbin</code>ç›®å½•ä¸‹çš„<code>spl.bin</code>æ–‡ä»¶ï¼‰</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122159479.png" alt="img"></p>
]]></content>
      <categories>
        <category>ç‘èŠ¯å¾®</category>
      </categories>
  </entry>
  <entry>
    <title>bootloaderå¼•å¯¼æµç¨‹</title>
    <url>/2023/09/10/13%20bootloader%E5%BC%95%E5%AF%BC%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä¸€ã€RKèŠ¯ç‰‡é€šç”¨å¼•å¯¼æµç¨‹"><a href="#ä¸€ã€RKèŠ¯ç‰‡é€šç”¨å¼•å¯¼æµç¨‹" class="headerlink" title="ä¸€ã€RKèŠ¯ç‰‡é€šç”¨å¼•å¯¼æµç¨‹"></a>ä¸€ã€RKèŠ¯ç‰‡é€šç”¨å¼•å¯¼æµç¨‹</h1><p>å¯¹äºRKèŠ¯ç‰‡çš„å¼•å¯¼æµç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒä»¥ä¸‹è¿™å¼ å›¾ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122126953.jpeg" alt="img"></p>
<p>æ ¹æ®ä¸¤ç§<code>Boot Flow</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ¢³ç†ä¸¤ç§ä¸åŒçš„å¼•å¯¼æµç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Boot Code -&gt; idbloader.img(miniloader) -&gt; uboot.img -&gt; boot.img -&gt; rootfs.img</span><br><span class="line">Boot Code -&gt; idbloader.img(TPL/SPL) -&gt; uboot.itb -&gt; boot.img -&gt; rootfs.img</span><br></pre></td></tr></table></figure>

<p>å¯¹äº<code>idbloader.img</code>ï¼Œæˆ‘ä»¬ä¼šå‘ç°æœ‰ç›¸ä¼¼çš„åœ°æ–¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ddr.bin &lt;-&gt; u-boot-tpl.bin</span><br><span class="line">rkxx_miniloader_vx.xx.bin &lt;-&gt; u-boot-spl.bin</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶æˆ‘ä»¬ä¼šé—®ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤å¥—å¼•å¯¼æµç¨‹ï¼Ÿ</p>
<p>äº‹å®ä¸Š<code>idbloader.img(miniloader)</code>è¿™å¥—å¼•å¯¼æ–¹æ¡ˆæ˜¯RKå®šåˆ¶çš„ï¼Œå®ƒä»¬å¹¶æ²¡æœ‰å¼€æºçš„ï¼ŒRKå‘å¸ƒçš„æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®ƒä»¬éƒ½å­˜æ”¾äº<code>rkbin</code>ç›®å½•ä¸‹ï¼Œä¾‹å¦‚<code>RK356x</code>ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122137381.png" alt="image-20230912213741344"></p>
<p>æ³¨æ„ä¸Šå›¾ä¸­çº¢æ–¹æ¡†å¤„ï¼šrk3588_spl_v1.11.bin<code>å®é™…ä¸ŠæŒ‡çš„æ˜¯</code>rkxx_miniloader_vx.xx.bin&#96;ï¼</p>
<h1 id="äºŒã€RK356xå¼•å¯¼æµç¨‹"><a href="#äºŒã€RK356xå¼•å¯¼æµç¨‹" class="headerlink" title="äºŒã€RK356xå¼•å¯¼æµç¨‹"></a>äºŒã€RK356xå¼•å¯¼æµç¨‹</h1><p>ä¸‹é¢é€šè¿‡<code>RK356x</code>çš„å¯åŠ¨æ—¥å¿—è¿›è¡Œç®€è¦åˆ†æï¼</p>
<h2 id="2-1-ddr-binè¿è¡Œ"><a href="#2-1-ddr-binè¿è¡Œ" class="headerlink" title="2.1 ddr.binè¿è¡Œ"></a>2.1 ddr.binè¿è¡Œ</h2><p><code>RK3588</code>ä¸Šç”µåï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ç¬¬ä¸€é˜¶æ®µæ—¥å¿—æ˜¯å…³äºDDRçš„ï¼Œè¿™ä¸»è¦æ˜¯å¯¹DDRè¿›è¡Œåˆå§‹åŒ–ï¼Œæˆ‘ä»¬çœ‹åˆ°ä½¿ç”¨çš„æ˜¯<code>LPDDR4</code>ï¼Œé¢‘ç‡é€æ­¥ä»<code>528MHz </code>åˆ‡æ¢åˆ°<code>2112MHz</code>ï¼Œå¹¶ä¸”è¿›è¡Œä¸€äº›è¯»å†™è®­ç»ƒæ“ä½œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">DDR Version V1.08 20220617</span><br><span class="line">LPDDR4X, 2112MHz</span><br><span class="line">channel[0] BW=16 Col=10 Bk=8 CS0 Row=16 CS=1 Die BW=16 Size=1024MB</span><br><span class="line">channel[1] BW=16 Col=10 Bk=8 CS0 Row=16 CS=1 Die BW=16 Size=1024MB</span><br><span class="line">channel[2] BW=16 Col=10 Bk=8 CS0 Row=16 CS=1 Die BW=16 Size=1024MB</span><br><span class="line">channel[3] BW=16 Col=10 Bk=8 CS0 Row=16 CS=1 Die BW=16 Size=1024MB</span><br><span class="line">Manufacturer ID:0x1 Samsung</span><br><span class="line">CH0 RX Vref:33.7%, TX Vref:21.8%,0.0%</span><br><span class="line">CH1 RX Vref:32.7%, TX Vref:18.8%,0.0%</span><br><span class="line">CH2 RX Vref:30.7%, TX Vref:17.8%,0.0%</span><br><span class="line">CH3 RX Vref:34.7%, TX Vref:18.8%,0.0%</span><br><span class="line">change to F1: 528MHz</span><br><span class="line">change to F2: 1068MHz</span><br><span class="line">change to F3: 1560MHz</span><br><span class="line">change to F0: 2112MHz</span><br><span class="line">out</span><br></pre></td></tr></table></figure>

<h2 id="2-2-spl-binè¿è¡Œ"><a href="#2-2-spl-binè¿è¡Œ" class="headerlink" title="2.2 spl.binè¿è¡Œ"></a>2.2 spl.binè¿è¡Œ</h2><p>â€‹	æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šçœ‹åˆ°SPLçš„æ¿çº§åˆå§‹åŒ–ï¼Œç´§æ¥ç€é€æ­¥ä»<code>MMC2</code>ï¼ˆ<code>SD</code>å¡ï¼‰ã€<code>MMC1</code>ï¼ˆ<code>eMMC</code>ï¼‰å¯»æ‰¾<code>U-boot.img</code>ï¼ˆåŒ…æ‹¬<code>atf-1</code>ã€<code>uboot</code>ã€<code>fdt</code>ã€<code>atf-2</code>ã€<code>atf-3</code>ã€<code>atf-4</code>ã€<code>atf-5</code>ã€<code>optee</code>ï¼‰ï¼Œé€šè¿‡<code>atf-1</code>æ¥è¿è¡Œ<code>uboot</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">U-Boot SPL board init</span><br><span class="line">U-Boot SPL 2017.09-orangepi (Apr 21 2023 - 10:35:39)</span><br><span class="line">Trying to boot from MMC1</span><br><span class="line">Trying fit image at 0x4000 sector</span><br><span class="line">## Verified-boot: 0</span><br><span class="line">## Checking atf-1 0x00040000 ... sha256(806278dba1...) + OK</span><br><span class="line">## Checking uboot 0x00200000 ... sha256(a14cd96f5d...) + OK</span><br><span class="line">## Checking fdt 0x00349350 ... sha256(cf0060a3cf...) + OK</span><br><span class="line">## Checking atf-2 0x000f0000 ... sha256(c00c7fd75b...) + OK</span><br><span class="line">## Checking atf-3 0xff100000 ... sha256(71c3a5841b...) + OK</span><br><span class="line">## Checking atf-4 0xff001000 ... sha256(2301cf73be...) + OK</span><br><span class="line">Jumping to U-Boot(0x00200000) via ARM Trusted Firmware(0x00040000)</span><br><span class="line">Total: 209.584 ms</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„<code>atf-*</code>ä¸<code>optee</code>è¿™äº›æ˜¯ <code>ARM trust</code> å›ºä»¶ï¼Œå±äºå¦å¤–ä¸€ä¸ªé¢†åŸŸï¼Œæœ‰å…´è¶£å¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡ç« ï¼š</p>
<blockquote>
<p><a href="https://blog.csdn.net/Neutionwei/article/details/111395775">https://blog.csdn.net/Neutionwei/article/details/111395775</a><br><a href="https://blog.csdn.net/Neutionwei/article/det">https://blog.csdn.net/Neutionwei/article/det</a></p>
</blockquote>
<h2 id="2-3-atfè¿è¡Œ"><a href="#2-3-atfè¿è¡Œ" class="headerlink" title="2.3 atfè¿è¡Œ"></a>2.3 atfè¿è¡Œ</h2><p>è¿è¡Œ<code>BL31</code>ï¼Œåˆå§‹åŒ–ä¸è¿è¡Œ<code>BL32</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">INFO:    Preloader serial: 2</span><br><span class="line">NOTICE:  BL31: v2.3():v2.3-405-gb52c2eadd:derrick.huang</span><br><span class="line">NOTICE:  BL31: Built : 11:23:47, Aug 15 2022</span><br><span class="line">INFO:    spec: 0x13</span><br><span class="line">INFO:    ext 32k is valid</span><br><span class="line">INFO:    GICv3 without legacy support detected.</span><br><span class="line">INFO:    ARM GICv3 driver initialized in EL3</span><br><span class="line">INFO:    system boots from cpu-hwid-0</span><br><span class="line">INFO:    idle_st=0x21fff, pd_st=0x11fff9, repair_st=0xfff70001</span><br><span class="line">INFO:    dfs DDR fsp_params[0].freq_mhz= 2112MHz</span><br><span class="line">INFO:    dfs DDR fsp_params[1].freq_mhz= 528MHz</span><br><span class="line">INFO:    dfs DDR fsp_params[2].freq_mhz= 1068MHz</span><br><span class="line">INFO:    dfs DDR fsp_params[3].freq_mhz= 1560MHz</span><br><span class="line">INFO:    BL31: Initialising Exception Handling Framework</span><br><span class="line">INFO:    BL31: Initializing runtime services</span><br><span class="line">WARNING: No OPTEE provided by BL2 boot loader, Booting device without OPTEE initialization. SMC`s destined for OPTEE will return SMC_UNK</span><br><span class="line">ERROR:   Error initializing runtime service opteed_fast</span><br><span class="line">INFO:    BL31: Preparing for EL3 exit to normal world</span><br><span class="line">INFO:    Entry point address = 0x200000</span><br><span class="line">INFO:    SPSR = 0x3c9</span><br></pre></td></tr></table></figure>

<blockquote>
</blockquote>
<h2 id="2-4-ubootè¿è¡Œ"><a href="#2-4-ubootè¿è¡Œ" class="headerlink" title="2.4 ubootè¿è¡Œ"></a>2.4 ubootè¿è¡Œ</h2><h3 id="2-4-1-è®¾å¤‡ç¯å¢ƒåˆå§‹åŒ–"><a href="#2-4-1-è®¾å¤‡ç¯å¢ƒåˆå§‹åŒ–" class="headerlink" title="2.4.1 è®¾å¤‡ç¯å¢ƒåˆå§‹åŒ–"></a>2.4.1 è®¾å¤‡ç¯å¢ƒåˆå§‹åŒ–</h3><p>ä»<code>atf</code>åˆ‡æ¢åˆ°<code>uboot</code>ä¹‹åï¼Œ<code>uboot</code>ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>æ‰“å°ä¸€äº›å¿…è¦çš„ä¿¡æ¯ï¼šæ¿å‹ã€ä¸²å£ã€å†…å­˜ã€ç³»ç»Ÿå†…å­˜åˆå§‹åŒ–ã€ä»£ç é‡å®šä½æƒ…å†µï¼›</li>
<li>è·å–<code>MMC</code>å­˜å‚¨å™¨ä¿¡æ¯ï¼Œæ‰“å°å½“å‰å¯åŠ¨çš„å­˜å‚¨å™¨ï¼ˆ<code>atags</code>ï¼‰ï¼›</li>
<li>è·å–å­˜å‚¨å™¨åˆ†åŒºæƒ…å†µå¹¶åŠ è½½å†…æ ¸è®¾å¤‡æ ‘ï¼›</li>
<li>åˆå§‹åŒ–<code>I2C0</code>ã€åˆå§‹åŒ–<code>PMIC</code>ç”µæºèŠ¯ç‰‡ã€ç›¸å…³èŠ¯ç‰‡ä¾›ç”µç”µå‹ä¸<code>IO</code>ç”µæºåŸŸï¼›</li>
<li>åˆå§‹åŒ–<code>DRM</code>æ¡†æ¶ä»¥åŠæ˜¾ç¤ºå™¨æ¥å£ï¼ˆ<code>HDMI</code>ï¼‰;</li>
<li>åˆå§‹åŒ–æ—¶é’Ÿæ ‘ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">U-Boot 2017.09-orangepi (Apr 21 2023 - 10:35:39 +0800)</span><br><span class="line"></span><br><span class="line">Model: Orange Pi 5B</span><br><span class="line">PreSerial: 2, raw, 0xfeb50000</span><br><span class="line">DRAM:  3.7 GiB</span><br><span class="line">Sysmem: init</span><br><span class="line">Relocation Offset: eda2d000</span><br><span class="line">Relocation fdt: eb9f9008 - eb9fecb8</span><br><span class="line">CR: M/C/I</span><br><span class="line">Using default environment</span><br><span class="line"></span><br><span class="line">mmc@fe2c0000: 0, mmc@fe2e0000: 1</span><br><span class="line">Bootdev(atags): mmc 0</span><br><span class="line">MMC0: Legacy, 52Mhz</span><br><span class="line">PartType: EFI</span><br><span class="line">DM: v2</span><br><span class="line">boot mode: None</span><br><span class="line">Model: Orange Pi 5B</span><br><span class="line">CLK: (sync kernel. arm: enter 1008000 KHz, init 1008000 KHz, kernel 0N/A)</span><br><span class="line">  b0pll 24000 KHz</span><br><span class="line">  b1pll 24000 KHz</span><br><span class="line">  lpll 24000 KHz</span><br><span class="line">  v0pll 24000 KHz</span><br><span class="line">  aupll 24000 KHz</span><br><span class="line">  cpll 1500000 KHz</span><br><span class="line">  gpll 1188000 KHz</span><br><span class="line">  npll 24000 KHz</span><br><span class="line">  ppll 1100000 KHz</span><br><span class="line">  aclk_center_root 702000 KHz</span><br><span class="line">  pclk_center_root 100000 KHz</span><br><span class="line">  hclk_center_root 396000 KHz</span><br><span class="line">  aclk_center_low_root 500000 KHz</span><br><span class="line">  aclk_top_root 750000 KHz</span><br><span class="line">  pclk_top_root 100000 KHz</span><br><span class="line">  aclk_low_top_root 396000 KHz</span><br><span class="line">Net:   No ethernet found.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-4-2-å†…æ ¸çš„åŠ è½½"><a href="#2-4-2-å†…æ ¸çš„åŠ è½½" class="headerlink" title="2.4.2 å†…æ ¸çš„åŠ è½½"></a>2.4.2 å†…æ ¸çš„åŠ è½½</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">switch to partitions #0, OK</span><br><span class="line">mmc0 is current device</span><br><span class="line">mmc@fe2c0000: 0 (SD)</span><br><span class="line">mmc@fe2e0000: 1</span><br><span class="line">switch to partitions #0, OK</span><br><span class="line">mmc0 is current device</span><br><span class="line">Scanning mmc 0:1...</span><br><span class="line">Found U-Boot script /boot.scr</span><br><span class="line">reading /boot.scr</span><br><span class="line">3411 bytes read in 4 ms (832 KiB/s)</span><br><span class="line">## Executing script at 00500000</span><br><span class="line">Boot script loaded from mmc 0</span><br><span class="line">reading /orangepiEnv.txt</span><br><span class="line">222 bytes read in 3 ms (72.3 KiB/s)</span><br><span class="line">reading /uInitrd</span><br><span class="line">18641659 bytes read in 1844 ms (9.6 MiB/s)</span><br><span class="line">reading /Image</span><br><span class="line">34736640 bytes read in 3049 ms (10.9 MiB/s)</span><br><span class="line">reading /dtb/rockchip/rk3588s-orangepi-5b.dtb</span><br><span class="line">233728 bytes read in 24 ms (9.3 MiB/s)</span><br><span class="line">reading /dtb/rockchip/overlay/rk3588-fixup.scr</span><br><span class="line">2756 bytes read in 6 ms (448.2 KiB/s)</span><br><span class="line">Applying kernel provided DT fixup script (rk3588-fixup.scr)</span><br><span class="line">## Executing script at 09000000</span><br><span class="line">Fdt Ramdisk skip relocation</span><br><span class="line">## Loading init Ramdisk from Legacy Image at 0a200000 ...</span><br><span class="line">   Image Name:   uInitrd</span><br><span class="line">   Image Type:   AArch64 Linux RAMDisk Image (gzip compressed)</span><br><span class="line">   Data Size:    18641595 Bytes = 17.8 MiB</span><br><span class="line">   Load Address: 00000000</span><br><span class="line">   Entry Point:  00000000</span><br><span class="line">   Verifying Checksum ... OK</span><br><span class="line">## Flattened Device Tree blob at 0x0a100000</span><br><span class="line">   Booting using the fdt blob at 0x0a100000</span><br><span class="line">   reserving fdt memory region: addr=a100000 size=9f000</span><br><span class="line">  &#x27;reserved-memory&#x27; ramoops@110000: addr=110000 size=f0000</span><br><span class="line">   Using Device Tree in place at 000000000a100000, end 000000000a1a1fff</span><br><span class="line">Adding bank: 0x00200000 - 0xf0000000 (size: 0xefe00000)</span><br><span class="line">Total: 5283.754 ms</span><br><span class="line"></span><br><span class="line">Starting kernel ...</span><br></pre></td></tr></table></figure>

<p>ä»<code>Starting kernel ...</code>å¼€å§‹ï¼Œ<code>uboot</code>çš„ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œä¹‹åäº§ç”Ÿçš„æ‰“å°æ˜¯ç”±å†…æ ¸äº§ç”Ÿçš„ï¼</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒåŠ è½½<code>Flat Device Tree</code>è®¾å¤‡æ ‘ä¹‹åï¼Œæ—¥å¿—è¿˜æ‰“å°äº†ç›¸å…³æ˜ åƒåŠ è½½æƒ…å†µï¼Œè¿™éƒ¨åˆ†éå¸¸æœ‰ç”¨ï¼Œæˆ‘ä»¬ä»¥åå†æ·±å…¥åˆ†æï¼</p>
<h1 id="ä¸‰ã€BootRomé˜¶æ®µåšäº†ä»€ä¹ˆï¼Ÿ"><a href="#ä¸‰ã€BootRomé˜¶æ®µåšäº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸‰ã€BootRomé˜¶æ®µåšäº†ä»€ä¹ˆï¼Ÿ"></a>ä¸‰ã€BootRomé˜¶æ®µåšäº†ä»€ä¹ˆï¼Ÿ</h1><p><code>BootRom</code>å›ºä»¶æ˜¯RockchipåŸå‚èŠ¯ç‰‡å‡ºå‚æ—¶çƒ§å½•åˆ°å†…éƒ¨å­˜å‚¨å™¨çš„ï¼Œç›®çš„æ˜¯ä»å„ä¸ªå¤–éƒ¨å­˜å‚¨åª’ä»‹ä¸­åŠ è½½<code>miniloader</code>(<code>tpl</code> + <code>spl</code>)ï¼</p>
<p>ä»¥ä¸‹æ˜¯æ‘˜è‡ªã€ŠRockchip RK3568 TRM Part1 V1.1-20210301ã€‹ï¼Œå®ƒå¾ˆæ¸…æ™°åœ°è¯´æ˜äº†BootRomé˜¶æ®µåšäº†ä»€ä¹ˆäº‹æƒ…ï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122155809.png" alt="img"></p>
<p>æˆ‘ä»¬æŒ‰ç…§æ­£å¸¸å¼•å¯¼èµ°ä¸€éï¼š</p>
<ol>
<li>ä»<code>0x0000FFFF</code>åœ°å€è¯»å–ç¬¬ä¸€æ¡æŒ‡ä»¤è¿è¡Œï¼›</li>
<li>é€ä¸€æ£€æŸ¥ä¸æ ¡éªŒ<code>Nor Flash</code>ã€<code>Nand Flash</code>ã€<code>eMMC</code>ã€<code>SD/MMC</code>ä¸­çš„<code>ID BLOCK</code>ï¼ˆRK å›ºä»¶å®šä¹‰åœ¨ç¬¬ <code>64</code> æ‰‡åŒºï¼‰ï¼›</li>
<li>å‡å¦‚æˆ‘ä»¬çš„å›ºä»¶å­˜æ”¾äº<code>eMMC</code>ï¼Œé‚£ä¹ˆæ ¡éªŒ<code>ID BLOCK</code>æˆåŠŸåå°±è¯»å–<code>DDR</code>åˆå§‹åŒ–ä»£ç åˆ°<code>SYSTEM_SRAM</code>ï¼›</li>
<li>ç´§æ¥ç€è¿è¡Œåˆšåˆšè¯»å–çš„ä»£ç æ¥åˆå§‹åŒ–<code>DDR</code>ï¼›</li>
<li>åˆå§‹åŒ–<code>DDR</code>å<code>DDR</code>å°±å¯ä»¥å·¥ä½œäº†ï¼ŒæŠŠå¼•å¯¼ä»£ç åŠ è½½åˆ°<code>DDR</code>å¹¶è°ƒåˆ°<code>DDR</code>ç»§ç»­è¿è¡Œã€‚</li>
</ol>
<p>å¦‚æœå„ä¸ªå­˜å‚¨å™¨éƒ½æ²¡æœ‰æ‰¾åˆ°<code>ID BLOCK</code>ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>ç­‰å¾…è¯·æ±‚<code>DDR</code>ç¨‹åºï¼ˆå³åœ¨<code>RKDevTool</code>å·¥å…·å¯ä»¥çœ‹åˆ°å¤„äº<code>Maskrom</code>æ¨¡å¼ï¼‰ï¼š</li>
</ol>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122156818.png" alt="img"></p>
<h1 id="å››ã€RKå›ºä»¶åœ¨å­˜å‚¨å™¨ä¸­æ˜¯å¦‚ä½•åˆ†å¸ƒçš„ï¼Ÿ"><a href="#å››ã€RKå›ºä»¶åœ¨å­˜å‚¨å™¨ä¸­æ˜¯å¦‚ä½•åˆ†å¸ƒçš„ï¼Ÿ" class="headerlink" title="å››ã€RKå›ºä»¶åœ¨å­˜å‚¨å™¨ä¸­æ˜¯å¦‚ä½•åˆ†å¸ƒçš„ï¼Ÿ"></a>å››ã€RKå›ºä»¶åœ¨å­˜å‚¨å™¨ä¸­æ˜¯å¦‚ä½•åˆ†å¸ƒçš„ï¼Ÿ</h1><p>å¦‚ä¸‹å›¾ï¼Œå…¶ä¸­ RK356xå’Œrk3588 æ˜¯æ²¡æœ‰ä½¿ç”¨ <code>trust</code>åˆ†åŒºï¼Œè¿™ä¸ªè¦æ³¨æ„ï¼š	</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309122156681.png" alt="img"></p>
<p>å¦å¤–è¦æ³¨æ„çš„æ˜¯ä»<code>loader2</code>åˆ†åŒºå¼€å§‹æ‰€æœ‰çš„åˆ†åŒºå¤§å°ä¸èµ·å§‹åœ°å€æ˜¯ç”±<code>parameter.txt</code>æ–‡ä»¶è¿›è¡Œæè¿°ï¼Œå…·ä½“å‚è€ƒï¼š</p>
<blockquote>
<p><a href="https://blog.csdn.net/Neutionwei/article/details/122911086">https://blog.csdn.net/Neutionwei/article/details/122911086</a></p>
</blockquote>
]]></content>
      <categories>
        <category>ç‘èŠ¯å¾®</category>
      </categories>
  </entry>
  <entry>
    <title>ç‘èŠ¯å¾®build-shè„šæœ¬åˆ†æ</title>
    <url>/2023/09/10/12%20%E7%91%9E%E8%8A%AF%E5%BE%AEbuild-sh%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>build.shè„šæœ¬å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®ç¯å¢ƒå˜é‡ LC_ALLï¼Œç”¨äºå®šä¹‰ç¨‹åºçš„æœ¬åœ°åŒ–è®¾ç½®</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°† LC_ALL è®¾ç½®ä¸º Cï¼Œè¡¨ç¤ºä½¿ç”¨æ ‡å‡†çš„Cè¯­è¨€ç¯å¢ƒï¼Œå¿½ç•¥æœ¬åœ°åŒ–è®¾ç½®</span></span><br><span class="line">export LC_ALL=C</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®ç¯å¢ƒå˜é‡ LD_LIBRARY_PATHï¼Œç”¨äºæŒ‡å®šåŠ¨æ€é“¾æ¥åº“çš„æœç´¢è·¯å¾„</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°† LD_LIBRARY_PATH è®¾ç½®ä¸ºç©ºï¼Œè¡¨ç¤ºæ¸…ç©ºåŠ¨æ€é“¾æ¥åº“æœç´¢è·¯å¾„</span></span><br><span class="line">export LD_LIBRARY_PATH=</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é”™è¯¯å¤„ç†å‡½æ•°</span></span><br><span class="line">err_handler()</span><br><span class="line">&#123;</span><br><span class="line">	ret=$?</span><br><span class="line">	[ &quot;$ret&quot; -eq 0 ] &amp;&amp; return</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ‰“å°é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">	echo &quot;ERROR: Running $&#123;FUNCNAME[1]&#125; failed!&quot;</span><br><span class="line">	echo &quot;ERROR: exit code $ret from line $&#123;BASH_LINENO[0]&#125;:&quot;</span><br><span class="line">	echo &quot;    $BASH_COMMAND&quot;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">é€€å‡ºè„šæœ¬</span></span><br><span class="line">	exit $ret</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®é”™è¯¯å¤„ç†å‡½æ•°ä¸º <span class="built_in">trap</span> çš„å¤„ç†ç¨‹åºï¼Œå½“å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨ err_handler() å‡½æ•°</span></span><br><span class="line">trap &#x27;err_handler&#x27; ERR</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½® shell çš„é”™è¯¯å¤„ç†è¡Œä¸º</span></span><br><span class="line">set -eE</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®Œæˆæ„å»ºæ“ä½œ</span></span><br><span class="line">finish_build()</span><br><span class="line">&#123;</span><br><span class="line">	echo &quot;Running $&#123;FUNCNAME[1]&#125; succeeded.&quot;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">åˆ‡æ¢åˆ°é¡¶çº§ç›®å½•</span></span><br><span class="line">	cd $TOP_DIR</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥é…ç½®å‡½æ•°</span></span><br><span class="line">check_config()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ¸…é™¤å˜é‡ missing</span></span><br><span class="line">	unset missing</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">éå†ä¼ å…¥çš„å‚æ•°åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">	for var in $@; do</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">ä½¿ç”¨ <span class="built_in">eval</span> æ£€æŸ¥å˜é‡æ˜¯å¦å­˜åœ¨å€¼ï¼Œå¦‚æœå­˜åœ¨åˆ™è·³è¿‡</span></span><br><span class="line">		eval [ \$$var ] &amp;&amp; continue</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">å°†ç¼ºå¤±çš„é…ç½®å˜é‡è®°å½•åˆ° missing å˜é‡ä¸­</span></span><br><span class="line">		missing=&quot;$missing $var&quot;</span><br><span class="line">	done</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å¦‚æœæ‰€æœ‰é…ç½®å˜é‡å‡å­˜åœ¨å€¼ï¼Œåˆ™è¿”å›0è¡¨ç¤ºæ£€æŸ¥é€šè¿‡</span></span><br><span class="line">	[ -z &quot;$missing&quot; ] &amp;&amp; return 0</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å¦‚æœå­˜åœ¨ç¼ºå¤±çš„é…ç½®å˜é‡ï¼Œåˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›1</span></span><br><span class="line">	echo &quot;Skipping $&#123;FUNCNAME[1]&#125; for missing configs: $missing.&quot;</span><br><span class="line">	return 1</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é€‰æ‹©æ¿å¡å‡½æ•°</span></span><br><span class="line">choose_board()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è·å–æ¿å¡é…ç½®æ–‡ä»¶åˆ—è¡¨åˆ° BOARD_ARRAY æ•°ç»„</span></span><br><span class="line">	BOARD_ARRAY=( $(cd $&#123;CHIP_DIR&#125;/; ls BoardConfig*.mk | sort) )</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è·å–æ¿å¡æ•°ç»„çš„é•¿åº¦</span>	</span><br><span class="line">	RK_TARGET_BOARD_ARRAY_LEN=$&#123;#BOARD_ARRAY[@]&#125;</span><br><span class="line"><span class="meta prompt_">	</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å¦‚æœæ¿å¡æ•°ç»„é•¿åº¦ä¸º0ï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰å¯ç”¨çš„æ¿å¡é…ç½®æ–‡ä»¶ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›-1</span></span><br><span class="line">	if [ $RK_TARGET_BOARD_ARRAY_LEN -eq 0 ]; then</span><br><span class="line">		echo &quot;No available Board Config&quot;</span><br><span class="line">		return -1</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo</span><br><span class="line">	echo &quot;You&#x27;re building on Linux&quot;</span><br><span class="line">	echo &quot;Lunch menu...pick a combo:&quot;</span><br><span class="line">	echo &quot;&quot;</span><br><span class="line"><span class="meta prompt_">	</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è¾“å‡ºå¯ç”¨çš„æ¿å¡é…ç½®æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line">	echo &quot;0. default BoardConfig.mk&quot;</span><br><span class="line">	echo $&#123;BOARD_ARRAY[@]&#125; | xargs -n 1 | sed &quot;=&quot; | sed &quot;N;s/\n/. /&quot;</span><br><span class="line"></span><br><span class="line">	local INDEX</span><br><span class="line">	read -p &quot;Which would you like? [0]: &quot; INDEX</span><br><span class="line">	INDEX=$(($&#123;INDEX:-0&#125; - 1))</span><br><span class="line"><span class="meta prompt_">	</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ ¹æ®ç”¨æˆ·é€‰æ‹©çš„ç´¢å¼•ç¡®å®šæ‰€é€‰çš„æ¿å¡é…ç½®æ–‡ä»¶</span></span><br><span class="line">	if echo $INDEX | grep -vq [^0-9]; then</span><br><span class="line">		BOARD=&quot;$&#123;BOARD_ARRAY[$INDEX]&#125;&quot;</span><br><span class="line">	else</span><br><span class="line">		echo &quot;Lunching for Default BoardConfig.mk boards...&quot;</span><br><span class="line">		BOARD=BoardConfig.mk</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">åˆ›å»ºç¬¦å·é“¾æ¥ï¼Œå°†æ‰€é€‰çš„æ¿å¡é…ç½®æ–‡ä»¶é“¾æ¥åˆ° BOARD_CONFIG å˜é‡æŒ‡å®šçš„è·¯å¾„</span></span><br><span class="line">	ln -rsf &quot;$CHIP_DIR/$BOARD&quot; &quot;$BOARD_CONFIG&quot;</span><br><span class="line">	echo &quot;switching to board: $(realpath $BOARD_CONFIG)&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å½“å‰è„šæœ¬æ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œå¹¶èµ‹å€¼ç»™ COMMON_DIR å˜é‡</span></span><br><span class="line">COMMON_DIR=&quot;$(dirname &quot;$(realpath &quot;$0&quot;)&quot;)&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ¹æ® COMMON_DIR è®¡ç®—å‡ºé¡¶çº§ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œå¹¶èµ‹å€¼ç»™ TOP_DIR å˜é‡</span></span><br><span class="line">TOP_DIR=&quot;$(realpath &quot;$COMMON_DIR/../../..&quot;)&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ‡æ¢åˆ°é¡¶çº§ç›®å½•</span></span><br><span class="line">cd &quot;$TOP_DIR&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»º rockdev ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰</span></span><br><span class="line">mkdir -p rockdev</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½® BOARD_CONFIG å˜é‡ä¸ºé¡¶çº§ç›®å½•ä¸‹çš„ device/rockchip/.BoardConfig.mk æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line">BOARD_CONFIG=&quot;$TOP_DIR/device/rockchip/.BoardConfig.mk&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å– CHIP_DIR å˜é‡çš„ç»å¯¹è·¯å¾„ï¼Œè¯¥å˜é‡æŒ‡å‘é¡¶çº§ç›®å½•ä¸‹çš„ device/rockchip/.target_product ç›®å½•</span></span><br><span class="line">CHIP_DIR=&quot;$(realpath $TOP_DIR/device/rockchip/.target_product)&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é¢„æ„å»º U-Boot å‡½æ•°</span></span><br><span class="line">prebuild_uboot()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ„å»º U-Boot çš„ç¼–è¯‘å‘½ä»¤å­—ç¬¦ä¸²</span></span><br><span class="line">	UBOOT_COMPILE_COMMANDS=&quot;\</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash">&#123;RK_TRUST_INI_CONFIG:+../rkbin/RKTRUST/<span class="variable">$RK_TRUST_INI_CONFIG</span>&#125; \</span></span><br><span class="line"><span class="language-bash">			<span class="variable">$&#123;RK_SPL_INI_CONFIG:+../rkbin/RKBOOT/$RK_SPL_INI_CONFIG&#125;</span> \</span></span><br><span class="line"><span class="language-bash">			<span class="variable">$&#123;RK_UBOOT_SIZE_CONFIG:+--sz-uboot $RK_UBOOT_SIZE_CONFIG&#125;</span> \</span></span><br><span class="line"><span class="language-bash">			<span class="variable">$&#123;RK_TRUST_SIZE_CONFIG:+--sz-trust $RK_TRUST_SIZE_CONFIG&#125;</span><span class="string">&quot;</span></span></span><br><span class="line">	UBOOT_COMPILE_COMMANDS=&quot;$(echo $UBOOT_COMPILE_COMMANDS)&quot;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">å¦‚æœå¯ç”¨ RAMDISK å®‰å…¨å¯åŠ¨ï¼Œåˆ™æ·»åŠ ç›¸å…³çš„ç¼–è¯‘å‘½ä»¤é€‰é¡¹</span></span></span><br><span class="line">	if [ &quot;$RK_RAMDISK_SECURITY_BOOTUP&quot; = &quot;true&quot; ];then</span><br><span class="line">		UBOOT_COMPILE_COMMANDS=&quot; \</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash"><span class="string">UBOOT_COMPILE_COMMANDS \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			<span class="variable">$&#123;RK_ROLLBACK_INDEX_BOOT:+--rollback-index-boot $RK_ROLLBACK_INDEX_BOOT&#125;</span> \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			<span class="variable">$&#123;RK_ROLLBACK_INDEX_UBOOT:+--rollback-index-uboot $RK_ROLLBACK_INDEX_UBOOT&#125;</span> &quot;</span></span></span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é¢„æ„å»ºå®‰å…¨å¯åŠ¨çš„ U-Boot å‡½æ•°</span></span><br><span class="line">prebuild_security_uboot()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è·å–ä¼ å…¥çš„æ¨¡å¼å‚æ•°</span></span><br><span class="line">	local mode=$1</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å¦‚æœå¯ç”¨ RAMDISK å®‰å…¨å¯åŠ¨ï¼Œåˆ™æ·»åŠ ç›¸å…³çš„ç¼–è¯‘å‘½ä»¤é€‰é¡¹</span></span><br><span class="line">	if [ &quot;$RK_RAMDISK_SECURITY_BOOTUP&quot; = &quot;true&quot; ];then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">å¦‚æœ RK_SECURITY_OTP_DEBUG ä¸ç­‰äº <span class="string">&quot;true&quot;</span>ï¼Œåˆ™æ·»åŠ  --burn-key-hash é€‰é¡¹</span></span><br><span class="line">		if [ &quot;$RK_SECURITY_OTP_DEBUG&quot; != &quot;true&quot; ]; then</span><br><span class="line">			UBOOT_COMPILE_COMMANDS=&quot;$UBOOT_COMPILE_COMMANDS --burn-key-hash&quot;</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">æ ¹æ®ä¼ å…¥çš„æ¨¡å¼å‚æ•°è¿›è¡Œä¸åŒçš„å¤„ç†</span></span><br><span class="line">		case &quot;$&#123;mode:-normal&#125;&quot; in</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">å¯¹äº uboot æ¨¡å¼ï¼Œä¸éœ€è¦é¢å¤–çš„å¤„ç†</span></span><br><span class="line">			uboot)</span><br><span class="line">				;;</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">å¯¹äº boot æ¨¡å¼ï¼Œæ·»åŠ  --boot_img é€‰é¡¹ï¼Œå¹¶è®¾ç½®å€¼ä¸º <span class="variable">$TOP_DIR</span>/u-boot/boot.img</span></span><br><span class="line">			boot)</span><br><span class="line">				UBOOT_COMPILE_COMMANDS=&quot; \</span><br><span class="line">					--boot_img $TOP_DIR/u-boot/boot.img \</span><br><span class="line">					$UBOOT_COMPILE_COMMANDS &quot;</span><br><span class="line">				;;</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">å¯¹äº recovery æ¨¡å¼ï¼Œæ·»åŠ  --recovery_img é€‰é¡¹ï¼Œå¹¶è®¾ç½®å€¼ä¸º <span class="variable">$TOP_DIR</span>/u-boot/recovery.img</span></span><br><span class="line">			recovery)</span><br><span class="line">				UBOOT_COMPILE_COMMANDS=&quot; \</span><br><span class="line">					--recovery_img $TOP_DIR/u-boot/recovery.img</span><br><span class="line">					$UBOOT_COMPILE_COMMANDS &quot;</span><br><span class="line">				;;</span><br><span class="line">			*)</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">å¯¹äºå…¶ä»–æ¨¡å¼ï¼Œé»˜è®¤æ·»åŠ  --boot_img é€‰é¡¹ï¼Œå¹¶è®¾ç½®å€¼ä¸º <span class="variable">$TOP_DIR</span>/u-boot/boot.img</span></span><br><span class="line">				UBOOT_COMPILE_COMMANDS=&quot; \</span><br><span class="line">					--boot_img $TOP_DIR/u-boot/boot.img \</span><br><span class="line">					$UBOOT_COMPILE_COMMANDS &quot;</span><br><span class="line">				# å¦‚æœ RK_PACKAGE_FILE_AB ä¸ºç©ºï¼Œåˆ™æ·»åŠ  --recovery_img é€‰é¡¹ï¼Œå¹¶è®¾ç½®å€¼ä¸º $TOP_DIR/u-boot/recovery.img</span><br><span class="line">				test -z &quot;$&#123;RK_PACKAGE_FILE_AB&#125;&quot; &amp;&amp; \</span><br><span class="line">					UBOOT_COMPILE_COMMANDS=&quot;$UBOOT_COMPILE_COMMANDS --recovery_img $TOP_DIR/u-boot/recovery.img&quot;</span><br><span class="line">				;;</span><br><span class="line">		esac</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">ä½¿ç”¨ <span class="built_in">echo</span> å‘½ä»¤é‡æ–°èµ‹å€¼ UBOOT_COMPILE_COMMANDS å˜é‡ï¼Œå»é™¤å¤šä½™ç©ºæ ¼</span></span><br><span class="line">		UBOOT_COMPILE_COMMANDS=&quot;$(echo $UBOOT_COMPILE_COMMANDS)&quot;</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç”¨æ³•å‡½æ•°ï¼Œæ‰“å°è„šæœ¬çš„ä½¿ç”¨è¯´æ˜</span></span><br><span class="line">usage()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ‰“å°ä½¿ç”¨è¯´æ˜</span></span><br><span class="line">	echo &quot;Usage: build.sh [OPTIONS]&quot;</span><br><span class="line">	echo &quot;Available options:&quot;</span><br><span class="line">	echo &quot;BoardConfig*.mk    -switch to specified board config&quot;</span><br><span class="line">	echo &quot;lunch              -list current SDK boards and switch to specified board config&quot;</span><br><span class="line">	echo &quot;wifibt             -build wifibt&quot;</span><br><span class="line">	echo &quot;uboot              -build uboot&quot;</span><br><span class="line">	echo &quot;uefi		 -build uefi&quot;</span><br><span class="line">	echo &quot;spl                -build spl&quot;</span><br><span class="line">	echo &quot;loader             -build loader&quot;</span><br><span class="line">	echo &quot;kernel-4.4         -build kernel 4.4&quot;</span><br><span class="line">	echo &quot;kernel-4.19        -build kernel 4.19&quot;</span><br><span class="line">	echo &quot;kernel-5.10        -build kernel 5.10&quot;</span><br><span class="line">	echo &quot;kernel             -build kernel&quot;</span><br><span class="line">	echo &quot;modules            -build kernel modules&quot;</span><br><span class="line">	echo &quot;rootfs             -build rootfs (default is buildroot)&quot;</span><br><span class="line">	echo &quot;buildroot          -build buildroot rootfs&quot;</span><br><span class="line">	echo &quot;yocto              -build yocto rootfs&quot;</span><br><span class="line">	echo &quot;debian             -build debian rootfs&quot;</span><br><span class="line">	echo &quot;pcba               -build pcba&quot;</span><br><span class="line">	echo &quot;recovery           -build recovery&quot;</span><br><span class="line">	echo &quot;all                -build uboot, kernel, rootfs, recovery image&quot;</span><br><span class="line">	echo &quot;cleanall           -clean uboot, kernel, rootfs, recovery&quot;</span><br><span class="line">	echo &quot;firmware           -pack all the image we need to boot up system&quot;</span><br><span class="line">	echo &quot;updateimg          -pack update image&quot;</span><br><span class="line">	echo &quot;otapackage         -pack ab update otapackage image (update_ota.img)&quot;</span><br><span class="line">	echo &quot;sdpackage          -pack update sdcard package image (update_sdcard.img)&quot;</span><br><span class="line">	echo &quot;save               -save images, patches, commands used to debug&quot;</span><br><span class="line">	echo &quot;allsave            -build all &amp; firmware &amp; updateimg &amp; save&quot;</span><br><span class="line">	echo &quot;info               -see the current board building information&quot;</span><br><span class="line">	echo &quot;&quot;</span><br><span class="line">	echo &quot;createkeys         -create secureboot root keys&quot;</span><br><span class="line">	echo &quot;security_rootfs    -build rootfs and some relevant images with security paramter (just for dm-v)&quot;</span><br><span class="line">	echo &quot;security_boot      -build boot with security paramter&quot;</span><br><span class="line">	echo &quot;security_uboot     -build uboot with security paramter&quot;</span><br><span class="line">	echo &quot;security_recovery  -build recovery with security paramter&quot;</span><br><span class="line">	echo &quot;security_check     -check security paramter if it&#x27;s good&quot;</span><br><span class="line">	echo &quot;&quot;</span><br><span class="line">	echo &quot;Default option is &#x27;allsave&#x27;.&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„å»ºä¿¡æ¯å‡½æ•°ï¼Œæ‰“å°å½“å‰æ„å»ºçš„ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">build_info()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å¦‚æœ CHIP_DIR è·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™æ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œè¡¨ç¤ºæœªæ‰¾åˆ°ç›®æ ‡èŠ¯ç‰‡</span></span><br><span class="line">	if [ ! -L $CHIP_DIR ];then</span><br><span class="line">		echo &quot;No found target chip!!!&quot;</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å¦‚æœ BOARD_CONFIG è·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™æ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œè¡¨ç¤ºæœªæ‰¾åˆ°ç›®æ ‡æ¿çº§é…ç½®</span></span><br><span class="line">	if [ ! -L $BOARD_CONFIG ];then</span><br><span class="line">		echo &quot;No found target board config!!!&quot;</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å¦‚æœå­˜åœ¨ .repo/manifest.xml æ–‡ä»¶ï¼Œåˆ™è·å– SDK ç‰ˆæœ¬å·ï¼Œå¹¶æ‰“å°æ„å»ºçš„ SDK ç‰ˆæœ¬</span></span><br><span class="line">	if [ -f .repo/manifest.xml ]; then</span><br><span class="line">		local sdk_ver=&quot;&quot;</span><br><span class="line">		sdk_ver=`grep &quot;include name&quot;  .repo/manifest.xml | awk -F\&quot; &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">		sdk_ver=`realpath .repo/manifests/$&#123;sdk_ver&#125;`</span><br><span class="line">		echo &quot;Build SDK version: `basename $&#123;sdk_ver&#125;`&quot;</span><br><span class="line">	else</span><br><span class="line">		echo &quot;Not found .repo/manifest.xml [ignore] !!!&quot;</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ‰“å°å½“å‰æ„å»ºçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç›®æ ‡èŠ¯ç‰‡ã€ç›®æ ‡æ¿çº§é…ç½®å’Œä¸€äº›ç›®æ ‡çš„å…¶ä»–é…ç½®å‚æ•°</span></span><br><span class="line">	echo &quot;Current Building Information:&quot;</span><br><span class="line">	echo &quot;Target Chip: $CHIP_DIR&quot;</span><br><span class="line">	echo &quot;Target BoardConfig: `realpath $BOARD_CONFIG`&quot;</span><br><span class="line">	echo &quot;Target Misc config:&quot;</span><br><span class="line">	echo &quot;`env |grep &quot;^RK_&quot; | grep -v &quot;=$&quot; | sort`&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ ¹æ® RK_KERNEL_ARCH å˜é‡çš„å€¼ç¡®å®šè®¾å¤‡æ ‘ï¼ˆdtbï¼‰çš„è·¯å¾„ï¼Œå¹¶åˆ é™¤å·²å­˜åœ¨çš„ dtb æ–‡ä»¶</span></span><br><span class="line">	if [ &quot;$RK_KERNEL_ARCH&quot; == &quot;arm&quot; ]; then</span><br><span class="line">		dtb=&quot;kernel/arch/arm/boot/dts/$&#123;RK_KERNEL_DTS&#125;.dtb&quot;</span><br><span class="line">	else</span><br><span class="line">		dtb=&quot;kernel/arch/arm64/boot/dts/rockchip/$&#123;RK_KERNEL_DTS&#125;.dtb&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	rm -f $dtb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">ä½¿ç”¨ <span class="variable">$KMAKE</span> dtbs å‘½ä»¤ç”Ÿæˆè®¾å¤‡æ ‘ï¼ˆdtbï¼‰æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">KMAKE dtbs</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è°ƒç”¨ build_check_power_domain å‡½æ•°æ£€æŸ¥ç”µæºåŸŸ</span></span><br><span class="line">	build_check_power_domain</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„å»ºæ£€æŸ¥ç”µæºåŸŸå‡½æ•°ï¼Œç”¨äºæ£€æŸ¥ç”µæºåŸŸé…ç½®æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">build_check_power_domain()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®šä¹‰ä¸´æ—¶æ–‡ä»¶å’Œå˜é‡</span></span><br><span class="line">	local dump_kernel_dtb_file</span><br><span class="line">	local tmp_phandle_file</span><br><span class="line">	local tmp_io_domain_file</span><br><span class="line">	local tmp_regulator_microvolt_file</span><br><span class="line">	local tmp_final_target</span><br><span class="line">	local tmp_none_item</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ ¹æ® RK_KERNEL_ARCH å˜é‡çš„å€¼ç¡®å®šè®¾å¤‡æ ‘ï¼ˆdtsï¼‰æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">	if [ &quot;$RK_KERNEL_ARCH&quot; == &quot;arm&quot; ]; then</span><br><span class="line">		dts=&quot;kernel/arch/arm/boot/dts/$RK_KERNEL_DTS&quot;</span><br><span class="line">	else</span><br><span class="line">		dts=&quot;kernel/arch/arm64/boot/dts/rockchip/$RK_KERNEL_DTS&quot;</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®šä¹‰ä¸´æ—¶æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">	dump_kernel_dtb_file=$&#123;dts&#125;.dump.dts</span><br><span class="line">	tmp_phandle_file=`mktemp`</span><br><span class="line">	tmp_io_domain_file=`mktemp`</span><br><span class="line">	tmp_regulator_microvolt_file=`mktemp`</span><br><span class="line">	tmp_final_target=`mktemp`</span><br><span class="line">	tmp_grep_file=`mktemp`</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å°†è®¾å¤‡æ ‘äºŒè¿›åˆ¶æ–‡ä»¶è½¬æ¢ä¸ºæ–‡æœ¬æ ¼å¼ï¼Œå¹¶ä¿å­˜ä¸º dump_kernel_dtb_file</span></span><br><span class="line">	dtc -I dtb -O dts -o $&#123;dump_kernel_dtb_file&#125; $&#123;dts&#125;.dtb 2&gt;/dev/null</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å¦‚æœ RK_SYSTEM_CHECK_METHOD å˜é‡çš„å€¼ä¸º <span class="string">&quot;DM-E&quot;</span>ï¼Œåˆ™æ£€æŸ¥æ˜¯å¦åœ¨è®¾å¤‡æ ‘ä¸­æ·»åŠ äº† optee-tz çš„å…¼å®¹æ€§</span></span><br><span class="line">	if [ &quot;$RK_SYSTEM_CHECK_METHOD&quot; = &quot;DM-E&quot; ] ; then</span><br><span class="line">		if ! grep &quot;compatible = \&quot;linaro,optee-tz\&quot;;&quot; $dump_kernel_dtb_file &gt; /dev/null 2&gt;&amp;1 ; then</span><br><span class="line">			echo &quot;Please add: &quot;</span><br><span class="line">			echo &quot;        optee: optee &#123;&quot;</span><br><span class="line">			echo &quot;                compatible = \&quot;linaro,optee-tz\&quot;;&quot;</span><br><span class="line">			echo &quot;                method = \&quot;smc\&quot;;&quot;</span><br><span class="line">			echo &quot;                status = \&quot;okay\&quot;;&quot;</span><br><span class="line">			echo &quot;        &#125;&quot;</span><br><span class="line">			echo &quot;To your dts file&quot;</span><br><span class="line">			return -1;</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä»è®¾å¤‡æ ‘ä¸­æå– io-domains é…ç½®ï¼Œå¹¶ä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶ tmp_io_domain_file å’Œ tmp_grep_file</span></span><br><span class="line">	if ! grep -Pzo &quot;io-domains\s*&#123;(\n|\w|-|;|=|&lt;|&gt;|\&quot;|_|\s|,)*&#125;;&quot; $dump_kernel_dtb_file 1&gt;$tmp_grep_file 2&gt;/dev/null; then</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;Not Found io-domains in <span class="variable">$&#123;dts&#125;</span>.dts&quot;</span></span></span><br><span class="line">		rm -f $tmp_grep_file</span><br><span class="line">		return 0</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">ä»ä¸´æ—¶æ–‡ä»¶ tmp_grep_file ä¸­æå–ä¾›ç”µï¼ˆsupplyï¼‰ä¿¡æ¯ï¼Œå¹¶ä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶ tmp_io_domain_file</span></span><br><span class="line">	grep -a supply $tmp_grep_file &gt; $tmp_io_domain_file</span><br><span class="line">	rm -f $tmp_grep_file</span><br><span class="line">	awk &#x27;&#123;print &quot;phandle = &quot; $3&#125;&#x27; $tmp_io_domain_file &gt; $tmp_phandle_file</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">é€è¡Œè¯»å–ä¸´æ—¶æ–‡ä»¶ tmp_phandle_file å’Œ tmp_io_domain_fileï¼Œå¹¶è¿›è¡Œå¤„ç†</span></span><br><span class="line">	while IFS= read -r item_phandle &amp;&amp; IFS= read -u 3 -r item_domain</span><br><span class="line">	do</span><br><span class="line">		echo &quot;$&#123;item_domain% *&#125;&quot; &gt;&gt; $tmp_regulator_microvolt_file</span><br><span class="line">		tmp_none_item=$&#123;item_domain% *&#125;</span><br><span class="line">		cmds=&quot;grep -Pzo \&quot;&#123;(\\n|\w|-|;|=|&lt;|&gt;|\\\&quot;|_|\s)*&quot;$item_phandle\&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">ä½¿ç”¨ <span class="built_in">eval</span> æ‰§è¡Œå‘½ä»¤ï¼Œä»è®¾å¤‡æ ‘ä¸­æå–ç›¸åº”çš„ regulator-m..-microvolt é…ç½®ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶ tmp_regulator_microvolt_file</span></span><br><span class="line">		eval &quot;$cmds $dump_kernel_dtb_file | strings | grep &quot;regulator-m..-microvolt&quot; &gt;&gt; $tmp_regulator_microvolt_file&quot; || \</span><br><span class="line">			eval &quot;sed -i \&quot;/$&#123;tmp_none_item&#125;/d\&quot; $tmp_regulator_microvolt_file&quot; &amp;&amp; continue</span><br><span class="line"></span><br><span class="line">		echo &gt;&gt; $tmp_regulator_microvolt_file</span><br><span class="line">	done &lt; $tmp_phandle_file 3&lt;$tmp_io_domain_file</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">é€è¡Œè¯»å–ä¸´æ—¶æ–‡ä»¶ tmp_regulator_microvolt_fileï¼Œç”Ÿæˆæœ€ç»ˆçš„ç›®æ ‡æ–‡ä»¶ tmp_final_target</span></span><br><span class="line">	while read -r regulator_val</span><br><span class="line">	do</span><br><span class="line">		if echo $&#123;regulator_val&#125; | grep supply &amp;&gt;/dev/null; then</span><br><span class="line">			echo -e &quot;\n\n\e[1;33m$&#123;regulator_val%*=&#125;\e[0m&quot; &gt;&gt; $tmp_final_target</span><br><span class="line">		else</span><br><span class="line">			tmp_none_item=$&#123;regulator_val##*&lt;&#125;</span><br><span class="line">			tmp_none_item=$&#123;tmp_none_item%%&gt;*&#125;</span><br><span class="line">			echo -e &quot;$&#123;regulator_val%%&lt;*&#125; \e[1;31m$(( $tmp_none_item / 1000 ))mV\e[0m&quot; &gt;&gt; $tmp_final_target</span><br><span class="line">		fi</span><br><span class="line">	done &lt; $tmp_regulator_microvolt_file</span><br><span class="line"></span><br><span class="line">	echo -e &quot;\e[41;1;30m PLEASE CHECK BOARD GPIO POWER DOMAIN CONFIGURATION !!!!!\e[0m&quot;</span><br><span class="line">	echo -e &quot;\e[41;1;30m &lt;&lt;&lt; ESPECIALLY Wi-Fi/Flash/Ethernet IO power domain &gt;&gt;&gt; !!!!!\e[0m&quot;</span><br><span class="line">	echo -e &quot;\e[41;1;30m Check Node [pmu_io_domains] in the file: $&#123;dts&#125;.dts \e[0m&quot;</span><br><span class="line">	echo</span><br><span class="line">	echo -e &quot;\e[41;1;30m è¯·å†æ¬¡ç¡®è®¤æ¿çº§çš„ç”µæºåŸŸé…ç½®ï¼ï¼ï¼ï¼ï¼ï¼\e[0m&quot;</span><br><span class="line">	echo -e &quot;\e[41;1;30m &lt;&lt;&lt; ç‰¹åˆ«æ˜¯Wi-Fiï¼ŒFLASHï¼Œä»¥å¤ªç½‘è¿™å‡ è·¯IOç”µæºçš„é…ç½® &gt;&gt;&gt; ï¼ï¼ï¼ï¼ï¼\e[0m&quot;</span><br><span class="line">	echo -e &quot;\e[41;1;30m æ£€æŸ¥å†…æ ¸æ–‡ä»¶ $&#123;dts&#125;.dts çš„èŠ‚ç‚¹ [pmu_io_domains] \e[0m&quot;</span><br><span class="line">	cat $tmp_final_target</span><br><span class="line"></span><br><span class="line">	rm -f $tmp_phandle_file</span><br><span class="line">	rm -f $tmp_regulator_microvolt_file</span><br><span class="line">	rm -f $tmp_io_domain_file</span><br><span class="line">	rm -f $tmp_final_target</span><br><span class="line">	rm -f $dump_kernel_dtb_file</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®äº¤å‰ç¼–è¯‘å·¥å…·é“¾å’Œç›¸å…³å‚æ•°</span></span><br><span class="line">setup_cross_compile()</span><br><span class="line">&#123;</span><br><span class="line">	if [ &quot;$RK_CHIP&quot; = &quot;rv1126_rv1109&quot; ]; then</span><br><span class="line">		TOOLCHAIN_OS=rockchip</span><br><span class="line">	else</span><br><span class="line">		TOOLCHAIN_OS=none</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å°† RK_KERNEL_ARCH ä¸­çš„ arm64 æ›¿æ¢ä¸º aarch64</span></span><br><span class="line">	TOOLCHAIN_ARCH=$&#123;RK_KERNEL_ARCH/arm64/aarch64&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æŸ¥æ‰¾åŒ¹é…çš„ GCC å·¥å…·é“¾è·¯å¾„</span></span><br><span class="line">	TOOLCHAIN_DIR=&quot;$(realpath prebuilts/gcc/*/$TOOLCHAIN_ARCH/gcc-arm-*)&quot;</span><br><span class="line">	GCC=&quot;$(find &quot;$TOOLCHAIN_DIR&quot; -name &quot;*$TOOLCHAIN_OS*-gcc&quot;)&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¯æ‰§è¡Œçš„ GCC å·¥å…·é“¾</span></span><br><span class="line">	if [ ! -x &quot;$GCC&quot; ]; then</span><br><span class="line">		echo &quot;No prebuilt GCC toolchain!&quot;</span><br><span class="line">		return 1</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è®¾ç½®äº¤å‰ç¼–è¯‘å‰ç¼€</span></span><br><span class="line">	export CROSS_COMPILE=&quot;$&#123;GCC%gcc&#125;&quot;</span><br><span class="line">	echo &quot;Using prebuilt GCC toolchain: $CROSS_COMPILE&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è·å–å¯ç”¨çš„å¤„ç†å™¨æ ¸å¿ƒæ•°é‡</span></span><br><span class="line">	NUM_CPUS=$(getconf _NPROCESSORS_ONLN 2&gt;/dev/null || echo 1)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è®¾ç½®å¹¶å‘ç¼–è¯‘ä»»åŠ¡æ•°ï¼Œé»˜è®¤ä¸ºå¤„ç†å™¨æ ¸å¿ƒæ•°é‡åŠ ä¸€</span></span><br><span class="line">	JLEVEL=$&#123;RK_JOBS:-$(( $NUM_CPUS + 1 ))&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®šä¹‰å†…æ ¸ç¼–è¯‘å‘½ä»¤</span></span><br><span class="line">	KMAKE=&quot;make -C kernel/ ARCH=$RK_KERNEL_ARCH -j$JLEVEL&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„å»º UEFI</span></span><br><span class="line">build_uefi()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è®¾ç½®äº¤å‰ç¼–è¯‘å·¥å…·é“¾å’Œç›¸å…³å‚æ•°</span></span><br><span class="line">	setup_cross_compile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ ¹æ® RK_KERNEL_ARCH çš„å€¼ç¡®å®š dtb æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">	if [ &quot;$RK_KERNEL_ARCH&quot; == &quot;arm&quot; ]; then</span><br><span class="line">		dtb=&quot;kernel/arch/arm/boot/dts/$&#123;RK_KERNEL_DTS&#125;.dtb&quot;</span><br><span class="line">	else</span><br><span class="line">		dtb=&quot;kernel/arch/arm64/boot/dts/rockchip/$&#123;RK_KERNEL_DTS&#125;.dtb&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo &quot;============Start building uefi============&quot;</span><br><span class="line">	echo &quot;Copy kernel dtb $dtb to uefi/edk2-platforms/Platform/Rockchip/DeviceTree/rk3588.dtb&quot;</span><br><span class="line">	echo &quot;=========================================&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥ dtb æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">	if [ ! -f $dtb ]; then</span><br><span class="line">		echo &quot;Please compile the kernel before&quot;</span><br><span class="line">		return -1</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å°† dtb æ–‡ä»¶å¤åˆ¶åˆ° uefi ç›®å½•</span></span><br><span class="line">	cp $dtb uefi/edk2-platforms/Platform/Rockchip/DeviceTree/rk3588.dtb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è¿›å…¥ uefi ç›®å½•å¹¶æ‰§è¡Œæ„å»ºè„šæœ¬</span></span><br><span class="line">	cd uefi</span><br><span class="line">	./make.sh $RK_UBOOT_DEFCONFIG</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®Œæˆæ„å»ºæµç¨‹</span></span><br><span class="line">	finish_build</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„å»º U-Boot</span></span><br><span class="line">build_uboot()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥ RK_UBOOT_DEFCONFIG é…ç½®æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿”å›</span></span><br><span class="line">	check_config RK_UBOOT_DEFCONFIG || return 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è®¾ç½®äº¤å‰ç¼–è¯‘å·¥å…·é“¾å’Œç›¸å…³å‚æ•°</span></span><br><span class="line">	setup_cross_compile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å‡†å¤‡ U-Boot æ„å»ºæ‰€éœ€çš„æ–‡ä»¶</span></span><br><span class="line">	prebuild_uboot</span><br><span class="line">	prebuild_security_uboot $@</span><br><span class="line"></span><br><span class="line">	echo &quot;============Start building uboot============&quot;</span><br><span class="line">	echo &quot;TARGET_UBOOT_CONFIG=$RK_UBOOT_DEFCONFIG&quot;</span><br><span class="line">	echo &quot;=========================================&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è¿›å…¥ u-boot ç›®å½•å¹¶åˆ é™¤æ—§çš„ *_loader_*.bin æ–‡ä»¶</span></span><br><span class="line">	cd u-boot</span><br><span class="line">	rm -f *_loader_*.bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ„å»º U-Boot</span></span><br><span class="line">	if [ -n &quot;$RK_UBOOT_DEFCONFIG_FRAGMENT&quot; ]; then</span><br><span class="line">		if [ -f &quot;configs/$&#123;RK_UBOOT_DEFCONFIG&#125;_defconfig&quot; ]; then</span><br><span class="line">			UBOOT_CONFIGS=&quot;$&#123;RK_UBOOT_DEFCONFIG&#125;_defconfig&quot;</span><br><span class="line">		else</span><br><span class="line">			UBOOT_CONFIGS=&quot;$&#123;RK_UBOOT_DEFCONFIG&#125;.config&quot;</span><br><span class="line">		fi</span><br><span class="line">		UBOOT_CONFIGS=&quot;$UBOOT_CONFIGS $RK_UBOOT_DEFCONFIG_FRAGMENT&quot;</span><br><span class="line">	else</span><br><span class="line">		UBOOT_CONFIGS=&quot;$RK_UBOOT_DEFCONFIG&quot;</span><br><span class="line">	fi</span><br><span class="line">	./make.sh $UBOOT_CONFIGS $UBOOT_COMPILE_COMMANDS \</span><br><span class="line">		CROSS_COMPILE=$CROSS_COMPILE</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å¦‚æœéœ€è¦æ›´æ–° RK_IDBLOCK_SPLï¼Œåˆ™æ‰§è¡Œå¸¦æœ‰ --idblock å’Œ --spl å‚æ•°çš„ make.sh</span></span><br><span class="line">	if [ &quot;$RK_IDBLOCK_UPDATE_SPL&quot; = &quot;true&quot; ]; then</span><br><span class="line">		./make.sh --idblock --spl</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	cd ..</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å¦‚æœéœ€è¦è¿›è¡Œ RAMDISK å®‰å…¨å¯åŠ¨ï¼Œåˆ™åˆ›å»ºé“¾æ¥åˆ° rockdev ç›®å½•çš„ boot.img å’Œ recovery.img</span></span><br><span class="line">	if [ &quot;$RK_RAMDISK_SECURITY_BOOTUP&quot; = &quot;true&quot; ];then</span><br><span class="line">		ln -rsf u-boot/boot.img rockdev/</span><br><span class="line">		test -z &quot;$&#123;RK_PACKAGE_FILE_AB&#125;&quot; &amp;&amp; \</span><br><span class="line">			ln -rsf u-boot/recovery.img rockdev/ || true</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">åˆ›å»ºé“¾æ¥åˆ° rockdev ç›®å½•çš„ MiniLoaderAll.binã€uboot.img å’Œ trust.imgï¼ˆå¦‚æœå­˜åœ¨ï¼‰</span></span><br><span class="line">	LOADER=&quot;$(echo u-boot/*_loader_*v*.bin | head -1)&quot;</span><br><span class="line">	SPL=&quot;$(echo u-boot/*_loader_spl.bin | head -1)&quot;</span><br><span class="line">	ln -rsf &quot;$&#123;LOADER:-$SPL&#125;&quot; rockdev/MiniLoaderAll.bin</span><br><span class="line">	ln -rsf u-boot/uboot.img rockdev/</span><br><span class="line">	[ ! -e u-boot/trust.img ] || \</span><br><span class="line">		ln -rsf u-boot/trust.img rockdev/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®Œæˆæ„å»ºæµç¨‹</span></span><br><span class="line">	finish_build</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„å»º SPL</span></span><br><span class="line">build_spl()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥ RK_SPL_DEFCONFIG é…ç½®æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿”å›</span></span><br><span class="line">	check_config RK_SPL_DEFCONFIG || return 0</span><br><span class="line"></span><br><span class="line">	echo &quot;============Start building spl============&quot;</span><br><span class="line">	echo &quot;TARGET_SPL_CONFIG=$RK_SPL_DEFCONFIG&quot;</span><br><span class="line">	echo &quot;=========================================&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è¿›å…¥ u-boot ç›®å½•å¹¶åˆ é™¤æ—§çš„ spl.bin æ–‡ä»¶</span></span><br><span class="line">	cd u-boot</span><br><span class="line">	rm -f *spl.bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ„å»º SPL</span></span><br><span class="line">	./make.sh $RK_SPL_DEFCONFIG</span><br><span class="line">	./make.sh --spl</span><br><span class="line">	cd ..</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">åˆ›å»ºé“¾æ¥åˆ° rockdev ç›®å½•çš„ MiniLoaderAll.bin</span></span><br><span class="line">	SPL=&quot;$(echo u-boot/*_loader_spl.bin | head -1)&quot;</span><br><span class="line">	ln -rsf &quot;$SPL&quot; rockdev/MiniLoaderAll.bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®Œæˆæ„å»ºæµç¨‹</span></span><br><span class="line">	finish_build</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„å»º Loader</span></span><br><span class="line">build_loader()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥ RK_LOADER_BUILD_TARGET é…ç½®æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿”å›</span></span><br><span class="line">	check_config RK_LOADER_BUILD_TARGET || return 0</span><br><span class="line"></span><br><span class="line">	echo &quot;============Start building loader============&quot;</span><br><span class="line">	echo &quot;RK_LOADER_BUILD_TARGET=$RK_LOADER_BUILD_TARGET&quot;</span><br><span class="line">	echo &quot;==========================================&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è¿›å…¥ loader ç›®å½•å¹¶æ‰§è¡Œ build.sh æ„å»º Loader</span></span><br><span class="line">	cd loader</span><br><span class="line">	./build.sh $RK_LOADER_BUILD_TARGET</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®Œæˆæ„å»ºæµç¨‹</span></span><br><span class="line">	finish_build</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„å»º Kernel</span></span><br><span class="line">build_kernel()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥ RK_KERNEL_DTS å’Œ RK_KERNEL_DEFCONFIG é…ç½®æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿”å›</span></span><br><span class="line">	check_config RK_KERNEL_DTS RK_KERNEL_DEFCONFIG || return 0</span><br><span class="line"></span><br><span class="line">	echo &quot;============Start building kernel============&quot;</span><br><span class="line">	echo &quot;TARGET_KERNEL_ARCH   =$RK_KERNEL_ARCH&quot;</span><br><span class="line">	echo &quot;TARGET_KERNEL_CONFIG =$RK_KERNEL_DEFCONFIG&quot;</span><br><span class="line">	echo &quot;TARGET_KERNEL_DTS    =$RK_KERNEL_DTS&quot;</span><br><span class="line">	echo &quot;TARGET_KERNEL_CONFIG_FRAGMENT =$RK_KERNEL_DEFCONFIG_FRAGMENT&quot;</span><br><span class="line">	echo &quot;==========================================&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è®¾ç½®äº¤å‰ç¼–è¯‘å·¥å…·é“¾</span></span><br><span class="line">	setup_cross_compile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">ä½¿ç”¨ KMAKE æ„å»º Kernel</span></span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">KMAKE <span class="variable">$RK_KERNEL_DEFCONFIG</span> <span class="variable">$RK_KERNEL_DEFCONFIG_FRAGMENT</span></span></span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">KMAKE <span class="variable">$RK_KERNEL_DTS</span>.img</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥æ˜¯å¦å­˜åœ¨ Kernel FIT æ–‡ä»¶å¹¶ä½¿ç”¨ mk-fitimage.sh åˆ›å»ºé•œåƒ</span></span><br><span class="line">	ITS=&quot;$CHIP_DIR/$RK_KERNEL_FIT_ITS&quot;</span><br><span class="line">	if [ -f &quot;$ITS&quot; ]; then</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">COMMON_DIR/mk-fitimage.sh kernel/<span class="variable">$RK_BOOT_IMG</span> \</span></span><br><span class="line"><span class="language-bash">			<span class="string">&quot;<span class="variable">$ITS</span>&quot;</span> <span class="variable">$RK_KERNEL_IMG</span></span></span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">åˆ›å»ºé“¾æ¥åˆ° rockdev ç›®å½•çš„ boot.img</span></span><br><span class="line">	ln -rsf kernel/$RK_BOOT_IMG rockdev/boot.img</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å°† boot.img å¤åˆ¶åˆ° u-boot ç›®å½•ä¸‹ï¼Œç”¨äºå®‰å…¨æ€§è€ƒè™‘</span></span><br><span class="line">	cp rockdev/boot.img u-boot/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ„å»ºæ£€æŸ¥ç”µæºåŸŸ</span></span><br><span class="line">	build_check_power_domain</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®Œæˆæ„å»ºæµç¨‹</span></span><br><span class="line">	finish_build</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„å»º Wi-Fi å’Œè“ç‰™</span></span><br><span class="line">build_wifibt()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è®¾ç½®äº¤å‰ç¼–è¯‘å·¥å…·é“¾</span></span><br><span class="line">	setup_cross_compile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è®¾ç½® Buildroot ç›¸å…³è·¯å¾„</span></span><br><span class="line">	BUILDROOT_OUTDIR=$TOP_DIR/buildroot/output/$RK_CFG_BUILDROOT/</span><br><span class="line">	BUILDROOT_HOST_DIR=$BUILDROOT_OUTDIR/host/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥ Buildroot æ¶æ„</span></span><br><span class="line">	if grep -wq aarch64 &quot;$BUILDROOT_OUTDIR/.config&quot; 2&gt;/dev/null; then</span><br><span class="line">		BUILDROOT_ARCH=arm64</span><br><span class="line">	else</span><br><span class="line">		BUILDROOT_ARCH=arm</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è·å– Buildroot GCC å’Œ SYSROOT è·¯å¾„</span></span><br><span class="line">	BUILDROOT_GCC=&quot;$(echo $BUILDROOT_HOST_DIR/bin/*buildroot*-gcc)&quot;</span><br><span class="line">	BUILDROOT_SYSROOT=&quot;$(echo $BUILDROOT_HOST_DIR/*/sysroot/)&quot;</span><br><span class="line">	if [ ! -x &quot;$BUILDROOT_GCC&quot; -o ! -d &quot;$BUILDROOT_SYSROOT&quot; ]; then</span><br><span class="line">		echo &quot;ERROR: Buildroot not ready!&quot;</span><br><span class="line">		exit -1</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è®¾ç½® Wi-Fi å’Œè“ç‰™èŠ¯ç‰‡ç±»å‹å’Œ TTY è®¾å¤‡</span></span><br><span class="line">	if [ -n &quot;$1&quot; ]; then</span><br><span class="line">		WIFI_CHIP=$1</span><br><span class="line">	elif [ -n &quot;$RK_WIFIBT_CHIP&quot; ]; then</span><br><span class="line">		WIFI_CHIP=$RK_WIFIBT_CHIP</span><br><span class="line">	else</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">é»˜è®¤ä¸º ALL_AP</span></span><br><span class="line">		echo &quot;=== WARNNING WIFI_CHIP is NULL so default to ALL_AP ===&quot;</span><br><span class="line">		WIFI_CHIP=ALL_AP</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [ -n &quot;$2&quot; ]; then</span><br><span class="line">		BT_TTY_DEV=$2</span><br><span class="line">	elif [ -n &quot;$RK_WIFIBT_TTY&quot; ]; then</span><br><span class="line">		BT_TTY_DEV=$RK_WIFIBT_TTY</span><br><span class="line">	else</span><br><span class="line">		echo &quot;=== WARNNING BT_TTY is NULL so default to ttyS0 ===&quot;</span><br><span class="line">		BT_TTY_DEV=ttyS0</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥å†…æ ¸ .config é…ç½®</span></span><br><span class="line">	WIFI_USB=$(grep &quot;CONFIG_USB=y&quot; $TOP_DIR/kernel/.config || true)</span><br><span class="line">	WIFI_SDIO=$(grep &quot;CONFIG_MMC=y&quot; $TOP_DIR/kernel/.config || true)</span><br><span class="line">	WIFI_PCIE=$(grep &quot;CONFIG_PCIE_DW_ROCKCHIP=y&quot; $TOP_DIR/kernel/.config || true)</span><br><span class="line">	WIFI_RFKILL=$(grep &quot;CONFIG_RFKILL=y&quot; $TOP_DIR/kernel/.config || true)</span><br><span class="line">	if [ -z &quot;$WIFI_SDIO&quot; ]; then</span><br><span class="line">		echo &quot;=== WARNNING CONFIG_MMC not set !!! ===&quot;</span><br><span class="line">	fi</span><br><span class="line">	if [ -z &quot;$WIFI_RFKILL&quot; ]; then</span><br><span class="line">		echo &quot;=== WARNNING CONFIG_USB not set !!! ===&quot;</span><br><span class="line">	fi</span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; =~ &quot;U&quot; ]]; then</span><br><span class="line">		if [ -z &quot;$WIFI_USB&quot; ]; then</span><br><span class="line">			echo &quot;=== WARNNING CONFIG_USB not set so ABORT!!! ===&quot;</span><br><span class="line">			exit 0</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line">	echo &quot;kernel config: $WIFI_USB $WIFI_SDIO $WIFI_RFKILL&quot;</span><br><span class="line"></span><br><span class="line">	TARGET_CC=$&#123;CROSS_COMPILE&#125;gcc</span><br><span class="line">	RKWIFIBT=$TOP_DIR/external/rkwifibt</span><br><span class="line">	RKWIFIBT_APP=$TOP_DIR/external/rkwifibt-app</span><br><span class="line">	TARGET_ROOTFS_DIR=$TOP_DIR/buildroot/output/$RK_CFG_BUILDROOT/target</span><br><span class="line"></span><br><span class="line">	echo &quot;========build wifibt info=======&quot;</span><br><span class="line">	echo CROSS_COMPILE=$CROSS_COMPILE</span><br><span class="line">	echo WIFI_CHIP=$WIFI_CHIP</span><br><span class="line">	echo BT_TTY_DEV=$BT_TTY_DEV</span><br><span class="line">	echo TARGET_ROOTFS_DIR=$TARGET_ROOTFS_DIR</span><br><span class="line">	echo BUILDROOT_GCC=$BUILDROOT_GCC</span><br><span class="line">	echo BUILDROOT_SYSROOT=$BUILDROOT_SYSROOT</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; =~ &quot;ALL_AP&quot; ]];then</span><br><span class="line">		echo &quot;building bcmdhd sdio&quot;</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/bcmdhd CONFIG_BCMDHD=m CONFIG_BCMDHD_SDIO=y CONFIG_BCMDHD_PCIE=</span></span><br><span class="line">		if [ -n &quot;$WIFI_PCIE&quot; ]; then</span><br><span class="line">			echo &quot;building bcmdhd pcie&quot;</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/bcmdhd CONFIG_BCMDHD=m CONFIG_BCMDHD_PCIE=y CONFIG_BCMDHD_SDIO=</span></span><br><span class="line">		fi</span><br><span class="line">		if [ -n &quot;$WIFI_USB&quot; ]; then</span><br><span class="line">			echo &quot;building rtl8188fu usb&quot;</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8188fu modules</span></span><br><span class="line">		fi</span><br><span class="line">		echo &quot;building rtl8189fs sdio&quot;</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8189fs modules</span></span><br><span class="line">		echo &quot;building rtl8723ds sdio&quot;</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8723ds modules</span></span><br><span class="line">		echo &quot;building rtl8821cs sdio&quot;</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8821cs modules</span></span><br><span class="line">		echo &quot;building rtl8822cs sdio&quot;</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8822cs modules</span></span><br><span class="line">		echo &quot;building rtl8852bs sdio&quot;</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8852bs modules DRV_PATH=<span class="variable">$RKWIFIBT</span>/drivers/rtl8852bs</span></span><br><span class="line">		if [ -n &quot;$WIFI_PCIE&quot; ]; then</span><br><span class="line">			echo &quot;building rtl8852be pcie&quot;</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8852be modules DRV_PATH=<span class="variable">$RKWIFIBT</span>/drivers/rtl8852be</span></span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; =~ &quot;ALL_CY&quot; ]];then</span><br><span class="line">		echo &quot;building CYW4354&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/chips/CYW4354_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line">		echo &quot;building CYW4373&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/chips/CYW4373_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line">		echo &quot;building CYW43438&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/chips/CYW43438_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line">		echo &quot;building CYW43455&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/chips/CYW43455_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line">		echo &quot;building CYW5557X&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/chips/CYW5557X_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line">		if [ -n &quot;$WIFI_PCIE&quot; ]; then</span><br><span class="line">			echo &quot;building CYW5557X_PCIE&quot;</span><br><span class="line">			cp $RKWIFIBT/drivers/infineon/chips/CYW5557X_PCIE_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line">			echo &quot;building CYW54591_PCIE&quot;</span><br><span class="line">			cp $RKWIFIBT/drivers/infineon/chips/CYW54591_PCIE_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line">		fi</span><br><span class="line">		echo &quot;building CYW54591&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/chips/CYW54591_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">		KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line"></span><br><span class="line">		if [ -n &quot;$WIFI_USB&quot; ]; then</span><br><span class="line">			echo &quot;building rtl8188fu usb&quot;</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8188fu modules</span></span><br><span class="line">		fi</span><br><span class="line">		echo &quot;building rtl8189fs sdio&quot;</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8189fs modules</span></span><br><span class="line">		echo &quot;building rtl8723ds sdio&quot;</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8723ds modules</span></span><br><span class="line">		echo &quot;building rtl8821cs sdio&quot;</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8821cs modules</span></span><br><span class="line">		echo &quot;building rtl8822cs sdio&quot;</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8822cs modules</span></span><br><span class="line">		echo &quot;building rtl8852bs sdio&quot;</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8852bs modules DRV_PATH=<span class="variable">$RKWIFIBT</span>/drivers/rtl8852bs</span></span><br><span class="line">		if [ -n &quot;$WIFI_PCIE&quot; ]; then</span><br><span class="line">			echo &quot;building rtl8852be pcie&quot;</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8852be modules DRV_PATH=<span class="variable">$RKWIFIBT</span>/drivers/rtl8852be</span></span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; =~ &quot;AP6&quot; ]];then</span><br><span class="line">		if [[ &quot;$WIFI_CHIP&quot; = &quot;AP6275_PCIE&quot; ]];then</span><br><span class="line">			echo &quot;building bcmdhd pcie driver&quot;</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/bcmdhd CONFIG_BCMDHD=m CONFIG_BCMDHD_PCIE=y CONFIG_BCMDHD_SDIO=</span></span><br><span class="line">		else</span><br><span class="line">			echo &quot;building bcmdhd sdio driver&quot;</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/bcmdhd CONFIG_BCMDHD=m CONFIG_BCMDHD_SDIO=y CONFIG_BCMDHD_PCIE=</span></span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;CYW4354&quot; ]];then</span><br><span class="line">		echo &quot;building CYW4354&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/chips/CYW4354_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;CYW4373&quot; ]];then</span><br><span class="line">		echo &quot;building CYW4373&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/chips/CYW4373_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;CYW43438&quot; ]];then</span><br><span class="line">		echo &quot;building CYW43438&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/chips/CYW43438_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;CYW43455&quot; ]];then</span><br><span class="line">		echo &quot;building CYW43455&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/chips/CYW43455_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;CYW5557X&quot; ]];then</span><br><span class="line">		echo &quot;building CYW5557X&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/chips/CYW5557X_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;CYW5557X_PCIE&quot; ]];then</span><br><span class="line">		echo &quot;building CYW5557X_PCIE&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/chips/CYW5557X_PCIE_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;CYW54591&quot; ]];then</span><br><span class="line">		echo &quot;building CYW54591&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/chips/CYW54591_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;CYW54591_PCIE&quot; ]];then</span><br><span class="line">		echo &quot;building CYW54591_PCIE&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/chips/CYW54591_PCIE_Makefile $RKWIFIBT/drivers/infineon/Makefile -r</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/infineon</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;RTL8188FU&quot; ]];then</span><br><span class="line">		echo &quot;building rtl8188fu driver&quot;</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8188fu modules</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;RTL8189FS&quot; ]];then</span><br><span class="line">		echo &quot;building rtl8189fs driver&quot;</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8189fs modules</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;RTL8723DS&quot; ]];then</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8723ds modules</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;RTL8821CS&quot; ]];then</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8821cs modules</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;RTL8822CS&quot; ]];then</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8822cs modules</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;RTL8852BS&quot; ]];then</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8852bs modules</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;RTL8852BE&quot; ]];then</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/rtl8852be modules</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo &quot;building brcm_tools&quot;</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">TARGET_CC -o <span class="variable">$RKWIFIBT</span>/tools/brcm_tools/brcm_patchram_plus1 <span class="variable">$RKWIFIBT</span>/tools/brcm_tools/brcm_patchram_plus1.c</span></span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">TARGET_CC -o <span class="variable">$RKWIFIBT</span>/tools/brcm_tools/dhd_priv <span class="variable">$RKWIFIBT</span>/tools/brcm_tools/dhd_priv.c</span></span><br><span class="line"></span><br><span class="line">	echo &quot;building rk_wifibt_init&quot;</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">TARGET_CC -o <span class="variable">$RKWIFIBT</span>/src/rk_wifibt_init <span class="variable">$RKWIFIBT</span>/src/rk_wifi_init.c</span></span><br><span class="line"></span><br><span class="line">	echo &quot;building realtek_tools&quot;</span><br><span class="line">	make -C $RKWIFIBT/tools/rtk_hciattach/ CC=$TARGET_CC</span><br><span class="line"></span><br><span class="line">	echo &quot;building realtek bt drivers&quot;</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/bluetooth_uart_driver</span></span><br><span class="line">	if [ -n &quot;$WIFI_USB&quot; ]; then</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">KMAKE M=<span class="variable">$RKWIFIBT</span>/drivers/bluetooth_usb_driver</span></span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [ &quot;$RK_CHIP&quot; = &quot;rv1126_rv1109&quot; ];then</span><br><span class="line">		echo &quot;target is rv1126_rv1109, skip $RKWIFIBT_APP&quot;</span><br><span class="line">	else</span><br><span class="line">		echo &quot;building rkwifibt-app&quot;</span><br><span class="line">		make -C $RKWIFIBT_APP CC=$BUILDROOT_GCC \</span><br><span class="line">			SYSROOT=$BUILDROOT_SYSROOT ARCH=$BUILDROOT_ARCH || true</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo &quot;chmod +x tools&quot;</span><br><span class="line">	chmod 755 $RKWIFIBT/tools/brcm_tools/brcm_patchram_plus1</span><br><span class="line">	chmod 755 $RKWIFIBT/tools/brcm_tools/dhd_priv</span><br><span class="line">	chmod 755 $RKWIFIBT/src/rk_wifibt_init</span><br><span class="line">	chmod 755 $RKWIFIBT/tools/rtk_hciattach/rtk_hciattach</span><br><span class="line"></span><br><span class="line">	echo &quot;mkdir rootfs dir&quot; $TARGET_ROOTFS_DIR</span><br><span class="line">	rm -rf $TARGET_ROOTFS_DIR/system/lib/modules/</span><br><span class="line">	rm -rf $TARGET_ROOTFS_DIR/system/etc/firmware/</span><br><span class="line">	rm -rf $TARGET_ROOTFS_DIR/vendor/</span><br><span class="line">	rm -rf $TARGET_ROOTFS_DIR/usr/lib/modules/</span><br><span class="line">	mkdir -p $TARGET_ROOTFS_DIR/usr/lib/modules/</span><br><span class="line">	mkdir -p $TARGET_ROOTFS_DIR/system/lib/modules/</span><br><span class="line">	mkdir -p $TARGET_ROOTFS_DIR/system/etc/firmware/</span><br><span class="line">	mkdir -p $TARGET_ROOTFS_DIR/lib/firmware/rtlbt/</span><br><span class="line"></span><br><span class="line">	echo &quot;create link system-&gt;vendor&quot;</span><br><span class="line">	cd $TARGET_ROOTFS_DIR/</span><br><span class="line">	rm -rf $TARGET_ROOTFS_DIR/vendor</span><br><span class="line">	ln -rsf system $TARGET_ROOTFS_DIR/vendor</span><br><span class="line">	cd -</span><br><span class="line"></span><br><span class="line">	echo &quot;copy tools/sh to rootfs&quot;</span><br><span class="line">	cp $RKWIFIBT/bin/$BUILDROOT_ARCH/* $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">	cp $RKWIFIBT/sh/wifi_start.sh $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">	cp $RKWIFIBT/sh/wifi_ap6xxx_rftest.sh $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">	cp $RKWIFIBT/conf/wpa_supplicant.conf $TARGET_ROOTFS_DIR/etc/</span><br><span class="line">	cp $RKWIFIBT/conf/dnsmasq.conf $TARGET_ROOTFS_DIR/etc/</span><br><span class="line">	cp $RKWIFIBT/tools/brcm_tools/dhd_priv $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">	cp $RKWIFIBT/tools/brcm_tools/brcm_patchram_plus1 $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">	cp $RKWIFIBT/src/rk_wifibt_init $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;ALL_CY&quot; ]];then</span><br><span class="line">		echo &quot;copy infineon/realtek firmware/nvram to rootfs&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/*.ko $TARGET_ROOTFS_DIR/system/lib/modules/ || true</span><br><span class="line">		cp $RKWIFIBT/firmware/infineon/*/* $TARGET_ROOTFS_DIR/system/etc/firmware/ || true</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">todo rockchip</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"><span class="built_in">cp</span> <span class="variable">$RKWIFIBT</span>/firmware/rockchip/* <span class="variable">$TARGET_ROOTFS_DIR</span>/system/etc/firmware/</span></span><br><span class="line">		cp $RKWIFIBT/sh/bt_load_broadcom_firmware $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">		cp $TARGET_ROOTFS_DIR/usr/bin/bt_load_broadcom_firmware $TARGET_ROOTFS_DIR/usr/bin/bt_init.sh</span><br><span class="line">		cp $TARGET_ROOTFS_DIR/usr/bin/bt_load_broadcom_firmware $TARGET_ROOTFS_DIR/usr/bin/bt_pcba_test</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">reatek</span></span><br><span class="line">		cp $RKWIFIBT/firmware/realtek/*/* $TARGET_ROOTFS_DIR/lib/firmware/</span><br><span class="line">		cp $RKWIFIBT/firmware/realtek/*/* $TARGET_ROOTFS_DIR/lib/firmware/rtlbt/</span><br><span class="line">		cp $RKWIFIBT/tools/rtk_hciattach/rtk_hciattach $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">		cp $RKWIFIBT/drivers/bluetooth_uart_driver/hci_uart.ko $TARGET_ROOTFS_DIR/usr/lib/modules/</span><br><span class="line">		if [ -n &quot;$WIFI_USB&quot; ]; then</span><br><span class="line">			cp $RKWIFIBT/drivers/bluetooth_usb_driver/rtk_btusb.ko $TARGET_ROOTFS_DIR/usr/lib/modules/</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		rm -rf $TARGET_ROOTFS_DIR/etc/init.d/S36load_wifi_modules</span><br><span class="line">		cp $RKWIFIBT/S36load_all_wifi_modules $TARGET_ROOTFS_DIR/etc/init.d/</span><br><span class="line">		sed -i &quot;s/BT_TTY_DEV/\/dev\/$&#123;BT_TTY_DEV&#125;/g&quot; $TARGET_ROOTFS_DIR/etc/init.d/S36load_all_wifi_modules</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; = &quot;ALL_AP&quot; ]];then</span><br><span class="line">		echo &quot;copy ap6xxx/realtek firmware/nvram to rootfs&quot;</span><br><span class="line">		cp $RKWIFIBT/drivers/bcmdhd/*.ko $TARGET_ROOTFS_DIR/system/lib/modules/</span><br><span class="line">		cp $RKWIFIBT/firmware/broadcom/*/wifi/* $TARGET_ROOTFS_DIR/system/etc/firmware/ || true</span><br><span class="line">		cp $RKWIFIBT/firmware/broadcom/*/bt/* $TARGET_ROOTFS_DIR/system/etc/firmware/ || true</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">todo rockchip</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"><span class="built_in">cp</span> <span class="variable">$RKWIFIBT</span>/firmware/rockchip/* <span class="variable">$TARGET_ROOTFS_DIR</span>/system/etc/firmware/</span></span><br><span class="line">		cp $RKWIFIBT/sh/bt_load_broadcom_firmware $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">		cp $TARGET_ROOTFS_DIR/usr/bin/bt_load_broadcom_firmware $TARGET_ROOTFS_DIR/usr/bin/bt_init.sh</span><br><span class="line">		cp $TARGET_ROOTFS_DIR/usr/bin/bt_load_broadcom_firmware $TARGET_ROOTFS_DIR/usr/bin/bt_pcba_test</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">reatek</span></span><br><span class="line">		cp -rf $RKWIFIBT/firmware/realtek/*/* $TARGET_ROOTFS_DIR/lib/firmware/</span><br><span class="line">		cp -rf $RKWIFIBT/firmware/realtek/*/* $TARGET_ROOTFS_DIR/lib/firmware/rtlbt/</span><br><span class="line">		cp $RKWIFIBT/tools/rtk_hciattach/rtk_hciattach $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">		cp $RKWIFIBT/drivers/bluetooth_uart_driver/hci_uart.ko $TARGET_ROOTFS_DIR/usr/lib/modules/</span><br><span class="line">		if [ -n &quot;$WIFI_USB&quot; ]; then</span><br><span class="line">			cp $RKWIFIBT/drivers/bluetooth_usb_driver/rtk_btusb.ko $TARGET_ROOTFS_DIR/usr/lib/modules/</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		rm -rf $TARGET_ROOTFS_DIR/etc/init.d/S36load_wifi_modules</span><br><span class="line">		cp $RKWIFIBT/S36load_all_wifi_modules $TARGET_ROOTFS_DIR/etc/init.d/</span><br><span class="line">		sed -i &quot;s/BT_TTY_DEV/\/dev\/$&#123;BT_TTY_DEV&#125;/g&quot; $TARGET_ROOTFS_DIR/etc/init.d/S36load_all_wifi_modules</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; =~ &quot;RTL&quot; ]];then</span><br><span class="line">		echo &quot;Copy RTL file to rootfs&quot;</span><br><span class="line">		if [ -d &quot;$RKWIFIBT/firmware/realtek/$WIFI_CHIP&quot; ]; then</span><br><span class="line">			cp $RKWIFIBT/firmware/realtek/$WIFI_CHIP/* $TARGET_ROOTFS_DIR/lib/firmware/rtlbt/</span><br><span class="line">			cp $RKWIFIBT/firmware/realtek/$WIFI_CHIP/* $TARGET_ROOTFS_DIR/lib/firmware/</span><br><span class="line">		else</span><br><span class="line">			echo &quot;INFO: $WIFI_CHIP isn&#x27;t bluetooth?&quot;</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		WIFI_KO_DIR=$(echo $WIFI_CHIP | tr &#x27;[A-Z]&#x27; &#x27;[a-z]&#x27;)</span><br><span class="line"></span><br><span class="line">		cp $RKWIFIBT/drivers/$WIFI_KO_DIR/*.ko $TARGET_ROOTFS_DIR/system/lib/modules/</span><br><span class="line"></span><br><span class="line">		cp $RKWIFIBT/sh/bt_load_rtk_firmware $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">		sed -i &quot;s/BT_TTY_DEV/\/dev\/$&#123;BT_TTY_DEV&#125;/g&quot; $TARGET_ROOTFS_DIR/usr/bin/bt_load_rtk_firmware</span><br><span class="line">		if [ -n &quot;$WIFI_USB&quot; ]; then</span><br><span class="line">			cp $RKWIFIBT/drivers/bluetooth_usb_driver/rtk_btusb.ko $TARGET_ROOTFS_DIR/usr/lib/modules/</span><br><span class="line">			sed -i &quot;s/BT_DRV/rtk_btusb/g&quot; $TARGET_ROOTFS_DIR/usr/bin/bt_load_rtk_firmware</span><br><span class="line">		else</span><br><span class="line">			cp $RKWIFIBT/drivers/bluetooth_uart_driver/hci_uart.ko $TARGET_ROOTFS_DIR/usr/lib/modules/</span><br><span class="line">			sed -i &quot;s/BT_DRV/hci_uart/g&quot; $TARGET_ROOTFS_DIR/usr/bin/bt_load_rtk_firmware</span><br><span class="line">		fi</span><br><span class="line">		cp $TARGET_ROOTFS_DIR/usr/bin/bt_load_rtk_firmware $TARGET_ROOTFS_DIR/usr/bin/bt_init.sh</span><br><span class="line">		cp $TARGET_ROOTFS_DIR/usr/bin/bt_load_rtk_firmware $TARGET_ROOTFS_DIR/usr/bin/bt_pcba_test</span><br><span class="line">		cp $RKWIFIBT/tools/rtk_hciattach/rtk_hciattach $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">		rm -rf $TARGET_ROOTFS_DIR/etc/init.d/S36load_all_wifi_modules</span><br><span class="line">		cp $RKWIFIBT/S36load_wifi_modules $TARGET_ROOTFS_DIR/etc/init.d/</span><br><span class="line">		sed -i &quot;s/WIFI_KO/\/system\/lib\/modules\/$WIFI_CHIP.ko/g&quot; $TARGET_ROOTFS_DIR/etc/init.d/S36load_wifi_modules</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; =~ &quot;CYW&quot; ]];then</span><br><span class="line">		echo &quot;Copy CYW file to rootfs&quot;</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">tools</span></span><br><span class="line">		cp $RKWIFIBT/tools/brcm_tools/dhd_priv $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">		cp $RKWIFIBT/tools/brcm_tools/brcm_patchram_plus1 $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">firmware</span></span><br><span class="line">		cp $RKWIFIBT/firmware/infineon/$WIFI_CHIP/* $TARGET_ROOTFS_DIR/system/etc/firmware/</span><br><span class="line">		cp $RKWIFIBT/drivers/infineon/*.ko $TARGET_ROOTFS_DIR/system/lib/modules/</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">bt</span></span><br><span class="line">		cp $RKWIFIBT/sh/bt_load_broadcom_firmware $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">		sed -i &quot;s/BT_TTY_DEV/\/dev\/$&#123;BT_TTY_DEV&#125;/g&quot; $TARGET_ROOTFS_DIR/usr/bin/bt_load_broadcom_firmware</span><br><span class="line">		sed -i &quot;s/BTFIRMWARE_PATH/\/system\/etc\/firmware\//g&quot; $TARGET_ROOTFS_DIR/usr/bin/bt_load_broadcom_firmware</span><br><span class="line">		cp $TARGET_ROOTFS_DIR/usr/bin/bt_load_broadcom_firmware $TARGET_ROOTFS_DIR/usr/bin/bt_init.sh</span><br><span class="line">		cp $TARGET_ROOTFS_DIR/usr/bin/bt_load_broadcom_firmware $TARGET_ROOTFS_DIR/usr/bin/bt_pcba_test</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">wifi</span></span><br><span class="line">		rm -rf $TARGET_ROOTFS_DIR/etc/init.d/S36load_all_wifi_modules</span><br><span class="line">		cp $RKWIFIBT/S36load_wifi_modules $TARGET_ROOTFS_DIR/etc/init.d/</span><br><span class="line">		sed -i &quot;s/WIFI_KO/\/system\/lib\/modules\/$WIFI_CHIP.ko/g&quot; $TARGET_ROOTFS_DIR/etc/init.d/S36load_wifi_modules</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [[ &quot;$WIFI_CHIP&quot; =~ &quot;AP6&quot; ]];then</span><br><span class="line">		echo &quot;Copy AP file to rootfs&quot;</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">tools</span></span><br><span class="line">		cp $RKWIFIBT/tools/brcm_tools/dhd_priv $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">		cp $RKWIFIBT/tools/brcm_tools/brcm_patchram_plus1 $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">firmware</span></span><br><span class="line">		cp $RKWIFIBT/firmware/broadcom/$WIFI_CHIP/wifi/* $TARGET_ROOTFS_DIR/system/etc/firmware/</span><br><span class="line">		cp $RKWIFIBT/firmware/broadcom/$WIFI_CHIP/bt/* $TARGET_ROOTFS_DIR/system/etc/firmware/</span><br><span class="line">		cp $RKWIFIBT/drivers/bcmdhd/*.ko $TARGET_ROOTFS_DIR/system/lib/modules/</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">bt</span></span><br><span class="line">		cp $RKWIFIBT/sh/bt_load_broadcom_firmware $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">		sed -i &quot;s/BT_TTY_DEV/\/dev\/$&#123;BT_TTY_DEV&#125;/g&quot; $TARGET_ROOTFS_DIR/usr/bin/bt_load_broadcom_firmware</span><br><span class="line">		sed -i &quot;s/BTFIRMWARE_PATH/\/system\/etc\/firmware\//g&quot; $TARGET_ROOTFS_DIR/usr/bin/bt_load_broadcom_firmware</span><br><span class="line">		cp $TARGET_ROOTFS_DIR/usr/bin/bt_load_broadcom_firmware $TARGET_ROOTFS_DIR/usr/bin/bt_init.sh</span><br><span class="line">		cp $TARGET_ROOTFS_DIR/usr/bin/bt_load_broadcom_firmware $TARGET_ROOTFS_DIR/usr/bin/bt_pcba_test</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">wifi</span></span><br><span class="line">		rm -rf $TARGET_ROOTFS_DIR/etc/init.d/S36load_all_wifi_modules</span><br><span class="line">		cp $RKWIFIBT/S36load_wifi_modules $TARGET_ROOTFS_DIR/etc/init.d/</span><br><span class="line">		if [[ &quot;$WIFI_CHIP&quot; =~ &quot;AP&quot; ]];then</span><br><span class="line">			sed -i &quot;s/WIFI_KO/\/system\/lib\/modules\/bcmdhd.ko/g&quot; $TARGET_ROOTFS_DIR/etc/init.d/S36load_wifi_modules</span><br><span class="line">		else</span><br><span class="line">			sed -i &quot;s/WIFI_KO/\/system\/lib\/modules\/bcmdhd_pcie.ko/g&quot; $TARGET_ROOTFS_DIR/etc/init.d/S36load_wifi_modules</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line">	finish_build</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="built_in">exit</span> 0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„å»ºå†…æ ¸æ¨¡å—</span></span><br><span class="line">build_modules()</span><br><span class="line">&#123;</span><br><span class="line">	check_config RK_KERNEL_DEFCONFIG || return 0</span><br><span class="line"></span><br><span class="line">	echo &quot;============Start building kernel modules============&quot;</span><br><span class="line">	echo &quot;TARGET_KERNEL_ARCH   =$RK_KERNEL_ARCH&quot;</span><br><span class="line">	echo &quot;TARGET_KERNEL_CONFIG =$RK_KERNEL_DEFCONFIG&quot;</span><br><span class="line">	echo &quot;TARGET_KERNEL_CONFIG_FRAGMENT =$RK_KERNEL_DEFCONFIG_FRAGMENT&quot;</span><br><span class="line">	echo &quot;==================================================&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è®¾ç½®äº¤å‰ç¼–è¯‘å·¥å…·é“¾</span></span><br><span class="line">	setup_cross_compile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">ä½¿ç”¨æŒ‡å®šçš„å†…æ ¸é…ç½®å’Œç‰‡æ®µè¿›è¡Œæ„å»º</span></span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">KMAKE <span class="variable">$RK_KERNEL_DEFCONFIG</span> <span class="variable">$RK_KERNEL_DEFCONFIG_FRAGMENT</span></span></span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">KMAKE modules</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®Œæˆæ„å»º</span></span><br><span class="line">	finish_build</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„å»º Buildroot æ ¹æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">build_buildroot()</span><br><span class="line">&#123;</span><br><span class="line">	check_config RK_CFG_BUILDROOT || return 0</span><br><span class="line"></span><br><span class="line">	ROOTFS_DIR=$1</span><br><span class="line"></span><br><span class="line">	echo &quot;==========Start building buildroot rootfs ==========&quot;</span><br><span class="line">	echo &quot;TARGET_BUILDROOT_CONFIG=$RK_CFG_BUILDROOT&quot;</span><br><span class="line">	echo &quot;=========================================&quot;</span><br><span class="line"></span><br><span class="line">	DST_DIR=.buildroot</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">ä½¿ç”¨ mk-buildroot.sh è„šæœ¬æ„å»º Buildroot æ ¹æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">	/usr/bin/time -f &quot;you take %E to build buildroot&quot; \</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">COMMON_DIR/mk-buildroot.sh <span class="variable">$RK_CFG_BUILDROOT</span> <span class="variable">$DST_DIR</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">åˆ é™¤æ—§çš„æ ¹æ–‡ä»¶ç³»ç»Ÿç›®å½•å¹¶åˆ›å»ºæ–°çš„ç¬¦å·é“¾æ¥</span></span><br><span class="line">	rm -rf $ROOTFS_DIR</span><br><span class="line">	ln -rsf $DST_DIR $ROOTFS_DIR</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®Œæˆæ„å»º</span></span><br><span class="line">	finish_build</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">kernel_version()</span><br><span class="line">&#123;</span><br><span class="line">	[ -d &quot;$1&quot; ] || return 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®šä¹‰å†…æ ¸ç‰ˆæœ¬å·çš„å…³é”®å­—</span></span><br><span class="line">	VERSION_KEYS=&quot;VERSION PATCHLEVEL&quot;</span><br><span class="line">	VERSION=&quot;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">éå†å…³é”®å­—ï¼Œè·å–å†…æ ¸ç‰ˆæœ¬å·çš„å„ä¸ªéƒ¨åˆ†</span></span><br><span class="line">	for k in $VERSION_KEYS; do</span><br><span class="line">		v=$(grep &quot;^$k = &quot; $1/Makefile | cut -d&#x27; &#x27; -f3)</span><br><span class="line">		VERSION=$&#123;VERSION:+$&#123;VERSION&#125;.&#125;$v</span><br><span class="line">	done</span><br><span class="line">	echo $VERSION</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„å»º Yocto rootfs</span></span><br><span class="line">build_yocto()</span><br><span class="line">&#123;</span><br><span class="line">	check_config RK_YOCTO_MACHINE || return 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å¼€å§‹æ„å»º Yocto rootfs</span></span><br><span class="line">	echo &quot;=========å¼€å§‹æ„å»º Yocto rootfs=========&quot;</span><br><span class="line">	echo &quot;ç›®æ ‡æœºå™¨ï¼š$RK_YOCTO_MACHINE&quot;</span><br><span class="line">	echo &quot;=====================================&quot;</span><br><span class="line"></span><br><span class="line">	KERNEL_VERSION=$(kernel_version kernel/)</span><br><span class="line"></span><br><span class="line">	cd yocto</span><br><span class="line">	ln -rsf $RK_YOCTO_MACHINE.conf build/conf/local.conf</span><br><span class="line">	source oe-init-build-env</span><br><span class="line">	LANG=en_US.UTF-8 LANGUAGE=en_US.en LC_ALL=en_US.UTF-8 \</span><br><span class="line">		bitbake core-image-minimal -r conf/include/rksdk.conf \</span><br><span class="line">		-r conf/include/kernel-$KERNEL_VERSION.conf</span><br><span class="line"></span><br><span class="line">	finish_build</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„å»º debian rootfs</span></span><br><span class="line">build_debian()</span><br><span class="line">&#123;</span><br><span class="line">	ARCH=$&#123;RK_DEBIAN_ARCH:-$&#123;RK_KERNEL_ARCH&#125;&#125;</span><br><span class="line">	case $ARCH in</span><br><span class="line">		arm|armhf) ARCH=armhf ;;</span><br><span class="line">		*) ARCH=arm64 ;;</span><br><span class="line">	esac</span><br><span class="line"></span><br><span class="line">	echo &quot;=========å¼€å§‹æ„å»º Debian ($ARCH) æ ¹æ–‡ä»¶ç³»ç»Ÿ=========&quot;</span><br><span class="line"></span><br><span class="line">	cd debian</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥æ˜¯å¦å­˜åœ¨ linaro ç‰ˆæœ¬çš„ Debian æ ¹æ–‡ä»¶ç³»ç»Ÿå‹ç¼©åŒ…ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æ‰§è¡Œ mk-base-debian.sh è„šæœ¬æ„å»º</span></span><br><span class="line">	if [ ! -f linaro-$RK_DEBIAN_VERSION-alip-*.tar.gz ]; then</span><br><span class="line">		RELEASE=$RK_DEBIAN_VERSION TARGET=desktop ARCH=$ARCH ./mk-base-debian.sh</span><br><span class="line">		ln -rsf linaro-$RK_DEBIAN_VERSION-alip-*.tar.gz linaro-$RK_DEBIAN_VERSION-$ARCH.tar.gz</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	VERSION=debug ARCH=$ARCH ./mk-rootfs-$RK_DEBIAN_VERSION.sh</span><br><span class="line">	./mk-image.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®Œæˆæ„å»º</span></span><br><span class="line">	finish_build</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¯‘æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">build_rootfs()</span><br><span class="line">&#123;</span><br><span class="line">	check_config RK_ROOTFS_TYPE || return 0</span><br><span class="line"></span><br><span class="line">	ROOTFS=$&#123;1:-$&#123;RK_ROOTFS_SYSTEM:-buildroot&#125;&#125;</span><br><span class="line">	ROOTFS_IMG=rootfs.$&#123;RK_ROOTFS_TYPE&#125;</span><br><span class="line">	ROOTFS_DIR=.rootfs</span><br><span class="line"></span><br><span class="line">	echo &quot;==========å¼€å§‹æ„å»ºæ ¹æ–‡ä»¶ç³»ç»Ÿ($ROOTFS)ï¼Œè¾“å‡ºåˆ°$ROOTFS_DIR==========&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">åˆ é™¤æ—§çš„æ ¹æ–‡ä»¶ç³»ç»Ÿç›®å½•å¹¶åˆ›å»ºæ–°çš„ç›®å½•</span></span><br><span class="line">	rm -rf $ROOTFS_DIR</span><br><span class="line">	mkdir -p $ROOTFS_DIR</span><br><span class="line"></span><br><span class="line">	case &quot;$ROOTFS&quot; in</span><br><span class="line">		yocto)</span><br><span class="line">			build_yocto</span><br><span class="line">			ln -rsf yocto/build/latest/rootfs.img \</span><br><span class="line">				$ROOTFS_DIR/rootfs.ext4</span><br><span class="line">			;;</span><br><span class="line">		debian)</span><br><span class="line">			build_debian</span><br><span class="line">			ln -rsf debian/linaro-rootfs.img \</span><br><span class="line">				$ROOTFS_DIR/rootfs.ext4</span><br><span class="line">			;;</span><br><span class="line">		buildroot)</span><br><span class="line">			build_buildroot $ROOTFS_DIR</span><br><span class="line">			build_wifibt</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">ä¸º wifibt é‡æ–°ç¼–è¯‘</span></span><br><span class="line">			build_buildroot $ROOTFS_DIR</span><br><span class="line">			;;</span><br><span class="line">		*)</span><br><span class="line">			echo &quot;$ROOTFS ä¸æ”¯æŒï¼&quot;</span><br><span class="line">			exit 1</span><br><span class="line">			;;</span><br><span class="line">	esac</span><br><span class="line"></span><br><span class="line">	if [ ! -f &quot;$ROOTFS_DIR/$ROOTFS_IMG&quot; ]; then</span><br><span class="line">		echo &quot;æœªç”Ÿæˆ $ROOTFS_IMG...&quot;</span><br><span class="line">		exit 1</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	ln -rsf $ROOTFS_DIR/$ROOTFS_IMG rockdev/rootfs.img</span><br><span class="line"></span><br><span class="line">	[ ! -f $ROOTFS_DIR/oem.img ] || ln -rsf $ROOTFS_DIR/oem.img rockdev/</span><br><span class="line"></span><br><span class="line">	if [ &quot;$RK_RAMBOOT&quot; ]; then</span><br><span class="line">		/usr/bin/time -f &quot;you take %E to pack ramboot image&quot; \</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash">COMMON_DIR/mk-ramdisk.sh rockdev/rootfs.img \</span></span><br><span class="line"><span class="language-bash">			<span class="variable">$ROOTFS_DIR</span>/ramboot.img</span></span><br><span class="line">		ln -rsf $ROOTFS_DIR/ramboot.img rockdev/boot.img</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">ç”¨äºå®‰å…¨æ€§</span></span><br><span class="line">		cp rockdev/boot.img u-boot/</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [ &quot;$RK_RAMDISK_SECURITY_BOOTUP&quot; = &quot;true&quot; ]; then</span><br><span class="line">		echo &quot;å°è¯•ä¸º $RK_SYSTEM_CHECK_METHOD æ„å»º init&quot;</span><br><span class="line"></span><br><span class="line">		if [ &quot;$RK_SYSTEM_CHECK_METHOD&quot; = &quot;DM-V&quot; ]; then</span><br><span class="line">			SYSTEM_IMG=rootfs.squashfs</span><br><span class="line">		else</span><br><span class="line">			SYSTEM_IMG=$ROOTFS_IMG</span><br><span class="line">		fi</span><br><span class="line">		if [ ! -f &quot;$ROOTFS_DIR/$SYSTEM_IMG&quot; ]; then</span><br><span class="line">			echo &quot;æœªç”Ÿæˆ $SYSTEM_IMG...&quot;</span><br><span class="line">			exit -1</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">COMMON_DIR/mk-dm.sh <span class="variable">$RK_SYSTEM_CHECK_METHOD</span> \</span></span><br><span class="line"><span class="language-bash">			<span class="variable">$ROOTFS_DIR</span>/<span class="variable">$SYSTEM_IMG</span></span></span><br><span class="line">		ln -rsf $ROOTFS_DIR/security-system.img rockdev/rootfs.img</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®Œæˆæ„å»º</span></span><br><span class="line">	finish_build</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">build_recovery()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥æ˜¯å¦å¯ç”¨äº†ä¸»å¤‡ä»½(A/B)æ¨¡å¼çš„SDå¡æ›´æ–°</span></span><br><span class="line">	if [ &quot;$RK_UPDATE_SDCARD_ENABLE_FOR_AB&quot; = &quot;true&quot; ] ;then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">å¦‚æœæ˜¯å¯ç”¨äº†ä¸»å¤‡ä»½(A/B)æ¨¡å¼çš„SDå¡æ›´æ–°ï¼Œåˆ™ä½¿ç”¨ç›¸åº”çš„æ¢å¤é…ç½®</span></span><br><span class="line">		RK_CFG_RECOVERY=$RK_UPDATE_SDCARD_CFG_RECOVERY</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸»å¤‡ä»½(A/B)æ¨¡å¼çš„åŒ…æ–‡ä»¶</span></span><br><span class="line">	if [ ! -z &quot;$RK_PACKAGE_FILE_AB&quot; ]; then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">å¦‚æœå­˜åœ¨ä¸»å¤‡ä»½(A/B)æ¨¡å¼çš„åŒ…æ–‡ä»¶ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œä¸è¿›è¡Œæ„å»º</span></span><br><span class="line">		return 0</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥æ¢å¤é…ç½®æ˜¯å¦å·²é…ç½®</span></span><br><span class="line">	check_config RK_CFG_RECOVERY || return 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ‰“å°æ„å»ºæ¢å¤é•œåƒçš„æç¤ºä¿¡æ¯</span></span><br><span class="line">	echo &quot;==========å¼€å§‹æ„å»ºæ¢å¤é•œåƒ(buildroot)==========&quot;</span><br><span class="line">	echo &quot;TARGET_RECOVERY_CONFIG=$RK_CFG_RECOVERY&quot;</span><br><span class="line">	echo &quot;========================================&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è®¾ç½®ç›®æ ‡ç›®å½•</span></span><br><span class="line">	DST_DIR=.recovery</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ„å»ºæ¢å¤é•œåƒ(buildroot)</span></span><br><span class="line">	/usr/bin/time -f &quot;ç”¨æ—¶ %E æ„å»ºæ¢å¤é•œåƒ(buildroot)&quot; \</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">COMMON_DIR/mk-buildroot.sh <span class="variable">$RK_CFG_RECOVERY</span> <span class="variable">$DST_DIR</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ‰“åŒ…æ¢å¤é•œåƒ</span></span><br><span class="line">	/usr/bin/time -f &quot;ç”¨æ—¶ %E æ‰“åŒ…æ¢å¤é•œåƒ&quot; \</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">COMMON_DIR/mk-ramdisk.sh <span class="variable">$DST_DIR</span>/rootfs.cpio.gz \</span></span><br><span class="line"><span class="language-bash">		<span class="variable">$DST_DIR</span>/recovery.img \</span></span><br><span class="line"><span class="language-bash">		<span class="string">&quot;<span class="variable">$CHIP_DIR</span>/<span class="variable">$RK_RECOVERY_FIT_ITS</span>&quot;</span></span></span><br><span class="line">	ln -rsf $DST_DIR/recovery.img rockdev/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå°†æ¢å¤é•œåƒå¤åˆ¶åˆ°u-bootç›®å½•</span></span><br><span class="line">	cp rockdev/recovery.img u-boot/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®Œæˆæ„å»º</span></span><br><span class="line">	finish_build</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„å»ºPCBA</span></span><br><span class="line">build_pcba()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥PCBAé…ç½®æ˜¯å¦å·²é…ç½®</span></span><br><span class="line">	check_config RK_CFG_PCBA || return 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ‰“å°æ„å»ºPCBAé•œåƒçš„æç¤ºä¿¡æ¯</span></span><br><span class="line">	echo &quot;==========å¼€å§‹æ„å»ºPCBAé•œåƒ(buildroot)==========&quot;</span><br><span class="line">	echo &quot;TARGET_PCBA_CONFIG=$RK_CFG_PCBA&quot;</span><br><span class="line">	echo &quot;====================================&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">è®¾ç½®ç›®æ ‡ç›®å½•</span></span><br><span class="line">	DST_DIR=.pcba</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ„å»ºPCBAé•œåƒ(buildroot)</span></span><br><span class="line">	/usr/bin/time -f &quot;ç”¨æ—¶ %E æ„å»ºPCBAé•œåƒ(buildroot)&quot; \</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">COMMON_DIR/mk-buildroot.sh <span class="variable">$RK_CFG_PCBA</span> <span class="variable">$DST_DIR</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ‰“åŒ…PCBAé•œåƒ</span></span><br><span class="line">	/usr/bin/time -f &quot;ç”¨æ—¶ %E æ‰“åŒ…PCBAé•œåƒ&quot; \</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">COMMON_DIR/mk-ramdisk.sh <span class="variable">$DST_DIR</span>/rootfs.cpio.gz \</span></span><br><span class="line"><span class="language-bash">		<span class="variable">$DST_DIR</span>/pcba.img</span></span><br><span class="line">	ln -rsf $DST_DIR/pcba.img rockdev/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å®Œæˆæ„å»º</span></span><br><span class="line">	finish_build</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOT_FIXED_CONFIGS=&quot;</span><br><span class="line">	CONFIG_BLK_DEV_DM                # å¯ç”¨è®¾å¤‡æ˜ å°„ï¼ˆDevice Mapperï¼‰</span><br><span class="line">	CONFIG_DM_CRYPT                  # å¯ç”¨è®¾å¤‡æ˜ å°„åŠ å¯†æ¨¡å—</span><br><span class="line">	CONFIG_BLK_DEV_CRYPTOLOOP        # å¯ç”¨å—è®¾å¤‡åŠ å¯†å¾ªç¯è®¾å¤‡</span><br><span class="line">	CONFIG_DM_VERITY                 # å¯ç”¨è®¾å¤‡æ˜ å°„å®Œæ•´æ€§æ ¡éªŒæ¨¡å—&quot;</span><br><span class="line"></span><br><span class="line">BOOT_OPTEE_FIXED_CONFIGS=&quot;</span><br><span class="line">	CONFIG_TEE                       # å¯ç”¨å¯ä¿¡æ‰§è¡Œç¯å¢ƒï¼ˆTrusted Execution Environmentï¼‰</span><br><span class="line">	CONFIG_OPTEE                     # å¯ç”¨OP-TEEï¼ˆOpen Portable Trusted Execution Environmentï¼‰&quot;</span><br><span class="line"></span><br><span class="line">UBOOT_FIXED_CONFIGS=&quot;</span><br><span class="line">	CONFIG_FIT_SIGNATURE             # å¯ç”¨FITï¼ˆFlattened Image Treeï¼‰ç­¾åæ”¯æŒ</span><br><span class="line">	CONFIG_SPL_FIT_SIGNATURE         # å¯ç”¨SPLï¼ˆSecondary Program Loaderï¼‰FITç­¾åæ”¯æŒ&quot;</span><br><span class="line"></span><br><span class="line">UBOOT_AB_FIXED_CONFIGS=&quot;</span><br><span class="line">	CONFIG_ANDROID_AB                # å¯ç”¨Android A/Båˆ†åŒºæ”¯æŒ&quot;</span><br><span class="line"></span><br><span class="line">ROOTFS_UPDATE_ENGINEBIN_CONFIGS=&quot;</span><br><span class="line">	BR2_PACKAGE_RECOVERY             # å¯ç”¨æ¢å¤ç³»ç»ŸåŒ…</span><br><span class="line">	BR2_PACKAGE_RECOVERY_UPDATEENGINEBIN&quot;  # å¯ç”¨æ¢å¤ç³»ç»Ÿæ›´æ–°å¼•æ“äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">ROOTFS_AB_FIXED_CONFIGS=&quot;</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">ROOTFS_UPDATE_ENGINEBIN_CONFIGS     <span class="comment"># åŒ…æ‹¬ROOTFS_UPDATE_ENGINEBIN_CONFIGSä¸­çš„é…ç½®</span></span></span><br><span class="line">	BR2_PACKAGE_RECOVERY_BOOTCONTROL&quot;    # å¯ç”¨æ¢å¤ç³»ç»Ÿå¼•å¯¼æ§åˆ¶</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥é»˜è®¤é…ç½®</span></span><br><span class="line">defconfig_check()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">1. defconfig 2. fixed config</span></span><br><span class="line">	echo debug-$1   # è°ƒè¯•è¾“å‡ºï¼Œæ˜¾ç¤ºä¼ å…¥çš„å‚æ•°1</span><br><span class="line">	for i in $2   # éå†å‚æ•°2ä¸­çš„æ¯ä¸ªé…ç½®é€‰é¡¹</span><br><span class="line">	do</span><br><span class="line">		echo &quot;æŸ¥æ‰¾ $i&quot;   # è¾“å‡ºæ­£åœ¨æŸ¥æ‰¾çš„é…ç½®é€‰é¡¹</span><br><span class="line">		result=$(cat $1 | grep &quot;$&#123;i&#125;=y&quot; -w || echo &quot;æœªæ‰¾åˆ°&quot;)   # åœ¨é…ç½®æ–‡ä»¶ä¸­æŸ¥æ‰¾é…ç½®é€‰é¡¹ï¼Œå°†ç»“æœå­˜å‚¨åœ¨å˜é‡resultä¸­</span><br><span class="line">		if [ &quot;$result&quot; = &quot;æœªæ‰¾åˆ°&quot; ]; then   # å¦‚æœæœªæ‰¾åˆ°é…ç½®é€‰é¡¹</span><br><span class="line">			echo -e &quot;\e[41;1;37mé”™è¯¯ï¼šåœ¨ $1 ä¸­æœªæ‰¾åˆ°é…ç½®é¡¹ $&#123;i&#125; \e[0m&quot;   # è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œé…ç½®é¡¹æœªæ‰¾åˆ°</span><br><span class="line">			echo &quot;è¯·ç¡®ä¿æ‚¨çš„é…ç½®æ–‡ä»¶åŒ…å«ä»¥ä¸‹åˆ—è¡¨ä¸­çš„é€‰é¡¹&quot;</span><br><span class="line">			echo &quot;---------------------------------------&quot;</span><br><span class="line">			echo &quot;$2&quot;   # è¾“å‡ºå‚æ•°2ä¸­çš„é…ç½®é€‰é¡¹åˆ—è¡¨</span><br><span class="line">			echo &quot;---------------------------------------&quot;</span><br><span class="line">			return -1;   # è¿”å›-1è¡¨ç¤ºæ£€æŸ¥å¤±è´¥</span><br><span class="line">		fi</span><br><span class="line">	done</span><br><span class="line">	return 0   # è¿”å›0è¡¨ç¤ºæ£€æŸ¥é€šè¿‡</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä»é»˜è®¤é…ç½®æ–‡ä»¶ä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²</span></span><br><span class="line">find_string_in_config()</span><br><span class="line">&#123;</span><br><span class="line">	result=$(cat &quot;$2&quot; | grep &quot;$1&quot; || echo &quot;No found&quot;)   # åœ¨æ–‡ä»¶$2ä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²$1ï¼Œå°†ç»“æœå­˜å‚¨åœ¨å˜é‡resultä¸­</span><br><span class="line">	if [ &quot;$result&quot; = &quot;No found&quot; ]; then   # å¦‚æœæœªæ‰¾åˆ°å­—ç¬¦ä¸²</span><br><span class="line">		echo &quot;Security: No found string $1 in $2&quot;   # è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œæœªæ‰¾åˆ°å­—ç¬¦ä¸²</span><br><span class="line">		return -1;   # è¿”å›-1è¡¨ç¤ºæœªæ‰¾åˆ°</span><br><span class="line">	fi</span><br><span class="line">	return 0;   # è¿”å›0è¡¨ç¤ºæ‰¾åˆ°äº†å­—ç¬¦ä¸²</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check_security_condition()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">check security enabled</span></span><br><span class="line">	test -z &quot;$RK_SYSTEM_CHECK_METHOD&quot; &amp;&amp; return 0</span><br><span class="line"></span><br><span class="line">	if [ ! -d u-boot/keys ]; then</span><br><span class="line">		echo &quot;ERROR: No root keys(u-boot/keys) found in u-boot&quot;</span><br><span class="line">		echo &quot;       Create it by ./build.sh createkeys or move your key to it&quot;</span><br><span class="line">		return -1</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [ &quot;$RK_SYSTEM_CHECK_METHOD&quot; = &quot;DM-E&quot; ]; then</span><br><span class="line">		if [ ! -f u-boot/keys/root_passwd ]; then</span><br><span class="line">			echo &quot;ERROR: No root passwd(u-boot/keys/root_passwd) found in u-boot&quot;</span><br><span class="line">			echo &quot;       echo your root key for sudo to u-boot/keys/root_passwd&quot;</span><br><span class="line">			echo &quot;       some operations need supper user permission when create encrypt image&quot;</span><br><span class="line">			return -1</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		if [ ! -f u-boot/keys/system_enc_key ]; then</span><br><span class="line">			echo &quot;ERROR: No enc key(u-boot/keys/system_enc_key) found in u-boot&quot;</span><br><span class="line">			echo &quot;       Create it by ./build.sh createkeys or move your key to it&quot;</span><br><span class="line">			return -1</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		BOOT_FIXED_CONFIGS=&quot;$&#123;BOOT_FIXED_CONFIGS&#125;</span><br><span class="line">				    $&#123;BOOT_OPTEE_FIXED_CONFIGS&#125;&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo &quot;check kernel defconfig&quot;</span><br><span class="line">	defconfig_check \</span><br><span class="line"><span class="meta prompt_">		kernel/arch/$</span><span class="language-bash">RK_KERNEL_ARCH/configs/<span class="variable">$RK_KERNEL_DEFCONFIG</span> \</span></span><br><span class="line"><span class="language-bash">		<span class="string">&quot;<span class="variable">$BOOT_FIXED_CONFIGS</span>&quot;</span></span></span><br><span class="line"></span><br><span class="line">	if [ ! -z &quot;$&#123;RK_PACKAGE_FILE_AB&#125;&quot; ]; then</span><br><span class="line">		UBOOT_FIXED_CONFIGS=&quot;$&#123;UBOOT_FIXED_CONFIGS&#125;</span><br><span class="line">				     $&#123;UBOOT_AB_FIXED_CONFIGS&#125;&quot;</span><br><span class="line"></span><br><span class="line">		defconfig_check buildroot/configs/$&#123;RK_CFG_BUILDROOT&#125;_defconfig &quot;$ROOTFS_AB_FIXED_CONFIGS&quot;</span><br><span class="line">	fi</span><br><span class="line">	echo &quot;check uboot defconfig&quot;</span><br><span class="line">	defconfig_check u-boot/configs/$&#123;RK_UBOOT_DEFCONFIG&#125;_defconfig &quot;$UBOOT_FIXED_CONFIGS&quot;</span><br><span class="line"></span><br><span class="line">	if [ &quot;$RK_SYSTEM_CHECK_METHOD&quot; = &quot;DM-E&quot; ]; then</span><br><span class="line">		echo &quot;check ramdisk defconfig&quot;</span><br><span class="line">		defconfig_check buildroot/configs/$&#123;RK_CFG_BUILDROOT&#125;_defconfig &quot;$ROOTFS_UPDATE_ENGINEBIN_CONFIGS&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo &quot;check rootfs defconfig&quot;</span><br><span class="line">	find_string_in_config &quot;BR2_ROOTFS_OVERLAY=\&quot;.*board/rockchip/common/security-system-overlay.*&quot; &quot;buildroot/configs/$&#123;RK_CFG_BUILDROOT&#125;_defconfig&quot;</span><br><span class="line"></span><br><span class="line">	echo &quot;Security: finish check&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">check_security_conditionå‡½æ•°ç”¨äºæ£€æŸ¥å®‰å…¨æ¡ä»¶</span></span><br><span class="line">check_security_condition()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥æ˜¯å¦å¯ç”¨äº†å®‰å…¨é€‰é¡¹ï¼Œå¦‚æœæœªå¯ç”¨åˆ™ç›´æ¥è¿”å›0</span></span><br><span class="line">	test -z &quot;$RK_SYSTEM_CHECK_METHOD&quot; &amp;&amp; return 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">æ£€æŸ¥æ˜¯å¦å­˜åœ¨u-boot/keysç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›-1</span></span><br><span class="line">	if [ ! -d u-boot/keys ]; then</span><br><span class="line">		echo &quot;é”™è¯¯ï¼šåœ¨u-bootä¸­æœªæ‰¾åˆ°æ ¹å¯†é’¥ï¼ˆu-boot/keysï¼‰&quot;</span><br><span class="line">		echo &quot;      è¯·é€šè¿‡./build.sh createkeysåˆ›å»ºæˆ–å°†æ‚¨çš„å¯†é’¥ç§»åŠ¨åˆ°è¯¥ç›®å½•ä¸­&quot;</span><br><span class="line">		return -1</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å¦‚æœRK_SYSTEM_CHECK_METHODçš„å€¼ä¸ºDM-Eï¼Œåˆ™ç»§ç»­è¿›è¡Œä¸‹ä¸€æ­¥æ£€æŸ¥</span></span><br><span class="line">	if [ &quot;$RK_SYSTEM_CHECK_METHOD&quot; = &quot;DM-E&quot; ]; then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">æ£€æŸ¥æ˜¯å¦å­˜åœ¨u-boot/keys/root_passwdæ–‡ä»¶ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›-1</span></span><br><span class="line">		if [ ! -f u-boot/keys/root_passwd ]; then</span><br><span class="line">			echo &quot;é”™è¯¯ï¼šåœ¨u-bootä¸­æœªæ‰¾åˆ°æ ¹å£ä»¤ï¼ˆu-boot/keys/root_passwdï¼‰&quot;</span><br><span class="line">			echo &quot;      è¯·å°†æ‚¨çš„æ ¹å¯†é’¥ï¼ˆç”¨äºsudoï¼‰echoåˆ°u-boot/keys/root_passwdä¸­&quot;</span><br><span class="line">			echo &quot;      åˆ›å»ºåŠ å¯†é•œåƒæ—¶æŸäº›æ“ä½œéœ€è¦è¶…çº§ç”¨æˆ·æƒé™&quot;</span><br><span class="line">			return -1</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">æ£€æŸ¥æ˜¯å¦å­˜åœ¨u-boot/keys/system_enc_keyæ–‡ä»¶ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›-1</span></span><br><span class="line">		if [ ! -f u-boot/keys/system_enc_key ]; then</span><br><span class="line">			echo &quot;é”™è¯¯ï¼šåœ¨u-bootä¸­æœªæ‰¾åˆ°åŠ å¯†å¯†é’¥ï¼ˆu-boot/keys/system_enc_keyï¼‰&quot;</span><br><span class="line">			echo &quot;      è¯·é€šè¿‡./build.sh createkeysåˆ›å»ºæˆ–å°†æ‚¨çš„å¯†é’¥ç§»åŠ¨åˆ°è¯¥ç›®å½•ä¸­&quot;</span><br><span class="line">			return -1</span><br><span class="line">		fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">å°†BOOT_OPTEE_FIXED_CONFIGSæ·»åŠ åˆ°BOOT_FIXED_CONFIGSå˜é‡ä¸­</span></span><br><span class="line">		BOOT_FIXED_CONFIGS=&quot;$&#123;BOOT_FIXED_CONFIGS&#125;</span><br><span class="line">				    $&#123;BOOT_OPTEE_FIXED_CONFIGS&#125;&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo &quot;æ£€æŸ¥å†…æ ¸é…ç½®&quot;</span><br><span class="line">	defconfig_check \</span><br><span class="line"><span class="meta prompt_">		kernel/arch/$</span><span class="language-bash">RK_KERNEL_ARCH/configs/<span class="variable">$RK_KERNEL_DEFCONFIG</span> \</span></span><br><span class="line"><span class="language-bash">		<span class="string">&quot;<span class="variable">$BOOT_FIXED_CONFIGS</span>&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å¦‚æœRK_PACKAGE_FILE_ABä¸ä¸ºç©ºï¼Œåˆ™è¿›è¡Œä¸‹ä¸€æ­¥æ£€æŸ¥</span></span><br><span class="line">	if [ ! -z &quot;$&#123;RK_PACKAGE_FILE_AB&#125;&quot; ]; then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">å°†UBOOT_AB_FIXED_CONFIGSæ·»åŠ åˆ°UBOOT_FIXED_CONFIGSå˜é‡ä¸­</span></span><br><span class="line">		UBOOT_FIXED_CONFIGS=&quot;$&#123;UBOOT_FIXED_CONFIGS&#125;</span><br><span class="line">				     $&#123;UBOOT_AB_FIXED_CONFIGS&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">æ£€æŸ¥buildroot/configs/<span class="variable">$&#123;RK_CFG_BUILDROOT&#125;</span>_defconfigæ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">		defconfig_check buildroot/configs/$&#123;RK_CFG_BUILDROOT&#125;_defconfig &quot;$ROOTFS_AB_FIXED_CONFIGS&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo &quot;æ£€æŸ¥ubooté…ç½®&quot;</span><br><span class="line">	defconfig_check u-boot/configs/$&#123;RK_UBOOT_DEFCONFIG&#125;_defconfig &quot;$UBOOT_FIXED_CONFIGS&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å¦‚æœRK_SYSTEM_CHECK_METHODçš„å€¼ä¸ºDM-Eï¼Œåˆ™ç»§ç»­è¿›è¡Œä¸‹ä¸€æ­¥æ£€æŸ¥</span></span><br><span class="line">	if [ &quot;$RK_SYSTEM_CHECK_METHOD&quot; = &quot;DM-E&quot; ]; then</span><br><span class="line">		echo &quot;æ£€æŸ¥ramdiské…ç½®&quot;</span><br><span class="line">		defconfig_check buildroot/configs/$&#123;RK_CFG_BUILDROOT&#125;_defconfig &quot;$ROOTFS_UPDATE_ENGINEBIN_CONFIGS&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo &quot;æ£€æŸ¥rootfsé…ç½®&quot;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">åœ¨buildroot/configs/<span class="variable">$&#123;RK_CFG_BUILDROOT&#125;</span>_defconfigæ–‡ä»¶ä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²<span class="string">&quot;BR2_ROOTFS_OVERLAY=\&quot;.*board/rockchip/common/security-system-overlay.*&quot;</span></span></span><br><span class="line">	find_string_in_config &quot;BR2_ROOTFS_OVERLAY=\&quot;.*board/rockchip/common/security-system-overlay.*&quot; &quot;buildroot/configs/$&#123;RK_CFG_BUILDROOT&#125;_defconfig&quot;</span><br><span class="line"></span><br><span class="line">	echo &quot;å®‰å…¨æ£€æŸ¥å®Œæˆ&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¸…ç†</span></span><br><span class="line">build_cleanall()</span><br><span class="line">&#123;</span><br><span class="line">	echo &quot;clean uboot, kernel, rootfs, recovery&quot;   # æ‰§è¡Œæ¸…ç†æ“ä½œï¼Œæ¸…ç†u-bootã€kernelã€rootfså’Œrecoveryç›¸å…³çš„å†…å®¹</span><br><span class="line"></span><br><span class="line">	make -C u-boot distclean   # åœ¨u-bootç›®å½•ä¸­æ‰§è¡Œdistcleanå‘½ä»¤ï¼Œæ¸…ç†æ„å»ºè¿‡ç¨‹äº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶</span><br><span class="line">	make -C kernel distclean   # åœ¨kernelç›®å½•ä¸­æ‰§è¡Œdistcleanå‘½ä»¤ï¼Œæ¸…ç†æ„å»ºè¿‡ç¨‹äº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶</span><br><span class="line">	rm -rf buildroot/output   # åˆ é™¤buildroot/outputç›®å½•ï¼Œæ¸…ç†æ„å»ºrootfsè¿‡ç¨‹ä¸­ç”Ÿæˆçš„æ–‡ä»¶</span><br><span class="line">	rm -rf yocto/build/tmp yocto/build/*cache   # åˆ é™¤yocto/build/tmpç›®å½•å’Œæ‰€æœ‰yocto/build/*cacheç›®å½•ï¼Œæ¸…ç†æ„å»ºyoctoè¿‡ç¨‹ä¸­ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶å’Œç¼“å­˜æ–‡ä»¶</span><br><span class="line">	rm -rf debian/binary   # åˆ é™¤debian/binaryç›®å½•ï¼Œæ¸…ç†æ„å»ºdebianåŒ…æ—¶ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">	finish_build   # è°ƒç”¨finish_buildå‡½æ•°ï¼Œè¿›è¡Œåç»­çš„æ¸…ç†å’Œå¤„ç†æ“ä½œ</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">build_firmware()</span><br><span class="line">&#123;</span><br><span class="line">	./mkfirmware.sh $BOARD_CONFIG   # è¿è¡Œmkfirmware.shè„šæœ¬ï¼Œä¼ é€’$BOARD_CONFIGå‚æ•°ï¼Œç”¨äºæ„å»ºå›ºä»¶</span><br><span class="line"></span><br><span class="line">	finish_build   # è°ƒç”¨finish_buildå‡½æ•°ï¼Œè¿›è¡Œåç»­çš„æ¸…ç†å’Œå¤„ç†æ“ä½œ</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">build_updateimg()</span><br><span class="line">&#123;</span><br><span class="line">	IMAGE_PATH=$TOP_DIR/rockdev   # è®¾ç½®IMAGE_PATHå˜é‡ä¸º$TOP_DIR/rockdevï¼Œç”¨äºå­˜å‚¨ç”Ÿæˆçš„é•œåƒæ–‡ä»¶è·¯å¾„</span><br><span class="line">	PACK_TOOL_DIR=$TOP_DIR/tools/linux/Linux_Pack_Firmware   # è®¾ç½®PACK_TOOL_DIRå˜é‡ä¸º$TOP_DIR/tools/linux/Linux_Pack_Firmwareï¼Œç”¨äºå­˜å‚¨æ‰“åŒ…å·¥å…·çš„è·¯å¾„</span><br><span class="line"></span><br><span class="line">	cd $PACK_TOOL_DIR/rockdev   # è¿›å…¥$PACK_TOOL_DIR/rockdevç›®å½•</span><br><span class="line"></span><br><span class="line">	if [ -f &quot;$RK_PACKAGE_FILE_AB&quot; ]; then   # å¦‚æœå­˜åœ¨$RK_PACKAGE_FILE_ABæ–‡ä»¶</span><br><span class="line">		build_sdcard_package   # è°ƒç”¨build_sdcard_packageå‡½æ•°ï¼Œæ„å»ºSDå¡åŒ…</span><br><span class="line">		build_otapackage   # è°ƒç”¨build_otapackageå‡½æ•°ï¼Œæ„å»ºOTAåŒ…</span><br><span class="line"></span><br><span class="line">		cd $PACK_TOOL_DIR/rockdev   # è¿”å›$PACK_TOOL_DIR/rockdevç›®å½•</span><br><span class="line">		echo &quot;Make Linux a/b update_ab.img.&quot;</span><br><span class="line">		source_package_file_name=`ls -lh package-file | awk -F &#x27; &#x27; &#x27;&#123;print $NF&#125;&#x27;`   # è·å–package-fileçš„æ–‡ä»¶å</span><br><span class="line">		ln -fs &quot;$RK_PACKAGE_FILE_AB&quot; package-file   # åˆ›å»ºè½¯é“¾æ¥ï¼Œå°†$RK_PACKAGE_FILE_ABé“¾æ¥åˆ°package-file</span><br><span class="line">		./mkupdate.sh   # è¿è¡Œmkupdate.shè„šæœ¬ï¼Œç”Ÿæˆupdate.img</span><br><span class="line">		mv update.img $IMAGE_PATH/update_ab.img   # å°†ç”Ÿæˆçš„update.imgç§»åŠ¨åˆ°$IMAGE_PATH/update_ab.img</span><br><span class="line">		ln -fs $source_package_file_name package-file   # åˆ›å»ºè½¯é“¾æ¥ï¼Œå°†source_package_file_nameé“¾æ¥åˆ°package-file</span><br><span class="line">	else</span><br><span class="line">		echo &quot;Make update.img&quot;</span><br><span class="line"></span><br><span class="line">		if [ -f &quot;$RK_PACKAGE_FILE&quot; ]; then   # å¦‚æœå­˜åœ¨$RK_PACKAGE_FILEæ–‡ä»¶</span><br><span class="line">			source_package_file_name=`ls -lh package-file | awk -F &#x27; &#x27; &#x27;&#123;print $NF&#125;&#x27;`   # è·å–package-fileçš„æ–‡ä»¶å</span><br><span class="line">			ln -fs &quot;$RK_PACKAGE_FILE&quot; package-file   # åˆ›å»ºè½¯é“¾æ¥ï¼Œå°†$RK_PACKAGE_FILEé“¾æ¥åˆ°package-file</span><br><span class="line">			./mkupdate.sh   # è¿è¡Œmkupdate.shè„šæœ¬ï¼Œç”Ÿæˆupdate.img</span><br><span class="line">			ln -fs $source_package_file_name package-file   # åˆ›å»ºè½¯é“¾æ¥ï¼Œå°†source_package_file_nameé“¾æ¥åˆ°package-file</span><br><span class="line">		else</span><br><span class="line">			./mkupdate.sh   # è¿è¡Œmkupdate.shè„šæœ¬ï¼Œç”Ÿæˆupdate.img</span><br><span class="line">		fi</span><br><span class="line">		mv update.img $IMAGE_PATH   # å°†ç”Ÿæˆçš„update.imgç§»åŠ¨åˆ°$IMAGE_PATH</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	finish_build   # è°ƒç”¨finish_buildå‡½æ•°ï¼Œè¿›è¡Œåç»­çš„æ¸…ç†å’Œå¤„ç†æ“ä½œ</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¯‘otaçš„åŒ…</span></span><br><span class="line">build_otapackage()</span><br><span class="line">&#123;</span><br><span class="line">	IMAGE_PATH=$TOP_DIR/rockdev   # è®¾ç½®IMAGE_PATHå˜é‡ä¸º$TOP_DIR/rockdevï¼Œç”¨äºå­˜å‚¨ç”Ÿæˆçš„é•œåƒæ–‡ä»¶è·¯å¾„</span><br><span class="line">	PACK_TOOL_DIR=$TOP_DIR/tools/linux/Linux_Pack_Firmware   # è®¾ç½®PACK_TOOL_DIRå˜é‡ä¸º$TOP_DIR/tools/linux/Linux_Pack_Firmwareï¼Œç”¨äºå­˜å‚¨æ‰“åŒ…å·¥å…·çš„è·¯å¾„</span><br><span class="line"></span><br><span class="line">	echo &quot;Make ota ab update_ota.img&quot;</span><br><span class="line">	cd $PACK_TOOL_DIR/rockdev   # è¿›å…¥$PACK_TOOL_DIR/rockdevç›®å½•</span><br><span class="line"></span><br><span class="line">	if [ -f &quot;$RK_PACKAGE_FILE_OTA&quot; ]; then   # å¦‚æœå­˜åœ¨$RK_PACKAGE_FILE_OTAæ–‡ä»¶</span><br><span class="line">		source_package_file_name=`ls -lh $PACK_TOOL_DIR/rockdev/package-file | awk -F &#x27; &#x27; &#x27;&#123;print $NF&#125;&#x27;`   # è·å–package-fileçš„æ–‡ä»¶å</span><br><span class="line">		ln -fs &quot;$RK_PACKAGE_FILE_OTA&quot; package-file   # åˆ›å»ºè½¯é“¾æ¥ï¼Œå°†$RK_PACKAGE_FILE_OTAé“¾æ¥åˆ°package-file</span><br><span class="line">		./mkupdate.sh   # è¿è¡Œmkupdate.shè„šæœ¬ï¼Œç”Ÿæˆupdate.img</span><br><span class="line">		mv update.img $IMAGE_PATH/update_ota.img   # å°†ç”Ÿæˆçš„update.imgç§»åŠ¨åˆ°$IMAGE_PATH/update_ota.img</span><br><span class="line">		ln -fs $source_package_file_name package-file   # åˆ›å»ºè½¯é“¾æ¥ï¼Œå°†source_package_file_nameé“¾æ¥åˆ°package-file</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	finish_build   # è°ƒç”¨finish_buildå‡½æ•°ï¼Œè¿›è¡Œåç»­çš„æ¸…ç†å’Œå¤„ç†æ“ä½œ</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¯‘sdå¡é•œåƒ</span></span><br><span class="line">build_sdcard_package()</span><br><span class="line">&#123;</span><br><span class="line">	check_config RK_UPDATE_SDCARD_ENABLE_FOR_AB || return 0   # æ£€æŸ¥é…ç½®é¡¹ RK_UPDATE_SDCARD_ENABLE_FOR_ABï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨åˆ™è¿”å›0</span><br><span class="line"></span><br><span class="line">	local image_path=$TOP_DIR/rockdev   # è®¾ç½®image_pathå˜é‡ä¸º$TOP_DIR/rockdevï¼Œç”¨äºå­˜å‚¨ç”Ÿæˆçš„é•œåƒæ–‡ä»¶è·¯å¾„</span><br><span class="line">	local pack_tool_dir=$TOP_DIR/tools/linux/Linux_Pack_Firmware   # è®¾ç½®pack_tool_dirå˜é‡ä¸º$TOP_DIR/tools/linux/Linux_Pack_Firmwareï¼Œç”¨äºå­˜å‚¨æ‰“åŒ…å·¥å…·çš„è·¯å¾„</span><br><span class="line">	local rk_sdupdate_ab_misc=$&#123;RK_SDUPDATE_AB_MISC:=sdupdate-ab-misc.img&#125;   # è®¾ç½®rk_sdupdate_ab_miscå˜é‡ä¸ºRK_SDUPDATE_AB_MISCçš„å€¼ï¼ˆé»˜è®¤ä¸ºsdupdate-ab-misc.imgï¼‰</span><br><span class="line">	local rk_parameter_sdupdate=$&#123;RK_PARAMETER_SDUPDATE:=parameter-sdupdate.txt&#125;   # è®¾ç½®rk_parameter_sdupdateå˜é‡ä¸ºRK_PARAMETER_SDUPDATEçš„å€¼ï¼ˆé»˜è®¤ä¸ºparameter-sdupdate.txtï¼‰</span><br><span class="line">	local rk_package_file_sdcard_update=$&#123;RK_PACKAGE_FILE_SDCARD_UPDATE:=sdcard-update-package-file&#125;   # è®¾ç½®rk_package_file_sdcard_updateå˜é‡ä¸ºRK_PACKAGE_FILE_SDCARD_UPDATEçš„å€¼ï¼ˆé»˜è®¤ä¸ºsdcard-update-package-fileï¼‰</span><br><span class="line">	local sdupdate_ab_misc_img=$TOP_DIR/device/rockchip/common/images/$rk_sdupdate_ab_misc   # è®¾ç½®sdupdate_ab_misc_imgå˜é‡ä¸º$TOP_DIR/device/rockchip/common/images/åŠ ä¸Šrk_sdupdate_ab_miscçš„å€¼</span><br><span class="line">	local parameter_sdupdate=$TOP_DIR/device/rockchip/common/images/$rk_parameter_sdupdate   # è®¾ç½®parameter_sdupdateå˜é‡ä¸º$TOP_DIR/device/rockchip/common/images/åŠ ä¸Šrk_parameter_sdupdateçš„å€¼</span><br><span class="line">	local recovery_img=$TOP_DIR/buildroot/output/$RK_UPDATE_SDCARD_CFG_RECOVERY/images/recovery.img   # è®¾ç½®recovery_imgå˜é‡ä¸º$TOP_DIR/buildroot/output/åŠ ä¸ŠRK_UPDATE_SDCARD_CFG_RECOVERY/images/recovery.imgçš„å€¼</span><br><span class="line"></span><br><span class="line">	if [ $RK_UPDATE_SDCARD_CFG_RECOVERY ]; then   # å¦‚æœå­˜åœ¨RK_UPDATE_SDCARD_CFG_RECOVERYé…ç½®é¡¹</span><br><span class="line">		if [ -f $recovery_img ]; then   # å¦‚æœå­˜åœ¨recovery_imgæ–‡ä»¶</span><br><span class="line">			echo -n &quot;create recovery.img...&quot;   # è¾“å‡ºæç¤ºä¿¡æ¯</span><br><span class="line">			ln -rsf $recovery_img $image_path/recovery.img   # åˆ›å»ºè½¯é“¾æ¥ï¼Œå°†recovery_imgé“¾æ¥åˆ°$image_path/recovery.img</span><br><span class="line">		else</span><br><span class="line">			echo &quot;error: $recovery_img not found!&quot;   # è¾“å‡ºé”™è¯¯ä¿¡æ¯</span><br><span class="line">			return 1   # è¿”å›1è¡¨ç¤ºå‡ºé”™</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	echo &quot;Make sdcard update update_sdcard.img&quot;   # è¾“å‡ºæç¤ºä¿¡æ¯</span><br><span class="line">	cd $pack_tool_dir/rockdev   # è¿›å…¥$pack_tool_dir/rockdevç›®å½•</span><br><span class="line">	if [ -f &quot;$rk_package_file_sdcard_update&quot; ]; then   # å¦‚æœå­˜åœ¨$rk_package_file_sdcard_updateæ–‡ä»¶</span><br><span class="line">		if [ $rk_parameter_sdupdate ]; then   # å¦‚æœå­˜åœ¨$rk_parameter_sdupdateå˜é‡</span><br><span class="line">			if [ -f $parameter_sdupdate ]; then   # å¦‚æœå­˜åœ¨$parameter_sdupdateæ–‡ä»¶</span><br><span class="line">				echo -n &quot;create sdcard update image parameter...&quot;   # è¾“å‡ºæç¤ºä¿¡æ¯</span><br><span class="line">				ln -rsf $parameter_sdupdate $image_path/   # åˆ›å»ºè½¯é“¾æ¥ï¼Œå°†$parameter_sdupdateé“¾æ¥åˆ°$image_path/</span><br><span class="line">			fi</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		if [ $rk_sdupdate_ab_misc ]; then   # å¦‚æœå­˜åœ¨$rk_sdupdate_ab_miscå˜é‡</span><br><span class="line">			if [ -f $sdupdate_ab_misc_img ]; then   # å¦‚æœå­˜åœ¨$sdupdate_ab_misc_imgæ–‡ä»¶</span><br><span class="line">				echo -n &quot;create sdupdate ab misc.img...&quot;   # è¾“å‡ºæç¤ºä¿¡æ¯</span><br><span class="line">				ln -rsf $sdupdate_ab_misc_img $image_path/   # åˆ›å»ºè½¯é“¾æ¥ï¼Œå°†$sdupdate_ab_misc_imgé“¾æ¥åˆ°$image_path/</span><br><span class="line">			fi</span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		source_package_file_name=`ls -lh $pack_tool_dir/rockdev/package-file | awk -F &#x27; &#x27; &#x27;&#123;print $NF&#125;&#x27;`   # è·å–$pack_tool_dir/rockdev/package-fileçš„æ–‡ä»¶å</span><br><span class="line">		ln -fs &quot;$rk_package_file_sdcard_update&quot; package-file   # åˆ›å»ºè½¯é“¾æ¥ï¼Œå°†$rk_package_file_sdcard_updateé“¾æ¥åˆ°package-file</span><br><span class="line">		./mkupdate.sh   # è¿è¡Œmkupdate.shè„šæœ¬ï¼Œç”Ÿæˆupdate.img</span><br><span class="line">		mv update.img $image_path/update_sdcard.img   # å°†ç”Ÿæˆçš„update.imgç§»åŠ¨åˆ°$image_path/update_sdcard.img</span><br><span class="line">		ln -fs $source_package_file_name package-file   # åˆ›å»ºè½¯é“¾æ¥ï¼Œå°†$source_package_file_nameé“¾æ¥åˆ°package-file</span><br><span class="line">		rm -f $image_path/$rk_sdupdate_abmisc $image_path/$rk_parameter_sdupdate $image_path/recovery.img   # åˆ é™¤$image_path/$rk_sdupdate_ab_miscã€$image_path/$rk_parameter_sdupdateå’Œ$image_path/recovery.imgæ–‡ä»¶</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	finish_build   # è°ƒç”¨finish_buildå‡½æ•°</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">build_save()</span><br><span class="line">&#123;</span><br><span class="line">	IMAGE_PATH=$TOP_DIR/rockdev   # è®¾ç½®IMAGE_PATHå˜é‡ä¸º$TOP_DIR/rockdevï¼Œç”¨äºå­˜å‚¨ç”Ÿæˆçš„é•œåƒæ–‡ä»¶è·¯å¾„</span><br><span class="line">	DATE=$(date  +%Y%m%d.%H%M)   # è·å–å½“å‰æ—¥æœŸå’Œæ—¶é—´ï¼Œæ ¼å¼ä¸ºYYYYMMDD.HHMM</span><br><span class="line">	STUB_PATH=Image/&quot;$RK_KERNEL_DTS&quot;_&quot;$DATE&quot;_RELEASE_TEST   # è®¾ç½®STUB_PATHå˜é‡ä¸ºImage/åŠ ä¸Š$RK_KERNEL_DTSã€æ—¥æœŸå’Œ_RELEASE_TEST</span><br><span class="line">	STUB_PATH=&quot;$(echo $STUB_PATH | tr &#x27;[:lower:]&#x27; &#x27;[:upper:]&#x27;)&quot;   # å°†STUB_PATHè½¬æ¢ä¸ºå¤§å†™å­—æ¯</span><br><span class="line">	export STUB_PATH=$TOP_DIR/$STUB_PATH   # å¯¼å‡ºSTUB_PATHå˜é‡ä¸º$TOP_DIR/åŠ ä¸Š$STUB_PATH</span><br><span class="line">	export STUB_PATCH_PATH=$STUB_PATH/PATCHES   # å¯¼å‡ºSTUB_PATCH_PATHå˜é‡ä¸º$STUB_PATH/PATCHES</span><br><span class="line">	mkdir -p $STUB_PATH   # åˆ›å»º$STUB_PATHç›®å½•</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">ç”Ÿæˆè¡¥ä¸æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	.repo/repo/repo forall -c \</span></span><br><span class="line"><span class="language-bash"><span class="comment">#		&quot;$TOP_DIR/device/rockchip/common/gen_patches_body.sh&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">å¤åˆ¶è¡¥ä¸æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	<span class="built_in">yes</span> | .repo/repo/repo manifest -r -o <span class="variable">$STUB_PATH</span>/manifest_<span class="variable">$&#123;DATE&#125;</span>.xml</span></span><br><span class="line">	mkdir -p $STUB_PATCH_PATH/kernel   # åˆ›å»º$STUB_PATCH_PATH/kernelç›®å½•</span><br><span class="line">	cp kernel/.config $STUB_PATCH_PATH/kernel   # å¤åˆ¶kernelç›®å½•ä¸‹çš„.configæ–‡ä»¶åˆ°$STUB_PATCH_PATH/kernelç›®å½•</span><br><span class="line">	cp kernel/vmlinux $STUB_PATCH_PATH/kernel   # å¤åˆ¶kernelç›®å½•ä¸‹çš„vmlinuxæ–‡ä»¶åˆ°$STUB_PATCH_PATH/kernelç›®å½•</span><br><span class="line">	mkdir -p $STUB_PATH/IMAGES/   # åˆ›å»º$STUB_PATH/IMAGES/ç›®å½•</span><br><span class="line">	cp $IMAGE_PATH/* $STUB_PATH/IMAGES/   # å¤åˆ¶$IMAGE_PATHç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åˆ°$STUB_PATH/IMAGES/ç›®å½•</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">ä¿å­˜æ„å»ºå‘½ä»¤ä¿¡æ¯</span></span><br><span class="line">	echo &quot;UBOOT:  defconfig: $RK_UBOOT_DEFCONFIG&quot; &gt;&gt; $STUB_PATH/build_cmd_info   # å°†UBOOTçš„é…ç½®ä¿¡æ¯å†™å…¥build_cmd_infoæ–‡ä»¶</span><br><span class="line">	echo &quot;KERNEL: defconfig: $RK_KERNEL_DEFCONFIG, dts: $RK_KERNEL_DTS&quot; &gt;&gt; $STUB_PATH/build_cmd_info   # å°†KERNELçš„é…ç½®ä¿¡æ¯å†™å…¥build_cmd_infoæ–‡ä»¶</span><br><span class="line">	echo &quot;BUILDROOT: $RK_CFG_BUILDROOT&quot; &gt;&gt; $STUB_PATH/build_cmd_info   # å°†BUILDROOTçš„é…ç½®ä¿¡æ¯å†™å…¥build_cmd_infoæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">	finish_build   # è°ƒç”¨finish_buildå‡½æ•°</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">build_allsave()</span><br><span class="line">&#123;</span><br><span class="line">	rm -fr $TOP_DIR/rockdev   # åˆ é™¤$TOP_DIR/rockdevç›®å½•åŠå…¶å†…å®¹</span><br><span class="line">	mkdir -p $TOP_DIR/rockdev   # åˆ›å»º$TOP_DIR/rockdevç›®å½•</span><br><span class="line">	build_all   # è°ƒç”¨build_allå‡½æ•°ï¼Œæ‰§è¡Œå…¨éƒ¨æ„å»ºè¿‡ç¨‹</span><br><span class="line">	build_firmware   # è°ƒç”¨build_firmwareå‡½æ•°ï¼Œæ„å»ºå›ºä»¶</span><br><span class="line">	build_updateimg   # è°ƒç”¨build_updateimgå‡½æ•°ï¼Œæ„å»ºæ›´æ–°é•œåƒ</span><br><span class="line">	build_save   # è°ƒç”¨build_saveå‡½æ•°ï¼Œä¿å­˜æ„å»ºè¿‡ç¨‹ä¸­çš„ç›¸å…³æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">	build_check_power_domain   # è°ƒç”¨build_check_power_domainå‡½æ•°ï¼Œæ£€æŸ¥ç”µæºåŸŸé…ç½®</span><br><span class="line"></span><br><span class="line">	finish_build   # è°ƒç”¨finish_buildå‡½æ•°</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">create_keys()</span><br><span class="line">&#123;</span><br><span class="line">	test -d u-boot/keys &amp;&amp; echo &quot;ERROR: u-boot/keys has existed&quot; &amp;&amp; return -1   # æ£€æŸ¥u-boot/keysç›®å½•æ˜¯å¦å·²å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›-1</span><br><span class="line"></span><br><span class="line">	mkdir u-boot/keys -p   # åˆ›å»ºu-boot/keysç›®å½•</span><br><span class="line"></span><br><span class="line">	./rkbin/tools/rk_sign_tool kk --bits 2048 --out u-boot/keys   # ä½¿ç”¨rk_sign_toolå·¥å…·ç”Ÿæˆå¯†é’¥å¯¹ï¼Œå¯†é’¥é•¿åº¦ä¸º2048ä½ï¼Œå¹¶å­˜å‚¨åœ¨u-boot/keysç›®å½•ä¸‹</span><br><span class="line">	ln -s private_key.pem u-boot/keys/dev.key   # åˆ›å»ºç¬¦å·é“¾æ¥å°†private_key.pemå‘½åä¸ºu-boot/keys/dev.key</span><br><span class="line">	ln -s public_key.pem u-boot/keys/dev.pubkey   # åˆ›å»ºç¬¦å·é“¾æ¥å°†public_key.pemå‘½åä¸ºu-boot/keys/dev.pubkey</span><br><span class="line"></span><br><span class="line">	openssl req -batch -new -x509 -key u-boot/keys/dev.key -out u-boot/keys/dev.crt   # ä½¿ç”¨opensslç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼Œä½¿ç”¨u-boot/keys/dev.keyä½œä¸ºç§é’¥ï¼Œç”Ÿæˆçš„è¯ä¹¦å­˜å‚¨åœ¨u-boot/keys/dev.crtä¸­</span><br><span class="line"></span><br><span class="line">	openssl rand -out u-boot/keys/system_enc_key -hex 32   # ä½¿ç”¨opensslç”Ÿæˆ32å­—èŠ‚çš„éšæœºæ•°ï¼Œå¹¶ä»¥åå…­è¿›åˆ¶æ ¼å¼å­˜å‚¨åœ¨u-boot/keys/system_enc_keyæ–‡ä»¶ä¸­</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">security_is_enabled()</span><br><span class="line">&#123;</span><br><span class="line">	if [ &quot;$RK_RAMDISK_SECURITY_BOOTUP&quot; != &quot;true&quot; ]; then   # å¦‚æœç¯å¢ƒå˜é‡$RK_RAMDISK_SECURITY_BOOTUPä¸ç­‰äº&quot;true&quot;</span><br><span class="line">		echo &quot;No security paramter found in $BOARD_CONFIG&quot;   # è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œè¡¨ç¤ºåœ¨$BOARD_CONFIGä¸­æœªæ‰¾åˆ°å®‰å…¨å‚æ•°</span><br><span class="line">		exit -1   # é€€å‡ºè„šæœ¬ï¼Œè¿”å›-1</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">=========================</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">build targets</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">=========================</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">OPTIONS=<span class="string">&quot;<span class="variable">$&#123;@:-allsave&#125;</span>&quot;</span></span></span><br><span class="line">if [ -z &quot;$1&quot; ]; then</span><br><span class="line">    titlestr=&quot;è¯·é€‰æ‹©ä¸€ä¸ªé€‰é¡¹&quot;                         # èœå•æ ‡é¢˜</span><br><span class="line">    backtitle=&quot;iTOP-RK3568æ„å»ºè„šæœ¬ï¼Œhttp://www.topeet.com&quot;  # è¿”å›æ ‡é¢˜</span><br><span class="line">    menustr=&quot;ç¼–è¯‘é•œåƒ | u-boot| å†…æ ¸| recovery| buildroot | debian | yocto | all&quot;  # èœå•é€‰é¡¹</span><br><span class="line"></span><br><span class="line">    TTY_X=$(($(stty size | awk &#x27;&#123;print $2&#125;&#x27;)-6))  # ç¡®å®šç»ˆç«¯å®½åº¦</span><br><span class="line">    TTY_Y=$(($(stty size | awk &#x27;&#123;print $1&#125;&#x27;)-6))  # ç¡®å®šç»ˆç«¯é«˜åº¦</span><br><span class="line"></span><br><span class="line">    choose+=(&quot;uboot&quot;       &quot;build_uboot&quot;)      # é€‰é¡¹1: u-bootç¼–è¯‘</span><br><span class="line">    choose+=(&quot;kernel&quot;       &quot;build_kernel&quot;)    # é€‰é¡¹2: å†…æ ¸ç¼–è¯‘</span><br><span class="line">    choose+=(&quot;recovery&quot;       &quot;build_recovery&quot;)  # é€‰é¡¹3: recoveryç¼–è¯‘</span><br><span class="line">    choose+=(&quot;buildroot&quot;       &quot;build_rootfs buildroot&quot;)  # é€‰é¡¹4: ç¼–è¯‘buildrootæ ¹æ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">    choose+=(&quot;debian&quot;       &quot;build_rootfs debian&quot;)         # é€‰é¡¹5: ç¼–è¯‘Debianæ ¹æ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">    choose+=(&quot;yocto&quot;       &quot;build_rootfs yocto&quot;)           # é€‰é¡¹6: ç¼–è¯‘Yoctoæ ¹æ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">    choose+=(&quot;save&quot;       &quot;build_save&quot;)        # é€‰é¡¹7: ä¿å­˜æ„å»ºç»“æœ</span><br><span class="line">    choose+=(&quot;all&quot;       &quot;build_all&quot;)          # é€‰é¡¹8: ç¼–è¯‘æ‰€æœ‰</span><br><span class="line"></span><br><span class="line">    OPTIONS=$(whiptail --title &quot;$&#123;titlestr&#125;&quot; --backtitle &quot;$&#123;backtitle&#125;&quot; --notags \</span><br><span class="line">                --menu &quot;$&#123;menustr&#125;&quot; &quot;$&#123;TTY_Y&#125;&quot; &quot;$&#123;TTY_X&#125;&quot; $((TTY_Y - 8)) \</span><br><span class="line">                --cancel-button é€€å‡º --ok-button é€‰æ‹© &quot;$&#123;choose[@]&#125;&quot; \</span><br><span class="line">                3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)  # ä½¿ç”¨whiptailåˆ›å»ºèœå•ï¼Œå¹¶è·å–ç”¨æˆ·é€‰æ‹©çš„é€‰é¡¹</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">    OPTIONS=&quot;$&#123;1&#125;&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é¢„å¤„ç†é€‰é¡¹</span></span><br><span class="line">unset POST_OPTIONS</span><br><span class="line">for option in $OPTIONS; do</span><br><span class="line">    case $option in</span><br><span class="line">        BoardConfig*.mk)</span><br><span class="line">            option=&quot;$CHIP_DIR/$option&quot;</span><br><span class="line">            ;&amp;</span><br><span class="line">        *.mk)</span><br><span class="line">            CONF=$(realpath $option)</span><br><span class="line">            echo &quot;åˆ‡æ¢åˆ°é…ç½®æ–‡ä»¶: $CONF&quot;</span><br><span class="line">            if [ ! -f $CONF ]; then</span><br><span class="line">                echo &quot;æ–‡ä»¶ä¸å­˜åœ¨!&quot;</span><br><span class="line">                exit 1</span><br><span class="line">            fi</span><br><span class="line"></span><br><span class="line">            ln -rsf $CONF $BOARD_CONFIG</span><br><span class="line">            ;;</span><br><span class="line">        lunch) choose_board ;;</span><br><span class="line">        kernel-4.4|kernel-4.19|kernel-5.10)</span><br><span class="line">            RK_KERNEL_VERSION=$&#123;option#kernel-&#125;</span><br><span class="line">            ;;</span><br><span class="line">        *) POST_OPTIONS=&quot;$POST_OPTIONS $option&quot;;;</span><br><span class="line">    esac</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">if [ -r &quot;$BOARD_CONFIG&quot; ]; then  # å¦‚æœé…ç½®æ–‡ä»¶å­˜åœ¨ä¸”å¯è¯»</span><br><span class="line">    source $BOARD_CONFIG  # å¯¼å…¥é…ç½®æ–‡ä»¶</span><br><span class="line">else</span><br><span class="line">    choose_board  # å¦åˆ™ï¼Œè°ƒç”¨é€‰æ‹©æ¿å‹å‡½æ•°</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ -d &quot;$CHIP_DIR/build-hooks/&quot; ]; then  # å¦‚æœå­˜åœ¨æ„å»ºé’©å­ç›®å½•</span><br><span class="line">    for hook in $(find &quot;$CHIP_DIR/build-hooks&quot; -name &quot;*.sh&quot;); do  # éå†æ‰€æœ‰ä»¥.shç»“å°¾çš„æ–‡ä»¶</span><br><span class="line">        source &quot;$hook&quot;  # å¯¼å…¥æ¯ä¸ªæ„å»ºé’©å­è„šæœ¬</span><br><span class="line">    done</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å›é€€åˆ°å½“å‰å†…æ ¸ç‰ˆæœ¬</span></span><br><span class="line">RK_KERNEL_VERSION=$&#123;RK_KERNEL_VERSION:-$(kernel_version kernel/)&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å›é€€åˆ°5.10å†…æ ¸ç‰ˆæœ¬</span></span><br><span class="line">RK_KERNEL_VERSION=$&#123;RK_KERNEL_VERSION:-5.10&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ›´æ–°å†…æ ¸</span></span><br><span class="line">if [ &quot;$(kernel_version kernel/)&quot; != &quot;$RK_KERNEL_VERSION&quot; ]; then  # å¦‚æœå½“å‰å†…æ ¸ç‰ˆæœ¬ä¸æŒ‡å®šç‰ˆæœ¬ä¸ä¸€è‡´</span><br><span class="line">    KERNEL_DIR=kernel-$RK_KERNEL_VERSION  # è®¾ç½®æ–°çš„å†…æ ¸ç›®å½•åç§°</span><br><span class="line">    echo &quot;åˆ‡æ¢åˆ° $KERNEL_DIR&quot;</span><br><span class="line">    if [ ! -d &quot;$KERNEL_DIR&quot; ]; then  # å¦‚æœæ–°çš„å†…æ ¸ç›®å½•ä¸å­˜åœ¨</span><br><span class="line">        echo &quot;ä¸å­˜åœ¨ï¼&quot;</span><br><span class="line">        exit 1</span><br><span class="line">    fi</span><br><span class="line">    rm -rf kernel  # åˆ é™¤æ—§çš„å†…æ ¸è½¯é“¾æ¥</span><br><span class="line">    ln -rsf $KERNEL_DIR kernel  # åˆ›å»ºæ–°çš„å†…æ ¸è½¯é“¾æ¥</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åç»­é€‰é¡¹å¤„ç†</span></span><br><span class="line">for option in $POST_OPTIONS; do</span><br><span class="line">    echo &quot;å¤„ç†é€‰é¡¹: $option&quot;</span><br><span class="line">    case $option in</span><br><span class="line">        all) build_all ;;  # æ‰§è¡Œç¼–è¯‘æ‰€æœ‰é€‰é¡¹</span><br><span class="line">        save) build_save ;;  # æ‰§è¡Œä¿å­˜æ„å»ºç»“æœé€‰é¡¹</span><br><span class="line">        allsave) build_allsave ;;  # æ‰§è¡Œç¼–è¯‘æ‰€æœ‰å¹¶ä¿å­˜ç»“æœé€‰é¡¹</span><br><span class="line">        cleanall) build_cleanall ;;  # æ‰§è¡Œæ¸…ç†æ‰€æœ‰æ„å»ºç»“æœé€‰é¡¹</span><br><span class="line">        firmware) build_firmware ;;  # æ‰§è¡Œç¼–è¯‘å›ºä»¶é€‰é¡¹</span><br><span class="line">        updateimg) build_updateimg ;;  # æ‰§è¡Œç¼–è¯‘æ›´æ–°é•œåƒé€‰é¡¹</span><br><span class="line">        otapackage) build_otapackage ;;  # æ‰§è¡Œç¼–è¯‘OTAåŒ…é€‰é¡¹</span><br><span class="line">        sdpackage) build_sdcard_package ;;  # æ‰§è¡Œç¼–è¯‘SDå¡é•œåƒé€‰é¡¹</span><br><span class="line">        spl) build_spl ;;  # æ‰§è¡Œç¼–è¯‘SPLé€‰é¡¹</span><br><span class="line">        uboot) build_uboot ;;  # æ‰§è¡Œç¼–è¯‘u-booté€‰é¡¹</span><br><span class="line">        uefi) build_uefi ;;  # æ‰§è¡Œç¼–è¯‘UEFIé€‰é¡¹</span><br><span class="line">        loader) build_loader ;;  # æ‰§è¡Œç¼–è¯‘loaderé€‰é¡¹</span><br><span class="line">        kernel) build_kernel ;;  # æ‰§è¡Œç¼–è¯‘å†…æ ¸é€‰é¡¹</span><br><span class="line">        wifibt)  # æ‰§è¡Œç¼–è¯‘Wi-Fiå’Œè“ç‰™å›ºä»¶é€‰é¡¹</span><br><span class="line">            build_wifibt $2 $3  # è°ƒç”¨ç¼–è¯‘Wi-Fiå’Œè“ç‰™å›ºä»¶çš„å‡½æ•°ï¼Œå¹¶ä¼ é€’å‚æ•°$2å’Œ$3</span><br><span class="line">            exit 1 ;;  # é€€å‡ºè„šæœ¬</span><br><span class="line">        modules) build_modules ;;  # æ‰§è¡Œç¼–è¯‘å†…æ ¸æ¨¡å—é€‰é¡¹</span><br><span class="line">        rootfs) build_rootfs ;;  # æ‰§è¡Œç¼–è¯‘æ ¹æ–‡ä»¶ç³»ç»Ÿé€‰é¡¹</span><br><span class="line">        buildroot|debian|yocto) build_rootfs $option ;;  # æ‰§è¡Œç¼–è¯‘æŒ‡å®šæ ¹æ–‡ä»¶ç³»ç»Ÿé€‰é¡¹</span><br><span class="line">        pcba) build_pcba ;;  # æ‰§è¡Œç¼–è¯‘PCBAé€‰é¡¹</span><br><span class="line">        recovery) build_recovery ;;  # æ‰§è¡Œç¼–è¯‘recoveryé€‰é¡¹</span><br><span class="line">        info) build_info ;;  # æ‰§è¡Œæ˜¾ç¤ºæ„å»ºä¿¡æ¯é€‰é¡¹</span><br><span class="line">        createkeys) create_keys ;;  # æ‰§è¡Œç”Ÿæˆå¯†é’¥é€‰é¡¹</span><br><span class="line">        security_boot)  # æ‰§è¡Œå¯ç”¨å®‰å…¨å¼•å¯¼çš„é€‰é¡¹</span><br><span class="line">            security_is_enabled  # æ£€æŸ¥å®‰å…¨å¼•å¯¼æ˜¯å¦å·²å¯ç”¨</span><br><span class="line">            build_rootfs  # ç¼–è¯‘æ ¹æ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">            build_uboot boot  # ç¼–è¯‘å¯åŠ¨å¼•å¯¼ç¨‹åº</span><br><span class="line">            ;;</span><br><span class="line">        security_uboot)  # æ‰§è¡Œå¯ç”¨å®‰å…¨å¼•å¯¼çš„u-booté€‰é¡¹</span><br><span class="line">            security_is_enabled  # æ£€æŸ¥å®‰å…¨å¼•å¯¼æ˜¯å¦å·²å¯ç”¨</span><br><span class="line">            build_uboot uboot  # ç¼–è¯‘u-bootå¼•å¯¼ç¨‹åº</span><br><span class="line">            ;;</span><br><span class="line">        security_recovery)  # æ‰§è¡Œå¯ç”¨å®‰å…¨å¼•å¯¼çš„recoveryé€‰é¡¹</span><br><span class="line">            security_is_enabled  # æ£€æŸ¥å®‰å…¨å¼•å¯¼æ˜¯å¦å·²å¯ç”¨</span><br><span class="line">            build_recovery  # ç¼–è¯‘recovery</span><br><span class="line">            build_uboot recovery  # ç¼–è¯‘recoveryå¼•å¯¼ç¨‹åº</span><br><span class="line">            ;;</span><br><span class="line">        security_check) check_security_condition ;;  # æ‰§è¡Œæ£€æŸ¥å®‰å…¨æ¡ä»¶é€‰é¡¹</span><br><span class="line">        security_rootfs)  # æ‰§è¡Œå¯ç”¨å®‰å…¨å¼•å¯¼çš„æ ¹æ–‡ä»¶ç³»ç»Ÿé€‰é¡¹</span><br><span class="line">            security_is_enabled  # æ£€æŸ¥å®‰å…¨å¼•å¯¼æ˜¯å¦å·²å¯ç”¨</span><br><span class="line">            build_rootfs  # ç¼–è¯‘æ ¹æ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">            build_uboot  # ç¼–è¯‘u-bootå¼•å¯¼ç¨‹åº</span><br><span class="line">            echo &quot;è¯·æ›´æ–° rootfs.img / boot.img&quot;</span><br><span class="line">            ;;</span><br><span class="line">        *) usage ;;  # æ˜¾ç¤ºç”¨æ³•</span><br><span class="line">    esac</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ç‘èŠ¯å¾®</category>
      </categories>
  </entry>
  <entry>
    <title>cmake åŸºç¡€è¯¾</title>
    <url>/2023/09/03/21%20cmake-%E5%9F%BA%E7%A1%80%E8%AF%BE/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä¸€ã€å‡†å¤‡çŸ¥è¯†"><a href="#ä¸€ã€å‡†å¤‡çŸ¥è¯†" class="headerlink" title="ä¸€ã€å‡†å¤‡çŸ¥è¯†"></a>ä¸€ã€å‡†å¤‡çŸ¥è¯†</h1><h2 id="1-1-C-çš„ç¼–è¯‘è¿‡ç¨‹"><a href="#1-1-C-çš„ç¼–è¯‘è¿‡ç¨‹" class="headerlink" title="1.1 C++çš„ç¼–è¯‘è¿‡ç¨‹"></a>1.1 C++çš„ç¼–è¯‘è¿‡ç¨‹</h2><ul>
<li>-E ä»…é¢„å¤„ç†ï¼›ä¸ç¼–è¯‘ã€æ±‡ç¼–æˆ–é“¾æ¥ã€‚</li>
<li>-S ä»…ç¼–è¯‘ï¼›ä¸æ±‡ç¼–æˆ–é“¾æ¥ã€‚</li>
<li>-c ç¼–è¯‘å’Œæ±‡ç¼–ï¼Œä½†ä¸é“¾æ¥ã€‚</li>
<li>-o <file> å°†è¾“å‡ºæ”¾å…¥<file>ä¸­ã€‚</li>
</ul>
<p><strong>C++æºä»£ç çš„ç¼–è¯‘è¿‡ç¨‹</strong></p>
<ol>
<li><p><strong>é¢„å¤„ç†</strong>ï¼šåœ¨é¢„å¤„ç†é˜¶æ®µï¼ŒC++æºä»£ç ä¸­çš„é¢„å¤„ç†æŒ‡ä»¤ä¼šè¢«å¤„ç†ï¼ŒåŒ…æ‹¬å®å±•å¼€å’Œæ¡ä»¶ç¼–è¯‘ç­‰ã€‚åœ¨æ­¤é˜¶æ®µï¼Œéœ€è¦æ·»åŠ æ‰€æœ‰å¤´æ–‡ä»¶çš„å¼•ç”¨è·¯å¾„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†xx.cppæºæ–‡ä»¶é¢„å¤„ç†ä¸ºxx.iæ–‡ä»¶ï¼ˆæ–‡æœ¬æ–‡ä»¶ï¼‰</span></span><br><span class="line">g++ -E main.cpp -o main.i</span><br><span class="line">```</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ç¼–è¯‘</strong>ï¼šç¼–è¯‘é˜¶æ®µä¼šå¯¹é¢„å¤„ç†åçš„ä»£ç è¿›è¡Œè¯­æ³•æ£€æŸ¥å’Œç¼–è¯‘ï¼Œå°†ä»£ç ç¿»è¯‘ä¸ºæ±‡ç¼–è¯­è¨€æ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†xx.iæ–‡ä»¶ç¼–è¯‘ä¸ºxx.sçš„æ±‡ç¼–æ–‡ä»¶ï¼ˆæ–‡æœ¬æ–‡ä»¶ï¼‰</span></span><br><span class="line">g++ -S main.i -o main.s</span><br><span class="line">```</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ±‡ç¼–</strong>ï¼šæ±‡ç¼–é˜¶æ®µå°†æ±‡ç¼–è¯­è¨€æ–‡ä»¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼çš„ç›®æ ‡æ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†xx.sæ–‡ä»¶æ±‡ç¼–ä¸ºxx.oçš„äºŒè¿›åˆ¶ç›®æ ‡æ–‡ä»¶</span></span><br><span class="line">g++ -c main.s -o main.o</span><br><span class="line">```</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>é“¾æ¥</strong>ï¼šé“¾æ¥é˜¶æ®µå°†ç›®æ ‡æ–‡ä»¶ä¸æ‰€ä¾èµ–çš„åº“æ–‡ä»¶è¿›è¡Œå…³è”æˆ–ç»„è£…ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†ç›®æ ‡æ–‡ä»¶è¿›è¡Œé“¾æ¥ï¼Œç”Ÿæˆå¯æ‰§è¡Œç¨‹åº</span></span><br><span class="line">g++ main.o -o main</span><br><span class="line">```</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="1-2-é™æ€é“¾æ¥åº“å’ŒåŠ¨æ€é“¾æ¥åº“"><a href="#1-2-é™æ€é“¾æ¥åº“å’ŒåŠ¨æ€é“¾æ¥åº“" class="headerlink" title="1.2 é™æ€é“¾æ¥åº“å’ŒåŠ¨æ€é“¾æ¥åº“"></a>1.2 é™æ€é“¾æ¥åº“å’ŒåŠ¨æ€é“¾æ¥åº“</h2><p>é™æ€é“¾æ¥åº“å’ŒåŠ¨æ€é“¾æ¥åº“çš„åŒºåˆ«åœ¨äºé“¾æ¥çš„é˜¶æ®µä¸åŒã€‚</p>
<p><strong>é™æ€é“¾æ¥åº“</strong>çš„åç§°é€šå¸¸ä»¥<code>.a</code>ç»“å°¾ï¼ˆè¡¨ç¤ºarchive libraryï¼‰ï¼Œå®ƒåœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œé“¾æ¥ã€‚å¦‚æœä¸€ä¸ªå·¥ç¨‹ä¾èµ–äºé™æ€é“¾æ¥åº“ï¼Œé‚£ä¹ˆç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“ä¼šå°†é™æ€é“¾æ¥åº“<code>.a</code>æ‰“åŒ…åˆ°è¾“å‡ºæ–‡ä»¶ä¸­ï¼Œå› æ­¤ç”Ÿæˆçš„æ–‡ä»¶æ¯”è¾ƒå¤§ã€‚åœ¨è¿è¡Œæ—¶ï¼Œä¸å†éœ€è¦å•ç‹¬çš„åº“æ–‡ä»¶ã€‚</p>
<p><strong>åŠ¨æ€é“¾æ¥åº“</strong>çš„é“¾æ¥å‘ç”Ÿåœ¨ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå®ƒåœ¨ç¼–è¯‘é˜¶æ®µä»…è¿›è¡Œé“¾æ¥æ£€æŸ¥ï¼Œè€Œä¸è¿›è¡ŒçœŸæ­£çš„é“¾æ¥è¿‡ç¨‹ã€‚åŠ¨æ€é“¾æ¥åº“çš„åç¼€åé€šå¸¸ä¸º<code>.so</code>ï¼ˆè¡¨ç¤ºshared objectï¼Œåœ¨Linuxä¸Šï¼‰æˆ–<code>.dylib</code>ï¼ˆåœ¨macOSä¸Šï¼‰ã€‚åŠ¨æ€é“¾æ¥åº“åœ¨åŠ è½½åï¼Œåœ¨å†…å­˜ä¸­åªä¿å­˜ä¸€ä»½æ‹·è´ã€‚å¤šä¸ªç¨‹åºä¾èµ–äºå®ƒæ—¶ï¼Œä¸ä¼šé‡å¤åŠ è½½å’Œæ‹·è´ï¼ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/image-20230903175645024.png" alt="image-20230903175645024"></p>
<h2 id="1-3-ä¸ºä»€ä¹ˆéœ€è¦CMake"><a href="#1-3-ä¸ºä»€ä¹ˆéœ€è¦CMake" class="headerlink" title="1.3 ä¸ºä»€ä¹ˆéœ€è¦CMake"></a>1.3 ä¸ºä»€ä¹ˆéœ€è¦CMake</h2><h3 id="1-3-1-g-å‘½ä»¤è¡Œç¼–è¯‘"><a href="#1-3-1-g-å‘½ä»¤è¡Œç¼–è¯‘" class="headerlink" title="1.3.1 g++å‘½ä»¤è¡Œç¼–è¯‘"></a>1.3.1 g++å‘½ä»¤è¡Œç¼–è¯‘</h3><p>å½“ç¼–è¯‘hello_world.cpp&#96;æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘å’Œè¿è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">g++ main.cpp -o main</span><br></pre></td></tr></table></figure>

<p>å¦‚æœéœ€è¦å¼•å…¥å¤–éƒ¨åº“å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è¿›è¡Œç¼–è¯‘ï¼š</p>
<p>æ–¹æ³•ä¸€ï¼šä½¿ç”¨<code>-lgflags</code>å‚æ•°è¿›è¡Œé“¾æ¥**</p>
<p>é¦–å…ˆï¼Œéœ€è¦å®‰è£…<code>gflags</code>åº“ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install libgflags-dev libgflags2.2</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">ç„¶åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š</span><br><span class="line"></span><br><span class="line">````bash</span><br><span class="line">g++ main.cpp -lgflags -o main</span><br><span class="line">```</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•äºŒï¼šä½¿ç”¨<code>pkg-config</code>è¿›è¡Œåº“æ–‡ä»¶å’Œå¤´æ–‡ä»¶è·¯å¾„æŸ¥æ‰¾**</p>
<p>é¦–å…ˆï¼Œéœ€è¦å®‰è£…<code>pkg-config</code>å·¥å…·ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install pkg-config</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">ç„¶åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š</span><br><span class="line"></span><br><span class="line">````bash</span><br><span class="line">g++ main.cpp `pkg-config --cflags --libs gflags` -o main</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">è¿™é‡Œï¼Œ`pkg-config --cflags --libs gflags`å‘½ä»¤ç”¨äºæŸ¥æ‰¾`gflags`åº“çš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./main --age 31 --name alice</span><br></pre></td></tr></table></figure>

<p>æœ‰æ—¶å€™ï¼Œåœ¨ç¼–è¯‘æ—¶ä¸éœ€è¦æ‰‹åŠ¨æ·»åŠ å¤´æ–‡ä»¶æˆ–é“¾æ¥åº“è·¯å¾„ï¼Œå› ä¸º<code>g++</code>å¯ä»¥åœ¨é»˜è®¤çš„æŸ¥è¯¢è·¯å¾„ä¸­æ‰¾åˆ°è¿™äº›åº“ã€‚ç„¶è€Œï¼Œå½“é¡¹ç›®æ–‡ä»¶å’Œå¼•å…¥çš„å¤–éƒ¨åº“å˜å¾—è¾ƒå¤šæ—¶ï¼Œä½¿ç”¨å‘½ä»¤è¡Œç¼–è¯‘ä¼šå˜å¾—å†—é•¿ä¸”ä¸ä¾¿äºè°ƒè¯•å’Œç¼–è¾‘ã€‚é€šå¸¸ï¼Œåœ¨æµ‹è¯•å•ä¸ªæ–‡ä»¶æ—¶å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œç¼–è¯‘ï¼Œä½†ä¸æ¨èåœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨å‘½ä»¤è¡Œç¼–è¯‘æ–¹å¼ã€‚</p>
<h3 id="1-3-2-CMakeç®€ä»‹"><a href="#1-3-2-CMakeç®€ä»‹" class="headerlink" title="1.3.2 CMakeç®€ä»‹"></a>1.3.2 CMakeç®€ä»‹</h3><p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œæ¨èä½¿ç”¨CMakeæ¥æ„å»ºC++é¡¹ç›®ã€‚CMakeæ˜¯ä¸€ä¸ªå¼€æºçš„è·¨å¹³å°å·¥å…·ï¼Œç”¨äºæ„å»ºã€æµ‹è¯•å’Œè½¯ä»¶æ‰“åŒ…ã€‚</p>
<p>CMakeå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li><strong>è‡ªåŠ¨æœç´¢ä¾èµ–é¡¹</strong>ï¼šCMakeå…·æœ‰è‡ªåŠ¨æœç´¢å¯èƒ½éœ€è¦çš„ç¨‹åºã€åº“å’Œå¤´æ–‡ä»¶çš„èƒ½åŠ›ï¼Œå¯ä»¥ç®€åŒ–ä¾èµ–é¡¹çš„é…ç½®è¿‡ç¨‹ã€‚</li>
<li><strong>ç‹¬ç«‹çš„æ„å»ºç›®å½•</strong>ï¼šCMakeæ”¯æŒä½¿ç”¨ç‹¬ç«‹çš„æ„å»ºç›®å½•ï¼ˆä¾‹å¦‚<code>build</code>ç›®å½•ï¼‰ï¼Œè¿™æ ·å¯ä»¥å®‰å…¨åœ°æ¸…ç†æ„å»ºäº§ç”Ÿçš„ä¸­é—´æ–‡ä»¶å’Œè¾“å‡ºæ–‡ä»¶ï¼Œä¸ä¼šæ±¡æŸ“æºä»£ç ç›®å½•ã€‚</li>
<li><strong>è‡ªå®šä¹‰å‘½ä»¤</strong>ï¼šCMakeæ”¯æŒå®šä¹‰å¤æ‚çš„è‡ªå®šä¹‰å‘½ä»¤ï¼Œä¾‹å¦‚ä¸‹è½½æ–‡ä»¶ã€ç”Ÿæˆå„ç§æ–‡ä»¶ç­‰ï¼Œå¯ä»¥æ»¡è¶³é¡¹ç›®æ„å»ºè¿‡ç¨‹ä¸­çš„ç‰¹å®šéœ€æ±‚ã€‚</li>
<li><strong>è‡ªå®šä¹‰é…ç½®</strong>ï¼šCMakeæ”¯æŒæ ¹æ®éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰é…ç½®ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°å¯ç”¨æˆ–ç¦ç”¨ç‰¹å®šçš„ç»„ä»¶æˆ–åŠŸèƒ½ã€‚</li>
<li><strong>æ–‡æœ¬æ–‡ä»¶ç”Ÿæˆå·¥ä½œåŒºå’Œé¡¹ç›®</strong>ï¼šCMakeä½¿ç”¨ç®€å•çš„æ–‡æœ¬æ–‡ä»¶ï¼ˆ<code>CMakeLists.txt</code>ï¼‰æ¥æè¿°é¡¹ç›®çš„é…ç½®å’Œæ„å»ºè§„åˆ™ï¼Œå¯ä»¥æ ¹æ®è¿™äº›æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆå·¥ä½œåŒºå’Œé¡¹ç›®ã€‚</li>
<li><strong>æ–‡ä»¶ä¾èµ–é¡¹è‡ªåŠ¨ç”Ÿæˆå’Œå¹¶è¡Œæ„å»º</strong>ï¼šCMakeå¯ä»¥åœ¨ä¸»æµå¹³å°ä¸Šè‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä»è€Œä½¿æ„å»ºè¿‡ç¨‹æ›´é«˜æ•ˆã€‚åŒæ—¶ï¼ŒCMakeæ”¯æŒå¹¶è¡Œæ„å»ºï¼Œå¯ä»¥åŠ å¿«æ„å»ºé€Ÿåº¦ã€‚</li>
<li><strong>æ”¯æŒå¤šç§IDE</strong>ï¼šCMakeå‡ ä¹æ”¯æŒæ‰€æœ‰ä¸»æµçš„é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰ï¼ŒåŒ…æ‹¬Visual Studioã€Xcodeã€Eclipseç­‰ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åœ¨ä¸åŒçš„å¼€å‘ç¯å¢ƒä¸­è¿›è¡Œé¡¹ç›®å¼€å‘å’Œè°ƒè¯•ã€‚</li>
</ul>
<h1 id="äºŒã€CMakeåŸºç¡€çŸ¥è¯†"><a href="#äºŒã€CMakeåŸºç¡€çŸ¥è¯†" class="headerlink" title="äºŒã€CMakeåŸºç¡€çŸ¥è¯†"></a>äºŒã€CMakeåŸºç¡€çŸ¥è¯†</h1><h2 id="2-1-å®‰è£…"><a href="#2-1-å®‰è£…" class="headerlink" title="2.1 å®‰è£…"></a>2.1 å®‰è£…</h2><p>åœ¨Ubuntuä¸Šå®‰è£…CMakeå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install cmake -y</span><br></pre></td></tr></table></figure>

<p>è¿™å°†ä½¿ç”¨aptåŒ…ç®¡ç†å™¨è‡ªåŠ¨å®‰è£…CMakeã€‚</p>
<p>å¦‚æœä½ æƒ³ç¼–è¯‘å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„CMakeï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p>
<p>å…‹éš†CMakeçš„æºä»£ç åº“ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone -b v3.25.1 https://github.com/Kitware/CMake.git</span><br><span class="line">cd CMake</span><br><span class="line"></span><br><span class="line">è¿™é‡Œä»¥å®‰è£…ç‰ˆæœ¬3.25.1ä¸ºä¾‹ï¼Œä½ å¯ä»¥å°†`v3.25.1`æ›¿æ¢ä¸ºä½ æƒ³è¦å®‰è£…çš„ç‰¹å®šç‰ˆæœ¬ã€‚</span><br></pre></td></tr></table></figure>

<p>é…ç½®å’Œç¼–è¯‘CMakeï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./bootstrap --prefix=&lt;å®‰è£…è·¯å¾„&gt;</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">ä½ å¯ä»¥ä½¿ç”¨`--prefix`é€‰é¡¹æ¥æŒ‡å®šå®‰è£…è·¯å¾„ï¼Œæˆ–è€…çœç•¥`--prefix`ä»¥å®‰è£…åˆ°é»˜è®¤è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure>

<p>å®‰è£…CMakeï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo make install</span><br><span class="line"></span><br><span class="line">è¿™å°†ä»¥ç®¡ç†å‘˜æƒé™å®‰è£…CMakeåˆ°ç³»ç»Ÿä¸­ã€‚</span><br></pre></td></tr></table></figure>

<p>å®‰è£…å®Œæˆåï¼Œä½ å¯ä»¥éªŒè¯CMakeçš„å®‰è£…ç‰ˆæœ¬ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake --version</span><br></pre></td></tr></table></figure>

<p>è¯¥å‘½ä»¤å°†æ˜¾ç¤ºCMakeçš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œç¡®è®¤å®‰è£…æˆåŠŸä¸å¦ã€‚</p>
<h2 id="2-2-ç¬¬ä¸€ä¸ªCMakeä¾‹å­"><a href="#2-2-ç¬¬ä¸€ä¸ªCMakeä¾‹å­" class="headerlink" title="2.2 ç¬¬ä¸€ä¸ªCMakeä¾‹å­"></a>2.2 ç¬¬ä¸€ä¸ªCMakeä¾‹å­</h2><p><strong>é…ç½®ï¼š</strong> ä½¿ç”¨<code>cmake</code>å‘½ä»¤è¿›è¡Œé…ç½®ï¼Œå…¶ä¸­<code>-S</code>é€‰é¡¹æŒ‡å®šæºç ç›®å½•ï¼Œ<code>-B</code>é€‰é¡¹æŒ‡å®šæ„å»ºç›®å½•ã€‚åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmake -S . -B build</span><br><span class="line"></span><br><span class="line">è¿™å°†åœ¨å½“å‰ç›®å½•ä¸‹æ‰§è¡ŒCMakeé…ç½®ï¼Œå¹¶å°†ç”Ÿæˆçš„æ„å»ºç³»ç»Ÿæ–‡ä»¶æ”¾åœ¨åä¸º`build`çš„ç›®å½•ä¸­ã€‚</span><br></pre></td></tr></table></figure>

<p><strong>ç”Ÿæˆï¼š</strong> ä½¿ç”¨<code>cmake --build</code>å‘½ä»¤è¿›è¡Œç”Ÿæˆï¼Œå…¶ä¸­<code>--build</code>é€‰é¡¹æŒ‡å®šæ„å»ºç›®å½•ã€‚åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmake --build build</span><br><span class="line"></span><br><span class="line">è¿™å°†åœ¨`build`ç›®å½•ä¸­æ‰§è¡Œæ„å»ºæ­¥éª¤ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure>

<p><strong>è¿è¡Œï¼š</strong> ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./build/first_cmake</span><br><span class="line"></span><br><span class="line">è¿™å°†æ‰§è¡Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="2-3-è¯­æ³•åŸºç¡€"><a href="#2-3-è¯­æ³•åŸºç¡€" class="headerlink" title="2.3 è¯­æ³•åŸºç¡€"></a>2.3 è¯­æ³•åŸºç¡€</h2><h3 id="2-3-1-æŒ‡å®šç‰ˆæœ¬"><a href="#2-3-1-æŒ‡å®šç‰ˆæœ¬" class="headerlink" title="2.3.1 æŒ‡å®šç‰ˆæœ¬"></a>2.3.1 æŒ‡å®šç‰ˆæœ¬</h3><p>åœ¨CMakeä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>cmake_minimum_required</code>å‘½ä»¤æŒ‡å®šå½“å‰é¡¹ç›®æ‰€éœ€çš„æœ€ä½CMakeç‰ˆæœ¬ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION &lt;version_number&gt;)</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>&lt;version_number&gt;</code>æ˜¯æ‰€éœ€çš„æœ€ä½CMakeç‰ˆæœ¬å·ã€‚åœ¨è¿™ä¸ªå‘½ä»¤ä¹‹åï¼ŒCMakeå°†ä¼šæ£€æŸ¥ç³»ç»Ÿä¸­å®‰è£…çš„CMakeç‰ˆæœ¬æ˜¯å¦æ»¡è¶³è¿™ä¸ªè¦æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³åˆ™ä¼šäº§ç”Ÿé”™è¯¯ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœè¦æŒ‡å®šæœ€ä½çš„CMakeç‰ˆæœ¬ä¸º3.10ï¼Œå¯ä»¥åœ¨CMakeLists.txtæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.10</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼ŒCMakeå°†ä¼šæ£€æŸ¥ç³»ç»Ÿä¸­çš„CMakeç‰ˆæœ¬æ˜¯å¦å¤§äºç­‰äº3.10ã€‚</p>
<p>é™¤äº†<code>cmake_minimum_required</code>å‘½ä»¤ï¼ŒCMakeä¸­è¿˜æœ‰å…¶ä»–ç±»ä¼¼çš„å‘½ä»¤ï¼Œå®ƒä»¬ä¸åŒºåˆ†å¤§å°å†™ï¼Œå¹¶ä¸”æœ‰è®¸å¤šå…³é”®å­—æ¥å¼•å¯¼å‘½ä»¤çš„å‚æ•°è¾“å…¥ï¼Œç±»ä¼¼äºå‡½æ•°çš„å‚æ•°ä¼ é€’ã€‚è¿™äº›å‘½ä»¤ä½¿ç”¨çš„å…³é”®å­—åœ¨CMakeä¸­æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ã€‚</p>
<h3 id="2-3-2-è®¾ç½®é¡¹ç›®"><a href="#2-3-2-è®¾ç½®é¡¹ç›®" class="headerlink" title="2.3.2 è®¾ç½®é¡¹ç›®"></a>2.3.2 è®¾ç½®é¡¹ç›®</h3><p>åœ¨CMakeLists.txtæ–‡ä»¶çš„å¼€å¤´ï¼Œé€šå¸¸ä¼šä½¿ç”¨<code>project</code>å‘½ä»¤æ¥æŒ‡å®šé¡¹ç›®çš„åç§°ã€ç‰ˆæœ¬ã€æè¿°å’Œæ‰€ä½¿ç”¨çš„è¯­è¨€ã€‚<code>project</code>å‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">project</span>(ProjectName</span><br><span class="line">    [VERSION &lt;version_number&gt;]</span><br><span class="line">    [DESCRIPTION <span class="string">&quot;project_description&quot;</span>]</span><br><span class="line">    [LANGUAGES &lt;language&gt;]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>ProjectName</code>æ˜¯é¡¹ç›®çš„åç§°ï¼Œåœ¨ä¾‹å­ä¸­ä½¿ç”¨çš„æ˜¯â€first_cmakeâ€ã€‚<code>VERSION</code>å…³é”®å­—åé¢æ˜¯é¡¹ç›®çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥æ˜¯ä»»æ„æ ¼å¼çš„ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚â€1.0.0â€ã€‚<code>DESCRIPTION</code>å…³é”®å­—åé¢æ˜¯é¡¹ç›®çš„æè¿°ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚<code>LANGUAGES</code>å…³é”®å­—åé¢æ˜¯é¡¹ç›®æ‰€ä½¿ç”¨çš„è¯­è¨€ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯â€Cxxâ€ï¼Œè¡¨ç¤ºC++ã€‚</p>
<p>ç¤ºä¾‹ä¸­çš„<code>project</code>å‘½ä»¤ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">project</span>(first_cmake</span><br><span class="line">    VERSION <span class="number">1.0</span>.<span class="number">0</span></span><br><span class="line">    DESCRIPTION <span class="string">&quot;é¡¹ç›®æè¿°&quot;</span></span><br><span class="line">    LANGUAGES Cxx</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œé€šè¿‡<code>project</code>å‘½ä»¤ï¼Œå¯ä»¥åœ¨CMakeLists.txtä¸­æŒ‡å®šé¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ–¹ä¾¿ç®¡ç†å’Œæè¿°é¡¹ç›®ã€‚</p>
<h3 id="2-3-3-æ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶ç›®æ ‡"><a href="#2-3-3-æ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶ç›®æ ‡" class="headerlink" title="2.3.3 æ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶ç›®æ ‡"></a>2.3.3 æ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶ç›®æ ‡</h3><p>ä½¿ç”¨äº†<code>add_executable</code>å‘½ä»¤æ¥å®šä¹‰ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¯¥å‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(&lt;target_name&gt; &lt;source_files&gt;)</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>&lt;target_name&gt;</code>æ˜¯æœ€ç»ˆç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶åï¼Œä¹Ÿæ˜¯åœ¨CMakeä¸­å®šä¹‰çš„ç›®æ ‡ï¼ˆTargetï¼‰åã€‚<code>&lt;source_files&gt;</code>æ˜¯ç¼–è¯‘ç›®æ ‡æ‰€ä½¿ç”¨çš„æºæ–‡ä»¶ã€‚</p>
<p>åœ¨ä½ æä¾›çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨äº†<code>add_executable</code>å‘½ä»¤æ¥å®šä¹‰ä¸€ä¸ªåä¸º<code>first_cmake</code>çš„ç›®æ ‡ï¼Œå¹¶æŒ‡å®šäº†ä¸€ä¸ªæºæ–‡ä»¶<code>main.cpp</code>ã€‚è¿™æ„å‘³ç€åœ¨ç¼–è¯‘æ—¶ï¼Œä¼šå°†<code>main.cpp</code>ç¼–è¯‘ä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶çš„åç§°å°†æ˜¯<code>first_cmake</code>ã€‚</p>
<p>ç¤ºä¾‹ä¸­çš„<code>add_executable</code>å‘½ä»¤ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(first_cmake main.cpp)</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡<code>add_executable</code>å‘½ä»¤ï¼Œå¯ä»¥åœ¨CMakeLists.txtä¸­å®šä¹‰ç¼–è¯‘ç›®æ ‡ï¼Œå¹¶æŒ‡å®šç›¸åº”çš„æºæ–‡ä»¶ã€‚è¿™æ ·ï¼ŒCMakeå°†ä¼šæ ¹æ®è¿™äº›å®šä¹‰ç”Ÿæˆç›¸åº”çš„æ„å»ºè§„åˆ™å’Œç¼–è¯‘æŒ‡ä»¤ã€‚</p>
<h3 id="2-3-4-ç”Ÿæˆé™æ€åº“å¹¶é“¾æ¥"><a href="#2-3-4-ç”Ÿæˆé™æ€åº“å¹¶é“¾æ¥" class="headerlink" title="2.3.4 ç”Ÿæˆé™æ€åº“å¹¶é“¾æ¥"></a>2.3.4 ç”Ÿæˆé™æ€åº“å¹¶é“¾æ¥</h3><p>A. ç”Ÿæˆé™æ€åº“ï¼š</p>
<p>åœ¨<code>account_dir/CMakeLists.txt</code>ä¸­ï¼Œä½¿ç”¨<code>add_library</code>å‘½ä»¤æ¥ç”Ÿæˆé™æ€åº“ã€‚è¯¥å‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">add_library(&lt;library_name&gt; &lt;library_type&gt; &lt;source_files&gt;)</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>&lt;library_name&gt;</code>æ˜¯æœ€ç»ˆç”Ÿæˆçš„åº“æ–‡ä»¶åï¼Œä¾‹å¦‚åœ¨Linuxä¸‹ä¼šç”Ÿæˆ<code>libAccount.a</code>ã€‚</p>
<p><code>&lt;library_type&gt;</code>ç”¨äºæŒ‡å®šé“¾æ¥åº“çš„ç±»å‹ï¼Œå¯ä»¥æ˜¯åŠ¨æ€é“¾æ¥åº“ï¼ˆ<code>SHARED</code>ï¼‰æˆ–é™æ€é“¾æ¥åº“ï¼ˆ<code>STATIC</code>ï¼‰ã€‚</p>
<p><code>&lt;source_files&gt;</code>æ˜¯éœ€è¦ç”¨åˆ°çš„æºæ–‡ä»¶ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨<code>account_dir/CMakeLists.txt</code>ä¸­ï¼Œä½¿ç”¨<code>add_library</code>å‘½ä»¤ç”Ÿæˆä¸€ä¸ªåä¸º<code>Account</code>çš„é™æ€åº“ï¼Œå…¶åŒ…å«äº†<code>Account.cpp</code>å’Œ<code>Account.h</code>ä¸¤ä¸ªæºæ–‡ä»¶ã€‚ç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(Account STATIC Account.cpp Account.h)</span><br></pre></td></tr></table></figure>

<p>è¿™å°†ç”Ÿæˆä¸€ä¸ªé™æ€åº“æ–‡ä»¶<code>libAccount.a</code>ã€‚</p>
<p>B. é“¾æ¥ï¼š</p>
<p>åœ¨<code>test_account/CMakeLists.txt</code>ä¸­ï¼Œå¯ä»¥é€šè¿‡<code>target_link_libraries</code>å‘½ä»¤å°†ç”Ÿæˆçš„é™æ€åº“é“¾æ¥åˆ°ç›®æ ‡å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚è¯¥å‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(&lt;target_name&gt; &lt;library_name&gt;)</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>&lt;target_name&gt;</code>æ˜¯ç›®æ ‡å¯æ‰§è¡Œæ–‡ä»¶çš„åç§°ï¼Œ<code>&lt;library_name&gt;</code>æ˜¯è¦é“¾æ¥çš„åº“æ–‡ä»¶åã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨<code>test_account/CMakeLists.txt</code>ä¸­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªç›®æ ‡å¯æ‰§è¡Œæ–‡ä»¶åä¸º<code>test_account</code>ï¼Œéœ€è¦é“¾æ¥ç”Ÿæˆçš„é™æ€åº“<code>Account</code>ã€‚ç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(test_account Account)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶<code>test_account</code>å°†ä¼šé“¾æ¥é™æ€åº“<code>Account</code>ã€‚</p>
<h3 id="2-3-5-ç”ŸæˆåŠ¨æ€åº“å¹¶è¿æ¥"><a href="#2-3-5-ç”ŸæˆåŠ¨æ€åº“å¹¶è¿æ¥" class="headerlink" title="2.3.5 ç”ŸæˆåŠ¨æ€åº“å¹¶è¿æ¥"></a>2.3.5 ç”ŸæˆåŠ¨æ€åº“å¹¶è¿æ¥</h3><p>A. ç”ŸæˆåŠ¨æ€åº“ï¼š</p>
<p>åœ¨<code>account_dir/CMakeLists.txt</code>ä¸­ï¼Œä½¿ç”¨<code>add_library</code>å‘½ä»¤æ¥ç”ŸæˆåŠ¨æ€åº“ã€‚ä¸ç”Ÿæˆé™æ€åº“ä¸åŒçš„æ˜¯ï¼Œéœ€è¦å°†<code>&lt;library_type&gt;</code>å‚æ•°è®¾ç½®ä¸º<code>SHARED</code>ï¼Œè¡¨ç¤ºç”ŸæˆåŠ¨æ€é“¾æ¥åº“ã€‚</p>
<p>ç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(Account SHARED Account.cpp Account.h)</span><br></pre></td></tr></table></figure>

<p>è¿™å°†ç”Ÿæˆä¸€ä¸ªåŠ¨æ€åº“æ–‡ä»¶<code>libAccount.so</code>ã€‚</p>
<p>B. é“¾æ¥ï¼š</p>
<p>é“¾æ¥è¿‡ç¨‹ä¸ç”Ÿæˆé™æ€åº“æ—¶çš„æ“ä½œç›¸åŒï¼Œä½¿ç”¨<code>target_link_libraries</code>å‘½ä»¤å°†åŠ¨æ€åº“é“¾æ¥åˆ°ç›®æ ‡å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚</p>
<p>ç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(test_account Account)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶<code>test_account</code>å°†ä¼šé“¾æ¥åŠ¨æ€åº“<code>Account</code>ã€‚</p>
<h3 id="2-3-6-CMakeä¸­çš„PUBLICã€PRIVATEã€INTERFACE"><a href="#2-3-6-CMakeä¸­çš„PUBLICã€PRIVATEã€INTERFACE" class="headerlink" title="2.3.6 CMakeä¸­çš„PUBLICã€PRIVATEã€INTERFACE"></a>2.3.6 CMakeä¸­çš„PUBLICã€PRIVATEã€INTERFACE</h3><p>åœ¨CMakeä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>target_...()</code>ç³»åˆ—å‘½ä»¤æ¥æ“ä½œç›®æ ‡ï¼ˆTargetï¼‰ã€‚è¿™äº›å‘½ä»¤é€šå¸¸æ”¯æŒé€šè¿‡<code>PUBLIC</code>ã€<code>PRIVATE</code>ã€<code>INTERFACE</code>å…³é”®å­—æ¥æ§åˆ¶å±æ€§çš„ä¼ æ’­ã€‚</p>
<p>ä»¥<code>target_link_libraries(A B)</code>ä¸ºä¾‹ï¼Œä¸‹é¢æ˜¯å¯¹è¿™äº›å…³é”®å­—çš„ç†è§£ï¼š</p>
<ul>
<li><code>PRIVATE</code>ï¼šä¾èµ–é¡¹Bä»…é“¾æ¥åˆ°ç›®æ ‡Aã€‚å¦‚æœæœ‰ç›®æ ‡Cé“¾æ¥äº†ç›®æ ‡Aï¼Œç›®æ ‡Cä¸ä¼šé“¾æ¥ç›®æ ‡Bã€‚</li>
<li><code>INTERFACE</code>ï¼šä¾èµ–é¡¹Bå¹¶ä¸é“¾æ¥åˆ°ç›®æ ‡Aã€‚å¦‚æœæœ‰ç›®æ ‡Cé“¾æ¥äº†ç›®æ ‡Aï¼Œç›®æ ‡Cä¼šé“¾æ¥ç›®æ ‡Bã€‚</li>
<li><code>PUBLIC</code>ï¼šä¾èµ–é¡¹Bé“¾æ¥åˆ°ç›®æ ‡Aã€‚å¦‚æœæœ‰ç›®æ ‡Cé“¾æ¥äº†ç›®æ ‡Aï¼Œç›®æ ‡Cä¹Ÿä¼šé“¾æ¥ç›®æ ‡Bã€‚</li>
</ul>
<p>å¯ä»¥å°†å…¶ç±»æ¯”ä¸ºä¸€ä¸ªæ•£çƒŸçš„æ¯”æ–¹ï¼š</p>
<ul>
<li><code>PRIVATE</code>ï¼šå°±æ˜¯è‡ªå·±æŠ½çƒŸï¼Œä¸ç»™åˆ«äººæŠ½ã€‚</li>
<li><code>INTERFACE</code>ï¼šå°±æ˜¯è‡ªå·±ä¸æŠ½çƒŸï¼Œç»™åˆ«äººæŠ½ã€‚</li>
<li><code>PUBLIC</code>ï¼šå°±æ˜¯è‡ªå·±æŠ½çƒŸï¼Œä¹Ÿç»™åˆ«äººæŠ½ã€‚</li>
</ul>
<p>ä»ä½¿ç”¨çš„è§’åº¦æ¥çœ‹ï¼Œå‡è®¾æœ‰ç›®æ ‡Cé“¾æ¥äº†ç›®æ ‡Aï¼š</p>
<ul>
<li>å¦‚æœç›®æ ‡Bä»…ç”¨äºç›®æ ‡Açš„å®ç°ï¼Œå¹¶ä¸”ä¸åœ¨å¤´æ–‡ä»¶ä¸­æä¾›ç»™ç›®æ ‡Cä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨<code>PRIVATE</code>ã€‚</li>
<li>å¦‚æœç›®æ ‡Bä¸ç”¨äºç›®æ ‡Açš„å®ç°ï¼Œä»…åœ¨å¤´æ–‡ä»¶ä¸­ä½œä¸ºæ¥å£ç»™ç›®æ ‡Cä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨<code>INTERFACE</code>ã€‚</li>
<li>å¦‚æœç›®æ ‡Bæ—¢ç”¨äºç›®æ ‡Açš„å®ç°ï¼Œä¹Ÿåœ¨å¤´æ–‡ä»¶ä¸­æä¾›ç»™ç›®æ ‡Cä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨<code>PUBLIC</code>ã€‚</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºåº“</span></span><br><span class="line"><span class="keyword">add_library</span>(c c.cpp)</span><br><span class="line"><span class="keyword">add_library</span>(D d.cpp)</span><br><span class="line"><span class="keyword">add_library</span>(B b.cpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨target_link_librarieså‘½ä»¤è¿›è¡Œé“¾æ¥</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(A PRIVATE B)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(A INTERFACE C)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(A PUBLIC D)</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œç›®æ ‡<code>A</code>é€šè¿‡<code>target_link_libraries</code>å‘½ä»¤é“¾æ¥äº†ç›®æ ‡<code>B</code>ã€<code>C</code>å’Œ<code>D</code>ï¼Œä½¿ç”¨äº†ä¸åŒçš„ä¼ æ’­å±æ€§ã€‚å…·ä½“å±æ€§çš„é€‰æ‹©å–å†³äºç›®æ ‡ä¹‹é—´çš„å…³ç³»å’Œä½¿ç”¨éœ€æ±‚ã€‚</p>
<h3 id="2-3-7-å˜é‡"><a href="#2-3-7-å˜é‡" class="headerlink" title="2.3.7 å˜é‡"></a>2.3.7 å˜é‡</h3><p>åœ¨CMakeä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>message</code>å‘½ä»¤è¾“å‡ºæ¶ˆæ¯å¹¶è¿›è¡Œå˜é‡çš„æ“ä½œå’Œè®¾ç½®ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ç”¨æ³•ï¼š</p>
<p>1.è¾“å‡ºæ¶ˆæ¯ï¼šä½¿ç”¨<code>message</code>å‘½ä»¤å¯ä»¥è¾“å‡ºæ¶ˆæ¯åˆ°CMakeçš„è¾“å‡ºã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">message</span>(<span class="string">&quot;è¾“å‡ºæ¶ˆæ¯&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>2.æ¶ˆæ¯æ‹¼æ¥ï¼šä½¿ç”¨<code>message</code>å‘½ä»¤å¯ä»¥å°†å¤šä¸ªæ¶ˆæ¯è¿›è¡Œæ‹¼æ¥è¾“å‡ºã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">message</span>(<span class="string">&quot;è¾“å‡º1&quot;</span> <span class="string">&quot;è¾“å‡º2&quot;</span> <span class="string">&quot;è¾“å‡º3&quot;</span>)  <span class="comment"># ä¼šè¿›è¡Œæ‹¼æ¥è¾“å‡º</span></span><br></pre></td></tr></table></figure>

<p>3.è®¾ç½®å˜é‡ï¼šä½¿ç”¨<code>set</code>å‘½ä»¤å¯ä»¥è®¾ç½®å˜é‡çš„å€¼ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(VAR1 <span class="string">&quot;å˜é‡1&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;VAR1=&quot;</span> <span class="variable">$&#123;VAR1&#125;</span>)  <span class="comment"># å¤–éƒ¨è®¿é—®</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;è¾“å‡ºå˜é‡VAR1:$&#123;VAR1&#125;&quot;</span>)  <span class="comment"># å†…éƒ¨æ‹¼æ¥</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\$&#123;VAR1&#125;=$&#123;VAR1&#125;&quot;</span>)  <span class="comment"># ä½¿ç”¨\è½¬ä¹‰</span></span><br></pre></td></tr></table></figure>

<p>4.åˆ é™¤å˜é‡ï¼šä½¿ç”¨<code>unset</code>å‘½ä»¤å¯ä»¥åˆ é™¤å˜é‡ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unset</span>(VAR1)  <span class="comment"># åˆ é™¤å˜é‡</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;\$&#123;VAR1&#125;=$&#123;VAR1&#125;&quot;</span>)  <span class="comment"># åˆ é™¤å˜é‡åï¼Œè¾“å‡ºä¸ºç©º</span></span><br></pre></td></tr></table></figure>

<p>5.è®¾ç½®å˜é‡ç¼“å­˜ï¼šä½¿ç”¨<code>set</code>å‘½ä»¤çš„<code>CACHE</code>é€‰é¡¹å¯ä»¥è®¾ç½®ä¸€ä¸ªå˜é‡çš„ç¼“å­˜ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œçš„<code>-D</code>å‚æ•°æ¥ä¿®æ”¹è¯¥å˜é‡çš„å€¼ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(CACHE_VARIABLE_TEST <span class="string">&quot;åŸå§‹å€¼&quot;</span> CACHE <span class="keyword">STRING</span> <span class="string">&quot;å˜é‡ç¼“å­˜çš„æè¿°&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;å˜é‡ç¼“å­˜çš„å€¼:$&#123;CACHE_VARIABLE_TEST&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>6.å¸¸è§çš„å†…ç½®å˜é‡ï¼šCMakeæä¾›äº†ä¸€äº›å†…ç½®çš„å˜é‡ï¼Œç”¨äºè·å–æ„å»ºç³»ç»Ÿçš„ä¿¡æ¯å’Œé…ç½®</p>
<p>ç¬¬ä¸€ç±»: æä¾›ä¿¡æ¯çš„å˜é‡</p>
<ul>
<li><code>PROJECT_NAME</code>ï¼šé¡¹ç›®åç§°ï¼Œè¡¨ç¤ºå½“å‰CMakeé¡¹ç›®çš„åç§°ã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">message</span>(<span class="string">&quot;$&#123;PROJECT_NAME&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>CMAKE_SOURCE_DIR</code>ï¼šæºç ç›®å½•ï¼Œè¡¨ç¤ºå½“å‰CMakeé¡¹ç›®çš„æ ¹æºç ç›®å½•ã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">message</span>(<span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>CMAKE_BINARY_DIR</code>ï¼šç¼–è¯‘ç›®å½•ï¼Œè¡¨ç¤ºå½“å‰CMakeé¡¹ç›®çš„ç¼–è¯‘è¾“å‡ºç›®å½•ã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">message</span>(<span class="string">&quot;$&#123;CMAKE_BINARY_DIR&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>CMAKE_CURRENT_LIST_FILE</code>ï¼šå½“å‰CMakeLists.txtæ–‡ä»¶è·¯å¾„ï¼Œè¡¨ç¤ºå½“å‰æ­£åœ¨å¤„ç†çš„CMakeLists.txtæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">message</span>(<span class="string">&quot;$&#123;CMAKE_CURRENT_LIST_FILE&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™äº›å˜é‡æä¾›äº†ä¸é¡¹ç›®ã€ç›®å½•ç»“æ„å’Œæ–‡ä»¶ç›¸å…³çš„ä¿¡æ¯ã€‚</p>
<hr>
<p>ç¬¬äºŒç±»: æ§åˆ¶CMakeè¿è¡Œçš„å˜é‡</p>
<p>CMakeä¸­çš„å˜é‡é€šå¸¸æ˜¯æ ¹æ®æ„å»ºé€‰é¡¹è¿›è¡Œå‘½åçš„ï¼Œä¾‹å¦‚<code>BUILD_SHARED_LIBS</code>ã€‚è¿™äº›å˜é‡ç”¨äºæ§åˆ¶CMakeçš„è¿è¡Œå’Œæ„å»ºè¿‡ç¨‹ã€‚</p>
<hr>
<p>ç¬¬ä¸‰ç±»: æè¿°ç³»ç»Ÿçš„å˜é‡</p>
<ul>
<li><code>WIN32</code>ï¼šè¡¨ç¤ºå½“å‰æ“ä½œç³»ç»Ÿæ˜¯å¦ä¸ºWindowsã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">message</span>(<span class="string">&quot;æ˜¯å¦æ˜¯Windowsç³»ç»Ÿ: $&#123;WIN32&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>UNIX</code>ï¼šè¡¨ç¤ºå½“å‰æ“ä½œç³»ç»Ÿæ˜¯å¦ä¸ºç±»Unixï¼ˆåŒ…æ‹¬Linuxã€macOSç­‰ï¼‰ã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">message</span>(<span class="string">&quot;æ˜¯å¦æ˜¯Unixç³»ç»Ÿ: $&#123;UNIX&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>CMAKE_SYSTEM_NAME</code>ï¼šç³»ç»Ÿåç§°ï¼Œè¡¨ç¤ºå½“å‰æ“ä½œç³»ç»Ÿçš„åç§°ã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">message</span>(<span class="string">&quot;ç³»ç»Ÿåç§°: $&#123;CMAKE_SYSTEM_NAME&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™äº›å˜é‡ç”¨äºæè¿°å½“å‰æ“ä½œç³»ç»Ÿçš„ä¸€äº›ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨æ„å»ºè¿‡ç¨‹ä¸­è¿›è¡Œæ¡ä»¶åˆ¤æ–­å’Œé…ç½®ã€‚</p>
<h3 id="2-3-8-includeå¼•å…¥å…¶ä»–ä»£ç "><a href="#2-3-8-includeå¼•å…¥å…¶ä»–ä»£ç " class="headerlink" title="2.3.8 includeå¼•å…¥å…¶ä»–ä»£ç "></a>2.3.8 includeå¼•å…¥å…¶ä»–ä»£ç </h3><h3 id="2-3-9-æ¡ä»¶æ§åˆ¶"><a href="#2-3-9-æ¡ä»¶æ§åˆ¶" class="headerlink" title="2.3.9 æ¡ä»¶æ§åˆ¶"></a>2.3.9 æ¡ä»¶æ§åˆ¶</h3><p>CMakeæä¾›äº†æ¡ä»¶æ§åˆ¶çš„è¯­æ³•å’Œå…³é”®è¯ï¼Œä½¿å¾—ä½ å¯ä»¥æ ¹æ®æ¡ä»¶æ¥æ§åˆ¶æ„å»ºè¿‡ç¨‹ä¸­çš„è¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ¡ä»¶æ§åˆ¶å…³é”®è¯å’Œè¯­æ³•ï¼š</p>
<ul>
<li><code>if (variable)</code>ï¼šå½“å˜é‡çš„å€¼ä¸ºçœŸæ—¶ï¼Œæ‰§è¡Œç›¸åº”çš„ä»£ç å—ã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (MY_VARIABLE)</span><br><span class="line">    <span class="comment"># å½“MY_VARIABLEä¸ºçœŸæ—¶æ‰§è¡Œçš„ä»£ç å—</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<ul>
<li><code>else()</code>ï¼šåœ¨ifæ¡ä»¶ä¸ºå‡æ—¶æ‰§è¡Œçš„ä»£ç å—ã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (MY_VARIABLE)</span><br><span class="line">    <span class="comment"># å½“MY_VARIABLEä¸ºçœŸæ—¶æ‰§è¡Œçš„ä»£ç å—</span></span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">    <span class="comment"># å½“MY_VARIABLEä¸ºå‡æ—¶æ‰§è¡Œçš„ä»£ç å—</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<ul>
<li>çœŸå€¼å¸¸é‡ï¼š<code>ON</code>ã€<code>YES</code>ã€<code>TRUE</code>ã€<code>Y</code>ã€<code>1</code>ã€éé›¶æ•°å­—ç­‰ã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (MY_VARIABLE <span class="keyword">STREQUAL</span> <span class="string">&quot;ON&quot;</span>)</span><br><span class="line">    <span class="comment"># å½“MY_VARIABLEçš„å€¼ä¸ºçœŸæ—¶æ‰§è¡Œçš„ä»£ç å—</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<ul>
<li>å‡å€¼å¸¸é‡ï¼š<code>OFF</code>ã€<code>NO</code>ã€<code>FALSE</code>ã€<code>N</code>ã€<code>0</code>ã€ç©ºå­—ç¬¦ä¸²ã€<code>NOTFOUND</code>ç­‰ã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (MY_VARIABLE <span class="keyword">STREQUAL</span> <span class="string">&quot;OFF&quot;</span>)</span><br><span class="line">    <span class="comment"># å½“MY_VARIABLEçš„å€¼ä¸ºå‡æ—¶æ‰§è¡Œçš„ä»£ç å—</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<ul>
<li>å…³é”®è¯ï¼š<code>NOT</code>ã€<code>TARGET</code>ã€<code>EXISTS (file)</code>ã€<code>DEFINED</code>ç­‰ï¼Œå¯ä»¥ä¸æ¡ä»¶ä¸€èµ·ä½¿ç”¨ã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">NOT</span> <span class="keyword">TARGET</span> MyTarget)</span><br><span class="line">    <span class="comment"># å½“MyTargetä¸å­˜åœ¨æ—¶æ‰§è¡Œçš„ä»£ç å—</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<ul>
<li>é€»è¾‘è¿ç®—ç¬¦ï¼š<code>AND</code>ã€<code>OR</code>ç”¨äºç»„åˆå¤šä¸ªæ¡ä»¶ã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (CONDITION1 <span class="keyword">AND</span> CONDITION2)</span><br><span class="line">    <span class="comment"># å½“CONDITION1å’ŒCONDITION2åŒæ—¶ä¸ºçœŸæ—¶æ‰§è¡Œçš„ä»£ç å—</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (CONDITION1 <span class="keyword">OR</span> CONDITION2)</span><br><span class="line">    <span class="comment"># å½“CONDITION1æˆ–CONDITION2è‡³å°‘ä¸€ä¸ªä¸ºçœŸæ—¶æ‰§è¡Œçš„ä»£ç å—</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<ul>
<li><code>MATCHES (regular expression)</code>ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (MY_VARIABLE <span class="keyword">MATCHES</span> <span class="string">&quot;^prefix.*&quot;</span>)</span><br><span class="line">    <span class="comment"># å½“MY_VARIABLEä»¥&quot;prefix&quot;å¼€å¤´æ—¶æ‰§è¡Œçš„ä»£ç å—</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<ul>
<li><code>VERSION LESS</code>ã€<code>VERSION LESS_EQUAL</code>ï¼šç”¨äºæ¯”è¾ƒç‰ˆæœ¬å·ã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (MY_VERSION VERSION <span class="keyword">LESS</span> <span class="number">2.0</span>)</span><br><span class="line">    <span class="comment"># å½“MY_VERSIONå°äº2.0æ—¶æ‰§è¡Œçš„ä»£ç å—</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¿™äº›æ¡ä»¶æ§åˆ¶å…³é”®è¯å’Œè¯­æ³•ï¼Œä½ å¯ä»¥æ ¹æ®ä¸åŒçš„æ¡ä»¶æ¥æ‰§è¡Œä¸åŒçš„ä»£ç å—ï¼Œä»è€Œå®ç°æ›´çµæ´»å’Œå¯é…ç½®çš„æ„å»ºè¿‡ç¨‹ã€‚ä½ å¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚é€‰æ‹©é€‚å½“çš„æ¡ä»¶æ§åˆ¶æ–¹å¼ï¼Œå¹¶ç»“åˆå˜é‡ã€å…³é”®è¯å’Œè¿ç®—ç¬¦æ¥ç¼–å†™CMakeè„šæœ¬ã€‚</p>
<h3 id="2-3-10-CMakeåˆ†æ­¥ç¼–è¯‘"><a href="#2-3-10-CMakeåˆ†æ­¥ç¼–è¯‘" class="headerlink" title="2.3.10 CMakeåˆ†æ­¥ç¼–è¯‘"></a>2.3.10 CMakeåˆ†æ­¥ç¼–è¯‘</h3><p>é¦–å…ˆï¼Œä½ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰çš„ç›®æ ‡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake --build . --target help</span><br></pre></td></tr></table></figure>

<p>è¿™å°†åˆ—å‡ºé¡¹ç›®ä¸­å¯ç”¨çš„ç›®æ ‡åˆ—è¡¨ï¼ŒåŒ…æ‹¬é»˜è®¤ç›®æ ‡â€allâ€ã€â€cleanâ€ã€â€dependâ€ã€â€rebuild_cacheâ€ã€â€edit_cacheâ€ä»¥åŠå…¶ä»–ä¸€äº›ç›®æ ‡ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œä½ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œé¢„å¤„ç†ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake --build . --target main.i</span><br></pre></td></tr></table></figure>

<p>è¿™å°†å¯¹â€main.cppâ€æºæ–‡ä»¶è¿›è¡Œé¢„å¤„ç†ï¼Œå¹¶å°†é¢„å¤„ç†ç»“æœä¿å­˜åœ¨â€CMakeFiles&#x2F;steps_demo.dir&#x2F;main.cpp.iâ€æ–‡ä»¶ä¸­ã€‚</p>
<p>ç„¶åï¼Œä½ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake --build . --target main.sI</span><br></pre></td></tr></table></figure>

<p>è¿™å°†å°†â€main.cppâ€æºæ–‡ä»¶ç¼–è¯‘ä¸ºæ±‡ç¼–ä»£ç ï¼Œå¹¶å°†æ±‡ç¼–ä»£ç ä¿å­˜åœ¨â€CMakeFiles&#x2F;steps_demo.dir&#x2F;main.cpp.sâ€æ–‡ä»¶ä¸­ã€‚</p>
<p>æ¥ç€ï¼Œä½ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ±‡ç¼–ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake --build . --target main.o</span><br></pre></td></tr></table></figure>

<p>è¿™å°†å°†æ±‡ç¼–ä»£ç ç¼–è¯‘ä¸ºç›®æ ‡æ–‡ä»¶ï¼Œå¹¶å°†ç›®æ ‡æ–‡ä»¶ä¿å­˜ä¸ºâ€CMakeFiles&#x2F;steps_demo.dir&#x2F;main.cpp.oâ€ã€‚</p>
<p>æœ€åï¼Œä½ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œé“¾æ¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake --build .</span><br></pre></td></tr></table></figure>

<p>è¿™å°†æ‰«æä¾èµ–é¡¹å¹¶é“¾æ¥ç”Ÿæˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶â€steps_demoâ€ã€‚</p>
<p>æœ€åï¼Œä½ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./steps_demo</span><br></pre></td></tr></table></figure>

<p>è¿™å°†è¿è¡Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<h3 id="2-3-11-ç”Ÿæˆå™¨è¡¨è¾¾å¼"><a href="#2-3-11-ç”Ÿæˆå™¨è¡¨è¾¾å¼" class="headerlink" title="2.3.11 ç”Ÿæˆå™¨è¡¨è¾¾å¼"></a>2.3.11 ç”Ÿæˆå™¨è¡¨è¾¾å¼</h3><p>ç”Ÿæˆå™¨è¡¨è¾¾å¼æ˜¯CMakeä¸­ä¸€ç§ç”¨äºåœ¨ç”Ÿæˆæ„å»ºç³»ç»Ÿæ—¶æ ¹æ®ä¸åŒé…ç½®åŠ¨æ€ç”Ÿæˆç‰¹å®šå†…å®¹çš„è¡¨è¾¾å¼ã€‚å®ƒå¯ä»¥è®©ä»£ç æ›´åŠ ç²¾ç®€å’Œçµæ´»ã€‚ä¸‹é¢æ˜¯å‡ ç§å¸¸ç”¨çš„ç”Ÿæˆå™¨è¡¨è¾¾å¼ç±»å‹ï¼š</p>
<p>æ¡ä»¶è¡¨è¾¾å¼ï¼š<code>$&lt;condition:true_string&gt;</code>ã€‚å½“æ¡ä»¶ä¸ºçœŸæ—¶ï¼Œè¿”å›<code>true_string</code>ï¼Œå¦åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">$&lt;<span class="number">0</span>:<span class="keyword">TEST</span>&gt;           <span class="comment"># è¿”å›ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">$&lt;<span class="number">1</span>:<span class="keyword">TEST</span>&gt;           <span class="comment"># è¿”å›&quot;TEST&quot;</span></span><br><span class="line">$&lt;$&lt;BOOL:<span class="keyword">TRUE</span>&gt;:<span class="keyword">TEST</span>&gt;  <span class="comment"># è¿”å›&quot;TEST&quot;</span></span><br></pre></td></tr></table></figure>

<p>å˜é‡æŸ¥è¯¢ï¼ˆVariable-Queryï¼‰ï¼šé€šè¿‡æŸ¥è¯¢å˜é‡æ¥è·å–åŠ¨æ€çš„å€¼ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">$&lt;TARGET_EXISTS:<span class="keyword">target</span>&gt;             <span class="comment"># åˆ¤æ–­ç›®æ ‡æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">$&lt;CONFIG:Debug&gt;                     <span class="comment"># åˆ¤æ–­å½“å‰æ„å»ºç±»å‹æ˜¯å¦ä¸ºDebug</span></span><br></pre></td></tr></table></figure>

<p>ç›®æ ‡æŸ¥è¯¢ï¼ˆTarget-Queryï¼‰ï¼šé€šè¿‡æŸ¥è¯¢ç›®æ ‡æ¥è·å–ç›¸å…³çš„ä¿¡æ¯ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">$&lt;TARGET_FILE:<span class="keyword">target</span>&gt;               <span class="comment"># è·å–ç›®æ ‡çš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">$&lt;TARGET_FILE_NAME:<span class="keyword">target</span>&gt;          <span class="comment"># è·å–ç›®æ ‡çš„æ–‡ä»¶å</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç›¸å…³è¡¨è¾¾å¼ï¼šç”¨äºåœ¨ä¸åŒçš„æ„å»ºç¯èŠ‚ä½¿ç”¨ä¸åŒçš„å‚æ•°ã€‚æ¯”å¦‚ï¼Œåœ¨<code>install</code>å’Œ<code>build</code>é˜¶æ®µä½¿ç”¨ä¸åŒçš„å‚æ•°ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(Foo ...)</span><br><span class="line"><span class="keyword">target_include_directories</span>(Foo</span><br><span class="line">    PUBLIC</span><br><span class="line">        $&lt;$&lt;CONFIG:Debug&gt;:<span class="variable">$&#123;DEBUG_INCLUDES&#125;</span>&gt;</span><br><span class="line">        $&lt;$&lt;CONFIG:Release&gt;:<span class="variable">$&#123;RELEASE_INCLUDES&#125;</span>&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæ ¹æ®ä¸åŒçš„æ„å»ºé…ç½®ï¼ˆDebugæˆ–Releaseï¼‰ï¼Œç”Ÿæˆå™¨è¡¨è¾¾å¼é€‰æ‹©æ€§åœ°åŒ…å«ä¸åŒçš„å¤´æ–‡ä»¶è·¯å¾„ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”Ÿæˆå™¨è¡¨è¾¾å¼åœ¨ç”Ÿæˆæ„å»ºç³»ç»Ÿæ—¶è¢«å±•å¼€ï¼Œå› æ­¤æ— æ³•é€šè¿‡<code>message</code>å‘½ä»¤ç›´æ¥æ‰“å°ã€‚ä½ å¯ä»¥ä½¿ç”¨ç±»ä¼¼<code>file(GENERATE OUTPUT &quot;./generator_test.txt&quot; CONTENT &quot;$&lt;$&lt;BOOL:TRUE&gt;:TEST&gt;&quot;)</code>çš„æ–¹å¼å°†ç”Ÿæˆå™¨è¡¨è¾¾å¼çš„ç»“æœå†™å…¥æ–‡ä»¶ï¼Œä»¥é—´æ¥æµ‹è¯•ç”Ÿæˆå™¨è¡¨è¾¾å¼çš„å€¼ã€‚</p>
<h3 id="2-3-12-å‡½æ•°å’Œå®"><a href="#2-3-12-å‡½æ•°å’Œå®" class="headerlink" title="2.3.12 å‡½æ•°å’Œå®"></a>2.3.12 å‡½æ•°å’Œå®</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªå®</span></span><br><span class="line"><span class="keyword">macro</span>(my_macro)</span><br><span class="line">    <span class="keyword">message</span>(<span class="string">&quot;å®å†…éƒ¨çš„ä¿¡æ¯&quot;</span>)</span><br><span class="line">    <span class="keyword">set</span>(macro_var <span class="string">&quot;å®å†…éƒ¨å˜é‡test&quot;</span>)</span><br><span class="line"><span class="keyword">endmacro</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span>(second_func arg1 arg2)</span><br><span class="line">    <span class="keyword">message</span>(<span class="string">&quot;ç¬¬ä¸€ä¸ªå‚æ•°: $&#123;arg1&#125;ï¼Œç¬¬äºŒä¸ªå‚æ•°: $&#123;arg2&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>my_macro</code>æ˜¯ä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„å®ï¼Œå®ƒåœ¨å®å†…éƒ¨è¾“å‡ºä¸€æ¡ä¿¡æ¯ï¼Œå¹¶è®¾ç½®äº†ä¸€ä¸ªå˜é‡<code>macro_var</code>çš„å€¼ã€‚</p>
<p><code>second_func</code>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæœ‰ä¸¤ä¸ªå‚æ•°<code>arg1</code>å’Œ<code>arg2</code>ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œå®ƒè¾“å‡ºäº†ä¸¤ä¸ªå‚æ•°çš„å€¼ã€‚</p>
<p>ä½ å¯ä»¥åœ¨CMakeLists.txtæ–‡ä»¶ä¸­ä½¿ç”¨è¿™äº›å®å’Œå‡½æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è°ƒç”¨å®</span></span><br><span class="line">my_macro()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨å‡½æ•°</span></span><br><span class="line">second_func(<span class="string">&quot;Hello&quot;</span> <span class="string">&quot;World&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>å½“ä½ è¿è¡ŒCMakeç”Ÿæˆæ„å»ºç³»ç»Ÿæ—¶ï¼Œä½ å°†çœ‹åˆ°å®å†…éƒ¨çš„ä¿¡æ¯è¾“å‡ºï¼Œå¹¶ä¸”å¯ä»¥è®¿é—®åœ¨å®æˆ–å‡½æ•°å†…éƒ¨å®šä¹‰çš„å˜é‡ã€‚å‡½æ•°å°†è¾“å‡ºå‚æ•°çš„å€¼ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œå®å’Œå‡½æ•°çš„å®šä¹‰éœ€è¦åœ¨CMakeLists.txtæ–‡ä»¶çš„é€‚å½“ä½ç½®è¿›è¡Œï¼Œå¹¶ä¸”åœ¨è°ƒç”¨å®ƒä»¬ä¹‹å‰å¿…é¡»å…ˆå®šä¹‰å®ƒä»¬ã€‚</p>
<h3 id="2-3-13-è®¾ç½®å®‰è£…"><a href="#2-3-13-è®¾ç½®å®‰è£…" class="headerlink" title="2.3.13 è®¾ç½®å®‰è£…"></a>2.3.13 è®¾ç½®å®‰è£…</h3><p><code>install</code>å‘½ä»¤ç”¨äºè®¾ç½®å®‰è£…è§„åˆ™ï¼Œå°†ç›®æ ‡æ–‡ä»¶å’Œæ–‡ä»¶å¤¹å®‰è£…åˆ°æŒ‡å®šçš„ä½ç½®ã€‚ä¸‹é¢æ˜¯ä½ æä¾›çš„ä»£ç çš„è§£é‡Šï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(TARGETS instal_demo slib dlib</span><br><span class="line">    RUNTIME DESTINATION bin     <span class="comment"># å¯æ‰§è¡Œæ–‡ä»¶å®‰è£…è·¯å¾„</span></span><br><span class="line">    LIBRARY DESTINATION lib     <span class="comment"># åŠ¨æ€åº“å®‰è£…è·¯å¾„</span></span><br><span class="line">    ARCHIVE DESTINATION lib     <span class="comment"># é™æ€åº“å®‰è£…è·¯å¾„</span></span><br><span class="line">    PUBLIC_HEADER DESTINATION <span class="keyword">include</span>   <span class="comment"># å…¬å…±å¤´æ–‡ä»¶å®‰è£…è·¯å¾„</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>install</code>å‘½ä»¤æŒ‡å®šäº†è¦å®‰è£…çš„ç›®æ ‡æ–‡ä»¶åˆ—è¡¨ï¼Œå…¶ä¸­åŒ…æ‹¬<code>instal_demo</code>ã€<code>slib</code>å’Œ<code>dlib</code>ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡æŒ‡å®šä¸åŒçš„<code>DESTINATION</code>å‚æ•°ï¼Œå®šä¹‰äº†ç›®æ ‡æ–‡ä»¶åœ¨å®‰è£…è¿‡ç¨‹ä¸­çš„å®‰è£…è·¯å¾„ï¼š</p>
<ul>
<li><code>RUNTIME DESTINATION bin</code>ï¼šæŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶çš„å®‰è£…è·¯å¾„ä¸º<code>bin</code>ç›®å½•ã€‚</li>
<li><code>LIBRARY DESTINATION lib</code>ï¼šæŒ‡å®šåŠ¨æ€åº“çš„å®‰è£…è·¯å¾„ä¸º<code>lib</code>ç›®å½•ã€‚</li>
<li><code>ARCHIVE DESTINATION lib</code>ï¼šæŒ‡å®šé™æ€åº“çš„å®‰è£…è·¯å¾„ä¸º<code>lib</code>ç›®å½•ã€‚</li>
<li><code>PUBLIC_HEADER DESTINATION include</code>ï¼šæŒ‡å®šå…¬å…±å¤´æ–‡ä»¶çš„å®‰è£…è·¯å¾„ä¸º<code>include</code>ç›®å½•ã€‚</li>
</ul>
<p>æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œè¿™äº›ç›®æ ‡æ–‡ä»¶å°†è¢«å®‰è£…åˆ°æŒ‡å®šçš„ç›®å½•ä¸­ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œå®‰è£…è·¯å¾„æ˜¯ç›¸å¯¹äºå®‰è£…ç›®å½•çš„ï¼Œå› æ­¤ä½ éœ€è¦ç¡®ä¿å®‰è£…ç›®å½•åœ¨è¿è¡Œ<code>make install</code>æ—¶æ­£ç¡®è®¾ç½®ã€‚</p>
<p>è¦è§£å†³åœ¨å®‰è£…åæ— æ³•æ‰¾åˆ°åŠ¨æ€åº“çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨<code>set(CMAKE_BUILD_WITH_INSTALL_RPATH TRUE)</code>å’Œ<code>set(CMAKE_INSTALL_RPATH &quot;$&#123;CMAKE_INSTALL_PREFIX&#125;/lib&quot;)</code>æ¥è®¾ç½®RPATHã€‚</p>
<p>ä¸‹é¢æ˜¯ç›¸åº”çš„ä»£ç ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_BUILD_WITH_INSTALL_RPATH <span class="keyword">TRUE</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_INSTALL_RPATH <span class="string">&quot;$&#123;CMAKE_INSTALL_PREFIX&#125;/lib&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><code>set(CMAKE_BUILD_WITH_INSTALL_RPATH TRUE)</code>æŒ‡ç¤ºåœ¨æ„å»ºè¿‡ç¨‹ä¸­ä½¿ç”¨ä¸å®‰è£…RPATHç›¸åŒçš„RPATHã€‚è¿™æ ·ï¼Œåœ¨æ„å»ºæ—¶å°±å¯ä»¥æ­£ç¡®åœ°æŸ¥æ‰¾å’Œé“¾æ¥åŠ¨æ€åº“ã€‚</p>
<p><code>set(CMAKE_INSTALL_RPATH &quot;$&#123;CMAKE_INSTALL_PREFIX&#125;/lib&quot;)</code>å°†å®‰è£…RPATHè®¾ç½®ä¸º<code>$&#123;CMAKE_INSTALL_PREFIX&#125;/lib</code>ï¼Œå…¶ä¸­<code>$&#123;CMAKE_INSTALL_PREFIX&#125;</code>æ˜¯å®‰è£…ç›®å½•çš„è·¯å¾„ã€‚è¿™å°†å¯¼è‡´åœ¨å®‰è£…æ—¶è®¾ç½®RPATHï¼Œä½¿å¾—å®‰è£…åçš„å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥åœ¨<code>$&#123;CMAKE_INSTALL_PREFIX&#125;/lib</code>ç›®å½•ä¸­æ­£ç¡®åœ°æŸ¥æ‰¾å’ŒåŠ è½½åŠ¨æ€åº“ã€‚</p>
<p>é€šè¿‡ä½¿ç”¨è¿™ä¸¤ä¸ªè®¾ç½®ï¼Œä½ å¯ä»¥è§£å†³åœ¨å®‰è£…åæ— æ³•æ‰¾åˆ°åŠ¨æ€åº“çš„é—®é¢˜ã€‚ç¡®ä¿å°†å…¶æ”¾ç½®åœ¨CMakeLists.txtæ–‡ä»¶ä¸­çš„åˆé€‚ä½ç½®ï¼Œå¹¶æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´<code>$&#123;CMAKE_INSTALL_PREFIX&#125;/lib</code>è·¯å¾„ï¼Œä»¥åŒ¹é…ä½ çš„å®‰è£…ç›®å½•ç»“æ„ã€‚</p>
<h3 id="2-3-14-å¯»æ‰¾ä¾èµ–find-package"><a href="#2-3-14-å¯»æ‰¾ä¾èµ–find-package" class="headerlink" title="2.3.14 å¯»æ‰¾ä¾èµ–find_package"></a>2.3.14 å¯»æ‰¾ä¾èµ–find_package</h3><p>å¯¹äºå¤§å¤šæ•°æ”¯æŒCMakeçš„é¡¹ç›®æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨<code>find_package</code>å‘½ä»¤æ¥æŸ¥æ‰¾å¯¹åº”çš„ä¾èµ–åº“ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæ‰¾åˆ°äº†åº“ï¼Œä¼šè®¾ç½®ä»¥ä¸‹å˜é‡ï¼ˆè¿™äº›å˜é‡ç”±åº“çš„ä½œè€…è®¾ç½®ï¼‰ï¼š</p>
<ul>
<li><code>&lt;LibaryName&gt;_FOUND</code>ï¼šè¡¨ç¤ºæ˜¯å¦æ‰¾åˆ°åº“ã€‚</li>
<li><code>&lt;LibaryName&gt;_INCLUDE_DIR</code>ï¼šè¡¨ç¤ºåº“çš„å¤´æ–‡ä»¶ç›®å½•ã€‚</li>
<li><code>&lt;LibaryName&gt;_LIBRARIES</code>ï¼šè¡¨ç¤ºåº“çš„åº“æ–‡ä»¶ç›®å½•ã€‚</li>
</ul>
<p>å¦‚æœä½ ç¼–å†™äº†ä¸€ä¸ªæ–°çš„å‡½æ•°åº“ï¼Œå¹¶å¸Œæœ›å…¶ä»–é¡¹ç›®å¯ä»¥é€šè¿‡<code>find_package</code>å¼•ç”¨å®ƒï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</p>
<ol>
<li><p>ç¼–å†™ä¸€ä¸ª<code>Find&lt;LibraryName&gt;.cmake</code>æ–‡ä»¶ï¼šé€‚ç”¨äºå¯¼å…¥éCMakeå®‰è£…çš„é¡¹ç›®ã€‚</p>
<p>ä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªåä¸º<code>Find&lt;LibraryName&gt;.cmake</code>çš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶æ”¾ç½®åœ¨CMakeçš„<code>Modules</code>ç›®å½•æˆ–é¡¹ç›®çš„ç‰¹å®šç›®å½•ä¸­ã€‚è¯¥æ–‡ä»¶åº”åŒ…å«æŸ¥æ‰¾å’Œè®¾ç½®ç›¸å…³å˜é‡çš„é€»è¾‘ã€‚å…¶ä»–é¡¹ç›®å¯ä»¥é€šè¿‡<code>find_package</code>å‘½ä»¤æ¥å¼•ç”¨è¿™ä¸ªè‡ªå®šä¹‰çš„æŸ¥æ‰¾æ–‡ä»¶ï¼Œä»è€Œæ‰¾åˆ°å¹¶ä½¿ç”¨ä½ çš„åº“ã€‚</p>
<p>é™„ä»¶: 15.custom_find</p>
</li>
<li><p>ä½¿ç”¨<code>install</code>å®‰è£…å¹¶ç”Ÿæˆ<code>&lt;LibraryName&gt;Config.cmake</code>æ–‡ä»¶ï¼šé€‚ç”¨äºå¯¼å…¥ä½ è‡ªå·±å¼€å‘çš„CMakeé¡¹ç›®ã€‚</p>
<p>åœ¨ä½ çš„åº“é¡¹ç›®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>install</code>å‘½ä»¤å°†åº“æ–‡ä»¶å®‰è£…åˆ°æŒ‡å®šä½ç½®ï¼Œå¹¶ç”Ÿæˆ<code>&lt;LibraryName&gt;Config.cmake</code>æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åº”åŒ…å«è®¾ç½®å˜é‡å’Œå¯¼å‡ºç›®æ ‡çš„é€»è¾‘ã€‚å…¶ä»–é¡¹ç›®å¯ä»¥é€šè¿‡<code>find_package</code>å‘½ä»¤æ‰¾åˆ°å¹¶ä½¿ç”¨ä½ çš„åº“ã€‚</p>
</li>
</ol>
<p>&#x3D;&#x3D;ç°åœ¨åªæ˜¯ç®€å•çš„å†™äº†ä¸€ä¸‹å­¦ä¹ çš„å†…å®¹ï¼Œä½†æ˜¯å¯¹äºå¾ˆå¤šå†…å®¹è¿˜å¹¶ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä¸€åˆ‡éƒ½è¦ç­‰åˆ°æœ€åå®æˆ˜çš„æ—¶å€™&#x3D;&#x3D;</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
  </entry>
  <entry>
    <title>windowsæ­å»ºhexo</title>
    <url>/2023/09/03/0%20windows%E6%90%AD%E5%BB%BAhexo/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Hexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚Hexo ä½¿ç”¨ [Markdown]Daring Fireball: Markdown )ï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚</p>
<p>Hexo å®˜æ–¹ä¸­æ–‡ç½‘ç«™: Hexo</p>
<h1 id="ç¬¬ä¸€ç« -å‰æœŸå‡†å¤‡"><a href="#ç¬¬ä¸€ç« -å‰æœŸå‡†å¤‡" class="headerlink" title="ç¬¬ä¸€ç«  å‰æœŸå‡†å¤‡"></a>ç¬¬ä¸€ç«  å‰æœŸå‡†å¤‡</h1><h2 id="1-1-å®‰è£…å‰æ‰€éœ€ç¯å¢ƒä»‹ç»"><a href="#1-1-å®‰è£…å‰æ‰€éœ€ç¯å¢ƒä»‹ç»" class="headerlink" title="1.1 å®‰è£…å‰æ‰€éœ€ç¯å¢ƒä»‹ç»"></a>1.1 å®‰è£…å‰æ‰€éœ€ç¯å¢ƒä»‹ç»</h2><p>å®‰è£… Hexo ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿æ‚¨çš„ PC ä¸­å·²ç»å®‰è£…ä»¥ä¸‹å·¥å…·:</p>
<p>Node.js           <a href="https://nodejs.org/en">https://nodejs.org/en</a><br>        Git    <a href="https://git-scm.com/">https://git-scm.com/</a><br>å¦‚æœæ‚¨çš„ç”µè„‘å·²ç»å…·å¤‡æ‰€éœ€å·¥å…·ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ç›´æ¥è¿›å…¥ç¬¬äºŒç« å¼€å§‹å®‰è£… Hexo äº†ã€‚</p>
<p>å¦‚æœæ‚¨è¿˜æœªå®‰è£…è¿™ä¸¤æ¬¾å·¥å…·ï¼Œé‚£ä¹ˆè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œå®‰è£…ã€‚</p>
<h2 id="1-2-å®‰è£…-Git"><a href="#1-2-å®‰è£…-Git" class="headerlink" title="1.2 å®‰è£… Git"></a>1.2 å®‰è£… Git</h2><p>å®˜æ–¹ä¸‹è½½åœ°å€: <a href="https://git-scm.com/">https://git-scm.com/</a><br>æ³¨æ„äº‹é¡¹: å»ºè®®é€‰æ‹© 64-bit Git for Windows Setupï¼Œå¹¶ä¸”å®‰è£…æ—¶è¦å‹¾é€‰ Add to PATH é€‰é¡¹</p>
<p>win + R åœ¨å‘½ä»¤è¡Œè¾“å…¥cmdè¿›å…¥ç»ˆç«¯æ¨¡å¼ï¼Œè¾“å…¥ä¸‹é¢æŒ‡ä»¤ï¼Œå½“æ˜¾ç¤ºç‰ˆæœ¬åˆ™å®‰è£…æˆåŠŸ<br>git -v</p>
<h2 id="1-3-å®‰è£…-Node-js"><a href="#1-3-å®‰è£…-Node-js" class="headerlink" title="1.3 å®‰è£… Node.js"></a>1.3 å®‰è£… Node.js</h2><p>å®˜æ–¹ä¸‹è½½åœ°å€:  <a href="https://nodejs.org/en">https://nodejs.org/en</a><br>æ³¨æ„äº‹é¡¹: ä½¿ç”¨ Node.js å®˜æ–¹å®‰è£…ç¨‹åºæ—¶ï¼Œè¯·ç¡®ä¿å‹¾é€‰ Add to PATH é€‰é¡¹ï¼ˆé»˜è®¤å·²å‹¾é€‰ï¼‰</p>
<p>win + R åœ¨å‘½ä»¤è¡Œè¾“å…¥cmdè¿›å…¥ç»ˆç«¯æ¨¡å¼ï¼Œè¾“å…¥ä¸‹é¢æŒ‡ä»¤ï¼Œå½“æ˜¾ç¤ºç‰ˆæœ¬åˆ™å®‰è£…æˆåŠŸ<br>node â€“version</p>
<p>è‡³æ­¤ï¼Œæ‚¨å·²ç»å®Œæˆäº†å®‰è£… Hexo æ‰€éœ€çš„æ‰€æœ‰é¢å¤–ç¯å¢ƒï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å®‰è£… Hexo äº†ã€‚</p>
<h1 id="ç¬¬äºŒç« -å®‰è£…-Hexo"><a href="#ç¬¬äºŒç« -å®‰è£…-Hexo" class="headerlink" title="ç¬¬äºŒç«  å®‰è£… Hexo"></a>ç¬¬äºŒç«  å®‰è£… Hexo</h1><h2 id="2-1-å®‰è£…-cnpm"><a href="#2-1-å®‰è£…-cnpm" class="headerlink" title="2.1 å®‰è£… cnpm"></a>2.1 å®‰è£… cnpm</h2><p>å½“æ‚¨å®‰è£… Node.js ä¹‹åï¼Œä¾¿å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­é€šè¿‡ node install å‘½ä»¤å®‰è£…æ‚¨æƒ³è¦çš„ç¨‹åºäº†ã€‚ä½†æœ¬æ–‡æ¨èä½¿ç”¨ cnpm å®‰è£… Hexoï¼Œæ‰€ä»¥éœ€è¦å…ˆé€šè¿‡ npm install å®‰è£… cnpmã€‚</p>
<p>å‘½ä»¤:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install -g cnpm --registry==https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>


<p>è¯´æ˜: -g è¡¨ç¤ºè¿›è¡Œå…¨å±€å®‰è£…ï¼Œâ€“registry&#x3D;&#x3D;<a href="https://registry.npm.taobao.org/">https://registry.npm.taobao.org</a>  è¡¨ç¤ºä½¿ç”¨æ·˜å®é•œåƒå®‰è£… cnpm</p>
<p>å®‰è£…åéªŒè¯: åœ¨ cmd ä¸­è¾“å…¥å‘½ä»¤ cnpm -v, å¯æŸ¥çœ‹ cnpm ç‰ˆæœ¬</p>
<h2 id="2-2-å®‰è£…-Hexo"><a href="#2-2-å®‰è£…-Hexo" class="headerlink" title="2.2 å®‰è£… Hexo"></a>2.2 å®‰è£… Hexo</h2><p>å‘½ä»¤:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cnpm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜: -g è¡¨ç¤ºå…¨å±€å®‰è£…ï¼Œhexo-cli ä¸ºæ‰€å®‰è£…çš„åŒ…<br>å®‰è£…åéªŒè¯: åœ¨ cmd ä¸­è¾“å…¥å‘½ä»¤ hexo -v, å¯æŸ¥çœ‹ hexo ç‰ˆæœ¬</p>
<h2 id="2-3-æ³¨æ„äº‹é¡¹"><a href="#2-3-æ³¨æ„äº‹é¡¹" class="headerlink" title="2.3 æ³¨æ„äº‹é¡¹"></a>2.3 æ³¨æ„äº‹é¡¹</h2><p>å»ºè®®æ°¸è¿œå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Hexoï¼Œä»¥åŠ [æ¨èçš„ Node.js ç‰ˆæœ¬](æ–‡æ¡£ | Hexo )ã€‚<br>è‡³æ­¤ï¼Œæ‚¨å·²æˆæˆåŠŸå®‰è£…äº† Hexoï¼Œæ¥ä¸‹æ¥è¿›å…¥ Github çš„é…ç½®å§!</p>
<h1 id="ç¬¬ä¸‰ç« -é…ç½®-Github"><a href="#ç¬¬ä¸‰ç« -é…ç½®-Github" class="headerlink" title="ç¬¬ä¸‰ç«  é…ç½® Github"></a>ç¬¬ä¸‰ç«  é…ç½® Github</h1><p>å¦‚æœæ‚¨è¿˜æ²¡æœ‰ Gihub è´¦æˆ·ï¼Œè¯·æ³¨å†Œä¸€ä¸ª Github è´¦æˆ·å§!</p>
<h2 id="3-1-åœ¨-Github-ä¸Šåˆ›å»ºä»“åº“"><a href="#3-1-åœ¨-Github-ä¸Šåˆ›å»ºä»“åº“" class="headerlink" title="3.1 åœ¨ Github ä¸Šåˆ›å»ºä»“åº“"></a>3.1 åœ¨ Github ä¸Šåˆ›å»ºä»“åº“</h2><p>æ–°å»ºä¸€ä¸ªåä¸º: <a href="http://username.github.io/">http://username.github.io</a>  çš„ä»“åº“(username ä¸ºæ‚¨çš„ Github ç”¨æˆ·å)<br>æ¯”å¦‚ï¼Œå¦‚æœæ‚¨çš„ github ç”¨æˆ·åæ˜¯ testï¼Œé‚£ä¹ˆæ‚¨å°±æ–°å»ºåä¸º <a href="http://test.github.io/">http://test.github.io</a>  çš„ä»“åº“ï¼ˆå¿…é¡»æ˜¯æ‚¨çš„ç”¨æˆ·åï¼Œå…¶å®ƒåç§°æ— æ•ˆï¼‰ï¼Œå°†æ¥ä½ çš„ç½‘ç«™è®¿é—®åœ°å€å°±æ˜¯ <a href="https://test.github.io/">https://test.github.io</a>  äº†ã€‚ç”±æ­¤å¯è§ï¼Œæ¯ä¸€ä¸ª github è´¦æˆ·æœ€å¤šåªèƒ½åˆ›å»ºä¸€ä¸ªè¿™æ ·å¯ä»¥ç›´æ¥ä½¿ç”¨åŸŸåè®¿é—®çš„ä»“åº“ã€‚</p>
<h2 id="3-2-é…ç½®-SSH-å…å¯†ç™»å½•"><a href="#3-2-é…ç½®-SSH-å…å¯†ç™»å½•" class="headerlink" title="3.2 é…ç½® SSH å…å¯†ç™»å½•"></a>3.2 é…ç½® SSH å…å¯†ç™»å½•</h2><p>ä¸ºä»€ä¹ˆè¦é…ç½®è¿™ä¸ªå‘¢ï¼Ÿå› ä¸ºæ‚¨æäº¤ä»£ç è‚¯å®šè¦æ‹¥æœ‰æ‚¨çš„ github æƒé™æ‰å¯ä»¥ï¼Œä½†æ˜¯ç›´æ¥ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç å¤ªä¸å®‰å…¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ ssh key æ¥è§£å†³æœ¬åœ°å’ŒæœåŠ¡å™¨çš„è¿æ¥é—®é¢˜ã€‚</p>
<p>æ³¨: å¦‚æœæ‚¨å·²ç»é…ç½®è¿‡ SSHï¼Œå¯è·³è¿‡æ­¤æ­¥éª¤</p>
<p>æ­¥éª¤:</p>
<p>1ã€é¦–å…ˆæ‰“å¼€ç”µè„‘æ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ° C:\Users\æ‚¨çš„ç”¨æˆ·å\ .sshæ–‡ä»¶å¤¹å¹¶åˆ é™¤(å¦‚æœæ²¡æœ‰ï¼Œåˆ™ç›´æ¥è¿›å…¥ç¬¬äºŒæ­¥)</p>
<p>2ã€åœ¨ C:\Users\æ‚¨çš„ç”¨æˆ·å æ–‡ä»¶å¤¹ä¸‹å³é”®æ‰“å¼€ Git Bash Here è¾“å…¥å‘½ä»¤: ssh-keygen -t rsa -C â€œä½ çš„githubç™»å½•é‚®ç®±â€ ç”Ÿæˆ.sshç§˜é’¥ï¼Œè¾“å…¥åè¿æ•²ä¸‰æ¬¡å›è½¦ï¼Œå‡ºç°ä¸‹å›¾æƒ…å†µä»£è¡¨æˆåŠŸ</p>
<p>3ã€ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„ C:\Users\æ‚¨çš„ç”¨æˆ·å\ .sshæ–‡ä»¶å¤¹ï¼Œæ‰“å¼€è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ° .ssh\id_rsa.pub æ–‡ä»¶ï¼Œè®°äº‹æœ¬æ‰“å¼€å¹¶å¤åˆ¶é‡Œé¢çš„å†…å®¹</p>
<p>4ã€æ‰“å¼€æ‚¨çš„ github ä¸»é¡µï¼Œè¿›å…¥ä¸ªäººè®¾ç½® -&gt; SSH and GPG keys -&gt; New SSH keyï¼ŒæŠŠå¤åˆ¶çš„å†…å®¹ç²˜è´´è¿›å»ï¼Œtitle éšä¾¿å¡«ï¼Œä¿å­˜å³å¯ï¼Œæˆ‘ä»¬çš„å…¬é’¥å°±æ·»åŠ æˆåŠŸäº†ï¼Œè®¾ç½®å¥½å¦‚ä¸‹å›¾:</p>
<p>5ã€æ£€æµ‹æ˜¯å¦è®¾ç½®æˆåŠŸ:</p>
<p>è¾“å…¥å‘½ä»¤: ssh -T <a href="mailto:&#103;&#x69;&#x74;&#x40;&#103;&#x69;&#116;&#x68;&#117;&#x62;&#46;&#99;&#x6f;&#x6d;">&#103;&#x69;&#x74;&#x40;&#103;&#x69;&#116;&#x68;&#117;&#x62;&#46;&#99;&#x6f;&#x6d;</a></p>
<p>çœ‹åˆ°ä»¥ä¸Šä¿¡æ¯è¯´æ˜ SSH å·²é…ç½®æˆåŠŸ!</p>
<p>å¦‚æœå‡ºç°æç¤ºåˆ™é€‰æ‹©yesçŸ¥é“æˆåŠŸï¼›</p>
<p>6ã€æ­¤å¤–æ‚¨è¿˜éœ€è¦å¦‚ä¸‹é…ç½®:</p>
<p>å‘½ä»¤: git config â€“global user.name â€œchai0705 â€œ</p>
<p>å‘½ä»¤: git config â€“global user.email  <a href="mailto:&#x31;&#x33;&#54;&#49;&#x33;&#x38;&#x32;&#50;&#54;&#57;&#x40;&#113;&#x71;&#x2e;&#99;&#x6f;&#109;">&#x31;&#x33;&#54;&#49;&#x33;&#x38;&#x32;&#50;&#54;&#57;&#x40;&#113;&#x71;&#x2e;&#99;&#x6f;&#109;</a> </p>
<p>è‡³æ­¤ï¼Œæ‚¨å·²ç»æˆåŠŸé…ç½®å¥½äº† Githubï¼Œæ¥ä¸‹æ¥å¼€å§‹æ­å»ºä¸ªäººåšå®¢å§!</p>
<h1 id="ç¬¬å››ç« -ä½¿ç”¨-Hexo-æ­å»ºåšå®¢"><a href="#ç¬¬å››ç« -ä½¿ç”¨-Hexo-æ­å»ºåšå®¢" class="headerlink" title="ç¬¬å››ç«  ä½¿ç”¨ Hexo æ­å»ºåšå®¢"></a>ç¬¬å››ç«  ä½¿ç”¨ Hexo æ­å»ºåšå®¢</h1><p>Hexo çš„ä¸€äº›å‘½ä»¤<br>ç”Ÿæˆé™æ€æ–‡ä»¶ï¼šhexo gï¼›<br>æ¸…ç©ºé™æ€æ–‡ä»¶ï¼šhexo clï¼›<br>åœ¨æœ¬åœ°è¿è¡Œï¼šhexo sï¼›<br>éƒ¨ç½²åˆ°ç½‘ç«™ï¼šhexo dï¼›<br>ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶éƒ¨ç½²åˆ°ç½‘ç«™ï¼šhexo d -g æˆ– hexo g -dï¼›<br>åˆ›å»ºæ–°æ–‡ç« ï¼šhexo new <file>ã€‚</p>
<h2 id="4-1-åˆå§‹åŒ–"><a href="#4-1-åˆå§‹åŒ–" class="headerlink" title="4.1 åˆå§‹åŒ–"></a>4.1 åˆå§‹åŒ–</h2><p>1ã€åœ¨ç”µè„‘çš„æŸä¸ªç£ç›˜æˆ–è·¯å¾„æ–°å»ºä¸€ä¸ªåä¸º hexo çš„æ–‡ä»¶å¤¹(åå­—å¯ä»¥éšä¾¿å–)ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯ D:\hexoï¼Œç”±äºè¿™ä¸ªæ–‡ä»¶å¤¹å°†æ¥å°±ä½œä¸ºæ‚¨å­˜æ”¾ä»£ç çš„åœ°æ–¹ï¼Œæ‰€ä»¥æœ€å¥½ä¸è¦éšä¾¿æ”¾</p>
<p>2ã€åœ¨ D:\hexo æ–‡ä»¶å¤¹ä¸‹å³é”®æ‰“å¼€ Git Bash Hereï¼Œè¾“å…¥å‘½ä»¤: hexo init è¿›è¡Œåˆå§‹åŒ–</p>
<p>hexo ä¼šè‡ªåŠ¨ä¸‹è½½ä¸€äº›æ–‡ä»¶åˆ°è¿™ä¸ªç›®å½•ï¼ŒåŒ…æ‹¬ node_modulesï¼Œç›®å½•ç»“æ„å¦‚ä¸‹å›¾:</p>
<p>3ã€æ‰§è¡Œå‘½ä»¤: hexo g ä¼šåœ¨ public æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆç›¸å…³çš„ html æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å°†æ¥éœ€è¦æäº¤åˆ° Github ä¸Š</p>
<p>4ã€æ‰§è¡Œå‘½ä»¤: hexo s å¯ä»¥å¼€å¯æœ¬åœ°é¢„è§ˆæœåŠ¡ï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—® <a href="http://localhost:4000/">http://localhost:4000</a>  å³å¯çœ‹åˆ°åšå®¢å†…å®¹</p>
<h2 id="4-2-å°†åšå®¢éƒ¨ç½²åˆ°-Github"><a href="#4-2-å°†åšå®¢éƒ¨ç½²åˆ°-Github" class="headerlink" title="4.2 å°†åšå®¢éƒ¨ç½²åˆ° Github"></a>4.2 å°†åšå®¢éƒ¨ç½²åˆ° Github</h2><p>1ã€åœ¨ D:\hexo ç›®å½•ä¸‹å®‰è£… hexo-deployer-git æ’ä»¶</p>
<p>å‘½ä»¤: npm install hexo-deployer-git â€“save<br>2ã€ç¼–è¾‘ D:\hexo ç›®å½•ä¸‹çš„ _config.yml æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å¦‚ä¸‹å†…å®¹:</p>
<p>æ³¨æ„: å…¶ä¸­ repository ä¸­çš„å†…å®¹å³ä¸º github ä¸ªäººä¸»é¡µé“¾æ¥åœ°å€</p>
<p>3ã€åœ¨ D:\hexo ç›®å½•ä¸‹ï¼Œè¾“å…¥å‘½ä»¤: hexo d å°†æœ¬åœ° blog æ¨é€åˆ° github è¿œç¨‹ä»“åº“ï¼Œä¹Ÿå¯èƒ½éœ€è¦è¾“å…¥ username &amp; pwd</p>
<p>æ¨é€æˆåŠŸåï¼Œå³å¯é€šè¿‡<a href="https://baizhouhaoyue.github.io/%E8%AE%BF%E9%97%AE%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E4%BA%86">https://baizhouhaoyue.github.io/è®¿é—®ä¸ªäººåšå®¢äº†</a> !</p>
<p>CLASH </p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309152249472.png" alt="image-20230915224913754"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042118499.png" alt="image-20230915224959370">1 æ–‡ç« çš„åˆ†ç±»å’Œæ ‡ç­¾</p>
<h1 id="ç¬¬5ç« -hexoè¿›é˜¶"><a href="#ç¬¬5ç« -hexoè¿›é˜¶" class="headerlink" title="ç¬¬5ç«  hexoè¿›é˜¶"></a>ç¬¬5ç«  hexoè¿›é˜¶</h1><h2 id="5-1-åˆ†ç±»å’Œæ ‡ç­¾"><a href="#5-1-åˆ†ç±»å’Œæ ‡ç­¾" class="headerlink" title="5.1 åˆ†ç±»å’Œæ ‡ç­¾"></a>5.1 åˆ†ç±»å’Œæ ‡ç­¾</h2><p>åˆ†ç±»çš„è¯å°±æ˜¯åœ¨æœ€ä¸Šæ–¹çš„çŠ¶æ€æ ä¸­åŠ å…¥	categories:  å±æ€§å³å¯</p>
<p>æ ‡ç­¾çš„è¯å°±æ˜¯åœ¨æœ€ä¸Šæ–¹çš„çŠ¶æ€æ ä¸­åŠ å…¥	tags:  å±æ€§å³å¯</p>
<h2 id="5-2å›¾åºŠæ­å»ºæ•™ç¨‹"><a href="#5-2å›¾åºŠæ­å»ºæ•™ç¨‹" class="headerlink" title="5.2å›¾åºŠæ­å»ºæ•™ç¨‹"></a>5.2å›¾åºŠæ­å»ºæ•™ç¨‹</h2><p>æ ¹æ®è¿™ä¸ªæ•™ç¨‹æ¥å³å¯</p>
<p><a href="https://eryinote.com/post/105">å›¾åºŠ</a></p>
<p>è¸©å‘ picgoè¿™ä¸ªè½¯ä»¶åŒå‡»å¹¶ä¸æ˜¯ç›´æ¥æ‰“å¼€ï¼Œè€Œæ˜¯åˆ°äº†å³ä¸‹è§’çš„å°èœå•ã€‚ã€‚ã€‚</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042118512.png" alt="image-20230903113402329"></p>
<p>ç„¶ååœ¨typoraè½¯ä»¶ä¸­è¿›è¡Œç®€å•çš„è®¾ç½®å³å¯ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202312042118538.png" alt="image-20230903114440776"></p>
<p>è‡³æ­¤å°±æå®Œäº†ï¼Œå…¶ä»–ç›®å‰ä¹Ÿæ²¡å•¥éœ€æ±‚ï¼Œç»§ç»­å­¦ä¹ C++</p>
]]></content>
      <categories>
        <category>ç½‘ç«™çš„æ­å»º</category>
      </categories>
  </entry>
  <entry>
    <title>markdownè¯­æ³•å­¦ä¹ </title>
    <url>/2023/09/01/1markdown%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>MarkDownæ˜¯ä»€ä¹ˆ<br>Markdown æ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ï¼Œå®ƒå…è®¸äººä»¬ä½¿ç”¨æ˜“è¯»æ˜“å†™çš„çº¯æ–‡æœ¬æ ¼å¼ç¼–å†™æ–‡æ¡£ã€‚</p>
<p>Markdown è¯­è¨€åœ¨ 2004 ç”±çº¦ç¿°Â·æ ¼é²ä¼¯ï¼ˆè‹±è¯­ï¼šJohn Gruberï¼‰åˆ›å»ºã€‚</p>
<p>Markdown ç¼–å†™çš„æ–‡æ¡£å¯ä»¥å¯¼å‡º HTML ã€Wordã€å›¾åƒã€PDFã€Epub ç­‰å¤šç§æ ¼å¼çš„æ–‡æ¡£ã€‚</p>
<p>Markdown ç¼–å†™çš„æ–‡æ¡£åç¼€ä¸º .md, .markdownã€‚</p>
<h1 id="1-å¦‚ä½•è‡ªåŠ¨ç”Ÿæˆç›®å½•"><a href="#1-å¦‚ä½•è‡ªåŠ¨ç”Ÿæˆç›®å½•" class="headerlink" title="1.å¦‚ä½•è‡ªåŠ¨ç”Ÿæˆç›®å½•"></a>1.å¦‚ä½•è‡ªåŠ¨ç”Ÿæˆç›®å½•</h1><p>ç‚¹å‡»ã€è§†å›¾ã€‘â€”â€”ã€å¤§çº²ã€‘</p>
<p>è¯´æ˜ï¼šä½†æ˜¯æ­¤æ­¥éª¤ç”Ÿæˆçš„ç›®å½•ï¼Œå¹¶ä¸æ˜¯æŠ˜å çš„ç›®å½•ï¼ŒæŠ˜å èµ·æ¥ä¼šæ›´ç¾è§‚ä¸€äº›</p>
<p>è®¾ç½®æŠ˜å ç›®å½•</p>
<p>ç‚¹å‡»ã€æ–‡ä»¶ã€‘â€”â€”ã€åå¥½è®¾ç½®ã€‘â€”â€”ã€å¤–è§‚ã€‘â€”â€”ä¾§è¾¹æ é€‰æ‹©æ‰“é’©ï¼Œæ­¤æ—¶å·²ç»æŠ˜å æˆåŠŸ</p>
<h1 id="2-å¿«æ·é”®"><a href="#2-å¿«æ·é”®" class="headerlink" title="2.å¿«æ·é”®"></a>2.å¿«æ·é”®</h1><p> Ctrl+1 â€”â€”è®¾ç½®ä¸€çº§æ ‡é¢˜</p>
<p>Ctrl+2 â€”â€”è®¾ç½®äºŒçº§æ ‡é¢˜</p>
<p>Ctrl+3 â€”â€”è®¾ç½®ä¸‰çº§æ ‡é¢˜</p>
<p>Ctrl+4 â€”â€”è®¾ç½®å››çº§æ ‡é¢˜</p>
<p>Ctrl+5 â€”â€”è®¾ç½®äº”çº§æ ‡é¢˜</p>
<p>Ctrl+6 â€”â€”è®¾ç½®å…­çº§æ ‡é¢˜</p>
<p>ç©ºæ ¼ â€”â€”å¼•ç”¨</p>
<p>å›è½¦ã€shift + tab â€”â€”é€€å‡ºå¼•ç”¨</p>
<p>Ctrl + Shift + ] â€”â€”æ— åºåˆ—è¡¨</p>
<p>Ctrl + Shift + [ â€”â€”æœ‰åºåˆ—</p>
<p>Ctrl + Shift + ] ã€tabâ€”â€”å­åˆ—è¡¨</p>
<p>Shift + tab â€”â€”è¿”å›ä¸Šä¸€çº§åˆ—è¡¨ã€</p>
<p>Ctrl + B â€”â€” åŠ ç²—</p>
<p>Ctrl + T â€”â€” è¡¨æ ¼</p>
<p>~ ~ è¦åˆ é™¤çš„å†…å®¹ ~ ~ â€”â€”åˆ é™¤çº¿</p>
<h1 id="3-åˆ›å»ºé“¾æ¥"><a href="#3-åˆ›å»ºé“¾æ¥" class="headerlink" title="3.åˆ›å»ºé“¾æ¥"></a>3.åˆ›å»ºé“¾æ¥</h1><p>æ ¼å¼ä¸º[] ()ï¼Œå…¶ä¸­[]å†…ä¸ºè¦å±•ç¤ºçš„å†…å®¹ï¼Œ()ä¸ºé“¾æ¥ã€‚</p>
<h1 id="4-å›¾ç‰‡è·¯å¾„ç®¡ç†"><a href="#4-å›¾ç‰‡è·¯å¾„ç®¡ç†" class="headerlink" title="4.å›¾ç‰‡è·¯å¾„ç®¡ç†"></a>4.å›¾ç‰‡è·¯å¾„ç®¡ç†</h1><p>Typoraé»˜è®¤å°†æ‰€æœ‰æ–‡æ¡£çš„å›¾ç‰‡éƒ½æ”¾åœ¨ä¸€èµ·ï¼Œä½†æ˜¯æˆ‘ä»¬æ›´æƒ³æ¯ä¸€ä¸ªæ–‡æ¡£éƒ½æœ‰å±äºè‡ªå·±çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ–‡æ¡£ä¸­çš„å›¾ç‰‡ä¹Ÿæœ€å¥½å¯ä»¥è‡ªåŠ¨ä¿å­˜åœ¨è¯¥æ–‡ä»¶å¤¹å†…ã€‚è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<p>ç‚¹å‡»ã€æ–‡ä»¶ã€‘â€”â€”ã€åå¥½è®¾ç½®ã€‘â€”â€”ã€å›¾åƒã€‘â€”â€”å°†è¯¥ç•Œé¢å†…å®¹è®¾ç½®å¦‚ä¸‹:</p>
<p> æ­¤æ—¶ï¼Œè¯¥æ–‡æ¡£æ‰€åœ¨æ–‡ä»¶å¤¹ä¸­ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªimgæ–‡ä»¶ï¼Œè¯¥è·¯å¾„ä¸ºæœ¬æ–‡æ¡£ä¸­çš„å›¾ç‰‡è·¯å¾„ã€‚</p>
<p><img src="D:\hexo\blog\source_posts\image-20230902072149501.png"></p>
<h1 id="5-åˆ’é‡ç‚¹â€“é«˜äº®"><a href="#5-åˆ’é‡ç‚¹â€“é«˜äº®" class="headerlink" title="5.åˆ’é‡ç‚¹â€“é«˜äº®"></a>5.åˆ’é‡ç‚¹â€“é«˜äº®</h1><p>é«˜äº®</p>
<p>ç‚¹å‡»ã€æ–‡ä»¶ã€‘â€”â€”ã€åå¥½è®¾ç½®ã€‘â€”â€”ã€Markdownã€‘â€”â€”é«˜äº®å¤„æ‰“é’©</p>
<p>ç¼–è¾‘é«˜äº®å†…å®¹æ ¼å¼å¦‚ä¸‹ï¼š</p>
<p>&#x3D;&#x3D; å†…å®¹&#x3D;&#x3D; â€”â€” é«˜äº®</p>
<p>&#x3D;&#x3D; chai&#x3D;&#x3D;</p>
<p>&#x3D;&#x3D;cccc&#x3D;&#x3D; </p>
<p>&#x3D;&#x3D; key&#x3D;&#x3D;</p>
<p> &#x3D;&#x3D;å†…å®¹&#x3D;&#x3D; </p>
<p><strong>cha</strong></p>
<p>é‡å¯Typoraï¼Œæ­¤æ—¶å†…å®¹å¤„ä¼šå˜æˆé«˜äº®çš„æ•ˆæœ.</p>
<h1 id="6-å¯¼å…¥ä»£ç å—"><a href="#6-å¯¼å…¥ä»£ç å—" class="headerlink" title="6.å¯¼å…¥ä»£ç å—"></a>6.å¯¼å…¥ä»£ç å—</h1><p><strong>~~~</strong> â€”â€”ä»£ç å—ï¼Œç‚¹å‡»ä»£ç æ¡†å¯é€‰æ‹©è¯­è¨€</p>
<h1 id="7-ä¸ä½¿ç”¨è‡ªåŠ¨æ‹¼å†™æ£€æŸ¥"><a href="#7-ä¸ä½¿ç”¨è‡ªåŠ¨æ‹¼å†™æ£€æŸ¥" class="headerlink" title="7.ä¸ä½¿ç”¨è‡ªåŠ¨æ‹¼å†™æ£€æŸ¥"></a>7.ä¸ä½¿ç”¨è‡ªåŠ¨æ‹¼å†™æ£€æŸ¥</h1><p>ç‚¹å‡»å³ä¸‹è§’[ã€Spell Checkã€‘å‹¾é€‰ã€ä¸ä½¿ç”¨æ‹¼å†™æ£€æŸ¥ã€‘</p>
<h1 id="8è®¾ç½®è‡ªåŠ¨ä¿å­˜"><a href="#8è®¾ç½®è‡ªåŠ¨ä¿å­˜" class="headerlink" title="8è®¾ç½®è‡ªåŠ¨ä¿å­˜"></a>8è®¾ç½®è‡ªåŠ¨ä¿å­˜</h1><p>å…¶å®Typora å¯¹æ–‡ä»¶ä¿®æ”¹ä¹‹åå¹¶ä¸èƒ½è‡ªåŠ¨ä¿å­˜ï¼Œè§£å†³æ–¹æ³•ï¼š</p>
<p>ç‚¹å‡»ã€æ–‡ä»¶ã€‘â€”â€”ã€åå¥½è®¾ç½®ã€‘â€”â€”ã€é€šç”¨ã€‘â€”â€”è‡ªåŠ¨ä¿å­˜å¤„æ‰“é’©</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
  </entry>
</search>
