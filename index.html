<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta name="description" content="永远年轻，永远热泪盈眶" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> 热爱学习的未来酱</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <link rel="alternate" href="/atom.xml" title="热爱学习的未来酱" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      
      <canvas width="1777" height="841"
        style="position: fixed; left: 0px; top: 0px; z-index: 99999; pointer-events: none;"></canvas>
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Shen-Yu/hexo-theme-ayer"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover3.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">热爱学习的未来酱</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['面朝大海，春暖花开', '向上的路，并不拥挤。拥挤是因为，大部分人选择了安逸', '想要的都拥有，得不到的都释怀'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-0-22 声卡问题的解决"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/10/10/0-22%20%E5%A3%B0%E5%8D%A1%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3/"
    >0-22 声卡问题的解决</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/10/10/0-22%20%E5%A3%B0%E5%8D%A1%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3/" class="article-date">
  <time datetime="2023-10-10T12:47:53.000Z" itemprop="datePublished">2023-10-10</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%91%9E%E8%8A%AF%E5%BE%AE%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90/">瑞芯微固件分析</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <pre><code>    es8388_sound: es8388-sound &#123;
            status = &quot;okay&quot;;
            compatible = &quot;rockchip,multicodecs-card&quot;;
            rockchip,card-name = &quot;rockchip-es8388&quot;;
            hp-det-gpio = &lt;&amp;gpio1 RK_PD5 GPIO_ACTIVE_HIGH&gt;;
            io-channels = &lt;&amp;saradc 3&gt;;
            io-channel-names = &quot;adc-detect&quot;;
            keyup-threshold-microvolt = &lt;1800000&gt;;
            poll-interval = &lt;100&gt;;
            rockchip,format = &quot;i2s&quot;;
            rockchip,mclk-fs = &lt;256&gt;;
            rockchip,cpu = &lt;&amp;i2s1_8ch&gt;;
            rockchip,codec = &lt;&amp;es8388&gt;;
            rockchip,audio-routing =
                    &quot;Headphone&quot;, &quot;LOUT1&quot;,
                    &quot;Headphone&quot;, &quot;ROUT1&quot;,
                    &quot;Headphone&quot;, &quot;Headphone Power&quot;,
                    &quot;Headphone&quot;, &quot;Headphone Power&quot;,
                    &quot;LINPUT1&quot;, &quot;Main Mic&quot;,
                    &quot;LINPUT2&quot;, &quot;Main Mic&quot;,
                    &quot;RINPUT1&quot;, &quot;Headset Mic&quot;,
                    &quot;RINPUT2&quot;, &quot;Headset Mic&quot;;
            pinctrl-names = &quot;default&quot;;
            pinctrl-0 = &lt;&amp;hp_det&gt;;
            play-pause-key &#123;
                    label = &quot;playpause&quot;;
                    linux,code = &lt;KEY_PLAYPAUSE&gt;;
                    press-threshold-microvolt = &lt;2000&gt;;
            &#125;;
    &#125;;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">es8388: es8388@10 &#123;</span><br><span class="line">        status = &quot;okay&quot;;</span><br><span class="line">        #sound-dai-cells = &lt;0&gt;;</span><br><span class="line">        compatible = &quot;everest,es8388&quot;, &quot;everest,es8323&quot;;</span><br><span class="line">        reg = &lt;0x10&gt;;</span><br><span class="line">        clocks = &lt;&amp;mclkout_i2s1&gt;;</span><br><span class="line">        clock-names = &quot;mclk&quot;;</span><br><span class="line">        assigned-clocks = &lt;&amp;mclkout_i2s1&gt;;</span><br><span class="line">        assigned-clock-rates = &lt;12288000&gt;;</span><br><span class="line">        pinctrl-names = &quot;default&quot;;</span><br><span class="line">        pinctrl-0 = &lt;&amp;i2s1m0_mclk&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>





<p>香橙派 orangepib3 </p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310112154264.png" alt="image-20231011215420206"></p>
<p>倒是没啥</p>
<p>1126</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310112154846.png" alt="image-20231011215455816"></p>
<p>正点3568</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310112155945.png" alt="image-20231011215514911"></p>
<p>香橙派 rk3588s</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310112157444.png" alt="image-20231011215723418"></p>
<p>firefly rk3568原理图</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310112159178.png" alt="image-20231011215957135"></p>
<p>野火 3588s</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310112204368.png" alt="image-20231011220410343"></p>
<p>野火 3568 </p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310112205798.png" alt="image-20231011220530778"></p>
<p>迅为3588</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310112206820.png" alt="image-20231011220656801"></p>
<p>迅为3568</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310112208009.png" alt="image-20231011220800981"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%91%9E%E8%8A%AF%E5%BE%AE%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90/" rel="tag">瑞芯微脚本分析</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-0-20 挂载镜像文件"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/10/08/0-20%20%E6%8C%82%E8%BD%BD%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6/"
    >0-20挂载镜像文件</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/10/08/0-20%20%E6%8C%82%E8%BD%BD%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6/" class="article-date">
  <time datetime="2023-10-08T12:47:53.000Z" itemprop="datePublished">2023-10-08</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%91%9E%E8%8A%AF%E5%BE%AE%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90/">瑞芯微固件分析</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>编译完成之后的镜像为ubuntu-22.04.3-preinstalled-desktop-arm64.img，这里面包括spl tpl uboot boot分区和文件系统分区，其中spl tpl uboot是通过dd命令写入的，而另外两个是创建的分区，现在我想的是挂载上这个img镜像，然后查看里面的系统，在CSDN上找到了这样一个博客</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yangleo1987/article/details/58603205?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169677013016800184112679%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=169677013016800184112679&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-2-58603205-null-null.142%5Ev95%5EchatgptT3_1&utm_term=linux%E4%B8%8B%E6%8C%82%E8%BD%BDimg%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6&spm=1018.2226.3001.4187">挂载img分区</a></p>
<p>首先使用fdisk命令查看img镜像分区</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdisk ubuntu-22.04.3-preinstalled-desktop-arm64.img</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310082107478.png" alt="image-20231008210757445"></p>
<p>分区是从32768和1081344开始的，然后，就可以挂载分区了，这里要用到offset参数：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o loop,offset=$((32768*512))  ubuntu-22.04.3-preinstalled-desktop-arm64.img    1 </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o loop,offset=$((61440*512))  ubuntu-22.04.3-preinstalled-desktop-arm64.img    1 </span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o loop,offset=$((1081344*512))  ubuntu-22.04.3-preinstalled-desktop-arm64.img    2 </span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/make -f ./Makefile intdeb-pkg \</span><br><span class="line">  KERNELRELEASE=5.10.160-rockchip \</span><br><span class="line">  KDEB_PKGVERSION=5.10.160-14 \</span><br><span class="line">  CROSS_COMPILE=aarch64-linux-gnu- \</span><br><span class="line">  ARCH=arm64 \</span><br><span class="line">  -j 32</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gzip -dc ../initrd.img | cpio -idm</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lz4 -dc ../initrd.img | cpio -idm</span><br></pre></td></tr></table></figure>





<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">U-Boot 2017.09-g32640b0ada-230713-dirty #topeet (Oct 07 2023 - 22:14:24 +0800)</span><br><span class="line"></span><br><span class="line">Model: Rockchip RK3588 Evaluation Board</span><br><span class="line">MPIDR: 0x81000000</span><br><span class="line">PreSerial: 2, raw, 0xfeb50000</span><br><span class="line">DRAM:  8 GiB</span><br><span class="line">Sysmem: init</span><br><span class="line">Relocation Offset: eda1c000</span><br><span class="line">Relocation fdt: eb9fa160 - eb9fecd0</span><br><span class="line">CR: M/C/I</span><br><span class="line">Using default environment</span><br><span class="line"></span><br><span class="line">Hotkey: ctrl+c</span><br><span class="line">DM: v2</span><br><span class="line">no mmc device at slot 1</span><br><span class="line">mmc@fe2c0000: 1 (SD), mmc@fe2e0000: 0</span><br><span class="line">Bootdev(atags): mmc 1</span><br><span class="line">MMC1: Legacy, 52Mhz</span><br><span class="line">PartType: EFI</span><br><span class="line">No misc partition</span><br><span class="line">boot mode: None</span><br><span class="line">RESC: &#x27;boot&#x27;, blk@0x0001898a</span><br><span class="line">resource: sha256+</span><br><span class="line">FIT: no signed, no conf required</span><br><span class="line">DTB: rk-kernel.dtb</span><br><span class="line">HASH(c): OK</span><br><span class="line">I2c0 speed: 100000Hz</span><br><span class="line">vsel-gpios- not found!</span><br><span class="line">en-gpios- not found!</span><br><span class="line">vdd_cpu_big0_s0 800000 uV</span><br><span class="line">vsel-gpios- not found!</span><br><span class="line">en-gpios- not found!</span><br><span class="line">vdd_cpu_big1_s0 800000 uV</span><br><span class="line">I2c1 speed: 100000Hz</span><br><span class="line">vsel-gpios- not found!</span><br><span class="line">en-gpios- not found!</span><br><span class="line">vdd_npu_s0 800000 uV</span><br><span class="line">spi2: RK806: 2</span><br><span class="line">ON=0x40, OFF=0x00</span><br><span class="line">vdd_gpu_s0 750000 uV</span><br><span class="line">vdd_cpu_lit_s0 750000 uV</span><br><span class="line">vdd_log_s0 750000 uV</span><br><span class="line">vdd_vdenc_s0 init 750000 uV</span><br><span class="line">vdd_ddr_s0 850000 uV</span><br><span class="line">Device &#x27;gpio@fd8a0000&#x27;: seq 0 is in use by &#x27;gpio@fd8a0000&#x27;</span><br><span class="line">Warn: can&#x27;t find connect driver</span><br><span class="line">Warn: can&#x27;t get connect driver</span><br><span class="line">get vp0 plane mask:0x5, primary id:2, cursor_plane:-1, from dts</span><br><span class="line">get vp1 plane mask:0xa, primary id:3, cursor_plane:-1, from dts</span><br><span class="line">get vp2 plane mask:0x140, primary id:8, cursor_plane:-1, from dts</span><br><span class="line">get vp3 plane mask:0x280, primary id:9, cursor_plane:-1, from dts</span><br><span class="line">Could not find baseparameter partition</span><br><span class="line">Model: Rockchip RK3588 EVB7 LP4 V10 Board</span><br><span class="line">MPIDR: 0x81000000</span><br><span class="line">Rockchip UBOOT DRM driver version: v1.0.1</span><br><span class="line">vp0 have layer nr:2[0 2 ], primary plane: 2</span><br><span class="line">vp1 have layer nr:2[1 3 ], primary plane: 3</span><br><span class="line">vp2 have layer nr:2[6 8 ], primary plane: 8</span><br><span class="line">vp3 have layer nr:2[7 9 ], primary plane: 9</span><br><span class="line">Using display timing dts</span><br><span class="line">dsi@fde30000:  detailed mode clock 71900 kHz, flags[a]</span><br><span class="line">    H: 0800 0820 0840 0860</span><br><span class="line">    V: 1280 1290 1294 1298</span><br><span class="line">bus_format: 100e</span><br><span class="line">VOP update mode to: 800x1280p64, type: MIPI1 for VP3</span><br><span class="line">VP3 set crtc_clock to 71493KHz</span><br><span class="line">VOP VP3 enable Esmart3[654x270-&gt;654x270@73x505] fmt[2] addr[0xedf04000]</span><br><span class="line">final DSI-Link bandwidth: 476620 Kbps x 4</span><br><span class="line">CLK: (uboot. arm: enter 1008000 KHz, init 1008000 KHz, kernel 0N/A)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%91%9E%E8%8A%AF%E5%BE%AE%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90/" rel="tag">瑞芯微脚本分析</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-0-21 构建deb包"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/10/08/0-21%20%E6%9E%84%E5%BB%BAdeb%E5%8C%85/"
    >0-21 构建deb包</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/10/08/0-21%20%E6%9E%84%E5%BB%BAdeb%E5%8C%85/" class="article-date">
  <time datetime="2023-10-08T12:47:53.000Z" itemprop="datePublished">2023-10-08</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%91%9E%E8%8A%AF%E5%BE%AE%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90/">瑞芯微固件分析</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="1-三个核心概念"><a href="#1-三个核心概念" class="headerlink" title="1.三个核心概念"></a>1.三个核心概念</h1><p>三个最核心的概念为：</p>
<ul>
<li>上游原始代码包（upstream tarball）:<ul>
<li>通常，人们为上游开发者（通常为第三方）编写的软件打包。</li>
<li>上游开发者会使用源代码归档软件或原始代码包的方式发放他们的软件。</li>
<li>原始代码包一般是上游制作的 <code>.tar.gz</code> 或 <code>.tgz</code> 文件，它也可能被压缩成 <code>.tar.bz2</code>，<code>.tb2</code> 或 <code>.tar.xz</code> 格式。原始代码包就是 Debian 构建包时使用的原材料。</li>
</ul>
</li>
<li>源码包：<ul>
<li>当您拥有了上游制作的原始代码包，下一步就可以制作 Debian 源码包了。</li>
</ul>
</li>
<li>二进制包：<ul>
<li>从源码包您可以构建 Debian 二进制包，它才是是实际上会被安装的包。</li>
</ul>
</li>
</ul>
<p>最简单的源码包由3个文件组成：</p>
<ul>
<li>上游原始代码包，需要被重命名来符合一个特定的模式。</li>
<li>一个 debian 目录，带有所有上游源代码的更改记录，外加所有为 Debian 打包系统生成的所有文件。这种包拥有 <code>.debian.tar.gz</code> 的文件名。</li>
<li>一个描述文件（以 <code>.dsc</code> 结尾），罗列了其他两个文件。</li>
</ul>
<p>听起来有些过于复杂，人们的第一印象是：所有东西都放在一个文件里会更简单。然而，保持上游代码包与 Debian 特定更改分离可以节省大量磁盘空间和带宽。对 Debian 来说，追踪必要的修改也更加简单。</p>
<h1 id="2-deb包制作流程"><a href="#2-deb包制作流程" class="headerlink" title="2. deb包制作流程"></a>2. deb包制作流程</h1><p>首先创建一个debian目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> debian</span><br></pre></td></tr></table></figure>

<p>我们需要提供不少文件，让我们按顺序来看。</p>
<h2 id="2-1-debian-changelog"><a href="#2-1-debian-changelog" class="headerlink" title="2.1 debian&#x2F;changelog"></a>2.1 debian&#x2F;changelog</h2><p>第一个文件是 <code>debian/changelog</code>，这个是记录 Debian 包变化的日志文件。它无需罗列出上游代码的每一个改变，只要它能帮助用户总结这些变化即可。我们在制作第一个版本，所以这里应当什么都没有。然而，我们仍需制作一个变化日志的入口，因为打包工具会从日志里读取特定信息。最重要的是它会读取包的版本。</p>
<p><code>debian/changelog</code> 拥有一个十分特殊的格式。最简单的创建方式就是使用 <code>dch</code> 工具。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install devscripts</span><br><span class="line">dch --create -v 1.0-1 --package hithere</span><br></pre></td></tr></table></figure>

<p>会在文件中产生以下内容：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310092059083.png" alt="image-20231009205902071"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310092058676.png" alt="image-20231009205839642"></p>
<p>这里有很多注意点：</p>
<p><code>hithere</code> 部分必须与源代码包的名字相同。<code>1.0-1</code> 是版本号，<code>1.0</code> 部分是上游版本号。<code>-1</code> 部分是 Debian 的版本：它是第一个上游版本为 <code>1.0</code> 的 Debian 包。如果这个 Debian 包有错误，并且被修复了，那么上游版本号仍保持相同，下一个版本应当被叫做 <code>1.0-2</code>，接下来是 <code>1.0-3</code>，依此类推。</p>
<p>UNRELEASED 被称作上传目标。它会告诉上传工具这个二进制包应当被上传到哪里。UNRELEASED 意味着这个包还没有做好上传的准备。保持 UNRELEASED 是一个好主意，以避免您错误上传它。</p>
<p>目前请先忽略 <code>urgency=medium</code>。</p>
<p><code>(Closes：#XXXXXX)</code> 作用在于上传包时关闭错误。这是在 Debian 中关闭错误的常用方法：当上传修复错误的包时，错误跟踪器会注意到这一点，并将错误标记为已关闭。我们可以删除 <code>(Closes...)</code> 位</p>
<h2 id="2-2-debian-control"><a href="#2-2-debian-control" class="headerlink" title="2.2 debian&#x2F;control"></a>2.2 debian&#x2F;control</h2><p>控制文件描述代码和二进制包，并给出他们的详细信息，比如名称、包的维护者是谁，等等。下面是一个示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Source: hithere</span><br><span class="line">Maintainer: Lars Wirzenius &lt;liw@liw.fi&gt;</span><br><span class="line">Section: misc</span><br><span class="line">Priority: optional</span><br><span class="line">Standards-Version: 3.9.2</span><br><span class="line">Build-Depends: debhelper (&gt;= 9)</span><br><span class="line"></span><br><span class="line">Package: hithere</span><br><span class="line">Architecture: any</span><br><span class="line">Depends: $&#123;shlibs:Depends&#125;, $&#123;misc:Depends&#125;</span><br><span class="line">Description: greet user</span><br><span class="line"> hithere greets the user, or the world.</span><br></pre></td></tr></table></figure>

<p>在这个文件里有许多需求的字段，但是现在您可以像对待魔法一样对待它。那么，在 <code>debian/control</code> 中有两段文字。</p>
<p>第一段文字描述了源代码包，使用以下字段：</p>
<h3 id="2-2-1-Source"><a href="#2-2-1-Source" class="headerlink" title="2.2.1 Source"></a>2.2.1 Source</h3><p>源代码包名。</p>
<h3 id="2-2-2-Maintainer"><a href="#2-2-2-Maintainer" class="headerlink" title="2.2.2 Maintainer"></a>2.2.2 Maintainer</h3><p>维护者的姓名和电子邮箱。</p>
<h3 id="2-2-3-Priority"><a href="#2-2-3-Priority" class="headerlink" title="2.2.3 Priority"></a>2.2.3 Priority</h3><p>包的重要性（’required 可选的’, ‘important 重要的’, ‘standard 标准’ 或 ‘optional’ 其中之一）。通常，包是“可选”的，除非它对于标准系统功能是“必不可少的”，即启动或网络功能。 如果包与另一个“可选”包冲突，或者它不打算用于标准桌面安装，则应该是“额外”的而不是“可选”的。 “额外”包的显着例子是调试包。 （由Sebastian Tennant添加）。</p>
<h3 id="2-2-4-Build-Depends"><a href="#2-2-4-Build-Depends" class="headerlink" title="2.2.4 Build-Depends"></a>2.2.4 Build-Depends</h3><p>需要安装以构建程序包的程序包列表。实际使用包时有可能需要它们。</p>
<p>第一个之后的所有段落都描述了从此源构建的二进制包。 可以有许多从同一来源构建的二进制包; 但对于我们的例子只有一个。 我们使用这些字段：</p>
<h3 id="2-2-5-Package"><a href="#2-2-5-Package" class="headerlink" title="2.2.5 Package"></a>2.2.5 Package</h3><p>二进制包的名称。 名称可能与源包名称不同。</p>
<h3 id="2-2-6-Architecture"><a href="#2-2-6-Architecture" class="headerlink" title="2.2.6 Architecture"></a>2.2.6 Architecture</h3><p>指定二进制包预期使用的计算机体系结构：用于32位Intel CPU的i386，用于64位的amd64，用于ARM处理器的armel等等。 Debian总共可以处理大约十几种计算机体系结构，因此这种体系结构支持至关重要。 “Architecture”字段可以包含特定体系结构的名称，但通常它包含两个特殊值中的一个。</p>
<p>any<br> （我们在示例中看到）意味着可以为任何体系结构构建包。 换句话说，代码是可移植的，因此它不会对硬件做太多假设。 但是，仍然需要为每个体系结构单独构建二进制包。</p>
<p>all<br> 意味着相同的二进制包将适用于所有体系结构，而无需为每个体系结构单独构建。 例如，仅包含shell脚本的包将是“all”。 Shell脚本在任何地方都可以工作，不需要编译。</p>
<h3 id="2-2-7-Depends"><a href="#2-2-7-Depends" class="headerlink" title="2.2.7 Depends"></a>2.2.7 Depends</h3><p>为了让二进制包中程序能够正常运行，需要安装的包列表。手动列出这些依赖项是繁琐且容易出错的工作。为了能够让其工作，我们需要一个神奇的小东西 <code>$&#123;shlibs:Depends&#125;</code>。另一个神奇的东西是给 <code>debhelper</code> 的，它是 <code>$&#123;misc:Depends&#125;</code>。shlibs 是为了动态链接库，而 misc 是为了 <code>debherlper</code> 的一些工作。对于别的依赖，您可以将其手动加入到 <code>Depends</code> 或 <code>Build-Depends</code> 中。但请注意，<code>$&#123;...&#125;</code> 仅在 <code>Depends</code> 中有效。</p>
<h3 id="2-2-8-Description"><a href="#2-2-8-Description" class="headerlink" title="2.2.8 Description"></a>2.2.8 Description</h3><p>二进制包的完整描述。它希望对用户有所帮助。第一行用作简要概要（摘要）描述，其余部分是包的更长的描述。<br> 命令 <code>cme edit dpkg</code> 提供了一个GUI能够用来编辑大多数打包文件，包括 <code>debian/control</code>。 请参阅使用 <code>cme</code> 页面管理 <code>Debian</code> 软件包。<code>cme</code>命令在 Debian 中的 <code>cme</code> 包中提供。您也可以使用 <code>cme edit dpkg-control</code> 命令仅编辑 <code>debian/control</code> 文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Source: linux-rockchip-5.10.110</span><br><span class="line">Section: kernel</span><br><span class="line">Priority: optional</span><br><span class="line">Standards-Version: 4.6.0</span><br><span class="line">Build-Depends: bc, rsync, kmod, cpio, build-essential, u-boot-tools, bison, python3 | python, python-is-python3 | python-is-python2, flex | flex:native , , libssl-dev:native</span><br></pre></td></tr></table></figure>

<h2 id="2-3-debian-copyright"><a href="#2-3-debian-copyright" class="headerlink" title="2.3 debian&#x2F;copyright"></a>2.3 debian&#x2F;copyright</h2><p>这是一个非常重要的文件，但是现在我们将先使用一个空文件。<br> 对于 Debian ，此文件用于跟踪有关包的合法性、版权相关信息。但是，从技术角度来看，这并不重要。目前，我们将专注于技术方面。如果有兴趣，我们可以稍后再回到 <code>debian/copyright</code>。</p>
<h2 id="2-4-debian-rules"><a href="#2-4-debian-rules" class="headerlink" title="2.4 debian&#x2F;rules"></a>2.4 debian&#x2F;rules</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/make -f</span></span><br><span class="line"></span><br><span class="line">include /usr/share/dpkg/architecture.mk</span><br><span class="line">include /usr/share/dpkg/pkg-info.mk</span><br><span class="line"></span><br><span class="line">ifneq ($(DEB_BUILD_GNU_TYPE),$(DEB_HOST_GNU_TYPE))</span><br><span class="line">CROSS_COMPILE ?= $(DEB_HOST_GNU_TYPE)-</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">ifneq (,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))</span><br><span class="line">NJOBS := -j $(patsubst parallel=%,%,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))</span><br><span class="line">else</span><br><span class="line">NJOBS := -j $(shell nproc)</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">KDEB_PKGVERSION := $(shell dpkg-parsechangelog -SVersion -l debian/changelog | sed &#x27;s/-.*//&#x27;)</span><br><span class="line">PATCH_VERSION := $(shell dpkg-parsechangelog -SVersion -l debian/changelog | sed &#x27;s/.*-//&#x27;)</span><br><span class="line"></span><br><span class="line">srctree ?= .</span><br><span class="line"></span><br><span class="line">config:</span><br><span class="line">	@echo $(PATCH_VERSION)-1 | bc &gt; .version</span><br><span class="line">	@touch .scmversion</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">(MAKE) rockchip_linux_defconfig \</span></span><br><span class="line"><span class="language-bash">	  CROSS_COMPILE=$(CROSS_COMPILE) \</span></span><br><span class="line"><span class="language-bash">	  ARCH=arm64 \</span></span><br><span class="line"><span class="language-bash">	  $(NJOBS)</span></span><br><span class="line"></span><br><span class="line">build-indep:</span><br><span class="line">build-arch: config</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">(MAKE) -f $(srctree)/Makefile \</span></span><br><span class="line"><span class="language-bash">	  KERNELRELEASE=$(KDEB_PKGVERSION)-rockchip \</span></span><br><span class="line"><span class="language-bash">	  KDEB_PKGVERSION=$(KDEB_PKGVERSION)-$(PATCH_VERSION) \</span></span><br><span class="line"><span class="language-bash">	  CROSS_COMPILE=$(CROSS_COMPILE) \</span></span><br><span class="line"><span class="language-bash">	  ARCH=arm64 \</span></span><br><span class="line"><span class="language-bash">	  $(NJOBS)</span></span><br><span class="line"></span><br><span class="line">build: build-arch</span><br><span class="line"></span><br><span class="line">binary-indep:</span><br><span class="line">binary-arch: build-arch</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">(MAKE) -f $(srctree)/Makefile intdeb-pkg \</span></span><br><span class="line"><span class="language-bash">	  KERNELRELEASE=$(KDEB_PKGVERSION)-rockchip \</span></span><br><span class="line"><span class="language-bash">	  KDEB_PKGVERSION=$(KDEB_PKGVERSION)-$(PATCH_VERSION) \</span></span><br><span class="line"><span class="language-bash">	  CROSS_COMPILE=$(CROSS_COMPILE) \</span></span><br><span class="line"><span class="language-bash">	  ARCH=arm64 \</span></span><br><span class="line"><span class="language-bash">	  $(NJOBS)</span></span><br><span class="line">	</span><br><span class="line">clean:</span><br><span class="line">	@rm -rf debian/*tmp debian/files</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">(MAKE) clean</span></span><br><span class="line"></span><br><span class="line">binary: binary-arch</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- rockchip_linux_defconfig</span><br><span class="line">make KERNELRELEASE=&quot;$(make kernelversion)&quot; KBUILD_IMAGE=&quot;arch/arm64/boot/Image&quot; CROSS_COMPILE=aarch64-linux-gnu- ARCH=arm64 -j &quot;$(nproc)&quot; bindeb-pkg</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%91%9E%E8%8A%AF%E5%BE%AE%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90/" rel="tag">瑞芯微脚本分析</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-0-17 适配瑞芯微官方SDK"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/09/27/0-17%20%E9%80%82%E9%85%8D%E7%91%9E%E8%8A%AF%E5%BE%AE%E5%AE%98%E6%96%B9SDK/"
    >0-17 适配瑞芯微官方SDK</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/09/27/0-17%20%E9%80%82%E9%85%8D%E7%91%9E%E8%8A%AF%E5%BE%AE%E5%AE%98%E6%96%B9SDK/" class="article-date">
  <time datetime="2023-09-27T12:47:53.000Z" itemprop="datePublished">2023-09-27</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%91%9E%E8%8A%AF%E5%BE%AE%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90/">瑞芯微固件分析</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272155420.jpeg" alt="Rockchip bootflow.jpg"></p>
<p>瑞芯微的分区表如上图所示，虽然在瑞芯微的wiki中提供了一些简单的开源介绍，但是我是没有见过的。，，很坑，所以还是以瑞芯微的开放SDK进行移植</p>
<h1 id="1-miniloader"><a href="#1-miniloader" class="headerlink" title="1. miniloader"></a>1. miniloader</h1><p>瑞芯微官方miniloader路径为<a target="_blank" rel="noopener" href="https://github.com/rockchip-linux/rkbin.git">https://github.com/rockchip-linux/rkbin.git</a></p>
<p>首先克隆官方的rkbin，瑞芯微提供了闭源的的二进制文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/rockchip-linux/rkbin.git</span><br></pre></td></tr></table></figure>

<p>拉取完成如下图所示：<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272158411.png" alt="image-20230927215856386"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272159325.png" alt="image-20230927215908314"></p>
<p>瑞芯微的README如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Rockchip loader binaries naming rule</span><br><span class="line"></span><br><span class="line">总则：</span><br><span class="line">不管单个模块，还是合并后的loader，命名都采用</span><br><span class="line">[chip]_[module]_[feature]_[version].[postfix]</span><br><span class="line"></span><br><span class="line">chip: 芯片或芯片系列名称, 必选项, 与所有kernel/uboot driver中的名称保持一致, 具体命名方式不在此讨论, 小写</span><br><span class="line">module: 模块名称, 必选项, 如loader, ddr, miniloader，usbplug,bl3x,tee,tee_ta，小写</span><br><span class="line">feature: 模块特征, 可选项, 可多个, 如ddr使用的频率, 或者只支持某个特定的ddr, miniloader的特别选项等, 小写</span><br><span class="line">version: 版本信息, 必选项, 格式采用[v1.00,], 正式发布之前为0.xx, 正式发布后为1.00以后，小写</span><br><span class="line">postfix: 后缀名, 必选项, 代码编译出来的默认为.bin, 也有可能为.elf, 合并后为.img，小写</span><br><span class="line">连接符号采用下划线“_”</span><br><span class="line">例如：</span><br><span class="line">ddr模块提供的文件</span><br><span class="line">rk3228_ddr3_800MHz_v1.06.bin</span><br><span class="line"></span><br><span class="line">特殊规则：</span><br><span class="line">1. 合并后的loader命名:</span><br><span class="line">    loader: 由ddrbin, usbplug, miniloader合并而成可用于Windows RK升级工具使用的loader;</span><br><span class="line">    ubootloader: 由ddrbin, usbplug, U-Boot合并而成可用于Windows RK升级工具使用的loader;</span><br><span class="line">    idbloader: 由ddrbin, 一级loader(miniloader或uboot)按IDB格式合并直接用于烧写到IDB区的binary;</span><br><span class="line">    注: miniloader的命名, 仅表示miniloader工程编译输出的bin, 不再延续到合并后的loader中使用;</span><br><span class="line">2. 合并后的loader的version定义:</span><br><span class="line">    vx.yy.zzz</span><br><span class="line">v:  version的意思，一直采用这个字符，小写</span><br><span class="line">x.yy: ddr所提供文件的版本号，小写</span><br><span class="line">zzz: [1]是miniloader所提供文件的版本号，去掉点号的，小写</span><br><span class="line">     [2]uboot提供的版本号</span><br><span class="line"></span><br><span class="line">3. 命名小写会引起歧义的，就用大写</span><br><span class="line">如ddr的GB，不能写成gb</span><br><span class="line">举例：</span><br><span class="line">合并好的loader命名：</span><br><span class="line">rk3328_loader_v1.03.106.bin</span><br><span class="line">其中的1.03是ddr的版本号v1.03</span><br><span class="line">106是miniloader的版本号v1.06去掉点号的</span><br></pre></td></tr></table></figure>

<p>接下来对这些目录的内容进行介绍</p>
<ol>
<li>**bin&#x2F;**：通常用于存放可执行文件（二进制文件）</li>
</ol>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272203645.png" alt="image-20230927220321625"></p>
<p>进入该目录之后又有一系列的子目录，我们要适配的是3588，所以要进入rk35的目录，具体内容如下所示：<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272204357.png" alt="image-20230927220422326"></p>
<p>根据名称来看总共是有两种类型的二进制文件，分别为rk<strong>ddr*的tpl 和 rk“</strong>”spl的spl，第一个用来进行初始化内存，然后加载spl，spl用来初始化时钟等其他外设，这里我们用到的应该是rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v1.12.bin和rk3588_spl_v1.12.bin两二进制文件，</p>
<p>2.**doc&#x2F;**目录，通常用于存放文档文件。在这个目录下，有着更新时候的一些说明，如下图所示：<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272213894.png" alt="image-20230927221327879"></p>
<p>3.img目录根3588无关不用理会。</p>
<p>4.<strong>LICENSE</strong>：通常用于存放软件或项目的许可证信息</p>
<p>5.README**：是一个简要的说明文件</p>
<p>6.**RKBOOT&#x2F;**：它可能包含与引导（Boot）相关的文件、脚本或配置。具体内容如下所示：<br><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272215234.png" alt="image-20230927221534210"></p>
<p>这个其实是后面讲到uboot make.sh时候的说明，用来将spl和tpl整合成一个完整的miniloader的，我们要用到的是RK3588MINIALL.ini，具体内容如下所示：、</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272217736.png" alt="image-20230927221754711"></p>
<p>Path1&#x3D;bin&#x2F;rk35&#x2F;rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v1.12.bin</p>
<p>FlashData&#x3D;bin&#x2F;rk35&#x2F;rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v1.12.bin</p>
<p>FlashBoot&#x3D;bin&#x2F;rk35&#x2F;rk3588_spl_v1.12.bin</p>
<p>PATH&#x3D;rk3588_spl_loader_v1.12.112.bin</p>
<p>7.<strong>RKBOOT.ini</strong>：不用管</p>
<p>8.**RKTRUST&#x2F;**：这是一个目录，可能与 Rockchip 平台安全性（Trust）相关。根据目录名称，它可能包含与安全启动、安全引导或安全认证相关的文件、脚本或配置。</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309272219951.png" alt="image-20230927221941937"></p>
<p>​	这也是一些ini文件，这是基于开源的bl31和bl32来的，上面的两个流程呀，属于第二条，闭源的miniloader属于第一条。</p>
<ol>
<li>**scripts&#x2F;**：checkpatch.sh只有这一个脚本，看了一下应该没啥用，应该是瑞芯微用于检查时候的一个脚本，</li>
<li>这些脚本可以用于自动化任务、配置设置、编译构建等。</li>
<li>**tools&#x2F;**：这是一个目录，通常用于存放工具文件。工具文件可以是用于特定任务或目的的实用程序、应用程序或脚本。这些工具可以帮助你完成各种操作，如调试、分析、转换等。</li>
</ol>
<p>ddrbin_tool_user_guide.txt 是ddrbin_tool的使用说明，倒是还挺详细，我们要改的是ddr相关的tpl，重要内容整理如下</p>
<p><strong>功能 1：从 ddrbin_param.txt 修改 ddr.bin 文件。</strong></p>
<ol>
<li>修改 ‘ddrbin_param.txt’ 文件，设置你想要的 DDR 频率、UART 信息等。如果想保持默认值，请将这些项目留空。</li>
<li>运行 ‘ddrbin_tool’，并使用以下参数：参数 1 为 ddrbin_param.txt，参数 2 为 ddr.bin 文件。<br>例如：.&#x2F;ddrbin_tool ddrbin_param.txt px30_ddr_333MHz_v1.13.bin</li>
</ol>
<p><strong>功能 2：将 ddr.bin 文件的配置保存到 gen_param.txt 文件中。</strong><br>如果想要获取 ddr.bin 文件的配置，请执行以下操作：<br>.&#x2F;ddrbin_tool -g gen_param.txt px30_ddr_333MHz_v1.15.bin<br>配置信息将显示在 gen_param.txt 文件中。</p>
<p>而我要修改的是rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v1.12.bin，想用功能2 保存到 gen_param.txt</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ddrbin_tool -g  gen_param.txt rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v1.12.bin</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031753004.png" alt="image-20231003175311976"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031753485.png" alt="image-20231003175354464"></p>
<p>修改之后还需要重新生成bin文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ddrbin_tool gen_param.txt rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v1.12.bin</span><br></pre></td></tr></table></figure>

<p><strong><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031756166.png" alt="image-20231003175617140"></strong></p>
<p>修改的地方只有这里的115200，其他倒是没关，然后就是看看如何整合spl和tpl了，整合成一个完整的loader.bin</p>
<p>这里我就不用uboot的的make.sh了，而是找到他的命令和makefile具体内容如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function pack_loader_image()</span><br><span class="line">&#123;</span><br><span class="line">	rm -f *loader*.bin *download*.bin *idblock*.img</span><br><span class="line">	cd $&#123;RKBIN&#125;</span><br><span class="line">	DEF_PATH=$&#123;RKBIN&#125;/`filt_val &quot;^PATH&quot; $&#123;INI_LOADER&#125;`</span><br><span class="line">	IDB_PATH=$&#123;RKBIN&#125;/`filt_val &quot;IDB_PATH&quot; $&#123;INI_LOADER&#125;`</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">&#123;SCRIPT_LOADER&#125; --ini <span class="variable">$&#123;INI_LOADER&#125;</span></span></span><br><span class="line">	cd -</span><br><span class="line">	if [ -f $&#123;DEF_PATH&#125; ]; then</span><br><span class="line">		mv $&#123;DEF_PATH&#125; ./</span><br><span class="line">	fi</span><br><span class="line">	if [ -f $&#123;IDB_PATH&#125; ]; then</span><br><span class="line">		mv $&#123;IDB_PATH&#125; ./</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Copyright (c) 2020 Rockchip Electronics Co., Ltd</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># SPDX-License-Identifier: GPL-2.0</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span></span><br><span class="line">set -e</span><br><span class="line"></span><br><span class="line">if [ $# -eq 0 ]; then</span><br><span class="line">	echo &quot;ERROR: No args of $0&quot;</span><br><span class="line">	exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">while [ $# -gt 0 ]; do</span><br><span class="line">	case $1 in</span><br><span class="line">		--ini)</span><br><span class="line">			INI=$2</span><br><span class="line">			shift 2</span><br><span class="line">			;;</span><br><span class="line">		*)</span><br><span class="line">			echo &quot;ERROR: Unknown arg: $1&quot;</span><br><span class="line">			exit 1</span><br><span class="line">			;;</span><br><span class="line">	esac</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">if [ ! -f $&#123;INI&#125; ]; then</span><br><span class="line">	echo &quot;pack loader failed! Can&#x27;t find: $&#123;INI&#125;&quot;</span><br><span class="line">	exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">COUNT=`cat $&#123;INI&#125; | wc -l`</span><br><span class="line">if [ $&#123;COUNT&#125; -eq 1 ]; then</span><br><span class="line">	IMG=`sed -n &quot;/PATH=/p&quot; $&#123;INI&#125; | tr -d &#x27;\r&#x27; | cut -d &#x27;=&#x27; -f 2`</span><br><span class="line">	cp $&#123;IMG&#125; ./</span><br><span class="line">else</span><br><span class="line">	./tools/boot_merger $&#123;INI&#125;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo &quot;pack loader okay! Input: $&#123;INI&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>最后用的还是boot_merger这个工具。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./tools/boot_merger RKBOOT/RK3588MINIALL.ini</span><br></pre></td></tr></table></figure>



<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031810759.png" alt="image-20231003181000745"></p>
<p>关于spl和tpl就这样了，然后是uboot</p>
<h1 id="2-uboot"><a href="#2-uboot" class="headerlink" title="2.uboot"></a>2.uboot</h1><p>克隆源码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/rockchip-linux/u-boot.git</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031845388.png" alt="image-20231003184552359"></p>
<p>修改make menuconfig，rk3588的默认配置文件为.&#x2F;configs&#x2F;rk3588_defconfig</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031852329.png" alt="image-20231003185216305"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export arch=arm64</span><br><span class="line">make rk3588_defconfig</span><br><span class="line">make menuconfig</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031855129.png" alt="image-20231003185541087"></p>
<p>目前只需要将这里的uboot修改为115200即可，然后重新保存configs&#x2F;rk3588_defconfig，重新编译</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export arch=arm64</span><br><span class="line">make rk3588_defconfig</span><br><span class="line">make CROSS_COMPILE=&quot;aarch64-linux-gnu-&quot; -j32</span><br><span class="line">modules_install</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031858771.png" alt="image-20231003185809741"></p>
<p>编译完这里的uboot.img就是我们需要的镜像，不对，后来发现事情并不是想的那样，理论上应该是uboot.img这里的选择不对。所以接下来去寻找uboot.img的生成流程</p>
<p>实际应该是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./make.sh rk3588 CROSS_COMPILE=aarch64-linux-gnu-</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310031920218.png" alt="image-20231003192010183"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译uboot.itb</span></span><br><span class="line">make CROSS_COMPILE=&quot;aarch64-linux-gnu-&quot; -j32 u-boot.itb</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310051037632.png" alt="image-20231005103717571"></p>
<p>但是并没有找到源头，然后找一下make.sh的内容具体内容如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打包生成uboot镜像</span></span><br><span class="line">function pack_uboot_image()</span><br><span class="line">&#123;</span><br><span class="line">	rm u-boot.img u-boot-dtb.img -f</span><br><span class="line">	LOAD_ADDR=`sed -n &quot;/CONFIG_SYS_TEXT_BASE=/s/CONFIG_SYS_TEXT_BASE=//p&quot; include/autoconf.mk|tr -d &#x27;\r&#x27;`</span><br><span class="line">	if [ -z &quot;$&#123;LOAD_ADDR&#125;&quot; ]; then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">upstream U-Boot</span></span><br><span class="line">		LOAD_ADDR=`grep CONFIG_SYS_TEXT_BASE include/generated/autoconf.h | awk &#x27;&#123; print $3 &#125;&#x27; | tr -d &#x27;\r&#x27;`</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [ -z &quot;$&#123;LOAD_ADDR&#125;&quot; ]; then</span><br><span class="line">		echo &quot;ERROR: No CONFIG_SYS_TEXT_BASE for u-boot&quot;;</span><br><span class="line">		exit 1</span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">&#123;SCRIPT_UBOOT&#125; --load <span class="variable">$&#123;LOAD_ADDR&#125;</span> <span class="variable">$&#123;PLAT_UBOOT_SIZE&#125;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SCRIPT_UBOOT&#x3D;”${SRCTREE}&#x2F;scripts&#x2F;uboot.sh”</p>
<p>LOAD_ADDR&#x3D;0x00200000</p>
<p>–size 2048 1</p>
<p>configs&#x2F;rk3588-ramboot.config:4:CONFIG_UBOOT_SIZE_KB&#x3D;2048</p>
<p>configs&#x2F;rk3588-ramboot.config:5:CONFIG_UBOOT_NUM&#x3D;1</p>
<p>可行的代码为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./scripts/uboot.sh --load  0x00200000 --size 2048 1</span><br></pre></td></tr></table></figure>



<p>uboot.sh内容如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Copyright (c) 2020 Rockchip Electronics Co., Ltd</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># SPDX-License-Identifier: GPL-2.0</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span></span><br><span class="line">set -e</span><br><span class="line"></span><br><span class="line">if [ $# -eq 0 ]; then</span><br><span class="line">        echo &quot;ERROR: No args of $0&quot;</span><br><span class="line">        exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">while [ $# -gt 0 ]; do</span><br><span class="line">        case $1 in</span><br><span class="line">                --load)</span><br><span class="line">                        LOAD_ADDR=$2</span><br><span class="line">                        shift 2</span><br><span class="line">                        ;;</span><br><span class="line">                --size)</span><br><span class="line">                        SIZE=&quot;$1 $2 $3&quot;</span><br><span class="line">                        shift 3</span><br><span class="line">                        ;;</span><br><span class="line">                *)</span><br><span class="line">                        echo &quot;ERROR: Unknown arg: $1&quot;</span><br><span class="line">                        exit 1</span><br><span class="line">                        ;;</span><br><span class="line">        esac</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">rm uboot.img -f</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$&#123;LOAD_ADDR&#125;&quot; ]; then</span><br><span class="line">        echo &quot;ERROR: No load address&quot;</span><br><span class="line">        exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">HEAD_KB=2</span><br><span class="line">BIN_KB=`ls -l u-boot.bin | awk &#x27;&#123; print $5 &#125;&#x27;`</span><br><span class="line">if [ -z &quot;$&#123;SIZE&#125;&quot; ]; then</span><br><span class="line">        MAX_KB=1046528</span><br><span class="line">else</span><br><span class="line">        MAX_KB=`echo $&#123;SIZE&#125; | awk &#x27;&#123;print strtonum($2)&#125;&#x27;`</span><br><span class="line">        MAX_KB=$(((MAX_KB-HEAD_KB)*1024))</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $&#123;BIN_KB&#125; -gt $&#123;MAX_KB&#125; ]; then</span><br><span class="line">        echo &quot;ERROR: pack uboot failed! u-boot.bin actual: $&#123;BIN_KB&#125; bytes, max limit: $&#123;MAX_KB&#125; bytes&quot;</span><br><span class="line">        exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">../rkbin/tools/loaderimage --pack --uboot u-boot.bin uboot.img $&#123;LOAD_ADDR&#125; $&#123;SIZE&#125;</span><br><span class="line">echo &quot;pack uboot okay! Input: u-boot.bin&quot;</span><br><span class="line">echo</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而实际上使用的命令是</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../rkbin/tools/loaderimage --pack --uboot u-boot.bin uboot.img 0x00200000 --size 2048 1</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310032021655.png" alt="image-20231003202108625"></p>
<p>不知道他的源码呀~~~~，这就没意思了。。。先这样吧。</p>
<h1 id="3-kernel"><a href="#3-kernel" class="headerlink" title="3.kernel"></a>3.kernel</h1><p>git拉取源码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/rockchip-linux/kernel.git</span><br></pre></td></tr></table></figure>



<p>查看全部分支，如下所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310032034502.png" alt="image-20231003203437480"></p>
<p>我直接一步到位，直接到5.10就行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout develop-5.10</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310032036427.png" alt="image-20231003203633412"></p>
<p>然后寻找kernel的编译过程，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建 Kernel</span></span><br><span class="line">build_kernel()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">检查 RK_KERNEL_DTS 和 RK_KERNEL_DEFCONFIG 配置是否存在，若不存在则返回</span></span><br><span class="line">	check_config RK_KERNEL_DTS RK_KERNEL_DEFCONFIG || return 0</span><br><span class="line"></span><br><span class="line">	echo &quot;============Start building kernel============&quot;</span><br><span class="line">	echo &quot;TARGET_KERNEL_ARCH   =$RK_KERNEL_ARCH&quot;</span><br><span class="line">	echo &quot;TARGET_KERNEL_CONFIG =$RK_KERNEL_DEFCONFIG&quot;</span><br><span class="line">	echo &quot;TARGET_KERNEL_DTS    =$RK_KERNEL_DTS&quot;</span><br><span class="line">	echo &quot;TARGET_KERNEL_CONFIG_FRAGMENT =$RK_KERNEL_DEFCONFIG_FRAGMENT&quot;</span><br><span class="line">	echo &quot;==========================================&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">设置交叉编译工具链</span></span><br><span class="line">	setup_cross_compile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">使用 KMAKE 构建 Kernel</span></span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">KMAKE <span class="variable">$RK_KERNEL_DEFCONFIG</span> <span class="variable">$RK_KERNEL_DEFCONFIG_FRAGMENT</span></span></span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">KMAKE <span class="variable">$RK_KERNEL_DTS</span>.img</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">检查是否存在 Kernel FIT 文件并使用 mk-fitimage.sh 创建镜像</span></span><br><span class="line">	ITS=&quot;$CHIP_DIR/$RK_KERNEL_FIT_ITS&quot;</span><br><span class="line">	if [ -f &quot;$ITS&quot; ]; then</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">COMMON_DIR/mk-fitimage.sh kernel/<span class="variable">$RK_BOOT_IMG</span> \</span></span><br><span class="line"><span class="language-bash">			<span class="string">&quot;<span class="variable">$ITS</span>&quot;</span> <span class="variable">$RK_KERNEL_IMG</span></span></span><br><span class="line">	fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">创建链接到 rockdev 目录的 boot.img</span></span><br><span class="line">	ln -rsf kernel/$RK_BOOT_IMG rockdev/boot.img</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">将 boot.img 复制到 u-boot 目录下，用于安全性考虑</span></span><br><span class="line">	cp rockdev/boot.img u-boot/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">构建检查电源域</span></span><br><span class="line">	build_check_power_domain</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">完成构建流程</span></span><br><span class="line">	finish_build</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">KMAKE=&quot;make ARCH=arm64 -j32&quot; </span><br><span class="line">CROSS_COMPILE=aarch64-linux-gnu-</span><br></pre></td></tr></table></figure>





<pre><code>make ARCH=arm64 -j32  CROSS_COMPILE=aarch64-linux-gnu- rockchip_linux_defconfig rk3588_linux.config
make ARCH=arm64 -j32  CROSS_COMPILE=aarch64-linux-gnu- rk3588-evb7-lp4-v10-linux.img
</code></pre>
<p>编译成功，但是还需要修改波特率，要修改的设备树为rk3588-linux.dtsi</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310032048880.png" alt="image-20231003204847848"></p>
<p>然后修改rk3588-evb7-lp4.dtsi文件，里面有PCIE相关的内容，需要disabled不然会卡在内核</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310032056361.png" alt="image-20231003205604330"></p>
<p>反正现在的dhmi屏幕问题不大，就先这样了。</p>
<h1 id="4-image"><a href="#4-image" class="headerlink" title="4.image"></a>4.image</h1><p>首先git大佬的源码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/Joshua-Riek/ubuntu-rockchip.git</span><br></pre></td></tr></table></figure>

<p>我这里先以香橙派为例进行编译</p>
<p>export VENDOR&#x3D;orangepi</p>
<p>export BOARD&#x3D;orangepi-5b</p>
<p>build-u-boot.sh内容如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">set -eE </span><br><span class="line">trap &#x27;echo Error: in $0 on line $LINENO&#x27; ERR</span><br><span class="line"></span><br><span class="line">if [ &quot;$(id -u)&quot; -ne 0 ]; then</span><br><span class="line">    echo &quot;Please run as root&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">cd &quot;$(dirname -- &quot;$(readlink -f -- &quot;$0&quot;)&quot;)&quot; &amp;&amp; cd ..</span><br><span class="line">mkdir -p build &amp;&amp; cd build</span><br><span class="line"></span><br><span class="line">if [[ -z $&#123;VENDOR&#125; ]]; then</span><br><span class="line">    echo &quot;Error: VENDOR is not set&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ ! -d u-boot-&quot;$&#123;VENDOR&#125;&quot; ]; then</span><br><span class="line">    # shellcheck source=/dev/null</span><br><span class="line">    source ../packages/u-boot-&quot;$&#123;VENDOR&#125;&quot;-rk3588/debian/upstream</span><br><span class="line">    git clone --single-branch --progress -b &quot;$&#123;BRANCH&#125;&quot; &quot;$&#123;GIT&#125;&quot; u-boot-&quot;$&#123;VENDOR&#125;&quot;</span><br><span class="line">    git -C u-boot-&quot;$&#123;VENDOR&#125;&quot; checkout &quot;$&#123;COMMIT&#125;&quot;</span><br><span class="line">    cp -r ../packages/u-boot-&quot;$&#123;VENDOR&#125;&quot;-rk3588/debian u-boot-&quot;$&#123;VENDOR&#125;&quot;</span><br><span class="line">fi</span><br><span class="line">cd u-boot-&quot;$&#123;VENDOR&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Compile u-boot into a deb package</span></span><br><span class="line">dpkg-buildpackage -a &quot;$(cat debian/arch)&quot; -d -b -nc -uc</span><br><span class="line"></span><br><span class="line">rm -f ../*.buildinfo ../*.changes</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>build.sh内容如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mkdir -p build/logs</span><br><span class="line">exec &gt; &gt;(tee &quot;build/logs/build-$(date +&quot;%Y%m%d%H%M%S&quot;).log&quot;) 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">if [[ $&#123;KERNEL_ONLY&#125; == &quot;Y&quot; ]]; then</span><br><span class="line">    eval &quot;$&#123;DOCKER&#125;&quot; ./scripts/build-kernel.sh</span><br><span class="line">    exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;UBOOT_ONLY&#125; == &quot;Y&quot; ]]; then</span><br><span class="line">    eval &quot;$&#123;DOCKER&#125;&quot; ./scripts/build-u-boot.sh</span><br><span class="line">    exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;LAUNCHPAD&#125; != &quot;Y&quot; ]]; then</span><br><span class="line">    if [[ ! -e &quot;$(find build/linux-image-*.deb | sort | tail -n1)&quot; || ! -e &quot;$(find build/linux-headers-*.deb | sort | tail -n1)&quot; ]]; then</span><br><span class="line">        eval &quot;$&#123;DOCKER&#125;&quot; ./scripts/build-kernel.sh</span><br><span class="line">    fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;LAUNCHPAD&#125; != &quot;Y&quot; ]]; then</span><br><span class="line">    if [[ ! -e &quot;$(find build/u-boot-&quot;$&#123;BOARD&#125;&quot;_*.deb | sort | tail -n1)&quot; ]]; then</span><br><span class="line">        eval &quot;$&#123;DOCKER&#125;&quot; ./scripts/build-u-boot.sh</span><br><span class="line">    fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">eval &quot;$&#123;DOCKER&#125;&quot; ./scripts/build-rootfs.sh</span><br><span class="line">eval &quot;$&#123;DOCKER&#125;&quot; ./scripts/config-image.sh</span><br><span class="line"></span><br><span class="line">exit 0</span><br><span class="line">                                                                                                                                     </span><br></pre></td></tr></table></figure>



<p>boot.cmd</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setenv bootargs &quot;console=ttyS2,115200 earlycon=uart8250,mmio32,0xff130000 root=/dev/mmcblk1p2 rw rootwait&quot;</span><br><span class="line">load mmc 1:1 $&#123;fdt_addr_r&#125; rk3588-evb7-lp4-v10-linux.dtb</span><br><span class="line">setenv kernel_comp_addr_r 0x0a000000</span><br><span class="line">load mmc 1:1 $&#123;kernel_addr_r&#125; Image.gz</span><br><span class="line">setenv kernel_comp_size $&#123;filesize&#125;</span><br><span class="line">booti $&#123;kernel_addr_r&#125; - $&#123;fdt_addr_r&#125;</span><br></pre></td></tr></table></figure>

<p>mkimage -A arm -O linux -T script -C none -a 0 -e 0 -d boot.cmd boot.scr</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310041050935.png" alt="image-20231004105004887"></p>
<p>安装内核模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make ARCH=arm64 CROSS_COMPILE=&quot;aarch64-linux-gnu-&quot; INSTALL_MOD_STRIP=1 INSTALL_MOD_PATH=&quot;/home/topeet/rockchip/image/lib&quot; modules_install -j32</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310041100339.png" alt="image-20231004110040296"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find -name &quot;*ko&quot; -exec cp &#123;&#125; /home/topeet/rockchip/image/rootfs/lib/modules/5.10.110 \;</span><br><span class="line">find -name &quot;*ko&quot; | xargs -I &#123;&#125; cp &#123;&#125; /home/topeet/rockchip/image/rootfs/lib/modules/5.10.110</span><br></pre></td></tr></table></figure>



<p>制作完整的镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gen_image_generic.sh &lt;file&gt; &lt;kernel size&gt; &lt;kernel directory&gt; &lt;rootfs size&gt; &lt;rootfs image&gt; [&lt;align&gt;]</span><br></pre></td></tr></table></figure>

<p>其中，<code>&lt;file&gt;</code>是要生成的镜像文件的名称，<code>&lt;kernel size&gt;</code>是内核文件系统的大小，<code>&lt;kernel directory&gt;</code>是包含内核文件系统内容的目录，<code>&lt;rootfs size&gt;</code>是根文件系统的大小，<code>&lt;rootfs image&gt;</code>是根文件系统的镜像文件，<code>&lt;align&gt;</code>是可选的对齐参数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gen_image_generic.sh system.img 100 boot 7144 rootfs.img 32768</span><br></pre></td></tr></table></figure>



<p>写入uboot</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dd if=uboot.img of=system.img seek=64 conv=notrunc</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dd if=system.img of=/dev/sdc status=progress</span><br></pre></td></tr></table></figure>

<h1 id="5-打包"><a href="#5-打包" class="headerlink" title="5.打包"></a>5.打包</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">build_updateimg()</span><br><span class="line">&#123;</span><br><span class="line">	IMAGE_PATH=$TOP_DIR/rockdev   # 设置IMAGE_PATH变量为$TOP_DIR/rockdev，用于存储生成的镜像文件路径</span><br><span class="line">	PACK_TOOL_DIR=$TOP_DIR/tools/linux/Linux_Pack_Firmware   # 设置PACK_TOOL_DIR变量为$TOP_DIR/tools/linux/Linux_Pack_Firmware，用于存储打包工具的路径</span><br><span class="line"></span><br><span class="line">	cd $PACK_TOOL_DIR/rockdev   # 进入$PACK_TOOL_DIR/rockdev目录</span><br><span class="line"></span><br><span class="line">	if [ -f &quot;$RK_PACKAGE_FILE_AB&quot; ]; then   # 如果存在$RK_PACKAGE_FILE_AB文件</span><br><span class="line">		build_sdcard_package   # 调用build_sdcard_package函数，构建SD卡包</span><br><span class="line">		build_otapackage   # 调用build_otapackage函数，构建OTA包</span><br><span class="line"></span><br><span class="line">		cd $PACK_TOOL_DIR/rockdev   # 返回$PACK_TOOL_DIR/rockdev目录</span><br><span class="line">		echo &quot;Make Linux a/b update_ab.img.&quot;</span><br><span class="line">		source_package_file_name=`ls -lh package-file | awk -F &#x27; &#x27; &#x27;&#123;print $NF&#125;&#x27;`   # 获取package-file的文件名</span><br><span class="line">		ln -fs &quot;$RK_PACKAGE_FILE_AB&quot; package-file   # 创建软链接，将$RK_PACKAGE_FILE_AB链接到package-file</span><br><span class="line">		./mkupdate.sh   # 运行mkupdate.sh脚本，生成update.img</span><br><span class="line">		mv update.img $IMAGE_PATH/update_ab.img   # 将生成的update.img移动到$IMAGE_PATH/update_ab.img</span><br><span class="line">		ln -fs $source_package_file_name package-file   # 创建软链接，将source_package_file_name链接到package-file</span><br><span class="line">	else</span><br><span class="line">		echo &quot;Make update.img&quot;</span><br><span class="line"></span><br><span class="line">		if [ -f &quot;$RK_PACKAGE_FILE&quot; ]; then   # 如果存在$RK_PACKAGE_FILE文件</span><br><span class="line">			source_package_file_name=`ls -lh package-file | awk -F &#x27; &#x27; &#x27;&#123;print $NF&#125;&#x27;`   # 获取package-file的文件名</span><br><span class="line">			ln -fs &quot;$RK_PACKAGE_FILE&quot; package-file   # 创建软链接，将$RK_PACKAGE_FILE链接到package-file</span><br><span class="line">			./mkupdate.sh   # 运行mkupdate.sh脚本，生成update.img</span><br><span class="line">			ln -fs $source_package_file_name package-file   # 创建软链接，将source_package_file_name链接到package-file</span><br><span class="line">		else</span><br><span class="line">			./mkupdate.sh   # 运行mkupdate.sh脚本，生成update.img</span><br><span class="line">		fi</span><br><span class="line">		mv update.img $IMAGE_PATH   # 将生成的update.img移动到$IMAGE_PATH</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	finish_build   # 调用finish_build函数，进行后续的清理和处理操作</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>研究了一下这个玩意，这个打包完成确实是问题不大，现在我只想知道boot.img是怎样编译出来的</p>
<p>boot.img kernel.img resource.img zboot.img</p>
<p>最后找到发现是在scripts&#x2F;mkimg脚本里，里面有一个repack_boot_img的函数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">make_boot_img()</span><br><span class="line">&#123;</span><br><span class="line">        RAMDISK_IMG_PATH=$&#123;objtree&#125;/ramdisk.img</span><br><span class="line">        [ -f $&#123;RAMDISK_IMG_PATH&#125; ] &amp;&amp; RAMDISK_IMG=ramdisk.img &amp;&amp; RAMDISK_ARG=&quot;--ramdisk $&#123;RAMDISK_IMG_PATH&#125;&quot;</span><br><span class="line"></span><br><span class="line">        $&#123;srctree&#125;/scripts/mkbootimg \</span><br><span class="line">                $&#123;KERNEL_IMAGE_ARG&#125; \</span><br><span class="line">                $&#123;RAMDISK_ARG&#125; \</span><br><span class="line">                --second resource.img \</span><br><span class="line">                -o boot.img &amp;&amp; \</span><br><span class="line">        echo &quot;  Image:  boot.img (with Image $&#123;RAMDISK_IMG&#125; resource.img) is ready&quot;;</span><br><span class="line">        echo                 $&#123;KERNEL_IMAGE_ARG&#125; \</span><br><span class="line">                $&#123;RAMDISK_ARG&#125; \</span><br><span class="line">                --second resource.img \</span><br><span class="line">                -o boot.img &amp;&amp; \</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        $&#123;srctree&#125;/scripts/mkbootimg \</span><br><span class="line">                $&#123;KERNEL_ZIMAGE_ARG&#125; \</span><br><span class="line">                $&#123;RAMDISK_ARG&#125; \</span><br><span class="line">                --second resource.img \</span><br><span class="line">                -o zboot.img &amp;&amp; \</span><br><span class="line">        echo &quot;  Image:  zboot.img (with $&#123;ZIMAGE&#125; $&#123;RAMDISK_IMG&#125; resource.img) is ready&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>resource.img的由来</p>
<p>LOGO&#x3D;logo.bmp</p>
<p>LOGO_KERNEL&#x3D;logo_kernel.bmp</p>
<p>DTB_PATH&#x3D;${objtree}&#x2F;arch&#x2F;arm&#x2F;boot&#x2F;dts&#x2F;rk3588-evb7-lp4-v10-linux.dtb</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scripts/resource_tool $&#123;DTB_PATH&#125; $&#123;LOGO&#125; $&#123;LOGO_KERNEL&#125;</span><br><span class="line">scripts/resource_tool arch/arm64/boot/dts/rockchip/rk3588-evb7-lp4-v10-linux.dtb logo.bmp logo_kernel.bmp</span><br></pre></td></tr></table></figure>

<p>然后可以用下面的命令解包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scripts/resource_tool --verbose --unpack --image=resource.img</span><br></pre></td></tr></table></figure>



<p>而是实际的打包其实是repack-bootimg这个脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;srctree&#125;/scripts/mkbootimg \</span></span><br><span class="line"><span class="language-bash">        <span class="variable">$&#123;KERNEL_IMAGE_ARG&#125;</span> \</span></span><br><span class="line"><span class="language-bash">        <span class="variable">$&#123;RAMDISK_ARG&#125;</span> \</span></span><br><span class="line"><span class="language-bash">        --second resource.img \</span></span><br><span class="line"><span class="language-bash">        -o boot.img &amp;&amp; \</span></span><br></pre></td></tr></table></figure>

<p>打包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scripts/mkbootimg --kernel ./arch/arm64/boot/Image --second resource.img -o boot.img</span><br></pre></td></tr></table></figure>



<p>再一绕发现是mkbootimg这个脚本，，，真的6</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">srctree/scripts/mkbootimg \</span></span><br><span class="line"><span class="language-bash">--kernel <span class="variable">$kernel</span> \</span></span><br><span class="line"><span class="language-bash"><span class="variable">$SECOND</span> \</span></span><br><span class="line"><span class="language-bash">--ramdisk <span class="variable">$ramdisk</span> \</span></span><br><span class="line"><span class="language-bash"><span class="variable">$DTB</span> \</span></span><br><span class="line"><span class="language-bash"><span class="variable">$RECOVERY_DTBO</span> \</span></span><br><span class="line"><span class="language-bash">--cmdline <span class="string">&quot;<span class="variable">$&#123;cmdline&#125;</span><span class="variable">$&#123;extra_cmdline&#125;</span>&quot;</span> \</span></span><br><span class="line"><span class="language-bash">--header_version <span class="variable">$version</span> \</span></span><br><span class="line"><span class="language-bash">--os_version <span class="variable">$os_version</span> \</span></span><br><span class="line"><span class="language-bash">--os_patch_level <span class="variable">$os_patch_level</span> \</span></span><br><span class="line"><span class="language-bash">--output <span class="variable">$output</span></span></span><br><span class="line">                      </span><br></pre></td></tr></table></figure>

<p>一些相关内容如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">mkbootimg命令的帮助信息，它用于创建Android引导镜像。</span><br><span class="line"></span><br><span class="line">命令的用法如下：</span><br><span class="line"></span><br><span class="line">shell</span><br><span class="line">Copy</span><br><span class="line">mkbootimg [-h] [--kernel KERNEL] [--ramdisk RAMDISK] [--second SECOND]</span><br><span class="line">          [--dtb DTB] [--recovery_dtbo RECOVERY_DTBO | --recovery_acpio RECOVERY_ACPIO]</span><br><span class="line">          [--cmdline CMDLINE] [--vendor_cmdline VENDOR_CMDLINE]</span><br><span class="line">          [--base BASE] [--kernel_offset KERNEL_OFFSET]</span><br><span class="line">          [--ramdisk_offset RAMDISK_OFFSET]</span><br><span class="line">          [--second_offset SECOND_OFFSET] [--dtb_offset DTB_OFFSET]</span><br><span class="line">          [--os_version OS_VERSION] [--os_patch_level OS_PATCH_LEVEL]</span><br><span class="line">          [--tags_offset TAGS_OFFSET] [--board BOARD]</span><br><span class="line">          [--pagesize &#123;2048,4096,8192,16384&#125;] [--id]</span><br><span class="line">          [--header_version HEADER_VERSION] [-o OUTPUT]</span><br><span class="line">          [--vendor_boot VENDOR_BOOT] [--vendor_ramdisk VENDOR_RAMDISK]</span><br><span class="line">以下是参数的说明：</span><br><span class="line"></span><br><span class="line">-h, --help：显示帮助信息并退出。</span><br><span class="line">--kernel KERNEL：指定内核文件的路径。</span><br><span class="line">--ramdisk RAMDISK：指定ramdisk文件的路径。</span><br><span class="line">--second SECOND：指定第二级引导加载程序文件的路径。</span><br><span class="line">--dtb DTB：指定设备树二进制文件的路径。</span><br><span class="line">--recovery_dtbo RECOVERY_DTBO：指定恢复DTBO文件的路径。</span><br><span class="line">--recovery_acpio RECOVERY_ACPIO：指定恢复ACPIO文件的路径。</span><br><span class="line">--cmdline CMDLINE：指定传递给内核命令行的额外参数。</span><br><span class="line">--vendor_cmdline VENDOR_CMDLINE：包含在供应商引导中的内核命令行参数。</span><br><span class="line">--base BASE：指定基地址。</span><br><span class="line">--kernel_offset KERNEL_OFFSET：指定内核偏移量。</span><br><span class="line">--ramdisk_offset RAMDISK_OFFSET：指定ramdisk偏移量。</span><br><span class="line">--second_offset SECOND_OFFSET：指定第二级引导加载程序偏移量。</span><br><span class="line">--dtb_offset DTB_OFFSET：指定设备树偏移量。</span><br><span class="line">--os_version OS_VERSION：操作系统版本。</span><br><span class="line">--os_patch_level OS_PATCH_LEVEL：操作系统补丁级别。</span><br><span class="line">--tags_offset TAGS_OFFSET：标签偏移量。</span><br><span class="line">--board BOARD：板级名称。</span><br><span class="line">--pagesize &#123;2048,4096,8192,16384&#125;：页面大小。</span><br><span class="line">--id：在标准输出中打印图像ID。</span><br><span class="line">--header_version HEADER_VERSION：引导镜像头版本。</span><br><span class="line">-o OUTPUT, --output OUTPUT：输出文件名。</span><br><span class="line">--vendor_boot VENDOR_BOOT：供应商引导输出文件名。</span><br><span class="line">--vendor_ramdisk VENDOR_RAMDISK：指定供应商ramdisk文件的路径。</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%91%9E%E8%8A%AF%E5%BE%AE%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90/" rel="tag">瑞芯微脚本分析</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-0-18 启动流程重新学习"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/09/27/0-18%20%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E9%87%8D%E6%96%B0%E5%AD%A6%E4%B9%A0/"
    >0-18 启动流程重新学习</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/09/27/0-18%20%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E9%87%8D%E6%96%B0%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time datetime="2023-09-27T12:47:53.000Z" itemprop="datePublished">2023-09-27</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%91%9E%E8%8A%AF%E5%BE%AE%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90/">瑞芯微固件分析</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <hr>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310051043799.jpeg" alt="Rockchip bootflow.jpg"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310051043008.png" alt="image-20231005104329930"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310051048987.png" alt="image-20231005104803929"></p>
<h1 id="1-开源spl和tpl和uboot-its"><a href="#1-开源spl和tpl和uboot-its" class="headerlink" title="1. 开源spl和tpl和uboot.its"></a>1. 开源spl和tpl和uboot.its</h1><p>首先便有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export arch=arm64</span><br><span class="line">make rk3588_defconfig</span><br><span class="line">./make.sh rk3588 CROSS_COMPILE=aarch64-linux-gnu-</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310051105515.png" alt="image-20231003192010183"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译uboot.itb</span></span><br><span class="line">make CROSS_COMPILE=&quot;aarch64-linux-gnu-&quot; -j32 u-boot.itb</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310051105508.png" alt="image-20231005103717571"></p>
<p>最后制作idbloader.img</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tools/mkimage -n rk3588 -T rksd -d \</span><br><span class="line">../rkbin/bin/rk35/rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v1.12.bin:spl/u-boot-spl.bin \</span><br><span class="line">idbloader.img</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dd if=idbloader.img of=/dev/sdc seek=64 conv=notrunc</span><br><span class="line">dd if=u-boot.itb of=/dev/sdc seek=16384 conv=notrunc</span><br></pre></td></tr></table></figure>

<p>dd if&#x3D;uboot.img of&#x3D;&#x2F;dev&#x2F;sdd seek&#x3D;16384 conv&#x3D;notrunc</p>
<p>uboot.img</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/topeet/rockchip/u-boot/tools/mkimage -A arm64 -O linux -T script -C none -n &quot;Boot Script&quot; -d boot.cmd boot.scr</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">set -eE </span><br><span class="line">trap &#x27;echo Error: in $0 on line $LINENO&#x27; ERR</span><br><span class="line"></span><br><span class="line">cleanup_loopdev() &#123;</span><br><span class="line">    local loop=&quot;$1&quot;</span><br><span class="line"></span><br><span class="line">    sync --file-system  # 同步文件系统的缓冲区</span><br><span class="line">    sync</span><br><span class="line"></span><br><span class="line">    sleep 1  # 等待一秒钟，确保同步操作完成</span><br><span class="line"></span><br><span class="line">    if [ -b &quot;$&#123;loop&#125;&quot; ]; then  # 检查循环设备是否存在</span><br><span class="line">        for part in &quot;$&#123;loop&#125;&quot;p*; do  # 遍历循环设备的所有分区</span><br><span class="line">            if mnt=$(findmnt -n -o target -S &quot;$part&quot;); then  # 查找与分区相关联的挂载点</span><br><span class="line">                umount &quot;$&#123;mnt&#125;&quot;  # 卸载挂载点</span><br><span class="line">            fi</span><br><span class="line">        done</span><br><span class="line">        losetup -d &quot;$&#123;loop&#125;&quot;  # 卸载循环设备</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">wait_loopdev() &#123;</span><br><span class="line">    local loop=&quot;$1&quot;</span><br><span class="line">    local seconds=&quot;$2&quot;</span><br><span class="line"></span><br><span class="line">    until test $((seconds--)) -eq 0 -o -b &quot;$&#123;loop&#125;&quot;; do sleep 1; done  # 循环等待直到循环设备出现或超过指定的秒数</span><br><span class="line"></span><br><span class="line">    ((++seconds))  # 将秒数加1，用于记录循环设备出现的时间</span><br><span class="line"></span><br><span class="line">    ls -l &quot;$&#123;loop&#125;&quot; &amp;&gt; /dev/null  # 对循环设备进行列表操作，并将输出重定向到/dev/null（丢弃输出）</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检测是否为root用户</span></span><br><span class="line">if [ &quot;$(id -u)&quot; -ne 0 ]; then </span><br><span class="line">    echo &quot;Please run as root&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检测第一个参数是不是为tar文件</span></span><br><span class="line">if [ -z &quot;$1&quot; ]; then</span><br><span class="line">    echo &quot;Usage: $0 filename.rootfs.tar&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检测输入参数文件的格式</span></span><br><span class="line">rootfs=&quot;$(readlink -f &quot;$1&quot;)&quot;</span><br><span class="line">if [[ &quot;$(basename &quot;$&#123;rootfs&#125;&quot;)&quot; != *&quot;.rootfs.tar&quot; || ! -e &quot;$&#123;rootfs&#125;&quot; ]]; then</span><br><span class="line">    echo &quot;Error: $(basename &quot;$&#123;rootfs&#125;&quot;) must be a rootfs tarfile&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建image和build文件</span></span><br><span class="line">cd &quot;$(dirname -- &quot;$(readlink -f -- &quot;$0&quot;)&quot;)&quot; &amp;&amp; cd ..</span><br><span class="line">mkdir -p images build &amp;&amp; cd build</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检测board参数是不是设置了</span></span><br><span class="line">if [[ -z $&#123;BOARD&#125; ]]; then</span><br><span class="line">    echo &quot;Error: BOARD is not set&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检测VENDOR参数是不是设置了</span></span><br><span class="line">if [[ -z $&#123;VENDOR&#125; ]]; then</span><br><span class="line">    echo &quot;Error: VENDOR is not set&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据BOARD选择 DEVICE_TREE和OVERLAY_PREFIX</span></span><br><span class="line">if [[ &quot;$&#123;BOARD&#125;&quot; == orangepi-5 ]]; then</span><br><span class="line">    DEVICE_TREE=rk3588s-orangepi-5.dtb</span><br><span class="line">    OVERLAY_PREFIX=orangepi-5</span><br><span class="line">elif [[ &quot;$&#123;BOARD&#125;&quot; == orangepi-5b ]]; then</span><br><span class="line">    DEVICE_TREE=rk3588s-orangepi-5b.dtb</span><br><span class="line">    OVERLAY_PREFIX=orangepi-5</span><br><span class="line">elif [[ &quot;$&#123;BOARD&#125;&quot; == orangepi-5-plus ]]; then</span><br><span class="line">    DEVICE_TREE=rk3588-orangepi-5-plus.dtb</span><br><span class="line">    OVERLAY_PREFIX=orangepi-5-plus</span><br><span class="line">elif [[ &quot;$&#123;BOARD&#125;&quot; == rock-5a ]]; then</span><br><span class="line">    DEVICE_TREE=rk3588s-rock-5a.dtb</span><br><span class="line">    OVERLAY_PREFIX=rock-5a</span><br><span class="line">elif [[ &quot;$&#123;BOARD&#125;&quot; == rock-5b ]]; then</span><br><span class="line">    DEVICE_TREE=rk3588-rock-5b.dtb</span><br><span class="line">    OVERLAY_PREFIX=rock-5b</span><br><span class="line">elif [[ &quot;$&#123;BOARD&#125;&quot; == radxa-cm5-io ]]; then</span><br><span class="line">    DEVICE_TREE=rk3588s-radxa-cm5-io.dtb</span><br><span class="line">    OVERLAY_PREFIX=radxa-cm5-io</span><br><span class="line">elif [[ &quot;$&#123;BOARD&#125;&quot; == nanopi-r6c ]]; then</span><br><span class="line">    DEVICE_TREE=rk3588s-nanopi-r6c.dtb</span><br><span class="line">    OVERLAY_PREFIX=</span><br><span class="line">elif [[ &quot;$&#123;BOARD&#125;&quot; == nanopi-r6s ]]; then</span><br><span class="line">    DEVICE_TREE=rk3588s-nanopi-r6s.dtb</span><br><span class="line">    OVERLAY_PREFIX=</span><br><span class="line">elif [[ &quot;$&#123;BOARD&#125;&quot; == nanopc-t6 ]]; then</span><br><span class="line">    DEVICE_TREE=rk3588-nanopc-t6.dtb</span><br><span class="line">    OVERLAY_PREFIX=</span><br><span class="line">elif [[ &quot;$&#123;BOARD&#125;&quot; == mixtile-blade3 ]]; then</span><br><span class="line">    DEVICE_TREE=rk3588-blade3-v101-linux.dtb</span><br><span class="line">    OVERLAY_PREFIX=mixtile-blade3</span><br><span class="line">    if [[ &quot;$&#123;MAINLINE&#125;&quot; == &quot;Y&quot; ]]; then</span><br><span class="line">        DEVICE_TREE=rk3588-mixtile-blade3.dtb</span><br><span class="line">    fi</span><br><span class="line">elif [[ &quot;$&#123;BOARD&#125;&quot; == indiedroid-nova ]]; then</span><br><span class="line">    DEVICE_TREE=rk3588s-9tripod-linux.dtb</span><br><span class="line">    OVERLAY_PREFIX=</span><br><span class="line">    if [[ &quot;$&#123;MAINLINE&#125;&quot; == &quot;Y&quot; ]]; then</span><br><span class="line">        DEVICE_TREE=rk3588s-indiedroid-nova.dtb</span><br><span class="line">    fi</span><br><span class="line">elif [[ &quot;$&#123;BOARD&#125;&quot; == lubancat-4 ]]; then</span><br><span class="line">    DEVICE_TREE=rk3588s-lubancat-4.dtb</span><br><span class="line">    OVERLAY_PREFIX=lubancat-4</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">KVER=&quot;&quot;</span><br><span class="line">if [[ &quot;$&#123;MAINLINE&#125;&quot; == &quot;Y&quot; ]]; then</span><br><span class="line">    KVER=&quot;-mainline-6.6.0-rc4&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一个新的img镜像</span></span><br><span class="line">img=&quot;../images/$(basename &quot;$&#123;rootfs&#125;&quot; .rootfs.tar)$&#123;KVER&#125;.img&quot;</span><br><span class="line">size=&quot;$(( $(wc -c &lt; &quot;$&#123;rootfs&#125;&quot; ) / 1024 / 1024 ))&quot;</span><br><span class="line">truncate -s &quot;$(( size + 2048 + 512 ))M&quot; &quot;$&#123;img&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一个循环设备</span></span><br><span class="line">loop=&quot;$(losetup -f)&quot;</span><br><span class="line">losetup &quot;$&#123;loop&#125;&quot; &quot;$&#123;img&#125;&quot;</span><br><span class="line">disk=&quot;$&#123;loop&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Cleanup loopdev on early <span class="built_in">exit</span></span></span><br><span class="line">trap &#x27;cleanup_loopdev $&#123;loop&#125;&#x27; EXIT</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">确保创建的硬盘没有被挂载，然后创建/tmp/mnt文件夹</span></span><br><span class="line">mount_point=/tmp/mnt</span><br><span class="line">umount &quot;$&#123;disk&#125;&quot;* 2&gt; /dev/null || true</span><br><span class="line">umount $&#123;mount_point&#125;/* 2&gt; /dev/null || true</span><br><span class="line">mkdir -p $&#123;mount_point&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置分区表，总共会创建两个分区，一个是fat16的分区，一个是ext4的分区</span></span><br><span class="line">dd if=/dev/zero of=&quot;$&#123;disk&#125;&quot; count=4096 bs=512</span><br><span class="line">parted --script &quot;$&#123;disk&#125;&quot; \</span><br><span class="line">mklabel gpt \</span><br><span class="line">mkpart primary fat16 16MiB 528MiB \</span><br><span class="line">mkpart primary ext4 528MiB 100%</span><br><span class="line"></span><br><span class="line">set +e</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">分区类型修改</span></span><br><span class="line">fdisk &quot;$&#123;disk&#125;&quot; &lt;&lt; EOF</span><br><span class="line">t</span><br><span class="line">1</span><br><span class="line">BC13C2FF-59E6-4262-A352-B275FD6F7172</span><br><span class="line">t</span><br><span class="line">2</span><br><span class="line">0FC63DAF-8483-4772-8E79-3D69D8477DE4</span><br><span class="line">w</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">set -eE</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新读取指定设备的分区表信息</span></span><br><span class="line">partprobe &quot;$&#123;disk&#125;&quot;</span><br><span class="line"></span><br><span class="line">partition_char=&quot;$(if [[ $&#123;disk: -1&#125; == [0-9] ]]; then echo p; fi)&quot;</span><br><span class="line"></span><br><span class="line">sleep 1</span><br><span class="line"></span><br><span class="line">wait_loopdev &quot;$&#123;disk&#125;$&#123;partition_char&#125;2&quot; 60 || &#123;</span><br><span class="line">    echo &quot;Failure to create $&#123;disk&#125;$&#123;partition_char&#125;1 in time&quot;</span><br><span class="line">    exit 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sleep 1</span><br><span class="line"></span><br><span class="line">wait_loopdev &quot;$&#123;disk&#125;$&#123;partition_char&#125;1&quot; 60 || &#123;</span><br><span class="line">    echo &quot;Failure to create $&#123;disk&#125;$&#123;partition_char&#125;1 in time&quot;</span><br><span class="line">    exit 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sleep 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成 UUID <span class="keyword">for</span> bootfs</span></span><br><span class="line">boot_uuid=$(uuidgen | head -c8)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成 UUID <span class="keyword">for</span> rootfs</span></span><br><span class="line">root_uuid=$(uuidgen)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在指定的分区上创建文件系统</span></span><br><span class="line">mkfs.vfat -i &quot;$&#123;boot_uuid&#125;&quot; -F16 -n system-boot &quot;$&#123;disk&#125;$&#123;partition_char&#125;1&quot;</span><br><span class="line">dd if=/dev/zero of=&quot;$&#123;disk&#125;$&#123;partition_char&#125;2&quot; bs=1KB count=10 &gt; /dev/null</span><br><span class="line">mkfs.ext4 -U &quot;$&#123;root_uuid&#125;&quot; -L writable &quot;$&#123;disk&#125;$&#123;partition_char&#125;2&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">挂载分区</span></span><br><span class="line">mkdir -p $&#123;mount_point&#125;/&#123;system-boot,writable&#125; </span><br><span class="line">mount &quot;$&#123;disk&#125;$&#123;partition_char&#125;1&quot; $&#123;mount_point&#125;/system-boot</span><br><span class="line">mount &quot;$&#123;disk&#125;$&#123;partition_char&#125;2&quot; $&#123;mount_point&#125;/writable</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copy the rootfs to root partition</span></span><br><span class="line">tar -xpf &quot;$&#123;rootfs&#125;&quot; -C $&#123;mount_point&#125;/writable</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Set boot args <span class="keyword">for</span> the splash screen</span></span><br><span class="line">[ -z &quot;$&#123;img##*desktop*&#125;&quot; ] &amp;&amp; bootargs=&quot;quiet splash plymouth.ignore-serial-consoles&quot; || bootargs=&quot;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Create fstab entries</span></span><br><span class="line">boot_uuid=&quot;$&#123;boot_uuid:0:4&#125;-$&#123;boot_uuid:4:4&#125;&quot;</span><br><span class="line">mkdir -p $&#123;mount_point&#125;/writable/boot/firmware</span><br><span class="line">cat &gt; $&#123;mount_point&#125;/writable/etc/fstab &lt;&lt; EOF</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&lt;file system&gt;     &lt;mount point&gt;  &lt;<span class="built_in">type</span>&gt;  &lt;options&gt;   &lt;dump&gt;  &lt;fsck&gt;</span></span><br><span class="line">UUID=$&#123;boot_uuid^^&#125; /boot/firmware vfat    defaults    0       2</span><br><span class="line">UUID=$&#123;root_uuid,,&#125; /              ext4    defaults    0       1</span><br><span class="line">/swapfile           none           swap    sw          0       0</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Uboot script</span></span><br><span class="line">cat &gt; $&#123;mount_point&#125;/system-boot/boot.cmd &lt;&lt; &#x27;EOF&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This is a boot script <span class="keyword">for</span> U-Boot</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Recompile with:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mkimage -A arm64 -O linux -T script -C none -n <span class="string">&quot;Boot Script&quot;</span> -d boot.cmd boot.scr</span></span><br><span class="line"></span><br><span class="line">setenv load_addr &quot;0x9000000&quot;</span><br><span class="line">setenv overlay_error &quot;false&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;Boot script loaded from $&#123;devtype&#125; $&#123;devnum&#125;&quot;</span><br><span class="line"></span><br><span class="line">if test -e $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; /ubuntuEnv.txt; then</span><br><span class="line">	load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;load_addr&#125; /ubuntuEnv.txt</span><br><span class="line">	env import -t $&#123;load_addr&#125; $&#123;filesize&#125;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;fdt_addr_r&#125; /dtbs/$&#123;fdtfile&#125;</span><br><span class="line">fdt addr $&#123;fdt_addr_r&#125; &amp;&amp; fdt resize 0x10000</span><br><span class="line"></span><br><span class="line">for overlay_file in $&#123;overlays&#125;; do</span><br><span class="line">    if load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;fdtoverlay_addr_r&#125; /dtbs/overlays/$&#123;overlay_prefix&#125;-$&#123;overlay_file&#125;.dtbo; then</span><br><span class="line">        echo &quot;Applying device tree overlay: /dtbs/overlays/$&#123;overlay_prefix&#125;-$&#123;overlay_file&#125;.dtbo&quot;</span><br><span class="line">        fdt apply $&#123;fdtoverlay_addr_r&#125; || setenv overlay_error &quot;true&quot;</span><br><span class="line">    elif load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;fdtoverlay_addr_r&#125; /dtbs/overlays/$&#123;overlay_file&#125;.dtbo; then</span><br><span class="line">        echo &quot;Applying device tree overlay: /dtbs/overlays/$&#123;overlay_file&#125;.dtbo&quot;</span><br><span class="line">        fdt apply $&#123;fdtoverlay_addr_r&#125; || setenv overlay_error &quot;true&quot;</span><br><span class="line">    elif load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;fdtoverlay_addr_r&#125; /dtbs/overlays/rk3588-$&#123;overlay_file&#125;.dtbo; then</span><br><span class="line">        echo &quot;Applying device tree overlay: /dtbs/overlays/rk3588-$&#123;overlay_file&#125;.dtbo&quot;</span><br><span class="line">        fdt apply $&#123;fdtoverlay_addr_r&#125; || setenv overlay_error &quot;true&quot;</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line">if test &quot;$&#123;overlay_error&#125;&quot; = &quot;true&quot;; then</span><br><span class="line">    echo &quot;Error applying device tree overlays, restoring original device tree&quot;</span><br><span class="line">    load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;fdt_addr_r&#125; /dtbs/$&#123;fdtfile&#125;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;kernel_addr_r&#125; /vmlinuz</span><br><span class="line">load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;ramdisk_addr_r&#125; /initrd.img</span><br><span class="line"></span><br><span class="line">booti $&#123;kernel_addr_r&#125; $&#123;ramdisk_addr_r&#125;:$&#123;filesize&#125; $&#123;fdt_addr_r&#125;</span><br><span class="line">EOF</span><br><span class="line">mkimage -A arm64 -O linux -T script -C none -n &quot;Boot Script&quot; -d $&#123;mount_point&#125;/system-boot/boot.cmd $&#123;mount_point&#125;/system-boot/boot.scr</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Uboot <span class="built_in">env</span></span></span><br><span class="line">cat &gt; $&#123;mount_point&#125;/system-boot/ubuntuEnv.txt &lt;&lt; EOF</span><br><span class="line">bootargs=root=UUID=$&#123;root_uuid&#125; rootfstype=ext4 rootwait rw console=ttyS2,115200 console=tty1 cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory swapaccount=1 systemd.unified_cgroup_hierarchy=0 $&#123;bootargs&#125;</span><br><span class="line">fdtfile=$&#123;DEVICE_TREE&#125;</span><br><span class="line">overlay_prefix=$&#123;OVERLAY_PREFIX&#125;</span><br><span class="line">overlays=</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copy the device trees, kernel, and initrd to the boot partition</span></span><br><span class="line">mv $&#123;mount_point&#125;/writable/boot/firmware/* $&#123;mount_point&#125;/system-boot/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Write bootloader to disk image</span></span><br><span class="line">dd if=$&#123;mount_point&#125;/writable/usr/lib/u-boot-&quot;$&#123;VENDOR&#125;&quot;-rk3588/idbloader.img of=&quot;$&#123;loop&#125;&quot; seek=64 conv=notrunc</span><br><span class="line">dd if=$&#123;mount_point&#125;/writable/usr/lib/u-boot-&quot;$&#123;VENDOR&#125;&quot;-rk3588/u-boot.itb of=&quot;$&#123;loop&#125;&quot; seek=16384 conv=notrunc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Cloud init config <span class="keyword">for</span> server image</span></span><br><span class="line">if [ -z &quot;$&#123;img##*server*&#125;&quot; ]; then</span><br><span class="line">    cp ../overlay/boot/firmware/&#123;meta-data,user-data,network-config&#125; $&#123;mount_point&#125;/system-boot</span><br><span class="line">	sed -i &#x27;s/eth0:/enP4p65s0:\n    dhcp4: true\n    optional: true\n  enP3p49s0:/g&#x27; $&#123;mount_point&#125;/system-boot/network-config</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">sync --file-system</span><br><span class="line">sync</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Umount partitions</span></span><br><span class="line">umount &quot;$&#123;disk&#125;$&#123;partition_char&#125;1&quot;</span><br><span class="line">umount &quot;$&#123;disk&#125;$&#123;partition_char&#125;2&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Remove loop device</span></span><br><span class="line">losetup -d &quot;$&#123;loop&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Exit <span class="built_in">trap</span> is no longer needed</span></span><br><span class="line">trap &#x27;&#x27; EXIT</span><br><span class="line"></span><br><span class="line">echo -e &quot;\nCompressing $(basename &quot;$&#123;img&#125;.xz&quot;)\n&quot;</span><br><span class="line">xz -3 --force --keep --quiet --threads=0 &quot;$&#123;img&#125;&quot;</span><br><span class="line">rm -f &quot;$&#123;img&#125;&quot;</span><br><span class="line">cd ../images &amp;&amp; sha256sum &quot;$(basename &quot;$&#123;img&#125;.xz&quot;)&quot; &gt; &quot;$(basename &quot;$&#123;img&#125;.xz.sha256&quot;)&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>









<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">U-Boot 2017.09 (Oct 05 2023 - 19:50:49 +0800)</span><br><span class="line"></span><br><span class="line">Model: Rockchip RK3588 Evaluation Board</span><br><span class="line">PreSerial: 2, raw, 0xfeb50000</span><br><span class="line">DRAM:  8 GiB</span><br><span class="line">Sysmem: init</span><br><span class="line">Relocation Offset: eda3c000</span><br><span class="line">Relocation fdt: eb9f9a78 - eb9fecd0</span><br><span class="line">CR: M/C/I</span><br><span class="line">Using default environment</span><br><span class="line"></span><br><span class="line">mmc@fe2c0000: 0, mmc@fe2e0000: 1</span><br><span class="line">Bootdev(atags): mmc 0</span><br><span class="line">MMC0: Legacy, 52Mhz</span><br><span class="line">PartType: EFI</span><br><span class="line">DM: v2</span><br><span class="line">boot mode: None</span><br><span class="line">Model: Rockchip RK3588 Evaluation Board</span><br><span class="line">CLK: (sync kernel. arm: enter 1008000 KHz, init 1008000 KHz, kernel 0N/A)</span><br><span class="line">  b0pll 24000 KHz</span><br><span class="line">  b1pll 24000 KHz</span><br><span class="line">  lpll 24000 KHz</span><br><span class="line">  v0pll 24000 KHz</span><br><span class="line">  aupll 24000 KHz</span><br><span class="line">  cpll 1500000 KHz</span><br><span class="line">  gpll 1188000 KHz</span><br><span class="line">  npll 24000 KHz</span><br><span class="line">  ppll 100000 KHz</span><br><span class="line">  aclk_center_root 702000 KHz</span><br><span class="line">  pclk_center_root 100000 KHz</span><br><span class="line">  hclk_center_root 396000 KHz</span><br><span class="line">  aclk_center_low_root 500000 KHz</span><br><span class="line">  aclk_top_root 750000 KHz</span><br><span class="line">  pclk_top_root 100000 KHz</span><br><span class="line">  aclk_low_top_root 396000 KHz</span><br><span class="line">Net:   No ethernet found.</span><br><span class="line">Hit key to stop autoboot(&#x27;CTRL+C&#x27;):  0</span><br><span class="line">switch to partitions #0, OK</span><br><span class="line">mmc0 is current device</span><br><span class="line">mmc@fe2c0000: 0 (SD)</span><br><span class="line">mmc@fe2e0000: 1</span><br><span class="line">switch to partitions #0, OK</span><br><span class="line">mmc0 is current device</span><br><span class="line">Scanning mmc 0:1...</span><br><span class="line">Found U-Boot script /boot.scr</span><br><span class="line">reading /boot.scr</span><br><span class="line">1955 bytes read in 3 ms (635.7 KiB/s)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Executing script at 00500000</span></span></span><br><span class="line">Boot script loaded from mmc 0</span><br><span class="line">reading /ubuntuEnv.txt</span><br><span class="line">338 bytes read in 3 ms (109.4 KiB/s)</span><br><span class="line">reading /dtbs/rk3588s-orangepi-5b.dtb</span><br><span class="line">249675 bytes read in 30 ms (7.9 MiB/s)</span><br><span class="line">reading /vmlinuz</span><br><span class="line">38203904 bytes read in 3046 ms (12 MiB/s)</span><br><span class="line">reading /initrd.img</span><br><span class="line">14648708 bytes read in 1170 ms (11.9 MiB/s)</span><br><span class="line">Fdt Ramdisk skip relocation</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Flattened Device Tree blob at 0x0a100000</span></span></span><br><span class="line">   Booting using the fdt blob at 0x0a100000</span><br><span class="line">   reserving fdt memory region: addr=a100000 size=4d000</span><br><span class="line">  &#x27;reserved-memory&#x27; cma: addr=10000000 size=10000000</span><br><span class="line">  &#x27;reserved-memory&#x27; ramoops@110000: addr=110000 size=f0000</span><br><span class="line">   Using Device Tree in place at 000000000a100000, end 000000000a14ffff</span><br><span class="line">Adding bank: 0x00200000 - 0xf0000000 (size: 0xefe00000)</span><br><span class="line">Adding bank: 0x100000000 - 0x200000000 (size: 0x100000000)</span><br><span class="line">Adding bank: 0x2f0000000 - 0x300000000 (size: 0x10000000)</span><br><span class="line">Total: 4628.904 ms</span><br><span class="line"></span><br><span class="line">Starting kernel ...</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">U-Boot 2017.09-g32640b0ada-230713-dirty #topeet (Oct 05 2023 - 19:59:32 +0800)</span><br><span class="line"></span><br><span class="line">Model: Rockchip RK3588 Evaluation Board</span><br><span class="line">MPIDR: 0x81000000</span><br><span class="line">PreSerial: 2, raw, 0xfeb50000</span><br><span class="line">DRAM:  8 GiB</span><br><span class="line">Sysmem: init</span><br><span class="line">Relocation Offset: eda1e000</span><br><span class="line">Relocation fdt: eb9fa820 - eb9fecd8</span><br><span class="line">CR: M/C/I</span><br><span class="line">Using default environment</span><br><span class="line"></span><br><span class="line">DM: v2</span><br><span class="line">no mmc device at slot 1</span><br><span class="line">mmc@fe2c0000: 1 (SD), mmc@fe2e0000: 0</span><br><span class="line">Bootdev(atags): mmc 1</span><br><span class="line">MMC1: Legacy, 52Mhz</span><br><span class="line">PartType: EFI</span><br><span class="line">No misc partition</span><br><span class="line">boot mode: None</span><br><span class="line">FIT: No boot partition</span><br><span class="line">Failed to load DTB, ret=-2</span><br><span class="line">No valid DTB, ret=-22</span><br><span class="line">Failed to get kernel dtb, ret=-22</span><br><span class="line">Model: Rockchip RK3588 Evaluation Board</span><br><span class="line">MPIDR: 0x81000000</span><br><span class="line">rockchip_set_serialno: could not find efuse/otp device</span><br><span class="line">CLK: (sync kernel. arm: enter 1008000 KHz, init 1008000 KHz, kernel 0N/A)</span><br><span class="line">  b0pll 24000 KHz</span><br><span class="line">  b1pll 24000 KHz</span><br><span class="line">  lpll 24000 KHz</span><br><span class="line">  v0pll 24000 KHz</span><br><span class="line">  aupll 24000 KHz</span><br><span class="line">  cpll 1500000 KHz</span><br><span class="line">  gpll 1188000 KHz</span><br><span class="line">  npll 24000 KHz</span><br><span class="line">  ppll 100000 KHz</span><br><span class="line">  aclk_center_root 702000 KHz</span><br><span class="line">  pclk_center_root 100000 KHz</span><br><span class="line">  hclk_center_root 396000 KHz</span><br><span class="line">  aclk_center_low_root 500000 KHz</span><br><span class="line">  aclk_top_root 750000 KHz</span><br><span class="line">  pclk_top_root 100000 KHz</span><br><span class="line">  aclk_low_top_root 396000 KHz</span><br><span class="line">No misc partition</span><br><span class="line">Net:   No ethernet found.</span><br><span class="line">Hit key to stop autoboot(&#x27;CTRL+C&#x27;):  0</span><br><span class="line">Could not find misc partition</span><br><span class="line">ANDROID: reboot reason: &quot;(none)&quot;</span><br><span class="line">optee api revision: 2.0</span><br><span class="line">TEEC: Waring: Could not find security partition</span><br><span class="line">Not AVB images, AVB skip</span><br><span class="line">android_image_load_by_partname: Can&#x27;t find part: boot</span><br><span class="line">Android image load failed</span><br><span class="line">Android boot failed, error -1.</span><br><span class="line">## Booting FIT Image FIT: No boot partition</span><br><span class="line">FIT: No fit blob</span><br><span class="line">FIT: No FIT image</span><br><span class="line">Unknown command &#x27;bootrkp&#x27; - try &#x27;help&#x27;</span><br><span class="line">switch to partitions #0, OK</span><br><span class="line">mmc1 is current device</span><br><span class="line">Scanning mmc 1:1...</span><br><span class="line">Found U-Boot script /boot.scr</span><br><span class="line">reading /boot.scr</span><br><span class="line">1955 bytes read in 4 ms (476.6 KiB/s)</span><br><span class="line">## Executing script at 00500000</span><br><span class="line">Unknown command &#x27;▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒w▒▒▒▒_▒▒▒▒▒O▒▒?▒▒&gt;▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒&#123;▒▒o~▒▒▒▒▒ko▒▒▒▒▒▒▒▒▒▒▒▒~▒▒&#123;▒▒O?▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒/▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒Ͽ▒▒▒▒▒▒▒▒▒▒▒▒▒&#125;▒▒▒▒Ϳ▒▒▒▒▒[▒▒▒▒▒▒▒▒▒▒▒▒~▒▒▒▒▒▒▒▒▒▒▒&#123;▒▒▒▒▒ۿ▒▒▒&#125;▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒w▒▒▒▒▒▒▒▒▒~▒c▒▒▒▒▒▒oϿ▒▒▒▒▒▒▒▒▒▒▒o▒▒▒▒▒▒_▒▒▒v▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ܿ▒▒▒▒▒▒▒▒▒▒▒-&#123;▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒_▒▒▒߿▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒&#123;▒▒▒▒▒▒▒▒▒߿▒▒▒▒▒▒▒o▒▒fN7▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒u▒▒▒▒▒▒▒▒▒▒▒y▒▒▒▒▒▒▒▒▒Ͽ▒▒▒▒▒▒▒▒▒▒▒▒▒/▒OO&#125;▒ow▒N_▒oo▒▒o▒▒▒/▒o▒▒o▒▒▒_ϯ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒߿&#125;ߛ▒o?▒o?o▒▒▒▒▒▒▒▒▒▒▒▒▒?▒▒▒?▒▒▒o▒o߿▒▒▒▒_▒▒ݝ▒_▒▒_▒o▒o▒o▒▒▒▒▒▒▒▒▒_▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ߝϟ▒▒▒▒▒▒W&#x27; - try &#x27;help&#x27;</span><br><span class="line">Unknown command &#x27;▒▒▒▒▒▒▒▒▒▒▒▒w▒?▒▒?▒▒▒n▒▒O?▒_▒▒▒▒▒߻▒▒▒▒▒▒ߟ▒▒▒_▒▒▒▒o▒w▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒O-ߟ▒▒Ͽ▒Ͽ▒▒_▒▒▒▒▒▒▒▒▒?▒▒▒▒o&#125;▒▒_▒▒▒?▒▒▒▒▒▒▒▒▒▒▒▒▒▒&#123;▒▒▒▒▒▒ݟ▒▒_▒_▒?▒▒▒▒▒▒▒▒▒/▒▒_▒o▒▒~Oo▒oo▒▒o▒▒▒▒W▒▒▒▒▒▒߯▒▒Ͽ▒▒▒&#x27; - try &#x27;help&#x27;</span><br><span class="line">Unknown command &#x27;▒_▒▒▒▒▒_▒▒▒▒▒w▒▒o▒▒▒/▒▒▒▒▒▒oo▒▒▒▒O▒▒?▒▒?߿▒▒ݟ▒߿▒▒▒▒▒ߝ▒▒▒▒▒▒▒▒▒o▒ow▒▒▒▒▒▒▒_&#125;▒▒▒▒~▒▒▒▒▒▒▒▒▒▒▒▒?▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒&#x27; - try &#x27;help&#x27;</span><br><span class="line">Unknown command &#x27;▒▒k▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒&#125;▒▒▒▒▒/▒▒&gt;▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒o▒▒▒o▒▒▒▒▒▒▒▒▒?▒▒n▒o▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒n▒▒gO▒▒/▒w▒▒w▒▒▒f▒▒▒▒▒▒▒▒▒▒▒ߟ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ߟ▒/g▒▒w▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒?▒▒▒▒▒▒▒▒▒ǌ▒o▒▒▒&#123;▒۟▒▒▒▒▒▒▒▒▒▒▒▒▒o▒▒o▒?▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ۯ▒▒▒_▒▒▒_▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒&#123;▒▒_▒▒▒▒▒▒▒▒Ow▒w▒▒▒▒▒▒▒߿▒▒▒▒_▒▒▒▒▒▒▒&#123;▒▒▒▒▒▒▒▒▒▒▒wvv▒▒▒o▒▒▒▒▒▒▒▒▒▒M▒▒▒▒▒▒▒▒▒▒▒]ߟ▒▒_▒▒▒]▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒&#x27; - try &#x27;help&#x27;</span><br><span class="line">SCRIPT FAILED: continuing...</span><br><span class="line">switch to partitions #0, OK</span><br><span class="line">mmc0(part 0) is current device</span><br><span class="line">** No partition table - mmc 0 **</span><br><span class="line"></span><br><span class="line">Device 2: unrecognized JEDEC id bytes: 00, 00, 00</span><br><span class="line">unknown device</span><br><span class="line"></span><br><span class="line">Device 1: unknown raw ID 0 0 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># This is a boot script for U-Boot</span><br><span class="line">#</span><br><span class="line"># Recompile with:</span><br><span class="line"># mkimage -A arm64 -O linux -T script -C none -n &quot;Boot Script&quot; -d boot.cmd boot.scr</span><br><span class="line"></span><br><span class="line">setenv load_addr &quot;0x9000000&quot;</span><br><span class="line">setenv overlay_error &quot;false&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;Boot script loaded from $&#123;devtype&#125; $&#123;devnum&#125;&quot;</span><br><span class="line"></span><br><span class="line">if test -e $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; /ubuntuEnv.txt; then</span><br><span class="line">        load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;load_addr&#125; /ubuntuEnv.txt</span><br><span class="line">	env import -t $&#123;load_addr&#125; $&#123;filesize&#125;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;fdt_addr_r&#125; /dtbs/$&#123;fdtfile&#125;</span><br><span class="line">fdt addr $&#123;fdt_addr_r&#125; &amp;&amp; fdt resize 0x10000</span><br><span class="line"></span><br><span class="line">for overlay_file in $&#123;overlays&#125;; do</span><br><span class="line">    if load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;fdtoverlay_addr_r&#125; /dtbs/overlays/$&#123;overlay_prefix&#125;-$&#123;overlay_file&#125;.dtbo; then</span><br><span class="line">        echo &quot;Applying device tree overlay: /dtbs/overlays/$&#123;overlay_prefix&#125;-$&#123;overlay_file&#125;.dtbo&quot;</span><br><span class="line">        fdt apply $&#123;fdtoverlay_addr_r&#125; || setenv overlay_error &quot;true&quot;</span><br><span class="line">    elif load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;fdtoverlay_addr_r&#125; /dtbs/overlays/$&#123;overlay_file&#125;.dtbo; then</span><br><span class="line">        echo &quot;Applying device tree overlay: /dtbs/overlays/$&#123;overlay_file&#125;.dtbo&quot;</span><br><span class="line">        fdt apply $&#123;fdtoverlay_addr_r&#125; || setenv overlay_error &quot;true&quot;</span><br><span class="line">    elif load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;fdtoverlay_addr_r&#125; /dtbs/overlays/rk3588-$&#123;overlay_file&#125;.dtbo; then</span><br><span class="line">        echo &quot;Applying device tree overlay: /dtbs/overlays/rk3588-$&#123;overlay_file&#125;.dtbo&quot;</span><br><span class="line">        fdt apply $&#123;fdtoverlay_addr_r&#125; || setenv overlay_error &quot;true&quot;</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line">if test &quot;$&#123;overlay_error&#125;&quot; = &quot;true&quot;; then</span><br><span class="line">    echo &quot;Error applying device tree overlays, restoring original device tree&quot;</span><br><span class="line">    load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;fdt_addr_r&#125; /dtbs/$&#123;fdtfile&#125;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;kernel_addr_r&#125; /vmlinuz</span><br><span class="line">load $&#123;devtype&#125; $&#123;devnum&#125;:$&#123;distro_bootpart&#125; $&#123;ramdisk_addr_r&#125; /initrd.img</span><br><span class="line"></span><br><span class="line">booti $&#123;kernel_addr_r&#125; $&#123;ramdisk_addr_r&#125;:$&#123;filesize&#125; $&#123;fdt_addr_r&#125;</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%91%9E%E8%8A%AF%E5%BE%AE%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90/" rel="tag">瑞芯微脚本分析</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-0-19 openwrt 重新移植"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/09/27/0-19%20openwrt%20%E9%87%8D%E6%96%B0%E7%A7%BB%E6%A4%8D/"
    >0-19 openwrt重新移植</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/09/27/0-19%20openwrt%20%E9%87%8D%E6%96%B0%E7%A7%BB%E6%A4%8D/" class="article-date">
  <time datetime="2023-09-27T12:47:53.000Z" itemprop="datePublished">2023-09-27</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%91%9E%E8%8A%AF%E5%BE%AE%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90/">瑞芯微固件分析</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>l</p>
<p>拉取源码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/coolsnowwolf/lede</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310051537522.png" alt="image-20231005153735500"></p>
<p>然后使用以下命令进行软件源的更新，如下图所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./scripts/feeds update -a</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202310051538914.png" alt="image-20231005153831888"></p>
<p>更新完成之后使用以下命令进行组件的安装，安装完成如下图所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./scripts/feeds install -a</span><br></pre></td></tr></table></figure>



 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%91%9E%E8%8A%AF%E5%BE%AE%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90/" rel="tag">瑞芯微脚本分析</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-0-16-openwrt进阶"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/09/26/0-16-openwrt%E8%BF%9B%E9%98%B6/"
    >0-16 openwrt进阶</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/09/26/0-16-openwrt%E8%BF%9B%E9%98%B6/" class="article-date">
  <time datetime="2023-09-26T12:47:53.000Z" itemprop="datePublished">2023-09-26</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%91%9E%E8%8A%AF%E5%BE%AE%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90http-opensource-rock-chips-com-wiki-Main-Page/">瑞芯微固件分析http://opensource.rock-chips.com/wiki_Main_Page</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><a target="_blank" rel="noopener" href="http://opensource.rock-chips.com/wiki_Main_Page">http://opensource.rock-chips.com/wiki_Main_Page</a></p>
<h1 id="1-瑞芯微官方wiki"><a href="#1-瑞芯微官方wiki" class="headerlink" title="1.瑞芯微官方wiki"></a>1.瑞芯微官方wiki</h1><p>瑞芯微的wiki，目前支持的硬件如下所示：<br><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230926204922178.png" alt="image-20230926204922178"></p>
<p>关于3588的还没有出来，但其实都是一样的，这里不管。</p>
<p>uboot的 wiki</p>
<p><a target="_blank" rel="noopener" href="http://opensource.rock-chips.com/wiki_U-Boot">http://opensource.rock-chips.com/wiki_U-Boot</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">+--------+----------------+----------+-------------+---------+</span><br><span class="line">| Boot   | Terminology #1 | Actual   | Rockchip    | Image   |</span><br><span class="line">| stage  |                | program  |  Image      | Location|</span><br><span class="line">| number |                | name     |   Name      | (sector)|</span><br><span class="line">+--------+----------------+----------+-------------+---------+</span><br><span class="line">| 1      |  Primary       | ROM code | BootRom     |         |</span><br><span class="line">|        |  Program       |          |             |         |</span><br><span class="line">|        |  Loader        |          |             |         |</span><br><span class="line">|        |                |          |             |         |</span><br><span class="line">| 2      |  Secondary     | U-Boot   |idbloader.img| 0x40    | pre-loader</span><br><span class="line">|        |  Program       | TPL/SPL  |             |         |</span><br><span class="line">|        |  Loader (SPL)  |          |             |         |</span><br><span class="line">|        |                |          |             |         |</span><br><span class="line">| 3      |  -             | U-Boot   | u-boot.itb  | 0x4000  | including u-boot and atf</span><br><span class="line">|        |                |          | uboot.img   |         | only used with miniloader</span><br><span class="line">|        |                |          |             |         |</span><br><span class="line">|        |                | ATF/TEE  | trust.img   | 0x6000  | only used with miniloader</span><br><span class="line">|        |                |          |             |         |</span><br><span class="line">| 4      |  -             | kernel   | boot.img    | 0x8000  |</span><br><span class="line">|        |                |          |             |         |</span><br><span class="line">| 5      |  -             | rootfs   | rootfs.img  | 0x40000 |</span><br><span class="line">+--------+----------------+----------+-------------+---------+</span><br></pre></td></tr></table></figure>

<p>当我们谈论从 eMMC&#x2F;SD&#x2F;U 盘&#x2F;网络启动时，它们涉及到不同的概念：</p>
<p>第一阶段（Stage 1）始终在引导 ROM 中，它加载第二阶段（Stage 2），并可能加载第三阶段（当启用 SPL_BACK_TO_BROM 选项时）。<br>从 SPI 闪存启动意味着第二阶段（SPL 和 U-Boot）的固件位于 SPI 闪存中，而第四阶段（Stage 4）和第五阶段（Stage 5）位于其他地方；<br>从 eMMC 启动意味着所有固件（包括第二阶段、第三阶段、第四阶段和第五阶段）都存储在 eMMC 中；<br>从 SD 卡启动意味着所有固件（包括第二阶段、第三阶段、第四阶段和第五阶段）都存储在 SD 卡中；<br>从 U 盘启动意味着第四阶段和第五阶段的固件（不包括 SPL 和 U-Boot）存储在 U 盘中，可选地只包含第五阶段；<br>从网络&#x2F;TFTP启动意味着第四阶段和第五阶段的固件（不包括 SPL 和 U-Boot）存储在网络上。</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309262100985.jpeg" alt="Rockchip bootflow.jpg"></p>
<h1 id="2-uboot官方"><a href="#2-uboot官方" class="headerlink" title="2. uboot官方"></a>2. uboot官方</h1><p><a target="_blank" rel="noopener" href="https://u-boot.readthedocs.io/en/latest/board/rockchip/index.html">https://u-boot.readthedocs.io/en/latest/board/rockchip/index.html</a></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309262106742.png" alt="image-20230926210621659"></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309262106001.png" alt="image-20230926210654968"></p>
<p>sudo apt-get install python-pyelftools python3-pyelftools -y</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export ARCH=arm64</span><br><span class="line">export BL31=../rkbin/bin/rk35/rk3588_bl31_v1.33.elf</span><br><span class="line">export ROCKCHIP_TPL=../rkbin/bin/rk35/rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v1.09.bin</span><br><span class="line">make rk3588_defconfig</span><br><span class="line">make CROSS_COMPILE=aarch64-linux-gnu-</span><br><span class="line"></span><br><span class="line">./make.sh CROSS_COMPILE=aarch64-linux-gnu- rk3588</span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/openwrt/openwrt.git</span><br><span class="line"> git branch -a</span><br><span class="line"> git checkout openwrt-23.05</span><br><span class="line"> make menuconfig </span><br><span class="line"> make V=99 download</span><br><span class="line"> make V=99 -j32</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/orangepi-xunlong/u-boot-orangepi.git</span><br><span class="line">git checkout v2017.09-rk3588</span><br><span class="line">export arch=arm64</span><br><span class="line">make orangepi_5b_defconfig</span><br><span class="line">make CROSS_COMPILE=&quot;aarch64-linux-gnu-&quot; -j32</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309262153640.png" alt="image-20230926215328624"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/chai0705/3588-uboot.git</span><br><span class="line">git branch -a</span><br><span class="line">make rockchip_linux_defconfig ARCH=arm64</span><br><span class="line">make CROSS_COMPILE=&quot;aarch64-linux-gnu-&quot; -j32</span><br></pre></td></tr></table></figure>

<p>make ARCH&#x3D;arm64 CROSS_COMPILE&#x3D;”aarch64-linux-gnu-“  rk3588-evb7-lp4-v10-linux.img  -j32  </p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309262231481.png" alt="image-20230926223144462"></p>
<p> “ddrbin_tool” 的工具，可用于修改和生成DDR（双数据率）二进制文件。该工具具有两个功能：</p>
<p>功能1：从ddrbin_param.txt修改DDR二进制文件</p>
<ol>
<li><p>根据您的要求修改 “ddrbin_param.txt” 文件。该文件包含DDR频率、UART（通用异步收发器）信息等参数。如果您希望保持某些项目的默认值，请在文件中将其留空。</p>
</li>
<li><p>使用以下参数运行 “ddrbin_tool”：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./ddrbin_tool ddrbin_param.txt px30_ddr_333MHz_v1.13.bin</span><br><span class="line">将 &quot;ddrbin_param.txt&quot; 替换为您修改后的参数文件的名称，将 &quot;px30_ddr_333MHz_v1.13.bin&quot; 替换为您要修改的DDR二进制文件的名称。</span><br></pre></td></tr></table></figure></li>
</ol>
<p>功能2：将DDR二进制文件配置获取到gen_param.txt文件中<br>如果您想获取DDR二进制文件的配置，可以使用 “-g” 标志运行该工具，并指定要保存配置的输出文件。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ddrbin_tool -g gen_param.txt px30_ddr_333MHz_v1.15.bin</span><br></pre></td></tr></table></figure>

<p>该命令将生成一个名为 “gen_param.txt” 的文件，其中包含 “px30_ddr_333MHz_v1.15.bin” DDR二进制文件的配置详细信息。</p>
<p>在我们开发板上使用的就是这个方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/rockchip-linux/rkbin.git</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%91%9E%E8%8A%AF%E5%BE%AE%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90/" rel="tag">瑞芯微脚本分析</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-1-1-git的学习"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/09/22/1-1-git%E7%9A%84%E5%AD%A6%E4%B9%A0/"
    >1-1 git的学习</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/09/22/1-1-git%E7%9A%84%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time datetime="2023-09-22T13:00:47.000Z" itemprop="datePublished">2023-09-22</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/git/">git</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>s</p>
<p>github名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1361382269@qq.com</span><br></pre></td></tr></table></figure>



<p>github 令牌</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">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</span><br></pre></td></tr></table></figure>





<p>添加信任表，否咋会报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global --add safe.directory &quot;*&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202309242211841.png" alt="image-20230924221131815"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git lfs track &quot;*.deb&quot;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add .gitattributes</span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git branch -M main</span><br><span class="line">git remote add origin https://github.com/chai0705/rk3588_ubuntu20_xfce.git</span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-0-15 ubuntu22构建"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/09/22/0-15%20ubuntu22%E6%9E%84%E5%BB%BA/"
    >0-15 ubuntu22构建</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/09/22/0-15%20ubuntu22%E6%9E%84%E5%BB%BA/" class="article-date">
  <time datetime="2023-09-22T00:02:33.000Z" itemprop="datePublished">2023-09-22</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E9%A6%99%E6%A9%99%E6%B4%BE%E6%9E%84%E5%BB%BA%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90/">香橙派构建脚本分析</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>最终定位的内容如下所示：xfce ubuntu22</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MV packages</span></span><br><span class="line">cp ../packages $&#123;chroot_dir&#125; -r </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Mount the temporary API filesystems</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/&#123;proc,sys,run,dev,dev/pts&#125;</span><br><span class="line">mount -t proc /proc $&#123;chroot_dir&#125;/proc</span><br><span class="line">mount -t sysfs /sys $&#123;chroot_dir&#125;/sys</span><br><span class="line">mount -o bind /dev $&#123;chroot_dir&#125;/dev</span><br><span class="line">mount -o bind /dev/pts $&#123;chroot_dir&#125;/dev/pts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF | chroot $&#123;chroot_dir&#125; /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">RKAIQ</span></span><br><span class="line">dpkg -i /packages/rkaiq/camera-engine-rkaiq_rk3588_arm64.deb</span><br><span class="line">cp -f /packages/rkaiq/rkaiq_3A_server /usr/bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">RGA</span></span><br><span class="line">dpkg -i /packages/rga2/librga-dev_2.2.0-1_arm64.deb</span><br><span class="line">dpkg -i /packages/rga2/librga2_2.2.0-1_arm64.deb</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF | chroot $&#123;chroot_dir&#125; /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Download some softwares</span></span><br><span class="line">apt-get -y install libaacs0 libavdevice58 libavfilter7 libavformat58 libbdplus0 libblas3 libbluray2  \</span><br><span class="line">libcdio-cdda2 libcdio-paranoia2 libgfortran5 liblapack3 liblua5.2-0 libmujs1 libmysofa1 \</span><br><span class="line">libnorm1 libpgm-5.3-0 libplacebo192 libpocketsphinx3 libpostproc55 librabbitmq4 librubberband2 \</span><br><span class="line">libsixel1 libsphinxbase3 libssh-gcrypt-4 libswscale5 libudfread0 libva-wayland2 libvidstab1.1 \</span><br><span class="line">libvulkan1  libzimg2 libzmq5 mesa-vulkan-drivers pocketsphinx-en-us \</span><br><span class="line">bzip2 libblkid-dev libdpkg-perl libdw-dev libelf-dev libffi-dev libfile-fcntllock-perl \</span><br><span class="line">libglib2.0-dev libglib2.0-dev-bin liblzma-dev libmount-dev libpcre16-3 libpcre2-32-0 \</span><br><span class="line">libpcre2-dev libpcre2-posix3 libpcre3-dev libpcre32-3 libpcrecpp0v5 libselinux1-dev  \</span><br><span class="line">libsepol-dev  libunwind-dev pkg-config python3-distutils python3-lib2to3 uuid-dev zlib1g-dev  \</span><br><span class="line">gir1.2-gudev-1.0 libdrm-dev libdrm-etnaviv1 libdrm-freedreno1 libdrm-tegra0 libgudev-1.0-dev  \</span><br><span class="line">liborc-0.4-dev liborc-0.4-dev-bin libpciaccess-dev libpciaccess0 libudev-dev libwayland-bin \</span><br><span class="line">libwayland-dev libx11-xcb-dev   bubblewrap gdal-data ibverbs-providers libaec0 libarmadillo10 libarpack2  \</span><br><span class="line">libavcodec-dev libavformat-dev  libavutil-dev libblosc1 libcfitsio9 libcharls2 libdc1394-dev libdeflate-dev \</span><br><span class="line">libevent-pthreads-2.1-7 libexif-dev libexif-doc libexif12 libfabric1 libfreexl1 libfyba0  \</span><br><span class="line">libgdal30 libgdcm-dev libgdcm3.0 libgeos-c1v5 libgeos3.10.2 libgeotiff5 libgif7 libgl2ps1.4 \</span><br><span class="line">libglew2.2 libgphoto2-6 libgphoto2-dev libgphoto2-l10n libgphoto2-port12 libharfbuzz-icu0 \</span><br><span class="line">libhdf4-0-alt libhdf5-103-1 libhdf5-hl-100 libhwloc-plugins libhwloc15 libibverbs1 libilmbase-dev libjbig-dev libjpeg-dev  \</span><br><span class="line">libjpeg-turbo8-dev libjpeg8-dev libjsoncpp25 libkmlbase1 libkmldom1 libkmlengine1 liblept5 libminizip1   \</span><br><span class="line">libmysqlclient21 libnetcdf19 libodbc2 libodbcinst2 libogdi4.1 libopencv-calib3d-dev libopencv-calib3d4.5d  \</span><br><span class="line">libopencv-contrib-dev libopencv-contrib4.5d libopencv-core-dev libopencv-core4.5d libopencv-dev \</span><br><span class="line">libopencv-dnn-dev libopencv-dnn4.5d libopencv-features2d-dev libopencv-features2d4.5d \</span><br><span class="line">libopencv-flann-dev libopencv-flann4.5d libopencv-highgui-dev libopencv-highgui4.5d libopencv-imgcodecs-dev \</span><br><span class="line">libopencv-imgcodecs4.5d libopencv-imgproc-dev libopencv-imgproc4.5d libopencv-ml-dev libopencv-ml4.5d  \</span><br><span class="line">libopencv-objdetect-dev libopencv-objdetect4.5d libopencv-photo-dev libopencv-photo4.5d libopencv-shape-dev \</span><br><span class="line">libopencv-shape4.5d libopencv-stitching-dev  libopencv-stitching4.5d libopencv-superres-dev libopencv-superres4.5d \</span><br><span class="line">libopencv-video-dev libopencv-video4.5d libopencv-videoio-dev libopencv-videoio4.5d libopencv-videostab-dev \</span><br><span class="line">libopencv-videostab4.5d libopencv-viz-dev libopencv-viz4.5d libopencv4.5-java libopencv4.5d-jni libopenexr-dev \</span><br><span class="line">libopenmpi3 libpmix2 libpng-dev libpng-tools libpoppler118 libpq5 libproj22 libprotobuf23 libqhull-r8.0 libraw1394-dev \</span><br><span class="line">libraw1394-tools librdmacm1 librttopo1 libsocket++1 libspatialite7 libsuperlu5 libswresample-dev libswscale-dev libsz2 \</span><br><span class="line">libtbb-dev libtbb12 libtbb2 libtbbmalloc2 libtesseract4 libtiff-dev libtiffxx5 libtk8.6 libucx0 liburiparser1 libvtk9.1 \</span><br><span class="line">libwoff1 libwpe-1.0-1 libwpebackend-fdo-1.0-1 libwpewebkit-1.0-3 libxerces-c3.2 libxft2 libxnvctrl0 mysql-common  \</span><br><span class="line">opencv-data proj-bin proj-data  unixodbc-common xdg-dbus-proxy libqt5opengl5 libcanberra0 libpipewire-0.3-0  \</span><br><span class="line">libpipewire-0.3-common libpipewire-0.3-modules libspa-0.2-modules libtdb1 pipewire pipewire-bin  \</span><br><span class="line">pipewire-media-session rtkit sound-theme-freedesktop pip qt5-image-formats-plugins qtwayland5 blueman \</span><br><span class="line">libegl-dev libgbm-dev libgl-dev libgles-dev libgles1 libgles2 libglx-dev</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF | chroot $&#123;chroot_dir&#125; /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Video Gstreamer</span></span><br><span class="line">apt-get -y install gstreamer1.0-plugins-bad gstreamer1.0-plugins-base gstreamer1.0-plugins-ugly gstreamer1.0-tools gstreamer1.0-alsa \</span><br><span class="line">gstreamer1.0-plugins-base-apps qtmultimedia5-examples gstreamer1.0-x libxv1 libgstreamer-gl1.0-0 \</span><br><span class="line">gstreamer1.0-pulseaudio gstreamer1.0-qt5 libqt5x11extras5 libgstreamer-plugins-good1.0-dev</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mpp</span></span><br><span class="line">dpkg -i /packages/mpp/librockchip-mpp1_1.5.0-1.2_arm64.deb</span><br><span class="line">dpkg -i /packages/mpp/librockchip-mpp-dev_1.5.0-1.2_arm64.deb</span><br><span class="line">dpkg -i /packages/mpp/librockchip-vpu0_1.5.0-1.2_arm64.deb</span><br><span class="line">dpkg -i /packages/mpp/rockchip-mpp-demos_1.5.0-1.2_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gst-rkmpp</span></span><br><span class="line">dpkg -i /packages/gst-rkmpp/gstreamer1.0-rockchip1_1.14-4_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">gstreamer</span></span><br><span class="line">dpkg -i /packages/gstreamer/gir1.2-gstreamer-1.0_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gstreamer/gstreamer1.0-tools_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gstreamer/libgstreamer1.0-0_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gstreamer/libgstreamer1.0-dev_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gst-plugins-base1.0</span></span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/gir1.2-gst-plugins-base-1.0_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/gstreamer1.0-alsa_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/gstreamer1.0-gl_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/gstreamer1.0-plugins-base_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/gstreamer1.0-plugins-base-apps_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/gstreamer1.0-x_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/libgstreamer-gl1.0-0_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/libgstreamer-plugins-base1.0-0_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/libgstreamer-plugins-base1.0-dev_1.20.3-1_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gst-plugins-bad1.0</span></span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/libgstreamer-plugins-bad1.0-0_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/gir1.2-gst-plugins-bad-1.0_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/libgstreamer-opencv1.0-0_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/gstreamer1.0-opencv_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/gstreamer1.0-plugins-bad_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/gstreamer1.0-plugins-bad-apps_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/gstreamer1.0-wpe_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/libgstreamer-plugins-bad1.0-dev_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gst-plugins-good1.0</span></span><br><span class="line">dpkg -i /packages/gst-plugins-good1.0/gstreamer1.0-gtk3_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-good1.0/gstreamer1.0-plugins-good_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-good1.0/gstreamer1.0-pulseaudio_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-good1.0/gstreamer1.0-qt5_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-good1.0/libgstreamer-plugins-good1.0-0_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-good1.0/libgstreamer-plugins-good1.0-dev_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">apt --fix-broken -y install</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Camera</span></span><br><span class="line">dpkg -i /packages/libv4l/libdvbv5-0_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/dvb-tools_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/ir-keytable_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/libdvbv5-dev_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/libdvbv5-doc_1.22.1-2build1_all.deb</span><br><span class="line">dpkg -i /packages/libv4l/libv4l-0_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/libv4l2rds0_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/libv4lconvert0_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/libv4l-dev_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/libv4l-rkmpp_1.5.1-1.1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/v4l-utils_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/qv4l2_1.22.1-2build1_arm64.deb</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF | chroot $&#123;chroot_dir&#125; /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Install Desktop</span></span><br><span class="line">apt-get install -y xubuntu-core libbrotli-dev libfontenc-dev libfreetype-dev libfreetype6-dev libpixman-1-dev libxcvt-dev libxfont-dev libxkbfile-dev mesa-common-dev</span><br><span class="line">apt-get remove -y gdm3 ubuntu-session</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">xserver</span></span><br><span class="line">dpkg -i /packages/xserver/xserver-xorg-core_21.1.3-2ubuntu2_arm64.deb</span><br><span class="line">dpkg -i /packages/xserver/xserver-common_21.1.3-2ubuntu2_all.deb</span><br><span class="line">dpkg -i /packages/xserver/xserver-xorg-dev_21.1.3-2ubuntu2_arm64.deb</span><br><span class="line">dpkg -i /packages/xserver/xserver-xorg-legacy_21.1.3-2ubuntu2_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">DRM</span></span><br><span class="line">dpkg -i /packages/libdrm/libkms1_2.4.110-1ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/libdrm-cursor/libdrm-cursor_1.4.0-1_arm64.deb</span><br><span class="line">dpkg -i /packages/libdrm-cursor/libdrm-cursor-dev_1.4.0-1_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">GPU</span></span><br><span class="line">dpkg -i /packages/libmali/libmali-valhall-g610-g6p0-x11_1.9-1_arm64.deb</span><br><span class="line">cp /packages/libmali/mali_csffw.bin /lib/firmware/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ffmpeg</span></span><br><span class="line">dpkg -i /packages/ffmpeg/libavutil56_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavutil-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libpostproc55_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libpostproc-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libswresample3_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libswresample-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libswscale5_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libswscale-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavcodec58_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavcodec-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavformat58_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavformat-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavfilter7_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavfilter-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavdevice58_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavdevice-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/ffmpeg_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mpv</span></span><br><span class="line">rm /etc/mpv/mpv.conf</span><br><span class="line">dpkg -i /packages/mpv/libmpv1_0.34.1-1ubuntu3_arm64.deb</span><br><span class="line">dpkg -i /packages/mpv/libmpv-dev_0.34.1-1ubuntu3_arm64.deb</span><br><span class="line">dpkg -i /packages/mpv/mpv_0.34.1-1ubuntu3_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">chromium</span></span><br><span class="line">dpkg -i /packages/chromium-x11/chromium-codecs-ffmpeg-extra_110.0.5481.4-debian11~bullseye~rkmpp20230130+1_arm64.deb</span><br><span class="line">dpkg -i /packages/chromium-x11/chromium-browser_110.0.5481.4-debian11~bullseye~rkmpp20230130+1_arm64.deb</span><br><span class="line">mkdir -p /etc/chromium-browser/</span><br><span class="line">cp /packages/chromium-x11/default /etc/chromium-browser/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">parpare</span></span><br><span class="line">sed -i &#x27;5aexport LD_PRELOAD=libdrm-cursor.so.1&#x27; /usr/bin/X</span><br><span class="line">ln -rsf /usr/lib/*/libv4l2.so /usr/lib/</span><br><span class="line">cd /usr/lib/aarch64-linux-gnu/dri/</span><br><span class="line">cp kms_swrast_dri.so swrast_dri.so rockchip_dri.so /</span><br><span class="line">rm /usr/lib/aarch64-linux-gnu/dri/*.so</span><br><span class="line">mv /*.so /usr/lib/aarch64-linux-gnu/dri/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">GPU <span class="built_in">test</span></span></span><br><span class="line">dpkg -i /packages/glmark2/libjpeg62-turbo_1.5.1-2_arm64.deb</span><br><span class="line">dpkg -i /packages/glmark2/glmark2*deb</span><br><span class="line"></span><br><span class="line">apt --fix-broken -y install</span><br><span class="line">apt-mark hold xserver-common xserver-xorg-core xserver-xorg-legacy</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">opencv-python</span></span><br><span class="line">pip install opencv-python -i https://pypi.mirrors.ustc.edu.cn/simple/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">clean deb</span></span><br><span class="line">rm -rf /packages</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Clean package cache</span></span><br><span class="line">apt-get -y autoremove &amp;&amp; apt-get -y clean &amp;&amp; apt-get -y autoclean</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF | chroot $&#123;chroot_dir&#125; /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">usb</span></span><br><span class="line">echo &quot;dash dash/sh boolean false&quot; | debconf-set-selections</span><br><span class="line">dpkg-reconfigure dash</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF | chroot $&#123;chroot_dir&#125; /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">enable</span> lightdm</span></span><br><span class="line">echo &quot;/usr/sbin/lightdm&quot; &gt; /etc/X11/default-display-manager</span><br><span class="line">DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true dpkg-reconfigure lightdm</span><br><span class="line">echo set shared/default-x-display-manager lightdm | debconf-communicate</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Swapfile</span></span><br><span class="line">cat &lt;&lt; EOF | chroot $&#123;chroot_dir&#125; /bin/bash</span><br><span class="line">set -eE</span><br><span class="line">trap &#x27;echo Error: in $0 on line $LINENO&#x27; ERR</span><br><span class="line"></span><br><span class="line">dd if=/dev/zero of=/tmp/swapfile bs=1024 count=2097152</span><br><span class="line">chmod 600 /tmp/swapfile</span><br><span class="line">mkswap /tmp/swapfile</span><br><span class="line">mv /tmp/swapfile /swapfile</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">lightmd/gdm</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/gdm3/custom.conf $&#123;chroot_dir&#125;/etc/gdm3/custom.conf</span><br><span class="line">mkdir $&#123;chroot_dir&#125;/etc/lightdm/ -p</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/lightdm/lightdm.conf $&#123;chroot_dir&#125;/etc/lightdm/lightdm.conf</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/share/lightdm/lightdm.conf.d/60-xubuntu.conf $&#123;chroot_dir&#125;/usr/share/lightdm/lightdm.conf.d/</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/profile.d/x11.sh $&#123;chroot_dir&#125;/etc/profile.d/x11.sh</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/profile.d/qtwebengine.sh $&#123;chroot_dir&#125;/etc/profile.d/qtwebengine.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">no <span class="built_in">sleep</span></span></span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/xdg/xdg-xubuntu/xfce4/xfconf/xfce-perchannel-xml/xfce4-power-manager.xml $&#123;chroot_dir&#125;/etc/xdg/xdg-xubuntu/xfce4/xfconf/xfce-perchannel-xml/xfce4-power-manager.xml</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/bin/screan-sleep.sh $&#123;chroot_dir&#125;/usr/bin/</span><br><span class="line">cp -r $&#123;overlay_dir&#125;/etc/systemd/system/sysinit.target.wants/screan-sleep.service  $&#123;chroot_dir&#125;/etc/systemd/system/sysinit.target.wants/</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/systemd/system/screan-sleep.service $&#123;chroot_dir&#125;/usr/lib/systemd/system/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rfkilL</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/polkit-1/localauthority.conf.d/02-allow-colord.conf  $&#123;chroot_dir&#125;/etc/polkit-1/localauthority.conf.d</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Set gstreamer environment variables</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/profile.d/gst.sh $&#123;chroot_dir&#125;/etc/profile.d/gst.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Set cogl to use gles2</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/profile.d/cogl.sh $&#123;chroot_dir&#125;/etc/profile.d/cogl.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Set qt to use wayland</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/profile.d/qt.sh $&#123;chroot_dir&#125;/etc/profile.d/qt.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Config file <span class="keyword">for</span> mpv</span></span><br><span class="line">mkdir $&#123;chroot_dir&#125;/etc/mpv/ -p</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/mpv/mpv.conf $&#123;chroot_dir&#125;/etc/mpv/mpv.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">iqfiles(ov5695 ov13850)</span></span><br><span class="line">mkdir $&#123;chroot_dir&#125;/etc/iqfiles/ -p</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/iqfiles/* $&#123;chroot_dir&#125;/etc/iqfiles/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Config file <span class="keyword">for</span> xorg</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/etc/X11/</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/X11/* $&#123;chroot_dir&#125;/etc/X11/ -r</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Networking interfaces</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/etc/NetworkManager/</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/NetworkManager/NetworkManager.conf $&#123;chroot_dir&#125;/etc/NetworkManager/NetworkManager.conf</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/NetworkManager/conf.d/10-globally-managed-devices.conf $&#123;chroot_dir&#125;/usr/lib/NetworkManager/conf.d/10-globally-managed-devices.conf</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/NetworkManager/conf.d/10-override-wifi-random-mac-disable.conf $&#123;chroot_dir&#125;/usr/lib/NetworkManager/conf.d/10-override-wifi-random-mac-disable.conf</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/NetworkManager/conf.d/20-override-wifi-powersave-disable.conf $&#123;chroot_dir&#125;/usr/lib/NetworkManager/conf.d/20-override-wifi-powersave-disable.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Set chromium inital prefrences</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/usr/lib/chromium-browser</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/chromium-browser/initial_preferences $&#123;chroot_dir&#125;/usr/lib/chromium-browser/initial_preferences</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Set chromium default launch args</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/etc/chromium-browser</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/chromium-browser/default $&#123;chroot_dir&#125;/etc/chromium-browser/default</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Have plymouth use the framebuffer</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/etc/initramfs-tools/conf-hooks.d</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/initramfs-tools/conf-hooks.d/plymouth $&#123;chroot_dir&#125;/etc/initramfs-tools/conf-hooks.d/plymouth</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Update initramfs</span></span><br><span class="line">chroot $&#123;chroot_dir&#125; /bin/bash -c &quot;update-initramfs -u&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">adbd usb</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/bin/adbd $&#123;chroot_dir&#125;/usr/bin/</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/profile.d/usbdevice.sh $&#123;chroot_dir&#125;/etc/profile.d/</span><br><span class="line">cp -r $&#123;overlay_dir&#125;/etc/systemd/system/sysinit.target.wants/usbdevice.service  $&#123;chroot_dir&#125;/etc/systemd/system/sysinit.target.wants/</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/bin/usbdevice $&#123;chroot_dir&#125;/usr/bin/</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/systemd/system/usbdevice.service $&#123;chroot_dir&#125;/usr/lib/systemd/system/</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/udev/rules.d/61-usbdevice.rules $&#123;chroot_dir&#125;/usr/lib/udev/rules.d/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Config file <span class="keyword">for</span> xorg</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/X11/xorg.conf.d/* $&#123;chroot_dir&#125;/etc/X11/xorg.conf.d/</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/X11/Xsession.d/* $&#123;chroot_dir&#125;/etc/X11/Xsession.d/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Set cpu governor to performance</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/systemd/system/cpu-governor-performance.service $&#123;chroot_dir&#125;/usr/lib/systemd/system/cpu-governor-performance.service</span><br><span class="line">chroot $&#123;chroot_dir&#125; /bin/bash -c &quot;systemctl enable cpu-governor-performance&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Set gpu governor to performance</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/systemd/system/gpu-governor-performance.service $&#123;chroot_dir&#125;/usr/lib/systemd/system/gpu-governor-performance.service</span><br><span class="line">chroot $&#123;chroot_dir&#125; /bin/bash -c &quot;systemctl enable gpu-governor-performance&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">async</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/usr/local/bin/</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/init.d/S10atomic_commit.sh  $&#123;chroot_dir&#125;/etc/init.d/</span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/etc/systemd/system/multi-user.target.wants/</span><br><span class="line">cp -r $&#123;overlay_dir&#125;/etc/systemd/system/multi-user.target.wants/async.service $&#123;chroot_dir&#125;/etc/systemd/system/multi-user.target.wants/</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/local/bin/modetest $&#123;chroot_dir&#125;/usr/local/bin/</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/systemd/system/async.service $&#123;chroot_dir&#125;/usr/lib/systemd/system/async.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">drm</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/etc/udev/rules.d</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/udev/rules.d/60-drm.rules $&#123;chroot_dir&#125;/etc/udev/rules.d/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pulse</span></span><br><span class="line">cp -r $&#123;overlay_dir&#125;/etc/pulse $&#123;chroot_dir&#125;/etc/pulse</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/udev/rules.d/88-rockchip-camera.rules $&#123;chroot_dir&#125;/etc/udev/rules.d/</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/udev/rules.d/90-pulseaudio-rockchip.rules $&#123;chroot_dir&#125;/etc/udev/rules.d/</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/udev/rules.d/99-rockchip-permissions.rules $&#123;chroot_dir&#125;/etc/udev/rules.d/</span><br><span class="line">cp -r $&#123;overlay_dir&#125;/usr/share/alsa $&#123;chroot_dir&#125;/usr/share/</span><br><span class="line">cp -r $&#123;overlay_dir&#125;/usr/share/pulseaudio $&#123;chroot_dir&#125;/usr/share/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">user <span class="built_in">local</span> bin apt ros docker qt</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/local/bin/*  $&#123;chroot_dir&#125;/usr/local/bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">etc/udev/rules.d</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">qt clean display</span></span><br><span class="line">cat &lt;&lt; EOF | chroot $&#123;chroot_dir&#125; /bin/bash</span><br><span class="line">cd /usr/lib/aarch64-linux-gnu/dri/</span><br><span class="line">cp rockchip_dri.so /</span><br><span class="line">rm /usr/lib/aarch64-linux-gnu/dri/*.so</span><br><span class="line">mv /*.so /usr/lib/aarch64-linux-gnu/dri/</span><br><span class="line">rm /etc/profile.d/qt.sh</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Umount the temporary API filesystems</span></span><br><span class="line">umount -lf $&#123;chroot_dir&#125;/dev/pts 2&gt; /dev/null || true</span><br><span class="line">umount -lf $&#123;chroot_dir&#125;/* 2&gt; /dev/null || true</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Tar the entire rootfs</span></span><br><span class="line">cd $&#123;chroot_dir&#125; &amp;&amp; XZ_OPT=&quot;-3 -T0&quot; tar -cpJf ../ubuntu-22.04.2-preinstalled-desktop-arm64.rootfs.tar.xz . &amp;&amp; cd ..</span><br></pre></td></tr></table></figure>







<p>gonme ubuntu22</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MV packages</span></span><br><span class="line">cp ../packages $&#123;chroot_dir&#125; -r </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Mount the temporary API filesystems</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/&#123;proc,sys,run,dev,dev/pts&#125;</span><br><span class="line">mount -t proc /proc $&#123;chroot_dir&#125;/proc</span><br><span class="line">mount -t sysfs /sys $&#123;chroot_dir&#125;/sys</span><br><span class="line">mount -o bind /dev $&#123;chroot_dir&#125;/dev</span><br><span class="line">mount -o bind /dev/pts $&#123;chroot_dir&#125;/dev/pts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF | chroot $&#123;chroot_dir&#125; /bin/bash</span><br><span class="line">[[ -f /etc/profile.d/x11.sh ]] &amp;&amp; rm/etc/profile.d/x11.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">RKAIQ</span></span><br><span class="line">dpkg -i /packages/rkaiq/camera-engine-rkaiq_rk3588_arm64.deb</span><br><span class="line">cp -f /packages/rkaiq/rkaiq_3A_server /usr/bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">RGA</span></span><br><span class="line">dpkg -i /packages/rga2/librga2_2.2.0-1+git220920.c1d5c71~jammy_arm64.deb</span><br><span class="line">dpkg -i /packages/rga2/librga-dev_2.2.0-1+git220920.c1d5c71~jammy_arm64.deb</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF | chroot $&#123;chroot_dir&#125; /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Download some softwares</span></span><br><span class="line">apt-get -y install libaacs0 libavdevice58 libavfilter7 libavformat58 libbdplus0 libblas3 libbluray2  \</span><br><span class="line">libcdio-cdda2 libcdio-paranoia2 libgfortran5 liblapack3 liblua5.2-0 libmujs1 libmysofa1 \</span><br><span class="line">libnorm1 libpgm-5.3-0 libplacebo192 libpocketsphinx3 libpostproc55 librabbitmq4 librubberband2 \</span><br><span class="line">libsixel1 libsphinxbase3 libssh-gcrypt-4 libswscale5 libudfread0 libva-wayland2 libvidstab1.1 \</span><br><span class="line">libvulkan1  libzimg2 libzmq5 mesa-vulkan-drivers pocketsphinx-en-us \</span><br><span class="line">bzip2 libblkid-dev libdpkg-perl libdw-dev libelf-dev libffi-dev libfile-fcntllock-perl \</span><br><span class="line">libglib2.0-dev libglib2.0-dev-bin liblzma-dev libmount-dev libpcre16-3 libpcre2-32-0 \</span><br><span class="line">libpcre2-dev libpcre2-posix3 libpcre3-dev libpcre32-3 libpcrecpp0v5 libselinux1-dev  \</span><br><span class="line">libsepol-dev  libunwind-dev pkg-config python3-distutils python3-lib2to3 uuid-dev zlib1g-dev  \</span><br><span class="line">gir1.2-gudev-1.0 libdrm-dev libdrm-etnaviv1 libdrm-freedreno1 libdrm-tegra0 libgudev-1.0-dev  \</span><br><span class="line">liborc-0.4-dev liborc-0.4-dev-bin libpciaccess-dev libpciaccess0 libudev-dev libwayland-bin \</span><br><span class="line">libwayland-dev libx11-xcb-dev   bubblewrap gdal-data ibverbs-providers libaec0 libarmadillo10 libarpack2  \</span><br><span class="line">libavcodec-dev libavformat-dev  libavutil-dev libblosc1 libcfitsio9 libcharls2 libdc1394-dev libdeflate-dev \</span><br><span class="line">libevent-pthreads-2.1-7 libexif-dev libexif-doc libexif12 libfabric1 libfreexl1 libfyba0  \</span><br><span class="line">libgdal30 libgdcm-dev libgdcm3.0 libgeos-c1v5 libgeos3.10.2 libgeotiff5 libgif7 libgl2ps1.4 \</span><br><span class="line">libglew2.2 libgphoto2-6 libgphoto2-dev libgphoto2-l10n libgphoto2-port12 libharfbuzz-icu0 \</span><br><span class="line">libhdf4-0-alt libhdf5-103-1 libhdf5-hl-100 libhwloc-plugins libhwloc15 libibverbs1 libilmbase-dev libjbig-dev libjpeg-dev  \</span><br><span class="line">libjpeg-turbo8-dev libjpeg8-dev libjsoncpp25 libkmlbase1 libkmldom1 libkmlengine1 liblept5 libminizip1   \</span><br><span class="line">libmysqlclient21 libnetcdf19 libodbc2 libodbcinst2 libogdi4.1 libopencv-calib3d-dev libopencv-calib3d4.5d  \</span><br><span class="line">libopencv-contrib-dev libopencv-contrib4.5d libopencv-core-dev libopencv-core4.5d libopencv-dev \</span><br><span class="line">libopencv-dnn-dev libopencv-dnn4.5d libopencv-features2d-dev libopencv-features2d4.5d \</span><br><span class="line">libopencv-flann-dev libopencv-flann4.5d libopencv-highgui-dev libopencv-highgui4.5d libopencv-imgcodecs-dev \</span><br><span class="line">libopencv-imgcodecs4.5d libopencv-imgproc-dev libopencv-imgproc4.5d libopencv-ml-dev libopencv-ml4.5d  \</span><br><span class="line">libopencv-objdetect-dev libopencv-objdetect4.5d libopencv-photo-dev libopencv-photo4.5d libopencv-shape-dev \</span><br><span class="line">libopencv-shape4.5d libopencv-stitching-dev  libopencv-stitching4.5d libopencv-superres-dev libopencv-superres4.5d \</span><br><span class="line">libopencv-video-dev libopencv-video4.5d libopencv-videoio-dev libopencv-videoio4.5d libopencv-videostab-dev \</span><br><span class="line">libopencv-videostab4.5d libopencv-viz-dev libopencv-viz4.5d libopencv4.5-java libopencv4.5d-jni libopenexr-dev \</span><br><span class="line">libopenmpi3 libpmix2 libpng-dev libpng-tools libpoppler118 libpq5 libproj22 libprotobuf23 libqhull-r8.0 libraw1394-dev \</span><br><span class="line">libraw1394-tools librdmacm1 librttopo1 libsocket++1 libspatialite7 libsuperlu5 libswresample-dev libswscale-dev libsz2 \</span><br><span class="line">libtbb-dev libtbb12 libtbb2 libtbbmalloc2 libtesseract4 libtiff-dev libtiffxx5 libtk8.6 libucx0 liburiparser1 libvtk9.1 \</span><br><span class="line">libwoff1 libwpe-1.0-1 libwpebackend-fdo-1.0-1 libwpewebkit-1.0-3 libxerces-c3.2 libxft2 libxnvctrl0 mysql-common  \</span><br><span class="line">opencv-data proj-bin proj-data  unixodbc-common xdg-dbus-proxy libqt5opengl5 libcanberra0 libpipewire-0.3-0  \</span><br><span class="line">libpipewire-0.3-common libpipewire-0.3-modules libspa-0.2-modules libtdb1 pipewire pipewire-bin \</span><br><span class="line">pipewire-media-session rtkit sound-theme-freedesktop pip qt5-image-formats-plugins qtwayland5 blueman \</span><br><span class="line">libegl-dev libgbm-dev libgl-dev libgles-dev libgles1 libgles2 libglx-dev \</span><br><span class="line">libauthen-sasl-perl libclone-perl libdata-dump-perl libencode-locale-perl libfile-basedir-perl \</span><br><span class="line">libauthen-sasl-perl libclone-perl libdata-dump-perl libfont-afm-perl libgtkd-3-0 \</span><br><span class="line">libhtml-form-perl libhtml-format-perl libhtml-parser-perl libhtml-tagset-perl libhtml-tree-perl \</span><br><span class="line">libhttp-cookies-perl libhttp-daemon-perl libhttp-date-perl libhttp-message-perl libhttp-negotiate-perl \</span><br><span class="line">libio-html-perl libio-socket-ssl-perl libio-stringy-perl libipc-system-simple-perl libllvm11 \</span><br><span class="line">liblwp-mediatypes-perl liblwp-protocol-https-perl libmailtools-perl libnet-dbus-perl libnet-http-perl \</span><br><span class="line">libnet-smtp-ssl-perl libnet-ssleay-perl libphobos2-ldc-shared98 libtie-ixhash-perl libtimedate-perl \</span><br><span class="line">libtry-tiny-perl liburi-perl libvted-3-0 libwww-perl libwww-robotrules-perl libx11-protocol-perl \</span><br><span class="line">libxml-parser-perl libxml-twig-perl libxml-xpathengine-perl libxxf86dga1 perl-openssl-defaults tilix \</span><br><span class="line">tilix-common x11-utils xdg-utils libglvnd-core-dev libglvnd-dev libopengl-dev \</span><br><span class="line">libcec6 libcrossguid0 libfmt8 libfstrcmp0 libimagequant0 libiso9660-11 libkissfft-float131 liblirc-client0 \</span><br><span class="line">libmicrohttpd12 libp8-platform2 libraqm0 libraspberrypi0 libshairplay0 libtinyxml2.6.2v5 \</span><br><span class="line">libwayland-client++0 libwayland-cursor++0 libwayland-egl++0 mailcap mime-support python3-olefile \</span><br><span class="line">python3-pil python3-pycryptodome libjs-iscroll mesa-utils mesa-utils-bin</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF | chroot $&#123;chroot_dir&#125; /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Video Gstreamer</span></span><br><span class="line">apt-get -y install gstreamer1.0-plugins-bad gstreamer1.0-plugins-base gstreamer1.0-plugins-ugly gstreamer1.0-tools gstreamer1.0-alsa \</span><br><span class="line">gstreamer1.0-plugins-base-apps qtmultimedia5-examples gstreamer1.0-x libxv1 libgstreamer-gl1.0-0 \</span><br><span class="line">gstreamer1.0-pulseaudio gstreamer1.0-qt5 libqt5x11extras5 libgstreamer-plugins-good1.0-dev</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mpp</span></span><br><span class="line">dpkg -i /packages/mpp/librockchip-mpp1_1.5.0-1.2_arm64.deb</span><br><span class="line">dpkg -i /packages/mpp/librockchip-mpp-dev_1.5.0-1.2_arm64.deb</span><br><span class="line">dpkg -i /packages/mpp/librockchip-vpu0_1.5.0-1.2_arm64.deb</span><br><span class="line">dpkg -i /packages/mpp/rockchip-mpp-demos_1.5.0-1.2_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gst-rkmpp</span></span><br><span class="line">dpkg -i /packages/gst-rkmpp/gstreamer1.0-rockchip1_1.14-4_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">gstreamer</span></span><br><span class="line">dpkg -i /packages/gstreamer/gir1.2-gstreamer-1.0_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gstreamer/gstreamer1.0-tools_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gstreamer/libgstreamer1.0-0_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gstreamer/libgstreamer1.0-dev_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gst-plugins-base1.0</span></span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/gir1.2-gst-plugins-base-1.0_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/gstreamer1.0-alsa_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/gstreamer1.0-gl_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/gstreamer1.0-plugins-base_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/gstreamer1.0-plugins-base-apps_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/gstreamer1.0-x_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/libgstreamer-gl1.0-0_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/libgstreamer-plugins-base1.0-0_1.20.3-1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-base1.0/libgstreamer-plugins-base1.0-dev_1.20.3-1_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gst-plugins-bad1.0</span></span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/libgstreamer-plugins-bad1.0-0_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/gir1.2-gst-plugins-bad-1.0_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/libgstreamer-opencv1.0-0_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/gstreamer1.0-opencv_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/gstreamer1.0-plugins-bad_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/gstreamer1.0-plugins-bad-apps_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/gstreamer1.0-wpe_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-bad1.0/libgstreamer-plugins-bad1.0-dev_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gst-plugins-good1.0</span></span><br><span class="line">dpkg -i /packages/gst-plugins-good1.0/gstreamer1.0-gtk3_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-good1.0/gstreamer1.0-plugins-good_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-good1.0/gstreamer1.0-pulseaudio_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-good1.0/gstreamer1.0-qt5_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-good1.0/libgstreamer-plugins-good1.0-0_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">dpkg -i /packages/gst-plugins-good1.0/libgstreamer-plugins-good1.0-dev_1.20.3-0ubuntu1_arm64.deb</span><br><span class="line">apt --fix-broken -y install</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Camera</span></span><br><span class="line">dpkg -i /packages/libv4l/libdvbv5-0_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/dvb-tools_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/ir-keytable_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/libdvbv5-dev_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/libdvbv5-doc_1.22.1-2build1_all.deb</span><br><span class="line">dpkg -i /packages/libv4l/libv4l-0_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/libv4l2rds0_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/libv4lconvert0_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/libv4l-dev_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/libv4l-rkmpp_1.5.1-1.1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/v4l-utils_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/qv4l2_1.22.1-2build1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/libv4l-rkmpp_1.5.1-1.1_arm64.deb</span><br><span class="line">dpkg -i /packages/libv4l/rockchip-multimedia-config_1.0.0-2+jammy_all.deb</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF | chroot $&#123;chroot_dir&#125; /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Install Desktop</span></span><br><span class="line">apt-get -y install ubuntu-desktop dbus-x11 xterm pulseaudio pavucontrol qtwayland5 \</span><br><span class="line">gstreamer1.0-plugins-bad gstreamer1.0-plugins-base gstreamer1.0-plugins-good mpv \</span><br><span class="line">gstreamer1.0-tools gstreamer1.0-rockchip1 chromium-browser mali-g610-firmware malirun \</span><br><span class="line">rockchip-multimedia-config librist4 librist-dev rist-tools dvb-tools ir-keytable \</span><br><span class="line">libdvbv5-0 libdvbv5-dev libdvbv5-doc libv4l-0 libv4l2rds0 libv4lconvert0 libv4l-dev \</span><br><span class="line">libv4l-rkmpp qv4l2 v4l-utils librockchip-mpp1 librockchip-mpp-dev librockchip-vpu0 \</span><br><span class="line">rockchip-mpp-demos librga2 librga-dev libegl-mesa0 libegl1-mesa-dev libgbm-dev \</span><br><span class="line">libgl1-mesa-dev libgles2-mesa-dev libglx-mesa0 mesa-common-dev mesa-vulkan-drivers \</span><br><span class="line">mesa-utils libwidevinecdm libcanberra-pulselibbrotli-dev libfontenc-dev libfreetype-dev \</span><br><span class="line">libfreetype6-dev libpixman-1-dev libxcvt-dev libxfont-dev libxkbfile-dev mesa-common-dev</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">chromium</span></span><br><span class="line">dpkg -i /packages/chromium/chromium-codecs-ffmpeg-extra_110.0.5481.4-0ubuntu1~jammy~rkmpp20230130_arm64.deb</span><br><span class="line">dpkg -i /packages/chromium/chromium-browser_110.0.5481.4-0ubuntu1~jammy~rkmpp20230130_arm64.deb</span><br><span class="line">dpkg -i /packages/chromium/chromium-browser-l10n_110.0.5481.4-0ubuntu1~jammy~rkmpp20230130_all.deb</span><br><span class="line">dpkg -i /packages/chromium/chromium-chromedriver_110.0.5481.4-0ubuntu1~jammy~rkmpp20230130_arm64.deb</span><br><span class="line">apt --fix-broken -y install</span><br><span class="line">mkdir -p /etc/chromium-browser/</span><br><span class="line">cp /packages/chromium-x11/default /etc/chromium-browser/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">GPU</span></span><br><span class="line">apt-get remove -y libgl1-amber-dri:arm64</span><br><span class="line">dpkg -i /packages/mesa/mali-g610-firmware_1.0.0-1_all.deb</span><br><span class="line">dpkg -i /packages/mesa/libgbm1_23.0~panfork~csf~git221210.120202c6757~j+3_arm64.deb</span><br><span class="line">dpkg -i /packages/mesa/libgbm-dev_23.0~panfork~csf~git221210.120202c6757~j+3_arm64.deb</span><br><span class="line">dpkg -i /packages/mesa/libglapi-mesa_23.0~panfork~csf~git221210.120202c6757~j+3_arm64.deb</span><br><span class="line">dpkg -i /packages/mesa/libgl1-mesa-dri_23.0~panfork~csf~git221210.120202c6757~j+3_arm64.deb</span><br><span class="line">dpkg -i /packages/mesa/libegl-mesa0_23.0~panfork~csf~git221210.120202c6757~j+3_arm64.deb</span><br><span class="line">dpkg -i /packages/mesa/libglx-mesa0_23.0~panfork~csf~git221210.120202c6757~j+3_arm64.deb</span><br><span class="line">cp /packages/libmali/mali_csffw.bin /lib/firmware/</span><br><span class="line">echo &quot;PAN_MESA_DEBUG=gofaster&quot; &gt;&gt; /etc/environment</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ffmpeg</span></span><br><span class="line">dpkg -i /packages/ffmpeg/libavutil56_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavutil-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libpostproc55_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libpostproc-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libswresample3_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libswresample-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libswscale5_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libswscale-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavcodec58_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavcodec-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavformat58_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavformat-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavfilter7_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavfilter-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavdevice58_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/libavdevice-dev_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line">dpkg -i /packages/ffmpeg/ffmpeg_4.4.2-0ubuntu0.22.04.1_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mpv</span></span><br><span class="line">rm /etc/mpv/mpv.conf</span><br><span class="line">dpkg -i /packages/mpv/libmpv1_0.34.1-1ubuntu3_arm64.deb</span><br><span class="line">dpkg -i /packages/mpv/libmpv-dev_0.34.1-1ubuntu3_arm64.deb</span><br><span class="line">dpkg -i /packages/mpv/mpv_0.34.1-1ubuntu3_arm64.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kodi</span></span><br><span class="line">dpkg -i /packages/kodi/kodi-bin_19.4+dfsg1-2+gles2_arm64.deb</span><br><span class="line">dpkg -i /packages/kodi/kodi-data_19.4+dfsg1-2+gles2_all.deb</span><br><span class="line">dpkg -i /packages/kodi/kodi_19.4+dfsg1-2+gles2_arm64.deb</span><br><span class="line"><span class="meta prompt_">		</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">parpare</span></span><br><span class="line">ln -rsf /usr/lib/*/libv4l2.so /usr/lib/</span><br><span class="line">[ -e /usr/lib/aarch64-linux-gnu/ ] &amp;&amp; ln -Tsf lib /usr/lib64</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">GPU <span class="built_in">test</span></span></span><br><span class="line">dpkg -i /packages/glmark2/libjpeg62-turbo_1.5.1-2_arm64.deb</span><br><span class="line">dpkg -i /packages/glmark2/glmark2*deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">opencv-python</span></span><br><span class="line">pip install opencv-python -i https://pypi.mirrors.ustc.edu.cn/simple/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">clean deb</span></span><br><span class="line">rm -rf /packages</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Clean package cache</span></span><br><span class="line">apt-get -y autoremove &amp;&amp; apt-get -y clean &amp;&amp; apt-get -y autoclean</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF | chroot $&#123;chroot_dir&#125; /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">usb</span></span><br><span class="line">echo &quot;dash dash/sh boolean false&quot; | debconf-set-selections</span><br><span class="line">dpkg-reconfigure dash</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Swapfile</span></span><br><span class="line">cat &lt;&lt; EOF | chroot $&#123;chroot_dir&#125; /bin/bash</span><br><span class="line">set -eE</span><br><span class="line">trap &#x27;echo Error: in $0 on line $LINENO&#x27; ERR</span><br><span class="line"></span><br><span class="line">dd if=/dev/zero of=/tmp/swapfile bs=1024 count=2097152</span><br><span class="line">chmod 600 /tmp/swapfile</span><br><span class="line">mkswap /tmp/swapfile</span><br><span class="line">mv /tmp/swapfile /swapfile</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gdm</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/scripts/gdm-hack.sh $&#123;chroot_dir&#125;/usr/lib/scripts/gdm-hack.sh</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/udev/rules.d/99-gdm-hack.rules $&#123;chroot_dir&#125;/etc/udev/rules.d/99-gdm-hack.rules</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Enable wayland session</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/gdm3/custom.conf $&#123;chroot_dir&#125;/etc/gdm3/custom.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">no <span class="built_in">sleep</span></span></span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/bin/screan-sleep.sh $&#123;chroot_dir&#125;/usr/bin/</span><br><span class="line">cp -r $&#123;overlay_dir&#125;/etc/systemd/system/sysinit.target.wants/screan-sleep.service  $&#123;chroot_dir&#125;/etc/systemd/system/sysinit.target.wants/</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/systemd/system/screan-sleep.service $&#123;chroot_dir&#125;/usr/lib/systemd/system/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Config file <span class="keyword">for</span> xorg</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/etc/X11/xorg.conf.d</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/X11/xorg.conf.d/20-modesetting.conf $&#123;chroot_dir&#125;/etc/X11/xorg.conf.d/20-modesetting.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rfkilL</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/polkit-1/localauthority.conf.d/02-allow-colord.conf  $&#123;chroot_dir&#125;/etc/polkit-1/localauthority.conf.d</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Set gstreamer environment variables</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/profile.d/gst.sh $&#123;chroot_dir&#125;/etc/profile.d/gst.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Set cogl to use gles2</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/profile.d/cogl.sh $&#123;chroot_dir&#125;/etc/profile.d/cogl.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Set qt to use wayland</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/profile.d/qt.sh $&#123;chroot_dir&#125;/etc/profile.d/qt.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Config file <span class="keyword">for</span> mpv</span></span><br><span class="line">mkdir $&#123;chroot_dir&#125;/etc/mpv/ -p</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/mpv/mpv.conf $&#123;chroot_dir&#125;/etc/mpv/mpv.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">iqfiles(ov5695 ov13850)</span></span><br><span class="line">mkdir $&#123;chroot_dir&#125;/etc/iqfiles/ -p</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/iqfiles/* $&#123;chroot_dir&#125;/etc/iqfiles/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Networking interfaces</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/etc/NetworkManager/</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/NetworkManager/NetworkManager.conf $&#123;chroot_dir&#125;/etc/NetworkManager/NetworkManager.conf</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/NetworkManager/conf.d/10-globally-managed-devices.conf $&#123;chroot_dir&#125;/usr/lib/NetworkManager/conf.d/10-globally-managed-devices.conf</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/NetworkManager/conf.d/10-override-wifi-random-mac-disable.conf $&#123;chroot_dir&#125;/usr/lib/NetworkManager/conf.d/10-override-wifi-random-mac-disable.conf</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/NetworkManager/conf.d/20-override-wifi-powersave-disable.conf $&#123;chroot_dir&#125;/usr/lib/NetworkManager/conf.d/20-override-wifi-powersave-disable.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Set chromium inital prefrences</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/usr/lib/chromium-browser</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/chromium-browser/initial_preferences $&#123;chroot_dir&#125;/usr/lib/chromium-browser/initial_preferences</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Set chromium default launch args</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/etc/chromium-browser</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/chromium-browser/default $&#123;chroot_dir&#125;/etc/chromium-browser/default</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Have plymouth use the framebuffer</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/etc/initramfs-tools/conf-hooks.d</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/initramfs-tools/conf-hooks.d/plymouth $&#123;chroot_dir&#125;/etc/initramfs-tools/conf-hooks.d/plymouth</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Update initramfs</span></span><br><span class="line">chroot $&#123;chroot_dir&#125; /bin/bash -c &quot;update-initramfs -u&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">adbd usb</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/bin/adbd $&#123;chroot_dir&#125;/usr/bin/</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/profile.d/usbdevice.sh $&#123;chroot_dir&#125;/etc/profile.d/</span><br><span class="line">cp -r $&#123;overlay_dir&#125;/etc/systemd/system/sysinit.target.wants/usbdevice.service  $&#123;chroot_dir&#125;/etc/systemd/system/sysinit.target.wants/</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/bin/usbdevice $&#123;chroot_dir&#125;/usr/bin/</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/systemd/system/usbdevice.service $&#123;chroot_dir&#125;/usr/lib/systemd/system/</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/udev/rules.d/61-usbdevice.rules $&#123;chroot_dir&#125;/usr/lib/udev/rules.d/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Set cpu governor to performance</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/systemd/system/cpu-governor-performance.service $&#123;chroot_dir&#125;/usr/lib/systemd/system/cpu-governor-performance.service</span><br><span class="line">chroot $&#123;chroot_dir&#125; /bin/bash -c &quot;systemctl enable cpu-governor-performance&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Set gpu governor to performance</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/systemd/system/gpu-governor-performance.service $&#123;chroot_dir&#125;/usr/lib/systemd/system/gpu-governor-performance.service</span><br><span class="line">chroot $&#123;chroot_dir&#125; /bin/bash -c &quot;systemctl enable gpu-governor-performance&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">async</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/usr/local/bin/</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/init.d/S10atomic_commit.sh  $&#123;chroot_dir&#125;/etc/init.d/</span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/etc/systemd/system/multi-user.target.wants/</span><br><span class="line">cp -r $&#123;overlay_dir&#125;/etc/systemd/system/multi-user.target.wants/async.service $&#123;chroot_dir&#125;/etc/systemd/system/multi-user.target.wants/</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/local/bin/modetest $&#123;chroot_dir&#125;/usr/local/bin/</span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/lib/systemd/system/async.service $&#123;chroot_dir&#125;/usr/lib/systemd/system/async.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">drm</span></span><br><span class="line">mkdir -p $&#123;chroot_dir&#125;/etc/udev/rules.d</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/udev/rules.d/60-drm.rules $&#123;chroot_dir&#125;/etc/udev/rules.d/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pulse</span></span><br><span class="line">cp -r $&#123;overlay_dir&#125;/etc/pulse $&#123;chroot_dir&#125;/etc/pulse</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/udev/rules.d/88-rockchip-camera.rules $&#123;chroot_dir&#125;/etc/udev/rules.d/</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/udev/rules.d/90-pulseaudio-rockchip.rules $&#123;chroot_dir&#125;/etc/udev/rules.d/</span><br><span class="line">cp $&#123;overlay_dir&#125;/etc/udev/rules.d/99-rockchip-permissions.rules $&#123;chroot_dir&#125;/etc/udev/rules.d/</span><br><span class="line">cp -r $&#123;overlay_dir&#125;/usr/share/alsa $&#123;chroot_dir&#125;/usr/share/</span><br><span class="line">cp -r $&#123;overlay_dir&#125;/usr/share/pulseaudio $&#123;chroot_dir&#125;/usr/share/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">user <span class="built_in">local</span> bin apt ros docker qt</span></span><br><span class="line">cp $&#123;overlay_dir&#125;/usr/local/bin/*  $&#123;chroot_dir&#125;/usr/local/bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">etc/udev/rules.d</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">qt clean display</span></span><br><span class="line">cat &lt;&lt; EOF | chroot $&#123;chroot_dir&#125; /bin/bash</span><br><span class="line">cd /usr/lib/aarch64-linux-gnu/dri/</span><br><span class="line">cp rockchip_dri.so /</span><br><span class="line">rm /usr/lib/aarch64-linux-gnu/dri/*.so</span><br><span class="line">mv /*.so /usr/lib/aarch64-linux-gnu/dri/</span><br><span class="line">rm /etc/profile.d/qt.sh</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Umount the temporary API filesystems</span></span><br><span class="line">umount -lf $&#123;chroot_dir&#125;/dev/pts 2&gt; /dev/null || true</span><br><span class="line">umount -lf $&#123;chroot_dir&#125;/* 2&gt; /dev/null || true</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Tar the entire rootfs</span></span><br><span class="line">cd $&#123;chroot_dir&#125; &amp;&amp; XZ_OPT=&quot;-3 -T0&quot; tar -cpJf ../ubuntu-22.04.2-preinstalled-desktop-arm64.rootfs.tar.xz . &amp;&amp; cd ..</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%91%9E%E8%8A%AF%E5%BE%AE%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90/" rel="tag">瑞芯微脚本分析</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-9-1-在家学习记录"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/09/18/9-1-%E5%9C%A8%E5%AE%B6%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"
    >9-1 在家学习记录</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/09/18/9-1-%E5%9C%A8%E5%AE%B6%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" class="article-date">
  <time datetime="2023-09-18T13:50:14.000Z" itemprop="datePublished">2023-09-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%9C%A8%E5%AE%B6%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">在家学习记录</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>在Linux内核中，GPIO（通用输入&#x2F;输出）子系统存在两个版本，分别是新版本和旧版本。新版本的接口是基于描述符（descriptor-based）的，而旧版本的接口是基于整数（integer-based）的。为了保持兼容性，旧版本的接口仍然得到支持，但是在本期课程中我们建议使用新的接口。</p>
<p>新的GPIO子系统接口与设备树（Device Tree）结合使用。设备树是一种描述硬件设备信息的数据结构，它提供了一种统一的方式来描述系统中的硬件设备和资源。因此，如果没有设备树，就无法使用新的GPIO接口。</p>
<p>对于新旧GPIO子系统接口的区分，可以根据函数名的前缀进行判断。</p>
<ol>
<li>新的GPIO子系统接口：前缀为”gpiod_”<br>新的GPIO子系统接口的函数名以”gpiod_”作为前缀，例如”gpiod_set_value”。这些接口是基于描述符（descriptor-based）的。</li>
<li>旧的GPIO子系统接口：前缀为”gpio_”<br>旧的GPIO子系统接口的函数名以”gpio_”作为前缀，例如”gpio_set_value”。这些接口是基于整数（integer-based）的。</li>
</ol>
<p>对于新的GPIO子系统接口，它们的定义可以在<code>include/linux/gpio/consumer.h</code>头文件中找到。在新的GPIO子系统接口中，涉及到了一个名为<code>struct gpio_desc</code>的结构体，该结构体用于描述GPIO设备的属性和状态。</p>
<p>通过使用新的GPIO子系统接口，可以更加灵活地配置和控制GPIO设备，提供了更好的可扩展性和可移植性。</p>
<p>&#x2F;deiver&#x2F;gpio&#x2F;gpiolib.h</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gpio_desc</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">gpio_device</span> <span class="title">gdev</span>;</span>    <span class="comment">// GPIO设备结构体</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> flags;        <span class="comment">// 标志位，用于表示不同的属性</span></span><br><span class="line">    <span class="comment">/* 标志位符号对应的位号 */</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> FLAG_REQUESTED 0        <span class="comment">// GPIO已请求</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> FLAG_IS_OUT 1           <span class="comment">// GPIO用作输出</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> FLAG_EXPORT 2           <span class="comment">// 受sysfs_lock保护的导出标志 </span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> FLAG_SYSFS 3            <span class="comment">// 通过/sys/class/gpio/control导出的标志</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> FLAG_ACTIVE_LOW 6       <span class="comment">// GPIO值为低电平时激活</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> FLAG_OPEN_DRAIN 7       <span class="comment">// GPIO为开漏类型</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> FLAG_OPEN_SOURCE 8      <span class="comment">// GPIO为开源类型</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> FLAG_USED_AS_IRQ 9      <span class="comment">// GPIO连接到中断请求（IRQ）</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> FLAG_IS_HOGGED 11       <span class="comment">// GPIO被独占占用</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> FLAG_TRANSITORY 12      <span class="comment">// GPIO在休眠或复位时可能失去值</span></span></span><br><span class="line">    <span class="comment">/* 连接标签 */</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *label;            <span class="comment">// GPIO的名称</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *name;             <span class="comment">// GPIO的名称</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gpio_device</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> id;                             <span class="comment">// GPIO设备ID</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">device</span> *<span class="title">dev</span>;</span>                 <span class="comment">// 对应的设备结构体指针</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">cdev</span> <span class="title">chrdev</span>;</span>                 <span class="comment">// 字符设备结构体</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">device</span> *<span class="title">mockdev</span>;</span>             <span class="comment">// 模拟设备结构体指针</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">module</span> *<span class="title">owner</span>;</span>               <span class="comment">// 拥有该GPIO设备的内核模块指针</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">gpio_chip</span> *<span class="title">chip</span>;</span>             <span class="comment">// 对应的GPIO芯片结构体指针</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">gpio_desc</span> *<span class="title">descs</span>;</span>            <span class="comment">// GPIO描述符数组指针</span></span><br><span class="line">    <span class="type">int</span> base;                           <span class="comment">// GPIO编号的起始值</span></span><br><span class="line">    u16 ngpio;                          <span class="comment">// GPIO的数量</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *label;                  <span class="comment">// GPIO设备的标签</span></span><br><span class="line">    <span class="type">void</span> *data;                         <span class="comment">// 与GPIO设备相关的数据指针</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">list</span>;</span>              <span class="comment">// 用于将GPIO设备结构体连接到链表中</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_PINCTRL</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 如果启用了CONFIG_PINCTRL选项，GPIO控制器可以选择描述它们在SoC中服务的实际引脚范围。</span></span><br><span class="line"><span class="comment">     * 此信息将由pinctrl子系统用于配置相应的GPIO引脚。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">pin_ranges</span>;</span>        <span class="comment">// 描述GPIO控制器引脚范围的链表</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gpio_chip</span> &#123;</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *label;                              <span class="comment">// GPIO芯片标签</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">gpio_device</span> <span class="title">gpiodev</span>;</span>                      <span class="comment">// GPIO设备</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">device</span> *<span class="title">parent</span>;</span>                           <span class="comment">// 父设备指针</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">module</span> *<span class="title">owner</span>;</span>                            <span class="comment">// 拥有者模块指针</span></span><br><span class="line">    <span class="type">int</span> (*request)(<span class="keyword">struct</span> gpio_chip *chip, <span class="type">unsigned</span> offset);                 <span class="comment">// 请求GPIO</span></span><br><span class="line">    <span class="type">void</span> (*<span class="built_in">free</span>)(<span class="keyword">struct</span> gpio_chip *chip, <span class="type">unsigned</span> offset);                    <span class="comment">// 释放GPIO</span></span><br><span class="line">    <span class="type">int</span> (*get_direction)(<span class="keyword">struct</span> gpio_chip *chip, <span class="type">unsigned</span> offset);           <span class="comment">// 获取GPIO方向</span></span><br><span class="line">    <span class="type">int</span> (*direction_input)(<span class="keyword">struct</span> gpio_chip *chip, <span class="type">unsigned</span> offset);         <span class="comment">// 设置GPIO为输入</span></span><br><span class="line">    <span class="type">int</span> (*direction_output)(<span class="keyword">struct</span> gpio_chip *chip, <span class="type">unsigned</span> offset, <span class="type">int</span> value); <span class="comment">// 设置GPIO为输出</span></span><br><span class="line">    <span class="type">int</span> (*get)(<span class="keyword">struct</span> gpio_chip chip, <span class="type">unsigned</span> offset);                      <span class="comment">// 获取GPIO值</span></span><br><span class="line">    <span class="type">int</span> (*get_multiple)(<span class="keyword">struct</span> gpio_chip chip, <span class="type">unsigned</span> <span class="type">long</span> *mask, <span class="type">unsigned</span> <span class="type">long</span> *bits); <span class="comment">// 获取多个GPIO的值</span></span><br><span class="line">    <span class="type">void</span> (*<span class="built_in">set</span>)(<span class="keyword">struct</span> gpio_chip chip, <span class="type">unsigned</span> offset, <span class="type">int</span> value);          <span class="comment">// 设置GPIO值</span></span><br><span class="line">    <span class="type">void</span> (*set_multiple)(<span class="keyword">struct</span> gpio_chip chip, <span class="type">unsigned</span> <span class="type">long</span> mask, <span class="type">unsigned</span> <span class="type">long</span> *bits); <span class="comment">// 设置多个GPIO的值</span></span><br><span class="line">    <span class="type">int</span> (*set_config)(<span class="keyword">struct</span> gpio_chip *chip, <span class="type">unsigned</span> offset, <span class="type">unsigned</span> <span class="type">long</span> config); <span class="comment">// 设置GPIO配置 </span></span><br><span class="line">    <span class="type">int</span> (*to_irq)(<span class="keyword">struct</span> gpio_chip chip, <span class="type">unsigned</span> offset);                    <span class="comment">// 将GPIO转换为中断</span></span><br><span class="line">    <span class="type">void</span> (*dbg_show)(<span class="keyword">struct</span> seq_file *s, <span class="keyword">struct</span> gpio_chip chip);              <span class="comment">// 在调试信息中显示GPIO</span></span><br><span class="line">    <span class="type">int</span> base;                                     <span class="comment">// GPIO编号的基准值</span></span><br><span class="line">    u16 ngpio;                                    <span class="comment">// GPIO的数量</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *<span class="type">const</span> *names;                     <span class="comment">// GPIO的名称数组</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>





<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> gpio_desc *<span class="title function_">gpiod_get</span><span class="params">(<span class="keyword">struct</span> device *dev, <span class="type">const</span> <span class="type">char</span> *con_id, <span class="keyword">enum</span> gpiod_flags flags)</span>;</span><br><span class="line"><span class="keyword">struct</span> gpio_desc *<span class="title function_">gpiod_get_index</span><span class="params">(<span class="keyword">struct</span> device *dev, <span class="type">const</span> <span class="type">char</span> *con_id, <span class="type">unsigned</span> <span class="type">int</span> idx, <span class="keyword">enum</span> gpiod_flags flags)</span>;</span><br><span class="line"><span class="keyword">struct</span> gpio_desc *<span class="title function_">gpiod_get_optional</span><span class="params">(<span class="keyword">struct</span> device *dev, <span class="type">const</span> <span class="type">char</span> *con_id, <span class="keyword">enum</span> gpiod_flags flags)</span>;</span><br><span class="line"><span class="keyword">struct</span> gpio_desc *<span class="title function_">gpiod_get_index_optional</span><span class="params">(<span class="keyword">struct</span> device *dev, <span class="type">const</span> <span class="type">char</span> *con_id, <span class="type">unsigned</span> <span class="type">int</span> index, <span class="keyword">enum</span> gpiod_flags flags)</span>;</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9C%A8%E5%AE%B6%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" rel="tag">在家学习记录</a></li></ul>

    </footer>
  </div>

   
   
  
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2023
        <i class="ri-heart-fill heart_icon"></i> John Doe
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="热爱学习的未来酱"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2019/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->
 
<script src="/js/clickBoom2.js"></script>
 
<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>