<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta name="description" content="永远年轻，永远热泪盈眶" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> 热爱学习的未来酱</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <link rel="alternate" href="/atom.xml" title="热爱学习的未来酱" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/1.png" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">热爱学习的未来酱</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['我希望用一生的时间不断学习和深入电子计算机相关的一切知识，并将其整理成网络，分享出来，与更多志同道合的朋友一起进步', '无论你最终要成为一个怎样的人，千万要记住，时间在飞逝。', ''],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  <article class="articles">
    
    
    
    
    <article
  id="post-01_生活/18_反思(9月第3个星期)"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/09/18/01_%E7%94%9F%E6%B4%BB/18_%E5%8F%8D%E6%80%9D(9%E6%9C%88%E7%AC%AC3%E4%B8%AA%E6%98%9F%E6%9C%9F)/"
    >反思(9月第3个星期）</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/09/18/01_%E7%94%9F%E6%B4%BB/18_%E5%8F%8D%E6%80%9D(9%E6%9C%88%E7%AC%AC3%E4%B8%AA%E6%98%9F%E6%9C%9F)/" class="article-date">
  <time datetime="2024-09-18T12:26:56.000Z" itemprop="datePublished">2024-09-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%94%9F%E6%B4%BB/">生活</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  Here's something encrypted, password is required to continue reading. 
      <a class="article-more-link" href="/2024/09/18/01_%E7%94%9F%E6%B4%BB/18_%E5%8F%8D%E6%80%9D(9%E6%9C%88%E7%AC%AC3%E4%B8%AA%E6%98%9F%E6%9C%9F)/"
        >阅读更多...</a
      >
       
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-07_小技巧/18_ubuntu一键配置"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/09/13/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/18_ubuntu%E4%B8%80%E9%94%AE%E9%85%8D%E7%BD%AE/"
    >ubuntu一键配置</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/09/13/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/18_ubuntu%E4%B8%80%E9%94%AE%E9%85%8D%E7%BD%AE/" class="article-date">
  <time datetime="2024-09-12T22:50:19.000Z" itemprop="datePublished">2024-09-13</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  Here's something encrypted, password is required to continue reading. 
      <a class="article-more-link" href="/2024/09/13/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/18_ubuntu%E4%B8%80%E9%94%AE%E9%85%8D%E7%BD%AE/"
        >阅读更多...</a
      >
       
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-02_瑞芯微/23_瑞芯微TF卡烧写大于4G容量镜像的方法"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/09/12/02_%E7%91%9E%E8%8A%AF%E5%BE%AE/23_%E7%91%9E%E8%8A%AF%E5%BE%AETF%E5%8D%A1%E7%83%A7%E5%86%99%E5%A4%A7%E4%BA%8E4G%E5%AE%B9%E9%87%8F%E9%95%9C%E5%83%8F%E7%9A%84%E6%96%B9%E6%B3%95/"
    >瑞芯微TF卡烧写大于4G容量镜像的方法</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/09/12/02_%E7%91%9E%E8%8A%AF%E5%BE%AE/23_%E7%91%9E%E8%8A%AF%E5%BE%AETF%E5%8D%A1%E7%83%A7%E5%86%99%E5%A4%A7%E4%BA%8E4G%E5%AE%B9%E9%87%8F%E9%95%9C%E5%83%8F%E7%9A%84%E6%96%B9%E6%B3%95/" class="article-date">
  <time datetime="2024-09-12T09:17:03.000Z" itemprop="datePublished">2024-09-12</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%91%9E%E8%8A%AF%E5%BE%AE/">瑞芯微</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr />
<p>首先按照手册的方法，找一个普通buildroot镜像，创建固件升级镜像，升级步骤如下图所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409121053784.png" alt="image-20240912105310740" /></p>
<p>升级完成之后将TF卡转到ubuntu虚拟机，TF卡默认格式为FAT32格式，TF卡里的内容如下图所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409121056518.png" alt="image-20240912105605487" /></p>
<p>由于FAT32格式的TF卡只能存放4G以下容量的文件，所以这里要重新拷贝上述文件（==瑞芯微sd卡工具制作步骤不能缺少，因为需要进入recovery进行系统升级==），为了方便起见，可以直接使用以下脚本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查参数数量</span></span><br><span class="line">if [ &quot;$#&quot; -ne 2 ]; then</span><br><span class="line">    echo -e &quot;\033[31m用法: $0 &lt;磁盘设备&gt; &lt;挂载点&gt;\033[0m&quot;</span><br><span class="line">    echo -e &quot;\033[33m例如: $0 /dev/sdc1 /mnt\033[0m&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">DISK=$1</span><br><span class="line">MNT=$2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Step 1: 创建临时目录并制作空的 rksdfw.tag</span></span><br><span class="line">echo -e &quot;\033[32m步骤 1: 创建临时目录并制作空的 rksdfw.tag...\033[0m&quot;</span><br><span class="line">touch rksdfw.tag</span><br><span class="line">echo -e &quot;\033[32mrksdfw.tag 文件已创建。\033[0m&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Step 2: 制作升级的配置文件 sd_boot_config.config</span></span><br><span class="line">echo -e &quot;\033[32m步骤 2: 创建 sd_boot_config.config 文件...\033[0m&quot;</span><br><span class="line">cat &lt;&lt;EOL &gt; sd_boot_config.config</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">rockchip sdcard boot config file <span class="keyword">for</span> factory</span></span><br><span class="line">loader_update = 0</span><br><span class="line">display_led = 1</span><br><span class="line">display_lcd = 1</span><br><span class="line">pcba_test = 0</span><br><span class="line">fw_update = 1</span><br><span class="line">demo_copy = 0</span><br><span class="line">EOL</span><br><span class="line">echo -e &quot;\033[32msd_boot_config.config 文件已创建。\033[0m&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Step 3: 检查固件文件是否存在</span></span><br><span class="line">if [ ! -f sdupdate.img ]; then</span><br><span class="line">    echo -e &quot;\033[31m错误: 当前目录中未找到 sdupdate.img 文件。\033[0m&quot;</span><br><span class="line">    echo -e &quot;\033[33m请将要升级的固件文件拷贝到当前目录，并重命名为 sdupdate.img。\033[0m&quot;</span><br><span class="line">    exit 1</span><br><span class="line">else</span><br><span class="line">    echo -e &quot;\033[32msdupdate.img 文件已找到。\033[0m&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Step 4: 格式化磁盘并拷贝文件</span></span><br><span class="line">echo -e &quot;\033[32m步骤 4: 格式化磁盘并拷贝文件...\033[0m&quot;</span><br><span class="line">sudo umount $DISK</span><br><span class="line">if [ $? -ne 0 ]; then</span><br><span class="line">    echo -e &quot;\033[31m卸载 $DISK 失败，请确认设备未被占用。\033[0m&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">sudo mkfs.ext4 -F $DISK</span><br><span class="line">if [ $? -ne 0 ]; then</span><br><span class="line">    echo -e &quot;\033[31m格式化 $DISK 失败。\033[0m&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">sudo mount $DISK $MNT</span><br><span class="line">if [ $? -ne 0 ]; then</span><br><span class="line">    echo -e &quot;\033[31m挂载 $DISK 到 $MNT 失败。\033[0m&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">sudo cp rksdfw.tag sd_boot_config.config sdupdate.img $MNT</span><br><span class="line">if [ $? -ne 0 ]; then</span><br><span class="line">    echo -e &quot;\033[31m拷贝文件到 $MNT 失败。\033[0m&quot;</span><br><span class="line">    sudo umount $MNT</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">sudo umount $MNT</span><br><span class="line">if [ $? -ne 0 ]; then</span><br><span class="line">    echo -e &quot;\033[31m卸载 $MNT 失败。\033[0m&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo -e &quot;\033[32m步骤 4 完成: 磁盘格式化并成功拷贝文件。\033[0m&quot;</span><br></pre></td></tr></table></figure>
<h3 id="使用"><a class="markdownIt-Anchor" href="#使用"></a> 使用：</h3>
<p>保存该脚本为 <code>full_flash.sh</code>，然后像之前一样赋予可执行权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x full_flash.sh</span><br></pre></td></tr></table></figure>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409121059549.png" alt="image-20240912105910514" /></p>
<p>然后将要烧写的镜像拷贝到当前目录，并重命名为sdupdate.img</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409121100987.png" alt="" /></p>
<p>最后使用以下命令拷贝制作必须的文件即可，其中第一个参数为TF卡的盘符，第二个为挂载目录，制作过程如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./full_flash.sh /dev/sdc1 /mnt</span><br></pre></td></tr></table></figure>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409121109371.png" alt="image-20240912110939287" /></p>
<p>升级完成之后，会提升以下打印信息，拔掉TF卡重启即可正常进入系统：<br />
<img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409121106625.png" alt="image-20240912110644587" /></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-01_生活/17_反思(9月第2个星期)"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/09/09/01_%E7%94%9F%E6%B4%BB/17_%E5%8F%8D%E6%80%9D(9%E6%9C%88%E7%AC%AC2%E4%B8%AA%E6%98%9F%E6%9C%9F)/"
    >反思(9月第2个星期）</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/09/09/01_%E7%94%9F%E6%B4%BB/17_%E5%8F%8D%E6%80%9D(9%E6%9C%88%E7%AC%AC2%E4%B8%AA%E6%98%9F%E6%9C%9F)/" class="article-date">
  <time datetime="2024-09-09T12:26:56.000Z" itemprop="datePublished">2024-09-09</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%94%9F%E6%B4%BB/">生活</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  Here's something encrypted, password is required to continue reading. 
      <a class="article-more-link" href="/2024/09/09/01_%E7%94%9F%E6%B4%BB/17_%E5%8F%8D%E6%80%9D(9%E6%9C%88%E7%AC%AC2%E4%B8%AA%E6%98%9F%E6%9C%9F)/"
        >阅读更多...</a
      >
       
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-06_工作记录/28_工作记录(九月第二个星期)"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/09/08/06_%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/28_%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95(%E4%B9%9D%E6%9C%88%E7%AC%AC%E4%BA%8C%E4%B8%AA%E6%98%9F%E6%9C%9F)/"
    >工作记录(九月第二个星期)</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/09/08/06_%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/28_%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95(%E4%B9%9D%E6%9C%88%E7%AC%AC%E4%BA%8C%E4%B8%AA%E6%98%9F%E6%9C%9F)/" class="article-date">
  <time datetime="2024-09-08T13:26:56.000Z" itemprop="datePublished">2024-09-08</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/">工作记录</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="98工作记录星期日"><a class="markdownIt-Anchor" href="#98工作记录星期日"></a> 9.8工作记录(星期日)</h1>
<p>==摆脱一份幻觉比发现一个真理更能使人明智==</p>
<p>==当你在凝视深渊的时候，深渊也在凝视你==</p>
<p>==我希望用一生的时间不断深入和学习电子计算机相关的全部知识，将其整理成网络并分享出去，与更多志同道合的朋友共同进步，你清楚的知道，如果做不到这一点，你将永远不快乐==</p>
<hr />
<p>今天周日，但是上班，我感觉还挺好的 ，我发现唯有在上班的时候才能真正的静下心来，当在家里因为某些事情丧失了理智之后，就真的只有公司这一个地方来给我带来宁静了，还是那句话，有些事情不能因为你想啥就是啥，很多事情都需要精心规划的，而不能想到什么就去做什么，昨天睡不着觉的原因果然就是身体因素，体温太低了，跟那种室温高还不一样，我认为是那些行为的问题，中午的这个行为从根本上来说就是错误的，不对吗。</p>
<p>我确实不应该这样做，我应该继续钻研超频，而不是像昨天那样，浪费了三个小时的时间，而且这个睡眠并没啥用，唯有心理作用罢了，晚上又让我睡不着了，我发现我的心脏跳动的频率都有点乱了，不能静下心来，都有对应的原因，但应该从今天开始应该就会好很多，幸好上班了，而且我也花钱了，还不错吧，然后开始今天的任务。</p>
<hr />
<p>周五晚上完善了一下构建，现在就只有ubuntu这一个构建，我认为就不要有其他的构建了，然后继续研究一下，我是搞源码呢，还是搞一下旋转呢，其实都可以的</p>
<p>烧写5.10的ubuntu22镜像，12:26 开始的 14：29完成，大约120秒，我的镜像大小为4.5G。38.4M每秒，还行吧</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取显示器名称</span></span><br><span class="line">display_name=$(xrandr | grep &quot; connected&quot; | awk &#x27;&#123; print $1 &#125;&#x27;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">判断是否存在 <span class="string">&quot;goodix-ts&quot;</span> 触摸屏设备</span></span><br><span class="line">touch_name=$(xinput list | grep -i &quot;goodix-ts&quot; | grep -oP &#x27;(?&lt;=↳ ).*(?=\s+id)&#x27;)</span><br><span class="line">touch_id=$(xinput list | grep -i &quot;goodix-ts&quot; | grep -oP &#x27;(?&lt;=id=)[0-9]+&#x27;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果 <span class="string">&quot;goodix-ts&quot;</span> 没有找到，选择 <span class="string">&quot;ft5x06&quot;</span> 触摸屏设备</span></span><br><span class="line">if [ -z &quot;$touch_id&quot; ]; then</span><br><span class="line">    touch_name=$(xinput list | grep -i &quot;ft5x06&quot; | grep -oP &#x27;(?&lt;=↳ ).*(?=\s+id)&#x27;)</span><br><span class="line">    touch_id=$(xinput list | grep -i &quot;ft5x06&quot; | grep -oP &#x27;(?&lt;=id=)[0-9]+&#x27;)</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果没有找到显示器或触摸屏设备，退出</span></span><br><span class="line">if [ -z &quot;$display_name&quot; ]; then</span><br><span class="line">    echo &quot;没有找到连接的显示器！&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$touch_id&quot; ]; then</span><br><span class="line">    echo &quot;没有找到触摸屏设备！&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示旋转选项给用户选择</span></span><br><span class="line">echo &quot;选择旋转角度:&quot;</span><br><span class="line">echo &quot;1. 正常显示&quot;</span><br><span class="line">echo &quot;2. 向左旋转90度&quot;</span><br><span class="line">echo &quot;3. 向右旋转90度&quot;</span><br><span class="line">echo &quot;4. 旋转180度&quot;</span><br><span class="line"></span><br><span class="line">read -p &quot;请输入选项 (1-4): &quot; choice</span><br><span class="line"></span><br><span class="line">case $choice in</span><br><span class="line">    1)</span><br><span class="line">        # 正常显示</span><br><span class="line">        xrandr --output &quot;$display_name&quot; --rotate normal</span><br><span class="line">        xinput set-prop &quot;$touch_id&quot; &quot;Coordinate Transformation Matrix&quot; 1 0 0 0 1 0 0 0 1</span><br><span class="line">        ;;</span><br><span class="line">    2)</span><br><span class="line">        # 向左旋转90度</span><br><span class="line">        xrandr --output &quot;$display_name&quot; --rotate left</span><br><span class="line">        xinput set-prop &quot;$touch_id&quot; &quot;Coordinate Transformation Matrix&quot; 0 -1 1 1 0 0 0 0 1</span><br><span class="line">        ;;</span><br><span class="line">    3)</span><br><span class="line">        # 向右旋转90度</span><br><span class="line">        xrandr --output &quot;$display_name&quot; --rotate right</span><br><span class="line">        xinput set-prop &quot;$touch_id&quot; &quot;Coordinate Transformation Matrix&quot; 0 1 0 -1 0 1 0 0 1</span><br><span class="line">        ;;</span><br><span class="line">    4)</span><br><span class="line">        # 旋转180度</span><br><span class="line">        xrandr --output &quot;$display_name&quot; --rotate inverted</span><br><span class="line">        xinput set-prop &quot;$touch_id&quot; &quot;Coordinate Transformation Matrix&quot; -1 0 1 0 -1 1 0 0 1</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        echo &quot;无效选项！&quot;</span><br><span class="line">        exit 1</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">echo &quot;显示器和触摸屏旋转已同步完成。&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="1-创建并切换到一个新的本地分支"><a class="markdownIt-Anchor" href="#1-创建并切换到一个新的本地分支"></a> 1. <strong>创建并切换到一个新的本地分支</strong></h4>
<p>首先，创建一个与远程分支 <code>origin/ubuntu22.04</code> 相对应的本地分支。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">git checkout -b ubuntu22.04</span><br></pre></td></tr></table></figure>
<p>这将：</p>
<ul>
<li>创建一个名为 <code>ubuntu22.04</code> 的本地分支。</li>
<li>将 HEAD 从分离状态附加到新的本地分支 <code>ubuntu22.04</code>。</li>
</ul>
<h4 id="2-设置本地分支与远程分支的追踪关系"><a class="markdownIt-Anchor" href="#2-设置本地分支与远程分支的追踪关系"></a> 2. <strong>设置本地分支与远程分支的追踪关系</strong></h4>
<p>为了确保你可以在本地分支上提交并推送到远程仓库，你需要设置本地分支与远程分支的追踪关系。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch --set-upstream-to=origin/ubuntu22.04</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><figcaption><span>apt update</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">apt install libegl-dev libgles-dev libgles1 libglvnd-core-dev libglvnd-dev libopengl-dev</span><br></pre></td></tr></table></figure>
<p>目前的问题是，不能打开设置，其他的倒是没啥问题，设置里面一般也没啥吧</p>
<h1 id="99工作记录星期一"><a class="markdownIt-Anchor" href="#99工作记录星期一"></a> 9.9工作记录(星期一)</h1>
<p>==摆脱一份幻觉，比发现一个真理更能使人明智==</p>
<p>==当你在凝视深渊的时候，深渊也在凝视你==</p>
<p>==我希望用一生的时间不断深入和学习电子计算机相关的全部知识，将其整理成网络并分享出去，与更多志同道合的朋友共同进步，你清楚的知道，如果做不到这一点，你将永远不快乐==</p>
<hr />
<p>明天我的CPU和水冷就到了，预测是明天上午大约就到了，如果明天中午来得就明天中午，如果来不及就晚上吃完饭晚上装，就也挺好的，昨天晚上睡眠不错，又一次步入了正轨，很不错，然后开始今天的工作了，今天继续维护我的ubuntu，现在有两个方向，1是搞debian 的，2是搞</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;默认会有一个根目录deb包生成，增加删除命令&quot;</span><br><span class="line">git push</span><br></pre></td></tr></table></figure>
<h1 id="910工作记录星期二"><a class="markdownIt-Anchor" href="#910工作记录星期二"></a> 9.10工作记录(星期二)</h1>
<p>==摆脱一份幻觉比发现一个真理更能使人明智==</p>
<p>==当你在凝视深渊的时候，深渊也在凝视你==</p>
<p>==我希望用一生的时间不断深入和学习电子计算机相关的全部知识，将其整理成网络并分享出去，与更多志同道合的朋友共同进步，你清楚的知道，如果做不到这一点，你将永远不快乐==</p>
<hr />
<p>昨天找了一天的问题，首先是找ubuntu22 gnome桌面无法打开的问题，现在看来都是这个问题，应该是驱动啥的引起的，这个没办法，</p>
<p>nfs-kernel-server</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">if [ ! -d $TARGET_ROOTFS_DIR ]; then</span><br><span class="line">    mkdir -p $TARGET_ROOTFS_DIR</span><br><span class="line"></span><br><span class="line">    debootstrap --variant=buildd \</span><br><span class="line">    --components=&quot;main,contrib&quot; \</span><br><span class="line">    --arch=&quot;arm64&quot; \</span><br><span class="line">    --foreign \</span><br><span class="line">    --include=&quot;ccache,locales,git,ca-certificates,devscripts,libfile-fcntllock-perl,debhelper,rsync,python3,apt-utils,perl-openssl-defaults&quot; \</span><br><span class="line">    &quot;buster&quot; \</span><br><span class="line">    &quot;$&#123;TARGET_ROOTFS_DIR&#125;&quot; \</span><br><span class="line">    &quot;https://repo.huaweicloud.com/debian/&quot;</span><br><span class="line"></span><br><span class="line">    # 复制当前系统的 DNS 解析配置到目标根文件系统中</span><br><span class="line">    cp -b /etc/resolv.conf $TARGET_ROOTFS_DIR/etc/resolv.conf</span><br><span class="line">    </span><br><span class="line">    # 根据系统架构，复制相应的 qemu 可执行文件，以便在 chroot 环境中运行</span><br><span class="line">    cp -b /usr/bin/qemu-aarch64-static $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line"></span><br><span class="line">    # 运行 debootstrap 的第二阶段</span><br><span class="line">    chroot &quot;$&#123;TARGET_ROOTFS_DIR&#125;&quot; /bin/bash -c &quot;/debootstrap/debootstrap --second-stage&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h1 id="911-工作记录"><a class="markdownIt-Anchor" href="#911-工作记录"></a> 9.11 工作记录</h1>
<p>==当你在凝视深渊的时候，深渊也在凝视你==</p>
<p>==摆脱一份幻觉比发现一个真理更能使人明智==</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install linux-image-generic-hwe-22.04 </span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/community/content/wsl-user-msft-kernel-v6">https://learn.microsoft.com/en-us/community/content/wsl-user-msft-kernel-v6</a></p>
<p>要查找当前文件夹下大小大于 50MB 的文件，可以使用 <code>find</code> 命令。以下是一个查找当前目录及其子目录中所有大于 50MB 文件的命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -<span class="built_in">type</span> f -size +50M</span><br></pre></td></tr></table></figure>
<p>文件拆分</p>
<p>假设你有一个 .deb 文件，例如 package.deb，并且想要将其拆分成多个大小为 50MB 的部分文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">split -b 40M package.deb package_part_</span><br></pre></td></tr></table></figure>
<p>-b 50M：将文件拆分为 50MB 大小的部分（可以根据你的需要调整大小）。</p>
<p>package_part_：拆分后的文件名的前缀。拆分后将会生成类似于 package_part_aa, package_part_ab, package_part_ac 的文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">split -b 40M chromium-x11_91.0.4472.164_arm64.deb chromium-x11_91.0.4472.164_arm64_part_</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if [ ! -f &quot;/packages/arm64/chromium/chromium-x11_91.0.4472.164_arm64.deb&quot; ]; then</span><br><span class="line">    cat &quot;packages/arm64/chromium/chromium-x11_91.0.4472.164_arm64_part_aa&quot; \</span><br><span class="line">        &quot;packages/arm64/chromium/chromium-x11_91.0.4472.164_arm64_part_ab&quot; \</span><br><span class="line">        &gt; &quot;packages/arm64/chromium/chromium-x11_91.0.4472.164_arm64.deb&quot; </span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if [ ! -f &quot;packages/arm64/chromium/chromium-x11_91.0.4472.164_arm64.deb&quot; ]; then</span><br><span class="line">    cat &quot;packages/arm64/chromium/chromium-x11_91.0.4472.164_arm64_part_aa&quot; \</span><br><span class="line">        &quot;packages/arm64/chromium/chromium-x11_91.0.4472.164_arm64_part_ab&quot; \</span><br><span class="line">        &gt; &quot;packages/arm64/chromium/chromium-x11_91.0.4472.164_arm64.deb&quot; </span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>今天不错啊，虽然昨天晚上并没怎样睡好觉，但是确实是把debian的相关的内容搞完了，还重新维护了一下github，ubuntu和debian也都用了最新的，以后就会用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /packages/libmali/mali_csffw.bin /usr/lib/firmware/ </span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install -fy libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev libgstreamer-plugins-bad1.0-dev gstreamer1.0-plugins-base gstreamer1.0-plugins-base-apps gstreamer1.0-plugins-good gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly gstreamer1.0-libav gstreamer1.0-tools gstreamer1.0-x gstreamer1.0-alsa gstreamer1.0-gl gstreamer1.0-gtk3 gstreamer1.0-qt5 gstreamer1.0-pulseaudio</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo XZ_OPT=-T0 tar -cpJvf linaro-buster-xfce-arm64.tar.xz binary/</span><br><span class="line">sudo XZ_OPT=-T0 tar -cpJvf linaro-bullseye-xfce-arm64.tar.xz binary/</span><br><span class="line">sudo XZ_OPT=-T0 tar -cpJvf linaro-bookworm-xfce-arm64.tar.xz binary/</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<h1 id="913工作记录星期五"><a class="markdownIt-Anchor" href="#913工作记录星期五"></a> 9.13工作记录(星期五)</h1>
<p>==摆脱一份幻觉，比发现一个真理更能使人明智==</p>
<p>==当你在凝视深渊的时候，深渊也在凝视你==</p>
<p>==我希望用一生的时间不断深入和学习电子计算机相关的全部知识，将其整理成网络并分享出去，与更多志同道合的朋友共同进步，你清楚的知道，如果做不到这一点，你将永远不快乐。==</p>
<hr />
<p>这次的还算及时，也算是找到了最后可以搞的地方，不容易，如果这些钱花的我心安我认为这是没问题的，早上也说了如果这钱花出去能让我摆脱小说这一个成瘾物，我当然认为很值得，一切都是值得的，难道不是吗，是的，将一个无用的成瘾物转换成另一个有用的，我当然认为这是没问题的，我的打算是拆掉服务器的一根内存，然后搞一台新的电脑，这样我的小主机就可以退役了，小主机拿回家可以然后分着用呗，看情况就行，其他的无所谓，只求心意顺，行了，这些都是节后的事情了，然后来看今天的任务，今天肯定是要搞完全部的镜像的，其实昨天也差不多搞完了，先来打包吧，备份一下之前的系统镜像。</p>
<blockquote>
<p>1.更新3588 3588 邮票孔 3588S三个的镜像</p>
<p>​	这次打包目录用tar的格式，不然太难解压了，发现得不偿失，虽然打包和解压的时间短了，但是呢有太大了，传输也成问题，还是算了，然后是</p>
<p>2.打包3568 的镜像</p>
<p>​	 sudo  TARGET=xfce SOC=rk3568 ./mk-ubuntu-rootfs.sh</p>
</blockquote>
<hr />
<p>行了，今天更新完成了三个镜像，速度确实快了很多，而且把3588  3588 邮票孔以及3588S打通了，现在他们的区别真的就只剩下设备树不一样了，其他完全相同，3568的更新可能会有点费劲，明天看看吧，怎样更方便点，今天最后一个小时了，看一下法师说的4418的核心板电压问题，昨天给了一个补丁，这个补丁不一样的地方驱动肯定是没啥的，有区别的就在device.c里了，先看看到底要看啥，先来看核心板原理图，看看是怎么供电的，以及他们说的都是什么意思？</p>
<p>它的电源管理是AXP228，</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409131752628.png" alt="image-20240913175238294" /></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409131804060.png" alt="image-20240913180404992" /></p>
<p>没啥意思</p>
<h1 id="914工作记录星期六"><a class="markdownIt-Anchor" href="#914工作记录星期六"></a> 9.14工作记录(星期六)</h1>
<p>==摆脱一份幻觉比发现一个真理更能使人明智==</p>
<p>==当你在凝视深渊的时候，深渊也在凝视你==</p>
<p>==我希望用一生的时间不断深入和学习电子计算机相关的全部知识，将其整理成网络并分享出去，与更多志同道合的朋友共同进步，你清楚的知道，如果做不到这一点你将永远不快乐==</p>
<hr />
<p>先来更新镜像，要更新的镜像有两个一个是4.19的，一个是5.10的，我先把5.10的搞定</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -type f -name &quot;*.Identifier&quot; -exec rm -f &#123;&#125; \;</span><br></pre></td></tr></table></figure>
<p>要使用 <code>tree</code> 命令打印二级目录（即只显示当前目录和它的直接子目录），可以使用 <code>-L</code> 选项来限制目录树的深度。对于二级目录树，命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tree -L 3</span><br></pre></td></tr></table></figure>
<p>如果你想解压到原始 <code>4.19</code> 目录下，命令可以改为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo find . -path <span class="string">&quot;*/4.19/*.tar.xz&quot;</span> -execdir tar -xvf &#123;&#125; \;</span><br></pre></td></tr></table></figure>
<p><code>-execdir</code> 会在找到的 <code>.tar.xz</code> 文件所在的目录下解压文件。</p>
<p>为了将 <code>overlay_4_19</code> 目录中的内容复制到当前目录下每个 <code>4.19</code> 目录中的 <code>binary</code> 目录中，并使用 <code>sudo</code> 权限执行，你可以使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo find . -path <span class="string">&quot;*/4.19/binary&quot;</span> -<span class="built_in">exec</span> <span class="built_in">cp</span> -r overlay_4_19/* &#123;&#125; \;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo find . -path &quot;*/4.19/binary&quot; -exec rm  &#123;&#125; \;</span><br></pre></td></tr></table></figure>
<p>将binary打包回去</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo find . -path &quot;*/4.19/binary&quot; -type d -execdir sh -c &#x27;XZ_OPT=&quot;-T0 -1&quot; tar -cpJvf ../new_binary.tar.xz binary &amp;&amp; rm -f ../*.tar.xz &amp;&amp; mv ../new_binary.tar.xz ../$(basename $(pwd)).tar.xz&#x27; \;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找所有的4.19目录</span></span><br><span class="line">find . -path <span class="string">&quot;*/4.19/binary&quot;</span> | <span class="keyword">while</span> <span class="built_in">read</span> binary_dir; <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># 获取binary所在的目录路径</span></span><br><span class="line">    base_dir=$(<span class="built_in">dirname</span> <span class="string">&quot;<span class="variable">$binary_dir</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查找4.19目录下的.tar.xz文件作为参考打包名称</span></span><br><span class="line">    tar_file=$(find <span class="string">&quot;<span class="variable">$base_dir</span>&quot;</span> -maxdepth 1 -name <span class="string">&quot;*.tar.xz&quot;</span> | <span class="built_in">head</span> -n 1)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 提取参考.tar.xz文件的名称部分</span></span><br><span class="line">    <span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$tar_file</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        tar_name=$(<span class="built_in">basename</span> <span class="string">&quot;<span class="variable">$tar_file</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;正在将 <span class="variable">$binary_dir</span> 打包为 <span class="variable">$base_dir</span>/<span class="variable">$tar_name</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 使用XZ_OPT=-T0进行多线程打包</span></span><br><span class="line">        XZ_OPT=-T0 tar -cpJvf <span class="string">&quot;<span class="variable">$base_dir</span>/<span class="variable">$tar_name</span>&quot;</span> -C <span class="string">&quot;<span class="variable">$binary_dir</span>&quot;</span> .</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;打包完成：<span class="variable">$base_dir</span>/<span class="variable">$tar_name</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;未找到参考.tar.xz文件，跳过目录 <span class="variable">$base_dir</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找4.19目录下的所有rootfs.img</span></span><br><span class="line">sudo find . -path <span class="string">&quot;*/4.19/rootfs.img&quot;</span> | <span class="keyword">while</span> <span class="built_in">read</span> img; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;挂载 <span class="variable">$img</span> 到 /mnt&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 挂载rootfs.img到/mnt</span></span><br><span class="line">  sudo mount <span class="string">&quot;<span class="variable">$img</span>&quot;</span> /mnt</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;挂载成功，开始复制overlay_4_19内容到 <span class="variable">$img</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 复制overlay_4_19内容到挂载的目录</span></span><br><span class="line">    sudo <span class="built_in">cp</span> -r overlay_4_19/* /mnt/</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;复制完成，取消挂载 <span class="variable">$img</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 取消挂载</span></span><br><span class="line">    sudo umount /mnt</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$img</span> 已成功取消挂载&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;挂载失败： <span class="variable">$img</span>&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找所有的binary目录，并将deb包拷贝进去</span></span><br><span class="line">sudo find . -path &quot;*/4.19/binary&quot; | while read binary_dir; do</span><br><span class="line">  echo &quot;将 camera_engine_rkaiq_rk3568_arm64.deb 拷贝到 $binary_dir&quot;</span><br><span class="line">  </span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">拷贝deb包到每个binary目录下</span></span><br><span class="line">  sudo cp camera_engine_rkaiq_rk3568_arm64.deb &quot;$binary_dir/&quot;</span><br><span class="line">  </span><br><span class="line">  echo &quot;进入 $binary_dir 使用 chroot 并安装 deb 包&quot;</span><br><span class="line">  </span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">进入<span class="built_in">chroot</span>环境并安装deb包</span></span><br><span class="line">  sudo chroot &quot;$binary_dir&quot; dpkg -i /camera_engine_rkaiq_rk3568_arm64.deb</span><br><span class="line">  </span><br><span class="line">  echo &quot;安装完成&quot;</span><br><span class="line">  sudo rm -rf $binary_dir/*deb</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找4.19目录下的所有rootfs.img</span></span><br><span class="line">sudo find . -path &quot;*/4.19/rootfs.img&quot; | while read img; do</span><br><span class="line">  echo &quot;挂载 $img 到 /mnt&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">挂载rootfs.img到/mnt</span></span><br><span class="line">  sudo mount -o loop &quot;$img&quot; /mnt</span><br><span class="line"></span><br><span class="line">  if [ $? -eq 0 ]; then</span><br><span class="line">    echo &quot;挂载成功，将 camera_engine_rkaiq_rk3568_arm64.deb 拷贝到 /mnt&quot;</span><br><span class="line"></span><br><span class="line">    # 将deb包拷贝到/mnt</span><br><span class="line">    sudo cp camera_engine_rkaiq_rk3568_arm64.deb /mnt/</span><br><span class="line"></span><br><span class="line">    echo &quot;进入chroot环境并安装deb包&quot;</span><br><span class="line">    </span><br><span class="line">    # 进入chroot环境并安装deb包</span><br><span class="line">    sudo chroot /mnt dpkg -i /camera_engine_rkaiq_rk3568_arm64.deb</span><br><span class="line"></span><br><span class="line">    echo &quot;安装完成，删除 /mnt 中的 deb 包&quot;</span><br><span class="line">    </span><br><span class="line">    # 删除拷贝进去的 deb 包</span><br><span class="line">    sudo rm /mnt/camera_engine_rkaiq_rk3568_arm64.deb</span><br><span class="line">    </span><br><span class="line">    echo &quot;取消挂载 $img&quot;</span><br><span class="line">    </span><br><span class="line">    # 取消挂载</span><br><span class="line">    sudo umount /mnt</span><br><span class="line">    </span><br><span class="line">    echo &quot;$img 已取消挂载&quot;</span><br><span class="line">  else</span><br><span class="line">    echo &quot;挂载失败: $img&quot;</span><br><span class="line">  fi</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install gstreamer1.0-plugins-bad gstreamer1.0-plugins-base gstreamer1.0-tools gstreamer1.0-alsa  gstreamer1.0-plugins-base-apps qtmultimedia5-examples gstreamer1.0-plugins-good gstreamer1.0-libav           gstreamer1.0-plugins-ugly</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rk3568_linux_5.10_20240822.tar.xz   rk356x_linux_20240911.tar.xz</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp ~/rk3568/rk3568/debian10/4.19/debian-buster-xfce-arm64.tar.xz linaro-bullseye-arm64.tar.xz</span><br><span class="line">cp ~/rk3568/rk3568/debian11/4.19/linaro-bullseye-xfce-arm64.tar.xz linaro-bullseye-arm64.tar.xz       </span><br><span class="line">cp ~/rk3568/rk3568/ubuntu20/4.19/ubuntu-focal-xfce-arm64.tar.xz ubuntu-focal-arm64.tar.xz</span><br><span class="line">cp ~/rk3568/rk3568/ubuntu22/4.19/ubuntu-jammy-xfce-arm64.tar.xz ubuntu-jammy-arm64.tar.xz</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp ~/rk3568/rk3568/debian10/5.10/debian-buster-xfce-arm64.tar.xz linaro-bullseye-arm64.tar.xz</span><br><span class="line">cp ~/rk3568/rk3568/debian11/5.10/linaro-bullseye-xfce-arm64.tar.xz linaro-bullseye-arm64.tar.xz       </span><br><span class="line">cp ~/rk3568/rk3568/ubuntu20/5.10/ubuntu-focal-xfce-arm64.tar.xz ubuntu-focal-arm64.tar.xz</span><br><span class="line">cp ~/rk3568/rk3568/ubuntu22/5.10/ubuntu-jammy-xfce-arm64.tar.xz ubuntu-jammy-arm64.tar.xz</span><br></pre></td></tr></table></figure>
<hr />
<p>2024年9月14日<br />
更新ubuntu debian系统源码<br />
更新rkbin</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cp ~/rk3568/rk3568/debian10/5.10/rootfs.img ./02_Debian10镜像/rootfs.img</span><br><span class="line">cp ~/rk3568/rk3568/debian11/5.10/rootfs.img ./03_Debian11镜像/rootfs.img</span><br><span class="line">cp ~/rk3568/rk3568/ubuntu20/5.10/rootfs.img ./04_Ubuntu20镜像/rootfs.img</span><br><span class="line">cp ~/rk3568/rk3568/ubuntu22/5.10/rootfs.img ./05_Ubuntu22镜像/rootfs.img</span><br><span class="line"></span><br><span class="line">XZ_OPT=&quot;-T0 -1&quot; tar -cpJvf 03_update_rk3568_mini_20240914.tar.xz 03_update_rk3568_mini &amp;</span><br><span class="line">XZ_OPT=&quot;-T0 -1&quot; tar -cpJvf 04_update_rk3568_mini_5.10_20240914.tar.xz 04_update_rk3568_mini_5.10</span><br><span class="line"></span><br><span class="line">XZ_OPT=&quot;-T0 -1&quot; tar -cpJvf rk356x_linux_mini_20240914.tar.xz rk356x_linux</span><br><span class="line">XZ_OPT=&quot;-T0 -1&quot; tar -cpJvf rk3568_linux_5.10_mini_20240914.tar.xz rk3568_linux_5.10</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-06_工作记录/29_工作记录(九月第三个星期)"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/09/08/06_%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/29_%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95(%E4%B9%9D%E6%9C%88%E7%AC%AC%E4%B8%89%E4%B8%AA%E6%98%9F%E6%9C%9F)/"
    >工作记录(九月第二个星期)</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/09/08/06_%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/29_%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95(%E4%B9%9D%E6%9C%88%E7%AC%AC%E4%B8%89%E4%B8%AA%E6%98%9F%E6%9C%9F)/" class="article-date">
  <time datetime="2024-09-08T13:26:56.000Z" itemprop="datePublished">2024-09-08</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/">工作记录</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="918-工作记录星期三"><a class="markdownIt-Anchor" href="#918-工作记录星期三"></a> 9.18 工作记录(星期三)</h1>
<p>==摆脱一份幻觉比发现一个真理更能使人明智==</p>
<p>==当你在凝视深渊的时候，深渊也在凝视你==</p>
<p>==我希望用一生的时间不断深入和学习电子计算机相关的全部知识将其整理成网络并分享出去，与更多志同道合的朋友共同进步，你清楚的知道，如果做不到这一点，你将永远不快乐==</p>
<hr />
<p>一切都该结束了，关于电脑性能的提升到这里也该结束了，不能说失去了什么，只能说我有一次更清楚的认识到了自己，这大约一个星期的时间，确实认识到了很多很多的东西，其他也就看个热闹罢了，现在也算是升无可升，要想再去提高也就只有下一代了，其他都是微乎其微罢了，像上面说的那样到此为止了，对这一个星期的行为进行一下总结：</p>
<blockquote>
<p>1.更换13900k es2 ，用一个相对较低的价钱获得更高的性能</p>
<p>2.更换水冷，因为散热原因，水冷是必须的</p>
<p>3.CPU跑分上去了，但是最终的编译速度还是达不到的我的预期，然后我就更换了主板，更换为了DDR5的主板</p>
<p>4.主板更换之后，发现仍旧与我预想的有些差距，就继续找问题，发现内存的频率和时许都会对性能产生很大的影响，所以又研究了一天的内容超频，最终将2X32的 5200内存超到了6000M，时许缩到了C32，这是一个很不错的成绩了。</p>
<p>5.做了上面一系列操作之后，发现还是有问题，经过和家里电脑极其详细的对比之后，发现是系统的问题，公司电脑并没有打开性能模式，不能让CPU长时间的保持高频率，这属于系统调度问题，这个问题就导致我编译buildroot、recovery会很慢，CPU会降低到一般水平，所以就默认让他打开了极致模式，到这里问题就基本解决了。</p>
<p>6.最重要的一点是，昨天发现了tar 命令解压的一个命令可以调用pixz来多核心解压，这个解压命令确实是我的福星，之前三四分钟的一个任务，现在能缩减到十秒，三十四倍时间的缩短。</p>
<p>7.除了上面的一系列操作之外，我还将我全部的固态整合到了一起，组建了raid0，raid0让读写性能进行了叠加，非常适合现在这种情况，也并不害怕有数据损失，不错</p>
<p>==这就是我这七天内容的总结，还行，以后的效率大约是能提升三倍，花的这三千多还是很值得的，行了，然后研究后续的任务==</p>
</blockquote>
<hr />
<p>后续的任务分为两个方向，一个是在公司的任务，一个是在家的任务，在家的任务肯定是继续的去维护我的repo，现在的话是只能RK3588可以用的uboot和内核，当然文件系统现在确实是可以了，虽然还没测试过RK3562，不过也都差不多，先把大体的基调定一下，我认为是可以直接搬迁过来的，直接将备份里之前搞好的放过来就好了，亦或者我来搞不同的分支，就像现在Ubuntu、debian这个样子。这个不急，先跑通，这才是一切的前提，然后终于迎来正事了，也就是在工作中真正要做的事情。</p>
<p>虽然我确实是想做我更喜欢的事情，但你也知道那是不可能的，现在录课是当前的主旋律，而且也确实应该有些不一样的经历，每次经历都是一场提升，我的第一想法是又要浪费我的时间了，但实际上不是的，法师给你机会，让你去录课，给你时间让你去学习，本身也就是一种信任，对吗，在这个过程中，我能学到很多之前遇到过，但是躲避开来的问题，其实吧，很多问题，经历之前感觉很难，经历之后又感觉这也没啥，所以就这样定了，沉下心来，开始另一段旅程。</p>
<p>先来分析一下我认为有问题的地方，法师最严重的问题是不打草稿，在我看来这当然是不对的，自己都不知道要讲什么，然后直接就开始，这对吗，我认为不对，但也是有可取之处的</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-07_小技巧/17_电脑超频"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/09/07/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/17_%E7%94%B5%E8%84%91%E8%B6%85%E9%A2%91/"
    >电脑超频</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/09/07/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/17_%E7%94%B5%E8%84%91%E8%B6%85%E9%A2%91/" class="article-date">
  <time datetime="2024-09-06T22:50:19.000Z" itemprop="datePublished">2024-09-07</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>==这两天因为电脑的问题，都不好好的工作了，所以一直在维持一个很低很低的效率，在昨天晚上发现了es版本的处理器，也正好适应了我当前的状态，能做到目前的最好了，后来又因为水冷的问题，又迟疑了一会儿，就业还行吧，大约是大后天到，就还行吧，找一天晚上进行装机，行了，研究研究如何超频，不能白买啊，之前因为麻烦，并没有咋超频过，现在不超都对不起我。==</p>
<p>最重要的一个工具：图吧工具箱下载地址</p>
<p><a target="_blank" rel="noopener" href="https://www.tbtool.cn/download/202408.html">https://www.tbtool.cn/download/202408.html</a></p>
<h1 id="z790吹雪更新bios"><a class="markdownIt-Anchor" href="#z790吹雪更新bios"></a> Z790吹雪更新bios</h1>
<p>​	首先进入ROG官网，找到当前的主板型号，我家里的电脑是Z790吹雪</p>
<p><a target="_blank" rel="noopener" href="https://rog.asus.com.cn/search/explore/?searchkeyword=%E5%90%B9%E9%9B%AA">https://rog.asus.com.cn/search/explore/?searchkeyword=吹雪</a></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409071614124.png" alt="image-20240907161421102" /></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409071614968.png" alt="image-20240907161445925" /></p>
<p>找到bios</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409071615180.png" alt="image-20240907161527114" /></p>
<ol>
<li>新的 BIOS 包含了 Intel 微代码 0x129，以增强 Intel 第 13 代和第 14 代处理器的稳定性。</li>
<li>出厂默认设置已更改为 Intel 默认设置，且现在包含了非 K 系列处理器（K 系列处理器已经在之前的版本中包括）。</li>
</ol>
<p>更新此 BIOS 的同时会将相应的 Intel ME 更新至版本 16.1.30.2307。 请注意，更新 BIOS 后，即使回滚至旧版本，ME 版本仍将保持为已更新的版本。 在运行 USB BIOS 回写工具之前，请将 BIOS 文件（SZ790A.CAP）重命名为 BIOSRenamer。</p>
<p>​	解决了最近爆的CPU缩肛的问题，然后将这个bios放到U盘上：<br />
<img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409071623641.png" alt="image-20240907162322606" /></p>
<p>然后进入bios，点击工具，选择升级bios。升级即可，我发现也不用给要用U盘。</p>
<h1 id="超频原理"><a class="markdownIt-Anchor" href="#超频原理"></a> 超频原理</h1>
<p>​	<strong>电脑超频</strong>（Overclocking）是指通过手动调整电脑硬件的运行参数，使其在高于默认设定的频率下工作，以提高性能的过程。通常，超频主要涉及 <strong>CPU</strong>（中央处理器）、<strong>GPU</strong>（图形处理器）、<strong>RAM</strong>（内存）等硬件组件。</p>
<h3 id="超频的原理"><a class="markdownIt-Anchor" href="#超频的原理"></a> 超频的原理：</h3>
<p>电脑硬件在出厂时会设置一个默认的运行频率（即主频或时钟频率），这个频率由厂商根据硬件的稳定性、发热量和功耗等因素来设定。超频通过手动提高硬件的运行频率，使其执行更多的指令，从而提升计算性能。</p>
<p>例如，某个处理器的默认主频是 3.5GHz，通过超频，你可以将其频率提升到 4.0GHz 或更高，以此增加计算速度。</p>
<h3 id="主要超频的硬件"><a class="markdownIt-Anchor" href="#主要超频的硬件"></a> 主要超频的硬件：</h3>
<ol>
<li>
<p><strong>CPU 超频</strong>：</p>
<ul>
<li><strong>CPU 主频</strong>：调整 CPU 的工作频率，即通过更高的时钟频率来提高其处理速度。</li>
<li><strong>CPU 电压</strong>：为了支持更高的频率，通常还需要增加 CPU 的工作电压。这可以增强稳定性，但会增加功耗和发热量。</li>
<li><strong>倍频和外频</strong>：现代 CPU 主要通过调整倍频（Multiplier）进行超频，外频（Base Clock）超频相对较少。</li>
</ul>
</li>
<li>
<p><strong>GPU 超频</strong>：</p>
<ul>
<li><strong>核心频率</strong>：提高显卡 GPU 核心的工作频率来提升图形处理能力。</li>
<li><strong>显存频率</strong>：提升显存的频率可以增加显卡对数据的读取和写入速度，从而提高整体性能。</li>
</ul>
</li>
<li>
<p><strong>内存（RAM）超频</strong>：</p>
<ul>
<li><strong>内存频率</strong>：提高内存的工作频率可以加快数据的访问速度，提高系统响应能力。</li>
<li><strong>内存时序</strong>：内存时序决定了数据传输的延迟，通过优化时序可以提高内存效率。</li>
</ul>
</li>
</ol>
<h3 id="超频的好处"><a class="markdownIt-Anchor" href="#超频的好处"></a> 超频的好处：</h3>
<ol>
<li><strong>提高性能</strong>：通过提高硬件的工作频率，可以显著提高系统的整体性能，尤其是在处理大型数据或运行复杂计算时，性能提升更为明显。</li>
<li><strong>延长硬件使用周期</strong>：在硬件性能不满足需求时，通过超频可以延长硬件的使用寿命，延迟升级硬件的需求。</li>
<li><strong>更好地发挥硬件潜力</strong>：部分高端硬件出厂时已经有很强的超频潜力，但厂商为了保持稳定性没有使用最大化频率，通过超频可以释放硬件的全部潜力。</li>
</ol>
<h3 id="超频的风险"><a class="markdownIt-Anchor" href="#超频的风险"></a> 超频的风险：</h3>
<ol>
<li><strong>稳定性问题</strong>：超频可能导致系统不稳定，出现蓝屏、死机、程序崩溃等问题。尤其是当电压和频率调整过高时，硬件可能无法稳定工作。</li>
<li><strong>温度上升</strong>：超频会增加硬件的功耗，从而导致硬件温度上升。如果散热不足，可能会引发过热、性能下降，甚至硬件损坏。</li>
<li><strong>缩短硬件寿命</strong>：高电压和高频率运行可能会缩短硬件的寿命，因为硬件会长期处于更高的压力环境中。</li>
<li><strong>保修问题</strong>：很多厂商对超频后的硬件不提供保修支持，因此超频可能导致硬件失去保修。</li>
</ol>
<h1 id="如何超频"><a class="markdownIt-Anchor" href="#如何超频"></a> 如何超频</h1>
<p>超频是提高电脑硬件性能的一种方式，通过调整 CPU、GPU、内存等硬件的工作频率，使它们在高于出厂设置的速度下运行。虽然超频可以带来性能提升，但需要谨慎进行，以避免过热、系统不稳定或损坏硬件。</p>
<p>下面是常见硬件的超频方法，尤其是针对 CPU、GPU 和内存的具体步骤。</p>
<h3 id="准备工作"><a class="markdownIt-Anchor" href="#准备工作"></a> 准备工作：</h3>
<ol>
<li><strong>检查硬件的超频能力</strong>：确保你的 CPU、主板、GPU 支持超频。Intel 的 K 系列处理器（如 i7-9700K）和 AMD 的 Ryzen 系列处理器支持超频。部分高端显卡和内存也支持超频。</li>
<li><strong>升级散热系统</strong>：超频会增加硬件的发热量，确保你的电脑有足够的散热能力。推荐使用优质的风冷或水冷散热系统。</li>
<li><strong>备份数据</strong>：超频可能会导致系统不稳定甚至崩溃，因此在超频前建议备份重要数据。</li>
<li><strong>安装硬件监控工具</strong>：使用软件如 <strong>CPU-Z</strong>、<strong>HWMonitor</strong>、<strong>MSI Afterburner</strong> 来监控 CPU 和 GPU 的温度、频率和电压。</li>
</ol>
<h4 id="bios-超频主板设置"><a class="markdownIt-Anchor" href="#bios-超频主板设置"></a> BIOS 超频（主板设置）</h4>
<p>通过 BIOS 进行 CPU 超频是最常见的方式，大多数主板都支持该功能。</p>
<p><strong>步骤：</strong></p>
<ol>
<li><strong>进入 BIOS</strong>：
<ul>
<li>重启电脑，在启动时按下 <code>DEL</code>、<code>F2</code>、<code>ESC</code> 或其他键（具体按键取决于主板），进入 BIOS 设置界面。</li>
</ul>
</li>
<li><strong>进入超频设置（OC 设置）</strong>：
<ul>
<li>在 BIOS 中找到 “Overclocking” 或 “OC Settings” 菜单。</li>
</ul>
</li>
<li><strong>调整 CPU 倍频（Multiplier）</strong>：
<ul>
<li>CPU 的工作频率是由外频（Base Clock, BCLK）和倍频（Multiplier）相乘得出的。为了超频，你可以先增加 CPU 的倍频，通常可以逐步增加 1 或 2 来提高频率。</li>
<li>例如，如果外频是 100 MHz，倍频为 40，那么 CPU 的频率就是 4.0GHz。你可以把倍频从 40 增加到 42，得到 4.2GHz。</li>
</ul>
</li>
<li><strong>调整 CPU 电压（Vcore）</strong>：
<ul>
<li>为了让 CPU 在更高频率下稳定运行，你可能需要适当提高 CPU 的核心电压（Vcore）。注意，电压过高会增加温度，影响硬件寿命。建议小幅增加电压（如增加 0.01V 到 0.05V）。</li>
<li>在 BIOS 中，找到 CPU 电压设置，将其设置为手动模式，然后逐步增加。</li>
</ul>
</li>
<li><strong>保存设置并退出 BIOS</strong>：
<ul>
<li>完成超频设置后，保存并退出 BIOS。重启电脑，并进入操作系统。</li>
</ul>
</li>
<li><strong>压力测试和温度监控</strong>：
<ul>
<li>使用软件如 <strong>Prime95</strong> 或 <strong>AIDA64</strong> 进行压力测试，监控 CPU 温度。如果系统在负载下稳定且温度正常（建议温度不超过 85°C），可以继续微调倍频和电压。否则，降低倍频或电压。</li>
</ul>
</li>
</ol>
<h4 id="自动超频"><a class="markdownIt-Anchor" href="#自动超频"></a> 自动超频</h4>
<p>部分主板（如 ASUS、MSI）提供了一键超频功能（如 “AI Overclocking” 或 “Game Boost”），可以自动根据硬件情况调整超频设置。虽然方便，但手动调整通常能更精确地控制性能和稳定性。</p>
<h1 id="实际操作"><a class="markdownIt-Anchor" href="#实际操作"></a> 实际操作</h1>
<p>​	进入BIOS，如下图所示：<br />
<img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409071653683.png" alt="image-20240907165350427" /></p>
<p>​		找到CPU倍频选项，修改即可，这里有个AVX需要解释一下</p>
<p>​	在超频中，<strong>AVX</strong> 是指 <strong>Advanced Vector Extensions</strong>（高级矢量扩展），这是由 Intel 和 AMD 处理器所支持的一种 <strong>CPU 指令集扩展</strong>。AVX 能够加速处理某些类型的计算密集型任务，特别是在 <strong>浮点运算</strong> 和 <strong>矢量运算</strong> 方面，因此在科学计算、3D 渲染、加密解密、音视频处理等领域表现突出。</p>
<h2 id="avx"><a class="markdownIt-Anchor" href="#avx"></a> AVX</h2>
<h3 id="什么是-avx"><a class="markdownIt-Anchor" href="#什么是-avx"></a> 什么是 AVX？</h3>
<p>AVX 是一个 <strong>SIMD</strong>（单指令多数据）指令集扩展，它允许 CPU 在一个时钟周期内对多个数据进行并行处理。它特别适合于需要大量浮点计算的应用程序，比如图形处理、科学模拟、机器学习等。与常规的指令集相比，AVX 能够处理更大的数据宽度和更多的数据包。</p>
<h3 id="avx-在超频中的影响"><a class="markdownIt-Anchor" href="#avx-在超频中的影响"></a> AVX 在超频中的影响</h3>
<p>在超频过程中，AVX 指令集对于 CPU 的影响比较大，尤其是在 <strong>高负载的计算任务</strong> 中。因为 AVX 指令集能够让 CPU 执行大量的计算，因此它会增加 CPU 的功耗和发热。具体来说，当 CPU 运行 AVX 指令时，它的负载会比执行非 AVX 指令更高，进而导致更高的温度和功耗。</p>
<p>为了应对这种情况，许多主板在 BIOS 中提供了 <strong>AVX 偏移（AVX offset）</strong> 的选项。这是因为当 CPU 运行 AVX 指令时，其高负载状态可能会导致系统的不稳定，而为了保持系统稳定性，主板允许用户设置在运行 AVX 指令时降低 CPU 频率。</p>
<h3 id="avx-偏移avx-offset"><a class="markdownIt-Anchor" href="#avx-偏移avx-offset"></a> <strong>AVX 偏移（AVX Offset）</strong></h3>
<p>AVX 偏移是 CPU 的一个调节机制，允许用户在运行 AVX 指令时自动降低 CPU 的频率。这个频率降低通常以倍频（Multiplier）为单位调整。例如：</p>
<ul>
<li>如果你的 CPU 运行在 5.0GHz，但你设置了 <code>AVX Offset = 2</code>，那么当 CPU 运行 AVX 指令时，频率会降低 2 倍频，即降到 4.8GHz。</li>
</ul>
<p>这可以帮助 CPU 在处理 AVX 指令时避免过热和不稳定的情况，同时也允许你在非 AVX 工作负载下保持较高的超频频率。</p>
<h3 id="超频时如何处理-avx-负载"><a class="markdownIt-Anchor" href="#超频时如何处理-avx-负载"></a> 超频时如何处理 AVX 负载</h3>
<ol>
<li>
<p><strong>使用 AVX 偏移</strong>：<br />
在 BIOS 中设置 AVX 偏移，可以根据你的需求和系统的散热能力决定降多少倍频。通常，AVX 偏移可以设置为 1 或 2，这样当 AVX 指令执行时，CPU 的频率会自动降低，确保系统稳定。</p>
</li>
<li>
<p><strong>降低全局频率</strong>：<br />
如果你没有使用 AVX 偏移，而是想让 CPU 以同样的频率处理所有任务，你可以直接降低超频后的全局频率，但这会影响所有的任务，而不仅仅是 AVX 负载。</p>
</li>
<li>
<p><strong>测试不同的负载</strong>：<br />
在超频过程中，测试 CPU 在不同类型的负载下的稳定性是至关重要的。AVX 指令集的负载比常规负载更高，因此使用支持 AVX 的压力测试软件（如 <strong>Prime95</strong>）可以帮助你检测 CPU 在执行 AVX 指令时的稳定性。</p>
</li>
</ol>
<h3 id="avx-的应用领域"><a class="markdownIt-Anchor" href="#avx-的应用领域"></a> AVX 的应用领域</h3>
<ol>
<li>
<p><strong>科学计算</strong>：科学研究中的复杂计算，比如模拟、建模、机器学习等，需要大量的浮点运算，因此 AVX 能够显著提高计算效率。</p>
</li>
<li>
<p><strong>图形渲染与视频处理</strong>：AVX 能够加速图形和视频渲染任务，特别是在多媒体文件的编码、解码和转换时，AVX 能够显著提高性能。</p>
</li>
<li>
<p><strong>加密和解密</strong>：AVX 能够加速一些加密算法，使得 CPU 在处理安全性相关任务时更加高效。</p>
</li>
</ol>
<h3 id="超频与-avx-的兼容性"><a class="markdownIt-Anchor" href="#超频与-avx-的兼容性"></a> 超频与 AVX 的兼容性</h3>
<p>对于经常执行 AVX 工作负载的用户（如从事视频编辑、3D 渲染或科学计算的人），在超频时需要特别考虑 AVX 的影响。超频后的 CPU 频率和电压必须能够稳定处理 AVX 负载，否则系统可能会变得不稳定甚至崩溃。合理设置 AVX 偏移和超频参数能够帮助用户在性能和稳定性之间取得平衡。</p>
<h2 id="电压"><a class="markdownIt-Anchor" href="#电压"></a> 电压</h2>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409071659354.png" alt="image-20240907165908290" /></p>
<p>​	由于一系列原因，CPU会自动掉压，所以需要手动进行防掉压，</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409071701080.png" alt="image-20240907170109036" /></p>
<p>​	这里的负载线矫正就是防掉压</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409071701818.png" alt="image-20240907170124776" /></p>
<p>​	要找到一个平衡，不能太高也不能太低。等级4就行</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409071704164.png" alt="image-20240907170402015" /></p>
<p>​	缓存频率，也要设置，也有很大的影响：<br />
<img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409071705457.png" alt="image-20240907170538405" /></p>
<h2 id="xpu超频"><a class="markdownIt-Anchor" href="#xpu超频"></a> XPU超频</h2>
<p><strong>Intel Extreme Tuning Utility (XTU)</strong> 是由 Intel 提供的一款超频和性能监控软件，专为支持超频的 Intel 处理器设计。它可以帮助用户在 Windows 环境下安全地调整 CPU 和内存的设置，监控温度、电压等关键参数，同时进行压力测试，确保系统稳定性。XTU 提供了一个直观的界面，适合初学者和有经验的用户使用。</p>
<h3 id="xtu-的主要功能"><a class="markdownIt-Anchor" href="#xtu-的主要功能"></a> XTU 的主要功能：</h3>
<ol>
<li><strong>CPU 超频</strong>：允许调整 CPU 的倍频、外频（BCLK）、电压等参数。</li>
<li><strong>内存超频</strong>：支持内存频率、时序调整。</li>
<li><strong>温度监控</strong>：实时显示 CPU 温度、功耗、频率等关键信息。</li>
<li><strong>电压调整</strong>：允许手动调整 CPU 核心电压（Vcore）以提高稳定性。</li>
<li><strong>压力测试</strong>：集成了压力测试功能，帮助用户检测超频后的系统稳定性。</li>
</ol>
<h3 id="如何使用-intel-xtu-进行超频"><a class="markdownIt-Anchor" href="#如何使用-intel-xtu-进行超频"></a> 如何使用 Intel XTU 进行超频</h3>
<h4 id="1-下载并安装-intel-xtu"><a class="markdownIt-Anchor" href="#1-下载并安装-intel-xtu"></a> 1. <strong>下载并安装 Intel XTU</strong></h4>
<ul>
<li>前往 Intel 官方网站 <a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/download/17881/intel-extreme-tuning-utility-intel-xtu.html">Intel XTU 下载页面</a>。</li>
<li>下载并安装最新版本的 Intel XTU，按照安装向导的指示进行操作。</li>
</ul>
<h4 id="2-启动-intel-xtu"><a class="markdownIt-Anchor" href="#2-启动-intel-xtu"></a> 2. <strong>启动 Intel XTU</strong></h4>
<ul>
<li>安装完成后，启动 Intel XTU。程序会显示当前 CPU 的信息，包括处理器型号、频率、温度、电压等。</li>
</ul>
<h4 id="3-调整-cpu-设置"><a class="markdownIt-Anchor" href="#3-调整-cpu-设置"></a> 3. <strong>调整 CPU 设置</strong></h4>
<p>XTU 提供了多种 CPU 调节选项，用户可以根据需求手动调整。</p>
<h5 id="1倍频multiplier调整"><a class="markdownIt-Anchor" href="#1倍频multiplier调整"></a> （1）<strong>倍频（Multiplier）调整</strong></h5>
<ul>
<li><strong>CPU 核心倍频</strong>：调整 CPU 的倍频值以提升 CPU 频率。例如，如果当前外频为 100 MHz，倍频为 40，则 CPU 运行频率为 4.0 GHz。通过增加倍频，CPU 频率会提升，达到更高的性能。</li>
<li>在 XTU 的 “Core” 页面中，找到 <strong>“Core Multipliers”</strong> 选项，手动增加倍频。例如，尝试将倍频从 40 增加到 42（提高到 4.2GHz）。</li>
</ul>
<h5 id="2电压voltage调整"><a class="markdownIt-Anchor" href="#2电压voltage调整"></a> （2）<strong>电压（Voltage）调整</strong></h5>
<ul>
<li><strong>CPU 核心电压（Vcore）</strong>：增加 CPU 频率后，如果系统不稳定，可以适当提高 CPU 电压以确保稳定性。通常建议逐步增加电压，每次增加 0.01V 到 0.05V，并监控温度。</li>
<li>在 XTU 的 “Core Voltage” 部分，找到 <strong>“Core Voltage Offset”</strong>，这里可以增加电压。建议从小幅度开始调整。</li>
</ul>
<h5 id="3bclk-调整"><a class="markdownIt-Anchor" href="#3bclk-调整"></a> （3）<strong>BCLK 调整</strong></h5>
<ul>
<li><strong>Base Clock (BCLK)</strong>：外频可以影响整个系统的频率（包括 CPU 和内存），调高 BCLK 会增加整体频率，但风险较高，一般用户可以仅调整倍频。</li>
</ul>
<h4 id="4-内存超频"><a class="markdownIt-Anchor" href="#4-内存超频"></a> 4. <strong>内存超频</strong></h4>
<p>XTU 还支持调整内存的频率和时序，特别适用于那些希望通过内存超频来获得更高性能的用户。</p>
<ul>
<li>在 XTU 的 <strong>“Memory”</strong> 选项卡中，你可以调整内存的时钟频率和延迟（时序）。使用 XMP 配置文件可以让你轻松选择经过验证的超频设置。</li>
</ul>
<h4 id="5-监控温度和系统信息"><a class="markdownIt-Anchor" href="#5-监控温度和系统信息"></a> 5. <strong>监控温度和系统信息</strong></h4>
<ul>
<li>在 XTU 的主界面中，用户可以实时监控 CPU 的温度、功耗、频率和电压等重要参数。超频后应密切关注温度，确保温度保持在安全范围内，通常不应超过 85°C。</li>
<li>XTU 会提供 CPU 包温度（Package Temperature）和每个核心的温度。</li>
</ul>
<h4 id="6-压力测试stress-test"><a class="markdownIt-Anchor" href="#6-压力测试stress-test"></a> 6. <strong>压力测试（Stress Test）</strong></h4>
<p>超频后必须进行压力测试，以验证系统是否稳定。</p>
<ul>
<li>XTU 提供了集成的 <strong>压力测试功能</strong>，可以选择不同的测试时长（如 5 分钟、30 分钟或自定义时长）。该功能会在满负载下运行 CPU 和内存，帮助检测系统的稳定性。</li>
<li>在 XTU 中，点击 <strong>“Stress Test”</strong> 选项卡，然后选择要测试的组件（如 CPU 或内存），点击 <strong>“Start Testing”</strong> 开始测试。</li>
<li>如果测试过程中没有出现崩溃或温度过高，说明系统超频稳定。</li>
</ul>
<h4 id="7-保存和导入配置"><a class="markdownIt-Anchor" href="#7-保存和导入配置"></a> 7. <strong>保存和导入配置</strong></h4>
<p>XTU 允许用户保存超频配置文件，也可以导入其他用户或自己之前保存的配置文件。</p>
<ul>
<li>在 <strong>“Profiles”</strong> 页面中，你可以创建并保存当前的超频设置，方便以后快速应用。</li>
</ul>
<h3 id="xtu-的注意事项"><a class="markdownIt-Anchor" href="#xtu-的注意事项"></a> XTU 的注意事项：</h3>
<ol>
<li><strong>逐步调整频率和电压</strong>：超频时不要一次性调整太多参数。建议逐步增加频率，并监控温度和稳定性，确保系统不会过热或崩溃。</li>
<li><strong>监控温度</strong>：超频会增加 CPU 的功耗和发热，确保有足够的散热能力（如高效风冷或水冷系统）。一般来说，CPU 温度不应超过 85°C。</li>
<li><strong>电压增加要谨慎</strong>：提高电压有助于稳定性，但也会增加功耗和发热，过高的电压可能导致硬件损坏，建议尽量在安全电压范围内进行超频。</li>
<li><strong>备份数据</strong>：超频可能导致系统不稳定，因此在开始超频前，建议备份重要数据，以防系统崩溃导致数据丢失。</li>
</ol>
<h3 id="xtu-的优势"><a class="markdownIt-Anchor" href="#xtu-的优势"></a> XTU 的优势：</h3>
<ul>
<li><strong>直观界面</strong>：XTU 提供了简单、直观的用户界面，让初学者和有经验的用户都能轻松超频。</li>
<li><strong>集成压力测试</strong>：无需使用第三方工具，XTU 自带的压力测试功能能够快速检测系统超频后的稳定性。</li>
<li><strong>实时监控</strong>：实时的温度、电压、频率监控让用户可以随时调整设置，确保系统稳定。</li>
</ul>
<h3 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结：</h3>
<p><strong>Intel XTU</strong> 是一款功能强大的超频工具，允许用户在 Windows 环境下安全、方便地调整 CPU 和内存的频率和电压设置。通过合适的超频设置和测试，用户可以显著提升系统性能，但超频需要谨慎操作，尤其是对于电压和温度的控制。XTU 提供了丰富的工具来帮助用户在超频过程中监控和管理硬件状态，是一款非常适合 Intel 处理器用户的工具。</p>
<h1 id="测试"><a class="markdownIt-Anchor" href="#测试"></a> 测试</h1>
<h2 id="r23测试"><a class="markdownIt-Anchor" href="#r23测试"></a> R23测试</h2>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409071727862.png" alt="image-20240907172739809" /></p>
<p>​	我的360水冷其实就还行，现在还能接受，但是CPU频率确实不高，具体如下所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409071730080.png" alt="image-20240907173008013" /></p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409071732825.png" alt="image-20240907173207804" /></p>
<p>​	我发现只能达到大核心4.8，小核心3.7的水平，这可太低了，然后简单的修改一下BIOS内容</p>
<h2 id="cpuz得分"><a class="markdownIt-Anchor" href="#cpuz得分"></a> CPUZ得分</h2>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409071732654.png" alt="image-20240907173242614" /></p>
<p>sp体制分</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409071647921.png" alt="image-20240907164700797" /></p>
<p>​	分数越高，代表越好超频。</p>
<p>​	散热，散热越好，可超的频率越高</p>
<h2 id="最终结果"><a class="markdownIt-Anchor" href="#最终结果"></a> 最终结果</h2>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409080001666.png" alt="image-20240908000108507" /></p>
<p>​	十分钟烤鸡测试完成:<br />
<img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409080001214.png" alt="image-20240908000126162" /></p>
<p>​	R23跑分三万八，就还行吧,明天早上总结一下，上班搞我的电脑去。</p>
<h1 id="内存得分"><a class="markdownIt-Anchor" href="#内存得分"></a> 内存得分</h1>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409122339841.png" alt="image-20240912233928804" /></p>
<h1 id="windows性能模式设置"><a class="markdownIt-Anchor" href="#windows性能模式设置"></a> windows性能模式设置</h1>
<blockquote>
<p>C:\Windows\System32\powercfg.exe /list</p>
<p>C:\Windows\System32\powercfg.exe /setactive ff7b48b4-72b2-4437-9d66-ffe6246299a1</p>
<p>C:\Windows\System32\powercfg.exe /setactive 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c</p>
</blockquote>
<p><code>powercfg.exe</code> 是 Windows 中一个非常强大的命令行工具，用来管理和配置电源计划及电源相关的设置。通过它，你可以查看、修改、创建、删除和导入导出电源计划，诊断电源问题，以及管理睡眠、休眠等电源设置。</p>
<p>以下是详细介绍 <code>powercfg.exe</code> 命令及其常见选项的使用方法。</p>
<h3 id="常用选项"><a class="markdownIt-Anchor" href="#常用选项"></a> 常用选项</h3>
<ol>
<li>
<p><strong><code>/list</code></strong>：列出系统中所有的电源计划及其 GUID。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercfg /list</span><br></pre></td></tr></table></figure>
<p>输出示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Power Scheme GUID: 381b4222-f694-41f0-9685-ff5bb260df2e  (Balanced) *</span><br><span class="line">Power Scheme GUID: a1841308-3541-4fab-bc81-f71556f20b4a  (Power saver)</span><br><span class="line">Power Scheme GUID: 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c  (High performance)</span><br></pre></td></tr></table></figure>
<p>带星号 <code>*</code> 的是当前启用的电源计划。</p>
</li>
<li>
<p><strong><code>/setactive &lt;GUID&gt;</code></strong>：设置指定的电源计划为当前激活的电源计划。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercfg /setactive &lt;GUID&gt;</span><br></pre></td></tr></table></figure>
<p>例如，要设置高性能模式，可以这样做：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercfg /setactive 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c</span><br></pre></td></tr></table></figure>
</li>
</ol>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-01_生活/16_反思(9月第1个星期)"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/09/06/01_%E7%94%9F%E6%B4%BB/16_%E5%8F%8D%E6%80%9D(9%E6%9C%88%E7%AC%AC1%E4%B8%AA%E6%98%9F%E6%9C%9F)/"
    >反思(9月第1个星期)</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/09/06/01_%E7%94%9F%E6%B4%BB/16_%E5%8F%8D%E6%80%9D(9%E6%9C%88%E7%AC%AC1%E4%B8%AA%E6%98%9F%E6%9C%9F)/" class="article-date">
  <time datetime="2024-09-06T12:26:56.000Z" itemprop="datePublished">2024-09-06</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%94%9F%E6%B4%BB/">生活</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  Here's something encrypted, password is required to continue reading. 
      <a class="article-more-link" href="/2024/09/06/01_%E7%94%9F%E6%B4%BB/16_%E5%8F%8D%E6%80%9D(9%E6%9C%88%E7%AC%AC1%E4%B8%AA%E6%98%9F%E6%9C%9F)/"
        >阅读更多...</a
      >
       
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-02_瑞芯微/22_野火文件系统构建脚本分析"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/09/02/02_%E7%91%9E%E8%8A%AF%E5%BE%AE/22_%E9%87%8E%E7%81%AB%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90/"
    >野火文件系统构建脚本分析</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/09/02/02_%E7%91%9E%E8%8A%AF%E5%BE%AE/22_%E9%87%8E%E7%81%AB%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90/" class="article-date">
  <time datetime="2024-09-02T09:17:03.000Z" itemprop="datePublished">2024-09-02</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%91%9E%E8%8A%AF%E5%BE%AE/">瑞芯微</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>==其实野火保持了基本的构建，也就是瑞芯微的那种构建方式，只是因为我认为这种方式并不好所以我很久之前就不用了，而是换成了从github上学来的方式方法，怎么说呢各有个的好处，我还是喜欢我现在的这种方法，但是还欠缺一个合并起来的契机，等下次再说了，现在先学习一下野火的构建方式，学习一下其中的优点，看看我有什么可以学习的地方==</p>
<h1 id="目录结构分析"><a class="markdownIt-Anchor" href="#目录结构分析"></a> 目录结构分析</h1>
<p>ubuntu和Debian的构建方式是类似的，所以结构也都是差不多的，具体内容如下所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051031260.png" alt="image-20240902195552816" />image-20240902195552816</p>
<p>每个脚本和文件夹的作用分析如下所示：</p>
<table>
<thead>
<tr>
<th>文件/文件夹名</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>add-build-info.sh</code></td>
<td>一个脚本，用于在构建过程中添加构建信息，例如版本号、构建时间等，通常在生成镜像或打包时使用。</td>
</tr>
<tr>
<td><code>ch-mount.sh</code></td>
<td>一个脚本，用于挂载或卸载文件系统镜像，可能用于在构建根文件系统或修改镜像时使用。</td>
</tr>
<tr>
<td><code>mk-base-ubuntu.sh</code></td>
<td>一个脚本，用于创建基础的 Ubuntu 根文件系统，通常用于定制 Ubuntu 系统的初始步骤。</td>
</tr>
<tr>
<td><code>mk-image.sh</code></td>
<td>一个脚本，用于生成最终的镜像文件，将构建的根文件系统和其他组件打包成可启动的镜像文件。</td>
</tr>
<tr>
<td><code>mk-ubuntu-rootfs.sh</code></td>
<td>一个脚本，用于创建 Ubuntu 根文件系统，可能包含基本的软件包安装和配置，作为生成镜像的基础。</td>
</tr>
<tr>
<td><code>overlay</code></td>
<td>一个目录，包含需要覆盖到根文件系统或镜像中的文件或目录，通常用于在最终镜像中添加或替换文件。</td>
</tr>
<tr>
<td><code>overlay-debug</code></td>
<td>一个目录，可能包含调试所需的文件或配置，用于在构建调试版本的镜像时使用。</td>
</tr>
<tr>
<td><code>overlay-firmware</code></td>
<td>一个目录，可能包含固件文件或相关配置，通常用于在构建过程中将固件文件添加到根文件系统或镜像中。</td>
</tr>
<tr>
<td><code>packages</code></td>
<td>一个目录，可能包含需要安装或复制到根文件系统的预编译软件包，或者包含脚本或配置文件以便在构建过程中使用。</td>
</tr>
<tr>
<td><code>post-build.sh</code></td>
<td>一个脚本，用于在构建过程完成后执行一些后续操作，例如清理临时文件、调整权限、打包生成的镜像等。</td>
</tr>
<tr>
<td><code>readme.md</code></td>
<td>一个文档文件，通常包含该项目或构建系统的使用说明、安装步骤、功能描述等信息。</td>
</tr>
<tr>
<td><code>sources.list</code></td>
<td>Ubuntu 的软件源列表文件，定义了包管理器可以从哪些源下载和安装软件包，通常用于定制 Ubuntu 根文件系统时替换默认的源列表。</td>
</tr>
<tr>
<td><code>ubuntu-build-service</code></td>
<td>可能是一个用于构建或管理 Ubuntu 系统服务的目录或脚本集合，具体功能取决于目录内的内容，通常包含构建工具和配置文件。</td>
</tr>
</tbody>
</table>
<p>确实没有什么可以学习的地方，重点应该是在软件上吧，先来分析<code>mk-base-ubuntu.sh</code>这个脚本，然后再分析mk-ubuntu-rootfs.sh这个脚本。</p>
<h1 id="mk-base-ubuntush脚本分析"><a class="markdownIt-Anchor" href="#mk-base-ubuntush脚本分析"></a> mk-base-ubuntu.sh脚本分析</h1>
<h2 id="未修改"><a class="markdownIt-Anchor" href="#未修改"></a> 未修改</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><span class="line">COPY#!/bin/bash -e</span><br><span class="line"># 使用 -e 参数，确保脚本在遇到错误时自动退出</span><br><span class="line"></span><br><span class="line"># 日志文件路径</span><br><span class="line">LOGFILE=&quot;/var/log/script.log&quot;</span><br><span class="line"># 将日志记录到文件中</span><br><span class="line">exec &gt; &gt;(tee -i $LOGFILE) 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"># 定义一个用于修复 dpkg 信息目录的函数</span><br><span class="line">repair_dpkg() &#123;</span><br><span class="line">    mv /var/lib/dpkg/info/ /var/lib/dpkg/info_old/</span><br><span class="line">    mkdir /var/lib/dpkg/info/</span><br><span class="line">    apt-get update</span><br><span class="line">    mv /var/lib/dpkg/info_old/* /var/lib/dpkg/info/</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 用户输入处理循环，确保输入有效的选项</span><br><span class="line">if [ -z &quot;$TARGET&quot; ]; then</span><br><span class="line">    while true; do</span><br><span class="line">        echo &quot;---------------------------------------------------------&quot;</span><br><span class="line">        echo &quot;please enter TARGET version number:&quot;</span><br><span class="line">        echo &quot;请输入要构建的根文件系统版本:&quot;</span><br><span class="line">        echo &quot;[0] Exit Menu&quot;</span><br><span class="line">        echo &quot;[1] gnome&quot;</span><br><span class="line">        echo &quot;[2] xfce&quot;</span><br><span class="line">        echo &quot;[3] lite&quot;</span><br><span class="line">        echo &quot;---------------------------------------------------------&quot;</span><br><span class="line">        read input</span><br><span class="line"></span><br><span class="line">        case $input in</span><br><span class="line">            0) exit;;</span><br><span class="line">            1) TARGET=gnome; break;;</span><br><span class="line">            2) TARGET=xfce; break;;</span><br><span class="line">            3) TARGET=lite; break;;</span><br><span class="line">            *) echo -e &quot;\033[47;36m 输入错误，请重试。 \033[0m&quot;;;</span><br><span class="line">        esac</span><br><span class="line">    done</span><br><span class="line">    echo -e &quot;\033[47;36m 设置 TARGET=$TARGET...... \033[0m&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 仅在未定义 ARCH 时设置默认值</span><br><span class="line">if [ -z &quot;$ARCH&quot; ]; then</span><br><span class="line">    ARCH=&quot;arm64&quot;</span><br><span class="line">    echo -e &quot;\033[47;36m 设置默认 ARCH=arm64...... \033[0m&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">TARGET_ROOTFS_DIR=&quot;binary&quot;  # 设置目标根文件系统目录为 &quot;binary&quot;</span><br><span class="line"></span><br><span class="line"># 删除已有的目标根文件系统目录</span><br><span class="line">sudo rm -rf $TARGET_ROOTFS_DIR/</span><br><span class="line"></span><br><span class="line"># 如果目标根文件系统目录不存在，则创建它</span><br><span class="line">if [ ! -d $TARGET_ROOTFS_DIR ]; then</span><br><span class="line">    sudo mkdir -p $TARGET_ROOTFS_DIR</span><br><span class="line"></span><br><span class="line">    # 如果 ubuntu-base 压缩包不存在，则下载相应的版本</span><br><span class="line">    if [ ! -e ubuntu-base-20.04.5-base-$ARCH.tar.gz ]; then</span><br><span class="line">        echo -e &quot;\033[47;36m 下载 ubuntu-base-20.04-base-x.tar.gz \033[0m&quot;</span><br><span class="line">        wget -c http://cdimage.ubuntu.com/ubuntu-base/releases/20.04/release/ubuntu-base-20.04.5-base-$ARCH.tar.gz</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    # 解压下载的 ubuntu-base 压缩包到目标目录</span><br><span class="line">    sudo tar -xzf ubuntu-base-20.04.5-base-$ARCH.tar.gz -C $TARGET_ROOTFS_DIR/</span><br><span class="line">    # 复制 sources.list 文件到根文件系统中</span><br><span class="line">    sudo cp sources.list $TARGET_ROOTFS_DIR/etc/apt/sources.list</span><br><span class="line">    # 复制当前系统的 DNS 解析配置到根文件系统中</span><br><span class="line">    sudo cp -b /etc/resolv.conf $TARGET_ROOTFS_DIR/etc/resolv.conf</span><br><span class="line"></span><br><span class="line">    # 根据架构复制相应的 qemu 可执行文件，以便在 chroot 环境中运行</span><br><span class="line">    sudo cp -b /usr/bin/qemu-aarch64-static $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 定义清理函数，在遇到错误时解除挂载并退出</span><br><span class="line">finish() &#123;</span><br><span class="line">    ./ch-mount.sh -u $TARGET_ROOTFS_DIR</span><br><span class="line">    echo -e &quot;脚本执行失败。详情请查看 $LOGFILE。&quot;</span><br><span class="line">    exit -1</span><br><span class="line">&#125;</span><br><span class="line">trap finish ERR  # 当脚本发生错误时，自动执行 finish 函数</span><br><span class="line"></span><br><span class="line">echo -e &quot;\033[47;36m 切换到根目录...... \033[0m&quot;</span><br><span class="line"></span><br><span class="line"># 挂载根文件系统以便 chroot 操作</span><br><span class="line">./ch-mount.sh -m $TARGET_ROOTFS_DIR</span><br><span class="line"></span><br><span class="line"># 通过 chroot 进入目标根文件系统并执行一系列命令</span><br><span class="line">cat &lt;&lt;EOF | sudo chroot $TARGET_ROOTFS_DIR/</span><br><span class="line"></span><br><span class="line">export DEBIAN_FRONTEND=noninteractive  # 设置为非交互模式，以避免安装过程中要求用户输入</span><br><span class="line">export APT_INSTALL=&quot;apt-get install -fy --allow-downgrades&quot;  # 定义安装命令的快捷方式</span><br><span class="line"></span><br><span class="line">export LC_ALL=C.UTF-8  # 设置系统语言环境为 C.UTF-8</span><br><span class="line"></span><br><span class="line"># 更新和升级系统包</span><br><span class="line">apt-get -y update</span><br><span class="line">apt-get -f -y upgrade</span><br><span class="line"></span><br><span class="line"># 根据 TARGET 变量安装不同的桌面环境或软件包</span><br><span class="line">case &quot;$TARGET&quot; in</span><br><span class="line">    gnome)</span><br><span class="line">        apt install -y ubuntu-desktop-minimal rsyslog sudo dialog apt-utils ntp evtest onboard</span><br><span class="line">        repair_dpkg</span><br><span class="line">        ;;</span><br><span class="line">    xfce)</span><br><span class="line">        apt install -y xubuntu-core onboard rsyslog sudo dialog apt-utils ntp evtest udev</span><br><span class="line">        repair_dpkg</span><br><span class="line">        ;;</span><br><span class="line">    lite)</span><br><span class="line">        apt install -y rsyslog sudo dialog apt-utils ntp evtest acpid</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line"># 安装基本的网络、开发和系统工具</span><br><span class="line">\$&#123;APT_INSTALL&#125; net-tools openssh-server ifupdown alsa-utils ntp network-manager gdb inetutils-ping libssl-dev \</span><br><span class="line">    vsftpd tcpdump can-utils i2c-tools strace vim iperf3 ethtool netplan.io toilet htop pciutils usbutils curl \</span><br><span class="line">    whiptail gnupg bc xinput gdisk parted gcc sox libsox-fmt-all gpiod libgpiod-dev python3-pip python3-libgpiod \</span><br><span class="line">    guvcview</span><br><span class="line"></span><br><span class="line">\$&#123;APT_INSTALL&#125; ttf-wqy-zenhei xfonts-intl-chinese  # 安装中文字体</span><br><span class="line"></span><br><span class="line"># 安装中文支持包，设置系统语言为简体中文</span><br><span class="line">if [[ &quot;$TARGET&quot; == &quot;gnome&quot; ||  &quot;$TARGET&quot; == &quot;xfce&quot; ]]; then</span><br><span class="line">    apt purge ibus firefox -y  # 卸载 ibus 和 Firefox</span><br><span class="line"></span><br><span class="line">    echo -e &quot;\033[47;36m 安装中文字体...... \033[0m&quot;</span><br><span class="line">    \$&#123;APT_INSTALL&#125; language-pack-zh-hans fonts-noto-cjk-extra gnome-user-docs-zh-hans language-pack-gnome-zh-hans</span><br><span class="line"></span><br><span class="line">    # 设置 fcitx 为默认的输入法</span><br><span class="line">    \$&#123;APT_INSTALL&#125; fcitx fcitx-table fcitx-googlepinyin fcitx-pinyin fcitx-config-gtk</span><br><span class="line">    sed -i &#x27;s/default/fcitx/g&#x27; /etc/X11/xinit/xinputrc</span><br><span class="line"></span><br><span class="line">    \$&#123;APT_INSTALL&#125; ipython3 jupyter  # 安装 IPython 和 Jupyter</span><br><span class="line"></span><br><span class="line">    # 取消对 zh_CN.UTF-8 的注释，使其可生成</span><br><span class="line">    sed -i &#x27;s/^# *\(zh_CN.UTF-8\)/\1/&#x27; /etc/locale.gen</span><br><span class="line">    echo &quot;LANG=zh_CN.UTF-8&quot; &gt;&gt; /etc/default/locale</span><br><span class="line"></span><br><span class="line">    # 生成 zh_CN.UTF-8 本地化环境</span><br><span class="line">    locale-gen zh_CN.UTF-8</span><br><span class="line"></span><br><span class="line">    # 设置环境变量</span><br><span class="line">    echo &quot;LC_ALL=zh_CN.UTF-8&quot; &gt;&gt; /etc/environment    </span><br><span class="line">    echo &quot;LANG=zh_CN.UTF-8&quot; &gt;&gt; /etc/environment</span><br><span class="line">    echo &quot;LANGUAGE=zh_CN:zh:en_US:en&quot; &gt;&gt; /etc/environment</span><br><span class="line"></span><br><span class="line">    echo &quot;export LC_ALL=zh_CN.UTF-8&quot; &gt;&gt; /etc/profile.d/zh_CN.sh</span><br><span class="line">    echo &quot;export LANG=zh_CN.UTF-8&quot; &gt;&gt; /etc/profile.d/zh_CN.sh</span><br><span class="line">    echo &quot;export LANGUAGE=zh_CN:zh:en_US:en&quot; &gt;&gt; /etc/profile.d/zh_CN.sh</span><br><span class="line"></span><br><span class="line">    \$&#123;APT_INSTALL&#125; $(check-language-support)  # 安装语言支持包</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 为 GNOME 或 XFCE 桌面环境安装额外的多媒体工具</span><br><span class="line">if [[ &quot;$TARGET&quot; == &quot;gnome&quot; || &quot;$TARGET&quot; == &quot;xfce&quot; ]]; then</span><br><span class="line">    \$&#123;APT_INSTALL&#125; mpv acpid gnome-sound-recorder</span><br><span class="line">elif [ &quot;$TARGET&quot; == &quot;lite&quot; ]; then</span><br><span class="line">    \$&#123;APT_INSTALL&#125;  </span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 安装 Python 库和工具</span><br><span class="line">pip3 install python-periphery Adafruit-Blinka -i https://mirrors.aliyun.com/pypi/simple/</span><br><span class="line"></span><br><span class="line">HOST=topeet  # 设置主机名</span><br><span class="line"></span><br><span class="line"># 创建新用户 &#x27;topeet&#x27; 并设置密码</span><br><span class="line">useradd -G sudo -m -s /bin/bash cat</span><br><span class="line">passwd cat &lt;&lt;IEOF</span><br><span class="line">topeet</span><br><span class="line">topeet</span><br><span class="line">IEOF</span><br><span class="line"></span><br><span class="line"># 将用户 &#x27;topeet&#x27; 添加到视频和音频组</span><br><span class="line">gpasswd -a topeet video</span><br><span class="line">gpasswd -a topeet audio</span><br><span class="line"></span><br><span class="line"># 设置 root 用户密码</span><br><span class="line">passwd root &lt;&lt;IEOF</span><br><span class="line">topeet</span><br><span class="line">topeet</span><br><span class="line">IEOF</span><br><span class="line"></span><br><span class="line"># 允许 root 用户登录</span><br><span class="line">sed -i &#x27;/pam_securetty.so/s/^/# /g&#x27; /etc/pam.d/login</span><br><span class="line"></span><br><span class="line"># 设置主机名为 &#x27;topeet&#x27;</span><br><span class="line">echo topeet &gt; /etc/hostname</span><br><span class="line"></span><br><span class="line"># 设置系统时区为上海</span><br><span class="line">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line"></span><br><span class="line"># 解决 90 秒延迟问题</span><br><span class="line">for service in NetworkManager systemd-networkd; do</span><br><span class="line">    systemctl mask $&#123;service&#125;-wait-online.service</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># 禁用有线和无线的 wpa_supplicant 服务</span><br><span class="line">systemctl mask wpa_supplicant-wired@</span><br><span class="line">systemctl mask wpa_supplicant-nl80211@</span><br><span class="line">systemctl mask wpa_supplicant@</span><br><span class="line"></span><br><span class="line"># 减少 systemd 的日志输出</span><br><span class="line">sed -i &#x27;s/#LogLevel=info/LogLevel=warning/&#x27; \</span><br><span class="line">  /etc/systemd/system.conf</span><br><span class="line"></span><br><span class="line">sed -i &#x27;s/#LogTarget=journal-or-kmsg/LogTarget=journal/&#x27; \</span><br><span class="line">  /etc/systemd/system.conf</span><br><span class="line"></span><br><span class="line"># 确保 sudoers 文件中包含对 sudo 组的配置</span><br><span class="line">SUDOEXISTS=&quot;$(awk &#x27;$1 == &quot;%sudo&quot; &#123; print $1 &#125;&#x27; /etc/sudoers)&quot;</span><br><span class="line">if [ -z &quot;$SUDOEXISTS&quot; ]; then</span><br><span class="line">    # 如果没有 sudo 组的配置，则添加</span><br><span class="line">    echo &quot;# Members of the sudo group may gain root privileges&quot; &gt;&gt; /etc/sudoers</span><br><span class="line">    echo &quot;%sudo	ALL=(ALL) NOPASSWD: ALL&quot; &gt;&gt; /etc/sudoers</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 确保 sudo 组的 NOPASSWD 配置已设置</span><br><span class="line">sed -i -e &#x27;</span><br><span class="line">/\%sudo/ c \</span><br><span class="line">%sudo    ALL=(ALL) NOPASSWD: ALL</span><br><span class="line">&#x27; /etc/sudoers</span><br><span class="line"></span><br><span class="line"># 清理 apt 缓存并同步磁盘</span><br><span class="line">apt-get clean</span><br><span class="line">rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line">sync</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># 解除挂载根文件系统</span><br><span class="line">./ch-mount.sh -u $TARGET_ROOTFS_DIR</span><br><span class="line"></span><br><span class="line"># 获取当前日期，并将根文件系统打包成 tar.gz 文件</span><br><span class="line">DATE=$(date +%Y%m%d)</span><br><span class="line">echo -e &quot;\033[47;36m 运行 tar 打包 ubuntu-base-$TARGET-$ARCH-$DATE.tar.gz \033[0m&quot;</span><br><span class="line">sudo tar zcf ubuntu-base-$TARGET-$ARCH-$DATE.tar.gz $TARGET_ROOTFS_DIR</span><br></pre></td></tr></table></figure>
<h2 id="优化1"><a class="markdownIt-Anchor" href="#优化1"></a> 优化1</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br></pre></td><td class="code"><pre><span class="line">COPY#!/bin/bash -e</span><br><span class="line"># 使用 -e 参数，确保脚本在遇到错误时自动退出</span><br><span class="line"></span><br><span class="line"># 确保脚本在错误时退出</span><br><span class="line">set -e -o pipefail</span><br><span class="line"></span><br><span class="line"># 判断是否拥有root权限</span><br><span class="line">if [[ &quot;$&#123;EUID&#125;&quot; == &quot;0&quot; ]]; then</span><br><span class="line">        :</span><br><span class="line">else</span><br><span class="line">       	echo -e &quot;\033[47;36m This script requires root privileges, trying to use sudo \033[0m&quot;</span><br><span class="line">        sudo &quot;$&#123;0&#125;&quot; &quot;$@&quot;</span><br><span class="line">        exit $?</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 定义日志文件路径</span><br><span class="line">LOGFILE=&quot;/var/log/script.log&quot;</span><br><span class="line"></span><br><span class="line"># 将所有输出重定向到日志文件，并同时输出到终端</span><br><span class="line">exec &gt; &gt;(tee -i $LOGFILE) 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"># 定义一个函数，用于修复 dpkg 信息目录</span><br><span class="line">repair_dpkg() &#123;</span><br><span class="line">    mv /var/lib/dpkg/info/ /var/lib/dpkg/info_old/</span><br><span class="line">    mkdir /var/lib/dpkg/info/</span><br><span class="line">    apt-get update</span><br><span class="line">    mv /var/lib/dpkg/info_old/* /var/lib/dpkg/info/</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 定义一个函数，用于挂载必要的文件系统</span><br><span class="line">mnt() &#123;</span><br><span class="line">    echo &quot;MOUNTING&quot;</span><br><span class="line">    mount -t proc /proc $&#123;1&#125;proc</span><br><span class="line">    mount -t sysfs /sys $&#123;1&#125;sys</span><br><span class="line">    mount -o bind /dev $&#123;1&#125;dev</span><br><span class="line">    mount -o bind /dev/pts $&#123;1&#125;dev/pts</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 定义一个函数，用于解除挂载文件系统</span><br><span class="line">umnt() &#123;</span><br><span class="line">    echo &quot;UNMOUNTING&quot;</span><br><span class="line">    umount $&#123;1&#125;proc || true</span><br><span class="line">    umount $&#123;1&#125;sys || true</span><br><span class="line">    umount $&#123;1&#125;dev/pts || true</span><br><span class="line">    umount $&#123;1&#125;dev || true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 定义一个清理函数，在脚本遇到错误时自动执行</span><br><span class="line">finish() &#123;</span><br><span class="line">    umnt $TARGET_ROOTFS_DIR</span><br><span class="line">    echo -e &quot;脚本执行失败。详情请查看 $LOGFILE。&quot;</span><br><span class="line">    exit 1</span><br><span class="line">&#125;</span><br><span class="line"># 设置 trap，当脚本发生错误时，自动执行 finish 函数</span><br><span class="line">trap finish ERR</span><br><span class="line"></span><br><span class="line"># 定义一个函数，用于处理用户输入以选择目标系统版本</span><br><span class="line">select_target() &#123;</span><br><span class="line">    while true; do</span><br><span class="line">        echo &quot;---------------------------------------------------------&quot;</span><br><span class="line">        echo &quot;please enter TARGET version number:&quot;</span><br><span class="line">        echo &quot;请输入要构建的根文件系统版本:&quot;</span><br><span class="line">        echo &quot;[0] 退出菜单&quot;</span><br><span class="line">        echo &quot;[1] gnome&quot;</span><br><span class="line">        echo &quot;[2] xfce&quot;</span><br><span class="line">        echo &quot;[3] lite&quot;</span><br><span class="line">        echo &quot;---------------------------------------------------------&quot;</span><br><span class="line">        read input</span><br><span class="line">        case $input in</span><br><span class="line">            0) exit;;</span><br><span class="line">            1) TARGET=gnome; break;;</span><br><span class="line">            2) TARGET=xfce; break;;</span><br><span class="line">            3) TARGET=lite; break;;</span><br><span class="line">            *) echo -e &quot;\033[47;36m 输入错误，请重试。 \033[0m&quot;;;</span><br><span class="line">        esac</span><br><span class="line">    done</span><br><span class="line">    echo -e &quot;\033[47;36m 设置 TARGET=$TARGET...... \033[0m&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 如果 TARGET 变量未定义，调用 select_target 函数让用户选择</span><br><span class="line">[ -z &quot;$TARGET&quot; ] &amp;&amp; select_target</span><br><span class="line"></span><br><span class="line"># 设置默认架构为 arm64</span><br><span class="line">ARCH=&quot;arm64&quot; &amp;&amp; echo -e &quot;\033[47;36m 设置默认 ARCH=arm64...... \033[0m&quot;</span><br><span class="line"></span><br><span class="line"># 设置目标根文件系统目录</span><br><span class="line">TARGET_ROOTFS_DIR=&quot;binary&quot;</span><br><span class="line"></span><br><span class="line"># 删除已有的目标根文件系统目录，避免冲突</span><br><span class="line">rm -rf $TARGET_ROOTFS_DIR/</span><br><span class="line"></span><br><span class="line"># 如果目标根文件系统目录不存在，则创建它</span><br><span class="line">if [ ! -d $TARGET_ROOTFS_DIR ]; then</span><br><span class="line">    mkdir -p $TARGET_ROOTFS_DIR</span><br><span class="line"></span><br><span class="line">    # 如果 ubuntu-base 压缩包不存在，则下载相应的版本</span><br><span class="line">    if [ ! -e ubuntu-base-20.04.5-base-$ARCH.tar.gz ]; then</span><br><span class="line">        echo -e &quot;\033[47;36m 下载 ubuntu-base-20.04.5-base-$ARCH.tar.gz \033[0m&quot;</span><br><span class="line">        wget -c http://cdimage.ubuntu.com/ubuntu-base/releases/20.04/release/ubuntu-base-20.04.5-base-$ARCH.tar.gz</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    # 解压下载的 ubuntu-base 压缩包到目标目录</span><br><span class="line">    tar -xzf ubuntu-base-20.04.5-base-$ARCH.tar.gz -C $TARGET_ROOTFS_DIR/</span><br><span class="line"></span><br><span class="line">    # 复制当前系统的 DNS 解析配置到目标根文件系统中</span><br><span class="line">    cp -b /etc/resolv.conf $TARGET_ROOTFS_DIR/etc/resolv.conf</span><br><span class="line">	</span><br><span class="line">    # 修改目标根文件系统的 apt 软件源</span><br><span class="line">    cat &lt;&lt;-EOF &gt; &quot;$TARGET_ROOTFS_DIR&quot;/etc/apt/sources.list</span><br><span class="line">        deb http://mirrors.ustc.edu.cn/ubuntu-ports/ focal main multiverse restricted universe</span><br><span class="line">        deb http://mirrors.ustc.edu.cn/ubuntu-ports/ focal-backports main multiverse restricted universe</span><br><span class="line">        deb http://mirrors.ustc.edu.cn/ubuntu-ports/ focal-proposed main multiverse restricted universe</span><br><span class="line">        deb http://mirrors.ustc.edu.cn/ubuntu-ports/ focal-security main multiverse restricted universe</span><br><span class="line">        deb http://mirrors.ustc.edu.cn/ubuntu-ports/ focal-updates main multiverse restricted universe</span><br><span class="line">        deb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ focal main multiverse restricted universe</span><br><span class="line">        deb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ focal-backports main multiverse restricted universe</span><br><span class="line">        deb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ focal-proposed main multiverse restricted universe</span><br><span class="line">        deb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ focal-security main multiverse restricted universe</span><br><span class="line">        deb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ focal-updates main multiverse restricted universe</span><br><span class="line">	EOF</span><br><span class="line"></span><br><span class="line">    # 根据系统架构，复制相应的 qemu 可执行文件，以便在 chroot 环境中运行</span><br><span class="line">    cp -b /usr/bin/qemu-aarch64-static $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo -e &quot;\033[47;36m 切换到根目录...... \033[0m&quot;</span><br><span class="line"></span><br><span class="line"># 挂载根文件系统以便后续的 chroot 操作</span><br><span class="line">mnt $TARGET_ROOTFS_DIR/</span><br><span class="line"></span><br><span class="line"># 通过 chroot 进入目标根文件系统并执行一系列命令</span><br><span class="line">cat &lt;&lt;EOF | chroot $TARGET_ROOTFS_DIR/</span><br><span class="line"></span><br><span class="line">export DEBIAN_FRONTEND=noninteractive  # 设置为非交互模式，以避免安装过程中要求用户输入</span><br><span class="line">export APT_INSTALL=&quot;apt-get install -fy --allow-downgrades&quot;  # 定义安装命令的快捷方式</span><br><span class="line">export LC_ALL=C.UTF-8  # 设置系统语言环境为 C.UTF-8</span><br><span class="line"></span><br><span class="line"># 更新和升级系统包</span><br><span class="line">apt-get -y update</span><br><span class="line">apt-get -f -y upgrade</span><br><span class="line"></span><br><span class="line"># 根据 TARGET 变量安装不同的桌面环境或软件包</span><br><span class="line">case &quot;$TARGET&quot; in</span><br><span class="line">    gnome)</span><br><span class="line">        apt install -y ubuntu-desktop-minimal rsyslog sudo dialog apt-utils ntp evtest onboard</span><br><span class="line">        repair_dpkg</span><br><span class="line">        ;;</span><br><span class="line">    xfce)</span><br><span class="line">        apt install -y xubuntu-core onboard rsyslog sudo dialog apt-utils ntp evtest udev</span><br><span class="line">        repair_dpkg</span><br><span class="line">        ;;</span><br><span class="line">    lite)</span><br><span class="line">        apt install -y rsyslog sudo dialog apt-utils ntp evtest acpid</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line"># 安装基本的网络、开发和系统工具</span><br><span class="line">\$&#123;APT_INSTALL&#125; net-tools openssh-server ifupdown alsa-utils ntp network-manager gdb inetutils-ping libssl-dev \</span><br><span class="line">    vsftpd tcpdump can-utils i2c-tools strace vim iperf3 ethtool netplan.io toilet htop pciutils usbutils curl \</span><br><span class="line">    whiptail gnupg bc xinput gdisk parted gcc sox libsox-fmt-all gpiod libgpiod-dev python3-pip python3-libgpiod \</span><br><span class="line">    guvcview</span><br><span class="line"></span><br><span class="line">\$&#123;APT_INSTALL&#125; ttf-wqy-zenhei xfonts-intl-chinese  # 安装中文字体</span><br><span class="line"></span><br><span class="line"># 安装中文支持包，设置系统语言为简体中文</span><br><span class="line">if [[ &quot;$TARGET&quot; == &quot;gnome&quot; ||  &quot;$TARGET&quot; == &quot;xfce&quot; ]]; then</span><br><span class="line">    apt purge ibus firefox -y  # 卸载 ibus 和 Firefox</span><br><span class="line"></span><br><span class="line">    echo -e &quot;\033[47;36m 安装中文字体...... \033[0m&quot;</span><br><span class="line">    \$&#123;APT_INSTALL&#125; language-pack-zh-hans fonts-noto-cjk-extra gnome-user-docs-zh-hans language-pack-gnome-zh-hans</span><br><span class="line"></span><br><span class="line">    # 设置 fcitx 为默认的输入法</span><br><span class="line">    \$&#123;APT_INSTALL&#125; fcitx fcitx-table fcitx-googlepinyin fcitx-pinyin fcitx-config-gtk</span><br><span class="line">    sed -i &#x27;s/default/fcitx/g&#x27; /etc/X11/xinit/xinputrc</span><br><span class="line"></span><br><span class="line">    \$&#123;APT_INSTALL&#125; ipython3 jupyter  # 安装 IPython 和 Jupyter</span><br><span class="line"></span><br><span class="line">    # 取消对 zh_CN.UTF-8 的注释，使其可生成</span><br><span class="line">    sed -i &#x27;s/^# *\(zh_CN.UTF-8\)/\1/&#x27; /etc/locale.gen</span><br><span class="line">    echo &quot;LANG=zh_CN.UTF-8&quot; &gt;&gt; /etc/default/locale</span><br><span class="line"></span><br><span class="line">    # 生成 zh_CN.UTF-8 本地化环境</span><br><span class="line">    locale-gen zh_CN.UTF-8</span><br><span class="line"></span><br><span class="line">    # 设置环境变量</span><br><span class="line">    echo &quot;LC_ALL=zh_CN.UTF-8&quot; &gt;&gt; /etc/environment    </span><br><span class="line">    echo &quot;LANG=zh_CN.UTF-8&quot; &gt;&gt; /etc/environment</span><br><span class="line">    echo &quot;LANGUAGE=zh_CN:zh:en_US:en&quot; &gt;&gt; /etc/environment</span><br><span class="line"></span><br><span class="line">    echo &quot;export LC_ALL=zh_CN.UTF-8&quot; &gt;&gt; /etc/profile.d/zh_CN.sh</span><br><span class="line">    echo &quot;export LANG=zh_CN.UTF-8&quot; &gt;&gt; /etc/profile.d/zh_CN.sh</span><br><span class="line">    echo &quot;export LANGUAGE=zh_CN:zh:en_US:en&quot; &gt;&gt; /etc/profile.d/zh_CN.sh</span><br><span class="line"></span><br><span class="line">    \$&#123;APT_INSTALL&#125; $(check-language-support)  # 安装语言支持包</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 为 GNOME 或 XFCE 桌面环境安装额外的多媒体工具</span><br><span class="line">if [[ &quot;$TARGET&quot; == &quot;gnome&quot; || &quot;$TARGET&quot; == &quot;xfce&quot; ]]; then</span><br><span class="line">    \$&#123;APT_INSTALL&#125; mpv acpid gnome-sound-recorder</span><br><span class="line">elif [ &quot;$TARGET&quot; == &quot;lite&quot; ]; then</span><br><span class="line">    \$&#123;APT_INSTALL&#125;  </span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 安装 Python 库和工具</span><br><span class="line">pip3 install python-periphery Adafruit-Blinka -i https://mirrors.aliyun.com/pypi/simple/</span><br><span class="line"></span><br><span class="line">HOST=topeet  # 设置主机名</span><br><span class="line"></span><br><span class="line"># 创建新用户 &#x27;topeet&#x27; 并设置密码</span><br><span class="line">useradd -G sudo -m -s /bin/bash topeet</span><br><span class="line">passwd topeet &lt;&lt;IEOF</span><br><span class="line">topeet</span><br><span class="line">topeet</span><br><span class="line">IEOF</span><br><span class="line"></span><br><span class="line"># 将用户 &#x27;topeet&#x27; 添加到视频和音频组</span><br><span class="line">gpasswd -a topeet video</span><br><span class="line">gpasswd -a topeet audio</span><br><span class="line"></span><br><span class="line"># 设置 root 用户密码</span><br><span class="line">passwd root &lt;&lt;IEOF</span><br><span class="line">topeet</span><br><span class="line">topeet</span><br><span class="line">IEOF</span><br><span class="line"></span><br><span class="line"># 允许 root 用户登录</span><br><span class="line">sed -i &#x27;/pam_securetty.so/s/^/# /g&#x27; /etc/pam.d/login</span><br><span class="line"></span><br><span class="line"># 设置主机名为 &#x27;topeet&#x27;</span><br><span class="line">echo topeet &gt; /etc/hostname</span><br><span class="line"></span><br><span class="line"># 设置系统时区为上海</span><br><span class="line">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line"></span><br><span class="line"># 解决 90 秒延迟问题</span><br><span class="line">for service in NetworkManager systemd-networkd; do</span><br><span class="line">    systemctl mask $&#123;service&#125;-wait-online.service</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># 禁用有线和无线的 wpa_supplicant 服务</span><br><span class="line">systemctl mask wpa_supplicant-wired@</span><br><span class="line">systemctl mask wpa_supplicant-nl80211@</span><br><span class="line">systemctl mask wpa_supplicant@</span><br><span class="line"></span><br><span class="line"># 减少 systemd 的日志输出</span><br><span class="line">sed -i &#x27;s/#LogLevel=info/LogLevel=warning/&#x27; \</span><br><span class="line">  /etc/systemd/system.conf</span><br><span class="line"></span><br><span class="line">sed -i &#x27;s/#LogTarget=journal-or-kmsg/LogTarget=journal/&#x27; \</span><br><span class="line">  /etc/systemd/system.conf</span><br><span class="line"></span><br><span class="line"># 确保 sudoers 文件中包含对 sudo 组的配置</span><br><span class="line">SUDOEXISTS=&quot;$(awk &#x27;$1 == &quot;%sudo&quot; &#123; print $1 &#125;&#x27; /etc/sudoers)&quot;</span><br><span class="line">if [ -z &quot;$SUDOEXISTS&quot; ]; then</span><br><span class="line">    # 如果没有 sudo 组的配置，则添加</span><br><span class="line">    echo &quot;# Members of the sudo group may gain root privileges&quot; &gt;&gt; /etc/sudoers</span><br><span class="line">    echo &quot;%sudo	ALL=(ALL) NOPASSWD: ALL&quot; &gt;&gt; /etc/sudoers</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 确保 sudo 组的 NOPASSWD 配置已设置</span><br><span class="line">sed -i -e &#x27;</span><br><span class="line">/\%sudo/ c \</span><br><span class="line">%sudo    ALL=(ALL) NOPASSWD: ALL</span><br><span class="line">&#x27; /etc/sudoers</span><br><span class="line"></span><br><span class="line"># 清理 apt 缓存并同步磁盘</span><br><span class="line">apt-get clean</span><br><span class="line">rm -rf /var/lib/apt/lists/*</span><br><span class="line">sync</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># 解除挂载根文件系统</span><br><span class="line">umnt $TARGET_ROOTFS_DIR/</span><br><span class="line"></span><br><span class="line"># 获取当前日期，并将根文件系统打包成 tar.xz 文件</span><br><span class="line">DATE=$(date +%Y%m%d)</span><br><span class="line">echo -e &quot;\033[47;36m 运行 tar 打包 ubuntu-base-$TARGET-$ARCH-$DATE.tar.xz \033[0m&quot;</span><br><span class="line">XZ_OPT=-T0 tar -cpJf ubuntu-base-$TARGET-$ARCH-$DATE.tar.xz $TARGET_ROOTFS_DIR</span><br></pre></td></tr></table></figure>
<h2 id="mk-imagesh"><a class="markdownIt-Anchor" href="#mk-imagesh"></a> <a target="_blank" rel="noopener" href="http://mk-image.sh/">mk-image.sh</a></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">COPY#!/bin/bash -e</span><br><span class="line"></span><br><span class="line"># 判断是否拥有root权限，如果没有则使用sudo重新运行脚本</span><br><span class="line">if [[ &quot;$&#123;EUID&#125;&quot; == &quot;0&quot; ]]; then</span><br><span class="line">        :</span><br><span class="line">else</span><br><span class="line">       	echo -e &quot;\033[47;36m 该脚本需要root权限，尝试使用sudo重新运行 \033[0m&quot;</span><br><span class="line">        sudo &quot;$&#123;0&#125;&quot; &quot;$@&quot;</span><br><span class="line">        exit $?</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 定义目标根文件系统目录和根文件系统镜像文件</span><br><span class="line">TARGET_ROOTFS_DIR=binary/</span><br><span class="line">ROOTFSIMAGE=rootfs.img</span><br><span class="line">EXTRA_SIZE_MB=300  # 额外添加的空间大小，以MB为单位</span><br><span class="line">IMAGE_SIZE_MB=$(( $(sudo du -sh -m $&#123;TARGET_ROOTFS_DIR&#125; | cut -f1) + $&#123;EXTRA_SIZE_MB&#125; ))  # 计算镜像文件大小</span><br><span class="line"></span><br><span class="line"># 修正根文件系统的文件系统类型</span><br><span class="line">function fixup_root()</span><br><span class="line">&#123;</span><br><span class="line">	echo &quot;修正根文件系统类型: $1&quot;</span><br><span class="line"></span><br><span class="line">	FS_TYPE=$1</span><br><span class="line">	sed -i &quot;s#\([[:space:]]/[[:space:]]\+\)\w\+#\1$&#123;FS_TYPE&#125;#&quot; \</span><br><span class="line">		$&#123;TARGET_ROOTFS_DIR&#125;/etc/fstab</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 修正特定分区的配置</span><br><span class="line">function fixup_part()</span><br><span class="line">&#123;</span><br><span class="line">	echo &quot;修正分区配置: $@&quot;</span><br><span class="line"></span><br><span class="line">	if echo $1 | grep -qE &quot;^/&quot;; then</span><br><span class="line">		DEV=$1</span><br><span class="line">	else</span><br><span class="line">		DEV=&quot;PARTLABEL=$1&quot;</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	MOUNT=$&#123;2:-/$1&#125;  # 挂载点，默认为分区名</span><br><span class="line">	FS_TYPE=$&#123;3:-auto&#125;  # 文件系统类型，默认为auto</span><br><span class="line">	OPT=$&#123;4:-defaults&#125;  # 挂载选项，默认为defaults</span><br><span class="line"></span><br><span class="line">	# 删除fstab中的旧配置</span><br><span class="line">	sed -i &quot;#[[:space:]]$&#123;MOUNT&#125;[[:space:]]#d&quot; $&#123;TARGET_ROOTFS_DIR&#125;/etc/fstab</span><br><span class="line"></span><br><span class="line">	# 添加新的fstab配置</span><br><span class="line">	echo -e &quot;$&#123;DEV&#125;\t$&#123;MOUNT&#125;\t$&#123;FS_TYPE&#125;\t$&#123;OPT&#125;\t0 2&quot; &gt;&gt; \</span><br><span class="line">		$&#123;TARGET_ROOTFS_DIR&#125;/etc/fstab</span><br><span class="line"></span><br><span class="line">	# 创建挂载点目录</span><br><span class="line">	mkdir -p $&#123;TARGET_ROOTFS_DIR&#125;/$&#123;MOUNT&#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 修正/etc/fstab文件</span><br><span class="line">function fixup_fstab()</span><br><span class="line">&#123;</span><br><span class="line">	echo &quot;修正 /etc/fstab...&quot;</span><br><span class="line"></span><br><span class="line">	case &quot;$&#123;RK_ROOTFS_TYPE&#125;&quot; in</span><br><span class="line">		ext[234])</span><br><span class="line">			fixup_root $&#123;RK_ROOTFS_TYPE&#125;</span><br><span class="line">			;;</span><br><span class="line">		*)</span><br><span class="line">			fixup_root auto</span><br><span class="line">			;;</span><br><span class="line">	esac</span><br><span class="line"></span><br><span class="line">	# 修正额外分区的配置</span><br><span class="line">	for part in $&#123;RK_EXTRA_PARTITIONS&#125;; do</span><br><span class="line">		fixup_part $(echo &quot;$&#123;part&#125;&quot; | xargs -d&#x27;:&#x27;)</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 添加构建信息到/etc/os-release文件中</span><br><span class="line">function add_build_info()</span><br><span class="line">&#123;</span><br><span class="line">	# 删除已有的BUILD_ID字段</span><br><span class="line">	[ -f $&#123;TARGET_ROOTFS_DIR&#125;/etc/os-release ] &amp;&amp; \</span><br><span class="line">		sed -i &quot;/^BUILD_ID=/d&quot; $&#123;TARGET_ROOTFS_DIR&#125;/etc/os-release</span><br><span class="line"></span><br><span class="line">	# 添加新的BUILD_INFO字段</span><br><span class="line">	echo &quot;添加构建信息到 /etc/os-release...&quot;</span><br><span class="line">	echo &quot;BUILD_INFO=\&quot;$(whoami)@$(hostname) $(date)$&#123;@:+ - $@&#125;\&quot;&quot; &gt;&gt; \</span><br><span class="line">		$&#123;TARGET_ROOTFS_DIR&#125;/etc/os-release</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 创建必要的目录和符号链接</span><br><span class="line">function add_dirs_and_links()</span><br><span class="line">&#123;</span><br><span class="line">	echo &quot;添加目录和符号链接...&quot;</span><br><span class="line"></span><br><span class="line">	cd $&#123;TARGET_ROOTFS_DIR&#125;</span><br><span class="line">	mkdir -p mnt/sdcard mnt/usb0  # 创建挂载点目录</span><br><span class="line">	ln -sf media/usb0 udisk  # 创建符号链接</span><br><span class="line">	ln -sf mnt/sdcard sdcard</span><br><span class="line">	ln -sf userdata data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 开始制作根文件系统镜像</span><br><span class="line">echo &quot;制作根文件系统镜像!&quot;</span><br><span class="line"></span><br><span class="line"># 如果已有旧的根文件系统镜像文件，则删除</span><br><span class="line">if [ -e $&#123;ROOTFSIMAGE&#125; ]; then</span><br><span class="line">        rm $&#123;ROOTFSIMAGE&#125;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 添加构建信息</span><br><span class="line">add_build_info </span><br><span class="line"></span><br><span class="line"># 修正 /etc/fstab 文件（如果存在）</span><br><span class="line">[ -f $&#123;TARGET_ROOTFS_DIR&#125;/etc/fstab ] &amp;&amp; fixup_fstab</span><br><span class="line"></span><br><span class="line"># 添加目录和符号链接</span><br><span class="line">add_dirs_and_links &amp;&amp; cd ..</span><br><span class="line"></span><br><span class="line"># 创建空白镜像文件</span><br><span class="line">dd if=/dev/zero of=$&#123;ROOTFSIMAGE&#125; bs=1M count=0 seek=$&#123;IMAGE_SIZE_MB&#125;</span><br><span class="line"></span><br><span class="line"># 使用mkfs.ext4命令将内容填充到镜像文件中</span><br><span class="line">sudo mkfs.ext4 -d $&#123;TARGET_ROOTFS_DIR&#125; $&#123;ROOTFSIMAGE&#125;</span><br><span class="line"></span><br><span class="line"># 输出根文件系统镜像文件的信息</span><br><span class="line">echo &quot;根文件系统镜像: $&#123;ROOTFSIMAGE&#125;&quot;</span><br></pre></td></tr></table></figure>
<h2 id="优化2"><a class="markdownIt-Anchor" href="#优化2"></a> 优化2</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br></pre></td><td class="code"><pre><span class="line">COPY#!/bin/bash -e</span><br><span class="line"># 使用 -e 参数，确保脚本在遇到错误时自动退出</span><br><span class="line"></span><br><span class="line"># 确保脚本在错误时退出</span><br><span class="line">set -e -o pipefail</span><br><span class="line"></span><br><span class="line"># 判断是否拥有root权限</span><br><span class="line">if [[ &quot;$&#123;EUID&#125;&quot; == &quot;0&quot; ]]; then</span><br><span class="line">        :</span><br><span class="line">else</span><br><span class="line">       	echo -e &quot;\033[47;36m This script requires root privileges, trying to use sudo \033[0m&quot;</span><br><span class="line">        sudo &quot;$&#123;0&#125;&quot; &quot;$@&quot;</span><br><span class="line">        exit $?</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 定义日志文件路径</span><br><span class="line">LOGFILE=&quot;/var/log/script.log&quot;</span><br><span class="line"></span><br><span class="line"># 将所有输出重定向到日志文件，并同时输出到终端</span><br><span class="line">exec &gt; &gt;(tee -i $LOGFILE) 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"># 定义一个函数，用于修复 dpkg 信息目录</span><br><span class="line">repair_dpkg() &#123;</span><br><span class="line">    mv /var/lib/dpkg/info/ /var/lib/dpkg/info_old/</span><br><span class="line">    mkdir /var/lib/dpkg/info/</span><br><span class="line">    apt-get update</span><br><span class="line">    mv /var/lib/dpkg/info_old/* /var/lib/dpkg/info/</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 定义一个函数，用于挂载必要的文件系统</span><br><span class="line">mnt() &#123;</span><br><span class="line">    echo &quot;MOUNTING&quot;</span><br><span class="line">    mount -t proc /proc $&#123;1&#125;proc</span><br><span class="line">    mount -t sysfs /sys $&#123;1&#125;sys</span><br><span class="line">    mount -o bind /dev $&#123;1&#125;dev</span><br><span class="line">    mount -o bind /dev/pts $&#123;1&#125;dev/pts</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 定义一个函数，用于解除挂载文件系统</span><br><span class="line">umnt() &#123;</span><br><span class="line">    echo &quot;UNMOUNTING&quot;</span><br><span class="line">    umount $&#123;1&#125;proc || true</span><br><span class="line">    umount $&#123;1&#125;sys || true</span><br><span class="line">    umount $&#123;1&#125;dev/pts || true</span><br><span class="line">    umount $&#123;1&#125;dev || true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 定义一个清理函数，在脚本遇到错误时自动执行</span><br><span class="line">finish() &#123;</span><br><span class="line">    umnt $TARGET_ROOTFS_DIR</span><br><span class="line">    echo -e &quot;脚本执行失败。详情请查看 $LOGFILE。&quot;</span><br><span class="line">    exit 1</span><br><span class="line">&#125;</span><br><span class="line"># 设置 trap，当脚本发生错误时，自动执行 finish 函数</span><br><span class="line">trap finish ERR</span><br><span class="line"></span><br><span class="line"># 定义一个函数，用于处理用户输入以选择目标系统版本</span><br><span class="line">select_target() &#123;</span><br><span class="line">    while true; do</span><br><span class="line">        echo &quot;---------------------------------------------------------&quot;</span><br><span class="line">        echo &quot;please enter TARGET version number:&quot;</span><br><span class="line">        echo &quot;请输入要构建的根文件系统版本:&quot;</span><br><span class="line">        echo &quot;[0] 退出菜单&quot;</span><br><span class="line">        echo &quot;[1] gnome&quot;</span><br><span class="line">        echo &quot;[2] xfce&quot;</span><br><span class="line">        echo &quot;[3] lite&quot;</span><br><span class="line">        echo &quot;---------------------------------------------------------&quot;</span><br><span class="line">        read input</span><br><span class="line">        case $input in</span><br><span class="line">            0) exit;;</span><br><span class="line">            1) TARGET=gnome; break;;</span><br><span class="line">            2) TARGET=xfce; break;;</span><br><span class="line">            3) TARGET=lite; break;;</span><br><span class="line">            *) echo -e &quot;\033[47;36m 输入错误，请重试。 \033[0m&quot;;;</span><br><span class="line">        esac</span><br><span class="line">    done</span><br><span class="line">    echo -e &quot;\033[47;36m 设置 TARGET=$TARGET...... \033[0m&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 如果 TARGET 变量未定义，调用 select_target 函数让用户选择</span><br><span class="line">[ -z &quot;$TARGET&quot; ] &amp;&amp; select_target</span><br><span class="line"></span><br><span class="line"># 设置默认架构为 arm64</span><br><span class="line">ARCH=&quot;arm64&quot; &amp;&amp; echo -e &quot;\033[47;36m 设置默认 ARCH=arm64...... \033[0m&quot;</span><br><span class="line"></span><br><span class="line"># 设置目标根文件系统目录</span><br><span class="line">TARGET_ROOTFS_DIR=&quot;binary&quot;</span><br><span class="line"></span><br><span class="line"># 删除已有的目标根文件系统目录，避免冲突</span><br><span class="line">rm -rf $TARGET_ROOTFS_DIR/</span><br><span class="line"></span><br><span class="line"># 如果目标根文件系统目录不存在，则创建它</span><br><span class="line">if [ ! -d $TARGET_ROOTFS_DIR ]; then</span><br><span class="line">    mkdir -p $TARGET_ROOTFS_DIR</span><br><span class="line"></span><br><span class="line">    # 如果 ubuntu-base 压缩包不存在，则下载相应的版本</span><br><span class="line">    if [ ! -e ubuntu-base-20.04.5-base-$ARCH.tar.gz ]; then</span><br><span class="line">        echo &quot;\033[36m wget ubuntu-base-22.04.4-base-&quot;$ARCH&quot;.tar.gz \033[0m&quot;</span><br><span class="line">        wget -c http://cdimage.ubuntu.com/ubuntu-base/releases/22.04/release/ubuntu-base-22.04.4-base-$ARCH.tar.gz</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    # 解压下载的 ubuntu-base 压缩包到目标目录</span><br><span class="line">    tar -xzf ubuntu-base-20.04.5-base-$ARCH.tar.gz -C $TARGET_ROOTFS_DIR/</span><br><span class="line"></span><br><span class="line">    # 复制当前系统的 DNS 解析配置到目标根文件系统中</span><br><span class="line">    cp -b /etc/resolv.conf $TARGET_ROOTFS_DIR/etc/resolv.conf</span><br><span class="line">	</span><br><span class="line">    # 修改目标根文件系统的 apt 软件源</span><br><span class="line">    cat &lt;&lt;-EOF &gt; &quot;$TARGET_ROOTFS_DIR&quot;/etc/apt/sources.list</span><br><span class="line">        deb http://mirrors.ustc.edu.cn/ubuntu-ports/ jammy main multiverse restricted universe</span><br><span class="line">        deb http://mirrors.ustc.edu.cn/ubuntu-ports/ jammy-backports main multiverse restricted universe</span><br><span class="line">        deb http://mirrors.ustc.edu.cn/ubuntu-ports/ jammy-proposed main multiverse restricted universe</span><br><span class="line">        deb http://mirrors.ustc.edu.cn/ubuntu-ports/ jammy-security main multiverse restricted universe</span><br><span class="line">        deb http://mirrors.ustc.edu.cn/ubuntu-ports/ jammy-updates main multiverse restricted universe</span><br><span class="line">        deb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ jammy main multiverse restricted universe</span><br><span class="line">        deb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ jammy-backports main multiverse restricted universe</span><br><span class="line">        deb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ jammy-proposed main multiverse restricted universe</span><br><span class="line">        deb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ jammy-security main multiverse restricted universe</span><br><span class="line">        deb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ jammy-updates main multiverse restricted universe</span><br><span class="line">	EOF</span><br><span class="line"></span><br><span class="line">    # 根据系统架构，复制相应的 qemu 可执行文件，以便在 chroot 环境中运行</span><br><span class="line">    cp -b /usr/bin/qemu-aarch64-static $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo -e &quot;\033[47;36m 切换到根目录...... \033[0m&quot;</span><br><span class="line"></span><br><span class="line"># 挂载根文件系统以便后续的 chroot 操作</span><br><span class="line">mnt $TARGET_ROOTFS_DIR/</span><br><span class="line"></span><br><span class="line"># 通过 chroot 进入目标根文件系统并执行一系列命令</span><br><span class="line">cat &lt;&lt;EOF | chroot $TARGET_ROOTFS_DIR/</span><br><span class="line"></span><br><span class="line">export DEBIAN_FRONTEND=noninteractive  # 设置为非交互模式，以避免安装过程中要求用户输入</span><br><span class="line">export APT_INSTALL=&quot;apt-get install -fy --allow-downgrades&quot;  # 定义安装命令的快捷方式</span><br><span class="line">export LC_ALL=C.UTF-8  # 设置系统语言环境为 C.UTF-8</span><br><span class="line"></span><br><span class="line"># 更新和升级系统包</span><br><span class="line">apt-get -y update</span><br><span class="line">apt-get -f -y upgrade</span><br><span class="line"></span><br><span class="line"># 根据 TARGET 变量安装不同的桌面环境或软件包</span><br><span class="line">case &quot;$TARGET&quot; in</span><br><span class="line">    gnome)</span><br><span class="line">        apt install -y ubuntu-desktop-minimal rsyslog sudo dialog apt-utils ntp evtest onboard</span><br><span class="line">        repair_dpkg</span><br><span class="line">        ;;</span><br><span class="line">    xfce)</span><br><span class="line">        apt install -y xubuntu-core onboard rsyslog sudo dialog apt-utils ntp evtest udev</span><br><span class="line">        repair_dpkg</span><br><span class="line">        ;;</span><br><span class="line">    lite)</span><br><span class="line">        apt install -y rsyslog sudo dialog apt-utils ntp evtest acpid</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line"># 安装基本的网络、开发和系统工具</span><br><span class="line">\$&#123;APT_INSTALL&#125; net-tools openssh-server ifupdown alsa-utils ntp network-manager gdb inetutils-ping libssl-dev \</span><br><span class="line">    vsftpd tcpdump can-utils i2c-tools strace vim iperf3 ethtool netplan.io toilet htop pciutils usbutils curl \</span><br><span class="line">    whiptail gnupg bc xinput gdisk parted gcc sox libsox-fmt-all gpiod libgpiod-dev python3-pip python3-libgpiod \</span><br><span class="line">    guvcview</span><br><span class="line"></span><br><span class="line">\$&#123;APT_INSTALL&#125; ttf-wqy-zenhei xfonts-intl-chinese  # 安装中文字体</span><br><span class="line"></span><br><span class="line"># 安装中文支持包，设置系统语言为简体中文</span><br><span class="line">if [[ &quot;$TARGET&quot; == &quot;gnome&quot; ||  &quot;$TARGET&quot; == &quot;xfce&quot; ]]; then</span><br><span class="line">    apt purge ibus firefox -y  # 卸载 ibus 和 Firefox</span><br><span class="line"></span><br><span class="line">    echo -e &quot;\033[47;36m 安装中文字体...... \033[0m&quot;</span><br><span class="line">    \$&#123;APT_INSTALL&#125; language-pack-zh-hans fonts-noto-cjk-extra gnome-user-docs-zh-hans language-pack-gnome-zh-hans</span><br><span class="line"></span><br><span class="line">    # 设置 fcitx 为默认的输入法</span><br><span class="line">    \$&#123;APT_INSTALL&#125; fcitx fcitx-table fcitx-googlepinyin fcitx-pinyin fcitx-config-gtk</span><br><span class="line">    sed -i &#x27;s/default/fcitx/g&#x27; /etc/X11/xinit/xinputrc</span><br><span class="line"></span><br><span class="line">    \$&#123;APT_INSTALL&#125; ipython3 jupyter  # 安装 IPython 和 Jupyter</span><br><span class="line"></span><br><span class="line">    # 取消对 zh_CN.UTF-8 的注释，使其可生成</span><br><span class="line">    sed -i &#x27;s/^# *\(zh_CN.UTF-8\)/\1/&#x27; /etc/locale.gen</span><br><span class="line">    echo &quot;LANG=zh_CN.UTF-8&quot; &gt;&gt; /etc/default/locale</span><br><span class="line"></span><br><span class="line">    # 生成 zh_CN.UTF-8 本地化环境</span><br><span class="line">    locale-gen zh_CN.UTF-8</span><br><span class="line"></span><br><span class="line">    # 设置环境变量</span><br><span class="line">    echo &quot;LC_ALL=zh_CN.UTF-8&quot; &gt;&gt; /etc/environment    </span><br><span class="line">    echo &quot;LANG=zh_CN.UTF-8&quot; &gt;&gt; /etc/environment</span><br><span class="line">    echo &quot;LANGUAGE=zh_CN:zh:en_US:en&quot; &gt;&gt; /etc/environment</span><br><span class="line"></span><br><span class="line">    echo &quot;export LC_ALL=zh_CN.UTF-8&quot; &gt;&gt; /etc/profile.d/zh_CN.sh</span><br><span class="line">    echo &quot;export LANG=zh_CN.UTF-8&quot; &gt;&gt; /etc/profile.d/zh_CN.sh</span><br><span class="line">    echo &quot;export LANGUAGE=zh_CN:zh:en_US:en&quot; &gt;&gt; /etc/profile.d/zh_CN.sh</span><br><span class="line"></span><br><span class="line">    \$&#123;APT_INSTALL&#125; $(check-language-support)  # 安装语言支持包</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 为 GNOME 或 XFCE 桌面环境安装额外的多媒体工具</span><br><span class="line">if [[ &quot;$TARGET&quot; == &quot;gnome&quot; || &quot;$TARGET&quot; == &quot;xfce&quot; ]]; then</span><br><span class="line">    \$&#123;APT_INSTALL&#125; mpv acpid gnome-sound-recorder</span><br><span class="line">elif [ &quot;$TARGET&quot; == &quot;lite&quot; ]; then</span><br><span class="line">    \$&#123;APT_INSTALL&#125;  </span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">HOST=topeet  # 设置主机名</span><br><span class="line"></span><br><span class="line"># 创建新用户 &#x27;topeet&#x27; 并设置密码</span><br><span class="line">useradd -G sudo -m -s /bin/bash topeet</span><br><span class="line">passwd topeet &lt;&lt;IEOF</span><br><span class="line">topeet</span><br><span class="line">topeet</span><br><span class="line">IEOF</span><br><span class="line"></span><br><span class="line"># 将用户 &#x27;topeet&#x27; 添加到视频和音频组</span><br><span class="line">gpasswd -a topeet video</span><br><span class="line">gpasswd -a topeet audio</span><br><span class="line"></span><br><span class="line"># 设置 root 用户密码</span><br><span class="line">passwd root &lt;&lt;IEOF</span><br><span class="line">topeet</span><br><span class="line">topeet</span><br><span class="line">IEOF</span><br><span class="line"></span><br><span class="line"># 允许 root 用户登录</span><br><span class="line">sed -i &#x27;/pam_securetty.so/s/^/# /g&#x27; /etc/pam.d/login</span><br><span class="line"></span><br><span class="line"># 设置主机名为 &#x27;topeet&#x27;</span><br><span class="line">echo topeet &gt; /etc/hostname</span><br><span class="line"></span><br><span class="line"># 设置系统时区为上海</span><br><span class="line">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line"></span><br><span class="line"># 解决 90 秒延迟问题</span><br><span class="line">for service in NetworkManager systemd-networkd; do</span><br><span class="line">    systemctl mask $&#123;service&#125;-wait-online.service</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># 禁用有线和无线的 wpa_supplicant 服务</span><br><span class="line">systemctl mask wpa_supplicant-wired@</span><br><span class="line">systemctl mask wpa_supplicant-nl80211@</span><br><span class="line">systemctl mask wpa_supplicant@</span><br><span class="line"></span><br><span class="line"># 减少 systemd 的日志输出</span><br><span class="line">sed -i &#x27;s/#LogLevel=info/LogLevel=warning/&#x27; \</span><br><span class="line">  /etc/systemd/system.conf</span><br><span class="line"></span><br><span class="line">sed -i &#x27;s/#LogTarget=journal-or-kmsg/LogTarget=journal/&#x27; \</span><br><span class="line">  /etc/systemd/system.conf</span><br><span class="line"></span><br><span class="line"># 确保 sudoers 文件中包含对 sudo 组的配置</span><br><span class="line">SUDOEXISTS=&quot;$(awk &#x27;$1 == &quot;%sudo&quot; &#123; print $1 &#125;&#x27; /etc/sudoers)&quot;</span><br><span class="line">if [ -z &quot;$SUDOEXISTS&quot; ]; then</span><br><span class="line">    # 如果没有 sudo 组的配置，则添加</span><br><span class="line">    echo &quot;# Members of the sudo group may gain root privileges&quot; &gt;&gt; /etc/sudoers</span><br><span class="line">    echo &quot;%sudo	ALL=(ALL) NOPASSWD: ALL&quot; &gt;&gt; /etc/sudoers</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 确保 sudo 组的 NOPASSWD 配置已设置</span><br><span class="line">sed -i -e &#x27;</span><br><span class="line">/\%sudo/ c \</span><br><span class="line">%sudo    ALL=(ALL) NOPASSWD: ALL</span><br><span class="line">&#x27; /etc/sudoers</span><br><span class="line"></span><br><span class="line"># 清理 apt 缓存并同步磁盘</span><br><span class="line">apt-get clean</span><br><span class="line">rm -rf /var/lib/apt/lists/*</span><br><span class="line">sync</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># 解除挂载根文件系统</span><br><span class="line">umnt $TARGET_ROOTFS_DIR/</span><br><span class="line"></span><br><span class="line"># 获取当前日期，并将根文件系统打包成 tar.xz 文件</span><br><span class="line">DATE=$(date +%Y%m%d)</span><br><span class="line">echo -e &quot;\033[47;36m 运行 tar 打包 ubuntu-base-$TARGET-$ARCH-$DATE.tar.xz \033[0m&quot;</span><br><span class="line">XZ_OPT=-T0 tar -cpJf ubuntu-base-$TARGET-$ARCH-$DATE.tar.xz $TARGET_ROOTFS_DIR</span><br></pre></td></tr></table></figure>
<h1 id="mk-ubuntu-rootfssh脚本分析"><a class="markdownIt-Anchor" href="#mk-ubuntu-rootfssh脚本分析"></a> mk-ubuntu-rootfs.sh脚本分析</h1>
<h2 id="未修改-2"><a class="markdownIt-Anchor" href="#未修改-2"></a> 未修改</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br></pre></td><td class="code"><pre><span class="line">COPY#!/bin/bash -e</span><br><span class="line"># 使用 -e 参数，确保脚本在遇到错误时自动退出</span><br><span class="line"></span><br><span class="line"># 确保脚本在错误时退出</span><br><span class="line">set -e -o pipefail</span><br><span class="line"></span><br><span class="line"># 判断是否拥有root权限</span><br><span class="line">if [[ &quot;$&#123;EUID&#125;&quot; == &quot;0&quot; ]]; then</span><br><span class="line">        :</span><br><span class="line">else</span><br><span class="line">       	echo -e &quot;\033[47;36m This script requires root privileges, trying to use sudo \033[0m&quot;</span><br><span class="line">        sudo &quot;$&#123;0&#125;&quot; &quot;$@&quot;</span><br><span class="line">        exit $?</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 定义日志文件路径</span><br><span class="line">LOGFILE=&quot;/var/log/script.log&quot;</span><br><span class="line"></span><br><span class="line"># 将所有输出重定向到日志文件，并同时输出到终端</span><br><span class="line">exec &gt; &gt;(tee -i $LOGFILE) 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"># 选择 SOC 的函数</span><br><span class="line">select_soc() &#123;</span><br><span class="line">    while true; do</span><br><span class="line">        echo &quot;---------------------------------------------------------&quot;</span><br><span class="line">        echo &quot;请输入要构建CPU的序号:&quot;</span><br><span class="line">        echo &quot;[0] 退出&quot;</span><br><span class="line">        echo &quot;[1] rk3562&quot;</span><br><span class="line">        echo &quot;[2] rk3568&quot;</span><br><span class="line">        echo &quot;[3] rk3588/rk3588s&quot;</span><br><span class="line">        echo &quot;---------------------------------------------------------&quot;</span><br><span class="line">        read input</span><br><span class="line"></span><br><span class="line">        case $input in</span><br><span class="line">            0) exit;;</span><br><span class="line">            1) SOC=rk3562; break;;</span><br><span class="line">            2) SOC=rk356x; break;;</span><br><span class="line">            3) SOC=rk3588; break;;</span><br><span class="line">            *) echo &quot;无效输入，请重试。&quot;;;</span><br><span class="line">        esac</span><br><span class="line">    done</span><br><span class="line">    echo -e &quot;\033[47;36m 设置 SOC=$SOC...... \033[0m&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 选择 TARGET 版本的函数</span><br><span class="line">select_target() &#123;</span><br><span class="line">    while true; do</span><br><span class="line">        echo &quot;---------------------------------------------------------&quot;</span><br><span class="line">        echo &quot;请输入要构建的根文件系统版本:&quot;</span><br><span class="line">        echo &quot;[0] 退出&quot;</span><br><span class="line">        echo &quot;[1] gnome&quot;</span><br><span class="line">        echo &quot;[2] xfce&quot;</span><br><span class="line">        echo &quot;[3] lite&quot;</span><br><span class="line">        echo &quot;---------------------------------------------------------&quot;</span><br><span class="line">        read input</span><br><span class="line"></span><br><span class="line">        case $input in</span><br><span class="line">            0) exit;;</span><br><span class="line">            1) TARGET=gnome; break;;</span><br><span class="line">            2) TARGET=xfce; break;;</span><br><span class="line">            3) TARGET=lite; break;;</span><br><span class="line">            *) echo &quot;无效输入，请重试。&quot;;;</span><br><span class="line">        esac</span><br><span class="line">    done</span><br><span class="line">    echo -e &quot;\033[47;36m 设置 TARGET=$TARGET...... \033[0m&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 安装与 SOC 相关的软件包</span><br><span class="line">install_packages() &#123;</span><br><span class="line">    case $SOC in</span><br><span class="line">        rk3562)</span><br><span class="line">        MALI=bifrost-g52-g13p0</span><br><span class="line">        ISP=rkaiq_rk3562</span><br><span class="line">        ;;</span><br><span class="line">        rk356x|rk3566|rk3568)</span><br><span class="line">        MALI=bifrost-g52-g13p0</span><br><span class="line">        ISP=rkaiq_rk3568</span><br><span class="line">        MIRROR=carp-rk356x</span><br><span class="line">        ;;</span><br><span class="line">        rk3588|rk3588s)</span><br><span class="line">        ISP=rkaiq_rk3588</span><br><span class="line">        MALI=valhall-g610-g13p0</span><br><span class="line">        MIRROR=carp-rk3588</span><br><span class="line">        ;;</span><br><span class="line">    esac</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 重试命令的函数</span><br><span class="line">retry_command() &#123;</span><br><span class="line">    local retries=3</span><br><span class="line">    local count=0</span><br><span class="line">    until &quot;$@&quot;; do</span><br><span class="line">        exit_code=$?</span><br><span class="line">        count=$((count + 1))</span><br><span class="line">        if [ $count -lt $retries ]; then</span><br><span class="line">            echo &quot;命令失败，正在重试 ($count/$retries)...&quot;</span><br><span class="line">            sleep 1</span><br><span class="line">        else</span><br><span class="line">            echo &quot;命令执行失败，退出。&quot;</span><br><span class="line">            return $exit_code</span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">    return 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 如果没有定义 SOC 变量，则提示用户选择</span><br><span class="line">[ ! $SOC ] &amp;&amp; select_soc</span><br><span class="line"></span><br><span class="line"># 如果没有定义 TARGET 变量，则提示用户选择</span><br><span class="line">[ ! $TARGET ] &amp;&amp; select_target</span><br><span class="line"></span><br><span class="line">echo -e &quot;\033[47;36m 正在构建 $ARCH 版本 \033[0m&quot;</span><br><span class="line"></span><br><span class="line"># 如果没有定义 VERSION 变量，则设置默认版本为 &quot;release&quot;</span><br><span class="line">[ ! $VERSION ] &amp;&amp; VERSION=$DEFAULT_VERSION</span><br><span class="line"></span><br><span class="line">echo -e &quot;\033[47;36m 正在构建 $VERSION 版本 \033[0m&quot;</span><br><span class="line"></span><br><span class="line"># 检查是否存在指定的 ubuntu-base tar.gz 文件，如果不存在则退出</span><br><span class="line">if [ ! -e ubuntu-base-&quot;$TARGET&quot;-$ARCH-*.tar.gz ]; then</span><br><span class="line">    echo &quot;\033[41;36m 请先运行 mk-base-ubuntu.sh \033[0m&quot;</span><br><span class="line">    exit -1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 定义清理函数，用于在发生错误时卸载并退出</span><br><span class="line">finish() &#123;</span><br><span class="line">    sudo umount $TARGET_ROOTFS_DIR/dev</span><br><span class="line">    exit -1</span><br><span class="line">&#125;</span><br><span class="line">trap finish ERR  # 当脚本发生错误时，自动执行 finish 函数</span><br><span class="line"></span><br><span class="line">echo -e &quot;\033[47;36m 解压镜像 \033[0m&quot;</span><br><span class="line">sudo rm -rf $TARGET_ROOTFS_DIR</span><br><span class="line">sudo tar -xpf ubuntu-base-$TARGET-$ARCH-*.tar.gz</span><br><span class="line"></span><br><span class="line"># 创建并复制 packages 文件夹中的内容到目标根文件系统</span><br><span class="line">sudo mkdir -p $TARGET_ROOTFS_DIR/packages</span><br><span class="line">retry_command sudo cp -rpf packages/$ARCH/* $TARGET_ROOTFS_DIR/packages</span><br><span class="line"></span><br><span class="line"># 调用 install_packages 函数并复制 GPU/CAMERA 相关的软件包</span><br><span class="line">install_packages</span><br><span class="line">sudo mkdir -p $TARGET_ROOTFS_DIR/packages/install_packages</span><br><span class="line">retry_command sudo cp -rpf packages/$ARCH/libmali/libmali-*$MALI*-x11*.deb $TARGET_ROOTFS_DIR/packages/install_packages</span><br><span class="line">retry_command sudo cp -rpf packages/$ARCH/$&#123;ISP:0:5&#125;/camera_engine_$ISP*.deb $TARGET_ROOTFS_DIR/packages/install_packages</span><br><span class="line"></span><br><span class="line"># 如果存在 linux kernel 的 deb 包，则将其复制到目标根文件系统的 boot/kerneldeb 文件夹</span><br><span class="line">if [ -e ../linux-headers* ]; then</span><br><span class="line">    Image_Deb=$(basename ../linux-headers*)</span><br><span class="line">    sudo mkdir -p $TARGET_ROOTFS_DIR/boot/kerneldeb</span><br><span class="line">    sudo touch $TARGET_ROOTFS_DIR/boot/build-host</span><br><span class="line">    retry_command sudo cp -vrpf ../$&#123;Image_Deb&#125; $TARGET_ROOTFS_DIR/boot/kerneldeb</span><br><span class="line">    retry_command sudo cp -vrpf ../$&#123;Image_Deb/headers/image&#125; $TARGET_ROOTFS_DIR/boot/kerneldeb</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 复制 overlay 和 overlay-firmware 文件夹中的内容到目标根文件系统</span><br><span class="line">retry_command sudo cp -rpf overlay/* $TARGET_ROOTFS_DIR/</span><br><span class="line">retry_command sudo cp -rpf overlay-firmware/* $TARGET_ROOTFS_DIR/</span><br><span class="line"></span><br><span class="line"># 如果版本为 debug，则复制 overlay-debug 文件夹中的内容到目标根文件系统</span><br><span class="line">if [ &quot;$VERSION&quot; == &quot;debug&quot; ]; then</span><br><span class="line">    retry_command sudo cp -rpf overlay-debug/* $TARGET_ROOTFS_DIR/</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 修复串口配置文件</span><br><span class="line">retry_command sudo cp -f overlay/usr/lib/systemd/system/serial-getty@.service $TARGET_ROOTFS_DIR/lib/systemd/system/serial-getty@.service</span><br><span class="line"></span><br><span class="line">echo -e &quot;\033[47;36m 切换到根目录...... \033[0m&quot;</span><br><span class="line"># 复制 qemu 可执行文件</span><br><span class="line">sudo cp /usr/bin/qemu-aarch64-static $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line"></span><br><span class="line"># 挂载目标根文件系统</span><br><span class="line">./ch-mount.sh -m $TARGET_ROOTFS_DIR</span><br><span class="line"></span><br><span class="line"># 获取目标根文件系统的所有者 ID</span><br><span class="line">ID=$(stat --format %u $TARGET_ROOTFS_DIR)</span><br><span class="line"></span><br><span class="line"># 在 chroot 环境中执行以下命令</span><br><span class="line">cat &lt;&lt; EOF | sudo chroot $TARGET_ROOTFS_DIR</span><br><span class="line"></span><br><span class="line"># 修复文件所有者</span><br><span class="line">if [ &quot;$ID&quot; -ne 0 ]; then</span><br><span class="line">    find / -user $ID -exec chown -h 0:0 &#123;&#125; \;</span><br><span class="line">fi</span><br><span class="line">for u in \$(ls /home/); do</span><br><span class="line">    chown -h -R \$u:\$u /home/\$u</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># 设置语言环境</span><br><span class="line">export LC_ALL=C.UTF-8</span><br><span class="line"></span><br><span class="line"># 更新和升级系统包</span><br><span class="line">apt-get update</span><br><span class="line">apt-get upgrade -y</span><br><span class="line"></span><br><span class="line"># 修复权限问题</span><br><span class="line">chmod o+x /usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">chmod +x /etc/rc.local</span><br><span class="line"></span><br><span class="line"># 设置非交互模式安装软件包</span><br><span class="line">export DEBIAN_FRONTEND=noninteractive</span><br><span class="line">export APT_INSTALL=&quot;apt-get install -fy --allow-downgrades&quot;</span><br><span class="line"></span><br><span class="line"># 提示进入 LubanCat 环境</span><br><span class="line">echo -e &quot;\033[47;36m ---------- LubanCat -------- \033[0m&quot;</span><br><span class="line">if [ $MIRROR ]; then</span><br><span class="line">    \$&#123;APT_INSTALL&#125; fire-config lbc-test</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 安装基础工具</span><br><span class="line">PACKAGES=&quot;u-boot-tools edid-decode logrotate&quot;</span><br><span class="line">case &quot;$TARGET&quot; in</span><br><span class="line">    gnome)</span><br><span class="line">        PACKAGES=&quot;$PACKAGES gdisk&quot;</span><br><span class="line">        # 设置桌面背景图片</span><br><span class="line">        ln -sf /usr/share/xfce4/backdrops/lubancat-wallpaper.png /usr/share/backgrounds/warty-final-ubuntu.png</span><br><span class="line">        ;;</span><br><span class="line">    xfce)</span><br><span class="line">        apt-get remove -y gnome-bluetooth</span><br><span class="line">        PACKAGES=&quot;$PACKAGES bluez bluez-tools&quot;</span><br><span class="line">        # 设置桌面背景图片</span><br><span class="line">        ln -sf /usr/share/xfce4/backdrops/lubancat-wallpaper.png /usr/share/xfce4/backdrops/xubuntu-wallpaper.png</span><br><span class="line">        ;;</span><br><span class="line">    lite)</span><br><span class="line">        PACKAGES=&quot;$PACKAGES bluez bluez-tools&quot;</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line">\$&#123;APT_INSTALL&#125; $PACKAGES</span><br><span class="line"></span><br><span class="line">\$&#123;APT_INSTALL&#125; /packages/install_packages/*.deb  # 安装指定的软件包</span><br><span class="line">\$&#123;APT_INSTALL&#125; /boot/kerneldeb/* || true  # 安装 Linux 内核相关的软件包</span><br><span class="line"></span><br><span class="line"># 电源管理相关设置</span><br><span class="line">echo -e &quot;\033[47;36m ----- power management ----- \033[0m&quot;</span><br><span class="line">\$&#123;APT_INSTALL&#125; pm-utils triggerhappy bsdmainutils</span><br><span class="line">cp /etc/Powermanager/triggerhappy.service  /lib/systemd/system/triggerhappy.service</span><br><span class="line">sed -i &quot;s/#HandlePowerKey=.*/HandlePowerKey=ignore/&quot; /etc/systemd/logind.conf</span><br><span class="line"></span><br><span class="line"># 安装 RGA 驱动</span><br><span class="line">echo -e &quot;\033[47;36m ----------- RGA  ----------- \033[0m&quot;</span><br><span class="line">\$&#123;APT_INSTALL&#125; /packages/rga2/*.deb</span><br><span class="line"></span><br><span class="line"># 配置视频相关的工具和插件</span><br><span class="line">echo -e &quot;\033[47;36m ------ Setup Video---------- \033[0m&quot;</span><br><span class="line">\$&#123;APT_INSTALL&#125; /packages/mpp/*</span><br><span class="line">\$&#123;APT_INSTALL&#125; /packages/gst-rkmpp/*.deb</span><br><span class="line">\$&#123;APT_INSTALL&#125; /packages/gstreamer/*.deb</span><br><span class="line"></span><br><span class="line"># 配置摄像头相关的工具</span><br><span class="line">echo -e &quot;\033[47;36m ----- Install Camera ----- - \033[0m&quot;</span><br><span class="line">\$&#123;APT_INSTALL&#125; cheese v4l-utils</span><br><span class="line">\$&#123;APT_INSTALL&#125; /packages/libv4l/*.deb</span><br><span class="line"></span><br><span class="line"># 安装 Xserver 相关的软件包</span><br><span class="line">case &quot;$TARGET&quot; in</span><br><span class="line">    gnome | gnome-full)</span><br><span class="line">        echo -e &quot;\033[47;36m ----- Install Xserver------- \033[0m&quot;</span><br><span class="line">        \$&#123;APT_INSTALL&#125; /packages/xserver/xserver-xorg-*.deb</span><br><span class="line">        apt-mark hold xserver-xorg-core xserver-xorg-legacy</span><br><span class="line">        ;;</span><br><span class="line">    xfce | xfce-full)</span><br><span class="line">        echo -e &quot;\033[47;36m ----- Install Xserver------- \033[0m&quot;</span><br><span class="line">        \$&#123;APT_INSTALL&#125; /packages/xserver/*.deb</span><br><span class="line">        apt-mark hold xserver-common xserver-xorg-core xserver-xorg-legacy</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line"># 更新 Chromium 浏览器</span><br><span class="line">echo -e &quot;\033[47;36m ------ update chromium ----- \033[0m&quot;</span><br><span class="line">\$&#123;APT_INSTALL&#125; /packages/chromium/*.deb</span><br><span class="line"></span><br><span class="line"># 安装 libdrm 和其他相关的软件包</span><br><span class="line">echo -e &quot;\033[47;36m ------- Install libdrm ------ \033[0m&quot;</span><br><span class="line">\$&#123;APT_INSTALL&#125; /packages/libdrm/*.deb</span><br><span class="line"></span><br><span class="line"># 安装 libdrm-cursor</span><br><span class="line">echo -e &quot;\033[47;36m ------ libdrm-cursor -------- \033[0m&quot;</span><br><span class="line">\$&#123;APT_INSTALL&#125; /packages/libdrm-cursor/*.deb</span><br><span class="line"></span><br><span class="line"># 安装 glmark2（仅在 debug 版本中）</span><br><span class="line"></span><br><span class="line">echo -e &quot;\033[47;36m ------ Install glmark2 ------ \033[0m&quot;</span><br><span class="line">\$&#123;APT_INSTALL&#125; glmark2-es2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 如果存在 aarch64 平台库，则移动 rknpu2 文件</span><br><span class="line">if [ -e &quot;/usr/lib/aarch64-linux-gnu&quot; ] ; then</span><br><span class="line">echo -e &quot;\033[47;36m ------- move rknpu2 --------- \033[0m&quot;</span><br><span class="line">mv /packages/rknpu2/*.tar  /</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 安装 rktoolkit 工具包</span><br><span class="line">echo -e &quot;\033[47;36m ----- Install rktoolkit ----- \033[0m&quot;</span><br><span class="line">\$&#123;APT_INSTALL&#125; /packages/rktoolkit/*.deb</span><br><span class="line"></span><br><span class="line"># 安装 ffmpeg（如果适用）</span><br><span class="line">if [[ &quot;$TARGET&quot; == &quot;gnome&quot; ||  &quot;$TARGET&quot; == &quot;xfce&quot; || &quot;$TARGET&quot; == &quot;gnome-full&quot; || &quot;$TARGET&quot; == &quot;xfce-full&quot; ]]; then</span><br><span class="line">    echo -e &quot;\033[47;36m ------ Install ffmpeg ------- \033[0m&quot;</span><br><span class="line">    \$&#123;APT_INSTALL&#125; ffmpeg</span><br><span class="line">    # \$&#123;APT_INSTALL&#125; /packages/ffmpeg/*.deb</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 安装 mpv 播放器</span><br><span class="line">echo -e &quot;\033[47;36m ------- Install mpv --------- \033[0m&quot;</span><br><span class="line">\apt-get -o Dpkg::Options::=&quot;--force-confdef&quot; -o Dpkg::Options::=&quot;--force-confold&quot; install -y /packages/mpv/*.deb</span><br><span class="line"></span><br><span class="line"># 自动移除不需要的软件包</span><br><span class="line">apt autoremove -y</span><br><span class="line"></span><br><span class="line"># 将所有可升级的软件包设置为 hold，防止自动升级</span><br><span class="line">apt list --upgradable | cut -d/ -f1 | xargs apt-mark hold</span><br><span class="line"></span><br><span class="line"># 自定义脚本的其他设置</span><br><span class="line">echo -e &quot;\033[47;36m ------- Custom Script ------- \033[0m&quot;</span><br><span class="line">systemctl mask systemd-networkd-wait-online.service</span><br><span class="line">systemctl mask NetworkManager-wait-online.service</span><br><span class="line">systemctl disable hostapd</span><br><span class="line">rm /lib/systemd/system/wpa_supplicant@.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 仅为 X 预加载 libdrm-cursor</span><br><span class="line">sed -i &quot;1aexport LD_PRELOAD=/usr/lib/aarch64-linux-gnu/libdrm-cursor.so.1&quot; /usr/bin/X</span><br><span class="line">cd /usr/lib/aarch64-linux-gnu/dri/</span><br><span class="line">cp kms_swrast_dri.so swrast_dri.so rockchip_dri.so /</span><br><span class="line">rm /usr/lib/aarch64-linux-gnu/dri/*.so</span><br><span class="line">mv /*.so /usr/lib/aarch64-linux-gnu/dri/</span><br><span class="line">rm /etc/profile.d/qt.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 删除不必要的目录和文件</span><br><span class="line">rm -rf /home/$(whoami)</span><br><span class="line">rm -rf /var/lib/apt/lists/*</span><br><span class="line">rm -rf /var/cache/</span><br><span class="line">rm -rf /packages/</span><br><span class="line">rm -rf /boot/*</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># 解除挂载目标根文件系统</span><br><span class="line">./ch-mount.sh -u $TARGET_ROOTFS_DIR</span><br><span class="line"></span><br><span class="line"># 调用 mk-image.sh 脚本生成镜像</span><br><span class="line">source ./mk-image.sh </span><br></pre></td></tr></table></figure>
<h2 id="优化1-2"><a class="markdownIt-Anchor" href="#优化1-2"></a> 优化1</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line">COPY#!/bin/bash -e</span><br><span class="line"></span><br><span class="line"># 使用 -e 参数，确保脚本在遇到错误时自动退出</span><br><span class="line">set -e -o pipefail</span><br><span class="line"></span><br><span class="line"># 检查并尝试获取 root 权限。如果当前用户不是 root，提示并重新执行脚本。</span><br><span class="line">if [[ &quot;$&#123;EUID&#125;&quot; != &quot;0&quot; ]]; then</span><br><span class="line">    echo -e &quot;\033[47;36m 该脚本需要 root 权限，正在尝试使用 sudo 重新运行 \033[0m&quot;</span><br><span class="line">    sudo &quot;$&#123;0&#125;&quot; &quot;$@&quot;</span><br><span class="line">    exit $?</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 定义日志文件路径并将所有输出同时重定向到日志文件和终端</span><br><span class="line">LOGFILE=&quot;/var/log/script.log&quot;</span><br><span class="line">exec &gt; &gt;(tee -i &quot;$LOGFILE&quot;) 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"># 选择 SOC 的函数，用于选择要构建的 SOC（系统芯片）</span><br><span class="line">select_soc() &#123;</span><br><span class="line">    while true; do</span><br><span class="line">        echo &quot;---------------------------------------------------------&quot;</span><br><span class="line">        echo &quot;请输入要构建CPU的序号:&quot;</span><br><span class="line">        echo &quot;[0] 退出&quot;</span><br><span class="line">        echo &quot;[1] rk3562&quot;</span><br><span class="line">        echo &quot;[2] rk3568&quot;</span><br><span class="line">        echo &quot;[3] rk3588/rk3588s&quot;</span><br><span class="line">        echo &quot;---------------------------------------------------------&quot;</span><br><span class="line">        read -p &quot;选择: &quot; input</span><br><span class="line"></span><br><span class="line">        case $input in</span><br><span class="line">            0) exit;;  # 退出</span><br><span class="line">            1) SOC=rk3562; break;;</span><br><span class="line">            2) SOC=rk356x; break;;</span><br><span class="line">            3) SOC=rk3588; break;;</span><br><span class="line">            *) echo &quot;无效输入，请重试。&quot;;;  # 输入错误提示</span><br><span class="line">        esac</span><br><span class="line">    done</span><br><span class="line">    echo -e &quot;\033[47;36m 设置 SOC=$SOC...... \033[0m&quot;</span><br><span class="line">    </span><br><span class="line">    # 设置默认架构为 arm64</span><br><span class="line">    ARCH=&quot;arm64&quot; &amp;&amp; echo -e &quot;\033[47;36m 设置默认 ARCH=arm64...... \033[0m&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 选择 TARGET 版本的函数，用于选择要构建的根文件系统版本</span><br><span class="line">select_target() &#123;</span><br><span class="line">    while true; do</span><br><span class="line">        echo &quot;---------------------------------------------------------&quot;</span><br><span class="line">        echo &quot;请输入要构建的根文件系统版本:&quot;</span><br><span class="line">        echo &quot;[0] 退出&quot;</span><br><span class="line">        echo &quot;[1] gnome&quot;</span><br><span class="line">        echo &quot;[2] xfce&quot;</span><br><span class="line">        echo &quot;[3] lite&quot;</span><br><span class="line">        echo &quot;---------------------------------------------------------&quot;</span><br><span class="line">        read -p &quot;选择: &quot; input</span><br><span class="line"></span><br><span class="line">        case $input in</span><br><span class="line">            0) exit;;  # 退出</span><br><span class="line">            1) TARGET=gnome; break;;</span><br><span class="line">            2) TARGET=xfce; break;;</span><br><span class="line">            3) TARGET=lite; break;;</span><br><span class="line">            *) echo &quot;无效输入，请重试。&quot;;;  # 输入错误提示</span><br><span class="line">        esac</span><br><span class="line">    done</span><br><span class="line">    echo -e &quot;\033[47;36m 设置 TARGET=$TARGET...... \033[0m&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 安装与 SOC 相关的软件包</span><br><span class="line">install_packages() &#123;</span><br><span class="line">    case $SOC in</span><br><span class="line">        rk3562)</span><br><span class="line">            MALI=bifrost-g52-g13p0</span><br><span class="line">            ISP=rkaiq_rk3562</span><br><span class="line">            ;;</span><br><span class="line">        rk356x)</span><br><span class="line">            MALI=bifrost-g52-g13p0</span><br><span class="line">            ISP=rkaiq_rk3568</span><br><span class="line">            ;;</span><br><span class="line">        rk3588)</span><br><span class="line">            MALI=valhall-g610-g13p0</span><br><span class="line">            ISP=rkaiq_rk3588</span><br><span class="line">            ;;</span><br><span class="line">    esac</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 定义一个重试命令的函数，如果命令执行失败，将重试最多3次</span><br><span class="line">retry_command() &#123;</span><br><span class="line">    local retries=3</span><br><span class="line">    local count=0</span><br><span class="line">    until &quot;$@&quot;; do</span><br><span class="line">        exit_code=$?</span><br><span class="line">        count=$((count + 1))</span><br><span class="line">        if [ $count -lt $retries ]; then</span><br><span class="line">            echo &quot;命令失败，正在重试 ($count/$retries)...&quot;</span><br><span class="line">            sleep 1</span><br><span class="line">        else</span><br><span class="line">            echo &quot;命令执行失败，退出。&quot;</span><br><span class="line">            return $exit_code</span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">    return 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 定义一个函数，用于挂载必要的文件系统到目标根文件系统</span><br><span class="line">mnt() &#123;</span><br><span class="line">    echo &quot;挂载文件系统...&quot;</span><br><span class="line">    mount -t proc /proc $&#123;1&#125;proc</span><br><span class="line">    mount -t sysfs /sys $&#123;1&#125;sys</span><br><span class="line">    mount -o bind /dev $&#123;1&#125;dev</span><br><span class="line">    mount -o bind /dev/pts $&#123;1&#125;dev/pts</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 定义一个函数，用于解除挂载文件系统</span><br><span class="line">umnt() &#123;</span><br><span class="line">    echo &quot;解除挂载文件系统...&quot;</span><br><span class="line">    umount $&#123;1&#125;proc || true</span><br><span class="line">    umount $&#123;1&#125;sys || true</span><br><span class="line">    umount $&#123;1&#125;dev/pts || true</span><br><span class="line">    umount $&#123;1&#125;dev || true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 检查并选择 SOC 和 TARGET，如果没有定义则调用选择函数</span><br><span class="line">[ -z &quot;$SOC&quot; ] &amp;&amp; select_soc</span><br><span class="line">[ -z &quot;$TARGET&quot; ] &amp;&amp; select_target</span><br><span class="line"></span><br><span class="line"># 设置默认版本，如果没有定义 VERSION 则默认设置为 &quot;release&quot;</span><br><span class="line">[ -z &quot;$VERSION&quot; ] &amp;&amp; VERSION=&quot;release&quot;</span><br><span class="line">echo -e &quot;\033[47;36m 正在构建 $VERSION 版本 \033[0m&quot;</span><br><span class="line"></span><br><span class="line"># 检查是否存在 Ubuntu 基础镜像，如果不存在则运行 mk-base-ubuntu.sh 构建基础系统</span><br><span class="line">if [ ! -e ubuntu-base-&quot;$TARGET&quot;-$ARCH-*.tar.xz ]; then</span><br><span class="line">    echo -e &quot;\033[41;36m 未存在基础包，运行 mk-base-ubuntu.sh 构建基本系统 \033[0m&quot;</span><br><span class="line">    ./mk-base-ubuntu.sh</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 定义一个清理函数，在脚本遇到错误时自动执行</span><br><span class="line">finish() &#123;</span><br><span class="line">    umnt $TARGET_ROOTFS_DIR</span><br><span class="line">    echo -e &quot;脚本执行失败。详情请查看 $LOGFILE。&quot;</span><br><span class="line">    exit 1</span><br><span class="line">&#125;</span><br><span class="line">trap finish ERR  # 捕捉错误并调用 finish 函数</span><br><span class="line"></span><br><span class="line"># 解压基础镜像</span><br><span class="line">echo -e &quot;\033[47;36m 解压基础镜像 \033[0m&quot;</span><br><span class="line">rm -rf $TARGET_ROOTFS_DIR  # 删除目标目录</span><br><span class="line">tar -xf ubuntu-base-$TARGET-$ARCH-*.tar.xz  # 解压基础镜像</span><br><span class="line"></span><br><span class="line"># 创建 packages 目录并复制内容到目标根文件系统</span><br><span class="line">mkdir -p $TARGET_ROOTFS_DIR/packages</span><br><span class="line">retry_command cp -rpf packages/$ARCH/* $TARGET_ROOTFS_DIR/packages</span><br><span class="line"></span><br><span class="line"># 调用 install_packages 函数并复制相关软件包</span><br><span class="line">install_packages</span><br><span class="line">mkdir -p $TARGET_ROOTFS_DIR/packages/install_packages</span><br><span class="line">retry_command cp -rpf packages/$ARCH/libmali/libmali-*$MALI*-x11*.deb $TARGET_ROOTFS_DIR/packages/install_packages</span><br><span class="line">retry_command cp -rpf packages/$ARCH/$&#123;ISP:0:5&#125;/camera_engine_$ISP*.deb $TARGET_ROOTFS_DIR/packages/install_packages</span><br><span class="line"></span><br><span class="line"># 处理内核文件，如果存在内核相关的 deb 包，将其复制到目标根文件系统</span><br><span class="line">if [ -e ../linux-headers* ]; then</span><br><span class="line">    Image_Deb=$(basename ../linux-headers*)</span><br><span class="line">    mkdir -p $TARGET_ROOTFS_DIR/boot/kerneldeb</span><br><span class="line">    touch $TARGET_ROOTFS_DIR/boot/build-host</span><br><span class="line">    retry_command cp -vrpf ../$&#123;Image_Deb&#125; $TARGET_ROOTFS_DIR/boot/kerneldeb</span><br><span class="line">    retry_command cp -vrpf ../$&#123;Image_Deb/headers/image&#125; $TARGET_ROOTFS_DIR/boot/kerneldeb</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 复制 overlay 和 overlay-firmware 文件夹的内容到目标根文件系统</span><br><span class="line">retry_command cp -rpf overlay/* $TARGET_ROOTFS_DIR/</span><br><span class="line">retry_command cp -rpf overlay-firmware/* $TARGET_ROOTFS_DIR/</span><br><span class="line"></span><br><span class="line"># 如果是 debug 版本，则复制 overlay-debug 文件夹的内容到目标根文件系统</span><br><span class="line">if [ &quot;$VERSION&quot; == &quot;debug&quot; ]; then</span><br><span class="line">    retry_command cp -rpf overlay-debug/* $TARGET_ROOTFS_DIR/</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 修复串口配置</span><br><span class="line">retry_command cp -f overlay/usr/lib/systemd/system/serial-getty@.service $TARGET_ROOTFS_DIR/lib/systemd/system/serial-getty@.service</span><br><span class="line"></span><br><span class="line"># 复制 qemu 可执行文件并挂载根文件系统</span><br><span class="line">echo -e &quot;\033[47;36m 切换到根目录...... \033[0m&quot;</span><br><span class="line">cp /usr/bin/qemu-aarch64-static $TARGET_ROOTFS_DIR/usr/bin/</span><br><span class="line">mnt $TARGET_ROOTFS_DIR</span><br><span class="line"></span><br><span class="line"># 获取目标根文件系统的所有者 ID，用于后续修复权限</span><br><span class="line">ID=$(stat --format %u $TARGET_ROOTFS_DIR)</span><br><span class="line"></span><br><span class="line"># 进入 chroot 环境并执行安装和配置</span><br><span class="line">cat &lt;&lt; EOF | chroot $TARGET_ROOTFS_DIR</span><br><span class="line">    # 修复文件所有者为 root</span><br><span class="line">    if [ &quot;$ID&quot; -ne 0 ]; then</span><br><span class="line">        find / -user $ID -exec chown -h 0:0 &#123;&#125; \;</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    # 修复用户目录的权限</span><br><span class="line">    for u in \$(ls /home/); do</span><br><span class="line">        chown -h -R \$u:\$u /home/\$u</span><br><span class="line">    done</span><br><span class="line"></span><br><span class="line">    # 设置语言环境为 UTF-8</span><br><span class="line">    export LC_ALL=C.UTF-8</span><br><span class="line"></span><br><span class="line">    # 更新并升级系统包</span><br><span class="line">    apt-get update &amp;&amp; apt-get upgrade -y</span><br><span class="line"></span><br><span class="line">    # 修复权限问题</span><br><span class="line">    chmod o+x /usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">    chmod +x /etc/rc.local</span><br><span class="line"></span><br><span class="line">    # 设置非交互模式安装软件包</span><br><span class="line">    export DEBIAN_FRONTEND=noninteractive</span><br><span class="line">    export APT_INSTALL=&quot;apt-get install -fy --allow-downgrades&quot;</span><br><span class="line">    </span><br><span class="line">    \$&#123;APT_INSTALL&#125; /packages/install_packages/*.deb</span><br><span class="line">    \$&#123;APT_INSTALL&#125; /boot/kerneldeb/* || true</span><br><span class="line">    apt autoremove -y</span><br><span class="line">    apt list --upgradable | cut -d/ -f1 | xargs apt-mark hold</span><br><span class="line"></span><br><span class="line">    systemctl mask systemd-networkd-wait-online.service</span><br><span class="line">    systemctl mask NetworkManager-wait-online.service</span><br><span class="line">    systemctl disable hostapd</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># 解除挂载根文件系统</span><br><span class="line">umnt -u $TARGET_ROOTFS_DIR</span><br><span class="line"></span><br><span class="line"># 调用 mk-image.sh 脚本生成镜像</span><br><span class="line">source ./mk-image.sh</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-06_工作记录/27_工作记录(九月第一个星期)"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/09/01/06_%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/27_%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95(%E4%B9%9D%E6%9C%88%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%98%9F%E6%9C%9F)/"
    >工作记录(九月第一个星期)</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/09/01/06_%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/27_%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95(%E4%B9%9D%E6%9C%88%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%98%9F%E6%9C%9F)/" class="article-date">
  <time datetime="2024-09-01T13:26:56.000Z" itemprop="datePublished">2024-09-01</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/">工作记录</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="95工作记录星期四"><a class="markdownIt-Anchor" href="#95工作记录星期四"></a> 9.5工作记录(星期四)</h1>
<p>==摆脱一份幻觉，比发现一个真理更能使人明智==</p>
<p>==当你在凝视深渊的时候，深渊也在凝视你==</p>
<p>==我希望用一生的时间，不断深入和学习电子计算机相关的全部知识，将其整理成==</p>
<hr />
<p>问题真的太大了，因为这个问题，都犯过了很多次错误了，这肯定是不对的，是吗，之前几次因为这种事情，而导致东西丢失，内容丢失，最终形成了当前这种局面，我想说的不是因为犯错了，以后就不再做这些事情了，而是要记得反思自己，这次做错了，下次就不做了呗，每次都这样，。</p>
<p>行了，改变了一些东西，使用上了百度网盘，这些问题应该会少很多，然后家里再来一个同步，这样肯定就好多了，也算是因祸得福，至于移动硬盘就先这样了，目前是没啥用了，这样摇摇晃晃的就两点了~，该研究具体的代码了。</p>
<blockquote>
<p>桌面topeet 自动登录</p>
<p>​	echo -e “\n[SeatDefaults]\nautologin-user=topeet\nautologin-user-timeout=0” &gt;&gt; /etc/lightdm/lightdm.conf</p>
<p>终端自动登录root</p>
<p>​	sed -i ‘s|^ExecStart=.*|ExecStart=-/sbin/agetty --autologin root --noclear %I $TERM|’ /usr/lib/systemd/system/serial-getty@.service、</p>
</blockquote>
<p>设置自动登录和非自动登录：serial_autologin.sh</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">定义服务文件路径</span></span><br><span class="line">SERVICE_FILE=&quot;/usr/lib/systemd/system/serial-getty@.service&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">自动登录的ExecStart命令</span></span><br><span class="line">AUTLOGIN_CMD=&quot;ExecStart=-/sbin/agetty --autologin root --noclear %I \$TERM&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁用自动登录的默认ExecStart命令</span></span><br><span class="line">DEFAULT_CMD=&quot;ExecStart=-/sbin/agetty -o &#x27;-p -- \\\\u&#x27; --keep-baud 115200,57600,38400,9600 %I \$TERM&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启用自动登录的函数</span></span><br><span class="line">function enable_autologin() &#123;</span><br><span class="line">    echo &quot;正在启用串口终端自动登录...&quot;</span><br><span class="line">    sudo sed -i &quot;s|^ExecStart=.*|$AUTLOGIN_CMD|&quot; &quot;$SERVICE_FILE&quot;</span><br><span class="line">    sudo systemctl daemon-reload</span><br><span class="line">    echo &quot;自动登录已启用。&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁用自动登录的函数，恢复默认设置</span></span><br><span class="line">function disable_autologin() &#123;</span><br><span class="line">    echo &quot;正在禁用串口终端自动登录...&quot;</span><br><span class="line">    sudo sed -i &quot;s|^ExecStart=.*|$DEFAULT_CMD|&quot; &quot;$SERVICE_FILE&quot;</span><br><span class="line">    sudo systemctl daemon-reload</span><br><span class="line">    echo &quot;自动登录已禁用。&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查当前配置状态的函数</span></span><br><span class="line">function check_status() &#123;</span><br><span class="line">    if grep -q &quot;$AUTLOGIN_CMD&quot; &quot;$SERVICE_FILE&quot;; then</span><br><span class="line">        echo &quot;自动登录当前已启用。&quot;</span><br><span class="line">    elif grep -q &quot;$DEFAULT_CMD&quot; &quot;$SERVICE_FILE&quot;; then</span><br><span class="line">        echo &quot;自动登录当前已禁用。&quot;</span><br><span class="line">    else</span><br><span class="line">        echo &quot;自动登录状态未知。&quot;</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查传递的参数，根据参数执行相应操作</span></span><br><span class="line">if [ &quot;$1&quot; == &quot;enable&quot; ]; then</span><br><span class="line">    enable_autologin</span><br><span class="line">elif [ &quot;$1&quot; == &quot;disable&quot; ]; then</span><br><span class="line">    disable_autologin</span><br><span class="line">elif [ &quot;$1&quot; == &quot;status&quot; ]; then</span><br><span class="line">    check_status</span><br><span class="line">else</span><br><span class="line">    echo &quot;用法: $0 &#123;enable|disable|status&#125;&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>设置终端颜色</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置 LS_COLORS 和 <span class="built_in">alias</span> <span class="built_in">ls</span> 的函数</span></span><br><span class="line">setup_ls_colors() &#123;</span><br><span class="line">    local user_bashrc=$1</span><br><span class="line"></span><br><span class="line">    # 向用户的 .bashrc 文件中追加 alias 和 LS_COLORS 设置</span><br><span class="line">    echo &quot;alias ls=&#x27;ls --color=auto&#x27;&quot; &gt;&gt; &quot;$user_bashrc&quot;</span><br><span class="line">    echo &quot;export LS_COLORS=&#x27;rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:&#x27;&quot; &gt;&gt; &quot;$user_bashrc&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">为 root 用户设置</span></span><br><span class="line">setup_ls_colors /root/.bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">为 topeet 用户设置</span></span><br><span class="line">setup_ls_colors /home/topeet/.bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">提示完成</span></span><br><span class="line">echo &quot;ls 颜色配置已完成&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取设备的 BOARD 值</span></span><br><span class="line">BOARD=$(cat /proc/device-tree/compatible | tail -c 7 | head -c 6)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据 BOARD 值执行相应的命令</span></span><br><span class="line">if [ &quot;$BOARD&quot; == &quot;rk3588&quot; ]; then</span><br><span class="line">    # 针对 rk3588 的命令</span><br><span class="line">    toilet -f standard -F metal $(echo iTOP-RK3588)</span><br><span class="line">    echo performance &gt; /sys/devices/system/cpu/cpufreq/policy0/scaling_governor</span><br><span class="line">    echo performance &gt; /sys/devices/system/cpu/cpufreq/policy4/scaling_governor</span><br><span class="line">    echo performance &gt; /sys/devices/system/cpu/cpufreq/policy6/scaling_governor</span><br><span class="line">    echo performance &gt; /sys/devices/platform/fb000000.gpu/devfreq/fb000000.gpu/governor</span><br><span class="line"></span><br><span class="line">elif [ &quot;$BOARD&quot; == &quot;rk3568&quot; ]; then</span><br><span class="line">    # 针对 rk3568 的命令</span><br><span class="line">    toilet -f standard -F metal $(echo iTOP-RK3568)</span><br><span class="line">    echo performance &gt; /sys/devices/system/cpu/cpufreq/policy0/scaling_governor</span><br><span class="line">    echo performance &gt; /sys/devices/platform/fde60000.gpu/devfreq/fde60000.gpu/governor</span><br><span class="line"></span><br><span class="line">elif [ &quot;$BOARD&quot; == &quot;rk3562&quot; ]; then</span><br><span class="line">    # 针对 rk3562 的命令</span><br><span class="line">    toilet -f standard -F metal $(echo iTOP-RK3562)</span><br><span class="line">    echo performance &gt; /sys/devices/system/cpu/cpufreq/policy0/scaling_governor</span><br><span class="line">    echo performance &gt; /sys/devices/platform/ff320000.gpu/devfreq/ff320000.gpu/governor</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">    echo &quot;未知的 BOARD 值: $BOARD&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>取消广告</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt purge -y gnome-initial-setup</span><br></pre></td></tr></table></figure>
<h1 id="96工作日志星期五"><a class="markdownIt-Anchor" href="#96工作日志星期五"></a> 9.6工作日志(星期五)</h1>
<pre><code>你提供的 `.repo` 文件描述了多个 Git 仓库的配置信息，使用 `repo` 工具来管理多个 Git 仓库。要将这个 `.repo` 文件转换为 Git 命令，意味着你要手动克隆每个项目，并在适当的路径下检出特定的分支或版本。
</code></pre>
<p>以下是将 <code>.repo</code> 文件内容转换为一系列 Git 命令的步骤：</p>
<h3 id="1-克隆每个项目到指定的路径"><a class="markdownIt-Anchor" href="#1-克隆每个项目到指定的路径"></a> 1. 克隆每个项目到指定的路径</h3>
<p>根据 <code>.repo</code> 文件中的 <code>project</code> 条目，将它们转换为 <code>git clone</code> 命令。</p>
<h3 id="git-命令列表"><a class="markdownIt-Anchor" href="#git-命令列表"></a> Git 命令列表：</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 克隆 u-boot 仓库到 u-boot 目录</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:chai0705/u-boot.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆 kernel 仓库到 kernel 目录</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:chai0705/kernel.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆 rkbin 仓库到 rkbin 目录</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:chai0705/rkbin.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆 initrd 仓库到 initrd 目录</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:chai0705/initrd.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆 gcc-arm 编译器到指定目录</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:chai0705/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆 device_rockchip 仓库到 device/rockchip 目录</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:chai0705/device_rockchip.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆 tools 仓库，指定 commit ID</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:chai0705/tools.git</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p prebuilts/gcc/linux-x86/aarch64</span><br><span class="line"><span class="built_in">mv</span> gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu prebuilts/gcc/linux-x86/aarch64</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p device/</span><br><span class="line"><span class="built_in">mv</span> device_rockchip device/rockchip</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-创建符号链接linkfile"><a class="markdownIt-Anchor" href="#2-创建符号链接linkfile"></a> 2. 创建符号链接（linkfile）</h3>
<p><code>.repo</code> 文件中的 <code>linkfile</code> 是表示在多个项目间创建符号链接。你可以使用 <code>ln -s</code> 命令来手动创建这些符号链接。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 device_rockchip 目录下创建符号链接</span></span><br><span class="line"><span class="built_in">ln</span> -s device/rockchip/common/mkfirmware.sh mkfirmware.sh</span><br><span class="line"><span class="built_in">ln</span> -s device/rockchip/common/build.sh build.sh</span><br><span class="line"><span class="built_in">ln</span> -s device/rockchip/common/rkflash.sh rkflash.sh</span><br><span class="line"><span class="built_in">ln</span> -s rk3588 device/rockchip/.target_product</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 tools/windows 目录下创建符号链接</span></span><br><span class="line"><span class="built_in">ln</span> -s tools/windows/RKDevTool/RKDevTool_Release/rk3588-config.cfg tools/windows/RKDevTool/RKDevTool_Release/config.cfg</span><br><span class="line"><span class="built_in">ln</span> -s tools/windows/RKDevTool/rockdev/rk3588-package-file tools/windows/RKDevTool/rockdev/package-file</span><br><span class="line"><span class="built_in">ln</span> -s tools/windows/RKDevTool/rockdev/rk3588-mkupdate.bat tools/windows/RKDevTool/rockdev/mkupdate.bat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 tools/linux 目录下创建符号链接</span></span><br><span class="line"><span class="built_in">ln</span> -s tools/linux/Linux_Pack_Firmware/rockdev/rk3588-mkupdate.sh tools/linux/Linux_Pack_Firmware/rockdev/mkupdate.sh</span><br><span class="line"><span class="built_in">ln</span> -s tools/linux/Linux_Pack_Firmware/rockdev/rk3588-package-file tools/linux/Linux_Pack_Firmware/rockdev/package-file</span><br></pre></td></tr></table></figure>
<hr />
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/2/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2024
        <i class="ri-heart-fill heart_icon"></i> chai
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="热爱学习的未来酱"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E7%94%9F%E6%B4%BB">生活</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E7%91%9E%E8%8A%AF%E5%BE%AE">瑞芯微</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/Linux%E5%AD%A6%E4%B9%A0">Linux学习</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E8%AF%BB%E4%B9%A6">读书</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/C%E8%AF%AD%E8%A8%80%E9%AB%98%E7%BA%A7%E5%AD%A6%E4%B9%A0">C语言高级学习</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95">工作记录</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7">小技巧</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/shell%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0">shell编程学习</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/PCB%E5%AD%A6%E4%B9%A0">PCB学习</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0">音视频学习</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->

<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=22707008&auto=0&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    

  </div>
</body>

</html>