<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta name="description" content="永远年轻，永远热泪盈眶" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> 热爱学习的未来酱</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <link rel="alternate" href="/atom.xml" title="热爱学习的未来酱" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/1.png" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">热爱学习的未来酱</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['我希望用一生的时间不断学习和深入电子计算机相关的一切知识，并将其整理成网络，分享出来，与更多志同道合的朋友一起进步', '无论你最终要成为一个怎样的人，千万要记住，时间在飞逝。', ''],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  <article class="articles">
    
    
    
    
    <article
  id="post-02_瑞芯微/20_野火配置脚本学习"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/08/31/02_%E7%91%9E%E8%8A%AF%E5%BE%AE/20_%E9%87%8E%E7%81%AB%E9%85%8D%E7%BD%AE%E8%84%9A%E6%9C%AC%E5%AD%A6%E4%B9%A0/"
    >野火配置脚本学习</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/08/31/02_%E7%91%9E%E8%8A%AF%E5%BE%AE/20_%E9%87%8E%E7%81%AB%E9%85%8D%E7%BD%AE%E8%84%9A%E6%9C%AC%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time datetime="2024-08-31T09:17:03.000Z" itemprop="datePublished">2024-08-31</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%91%9E%E8%8A%AF%E5%BE%AE/">瑞芯微</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="函数内容解析"><a class="markdownIt-Anchor" href="#函数内容解析"></a> 函数内容解析</h1>
<h2 id="board_info函数"><a class="markdownIt-Anchor" href="#board_info函数"></a> board_info函数</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">COPYboard_info() &#123;</span><br><span class="line">    case $1 in</span><br><span class="line">        # 如果输入参数为 &#x27;0000&#x27;</span><br><span class="line">        0000)</span><br><span class="line">            # 设置板子的名称为 &#x27;LubanCat-1&#x27;</span><br><span class="line">            BOARD_NAME=&#x27;LubanCat-1&#x27;</span><br><span class="line">            # 设置设备树二进制文件名称</span><br><span class="line">            BOARD_DTB=&#x27;rk3566-lubancat-1.dtb&#x27;</span><br><span class="line">            # 设置环境变量文件名称</span><br><span class="line">            UENV_TXT=&#x27;uEnvLubanCat1.txt&#x27;</span><br><span class="line">            # 设置CPU类型</span><br><span class="line">            BOARD_CPU=&#x27;rk3566&#x27;</span><br><span class="line">            # 设置板子的描述信息</span><br><span class="line">            BOARD_MESSAGE=&quot;LubanCat-1是野火科技推出的基于RockChip-RK3566设计的一款低功耗、高性能单板电脑，保留了完善的硬件资源，充分考虑了用户的使用需求，在成本优化的同时，引出了尽可能多的外设功能。\n\n\</span><br><span class="line">BOARD_NAME : $BOARD_NAME\n\</span><br><span class="line">BOARD_DTB : $BOARD_DTB\n\</span><br><span class="line">UENV_TXT : $UENV_TXT\n\</span><br><span class="line">BOARD_CPU : $BOARD_CPU\n\</span><br><span class="line">            &quot;</span><br><span class="line">            ;;</span><br><span class="line">        # 如果输入参数为 &#x27;0100&#x27;</span><br><span class="line">        0100)</span><br><span class="line">            BOARD_NAME=&#x27;LubanCat-1N&#x27;</span><br><span class="line">            BOARD_DTB=&#x27;rk3566-lubancat-1n.dtb&#x27;</span><br><span class="line">            UENV_TXT=&#x27;uEnvLubanCat1N.txt&#x27;</span><br><span class="line">            BOARD_CPU=&#x27;rk3566&#x27;</span><br><span class="line">            BOARD_MESSAGE=&quot;LubanCat-1N是野火科技推出的基于RockChip RK3566设计的一款低功耗、高性能单板电脑， 保留了完善的硬件资源，充分考虑了用户的使用需求，在成本优化的同时，引出了尽可能多的外设功能\n\n\</span><br><span class="line">BOARD_NAME : $BOARD_NAME\n\</span><br><span class="line">BOARD_DTB : $BOARD_DTB\n\</span><br><span class="line">UENV_TXT : $UENV_TXT\n\</span><br><span class="line">BOARD_CPU : $BOARD_CPU\n\</span><br><span class="line">            &quot;</span><br><span class="line">            ;;</span><br><span class="line">        # 如果输入参数为 &#x27;0200&#x27;</span><br><span class="line">        0200)</span><br><span class="line">            BOARD_NAME=&#x27;LubanCat-0N&#x27;</span><br><span class="line">            BOARD_DTB=&#x27;rk3566-lubancat-0.dtb&#x27;</span><br><span class="line">            UENV_TXT=&#x27;uEnvLubanCatZN.txt&#x27;</span><br><span class="line">            BOARD_CPU=&#x27;rk3566&#x27;</span><br><span class="line">            BOARD_MESSAGE=&quot;LubanCat-Zero 是野火科技推出的基于RockChip RK3566设计的一款低功耗、高性能Mini板卡， 在保留的硬件资源优中选优，充分考虑了用户的使用需求，极致成本优化，保留核心功能\n\n\</span><br><span class="line">BOARD_NAME : $BOARD_NAME\n\</span><br><span class="line">BOARD_DTB : $BOARD_DTB\n\</span><br><span class="line">UENV_TXT : $UENV_TXT\n\</span><br><span class="line">BOARD_CPU : $BOARD_CPU\n\</span><br><span class="line">            &quot;</span><br><span class="line">            ;;</span><br><span class="line">        # 如果输入参数为 &#x27;0300&#x27;</span><br><span class="line">        0300)</span><br><span class="line">            BOARD_NAME=&#x27;LubanCat-0W&#x27;</span><br><span class="line">            BOARD_DTB=&#x27;rk3566-lubancat-0.dtb&#x27;</span><br><span class="line">            UENV_TXT=&#x27;uEnvLubanCatZW.txt&#x27;</span><br><span class="line">            BOARD_CPU=&#x27;rk3566&#x27;</span><br><span class="line">            BOARD_MESSAGE=&quot;LubanCat-Zero 是野火科技推出的基于RockChip RK3566设计的一款低功耗、高性能Mini板卡， 在保留的硬件资源优中选优，充分考虑了用户的使用需求，极致成本优化，保留核心功能\n\n\</span><br><span class="line">BOARD_NAME : $BOARD_NAME\n\</span><br><span class="line">BOARD_DTB : $BOARD_DTB\n\</span><br><span class="line">UENV_TXT : $UENV_TXT\n\</span><br><span class="line">BOARD_CPU : $BOARD_CPU\n\</span><br><span class="line">            &quot;</span><br><span class="line">            ;;</span><br><span class="line">        # 如果输入参数为 &#x27;0400&#x27;</span><br><span class="line">        0400)</span><br><span class="line">            BOARD_NAME=&#x27;LubanCat-2&#x27;</span><br><span class="line">            BOARD_DTB=&#x27;rk3568-lubancat-2.dtb&#x27;</span><br><span class="line">            UENV_TXT=&#x27;uEnvLubanCat2.txt&#x27;</span><br><span class="line">            BOARD_CPU=&#x27;rk3568&#x27;</span><br><span class="line">            BOARD_MESSAGE=&quot;LubanCat-2是野火科技基于RockChip RK3568设计的一款低功耗、高性能单板电脑,在引出高使用率较高接口的同时删减了部分使用率较低的接口和外设， 使板卡面积显著减小，而预留的USB、MINI PCI-E、M.2等通用接口，又进一步扩大了板卡的使用场景， 小小身躯也能迸发出极大的性能\n\n\</span><br><span class="line">BOARD_NAME : $BOARD_NAME\n\</span><br><span class="line">BOARD_DTB : $BOARD_DTB\n\</span><br><span class="line">UENV_TXT : $UENV_TXT\n\</span><br><span class="line">BOARD_CPU : $BOARD_CPU\n\</span><br><span class="line">            &quot;</span><br><span class="line">            ;;</span><br><span class="line">        # 如果输入参数为 &#x27;0402&#x27;</span><br><span class="line">        0402)</span><br><span class="line">            BOARD_NAME=&#x27;LubanCat-2-V1&#x27;</span><br><span class="line">            BOARD_DTB=&#x27;rk3568-lubancat-2-v1.dtb&#x27;</span><br><span class="line">            UENV_TXT=&#x27;uEnvLubanCat2-V1.txt&#x27;</span><br><span class="line">            BOARD_CPU=&#x27;rk3568&#x27;</span><br><span class="line">            BOARD_MESSAGE=&quot;LubanCat-2(V1)是野火科技基于RockChip RK3568设计的一款低功耗、高性能单板电脑,在引出高使用率较高接口的同时删减了部分使用率较低的接口和外设， 使板卡面积显著减小，而预留的USB、MINI PCI-E、M.2等通用接口，又进一步扩大了板卡的使用场景， 小小身躯也能迸发出极大的性能,与原版本改进了休眠唤醒的功能\n\n\</span><br><span class="line">BOARD_NAME : $BOARD_NAME\n\</span><br><span class="line">BOARD_DTB : $BOARD_DTB\n\</span><br><span class="line">UENV_TXT : $UENV_TXT\n\</span><br><span class="line">BOARD_CPU : $BOARD_CPU\n\</span><br><span class="line">            &quot;</span><br><span class="line">            ;;</span><br><span class="line">        # 如果输入参数为 &#x27;0403&#x27;</span><br><span class="line">        0403)</span><br><span class="line">            BOARD_NAME=&#x27;LubanCat-2-V2&#x27;</span><br><span class="line">            BOARD_DTB=&#x27;rk3568-lubancat-2-v2.dtb&#x27;</span><br><span class="line">            UENV_TXT=&#x27;uEnvLubanCat2-V2.txt&#x27;</span><br><span class="line">            BOARD_CPU=&#x27;rk3568&#x27;</span><br><span class="line">            BOARD_MESSAGE=&quot;LubanCat-2-V2是野火科技基于RockChip RK3568设计的一款低功耗、高性能单板电脑,在引出高使用率较高接口的同时删减了部分使用率较低的接口和外设， 使板卡面积显著减小，而预留的USB、MINI PCI-E、M.2等通用接口，又进一步扩大了板卡的使用场景， 小小身躯也能迸发出极大的性能,与原版本改进了休眠唤醒的功能\n\n\</span><br><span class="line">BOARD_NAME : $BOARD_NAME\n\</span><br><span class="line">BOARD_DTB : $BOARD_DTB\n\</span><br><span class="line">UENV_TXT : $UENV_TXT\n\</span><br><span class="line">BOARD_CPU : $BOARD_CPU\n\</span><br><span class="line">            &quot;</span><br><span class="line">            ;;</span><br><span class="line">        # 如果输入参数为 &#x27;0500&#x27; 或 &#x27;0600&#x27;</span><br><span class="line">        0500 |\</span><br><span class="line">        0600)</span><br><span class="line">            BOARD_NAME=&#x27;LubanCat-2N&#x27;</span><br><span class="line">            BOARD_DTB=&#x27;rk3568-lubancat-2n.dtb&#x27;</span><br><span class="line">            UENV_TXT=&#x27;uEnvLubanCat2N.txt&#x27;</span><br><span class="line">            BOARD_CPU=&#x27;rk3568&#x27;</span><br><span class="line">            BOARD_MESSAGE=&quot;LubanCat-2N是野火科技基于RockChip RK3568设计的一款低功耗、高性能单板电脑,在引出高使用率较高接口的同时删减了部分使用率较低的接口和外设， 使板卡面积显著减小，而预留的USB、MINI PCI-E、M.2等通用接口，又进一步扩大了板卡的使用场景， 小小身躯也能迸发出极大的性能\n\n\</span><br><span class="line">BOARD_NAME : $BOARD_NAME\n\</span><br><span class="line">BOARD_DTB : $BOARD_DTB\n\</span><br><span class="line">UENV_TXT : $UENV_TXT\n\</span><br><span class="line">BOARD_CPU : $BOARD_CPU\n\</span><br><span class="line">            &quot;</span><br><span class="line">            ;;</span><br><span class="line">        # 如果输入参数为 &#x27;0700&#x27;</span><br><span class="line">        0700)</span><br><span class="line">            BOARD_NAME=&#x27;LubanCat-2IO&#x27;</span><br><span class="line">            BOARD_DTB=&#x27;rk3568-lubancat-2io.dtb&#x27;</span><br><span class="line">            UENV_TXT=&#x27;uEnvLubanCat2IO.txt&#x27;</span><br><span class="line">            BOARD_CPU=&#x27;rk3568&#x27;</span><br><span class="line">            BOARD_MESSAGE=&quot;LubanCat-2IO 是野火科技推出的基于RockChip RK3566设计的一款低功耗、高性能单板电脑， 保留了完善的硬件资源，充分考虑了用户的使用需求，在成本优化的同时，引出了尽可能多的外设功能\n\n\</span><br><span class="line">BOARD_NAME : $BOARD_NAME\n\</span><br><span class="line">BOARD_DTB : $BOARD_DTB\n\</span><br><span class="line">UENV_TXT : $UENV_TXT\n\</span><br><span class="line">BOARD_CPU : $BOARD_CPU\n\</span><br><span class="line">            &quot;</span><br><span class="line">            ;;</span><br><span class="line">    esac</span><br><span class="line"></span><br><span class="line">    # 将选择的板子信息输出到调试文件中</span><br><span class="line">    echo &quot;BOARD_NAME:&quot;$BOARD_NAME &gt;&gt; $debug_file</span><br><span class="line">    echo &quot;BOARD_DTB:&quot;$BOARD_DTB &gt;&gt; $debug_file</span><br><span class="line">    echo &quot;UENV_TXT:&quot;$UENV_TXT &gt;&gt; $debug_file</span><br><span class="line">    echo &quot;BOARD_CPU:&quot;$BOARD_CPU &gt;&gt; $debug_file</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="详细解析"><a class="markdownIt-Anchor" href="#详细解析"></a> 详细解析</h3>
<ol>
<li>
<p><strong><code>board_info()</code> 函数</strong>: 这个函数用于根据输入的参数选择不同的板卡配置。每个配置都包括板卡的名称、设备树二进制文件、环境变量文件名和CPU类型。</p>
</li>
<li>
<p><strong><code>case $1 in</code> 语句</strong>: 根据传入的参数 <code>$1</code>，执行不同的分支。不同的参数值代表不同的板卡类型。</p>
</li>
<li>
<p>各个分支的设置</p>
<p>:</p>
<ul>
<li>每个分支代表一种特定型号的板卡。</li>
<li>在每个分支中，设置对应板卡的名称 (<code>BOARD_NAME</code>)、设备树文件 (<code>BOARD_DTB</code>)、环境变量文件 (<code>UENV_TXT</code>)、CPU类型 (<code>BOARD_CPU</code>) 以及相关描述信息 (<code>BOARD_MESSAGE</code>)。</li>
</ul>
</li>
<li>
<p><strong>调试信息输出</strong>: 函数的最后，选择的板卡信息会被写入到 <code>debug_file</code> 中，方便调试和日志记录。</p>
</li>
</ol>
<h3 id="用法"><a class="markdownIt-Anchor" href="#用法"></a> 用法</h3>
<p>当你需要根据不同的板卡选择配置时，只需调用 <code>board_info()</code> 函数，并传入相应的参数（如 <code>0000</code>、<code>0100</code> 等），函数会自动设置对应的配置，并输出调试信息到文件中。</p>
<h2 id="函数get_index"><a class="markdownIt-Anchor" href="#函数get_index"></a> 函数get_index</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">COPYget_index()&#123;</span><br><span class="line">    # 接收第一个参数作为ADC的原始值</span><br><span class="line">    ADC_RAW=$1</span><br><span class="line">    # 初始化INDEX变量为0xff，表示一个默认的无效值</span><br><span class="line">    INDEX=0xff</span><br><span class="line"></span><br><span class="line">    # 判断全局变量ADC_voltage_scale是否大于1</span><br><span class="line">    if [ $(echo &quot;$ADC_voltage_scale &gt; 1&quot; | bc) -eq 1 ] ; then</span><br><span class="line">        # 如果大于1，设置一组ADC索引数组，表示较低的电压范围</span><br><span class="line">        declare -a ADC_INDEX=(229 344 460 595 732 858 975 1024)</span><br><span class="line">    else</span><br><span class="line">        # 如果小于等于1，设置另一组ADC索引数组，表示较高的电压范围</span><br><span class="line">        declare -a ADC_INDEX=(916 1376 1840 2380 2928 3432 3900 4096)</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    # 遍历索引数组中的每个元素</span><br><span class="line">    for i in 00 01 02 03 04 05 06 07; do</span><br><span class="line">        # 如果ADC的原始值小于当前索引数组中的值</span><br><span class="line">        if [ $ADC_RAW -lt $&#123;ADC_INDEX[$i]&#125; ]; then</span><br><span class="line">            # 将INDEX设置为当前的索引值</span><br><span class="line">            INDEX=$i</span><br><span class="line">            # 退出循环，因为已经找到对应的范围</span><br><span class="line">            break</span><br><span class="line">        fi	</span><br><span class="line">    done </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="详细解析-2"><a class="markdownIt-Anchor" href="#详细解析-2"></a> 详细解析</h3>
<ol>
<li>
<p><strong><code>get_index()</code> 函数</strong>: 这个函数的作用是根据传入的ADC原始值 <code>ADC_RAW</code>，计算并返回对应的索引值 <code>INDEX</code>。</p>
</li>
<li>
<p><strong><code>ADC_RAW=$1</code></strong>: 从函数的第一个参数中获取ADC的原始值。</p>
</li>
<li>
<p><strong><code>INDEX=0xff</code></strong>: 初始化索引值为0xff，通常用来表示一个无效或未定义的值。</p>
</li>
<li>
<p><code>if [ $(echo &quot;$ADC_voltage_scale &gt; 1&quot; | bc) -eq 1 ]</code></p>
<p>:</p>
<ul>
<li>这段代码判断一个全局变量 <code>ADC_voltage_scale</code> 是否大于1。</li>
<li>使用 <code>bc</code> 进行浮点数比较，如果 <code>ADC_voltage_scale</code> 大于1，则返回1，否则返回0。</li>
</ul>
</li>
<li>
<p><code>declare -a ADC_INDEX=...</code></p>
<p>:</p>
<ul>
<li>根据 <code>ADC_voltage_scale</code> 的值，选择不同的ADC索引范围。</li>
<li>这些索引值表示了ADC原始值和电压之间的对应关系。</li>
</ul>
</li>
<li>
<p><code>for i in 00 01 02 03 04 05 06 07</code></p>
<p>:</p>
<ul>
<li>遍历预定义的8个索引值，从00到07。</li>
</ul>
</li>
<li>
<p><code>if [ $ADC_RAW -lt $&#123;ADC_INDEX[$i]&#125; ]; then</code></p>
<p>:</p>
<ul>
<li>这部分代码检查 <code>ADC_RAW</code> 是否小于当前的 <code>ADC_INDEX</code> 值。</li>
<li>如果是，则设置 <code>INDEX</code> 为当前的索引值，并退出循环。</li>
</ul>
</li>
<li>
<p><strong><code>break</code></strong>: 一旦找到合适的索引范围，立即退出循环，不再继续检查后续的索引。</p>
</li>
</ol>
<h3 id="用法-2"><a class="markdownIt-Anchor" href="#用法-2"></a> 用法</h3>
<p>这个函数通常用于将ADC的原始值转换为一个索引值，这个索引值可以代表某种状态或等级（例如电压等级）。函数内部的索引数组 <code>ADC_INDEX</code> 根据 <code>ADC_voltage_scale</code> 的值选择不同的范围，以适应不同的电压测量范围。</p>
<h2 id="board_id"><a class="markdownIt-Anchor" href="#board_id"></a> board_id</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">COPYboard_id() &#123;</span><br><span class="line">    # 从系统文件中读取ADC的电压比例，并存储在ADC_voltage_scale变量中</span><br><span class="line">    ADC_voltage_scale=$(cat /sys/bus/iio/devices/iio\:device0/in_voltage_scale)</span><br><span class="line">    # 将ADC电压比例的值记录到调试文件中</span><br><span class="line">    echo &quot;ADC_voltage_scale:&quot;$ADC_voltage_scale &gt;&gt; $debug_file</span><br><span class="line"></span><br><span class="line">    # 读取通道2的ADC原始值，并存储在ADC_CH2_RAW变量中</span><br><span class="line">    ADC_CH2_RAW=$(cat /sys/bus/iio/devices/iio\:device0/in_voltage2_raw)</span><br><span class="line">    # 将通道2的ADC原始值记录到调试文件中</span><br><span class="line">    echo &quot;ADC_CH2_RAW:&quot;$ADC_CH2_RAW &gt;&gt; $debug_file</span><br><span class="line"></span><br><span class="line">    # 读取通道3的ADC原始值，并存储在ADC_CH3_RAW变量中</span><br><span class="line">    ADC_CH3_RAW=$(cat /sys/bus/iio/devices/iio\:device0/in_voltage3_raw)</span><br><span class="line">    # 将通道3的ADC原始值记录到调试文件中</span><br><span class="line">    echo &quot;ADC_CH3_RAW:&quot;$ADC_CH3_RAW &gt;&gt; $debug_file</span><br><span class="line"></span><br><span class="line">    # 调用get_index函数，通过传入通道2的ADC原始值来获取对应的索引值</span><br><span class="line">    get_index $ADC_CH2_RAW</span><br><span class="line">    # 将通道2的索引值存储在ADC_CH2_INDEX变量中</span><br><span class="line">    ADC_CH2_INDEX=$INDEX</span><br><span class="line"></span><br><span class="line">    # 调用get_index函数，通过传入通道3的ADC原始值来获取对应的索引值</span><br><span class="line">    get_index $ADC_CH3_RAW</span><br><span class="line">    # 将通道3的索引值存储在ADC_CH3_INDEX变量中</span><br><span class="line">    ADC_CH3_INDEX=$INDEX</span><br><span class="line"></span><br><span class="line">    # 将通道2和通道3的索引值拼接起来，生成一个板子ID，并存储在BOARD_ID变量中</span><br><span class="line">    BOARD_ID=$ADC_CH2_INDEX$ADC_CH3_INDEX</span><br><span class="line">    # 将生成的板子ID记录到调试文件中</span><br><span class="line">    echo &quot;BOARD_ID:&quot;$BOARD_ID &gt;&gt; $debug_file</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="详细解析-3"><a class="markdownIt-Anchor" href="#详细解析-3"></a> 详细解析</h3>
<ol>
<li>
<p><code>ADC_voltage_scale=$(cat /sys/bus/iio/devices/iio:device0/in_voltage_scale)</code></p>
<p>:</p>
<ul>
<li>读取系统中的ADC电压比例（<code>in_voltage_scale</code>），这表示每个ADC单位对应的实际电压值。</li>
<li>通过读取 <code>/sys/bus/iio/devices/iio:device0/in_voltage_scale</code> 文件来获取该值。</li>
</ul>
</li>
<li>
<p><code>echo &quot;ADC_voltage_scale:&quot;$ADC_voltage_scale &gt;&gt; $debug_file</code></p>
<p>:</p>
<ul>
<li>将获取到的 <code>ADC_voltage_scale</code> 值记录到调试文件中，以便后续调试和分析。</li>
</ul>
</li>
<li>
<p><code>ADC_CH2_RAW=$(cat /sys/bus/iio/devices/iio:device0/in_voltage2_raw)</code></p>
<p>:</p>
<ul>
<li>读取ADC通道2的原始数值，表示未经过处理的ADC值。</li>
</ul>
</li>
<li>
<p><code>ADC_CH3_RAW=$(cat /sys/bus/iio/devices/iio:device0/in_voltage3_raw)</code></p>
<p>:</p>
<ul>
<li>读取ADC通道3的原始数值，和通道2的操作类似。</li>
</ul>
</li>
<li>
<p><code>get_index $ADC_CH2_RAW</code></p>
<p>:</p>
<ul>
<li>调用 <code>get_index</code> 函数，将通道2的ADC原始值作为参数传入。<code>get_index</code> 函数将计算出对应的索引值。</li>
<li><code>get_index</code> 函数通过比较 <code>ADC_RAW</code> 值与预定义的ADC索引数组，确定 <code>INDEX</code> 的值。</li>
</ul>
</li>
<li>
<p><code>ADC_CH2_INDEX=$INDEX</code></p>
<p>:</p>
<ul>
<li>将 <code>get_index</code> 函数计算出来的索引值（<code>INDEX</code>）赋值给 <code>ADC_CH2_INDEX</code>，这个索引值表示通道2的状态或等级。</li>
</ul>
</li>
<li>
<p><code>get_index $ADC_CH3_RAW</code></p>
<p>:</p>
<ul>
<li>同样的操作对通道3的ADC原始值进行处理，计算出其对应的索引值。</li>
</ul>
</li>
<li>
<p><code>ADC_CH3_INDEX=$INDEX</code></p>
<p>:</p>
<ul>
<li>将 <code>get_index</code> 函数计算出来的索引值（<code>INDEX</code>）赋值给 <code>ADC_CH3_INDEX</code>，这个索引值表示通道3的状态或等级。</li>
</ul>
</li>
<li>
<p><code>BOARD_ID=$ADC_CH2_INDEX$ADC_CH3_INDEX</code></p>
<p>:</p>
<ul>
<li>将通道2和通道3的索引值拼接起来，生成一个板子ID <code>BOARD_ID</code>。</li>
<li>这个ID可以用于标识不同的板子或配置，以适应不同的硬件环境。</li>
</ul>
</li>
<li>
<p><code>echo &quot;BOARD_ID:&quot;$BOARD_ID &gt;&gt; $debug_file</code></p>
<p>:</p>
<ul>
<li>将生成的板子ID记录到调试文件中，以便后续的调试和确认。</li>
</ul>
</li>
</ol>
<h3 id="用途"><a class="markdownIt-Anchor" href="#用途"></a> 用途</h3>
<p>这段代码的主要作用是通过读取ADC通道的原始值，并根据电压比例和预定义的索引数组计算出板子的唯一ID。这在嵌入式系统中非常常见，用于根据硬件配置自动生成配置文件或调试信息。</p>
<h2 id="get_board_type"><a class="markdownIt-Anchor" href="#get_board_type"></a> get_board_type</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">COPYget_board_type()&#123;</span><br><span class="line">    # 从设备树文件中读取SOC信息，并去除字符串中的空字符（\0）</span><br><span class="line">    SOC=$(cat /proc/device-tree/compatible | tr -d &#x27;\0&#x27;)</span><br><span class="line">    # 从设备树文件中读取板子型号信息，并去除字符串中的空字符（\0）</span><br><span class="line">    BOARD=$(cat /proc/device-tree/model | tr -d &#x27;\0&#x27; )</span><br><span class="line"></span><br><span class="line">    # 判断SOC中是否包含&quot;rk3588s&quot;并且板子型号中包含&quot;LubanCat-4&quot;</span><br><span class="line">    if [[ $SOC == *&quot;rk3588s&quot;* &amp;&amp; $BOARD == *&quot;LubanCat-4&quot;* ]]; then</span><br><span class="line">        # 如果条件满足，设置板子的相关信息</span><br><span class="line">        BOARD_NAME=&#x27;LubanCat-4&#x27;  # 设置板子的名称</span><br><span class="line">        BOARD_DTB=&#x27;rk3588s-lubancat-4.dtb&#x27;  # 设置对应的设备树文件名</span><br><span class="line">        UENV_TXT=&#x27;uEnvLubanCat4.txt&#x27;  # 设置对应的uEnv.txt文件名</span><br><span class="line">        BOARD_CPU=&#x27;rk3588s&#x27;  # 设置板子所使用的CPU型号</span><br><span class="line"></span><br><span class="line">        # 设置板子的详细信息描述，包括名称、设备树文件、uEnv.txt文件以及CPU型号</span><br><span class="line">        BOARD_MESSAGE=&quot;LubanCat-4 是野火科技推出的基于RockChip RK3588S设计的一款低功耗、高性能单板电脑，保留了完善的硬件资源，充分考虑了用户的使用需求，在成本优化的同时，引出了尽可能多的外设功能\n\n\</span><br><span class="line">BOARD_NAME : $BOARD_NAME\n\</span><br><span class="line">BOARD_DTB : $BOARD_DTB\n\</span><br><span class="line">UENV_TXT : $UENV_TXT\n\</span><br><span class="line">BOARD_CPU : $BOARD_CPU\n\</span><br><span class="line">    &quot;</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="详细解析-4"><a class="markdownIt-Anchor" href="#详细解析-4"></a> 详细解析</h3>
<ol>
<li>
<p><strong><code>SOC=$(cat /proc/device-tree/compatible | tr -d '\0')</code></strong>:</p>
<ul>
<li>读取 <code>/proc/device-tree/compatible</code> 文件中的内容，这个文件通常包含当前系统的SoC（系统级芯片）的兼容性信息。</li>
<li><code>tr -d '\0'</code> 命令用于删除字符串中的所有空字符（<code>\0</code>），以便后续处理。</li>
</ul>
</li>
<li>
<p><strong><code>BOARD=$(cat /proc/device-tree/model | tr -d '\0' )</code></strong>:</p>
<ul>
<li>读取 <code>/proc/device-tree/model</code> 文件中的内容，这个文件通常包含当前设备的型号信息。</li>
<li>同样使用 <code>tr -d '\0'</code> 命令删除所有空字符。</li>
</ul>
</li>
<li>
<p><strong><code>if [[ $SOC == \*&quot;rk3588s&quot;\* &amp;&amp; $BOARD == \*&quot;LubanCat-4&quot;\* ]]; then</code></strong>:</p>
<ul>
<li>
<p>这行代码使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYif</span><br></pre></td></tr></table></figure>
<p>条件语句判断：</p>
<ul>
<li><code>SOC</code> 字符串中是否包含 <code>&quot;rk3588s&quot;</code>。</li>
<li><code>BOARD</code> 字符串中是否包含 <code>&quot;LubanCat-4&quot;</code>。</li>
</ul>
</li>
<li>
<p>如果上述两个条件都满足，则执行以下的代码块。</p>
</li>
</ul>
</li>
<li>
<p><strong><code>BOARD_NAME='LubanCat-4'</code></strong>:</p>
<ul>
<li>设置板子的名称为 <code>&quot;LubanCat-4&quot;</code>。</li>
</ul>
</li>
<li>
<p><strong><code>BOARD_DTB='rk3588s-lubancat-4.dtb'</code></strong>:</p>
<ul>
<li>设置对应的设备树文件名为 <code>&quot;rk3588s-lubancat-4.dtb&quot;</code>。</li>
</ul>
</li>
<li>
<p><strong><code>UENV_TXT='uEnvLubanCat4.txt'</code></strong>:</p>
<ul>
<li>设置对应的 <code>uEnv.txt</code> 文件名为 <code>&quot;uEnvLubanCat4.txt&quot;</code>。</li>
</ul>
</li>
<li>
<p><strong><code>BOARD_CPU='rk3588s'</code></strong>:</p>
<ul>
<li>设置板子所使用的CPU型号为 <code>&quot;rk3588s&quot;</code>。</li>
</ul>
</li>
<li>
<p><strong><code>BOARD_MESSAGE=&quot;...&quot;</code></strong>:</p>
<ul>
<li>设置板子的详细信息描述，包括板子的名称、设备树文件、uEnv.txt文件以及CPU型号。这个信息通常用于调试输出或用户提示。</li>
</ul>
</li>
</ol>
<h3 id="用途-2"><a class="markdownIt-Anchor" href="#用途-2"></a> 用途</h3>
<p>这段代码的主要作用是通过读取系统中的设备树信息，判断当前系统的板子类型和SoC型号，然后根据判断结果设置相应的板子配置。这在嵌入式开发中非常有用，可以根据不同的硬件平台自动选择合适的配置文件和设备树文件，从而使系统适配多种硬件平台。</p>
<h2 id="do_show_board"><a class="markdownIt-Anchor" href="#do_show_board"></a> do_show_board</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">COPYdo_show_board()&#123;</span><br><span class="line">    # 使用 whiptail 命令创建一个带有标题为 &quot;板卡信息&quot; 的消息框</span><br><span class="line">    # 消息框内容为 BOARD_MESSAGE 变量中的内容</span><br><span class="line">    # 消息框的大小设置为20行高，60列宽</span><br><span class="line">    whiptail --title &quot;板卡信息&quot; --msgbox &quot;$BOARD_MESSAGE&quot; 20 60</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="详细解析-5"><a class="markdownIt-Anchor" href="#详细解析-5"></a> 详细解析</h3>
<ol>
<li>
<p><code>do_show_board()</code></p>
<p>:</p>
<ul>
<li>这是一个函数定义，函数名为 <code>do_show_board</code>，没有参数。当调用此函数时，函数内部的代码将被执行。</li>
</ul>
</li>
<li>
<p><code>whiptail --title &quot;板卡信息&quot; --msgbox &quot;$BOARD_MESSAGE&quot; 20 60</code></p>
<p>:</p>
<ul>
<li><code>whiptail</code> 是一个在终端中创建对话框的工具，用于在脚本中与用户进行交互。它可以生成消息框、输入框、菜单等。</li>
<li><code>--title &quot;板卡信息&quot;</code> 指定对话框的标题为 <code>&quot;板卡信息&quot;</code>。</li>
<li><code>--msgbox &quot;$BOARD_MESSAGE&quot;</code> 创建一个消息框，并显示变量 <code>BOARD_MESSAGE</code> 中的内容。<code>$BOARD_MESSAGE</code> 是之前在脚本中设置的，包含了板卡的详细信息。</li>
<li><code>20 60</code> 设置消息框的大小，其中 <code>20</code> 是消息框的高度（以行数计），<code>60</code> 是宽度（以字符计）。</li>
</ul>
</li>
</ol>
<h3 id="用途-3"><a class="markdownIt-Anchor" href="#用途-3"></a> 用途</h3>
<ul>
<li><strong>显示板卡信息</strong>：这个函数的主要作用是显示当前板卡的详细信息，例如名称、设备树文件、uEnv.txt文件以及CPU型号。这些信息已经在前面被设置在变量 <code>BOARD_MESSAGE</code> 中。</li>
<li><strong>用户交互</strong>：<code>whiptail</code> 提供了一种简单的方式在终端中与用户交互，用户通过这个消息框可以阅读板卡的相关信息。</li>
</ul>
<h3 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h3>
<p><code>do_show_board</code> 函数通过 <code>whiptail</code> 工具在终端中显示一个带有标题和板卡详细信息的消息框。这个函数在需要向用户展示设备信息时非常有用，尤其是在安装或配置过程中，通过这种方式可以方便用户获取设备的详细信息。</p>
<h2 id="get_dt_status"><a class="markdownIt-Anchor" href="#get_dt_status"></a> get_dt_status</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">COPYget_dt_status() &#123;</span><br><span class="line">    # 使用 grep 搜索 /boot/uEnv/$UENV_TXT 文件中包含 &quot;lubancat-$1-overlay.&quot; 的行</span><br><span class="line">    # 然后使用 cut 命令提取该行的第一个字符</span><br><span class="line">    DT_STATUS=$(grep &quot;lubancat-$1-overlay.&quot; &quot;/boot/uEnv/$UENV_TXT&quot; | cut -c1)</span><br><span class="line">    </span><br><span class="line">    # 检查 DT_STATUS 是否为 &quot;#&quot;（表示该行被注释掉）或者是否为空</span><br><span class="line">    if [ &quot;$DT_STATUS&quot; == &quot;#&quot; ] || [ -z &quot;$DT_STATUS&quot; ]; then</span><br><span class="line">        # 如果是注释掉的或者为空，表示设备树覆盖配置未启用，设置 flag 为 &quot;OFF&quot;</span><br><span class="line">        flag=&quot;OFF&quot;</span><br><span class="line">        # 输出 0，表示未启用</span><br><span class="line">        echo 0</span><br><span class="line">    else</span><br><span class="line">        # 如果不是注释掉的并且不为空，表示设备树覆盖配置已启用，设置 flag 为 &quot;ON&quot;</span><br><span class="line">        flag=&quot;ON&quot;</span><br><span class="line">        # 输出 1，表示已启用</span><br><span class="line">        echo 1</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="详细解析-6"><a class="markdownIt-Anchor" href="#详细解析-6"></a> 详细解析</h3>
<ol>
<li>
<p><strong>函数定义</strong>：</p>
<ul>
<li><code>get_dt_status() &#123;&#125;</code> 定义了一个名为 <code>get_dt_status</code> 的函数。</li>
</ul>
</li>
<li>
<p><strong>参数处理</strong>：</p>
<ul>
<li><code>&quot;$1&quot;</code> 代表传递给函数的第一个参数，这个参数一般是表示某个具体的设备树覆盖配置的标识符（例如 <code>1</code>, <code>2</code>, <code>3</code> 等）。</li>
</ul>
</li>
<li>
<p><strong>DT_STATUS=$(grep “lubancat-1−overlay.“”/boot/uEnv/1−overlay.“”/boot/uEnv/UENV_TXT” | cut -c1)</strong>:</p>
<ul>
<li><code>grep &quot;lubancat-$1-overlay.&quot; &quot;/boot/uEnv/$UENV_TXT&quot;</code>：在 <code>/boot/uEnv/$UENV_TXT</code> 文件中搜索包含 <code>&quot;lubancat-$1-overlay.&quot;</code> 的行。</li>
<li><code>cut -c1</code>：提取找到的行的第一个字符。通常，uEnv.txt 文件中某一行如果被注释掉，行首会有一个 <code>#</code>，否则行首字符会是其它字符。</li>
<li><code>DT_STATUS</code> 变量保存这个第一个字符。</li>
</ul>
</li>
<li>
<p><strong>判断 <code>DT_STATUS</code> 的值</strong>：</p>
<ul>
<li>
<p>COPY<code>if [ &quot;$DT_STATUS&quot; == &quot;#&quot; ] || [ -z &quot;$DT_STATUS&quot; ]; then COPY：检查  DT_STATUS COPY是否等于  # COPY      或者是否为空。     - 如果 </code>DT_STATUS<code>为</code>#<code>，说明这个设备树覆盖配置被注释掉了，未启用。     - 如果 </code>DT_STATUS<code>为空，说明在</code>uEnv.txt<code>中没有找到相关的设备树覆盖配置，视为未启用。5. **设置</code>flag<code>变量和输出结果**：   - 如果</code>DT_STATUS<code>是</code>#<code>或者为空，设置</code>flag=“OFF”<code>，并且函数输出 </code>0<code>，表示设备树覆盖配置未启用。   - 否则，设置 </code>flag=“ON”<code>，并且函数输出 </code>1<code>，表示设备树覆盖配置已启用。### 总结- **用途**：</code>get_dt_status<code>函数用于检查特定的设备树覆盖配置在</code>uEnv.txt<code>文件中的启用状态。- **工作原理**：它通过读取</code>uEnv.txt<code>文件的内容，判断与设备树覆盖配置相关的行是否被注释掉或是否存在，从而判断该配置是否启用。- **返回值**：函数返回</code>1<code>表示设备树覆盖配置已启用，返回</code>0<code>表示未启用。## set_dt~~~shellset_dt() &#123;    # 检查第二个参数 $2 是否为 &quot;OFF&quot;    if [ $2 == &quot;OFF&quot; ]; then        # 如果为 &quot;OFF&quot;，使用 sed 命令在 uEnv.txt 文件中注释掉与指定设备树覆盖相关的行        sed -i -e &quot;s/^dtoverlay=\(.*-$1-overlay.*\)/#dtoverlay=\1/g&quot; &quot;/boot/uEnv/$UENV_TXT&quot;    # 检查第二个参数 $2 是否为 &quot;ON&quot;    elif [ $2 == &quot;ON&quot; ]; then        # 如果为 &quot;ON&quot;，使用 sed 命令在 uEnv.txt 文件中取消注释与指定设备树覆盖相关的行        sed -i -e &quot;s/^#dtoverlay=\(.*-$1-overlay.*\)/dtoverlay=\1/g&quot; &quot;/boot/uEnv/$UENV_TXT&quot;    else        # 如果第二个参数既不是 &quot;OFF&quot; 也不是 &quot;ON&quot;，则输出 &quot;wrong data&quot; 错误信息        echo &quot;wrong data&quot;    fi&#125;~~~### 详细解析1. **函数定义**：   -</code>set_dt() {}<code>定义了一个名为</code>set_dt<code>的函数。2. **参数处理**：   -</code>“$1&quot;<code>代表传递给函数的第一个参数，通常用于表示设备树覆盖配置的标识符（例如</code>1<code>, </code>2<code>, </code>3<code>等）。   -</code>”$2&quot;<code> 代表传递给函数的第二个参数，用于指定操作模式，是启用 (</code>ON<code>) 还是禁用 (</code>OFF<code>) 设备树覆盖配置。3. **检查参数值并执行相应操作**：   - **if [ $2 == &quot;OFF&quot; ]**:     - 如果第二个参数的值是 </code>“OFF”<code>，表示需要禁用指定的设备树覆盖配置。     - 使用 </code>sed<code>命令将</code>uEnv.txt<code>文件中以</code>dtoverlay=<code>开头，并且包含</code>-$1-overlay<code>的行注释掉，即在行首加上</code>#<code>。   - **elif [ $2 == &quot;ON&quot; ]**:     - 如果第二个参数的值是 </code>“ON”<code>，表示需要启用指定的设备树覆盖配置。     - 使用 </code>sed<code>命令将</code>uEnv.txt<code>文件中以</code>#dtoverlay=<code>开头，并且包含</code>-$1-overlay<code>的行取消注释，即去掉行首的</code>#<code>。   - **else**:     - 如果第二个参数的值既不是 </code>“OFF&quot;<code>也不是</code>&quot;ON”<code>，输出错误信息 </code>“wrong data”<code>。4. **sed 命令解释**：   - </code>sed -i -e &quot;s/^dtoverlay=(.<em>-<span class='katex-error' title='ParseError: KaTeX parse error: Can&#039;t use function &#039;\)&#039; in math mode at position 12: 1-overlay.*\̲)̲/#dtoverlay=\1/…'>1-overlay.*\)/#dtoverlay=\1/g&quot; &quot;/boot/uEnv/</span>UENV_TXT&quot;<code>：     - </code>-i<code>选项表示直接修改文件内容。     -</code>-e<code>选项表示后面的字符串是一个表达式。     - ```       s/^dtoverlay=\(.*-$1-overlay.*\)/#dtoverlay=\1/g    是一个替换表达式：   -</code>^dtoverlay=(.</em>-$1-overlay.*)<code>匹配以</code>dtoverlay=<code>开头，并且包含</code>-$1-overlay<code>的行。  -</code>#dtoverlay=\1<code>表示将匹配到的内容替换为在前面加上</code>#<code>的内容，即注释掉该行。</code></p>
</li>
<li>
<p><code>sed -i -e &quot;s/^#dtoverlay=\(.*-$1-overlay.*\)/dtoverlay=\1/g&quot; &quot;/boot/uEnv/$UENV_TXT&quot;</code>：</p>
<ul>
<li>
<pre><code>COPYs/^#dtoverlay=\(.*-$1-overlay.*\)/dtoverlay=\1/g
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">       是一个替换表达式：</span><br><span class="line"></span><br><span class="line">       - `^#dtoverlay=\(.*-$1-overlay.*\)` 匹配以 `#dtoverlay=` 开头，并且包含 `-$1-overlay` 的行。</span><br><span class="line">       - `dtoverlay=\1` 表示将匹配到的内容替换为去掉 `#` 的内容，即取消注释该行。</span><br><span class="line"></span><br><span class="line">### 总结</span><br><span class="line"></span><br><span class="line">- **用途**：`set_dt` 函数用于在 `uEnv.txt` 文件中启用或禁用特定的设备树覆盖配置。</span><br><span class="line"></span><br><span class="line">- **工作原理**：它通过 `sed` 命令对 `uEnv.txt` 文件中的相关行进行注释或取消注释，以达到启用或禁用设备树覆盖的目的。</span><br><span class="line"></span><br><span class="line">- 输入参数</span><br><span class="line"></span><br><span class="line">  ：</span><br><span class="line"></span><br><span class="line">  - 第一个参数是设备树覆盖配置的标识符。</span><br><span class="line">  - 第二个参数是操作模式，`ON` 表示启用，`OFF` 表示禁用。</span><br><span class="line"></span><br><span class="line">- **错误处理**：如果第二个参数既不是 `ON` 也不是 `OFF`，函数会输出 `&quot;wrong data&quot;` 提示错误。</span><br><span class="line"></span><br><span class="line">## do_set_pin_menu</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>COPYdo_set_pin_menu() {<br />
# 获取包含 “#overlay_start” 的行号，用于确定引脚复用功能的起始行<br />
PIN_FUN_START=<span class='katex-error' title='ParseError: KaTeX parse error: Expected &#039;EOF&#039;, got &#039;#&#039; at position 11: (grep -n &quot;#̲overlay_start&quot; …'>(grep -n &quot;#overlay_start&quot; /boot/uEnv/</span>UENV_TXT | cut -d ‘:’ -f 1)</p>
<pre><code># 获取包含 &quot;#display&quot; 或 &quot;# Display&quot; 的行号，用于确定引脚复用功能的结束行
PIN_FUN_END=$(grep -n &quot;#display&quot; /boot/uEnv/$UENV_TXT | cut -d ':' -f 1)
if [ -z &quot;$PIN_FUN_END&quot; ]; then
    PIN_FUN_END=$(grep -n &quot;# Display&quot; /boot/uEnv/$UENV_TXT | cut -d ':' -f 1)
fi

# 提取在 overlay 起始行和结束行之间的所有引脚复用功能，并将其过滤为复用功能名称
PIN_FUN=$(sed -n &quot;$&#123;PIN_FUN_START&#125;,$&#123;PIN_FUN_END&#125;p&quot; /boot/uEnv/$UENV_TXT | sed -n 's/^.*lubancat-\(.*\)-overlay.dtbo$/\1/p')

# 计算复用功能的数量
PIN_FUN_COUNT=$(sed -n &quot;$&#123;PIN_FUN_START&#125;,$&#123;PIN_FUN_END&#125;p&quot; /boot/uEnv/$UENV_TXT | sed -n 's/^.*lubancat-\(.*\)-overlay.dtbo$/\1/p' | wc -l)

# 输出起始行、结束行和复用功能信息到调试文件
echo $PIN_FUN_START $PIN_FUN_END &gt;&gt; $debug_file
echo $PIN_FUN &gt;&gt; $debug_file
echo $PIN_FUN_COUNT &gt;&gt; $debug_file

# 定义最大的复用功能数量
MAX_COUNT=&quot;30&quot;

# 声明关联数组 PIN_STATUS 来保存每个复用功能的状态（开启/关闭）
declare -A PIN_STATUS &gt; /dev/null
# 声明数组 PIN_FUN_ARR 来保存所有的复用功能
declare -a PIN_FUN_ARR=($PIN_FUN) &gt; /dev/null

# 初始化循环变量
int=&quot;0&quot;
while (( $int &lt; $PIN_FUN_COUNT ))
do
    # 调用 get_dt_status 函数获取每个复用功能的状态，并存储在 PIN_STATUS 数组中
    get_dt_status $&#123;PIN_FUN_ARR[$int]&#125; &gt; /dev/null
    PIN_STATUS[$int]=&quot;$flag&quot;
    int=$(expr $int + 1)
done

# 如果复用功能的数量不足 MAX_COUNT，补全数组
int=&quot;$PIN_FUN_COUNT&quot;
while (( $int &lt; $MAX_COUNT ))
do
    PIN_FUN_ARR[$int]=&quot;NULL&quot;
    PIN_STATUS[$int]=&quot;OFF&quot;
    int=$(expr $int + 1)
done

# 使用 whiptail 显示引脚复用功能的选择菜单
D2=$(whiptail --title &quot;配置你的板卡引脚的复用功能&quot; --checklist  --ok-button &quot;空格键选中&quot; --cancel-button &quot;Enter键设置&quot;\
&quot;配置你的板卡引脚的复用功能(完成后-reboot-应用配置)&quot; 20 60 12 \
&quot;0&quot; &quot;$&#123;PIN_FUN_ARR[0]&#125;&quot;        $&#123;PIN_STATUS[0]&#125; \
&quot;1&quot; &quot;$&#123;PIN_FUN_ARR[1]&#125;&quot;        $&#123;PIN_STATUS[1]&#125;  \
&quot;2&quot; &quot;$&#123;PIN_FUN_ARR[2]&#125;&quot;        $&#123;PIN_STATUS[2]&#125;  \
&quot;3&quot; &quot;$&#123;PIN_FUN_ARR[3]&#125;&quot;        $&#123;PIN_STATUS[3]&#125;  \
&quot;4&quot; &quot;$&#123;PIN_FUN_ARR[4]&#125;&quot;        $&#123;PIN_STATUS[4]&#125;  \
&quot;5&quot; &quot;$&#123;PIN_FUN_ARR[5]&#125;&quot;        $&#123;PIN_STATUS[5]&#125; \
&quot;6&quot; &quot;$&#123;PIN_FUN_ARR[6]&#125;&quot;        $&#123;PIN_STATUS[6]&#125; \
&quot;7&quot; &quot;$&#123;PIN_FUN_ARR[7]&#125;&quot;        $&#123;PIN_STATUS[7]&#125; \
&quot;8&quot; &quot;$&#123;PIN_FUN_ARR[8]&#125;&quot;        $&#123;PIN_STATUS[8]&#125; \
&quot;9&quot; &quot;$&#123;PIN_FUN_ARR[9]&#125;&quot;        $&#123;PIN_STATUS[9]&#125; \
&quot;10&quot; &quot;$&#123;PIN_FUN_ARR[10]&#125;&quot;      $&#123;PIN_STATUS[10]&#125; \
&quot;11&quot; &quot;$&#123;PIN_FUN_ARR[11]&#125;&quot;      $&#123;PIN_STATUS[11]&#125; \
&quot;12&quot; &quot;$&#123;PIN_FUN_ARR[12]&#125;&quot;      $&#123;PIN_STATUS[12]&#125; \
&quot;13&quot; &quot;$&#123;PIN_FUN_ARR[13]&#125;&quot;      $&#123;PIN_STATUS[13]&#125;  \
&quot;14&quot; &quot;$&#123;PIN_FUN_ARR[14]&#125;&quot;      $&#123;PIN_STATUS[14]&#125;  \
&quot;15&quot; &quot;$&#123;PIN_FUN_ARR[15]&#125;&quot;      $&#123;PIN_STATUS[15]&#125;  \
&quot;16&quot; &quot;$&#123;PIN_FUN_ARR[16]&#125;&quot;      $&#123;PIN_STATUS[16]&#125;  \
&quot;17&quot; &quot;$&#123;PIN_FUN_ARR[17]&#125;&quot;      $&#123;PIN_STATUS[17]&#125; \
&quot;18&quot; &quot;$&#123;PIN_FUN_ARR[18]&#125;&quot;      $&#123;PIN_STATUS[18]&#125; \
&quot;19&quot; &quot;$&#123;PIN_FUN_ARR[19]&#125;&quot;      $&#123;PIN_STATUS[19]&#125; \
&quot;20&quot; &quot;$&#123;PIN_FUN_ARR[20]&#125;&quot;      $&#123;PIN_STATUS[20]&#125; \
&quot;21&quot; &quot;$&#123;PIN_FUN_ARR[21]&#125;&quot;      $&#123;PIN_STATUS[21]&#125; \
&quot;22&quot; &quot;$&#123;PIN_FUN_ARR[22]&#125;&quot;      $&#123;PIN_STATUS[22]&#125; \
&quot;23&quot; &quot;$&#123;PIN_FUN_ARR[23]&#125;&quot;      $&#123;PIN_STATUS[23]&#125; \
&quot;24&quot; &quot;$&#123;PIN_FUN_ARR[24]&#125;&quot;      $&#123;PIN_STATUS[24]&#125;  \
&quot;25&quot; &quot;$&#123;PIN_FUN_ARR[25]&#125;&quot;      $&#123;PIN_STATUS[25]&#125; \
&quot;26&quot; &quot;$&#123;PIN_FUN_ARR[26]&#125;&quot;      $&#123;PIN_STATUS[26]&#125; \
&quot;27&quot; &quot;$&#123;PIN_FUN_ARR[27]&#125;&quot;      $&#123;PIN_STATUS[27]&#125; \
&quot;28&quot; &quot;$&#123;PIN_FUN_ARR[28]&#125;&quot;      $&#123;PIN_STATUS[28]&#125; \
&quot;29&quot; &quot;$&#123;PIN_FUN_ARR[29]&#125;&quot;      $&#123;PIN_STATUS[29]&#125; \
3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)

# 获取菜单的退出状态
exitstatus=$?
echo $exitstatus &gt; /dev/null

# 如果用户按下确认按钮
if [ $exitstatus = 0 ]; then
    echo $D2 &gt;&gt; $debug_file

    # 将所有复用功能状态设置为 OFF
    int=&quot;0&quot;
    while (( $int&lt;$PIN_FUN_COUNT ))
    do
        PIN_STATUS[$int]=&quot;OFF&quot;
        set_dt &quot;$&#123;PIN_FUN_ARR[$int]&#125;&quot; &quot;OFF&quot;
        int=$(expr $int + 1)
    done

    # 处理用户在菜单中选择的选项
    declare -a D2_ARR=($D2)
    D2_SIZE=$
</code></pre>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-07_小技巧/16_设备树overlay"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/08/30/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/16_%E8%AE%BE%E5%A4%87%E6%A0%91overlay/"
    >设备树overlay</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/08/30/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/16_%E8%AE%BE%E5%A4%87%E6%A0%91overlay/" class="article-date">
  <time datetime="2024-08-29T22:50:19.000Z" itemprop="datePublished">2024-08-30</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>好的，以下是您的学习计划开始的步骤和相关说明。我们将从设备树的基础概念开始，然后逐步深入学习设备树叠加的语法和实际应用。</p>
<h3 id="1-了解设备树device-tree的基础知识"><a class="markdownIt-Anchor" href="#1-了解设备树device-tree的基础知识"></a> 1. 了解设备树（Device Tree）的基础知识</h3>
<h4 id="11-什么是设备树"><a class="markdownIt-Anchor" href="#11-什么是设备树"></a> 1.1 什么是设备树</h4>
<p>设备树是一种描述硬件配置的数据结构，通常在嵌入式系统中用于告诉操作系统（例如 Linux 内核）如何配置硬件。设备树以树形结构组织，包含节点和属性，用于描述各种硬件设备及其参数。</p>
<ul>
<li><strong>节点（Node）</strong>：表示一个硬件设备或资源。</li>
<li><strong>属性（Property）</strong>：定义设备的具体参数，如地址、尺寸、中断等。</li>
</ul>
<h4 id="12-设备树的作用"><a class="markdownIt-Anchor" href="#12-设备树的作用"></a> 1.2 设备树的作用</h4>
<p>设备树用于在不依赖固件（如 BIOS）的情况下，让操作系统了解设备的硬件配置。这在嵌入式系统中非常重要，因为这些系统通常没有标准化的硬件配置。</p>
<h4 id="13-设备树的文件类型"><a class="markdownIt-Anchor" href="#13-设备树的文件类型"></a> 1.3 设备树的文件类型</h4>
<ul>
<li><strong><code>\*.dts</code> 文件</strong>：设备树源文件，包含完整的设备树描述。</li>
<li><strong><code>\*.dtsi</code> 文件</strong>：设备树包含文件，通常用于复用一些通用配置。</li>
<li><strong><code>\*.dtb</code> 文件</strong>：设备树二进制文件，由 <code>*.dts</code> 文件编译而成，供操作系统使用。</li>
</ul>
<h4 id="14-设备树的基本语法"><a class="markdownIt-Anchor" href="#14-设备树的基本语法"></a> 1.4 设备树的基本语法</h4>
<p>设备树源文件使用类 C 的语法。以下是一个简单的设备树示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">COPY/dts-v1/;</span><br><span class="line"></span><br><span class="line">/ &#123;</span><br><span class="line">    model = &quot;Example Board&quot;;</span><br><span class="line">    compatible = &quot;example,board&quot;;</span><br><span class="line"></span><br><span class="line">    cpus &#123;</span><br><span class="line">        #address-cells = &lt;1&gt;;</span><br><span class="line">        #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">        cpu@0 &#123;</span><br><span class="line">            device_type = &quot;cpu&quot;;</span><br><span class="line">            compatible = &quot;arm,cortex-a7&quot;;</span><br><span class="line">            reg = &lt;0&gt;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    memory &#123;</span><br><span class="line">        device_type = &quot;memory&quot;;</span><br><span class="line">        reg = &lt;0x80000000 0x4000000&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    soc &#123;</span><br><span class="line">        #address-cells = &lt;1&gt;;</span><br><span class="line">        #size-cells = &lt;1&gt;;</span><br><span class="line"></span><br><span class="line">        gpio@3f200000 &#123;</span><br><span class="line">            compatible = &quot;brcm,bcm2835-gpio&quot;;</span><br><span class="line">            reg = &lt;0x3f200000 0x100&gt;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="2-理解设备树的结构和节点属性"><a class="markdownIt-Anchor" href="#2-理解设备树的结构和节点属性"></a> 2. 理解设备树的结构和节点属性</h3>
<h4 id="21-设备树节点"><a class="markdownIt-Anchor" href="#21-设备树节点"></a> 2.1 设备树节点</h4>
<p>每个节点表示系统中的一个硬件设备或资源，节点以 <code>&#123;&#125;</code> 包围，包含其属性。节点名称可以包含 <code>@</code> 符号后跟地址，例如 <code>cpu@0</code>。</p>
<h4 id="22-设备树属性"><a class="markdownIt-Anchor" href="#22-设备树属性"></a> 2.2 设备树属性</h4>
<p>属性是键值对，用于描述节点的特性。键是属性名，值可以是字符串、整数、字节数组等。属性使用 <code>=</code> 号连接，并以 <code>;</code> 结束。</p>
<h4 id="23-常见设备树属性"><a class="markdownIt-Anchor" href="#23-常见设备树属性"></a> 2.3 常见设备树属性</h4>
<ul>
<li><strong><code>compatible</code></strong>：定义设备与哪些驱动程序兼容。</li>
<li><strong><code>reg</code></strong>：定义设备的物理地址和大小。</li>
<li><strong><code>interrupts</code></strong>：定义设备使用的中断号。</li>
<li><strong><code>clocks</code></strong>：定义设备所依赖的时钟资源。</li>
</ul>
<h3 id="3-学习设备树编译工具dtc"><a class="markdownIt-Anchor" href="#3-学习设备树编译工具dtc"></a> 3. 学习设备树编译工具（DTC）</h3>
<h4 id="31-安装设备树编译器dtc"><a class="markdownIt-Anchor" href="#31-安装设备树编译器dtc"></a> 3.1 安装设备树编译器（DTC）</h4>
<p>如果您还没有安装设备树编译器，请使用以下命令安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYsudo apt-get install device-tree-compiler</span><br></pre></td></tr></table></figure>
<h4 id="32-编译设备树源文件"><a class="markdownIt-Anchor" href="#32-编译设备树源文件"></a> 3.2 编译设备树源文件</h4>
<p>使用 <code>dtc</code> 命令可以将 <code>*.dts</code> 文件编译为 <code>*.dtb</code> 文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYdtc -I dts -O dtb -o example.dtb example.dts</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>-I dts</code></strong>：指定输入文件格式为 <code>dts</code>。</li>
<li><strong><code>-O dtb</code></strong>：指定输出文件格式为 <code>dtb</code>。</li>
<li><strong><code>-o example.dtb</code></strong>：指定输出文件名。</li>
</ul>
<h3 id="4-学习设备树叠加overlay的语法"><a class="markdownIt-Anchor" href="#4-学习设备树叠加overlay的语法"></a> 4. 学习设备树叠加（Overlay）的语法</h3>
<h4 id="41-设备树叠加文件的结构"><a class="markdownIt-Anchor" href="#41-设备树叠加文件的结构"></a> 4.1 设备树叠加文件的结构</h4>
<p>设备树叠加文件是用于修改或扩展现有设备树的 <code>dts</code> 文件，通常用于动态配置硬件。叠加文件使用 <code>/plugin/</code> 关键字和 <code>fragment</code> 节点来定义修改。</p>
<h4 id="42-示例设备树叠加文件"><a class="markdownIt-Anchor" href="#42-示例设备树叠加文件"></a> 4.2 示例设备树叠加文件</h4>
<p>以下是一个简单的设备树叠加文件示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">COPY/dts-v1/;</span><br><span class="line">/plugin/;</span><br><span class="line"></span><br><span class="line">/ &#123;</span><br><span class="line">    fragment@0 &#123;</span><br><span class="line">        target-path = &quot;/soc/gpio@3f200000&quot;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">            pinctrl-names = &quot;default&quot;;</span><br><span class="line">            pinctrl-0 = &lt;&amp;pinctrl_gpios&gt;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@1 &#123;</span><br><span class="line">        target = &lt;&amp;i2c1&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">            clock-frequency = &lt;400000&gt;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="5-实战练习"><a class="markdownIt-Anchor" href="#5-实战练习"></a> 5. 实战练习</h3>
<h4 id="51-编写和编译设备树叠加文件"><a class="markdownIt-Anchor" href="#51-编写和编译设备树叠加文件"></a> 5.1 编写和编译设备树叠加文件</h4>
<p>编写一个设备树叠加文件，然后使用 <code>dtc</code> 编译它为 <code>.dtbo</code> 文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYdtc -I dts -O dtb -o example.dtbo example-overlay.dts</span><br></pre></td></tr></table></figure>
<h4 id="52-加载设备树叠加文件"><a class="markdownIt-Anchor" href="#52-加载设备树叠加文件"></a> 5.2 加载设备树叠加文件</h4>
<p>使用 <code>U-Boot</code> 或操作系统工具（如 <code>configfs</code>）加载设备树叠加文件，并观察效果。</p>
<h3 id="6-总结和扩展学习"><a class="markdownIt-Anchor" href="#6-总结和扩展学习"></a> 6. 总结和扩展学习</h3>
<p>在完成以上步骤后，您可以通过实践更多复杂的设备树叠加来进一步巩固所学内容。</p>
<hr />
<p>通过这个学习计划，您将逐步掌握设备树和设备树叠加的基本语法和使用方法。如果您有任何问题，随时可以提问！</p>
<h2 id="迅为设备树拆分"><a class="markdownIt-Anchor" href="#迅为设备树拆分"></a> 迅为设备树拆分</h2>
<p>好的，以下是为每个屏幕类型拆分后的单独设备树文件的示例。每个文件只包含一个屏幕的定义和相关配置。</p>
<h3 id="1-mipi0-lcd_type_mipi0"><a class="markdownIt-Anchor" href="#1-mipi0-lcd_type_mipi0"></a> 1. MIPI0 (LCD_TYPE_MIPI0)</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br></pre></td><td class="code"><pre><span class="line">COPY// File: lcd_mipi0.dts</span><br><span class="line">/dts-v1/;</span><br><span class="line">/include/ &quot;base_file.dtsi&quot;</span><br><span class="line"></span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line">#include &lt;dt-bindings/display/drm_mipi_dsi.h&gt;</span><br><span class="line">#include &lt;dt-bindings/interrupt-controller/irq.h&gt;</span><br><span class="line"></span><br><span class="line">&amp;route_dsi0 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">    connect = &lt;&amp;vp2_out_dsi0&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;dsi0_in_vp2 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;mipi_dcphy0 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;dsi0 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">    dsi0_panel: panel@0 &#123;</span><br><span class="line">        status = &quot;okay&quot;;</span><br><span class="line">        compatible = &quot;simple-panel-dsi&quot;;</span><br><span class="line">        power-supply = &lt;&amp;vcc3v3_lcd_n&gt;;</span><br><span class="line">        reg = &lt;0&gt;;</span><br><span class="line">        backlight = &lt;&amp;backlight&gt;;</span><br><span class="line">        reset-delay-ms = &lt;10&gt;;</span><br><span class="line">        enable-delay-ms = &lt;35&gt;;</span><br><span class="line">        prepare-delay-ms = &lt;6&gt;;</span><br><span class="line">        unprepare-delay-ms = &lt;0&gt;;</span><br><span class="line">        disable-delay-ms = &lt;20&gt;;</span><br><span class="line">        dsi,flags = &lt;(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_EOT_PACKET)&gt;;</span><br><span class="line">        dsi,format = &lt;MIPI_DSI_FMT_RGB888&gt;;</span><br><span class="line">        dsi,lanes  = &lt;4&gt;;</span><br><span class="line">        dsi,channel = &lt;0&gt;;</span><br><span class="line">        size,width = &lt;120&gt;;</span><br><span class="line">        size,height = &lt;170&gt;;</span><br><span class="line">        panel-init-sequence = [...];  // 保持现有的初始化序列</span><br><span class="line">        panel-exit-sequence = [...];  // 保持现有的退出序列</span><br><span class="line"></span><br><span class="line">        disp_timings0: display-timings &#123;</span><br><span class="line">            native-mode = &lt;&amp;dsi0_timing0&gt;;</span><br><span class="line">            dsi0_timing0: timing0 &#123;</span><br><span class="line">                clock-frequency = &lt;60000000&gt;;</span><br><span class="line">                hactive = &lt;800&gt;;</span><br><span class="line">                vactive = &lt;1280&gt;;</span><br><span class="line">                hfront-porch = &lt;80&gt;;</span><br><span class="line">                hsync-len = &lt;20&gt;;</span><br><span class="line">                hback-porch = &lt;80&gt;;</span><br><span class="line">                vfront-porch = &lt;20&gt;;</span><br><span class="line">                vsync-len = &lt;4&gt;;</span><br><span class="line">                vback-porch = &lt;12&gt;;</span><br><span class="line">                hsync-active = &lt;0&gt;;</span><br><span class="line">                vsync-active = &lt;0&gt;;</span><br><span class="line">                de-active = &lt;0&gt;;</span><br><span class="line">                pixelclk-active = &lt;0&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        ports &#123;</span><br><span class="line">            #address-cells = &lt;1&gt;;</span><br><span class="line">            #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">            port@0 &#123;</span><br><span class="line">                reg = &lt;0&gt;;</span><br><span class="line">                panel_in_dsi: endpoint &#123;</span><br><span class="line">                    remote-endpoint = &lt;&amp;dsi_out_panel&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    ports &#123;</span><br><span class="line">        #address-cells = &lt;1&gt;;</span><br><span class="line">        #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">        port@1 &#123;</span><br><span class="line">            reg = &lt;1&gt;;</span><br><span class="line">            dsi_out_panel: endpoint &#123;</span><br><span class="line">                remote-endpoint = &lt;&amp;panel_in_dsi&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;i2c2 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">    pinctrl-0 = &lt;&amp;i2c2m4_xfer&gt;;</span><br><span class="line">    ft5x06@38 &#123;</span><br><span class="line">        status = &quot;okay&quot;;</span><br><span class="line">        compatible = &quot;edt,edt-ft5406&quot;;</span><br><span class="line">        reg = &lt;0x38&gt;;</span><br><span class="line">        touch-gpio = &lt;&amp;gpio3 RK_PC0 IRQ_TYPE_EDGE_RISING&gt;;</span><br><span class="line">        interrupt-parent = &lt;&amp;gpio3&gt;;</span><br><span class="line">        interrupts = &lt;RK_PC0 IRQ_TYPE_LEVEL_LOW&gt;;</span><br><span class="line">        reset-gpios = &lt;&amp;gpio3 RK_PC1 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">        touchscreen-size-x = &lt;800&gt;;</span><br><span class="line">        touchscreen-size-y = &lt;1280&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">COPY/dts-v1/;</span><br><span class="line">/plugin/;</span><br><span class="line"></span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line">#include &lt;dt-bindings/display/drm_mipi_dsi.h&gt;</span><br><span class="line">#include &lt;dt-bindings/interrupt-controller/irq.h&gt;</span><br><span class="line"></span><br><span class="line">/ &#123;</span><br><span class="line">    fragment@0 &#123;</span><br><span class="line">        target = &lt;&amp;route_dsi0&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">            connect = &lt;&amp;vp2_out_dsi0&gt;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@1 &#123;</span><br><span class="line">        target = &lt;&amp;dsi0_in_vp2&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@2 &#123;</span><br><span class="line">        target = &lt;&amp;mipi_dcphy0&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@3 &#123;</span><br><span class="line">        target = &lt;&amp;dsi0&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            dsi0_panel: panel@0 &#123;</span><br><span class="line">                status = &quot;okay&quot;;</span><br><span class="line">                compatible = &quot;simple-panel-dsi&quot;;</span><br><span class="line">                power-supply = &lt;&amp;vcc3v3_lcd_n&gt;;</span><br><span class="line">                reg = &lt;0&gt;;</span><br><span class="line">                backlight = &lt;&amp;backlight&gt;;</span><br><span class="line">                reset-delay-ms = &lt;10&gt;;</span><br><span class="line">                enable-delay-ms = &lt;35&gt;;</span><br><span class="line">                prepare-delay-ms = &lt;6&gt;;</span><br><span class="line">                unprepare-delay-ms = &lt;0&gt;;</span><br><span class="line">                disable-delay-ms = &lt;20&gt;;</span><br><span class="line">                dsi,flags = &lt;(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_EOT_PACKET)&gt;;</span><br><span class="line">                dsi,format = &lt;MIPI_DSI_FMT_RGB888&gt;;</span><br><span class="line">                dsi,lanes  = &lt;4&gt;;</span><br><span class="line">                dsi,channel = &lt;0&gt;;</span><br><span class="line">                size,width = &lt;120&gt;;</span><br><span class="line">                size,height = &lt;170&gt;;</span><br><span class="line"></span><br><span class="line">panel-init-sequence = [</span><br><span class="line">                        29 00 03 E0 AB BA</span><br><span class="line">                        29 00 03 E1 BA AB</span><br><span class="line">                        15 00 02 B0 00</span><br><span class="line">                        29 00 05 B1 10 01 47 FF</span><br><span class="line">                        29 00 07 B2 0C 0E 04 14 14 14</span><br><span class="line">                        29 00 04 B3 56 D3 00</span><br><span class="line">                        29 00 04 B4 22 30 04</span><br><span class="line">                        15 00 02 B5 00</span><br><span class="line">                        29 00 08 B6 B0 00 00 10 00 10 00</span><br><span class="line">                        29 00 09 B7 0E 00 FF 08 08 FF FF 00</span><br><span class="line">                        29 00 08 B8 05 12 29 49 48 00 00</span><br><span class="line">                        29 00 27 B9 4D 42 38 31 33 27 2F 1B 36 35 35 53 41 49 3D 3D 33 29 26 4C 42 39 31 33 27 2F 1B 36 35 35 53 41 49 3D 3D 33 29 26</span><br><span class="line">                        29 00 09 BA 00 00 00 44 24 00 00 00</span><br><span class="line">                        29 00 04 BB 76 00 00</span><br><span class="line">                        29 00 03 BC 00 00</span><br><span class="line">                        29 00 06 BD FF 00 00 00 00</span><br><span class="line">                        15 00 02 BE 00</span><br><span class="line">                        29 00 11 C0 98 76 12 34 33 33 44 44 06 04 8A 04 0F 00 00 00</span><br><span class="line">                        29 00 0B C1 53 94 02 85 06 04 8A 04 54 00</span><br><span class="line">                        29 00 0D C2 37 09 08 89 08 10 22 21 44 BB 18 00</span><br><span class="line">                        29 00 17 C3 9C 1D 1E 1F 10 12 0C 0E 05 24 24 24 24 24 24 07 24 24 24 24 24 24</span><br><span class="line">                        29 00 17 C4 1C 1D 1E 1F 11 13 0D 0F 04 24 24 24 24 24 24 06 24 24 24 24 24 24</span><br><span class="line">                        29 00 04 C5 E8 85 76</span><br><span class="line">                        29 00 03 C6 20 20</span><br><span class="line">                        29 00 17 C7 41 01 0D 11 09 15 19 4F 10 D7 CF 19 1B 1D 03 02 25 30 00 03 FF 00</span><br><span class="line">                        29 00 07 C8 61 00 31 42 54 16</span><br><span class="line">                        29 00 06 C9 A1 22 FF Cd 23</span><br><span class="line">                        29 00 03 CA 4B 43</span><br><span class="line">                        29 00 05 CC 2E 02 04 08</span><br><span class="line">                        29 00 09 CD 0E 64 64 20 1E 6B 06 83</span><br><span class="line">                        29 00 04 D0 27 10 80</span><br><span class="line">                        29 00 05 D1 00 0D FF 0F</span><br><span class="line">                        29 00 05 D2 E3 2B 38 00</span><br><span class="line">                        29 00 0C D4 00 01 00 0E 04 44 08 10 00 07 00</span><br><span class="line">                        15 00 02 D5 00</span><br><span class="line">                        29 00 03 D6 00 00</span><br><span class="line">                        29 00 05 D7 00 00 00 00</span><br><span class="line">                        29 00 04 E4 08 55 03</span><br><span class="line">                        29 00 09 E6 00 01 FF FF FF FF FF FF</span><br><span class="line">                        29 00 04 E7 00 00 00</span><br><span class="line">                        29 00 08 E8 D5 FF FF FF 00 00 00</span><br><span class="line">                        15 00 02 E9 FF</span><br><span class="line">                        29 00 06 F0 12 03 20 00 FF</span><br><span class="line">                        29 00 1B F1 A6 C8 EA E6 E4 CC E4 BE F0 B2 AA C7 FF 66 98 E3 87 C8 99 C8 8C BE 96 91 8F FF</span><br><span class="line">                        15 00 02 F3 03</span><br><span class="line">                        29 00 1B F4 FF FE FC FA F8 F4 F0 E8 E0 D0 C0 A0 80 7F 5F 3F 2F 1F 17 0F 0B 07 05 03 01 00</span><br><span class="line">                        29 00 1B F5 FF FE FC FA F8 F4 F0 E8 E0 D0 C0 A0 80 7F 5F 3F 2F 1F 17 0F 0B 07 05 03 01 00</span><br><span class="line">                        29 00 1B F6 FF FE FC FA F8 F4 F0 E8 E0 D0 C0 A0 80 7F 5F 3F 2F 1F 17 0F 0B 07 05 03 01 00</span><br><span class="line">                        29 00 08 F7 00 00 00 00 00 00 00</span><br><span class="line">                        29 00 08 F8 00 00 00 00 00 00 00</span><br><span class="line">                        29 00 08 F9 00 00 00 00 00 00 00</span><br><span class="line">                        29 00 1A FA 00 84 12 21 48 48 21 12 84 69 69 5A A5 96 96 A5 5A B7 DE ED 7B 7B ED DE B7</span><br><span class="line">                        29 00 18 FB 00 12 0F FF FF FF 00 38 40 08 70 0B 40 19 50 21 C0 27 60 2D 00 00 0F</span><br><span class="line">                        29 00 03 E3 20 21</span><br><span class="line">                        05 C8 01 11</span><br><span class="line">                        05 14 01 29</span><br><span class="line">                ];</span><br><span class="line"></span><br><span class="line">                panel-exit-sequence = [</span><br><span class="line">                        05 00 01 28</span><br><span class="line">                        05 78 01 10</span><br><span class="line">                ];</span><br><span class="line"></span><br><span class="line">                disp_timings0: display-timings &#123;</span><br><span class="line">                    native-mode = &lt;&amp;dsi0_timing0&gt;;</span><br><span class="line">                    dsi0_timing0: timing0 &#123;</span><br><span class="line">                        clock-frequency = &lt;60000000&gt;;</span><br><span class="line">                        hactive = &lt;800&gt;;</span><br><span class="line">                        vactive = &lt;1280&gt;;</span><br><span class="line">                        hfront-porch = &lt;80&gt;;</span><br><span class="line">                        hsync-len = &lt;20&gt;;</span><br><span class="line">                        hback-porch = &lt;80&gt;;</span><br><span class="line">                        vfront-porch = &lt;20&gt;;</span><br><span class="line">                        vsync-len = &lt;4&gt;;</span><br><span class="line">                        vback-porch = &lt;12&gt;;</span><br><span class="line">                        hsync-active = &lt;0&gt;;</span><br><span class="line">                        vsync-active = &lt;0&gt;;</span><br><span class="line">                        de-active = &lt;0&gt;;</span><br><span class="line">                        pixelclk-active = &lt;0&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                ports &#123;</span><br><span class="line">                    #address-cells = &lt;1&gt;;</span><br><span class="line">                    #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">                    port@0 &#123;</span><br><span class="line">                        reg = &lt;0&gt;;</span><br><span class="line">                        panel_in_dsi: endpoint &#123;</span><br><span class="line">                            remote-endpoint = &lt;&amp;dsi_out_panel&gt;;</span><br><span class="line">                        &#125;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            ports &#123;</span><br><span class="line">                #address-cells = &lt;1&gt;;</span><br><span class="line">                #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">                port@1 &#123;</span><br><span class="line">                    reg = &lt;1&gt;;</span><br><span class="line">                    dsi_out_panel: endpoint &#123;</span><br><span class="line">                        remote-endpoint = &lt;&amp;panel_in_dsi&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@4 &#123;</span><br><span class="line">        target = &lt;&amp;i2c2&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">            pinctrl-0 = &lt;&amp;i2c2m4_xfer&gt;;</span><br><span class="line"></span><br><span class="line">            ft5x06@38 &#123;</span><br><span class="line">                status = &quot;okay&quot;;</span><br><span class="line">                compatible = &quot;edt,edt-ft5406&quot;;</span><br><span class="line">                reg = &lt;0x38&gt;;</span><br><span class="line">                touch-gpio = &lt;&amp;gpio3 RK_PC0 IRQ_TYPE_EDGE_RISING&gt;;</span><br><span class="line">                interrupt-parent = &lt;&amp;gpio3&gt;;</span><br><span class="line">                interrupts = &lt;RK_PC0 IRQ_TYPE_LEVEL_LOW&gt;;</span><br><span class="line">                reset-gpios = &lt;&amp;gpio3 RK_PC1 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">                touchscreen-size-x = &lt;800&gt;;</span><br><span class="line">                touchscreen-size-y = &lt;1280&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="2-lvds-101-1280x800-gt911-lcd_type_lvds_10_1_1280x800_gt911"><a class="markdownIt-Anchor" href="#2-lvds-101-1280x800-gt911-lcd_type_lvds_10_1_1280x800_gt911"></a> 2. LVDS 10.1 1280x800 GT911 (LCD_TYPE_LVDS_10_1_1280x800_GT911)</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">COPY// File: lcd_lvds_10_1_1280x800_gt911.dts</span><br><span class="line">/dts-v1/;</span><br><span class="line">/include/ &quot;base_file.dtsi&quot;</span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line">#include &lt;dt-bindings/display/drm_mipi_dsi.h&gt;</span><br><span class="line">#include &lt;dt-bindings/interrupt-controller/irq.h&gt;</span><br><span class="line"></span><br><span class="line">&amp;dsi0 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">    dsi0_panel: panel@0 &#123;</span><br><span class="line">        status = &quot;okay&quot;;</span><br><span class="line">        compatible = &quot;simple-panel-dsi&quot;;</span><br><span class="line">        reg = &lt;0&gt;;</span><br><span class="line">        power-supply = &lt;&amp;vcc3v3_lcd_n&gt;;</span><br><span class="line">        backlight = &lt;&amp;backlight&gt;;</span><br><span class="line">        reset-delay-ms = &lt;10&gt;;</span><br><span class="line">        enable-delay-ms = &lt;35&gt;;</span><br><span class="line">        prepare-delay-ms = &lt;6&gt;;</span><br><span class="line">        unprepare-delay-ms = &lt;0&gt;;</span><br><span class="line">        disable-delay-ms = &lt;20&gt;;</span><br><span class="line">        dsi,flags = &lt;(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_EOT_PACKET)&gt;;</span><br><span class="line">        dsi,format = &lt;MIPI_DSI_FMT_RGB888&gt;;</span><br><span class="line">        dsi,lanes  = &lt;4&gt;;</span><br><span class="line">        dsi,channel = &lt;0&gt;;</span><br><span class="line">        size,width = &lt;235&gt;;</span><br><span class="line">        size,height = &lt;143&gt;;</span><br><span class="line">        panel-init-sequence = [...];  // 保持现有的初始化序列</span><br><span class="line">        panel-exit-sequence = [...];  // 保持现有的退出序列</span><br><span class="line"></span><br><span class="line">        disp_timings0: display-timings &#123;</span><br><span class="line">            native-mode = &lt;&amp;dsi0_timing0&gt;;</span><br><span class="line">            dsi0_timing0: timing0 &#123;</span><br><span class="line">                clock-frequency = &lt;90000000&gt;;</span><br><span class="line">                hactive = &lt;1280&gt;;</span><br><span class="line">                vactive = &lt;800&gt;;</span><br><span class="line">                hback-porch = &lt;320&gt;;</span><br><span class="line">                hfront-porch = &lt;1270&gt;;</span><br><span class="line">                vback-porch = &lt;15&gt;;</span><br><span class="line">                vfront-porch = &lt;20&gt;;</span><br><span class="line">                hsync-len = &lt;10&gt;;</span><br><span class="line">                vsync-len = &lt;20&gt;;</span><br><span class="line">                hsync-active = &lt;0&gt;;</span><br><span class="line">                vsync-active = &lt;0&gt;;</span><br><span class="line">                de-active = &lt;0&gt;;</span><br><span class="line">                pixelclk-active = &lt;0&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        ports &#123;</span><br><span class="line">            #address-cells = &lt;1&gt;;</span><br><span class="line">            #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">            port@0 &#123;</span><br><span class="line">                reg = &lt;0&gt;;</span><br><span class="line">                panel_in_dsi: endpoint &#123;</span><br><span class="line">                    remote-endpoint = &lt;&amp;dsi_out_panel&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    ports &#123;</span><br><span class="line">        #address-cells = &lt;1&gt;;</span><br><span class="line">        #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">        port@1 &#123;</span><br><span class="line">            reg = &lt;1&gt;;</span><br><span class="line">            dsi_out_panel: endpoint &#123;</span><br><span class="line">                remote-endpoint = &lt;&amp;panel_in_dsi&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;i2c2 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">    pinctrl-0 = &lt;&amp;i2c2m4_xfer&gt;;</span><br><span class="line">    gt9xx@5d &#123;</span><br><span class="line">        compatible = &quot;goodix,gt9xx&quot;;</span><br><span class="line">        reg = &lt;0x5d&gt;;</span><br><span class="line">        interrupt-parent = &lt;&amp;gpio3&gt;;</span><br><span class="line">        interrupts = &lt;RK_PC0 IRQ_TYPE_LEVEL_LOW&gt;;</span><br><span class="line">        reset-gpio = &lt;&amp;gpio3 RK_PC1 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">        touch-gpio = &lt;&amp;gpio3 RK_PC0 IRQ_TYPE_EDGE_RISING&gt;;</span><br><span class="line">        status = &quot;okay&quot;;</span><br><span class="line">        tp-size = &lt;911&gt;;</span><br><span class="line">        max-x = &lt;1280&gt;;</span><br><span class="line">        max-y = &lt;800&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="3-lvds-101-1280x800-gt9271-lcd_type_lvds_10_1_1280x800_gt9271"><a class="markdownIt-Anchor" href="#3-lvds-101-1280x800-gt9271-lcd_type_lvds_10_1_1280x800_gt9271"></a> 3. LVDS 10.1 1280x800 GT9271 (LCD_TYPE_LVDS_10_1_1280x800_GT9271)</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">COPY// File: lcd_lvds_10_1_1280x800_gt9271.dts</span><br><span class="line">/dts-v1/;</span><br><span class="line">/include/ &quot;base_file.dtsi&quot;</span><br><span class="line"></span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line">#include &lt;dt-bindings/display/drm_mipi_dsi.h&gt;</span><br><span class="line">#include &lt;dt-bindings/interrupt-controller/irq.h&gt;</span><br><span class="line"></span><br><span class="line">&amp;dsi0 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">    dsi0_panel: panel@0 &#123;</span><br><span class="line">        status = &quot;okay&quot;;</span><br><span class="line">        compatible = &quot;simple-panel-dsi&quot;;</span><br><span class="line">        reg = &lt;0&gt;;</span><br><span class="line">        power-supply = &lt;&amp;vcc3v3_lcd_n&gt;;</span><br><span class="line">        backlight = &lt;&amp;backlight&gt;;</span><br><span class="line">        reset-delay-ms = &lt;10&gt;;</span><br><span class="line">        enable-delay-ms = &lt;35&gt;;</span><br><span class="line">        prepare-delay-ms = &lt;6&gt;;</span><br><span class="line">        unprepare-delay-ms = &lt;0&gt;;</span><br><span class="line">        disable-delay-ms = &lt;20&gt;;</span><br><span class="line">        dsi,flags = &lt;(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_EOT_PACKET)&gt;;</span><br><span class="line">        dsi,format = &lt;MIPI_DSI_FMT_RGB888&gt;;</span><br><span class="line">        dsi,lanes  = &lt;4&gt;;</span><br><span class="line">        dsi,channel = &lt;0&gt;;</span><br><span class="line">        size,width = &lt;235&gt;;</span><br><span class="line">        size,height = &lt;143&gt;;</span><br><span class="line">        panel-init-sequence = [...];  // 保持现有的初始化序列</span><br><span class="line">        panel-exit-sequence = [...];  // 保持现有的退出序列</span><br><span class="line"></span><br><span class="line">        disp_timings0: display-timings &#123;</span><br><span class="line">            native-mode = &lt;&amp;dsi0_timing0&gt;;</span><br><span class="line">            dsi0_timing0: timing0 &#123;</span><br><span class="line">                clock-frequency = &lt;90000000&gt;;</span><br><span class="line">                hactive = &lt;1280&gt;;</span><br><span class="line">                vactive = &lt;800&gt;;</span><br><span class="line">                hback-porch = &lt;320&gt;;</span><br><span class="line">                hfront-porch = &lt;1270&gt;;</span><br><span class="line">                vback-porch = &lt;15&gt;;</span><br><span class="line">                vfront-porch = &lt;20&gt;;</span><br><span class="line">                hsync-len = &lt;10&gt;;</span><br><span class="line">                vsync-len = &lt;20&gt;;</span><br><span class="line">                hsync-active = &lt;0&gt;;</span><br><span class="line">                vsync-active = &lt;0&gt;;</span><br><span class="line">                de-active = &lt;0&gt;;</span><br><span class="line">                pixelclk-active = &lt;0&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        ports &#123;</span><br><span class="line">            #address-cells = &lt;1&gt;;</span><br><span class="line">            #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">            port@0 &#123;</span><br><span class="line">                reg = &lt;0&gt;;</span><br><span class="line">                panel_in_dsi: endpoint &#123;</span><br><span class="line">                    remote-endpoint = &lt;&amp;dsi_out_panel&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    ports &#123;</span><br><span class="line">        #address-cells = &lt;1</span><br><span class="line"></span><br><span class="line">&gt;;</span><br><span class="line">        #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">        port@1 &#123;</span><br><span class="line">            reg = &lt;1&gt;;</span><br><span class="line">            dsi_out_panel: endpoint &#123;</span><br><span class="line">                remote-endpoint = &lt;&amp;panel_in_dsi&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;i2c2 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">    pinctrl-0 = &lt;&amp;i2c2m4_xfer&gt;;</span><br><span class="line">    gt9xx@5d &#123;</span><br><span class="line">        compatible = &quot;goodix,gt9271&quot;;</span><br><span class="line">        reg = &lt;0x5d&gt;;</span><br><span class="line">        interrupt-parent = &lt;&amp;gpio3&gt;;</span><br><span class="line">        interrupts = &lt;RK_PC0 IRQ_TYPE_LEVEL_LOW&gt;;</span><br><span class="line">        reset-gpio = &lt;&amp;gpio3 RK_PC1 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">        touch-gpio = &lt;&amp;gpio3 RK_PC0 IRQ_TYPE_EDGE_RISING&gt;;</span><br><span class="line">        status = &quot;okay&quot;;</span><br><span class="line">        tp-size = &lt;9271&gt;;</span><br><span class="line">        max-x = &lt;1280&gt;;</span><br><span class="line">        max-y = &lt;800&gt;;</span><br><span class="line">        touchscreen-inverted-x;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="4-lvds-101-1024x600-gt911-lcd_type_lvds_10_1_1024x600_gt911"><a class="markdownIt-Anchor" href="#4-lvds-101-1024x600-gt911-lcd_type_lvds_10_1_1024x600_gt911"></a> 4. LVDS 10.1 1024x600 GT911 (LCD_TYPE_LVDS_10_1_1024x600_GT911)</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">COPY// File: lcd_lvds_10_1_1024x600_gt911.dts</span><br><span class="line">/dts-v1/;</span><br><span class="line">/include/ &quot;base_file.dtsi&quot;</span><br><span class="line"></span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line">#include &lt;dt-bindings/display/drm_mipi_dsi.h&gt;</span><br><span class="line">#include &lt;dt-bindings/interrupt-controller/irq.h&gt;</span><br><span class="line"></span><br><span class="line">&amp;dsi0 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">    dsi0_panel: panel@0 &#123;</span><br><span class="line">        status = &quot;okay&quot;;</span><br><span class="line">        compatible = &quot;simple-panel-dsi&quot;;</span><br><span class="line">        reg = &lt;0&gt;;</span><br><span class="line">        power-supply = &lt;&amp;vcc3v3_lcd_n&gt;;</span><br><span class="line">        backlight = &lt;&amp;backlight&gt;;</span><br><span class="line">        reset-delay-ms = &lt;10&gt;;</span><br><span class="line">        enable-delay-ms = &lt;35&gt;;</span><br><span class="line">        prepare-delay-ms = &lt;6&gt;;</span><br><span class="line">        unprepare-delay-ms = &lt;0&gt;;</span><br><span class="line">        disable-delay-ms = &lt;20&gt;;</span><br><span class="line">        dsi,flags = &lt;(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_EOT_PACKET)&gt;;</span><br><span class="line">        dsi,format = &lt;MIPI_DSI_FMT_RGB888&gt;;</span><br><span class="line">        dsi,lanes  = &lt;4&gt;;</span><br><span class="line">        dsi,channel = &lt;0&gt;;</span><br><span class="line">        size,width = &lt;235&gt;;</span><br><span class="line">        size,height = &lt;143&gt;;</span><br><span class="line">        panel-init-sequence = [...];  // 保持现有的初始化序列</span><br><span class="line">        panel-exit-sequence = [...];  // 保持现有的退出序列</span><br><span class="line"></span><br><span class="line">        disp_timings0: display-timings &#123;</span><br><span class="line">            native-mode = &lt;&amp;dsi0_timing0&gt;;</span><br><span class="line">            dsi0_timing0: timing0 &#123;</span><br><span class="line">                clock-frequency = &lt;82000000&gt;;</span><br><span class="line">                hactive = &lt;1024&gt;;</span><br><span class="line">                vactive = &lt;600&gt;;</span><br><span class="line">                hfront-porch = &lt;1580&gt;;</span><br><span class="line">                hsync-len = &lt;10&gt;;</span><br><span class="line">                hback-porch = &lt;100&gt;;</span><br><span class="line">                vfront-porch = &lt;10&gt;;</span><br><span class="line">                vsync-len = &lt;10&gt;;</span><br><span class="line">                vback-porch = &lt;25&gt;;</span><br><span class="line">                hsync-active = &lt;0&gt;;</span><br><span class="line">                vsync-active = &lt;0&gt;;</span><br><span class="line">                de-active = &lt;0&gt;;</span><br><span class="line">                pixelclk-active = &lt;0&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        ports &#123;</span><br><span class="line">            #address-cells = &lt;1&gt;;</span><br><span class="line">            #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">            port@0 &#123;</span><br><span class="line">                reg = &lt;0&gt;;</span><br><span class="line">                panel_in_dsi: endpoint &#123;</span><br><span class="line">                    remote-endpoint = &lt;&amp;dsi_out_panel&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    ports &#123;</span><br><span class="line">        #address-cells = &lt;1&gt;;</span><br><span class="line">        #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">        port@1 &#123;</span><br><span class="line">            reg = &lt;1&gt;;</span><br><span class="line">            dsi_out_panel: endpoint &#123;</span><br><span class="line">                remote-endpoint = &lt;&amp;panel_in_dsi&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;i2c2 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">    pinctrl-0 = &lt;&amp;i2c2m4_xfer&gt;;</span><br><span class="line">    gt9xx@14 &#123;</span><br><span class="line">        compatible = &quot;goodix,gt9xx&quot;;</span><br><span class="line">        reg = &lt;0x14&gt;;</span><br><span class="line">        interrupt-parent = &lt;&amp;gpio3&gt;;</span><br><span class="line">        interrupts = &lt;RK_PC0 IRQ_TYPE_LEVEL_LOW&gt;;</span><br><span class="line">        reset-gpio = &lt;&amp;gpio3 RK_PC1 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">        touch-gpio = &lt;&amp;gpio3 RK_PC0 IRQ_TYPE_EDGE_RISING&gt;;</span><br><span class="line">        status = &quot;okay&quot;;</span><br><span class="line">        tp-size = &lt;911&gt;;</span><br><span class="line">        max-x = &lt;1024&gt;;</span><br><span class="line">        max-y = &lt;600&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="5-lvds-70-lcd_type_lvds_7_0"><a class="markdownIt-Anchor" href="#5-lvds-70-lcd_type_lvds_7_0"></a> 5. LVDS 7.0 (LCD_TYPE_LVDS_7_0)</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br></pre></td><td class="code"><pre><span class="line">COPY// File: lcd_lvds_7_0.dts</span><br><span class="line">/dts-v1/;</span><br><span class="line">/include/ &quot;base_file.dtsi&quot;</span><br><span class="line"></span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line">#include &lt;dt-bindings/display/drm_mipi_dsi.h&gt;</span><br><span class="line">#include &lt;dt-bindings/interrupt-controller/irq.h&gt;</span><br><span class="line"></span><br><span class="line">&amp;dsi0 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">    dsi0_panel: panel@0 &#123;</span><br><span class="line">        status = &quot;okay&quot;;</span><br><span class="line">        compatible = &quot;simple-panel-dsi&quot;;</span><br><span class="line">        reg = &lt;0&gt;;</span><br><span class="line">        power-supply = &lt;&amp;vcc3v3_lcd_n&gt;;</span><br><span class="line">        backlight = &lt;&amp;backlight&gt;;</span><br><span class="line">        reset-delay-ms = &lt;10&gt;;</span><br><span class="line">        enable-delay-ms = &lt;35&gt;;</span><br><span class="line">        prepare-delay-ms = &lt;6&gt;;</span><br><span class="line">        unprepare-delay-ms = &lt;0&gt;;</span><br><span class="line">        disable-delay-ms = &lt;20&gt;;</span><br><span class="line">        dsi,flags = &lt;(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_EOT_PACKET)&gt;;</span><br><span class="line">        dsi,format = &lt;MIPI_DSI_FMT_RGB888&gt;;</span><br><span class="line">        dsi,lanes  = &lt;4&gt;;</span><br><span class="line">        dsi,channel = &lt;0&gt;;</span><br><span class="line">        size,width = &lt;120&gt;;</span><br><span class="line">        size,height = &lt;170&gt;;</span><br><span class="line">        panel-init-sequence = [...];  // 保持现有的初始化序列</span><br><span class="line">        panel-exit-sequence = [...];  // 保持现有的退出序列</span><br><span class="line"></span><br><span class="line">        disp_timings0: display-timings &#123;</span><br><span class="line">            native-mode = &lt;&amp;dsi0_timing0&gt;;</span><br><span class="line">            dsi0_timing0: timing0 &#123;</span><br><span class="line">                clock-frequency = &lt;90000000&gt;;</span><br><span class="line">                hactive = &lt;800&gt;;</span><br><span class="line">                vactive = &lt;1280&gt;;</span><br><span class="line">                hsync-len = &lt;10&gt;;</span><br><span class="line">                hback-porch = &lt;100&gt;;</span><br><span class="line">                hfront-porch = &lt;1580&gt;;</span><br><span class="line">                vsync-len = &lt;10&gt;;</span><br><span class="line">                vback-porch = &lt;25&gt;;</span><br><span class="line">                vfront-porch = &lt;10&gt;;</span><br><span class="line">                hsync-active = &lt;0&gt;;</span><br><span class="line">                vsync-active = &lt;0&gt;;</span><br><span class="line">                de-active = &lt;0&gt;;</span><br><span class="line">                pixelclk-active = &lt;0&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        ports &#123;</span><br><span class="line">            #address-cells = &lt;1&gt;;</span><br><span class="line">            #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">            port@0 &#123;</span><br><span class="line">                reg = &lt;0&gt;;</span><br><span class="line">                panel_in_dsi: endpoint &#123;</span><br><span class="line">                    remote-endpoint = &lt;&amp;dsi_out_panel&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    ports &#123;</span><br><span class="line">        #address-cells = &lt;1&gt;;</span><br><span class="line">        #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">        port@1 &#123;</span><br><span class="line">            reg = &lt;1&gt;;</span><br><span class="line">            dsi_out_panel: endpoint &#123;</span><br><span class="line">                remote-endpoint = &lt;&amp;panel_in_dsi&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;i2c2 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">    pinctrl-0 = &lt;&amp;i2c2m4_xfer&gt;;</span><br><span class="line">    ft5x06@38 &#123;</span><br><span class="line">        status = &quot;okay&quot;;</span><br><span class="line">        compatible = &quot;edt,edt-ft5406&quot;;</span><br><span class="line">        reg = &lt;0x38&gt;;</span><br><span class="line">        touch-gpio = &lt;&amp;gpio3 RK_PC0 IRQ_TYPE_EDGE_RISING&gt;;</span><br><span class="line">        interrupt-parent = &lt;&amp;gpio3&gt;;</span><br><span class="line">        interrupts = &lt;RK_PC0 IRQ_TYPE_LEVEL_LOW&gt;;</span><br><span class="line">        reset-gpios = &lt;&amp;gpio3 RK_PC1 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">        touchscreen-size-x = &lt;800&gt;;</span><br><span class="line">        touchscreen-size-y = &lt;1280&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">COPY/dts-v1/;</span><br><span class="line">/plugin/;</span><br><span class="line"></span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line">#include &lt;dt-bindings/display/drm_mipi_dsi.h&gt;</span><br><span class="line">#include &lt;dt-bindings/interrupt-controller/irq.h&gt;</span><br><span class="line"></span><br><span class="line">/ &#123;</span><br><span class="line">    fragment@0 &#123;</span><br><span class="line">        target = &lt;&amp;dsi0&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            dsi0_panel: panel@0 &#123;</span><br><span class="line">                status = &quot;okay&quot;;</span><br><span class="line">                compatible = &quot;simple-panel-dsi&quot;;</span><br><span class="line">                reg = &lt;0&gt;;</span><br><span class="line">                power-supply = &lt;&amp;vcc3v3_lcd_n&gt;;</span><br><span class="line">                backlight = &lt;&amp;backlight&gt;;</span><br><span class="line">                reset-delay-ms = &lt;10&gt;;</span><br><span class="line">                enable-delay-ms = &lt;35&gt;;</span><br><span class="line">                prepare-delay-ms = &lt;6&gt;;</span><br><span class="line">                unprepare-delay-ms = &lt;0&gt;;</span><br><span class="line">                disable-delay-ms = &lt;20&gt;;</span><br><span class="line">                dsi,flags = &lt;(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_EOT_PACKET)&gt;;</span><br><span class="line">                dsi,format = &lt;MIPI_DSI_FMT_RGB888&gt;;</span><br><span class="line">                dsi,lanes  = &lt;4&gt;;</span><br><span class="line">                dsi,channel = &lt;0&gt;;</span><br><span class="line">                size,width = &lt;120&gt;;</span><br><span class="line">                size,height = &lt;170&gt;;</span><br><span class="line"></span><br><span class="line">                panel-init-sequence = [</span><br><span class="line">                                       29 02 06 3C 01 09 00 07 00                      </span><br><span class="line">                                        29 02 06 14 01 06 00 00 00                      </span><br><span class="line">                                        29 02 06 64 01 0B 00 00 00                      </span><br><span class="line">                                        29 02 06 68 01 0B 00 00 00                      </span><br><span class="line">                                        29 02 06 6C 01 0B 00 00 00                      </span><br><span class="line">                                        29 02 06 70 01 0B 00 00 00                      </span><br><span class="line">                                        29 02 06 34 01 1F 00 00 00                      </span><br><span class="line">                                        29 02 06 10 02 1F 00 00 00                      </span><br><span class="line">                                        29 02 06 04 01 01 00 00 00                      </span><br><span class="line">                                        29 02 06 04 02 01 00 00 00                      </span><br><span class="line">                                        29 02 06 50 04 20 01 F0 03                      </span><br><span class="line">                                        29 02 06 54 04 19 00 5A 00                       //5A</span><br><span class="line">                                        29 02 06 58 04 20 03 24 00                      </span><br><span class="line">                                        29 02 06 5C 04 0A 00 19 00                      </span><br><span class="line">                                        29 02 06 60 04 00 05 0A 00                      </span><br><span class="line">                                        29 02 06 64 04 01 00 00 00                      </span><br><span class="line">                                        29 02 06 A0 04 06 80 44 00</span><br><span class="line">                                        29 02 06 A0 04 06 80 04 00</span><br><span class="line">                                        29 02 06 04 05 04 00 00 00                      </span><br><span class="line">#if 1   /* three channel */</span><br><span class="line">                                        29 02 06 80 04 02 03 04 05     /* three channel */</span><br><span class="line">                                        29 02 06 84 04 06 07 07 0A                      </span><br><span class="line">                                        29 02 06 88 04 0B 0C 0E 0F                      </span><br><span class="line">                                        29 02 06 8C 04 0D 0E 0F 12                      </span><br><span class="line">                                        29 02 06 90 04 16 17 13 14                      </span><br><span class="line">                                        29 02 06 94 04 15 16 17 1B                      </span><br><span class="line">                                        29 02 06 98 04 18 19 1A 06                      </span><br><span class="line">#else   /* four channel */</span><br><span class="line">                                        29 02 06 80 04 00 01 02 03     /* four channel */</span><br><span class="line">                                        29 02 06 84 04 04 07 05 08</span><br><span class="line">                                        29 02 06 88 04 09 0A 0E 0F</span><br><span class="line">                                        29 02 06 8C 04 0B 0C 0D 10</span><br><span class="line">                                        29 02 06 90 04 16 17 11 12</span><br><span class="line">                                        29 02 06 94 04 13 14 15 1B</span><br><span class="line">                                        29 02 06 98 04 18 19 1A 06</span><br><span class="line">#endif</span><br><span class="line">                                        /*</span><br><span class="line">                                        29 02 06 80 04 1A 1A 1A 1A                                          </span><br><span class="line">                                        29 02 06 84 04 1A 19 1A 1A                                           </span><br><span class="line">                                        29 02 06 88 04 18 18 19 19                                             </span><br><span class="line">                                        29 02 06 8C 04 18 18 18 18                                             </span><br><span class="line">                                        29 02 06 90 04 19 19 18 12                                             </span><br><span class="line">                                        29 02 06 94 04 13 14 15 19                                             </span><br><span class="line">                                        29 02 06 98 04 18 19 1A 19</span><br><span class="line">                                        */</span><br><span class="line">                                        29 02 06 9C 04 31 04 00 00</span><br><span class="line">                ];</span><br><span class="line"></span><br><span class="line">                panel-exit-sequence = [</span><br><span class="line">                        05 05 01 28</span><br><span class="line">                        05 78 01 10</span><br><span class="line">                ];</span><br><span class="line"></span><br><span class="line">                disp_timings0: display-timings &#123;</span><br><span class="line">                    native-mode = &lt;&amp;dsi0_timing0&gt;;</span><br><span class="line">                    dsi0_timing0: timing0 &#123;</span><br><span class="line">                        clock-frequency = &lt;90000000&gt;;</span><br><span class="line">                        hactive = &lt;800&gt;;</span><br><span class="line">                        vactive = &lt;1280&gt;;</span><br><span class="line">                        hsync-len = &lt;10&gt;;</span><br><span class="line">                        hback-porch = &lt;100&gt;;</span><br><span class="line">                        hfront-porch = &lt;1580&gt;;</span><br><span class="line">                        vsync-len = &lt;10&gt;;</span><br><span class="line">                        vback-porch = &lt;25&gt;;</span><br><span class="line">                        vfront-porch = &lt;10&gt;;</span><br><span class="line">                        hsync-active = &lt;0&gt;;</span><br><span class="line">                        vsync-active = &lt;0&gt;;</span><br><span class="line">                        de-active = &lt;0&gt;;</span><br><span class="line">                        pixelclk-active = &lt;0&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                ports &#123;</span><br><span class="line">                    #address-cells = &lt;1&gt;;</span><br><span class="line">                    #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">                    port@0 &#123;</span><br><span class="line">                        reg = &lt;0&gt;;</span><br><span class="line">                        panel_in_dsi: endpoint &#123;</span><br><span class="line">                            remote-endpoint = &lt;&amp;dsi_out_panel&gt;;</span><br><span class="line">                        &#125;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            ports &#123;</span><br><span class="line">                #address-cells = &lt;1&gt;;</span><br><span class="line">                #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">                port@1 &#123;</span><br><span class="line">                    reg = &lt;1&gt;;</span><br><span class="line">                    dsi_out_panel: endpoint &#123;</span><br><span class="line">                        remote-endpoint = &lt;&amp;panel_in_dsi&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@1 &#123;</span><br><span class="line">        target = &lt;&amp;i2c2&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">            pinctrl-0 = &lt;&amp;i2c2m4_xfer&gt;;</span><br><span class="line"></span><br><span class="line">            ft5x06@38 &#123;</span><br><span class="line">                status = &quot;okay&quot;;</span><br><span class="line">                compatible = &quot;edt,edt-ft5406&quot;;</span><br><span class="line">                reg = &lt;0x38&gt;;</span><br><span class="line">                touch-gpio = &lt;&amp;gpio3 RK_PC0 IRQ_TYPE_EDGE_RISING&gt;;</span><br><span class="line">                interrupt-parent = &lt;&amp;gpio3&gt;;</span><br><span class="line">                interrupts = &lt;RK_PC0 IRQ_TYPE_LEVEL_LOW&gt;;</span><br><span class="line">                reset-gpios = &lt;&amp;gpio3 RK_PC1 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">                touchscreen-size-x = &lt;800&gt;;</span><br><span class="line">                touchscreen-size-y = &lt;1280&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="6-hdmi1-lcd_type_hdmi1"><a class="markdownIt-Anchor" href="#6-hdmi1-lcd_type_hdmi1"></a> 6. HDMI1 (LCD_TYPE_HDMI1)</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">COPY// File: lcd_hdmi1.dts</span><br><span class="line">/dts-v1/;</span><br><span class="line">/include/ &quot;base_file.dtsi&quot;</span><br><span class="line"></span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line">#include &lt;dt-bindings/display/drm_mipi_dsi.h&gt;</span><br><span class="line">#include &lt;dt-bindings/interrupt-controller/irq.h&gt;</span><br><span class="line"></span><br><span class="line">&amp;hdptxphy_hdmi1 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;hdmi1 &#123;</span><br><span class="line">    enable-gpios = &lt;&amp;gpio4 RK_PA2 GPIO_ACTIVE_HIGH&gt;;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;hdmi1_in_vp1 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;hdmi1_sound &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;route_hdmi1 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="7-hdmi0-lcd_type_hdmi0"><a class="markdownIt-Anchor" href="#7-hdmi0-lcd_type_hdmi0"></a> 7. HDMI0 (LCD_TYPE_HDMI0)</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">COPY// File: lcd_hdmi0.dts</span><br><span class="line">/dts-v1/;</span><br><span class="line">/include/ &quot;base_file.dtsi&quot;</span><br><span class="line"></span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line">#include &lt;dt-bindings/display/drm_mipi_dsi.h&gt;</span><br><span class="line">#include &lt;dt-bindings/interrupt-controller/irq.h&gt;</span><br><span class="line"></span><br><span class="line">&amp;hdptxphy_hdmi0 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;hdmi0 &#123;</span><br><span class="line">    enable-gpios = &lt;&amp;gpio4 RK_PB1 GPIO_ACTIVE_HIGH&gt;;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;hdmi0_in_vp0 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;hdmi0_sound &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;route_hdmi0 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="8-type-c-dp-lcd_type_typec_dp"><a class="markdownIt-Anchor" href="#8-type-c-dp-lcd_type_typec_dp"></a> 8. Type-C DP (LCD_TYPE_TYPEC_DP)</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">COPY// File: lcd_typec_dp.dts</span><br><span class="line">/dts-v1/;</span><br><span class="line">/include/ &quot;base_file.dtsi&quot;</span><br><span class="line"></span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line">#include &lt;dt-bindings/display/drm_mipi_dsi.h&gt;</span><br><span class="line">#include &lt;dt-bindings/interrupt-controller/irq.h&gt;</span><br><span class="line"></span><br><span class="line">&amp;dp0 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;dp0_in_vp2 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="9-mipi1-lcd_type_mipi1"><a class="markdownIt-Anchor" href="#9-mipi1-lcd_type_mipi1"></a> 9. MIPI1 (LCD_TYPE_MIPI1)</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line">COPY// File: lcd_mipi1.dts</span><br><span class="line">/dts-v1/;</span><br><span class="line">/include/ &quot;base_file.dtsi&quot;</span><br><span class="line"></span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line">#include &lt;dt-bindings/display/drm_mipi_dsi.h&gt;</span><br><span class="line">#include &lt;dt-bindings/interrupt-controller/irq.h&gt;</span><br><span class="line"></span><br><span class="line">&amp;route_dsi1 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">    connect = &lt;&amp;vp3_out_dsi1&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;dsi1_in_vp3 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;mipi_dcphy1 &#123;</span><br><span class="line">    status = &quot;</span><br><span class="line"></span><br><span class="line">okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;dsi1 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">    dsi1_panel: panel@0 &#123;</span><br><span class="line">        status = &quot;okay&quot;;</span><br><span class="line">        compatible = &quot;simple-panel-dsi&quot;;</span><br><span class="line">        reg = &lt;0&gt;;</span><br><span class="line">        power-supply = &lt;&amp;vcc3v3_lcd_n&gt;;</span><br><span class="line">        backlight = &lt;&amp;backlight&gt;;</span><br><span class="line">        reset-delay-ms = &lt;10&gt;;</span><br><span class="line">        enable-delay-ms = &lt;35&gt;;</span><br><span class="line">        prepare-delay-ms = &lt;6&gt;;</span><br><span class="line">        unprepare-delay-ms = &lt;0&gt;;</span><br><span class="line">        disable-delay-ms = &lt;20&gt;;</span><br><span class="line">        dsi,flags = &lt;(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_EOT_PACKET)&gt;;</span><br><span class="line">        dsi,format = &lt;MIPI_DSI_FMT_RGB888&gt;;</span><br><span class="line">        dsi,lanes  = &lt;4&gt;;</span><br><span class="line">        dsi,channel = &lt;0&gt;;</span><br><span class="line">        size,width = &lt;120&gt;;</span><br><span class="line">        size,height = &lt;170&gt;;</span><br><span class="line">        panel-init-sequence = [...];  // 保持现有的初始化序列</span><br><span class="line">        panel-exit-sequence = [...];  // 保持现有的退出序列</span><br><span class="line"></span><br><span class="line">        disp_timings1: display-timings &#123;</span><br><span class="line">            native-mode = &lt;&amp;dsi1_timing0&gt;;</span><br><span class="line">            dsi1_timing0: timing0 &#123;</span><br><span class="line">                clock-frequency = &lt;71900000&gt;;</span><br><span class="line">                hactive = &lt;800&gt;;</span><br><span class="line">                vactive = &lt;1280&gt;;</span><br><span class="line">                hfront-porch = &lt;20&gt;;</span><br><span class="line">                hsync-len = &lt;20&gt;;</span><br><span class="line">                hback-porch = &lt;20&gt;;</span><br><span class="line">                vfront-porch = &lt;10&gt;;</span><br><span class="line">                vsync-len = &lt;4&gt;;</span><br><span class="line">                vback-porch = &lt;4&gt;;</span><br><span class="line">                hsync-active = &lt;0&gt;;</span><br><span class="line">                vsync-active = &lt;0&gt;;</span><br><span class="line">                de-active = &lt;0&gt;;</span><br><span class="line">                pixelclk-active = &lt;0&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        ports &#123;</span><br><span class="line">            #address-cells = &lt;1&gt;;</span><br><span class="line">            #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">            port@0 &#123;</span><br><span class="line">                reg = &lt;0&gt;;</span><br><span class="line">                panel_in_dsi1: endpoint &#123;</span><br><span class="line">                    remote-endpoint = &lt;&amp;dsi1_out_panel&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    ports &#123;</span><br><span class="line">        #address-cells = &lt;1&gt;;</span><br><span class="line">        #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">        port@1 &#123;</span><br><span class="line">            reg = &lt;1&gt;;</span><br><span class="line">            dsi1_out_panel: endpoint &#123;</span><br><span class="line">                remote-endpoint = &lt;&amp;panel_in_dsi1&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;i2c3 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">    pinctrl-0 = &lt;&amp;i2c3m0_xfer&gt;;</span><br><span class="line">    ft5x06@38 &#123;</span><br><span class="line">        status = &quot;okay&quot;;</span><br><span class="line">        compatible = &quot;edt,edt-ft5406&quot;;</span><br><span class="line">        reg = &lt;0x38&gt;;</span><br><span class="line">        touch-gpio = &lt;&amp;gpio3 RK_PC0 IRQ_TYPE_EDGE_RISING&gt;;</span><br><span class="line">        interrupt-parent = &lt;&amp;gpio3&gt;;</span><br><span class="line">        interrupts = &lt;RK_PC0 IRQ_TYPE_LEVEL_LOW&gt;;</span><br><span class="line">        reset-gpios = &lt;&amp;gpio3 RK_PC1 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">        touchscreen-size-x = &lt;800&gt;;</span><br><span class="line">        touchscreen-size-y = &lt;1280&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">COPY/dts-v1/;</span><br><span class="line">/plugin/;</span><br><span class="line"></span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line">#include &lt;dt-bindings/display/drm_mipi_dsi.h&gt;</span><br><span class="line">#include &lt;dt-bindings/interrupt-controller/irq.h&gt;</span><br><span class="line"></span><br><span class="line">/ &#123;</span><br><span class="line">    fragment@0 &#123;</span><br><span class="line">        target = &lt;&amp;route_dsi1&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">            connect = &lt;&amp;vp3_out_dsi1&gt;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@1 &#123;</span><br><span class="line">        target = &lt;&amp;dsi1_in_vp3&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@2 &#123;</span><br><span class="line">        target = &lt;&amp;mipi_dcphy1&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@3 &#123;</span><br><span class="line">        target = &lt;&amp;dsi1&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            dsi1_panel: panel@0 &#123;</span><br><span class="line">                status = &quot;okay&quot;;</span><br><span class="line">                compatible = &quot;simple-panel-dsi&quot;;</span><br><span class="line">                reg = &lt;0&gt;;</span><br><span class="line">                power-supply = &lt;&amp;vcc3v3_lcd_n&gt;;</span><br><span class="line">                backlight = &lt;&amp;backlight&gt;;</span><br><span class="line">                reset-delay-ms = &lt;10&gt;;</span><br><span class="line">                enable-delay-ms = &lt;35&gt;;</span><br><span class="line">                prepare-delay-ms = &lt;6&gt;;</span><br><span class="line">                unprepare-delay-ms = &lt;0&gt;;</span><br><span class="line">                disable-delay-ms = &lt;20&gt;;</span><br><span class="line">                dsi,flags = &lt;(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_EOT_PACKET)&gt;;</span><br><span class="line">                dsi,format = &lt;MIPI_DSI_FMT_RGB888&gt;;</span><br><span class="line">                dsi,lanes  = &lt;4&gt;;</span><br><span class="line">                dsi,channel = &lt;0&gt;;</span><br><span class="line">                size,width = &lt;120&gt;;</span><br><span class="line">                size,height = &lt;170&gt;;</span><br><span class="line"></span><br><span class="line">                panel-init-sequence = [</span><br><span class="line">                    // 保持现有的初始化序列</span><br><span class="line">                ];</span><br><span class="line"></span><br><span class="line">                panel-exit-sequence = [</span><br><span class="line">                    // 保持现有的退出序列</span><br><span class="line">                ];</span><br><span class="line"></span><br><span class="line">                disp_timings1: display-timings &#123;</span><br><span class="line">                    native-mode = &lt;&amp;dsi1_timing0&gt;;</span><br><span class="line">                    dsi1_timing0: timing0 &#123;</span><br><span class="line">                        clock-frequency = &lt;71900000&gt;;</span><br><span class="line">                        hactive = &lt;800&gt;;</span><br><span class="line">                        vactive = &lt;1280&gt;;</span><br><span class="line">                        hfront-porch = &lt;20&gt;;</span><br><span class="line">                        hsync-len = &lt;20&gt;;</span><br><span class="line">                        hback-porch = &lt;20&gt;;</span><br><span class="line">                        vfront-porch = &lt;10&gt;;</span><br><span class="line">                        vsync-len = &lt;4&gt;;</span><br><span class="line">                        vback-porch = &lt;4&gt;;</span><br><span class="line">                        hsync-active = &lt;0&gt;;</span><br><span class="line">                        vsync-active = &lt;0&gt;;</span><br><span class="line">                        de-active = &lt;0&gt;;</span><br><span class="line">                        pixelclk-active = &lt;0&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                ports &#123;</span><br><span class="line">                    #address-cells = &lt;1&gt;;</span><br><span class="line">                    #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">                    port@0 &#123;</span><br><span class="line">                        reg = &lt;0&gt;;</span><br><span class="line">                        panel_in_dsi1: endpoint &#123;</span><br><span class="line">                            remote-endpoint = &lt;&amp;dsi1_out_panel&gt;;</span><br><span class="line">                        &#125;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            ports &#123;</span><br><span class="line">                #address-cells = &lt;1&gt;;</span><br><span class="line">                #size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">                port@1 &#123;</span><br><span class="line">                    reg = &lt;1&gt;;</span><br><span class="line">                    dsi1_out_panel: endpoint &#123;</span><br><span class="line">                        remote-endpoint = &lt;&amp;panel_in_dsi1&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@4 &#123;</span><br><span class="line">        target = &lt;&amp;i2c3&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">            pinctrl-0 = &lt;&amp;i2c3m0_xfer&gt;;</span><br><span class="line"></span><br><span class="line">            ft5x06@38 &#123;</span><br><span class="line">                status = &quot;okay&quot;;</span><br><span class="line">                compatible = &quot;edt,edt-ft5406&quot;;</span><br><span class="line">                reg = &lt;0x38&gt;;</span><br><span class="line">                touch-gpio = &lt;&amp;gpio3 RK_PC0 IRQ_TYPE_EDGE_RISING&gt;;</span><br><span class="line">                interrupt-parent = &lt;&amp;gpio3&gt;;</span><br><span class="line">                interrupts = &lt;RK_PC0 IRQ_TYPE_LEVEL_LOW&gt;;</span><br><span class="line">                reset-gpios = &lt;&amp;gpio3 RK_PC1 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">                touchscreen-size-x = &lt;800&gt;;</span><br><span class="line">                touchscreen-size-y = &lt;1280&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="基础文件-base_filedtsi"><a class="markdownIt-Anchor" href="#基础文件-base_filedtsi"></a> 基础文件 base_file.dtsi</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">COPY// File: base_file.dtsi</span><br><span class="line">/dts-v1/;</span><br><span class="line"></span><br><span class="line">/ &#123;</span><br><span class="line">    backlight: backlight &#123;</span><br><span class="line">        compatible = &quot;pwm-backlight&quot;;</span><br><span class="line">        brightness-levels = &lt;...&gt;;</span><br><span class="line">        default-brightness-level = &lt;200&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;backlight &#123;</span><br><span class="line">    pwms = &lt;&amp;pwm1 0 25000 0&gt;;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;pwm1 &#123;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>以上是所有屏幕类型的单独设备树文件的完整拆分。每个设备树文件只包含一个屏幕的定义和相关配置，其他部分从基础文件 <code>base_file.dtsi</code> 中引入。</p>
<p>根据您的请求，我将四个摄像头配置分解为四个独立的设备树，每个摄像头独立成一个设备树overlay文件。以下是分开的设备树overlay文件：</p>
<h3 id="1-camera_j1_overlaydts"><a class="markdownIt-Anchor" href="#1-camera_j1_overlaydts"></a> 1. <code>camera_j1_overlay.dts</code></h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line">COPY/dts-v1/;</span><br><span class="line">/plugin/;</span><br><span class="line"></span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/clock/rockchip,rk3588-cru.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line"></span><br><span class="line">/ &#123;</span><br><span class="line">    fragment@0 &#123;</span><br><span class="line">        target = &lt;&amp;csi2_dphy3&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            ports &#123;</span><br><span class="line">                port@0 &#123;</span><br><span class="line">                    reg = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">                    mipidphy3_in_ucam0: endpoint@1 &#123;</span><br><span class="line">                        reg = &lt;1&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;ov5695_out_4&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    mipidphy3_in_ucam0_ov13850: endpoint@2 &#123;</span><br><span class="line">                        reg = &lt;2&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;ov13850_out_4&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2 3 4&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                port@1 &#123;</span><br><span class="line">                    reg = &lt;1&gt;;</span><br><span class="line"></span><br><span class="line">                    csidphy3_out: endpoint@0 &#123;</span><br><span class="line">                        reg = &lt;0&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;mipi4_csi2_input&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@1 &#123;</span><br><span class="line">        target = &lt;&amp;csi2_dphy1_hw&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@2 &#123;</span><br><span class="line">        target = &lt;&amp;i2c4&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">            pinctrl-0 = &lt;&amp;i2c4m1_xfer&gt;;</span><br><span class="line"></span><br><span class="line">            ov5695_4: ov5695@36 &#123;</span><br><span class="line">                status = &quot;okay&quot;;</span><br><span class="line">                compatible = &quot;ovti,ov5695&quot;;</span><br><span class="line">                reg = &lt;0x36&gt;;</span><br><span class="line">                clocks = &lt;&amp;cru CLK_MIPI_CAMARAOUT_M4&gt;;</span><br><span class="line">                clock-names = &quot;xvclk&quot;;</span><br><span class="line">                power-domains = &lt;&amp;power RK3588_PD_VI&gt;;</span><br><span class="line">                pinctrl-names = &quot;default&quot;;</span><br><span class="line">                pinctrl-0 = &lt;&amp;mipim0_camera4_clk&gt;;</span><br><span class="line">                reset-gpios = &lt;&amp;gpio1 RK_PD3 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">                pwdn-gpios = &lt;&amp;gpio1 RK_PB0 GPIO_ACTIVE_HIGH&gt;;</span><br><span class="line">                rockchip,camera-module-index = &lt;0&gt;;</span><br><span class="line">                rockchip,camera-module-facing = &quot;back&quot;;</span><br><span class="line">                rockchip,camera-module-name = &quot;default&quot;;</span><br><span class="line">                rockchip,camera-module-lens-name = &quot;default&quot;;</span><br><span class="line"></span><br><span class="line">                port &#123;</span><br><span class="line">                    ov5695_out_4: endpoint &#123;</span><br><span class="line">                        remote-endpoint = &lt;&amp;mipidphy3_in_ucam0&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            ov13850_4: ov13850@10 &#123;</span><br><span class="line">                status = &quot;okay&quot;;</span><br><span class="line">                compatible = &quot;otvi,ov13850&quot;;</span><br><span class="line">                reg = &lt;0x10&gt;;</span><br><span class="line">                clocks = &lt;&amp;cru CLK_MIPI_CAMARAOUT_M4&gt;;</span><br><span class="line">                clock-names = &quot;xvclk&quot;;</span><br><span class="line">                power-domains = &lt;&amp;power RK3588_PD_VI&gt;;</span><br><span class="line">                pinctrl-names = &quot;default&quot;;</span><br><span class="line">                pinctrl-0 = &lt;&amp;mipim0_camera4_clk&gt;;</span><br><span class="line">                reset-gpios = &lt;&amp;gpio1 RK_PD3 GPIO_ACTIVE_HIGH&gt;;</span><br><span class="line">                pwdn-gpios = &lt;&amp;gpio1 RK_PB0 GPIO_ACTIVE_HIGH&gt;;</span><br><span class="line">                rockchip,camera-module-index = &lt;3&gt;;</span><br><span class="line">                rockchip,camera-module-facing = &quot;back&quot;;</span><br><span class="line">                rockchip,camera-module-name = &quot;CMK-CT0116&quot;;</span><br><span class="line">                rockchip,camera-module-lens-name = &quot;Largan-50013A1&quot;;</span><br><span class="line"></span><br><span class="line">                port &#123;</span><br><span class="line">                    ov13850_out_4: endpoint &#123;</span><br><span class="line">                        remote-endpoint = &lt;&amp;mipidphy3_in_ucam0_ov13850&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2 3 4&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@3 &#123;</span><br><span class="line">        target = &lt;&amp;mipi4_csi2&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            ports &#123;</span><br><span class="line">                port@0 &#123;</span><br><span class="line">                    reg = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">                    mipi4_csi2_input: endpoint@1 &#123;</span><br><span class="line">                        reg = &lt;1&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;csidphy3_out&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                port@1 &#123;</span><br><span class="line">                    reg = &lt;1&gt;;</span><br><span class="line"></span><br><span class="line">                    mipi4_csi2_output: endpoint@0 &#123;</span><br><span class="line">                        reg = &lt;0&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;cif_mipi4_in0&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@4 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@5 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif_mipi_lvds4&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            port &#123;</span><br><span class="line">                cif_mipi4_in0: endpoint &#123;</span><br><span class="line">                    remote-endpoint = &lt;&amp;mipi4_csi2_output&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@6 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif_mipi_lvds4_sditf&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            port &#123;</span><br><span class="line">                mipi_lvds4_sditf: endpoint &#123;</span><br><span class="line">                    remote-endpoint = &lt;&amp;isp0_vir0&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@7 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif_mmu&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@8 &#123;</span><br><span class="line">        target = &lt;&amp;rkisp0&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@9 &#123;</span><br><span class="line">        target = &lt;&amp;isp0_mmu&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@10 &#123;</span><br><span class="line">        target = &lt;&amp;rkisp0_vir0&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            port &#123;</span><br><span class="line">                isp0_vir0: endpoint@0 &#123;</span><br><span class="line">                    reg = &lt;0&gt;;</span><br><span class="line">                    remote-endpoint = &lt;&amp;mipi_lvds4_sditf&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="2-camera_j2_overlaydts"><a class="markdownIt-Anchor" href="#2-camera_j2_overlaydts"></a> 2. <code>camera_j2_overlay.dts</code></h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line">COPY/dts-v1/;</span><br><span class="line">/plugin/;</span><br><span class="line"></span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/clock/rockchip,rk3588-cru.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line"></span><br><span class="line">/ &#123;</span><br><span class="line">    fragment@0 &#123;</span><br><span class="line">        target = &lt;&amp;csi2_dcphy1&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            ports &#123;</span><br><span class="line">                port@0 &#123;</span><br><span class="line">                    reg = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">                    mipi_in_ucam1: endpoint@1 &#123;</span><br><span class="line">                        reg = &lt;1&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;ov5695_out_2&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    mipi_in_ucam1_ov13850: endpoint@2 &#123;</span><br><span class="line">                        reg = &lt;2&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;ov13850_out_2&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2 3 4&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                port@1 &#123;</span><br><span class="line">                    reg = &lt;1&gt;;</span><br><span class="line"></span><br><span class="line">                    csidcphy1_out: endpoint@0 &#123;</span><br><span class="line">                        reg = &lt;0&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;mipi1_csi2_input&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@1 &#123;</span><br><span class="line">        target = &lt;&amp;mipi_dcphy1&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@2 &#123;</span><br><span class="line">        target = &lt;&amp;i2c7&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">            pinctrl-0 = &lt;&amp;i2c7m0_xfer&gt;;</span><br><span class="line"></span><br><span class="line">            ov5695_2: ov5695@36 &#123;</span><br><span class="line">                status = &quot;okay&quot;;</span><br><span class="line">                compatible = &quot;ovti,ov5695&quot;;</span><br><span class="line">                reg = &lt;0x36&gt;;</span><br><span class="line">                clocks = &lt;&amp;cru CLK_MIPI_CAMARAOUT_M2&gt;;</span><br><span class="line">                clock-names = &quot;xvclk&quot;;</span><br><span class="line">                power-domains = &lt;&amp;power RK3588_PD_VI&gt;;</span><br><span class="line">                pinctrl-names = &quot;default&quot;;</span><br><span class="line">                pinctrl-0 = &lt;&amp;mipim0_camera2_clk&gt;;</span><br><span class="line">                reset-gpios = &lt;&amp;gpio1 RK_PA3 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">                pwdn-gpios = &lt;&amp;gpio1 RK_PA4 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">                rockchip,camera-module-index = &lt;1&gt;;</span><br><span class="line">                rockchip,camera-module-facing = &quot;front&quot;;</span><br><span class="line">                rockchip,camera-module-name = &quot;default&quot;;</span><br><span class="line">                rockchip,camera-module-lens-name = &quot;default&quot;;</span><br><span class="line"></span><br><span class="line">                port &#123;</span><br><span class="line">                    ov5695_out_2: endpoint &#123;</span><br><span class="line">                        remote-endpoint = &lt;&amp;mipi_in_ucam1&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            ov13850_2: ov13850@10 &#123;</span><br><span class="line">                status = &quot;okay&quot;;</span><br><span class="line">                compatible = &quot;otvi,ov13850&quot;;</span><br><span class="line">                reg = &lt;0x10&gt;;</span><br><span class="line">                clocks = &lt;&amp;cru CLK_MIPI_CAMARAOUT_M2&gt;;</span><br><span class="line">                clock-names = &quot;xvclk&quot;;</span><br><span class="line">                power-domains = &lt;&amp;power RK3588_PD_VI&gt;;</span><br><span class="line">                pinctrl-names = &quot;default&quot;;</span><br><span class="line">                pinctrl-0 = &lt;&amp;mipim0_camera2_clk&gt;;</span><br><span class="line">                reset-gpios = &lt;&amp;gpio1 RK_PA3 GPIO_ACTIVE_HIGH&gt;;</span><br><span class="line">                pwdn-gpios = &lt;&amp;gpio1 RK_PA4 GPIO_ACTIVE_HIGH&gt;;</span><br><span class="line">                rockchip,camera-module-index = &lt;1&gt;;</span><br><span class="line">                rockchip,camera-module-facing =</span><br><span class="line"></span><br><span class="line"> &quot;front&quot;;</span><br><span class="line">                rockchip,camera-module-name = &quot;CMK-CT0116&quot;;</span><br><span class="line">                rockchip,camera-module-lens-name = &quot;Largan-50013A1&quot;;</span><br><span class="line"></span><br><span class="line">                port &#123;</span><br><span class="line">                    ov13850_out_2: endpoint &#123;</span><br><span class="line">                        remote-endpoint = &lt;&amp;mipi_in_ucam1_ov13850&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2 3 4&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@3 &#123;</span><br><span class="line">        target = &lt;&amp;mipi1_csi2&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            ports &#123;</span><br><span class="line">                port@0 &#123;</span><br><span class="line">                    reg = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">                    mipi1_csi2_input: endpoint@1 &#123;</span><br><span class="line">                        reg = &lt;1&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;csidcphy1_out&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                port@1 &#123;</span><br><span class="line">                    reg = &lt;1&gt;;</span><br><span class="line"></span><br><span class="line">                    mipi1_csi2_output: endpoint@0 &#123;</span><br><span class="line">                        reg = &lt;0&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;cif_mipi_in1&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@4 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@5 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif_mmu&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@6 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif_mipi_lvds1&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            port &#123;</span><br><span class="line">                cif_mipi_in1: endpoint &#123;</span><br><span class="line">                    remote-endpoint = &lt;&amp;mipi1_csi2_output&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@7 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif_mipi_lvds1_sditf&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            port &#123;</span><br><span class="line">                mipi_lvds1_sditf: endpoint &#123;</span><br><span class="line">                    remote-endpoint = &lt;&amp;isp1_vir0&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@8 &#123;</span><br><span class="line">        target = &lt;&amp;rkisp1&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@9 &#123;</span><br><span class="line">        target = &lt;&amp;isp1_mmu&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@10 &#123;</span><br><span class="line">        target = &lt;&amp;rkisp1_vir0&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            port &#123;</span><br><span class="line">                isp1_vir0: endpoint@0 &#123;</span><br><span class="line">                    reg = &lt;0&gt;;</span><br><span class="line">                    remote-endpoint = &lt;&amp;mipi_lvds1_sditf&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="3-camera_j3_overlaydts"><a class="markdownIt-Anchor" href="#3-camera_j3_overlaydts"></a> 3. <code>camera_j3_overlay.dts</code></h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line">COPY/dts-v1/;</span><br><span class="line">/plugin/;</span><br><span class="line"></span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/clock/rockchip,rk3588-cru.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line"></span><br><span class="line">/ &#123;</span><br><span class="line">    fragment@0 &#123;</span><br><span class="line">        target = &lt;&amp;csi2_dphy0&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            ports &#123;</span><br><span class="line">                port@0 &#123;</span><br><span class="line">                    reg = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">                    mipidphy0_in_ucam0: endpoint@1 &#123;</span><br><span class="line">                        reg = &lt;1&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;ov5695_out_3&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    mipidphy0_in_ucam0_ov13850: endpoint@2 &#123;</span><br><span class="line">                        reg = &lt;2&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;ov13850_out_3&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2 3 4&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                port@1 &#123;</span><br><span class="line">                    reg = &lt;1&gt;;</span><br><span class="line"></span><br><span class="line">                    csidphy0_out: endpoint@0 &#123;</span><br><span class="line">                        reg = &lt;0&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;mipi2_csi2_input&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@1 &#123;</span><br><span class="line">        target = &lt;&amp;csi2_dphy0_hw&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@2 &#123;</span><br><span class="line">        target = &lt;&amp;i2c3&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">            pinctrl-0 = &lt;&amp;i2c3m0_xfer&gt;;</span><br><span class="line"></span><br><span class="line">            ov5695_3: ov5695@36 &#123;</span><br><span class="line">                status = &quot;okay&quot;;</span><br><span class="line">                compatible = &quot;ovti,ov5695&quot;;</span><br><span class="line">                reg = &lt;0x36&gt;;</span><br><span class="line">                clocks = &lt;&amp;cru CLK_MIPI_CAMARAOUT_M3&gt;;</span><br><span class="line">                clock-names = &quot;xvclk&quot;;</span><br><span class="line">                power-domains = &lt;&amp;power RK3588_PD_VI&gt;;</span><br><span class="line">                pinctrl-names = &quot;default&quot;;</span><br><span class="line">                pinctrl-0 = &lt;&amp;mipim0_camera3_clk&gt;;</span><br><span class="line">                reset-gpios = &lt;&amp;gpio1 RK_PD3 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">                pwdn-gpios = &lt;&amp;gpio1 RK_PB0 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">                rockchip,camera-module-index = &lt;2&gt;;</span><br><span class="line">                rockchip,camera-module-facing = &quot;back&quot;;</span><br><span class="line">                rockchip,camera-module-name = &quot;default&quot;;</span><br><span class="line">                rockchip,camera-module-lens-name = &quot;default&quot;;</span><br><span class="line"></span><br><span class="line">                port &#123;</span><br><span class="line">                    ov5695_out_3: endpoint &#123;</span><br><span class="line">                        remote-endpoint = &lt;&amp;mipidphy0_in_ucam0&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            ov13850_3: ov13850@10 &#123;</span><br><span class="line">                status = &quot;okay&quot;;</span><br><span class="line">                compatible = &quot;otvi,ov13850&quot;;</span><br><span class="line">                reg = &lt;0x10&gt;;</span><br><span class="line">                clocks = &lt;&amp;cru CLK_MIPI_CAMARAOUT_M3&gt;;</span><br><span class="line">                clock-names = &quot;xvclk&quot;;</span><br><span class="line">                power-domains = &lt;&amp;power RK3588_PD_VI&gt;;</span><br><span class="line">                pinctrl-names = &quot;default&quot;;</span><br><span class="line">                pinctrl-0 = &lt;&amp;mipim0_camera3_clk&gt;;</span><br><span class="line">                reset-gpios = &lt;&amp;gpio1 RK_PD3 GPIO_ACTIVE_HIGH&gt;;</span><br><span class="line">                pwdn-gpios = &lt;&amp;gpio1 RK_PB0 GPIO_ACTIVE_HIGH&gt;;</span><br><span class="line">                rockchip,camera-module-index = &lt;2&gt;;</span><br><span class="line">                rockchip,camera-module-facing = &quot;back&quot;;</span><br><span class="line">                rockchip,camera-module-name = &quot;CMK-CT0116&quot;;</span><br><span class="line">                rockchip,camera-module-lens-name = &quot;Largan-50013A1&quot;;</span><br><span class="line"></span><br><span class="line">                port &#123;</span><br><span class="line">                    ov13850_out_3: endpoint &#123;</span><br><span class="line">                        remote-endpoint = &lt;&amp;mipidphy0_in_ucam0_ov13850&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2 3 4&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@3 &#123;</span><br><span class="line">        target = &lt;&amp;mipi2_csi2&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            ports &#123;</span><br><span class="line">                port@0 &#123;</span><br><span class="line">                    reg = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">                    mipi2_csi2_input: endpoint@1 &#123;</span><br><span class="line">                        reg = &lt;1&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;csidphy0_out&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                port@1 &#123;</span><br><span class="line">                    reg = &lt;1&gt;;</span><br><span class="line"></span><br><span class="line">                    mipi2_csi2_output: endpoint@0 &#123;</span><br><span class="line">                        reg = &lt;0&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;cif_mipi2_in0&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@4 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@5 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif_mmu&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@6 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif_mipi_lvds2&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            port &#123;</span><br><span class="line">                cif_mipi2_in0: endpoint &#123;</span><br><span class="line">                    remote-endpoint = &lt;&amp;mipi2_csi2_output&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@7 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif_mipi_lvds2_sditf&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            port &#123;</span><br><span class="line">                mipi_lvds2_sditf: endpoint &#123;</span><br><span class="line">                    remote-endpoint = &lt;&amp;isp0_vir0&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@8 &#123;</span><br><span class="line">        target = &lt;&amp;rkisp0&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@9 &#123;</span><br><span class="line">        target = &lt;&amp;isp0_mmu&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@10 &#123;</span><br><span class="line">        target = &lt;&amp;rkisp0_vir0&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            port &#123;</span><br><span class="line">                isp0_vir0: endpoint@0 &#123;</span><br><span class="line">                    reg = &lt;0&gt;;</span><br><span class="line">                    remote-endpoint = &lt;&amp;mipi_lvds2_sditf&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="4-camera_j4_overlaydts"><a class="markdownIt-Anchor" href="#4-camera_j4_overlaydts"></a> 4. <code>camera_j4_overlay.dts</code></h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line">COPY/dts-v1/;</span><br><span class="line">/plugin/;</span><br><span class="line"></span><br><span class="line">#include &lt;dt-bindings/gpio/gpio.h&gt;</span><br><span class="line">#include &lt;dt-bindings/clock/rockchip,rk3588-cru.h&gt;</span><br><span class="line">#include &lt;dt-bindings/pinctrl/rockchip.h&gt;</span><br><span class="line"></span><br><span class="line">/ &#123;</span><br><span class="line">    fragment@0 &#123;</span><br><span class="line">        target = &lt;&amp;csi2_dcphy0&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            ports &#123;</span><br><span class="line">                port@0 &#123;</span><br><span class="line">                    reg = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">                    mipi_in_ucam0: endpoint@1 &#123;</span><br><span class="line">                        reg = &lt;1&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;ov5695_out_1&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    mipi_in_ucam0_ov13850: endpoint@2 &#123;</span><br><span class="line">                        reg = &lt;2&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;ov13850_out_1&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2 3 4&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                port@1 &#123;</span><br><span class="line">                    reg = &lt;1&gt;;</span><br><span class="line"></span><br><span class="line">                    csidcphy0_out: endpoint@0 &#123;</span><br><span class="line">                        reg = &lt;0&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;mipi0_csi2_input&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@1 &#123;</span><br><span class="line">        target = &lt;&amp;mipi_dcphy0&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@2 &#123;</span><br><span class="line">        target = &lt;&amp;i2c2&gt;;</span><br><span class="line"></span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">            pinctrl-0 = &lt;&amp;i2c2m4_xfer&gt;;</span><br><span class="line"></span><br><span class="line">            ov5695_1: ov5695@36 &#123;</span><br><span class="line">                status = &quot;okay&quot;;</span><br><span class="line">                compatible = &quot;ovti,ov5695&quot;;</span><br><span class="line">                reg = &lt;0x36&gt;;</span><br><span class="line">                clocks = &lt;&amp;cru CLK_MIPI_CAMARAOUT_M1&gt;;</span><br><span class="line">                clock-names = &quot;xvclk&quot;;</span><br><span class="line">                power-domains = &lt;&amp;power RK3588_PD_VI&gt;;</span><br><span class="line">                pinctrl-names = &quot;default&quot;;</span><br><span class="line">                pinctrl-0 = &lt;&amp;mipim0_camera1_clk&gt;;</span><br><span class="line">                reset-gpios = &lt;&amp;gpio1 RK_PA3 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">                pwdn-gpios = &lt;&amp;gpio1 RK_PA2 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">                rockchip,camera-module-index = &lt;0&gt;;</span><br><span class="line">                rockchip,camera-module-facing = &quot;back&quot;;</span><br><span class="line">                rockchip,camera-module-name = &quot;default&quot;;</span><br><span class="line">                rockchip,camera-module-lens-name = &quot;default&quot;;</span><br><span class="line"></span><br><span class="line">                port &#123;</span><br><span class="line">                    ov5695_out_1: endpoint &#123;</span><br><span class="line">                        remote-endpoint = &lt;&amp;mipi_in_ucam0&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            ov13850_1: ov13850@10 &#123;</span><br><span class="line">                status = &quot;okay&quot;;</span><br><span class="line">                compatible = &quot;otvi,ov13850&quot;;</span><br><span class="line">                reg = &lt;0x10&gt;;</span><br><span class="line">                clocks = &lt;&amp;cru CLK_MIPI_CAMARAOUT_M1&gt;;</span><br><span class="line">                clock-names = &quot;xvclk&quot;;</span><br><span class="line">                power-domains = &lt;&amp;power RK3588_PD_VI&gt;;</span><br><span class="line">                pinctrl-names = &quot;default&quot;;</span><br><span class="line">                pinctrl-0 = &lt;&amp;mipim0_camera1_clk&gt;;</span><br><span class="line">                reset-gpios = &lt;&amp;gpio1 RK_PA3 GPIO_ACTIVE_HIGH&gt;;</span><br><span class="line">                pwdn-gpios = &lt;&amp;gpio1 RK_PA2 GPIO_ACTIVE_HIGH&gt;;</span><br><span class="line">                rockchip,camera-module-index = &lt;0&gt;;</span><br><span class="line">                rockchip,camera-module-facing = &quot;back&quot;;</span><br><span class="line">                rockchip,camera-module-name = &quot;CMK-CT0116&quot;;</span><br><span class="line">                rockchip,camera-module-lens-name = &quot;Largan-50013A1&quot;;</span><br><span class="line"></span><br><span class="line">                port &#123;</span><br><span class="line">                    ov13850_out_1: endpoint &#123;</span><br><span class="line">                        remote-endpoint = &lt;&amp;mipi_in_ucam0_ov13850&gt;;</span><br><span class="line">                        data-lanes = &lt;1 2 3 4&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@3 &#123;</span><br><span class="line">        target = &lt;&amp;mipi0_csi2&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            ports &#123;</span><br><span class="line">                port@0 &#123;</span><br><span class="line">                    reg = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">                    mipi0_csi2_input: endpoint@1 &#123;</span><br><span class="line">                        reg = &lt;1&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;csidcphy0_out&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                port@1 &#123;</span><br><span class="line">                    reg = &lt;1&gt;;</span><br><span class="line"></span><br><span class="line">                    mipi0_csi2_output: endpoint@0 &#123;</span><br><span class="line">                        reg = &lt;0&gt;;</span><br><span class="line">                        remote-endpoint = &lt;&amp;cif_mipi_in0&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@4 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@5 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif_mmu&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@6 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif_mipi_lvds&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            port &#123;</span><br><span class="line">                cif_mipi_in0: endpoint &#123;</span><br><span class="line">                    remote-endpoint = &lt;&amp;mipi0_csi2_output&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@7 &#123;</span><br><span class="line">        target = &lt;&amp;rkcif_mipi_lvds_sditf&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            port &#123;</span><br><span class="line">                mipi_lvds_sditf: endpoint &#123;</span><br><span class="line">                    remote-endpoint = &lt;&amp;isp0_vir0&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@8 &#123;</span><br><span class="line">        target = &lt;&amp;rkisp0&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@9 &#123;</span><br><span class="line">        target = &lt;&amp;isp0_mmu&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    fragment@10 &#123;</span><br><span class="line">        target = &lt;&amp;rkisp0_vir0&gt;;</span><br><span class="line">        __overlay__ &#123;</span><br><span class="line">            status = &quot;okay&quot;;</span><br><span class="line"></span><br><span class="line">            port &#123;</span><br><span class="line">                isp0_vir0: endpoint@0 &#123;</span><br><span class="line">                    reg = &lt;0&gt;;</span><br><span class="line">                    remote-endpoint = &lt;&amp;mipi_lvds_sditf&gt;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这些设备树overlay文件可以分别应用于不同的摄像头配置，确保每个摄像头模块独立配置，并能动态加载或更新。这些文件将帮助您为不同的摄像头模块设置所需的硬件资源和连接。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-02_瑞芯微/19_瑞芯微AMP系统学习"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/08/29/02_%E7%91%9E%E8%8A%AF%E5%BE%AE/19_%E7%91%9E%E8%8A%AF%E5%BE%AEAMP%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/"
    >瑞芯微AMP系统学习</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/08/29/02_%E7%91%9E%E8%8A%AF%E5%BE%AE/19_%E7%91%9E%E8%8A%AF%E5%BE%AEAMP%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time datetime="2024-08-29T09:17:03.000Z" itemprop="datePublished">2024-08-29</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%91%9E%E8%8A%AF%E5%BE%AE/">瑞芯微</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote>
<p>AMP之前是田田搞的，我认为这个东西很高级，反正听起来是这样的，之前对这个一直很感兴趣，但是并没有真正了解过，正好趁这个机会好好的研究看看。</p>
</blockquote>
<hr />
<h1 id="rockchip平台的amp架构概述"><a class="markdownIt-Anchor" href="#rockchip平台的amp架构概述"></a> <strong>Rockchip平台的AMP架构概述</strong>。</h1>
<hr />
<h2 id="rockchip平台的amp架构概述-2"><a class="markdownIt-Anchor" href="#rockchip平台的amp架构概述-2"></a> Rockchip平台的AMP架构概述</h2>
<h3 id="什么是ampasymmetric-multiprocessing架构"><a class="markdownIt-Anchor" href="#什么是ampasymmetric-multiprocessing架构"></a> 什么是AMP（Asymmetric Multiprocessing）架构？</h3>
<p>在Rockchip平台上，AMP（非对称多处理）架构指的是一种包含多个不同类型处理器核的系统架构。这些核可能运行不同的操作系统或执行不同的任务，从而实现高效的资源利用和任务优化。与对称多处理（SMP）不同，AMP架构中的核并不对称，它们各自负责不同的任务，且具备不同的计算能力和功能特性。</p>
<h3 id="rockchip平台中的amp架构"><a class="markdownIt-Anchor" href="#rockchip平台中的amp架构"></a> Rockchip平台中的AMP架构</h3>
<p>Rockchip平台支持多种组合形式的AMP架构，包括：</p>
<ul>
<li><strong>全Baremetal系统</strong>：基于HAL（Hardware Abstraction Layer）的独立运行部分，是一种简单的低级软件层，用于直接访问处理器特性和外设接口。</li>
<li><strong>RTOS + Baremetal组合</strong>：在这种组合中，RTOS（如RT-Thread）负责管理实时任务，而Baremetal部分则处理底层硬件交互。</li>
<li><strong>Linux + Baremetal组合</strong>：Linux系统负责复杂的应用和系统管理，Baremetal部分则处理特定的低级任务。</li>
<li><strong>Linux + RTOS组合</strong>：Linux系统与RTOS结合使用，前者负责高层次的任务管理，后者则处理时间敏感的任务。</li>
</ul>
<h3 id="amp架构的主要组件"><a class="markdownIt-Anchor" href="#amp架构的主要组件"></a> AMP架构的主要组件</h3>
<ol>
<li><strong>处理器核</strong>
<ul>
<li>Rockchip平台中的处理器核可以分为高性能核和低功耗核。高性能核负责复杂的计算任务，而低功耗核则用于处理简单的、节能型任务。</li>
</ul>
</li>
<li><strong>硬件抽象层（HAL）</strong>
<ul>
<li>HAL是AMP架构中的核心组件之一，它提供对处理器的基本特性（如缓存、 中断和异常）的访问，以及对基础外设（如GPIO、UART、I2C、SPI、CAN、GMAC等）的驱动支持。</li>
</ul>
</li>
<li><strong>操作系统层</strong>
<ul>
<li>在RTOS与Baremetal或Linux与Baremetal的组合中，不同的操作系统（RTOS、Linux、Baremetal）在各自的处理器核上运行。RTOS通常用于处理实时性要求较高的任务，而Linux系统负责资源密集型的任务。</li>
</ul>
</li>
<li><strong>通信机制</strong>
<ul>
<li>在AMP架构下，不同核之间需要有效的通信机制以协调任务和共享资源。这可以通过共享内存、消息传递、中断等方式实现。</li>
</ul>
</li>
</ol>
<h3 id="amp架构的优势"><a class="markdownIt-Anchor" href="#amp架构的优势"></a> AMP架构的优势</h3>
<ol>
<li><strong>性能优化</strong>：通过将任务分配给最适合的处理器核，AMP架构能够显著提高系统的整体性能。例如，实时任务可以分配给RTOS，而复杂的计算任务可以由Linux处理。</li>
<li><strong>节能</strong>：AMP架构可以根据任务需求动态调整处理器核的状态，例如让高性能核在空闲时进入低功耗模式，从而优化能耗。</li>
<li><strong>灵活性</strong>：由于不同的处理器核可以运行不同的操作系统或任务，AMP架构在处理多样化的任务时具有极高的灵活性，能够满足不同应用场景的需求。</li>
</ol>
<h3 id="amp架构的应用场景"><a class="markdownIt-Anchor" href="#amp架构的应用场景"></a> AMP架构的应用场景</h3>
<p>在Rockchip平台上，AMP架构被广泛应用于以下领域：</p>
<ul>
<li><strong>电力物联网</strong>：AMP架构可以实现对电力系统数据的实时监控与处理，确保系统的稳定运行。</li>
<li><strong>电网继电保护</strong>：通过AMP架构中的实时操作系统来处理关键任务，确保继电保护系统的响应速度和可靠性。</li>
<li><strong>工业自动化</strong>：在工业控制系统中，AMP架构允许不同的处理器核处理不同的控制任务，提升系统的灵活性和稳定性。</li>
</ul>
<hr />
<p>这就是Rockchip平台AMP架构的概述！如果你有任何问题或需要更深入的解释，请随时告诉我。你也可以使用**/continue**来继续下一个主题的学习。🦌</p>
<p>我们将继续学习下一个主题：<strong>基于HAL的Baremetal开发</strong>。</p>
<hr />
<h2 id="基于hal的baremetal开发"><a class="markdownIt-Anchor" href="#基于hal的baremetal开发"></a> 基于HAL的Baremetal开发</h2>
<h3 id="什么是baremetal开发"><a class="markdownIt-Anchor" href="#什么是baremetal开发"></a> 什么是Baremetal开发？</h3>
<p>Baremetal开发是一种直接在硬件上运行软件的开发方式，没有操作系统的介入。程序直接与硬件交互，这种方式通常用于对性能要求极高或者资源极度有限的系统。Baremetal开发的一个重要特点是其高度的灵活性和高效性，但也意味着开发者需要处理所有底层硬件的细节。</p>
<h3 id="硬件抽象层hal的作用"><a class="markdownIt-Anchor" href="#硬件抽象层hal的作用"></a> 硬件抽象层（HAL）的作用</h3>
<p>在Rockchip平台上，HAL（Hardware Abstraction Layer，硬件抽象层）是Baremetal开发的核心组件之一。HAL提供了一组API，用于直接访问处理器的基本功能（如缓存管理、中断处理、异常处理）以及基础外设的驱动支持（如GPIO、UART、I2C、SPI、CAN、GMAC等）。</p>
<p>HAL的主要作用包括：</p>
<ol>
<li><strong>简化硬件操作</strong>：HAL为开发者提供了对硬件的抽象接口，简化了直接访问硬件的复杂性，使得开发者无需处理底层硬件的细节。</li>
<li><strong>提高代码的可移植性</strong>：通过使用HAL，开发者可以编写与特定硬件无关的代码，从而提高代码的可移植性。当硬件平台发生变化时，只需修改HAL层的实现，而应用层代码几乎无需改动。</li>
<li><strong>统一的硬件接口</strong>：HAL为不同的外设提供了统一的接口，使得开发者可以通过一致的方式控制不同类型的硬件设备。</li>
</ol>
<h3 id="baremetal开发的关键要点"><a class="markdownIt-Anchor" href="#baremetal开发的关键要点"></a> Baremetal开发的关键要点</h3>
<ol>
<li><strong>初始化处理器</strong>
<ul>
<li>在Baremetal环境中，首先需要初始化处理器的基本功能，包括设置时钟频率、配置缓存、初始化堆栈指针和异常向量表等。</li>
</ul>
</li>
<li><strong>中断管理</strong>
<ul>
<li>中断处理是Baremetal开发中的一个重要部分。需要设置中断向量表，并编写中断服务程序（ISR）来响应和处理各种中断请求。</li>
</ul>
</li>
<li><strong>外设控制</strong>
<ul>
<li>使用HAL API控制和管理外设，例如GPIO用于控制输入输出引脚，UART用于串口通信，I2C和SPI用于与其他设备通信，CAN用于车载网络通信，GMAC用于以太网通信等。</li>
</ul>
</li>
<li><strong>内存管理</strong>
<ul>
<li>在Baremetal开发中，需要手动管理内存。这包括静态内存分配（如全局变量）和动态内存分配（如果需要的话）。</li>
</ul>
</li>
<li><strong>调试与测试</strong>
<ul>
<li>在没有操作系统的情况下，调试Baremetal代码可能会更加困难。通常需要借助硬件调试工具（如JTAG）来调试代码，并通过串口或其他通信接口输出调试信息。</li>
</ul>
</li>
</ol>
<h3 id="baremetal开发的实际应用"><a class="markdownIt-Anchor" href="#baremetal开发的实际应用"></a> Baremetal开发的实际应用</h3>
<p>Baremetal开发通常应用于以下场景：</p>
<ul>
<li><strong>实时性要求高的系统</strong>：由于没有操作系统的开销，Baremetal程序可以实现更快的响应时间，适合对实时性要求极高的应用，例如工业控制系统和嵌入式实时系统。</li>
<li><strong>资源受限的设备</strong>：在资源非常有限的设备（如一些传感器节点或简单的物联网设备）上，Baremetal开发可以最大化地利用硬件资源。</li>
<li><strong>特定功能模块</strong>：在一些复杂系统中，Baremetal开发可以用于实现特定的功能模块，如在RTOS或Linux系统之外的独立任务处理。</li>
</ul>
<h3 id="开发示例gpio控制"><a class="markdownIt-Anchor" href="#开发示例gpio控制"></a> 开发示例：GPIO控制</h3>
<p>以下是一个简单的Baremetal开发示例，使用HAL控制GPIO引脚：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">COPY#include &quot;hal_gpio.h&quot;</span><br><span class="line"></span><br><span class="line">int main(void) &#123;</span><br><span class="line">    // 初始化GPIO引脚</span><br><span class="line">    hal_gpio_init(GPIO_PIN_0);</span><br><span class="line"></span><br><span class="line">    // 设置GPIO引脚为输出模式</span><br><span class="line">    hal_gpio_set_mode(GPIO_PIN_0, GPIO_MODE_OUTPUT);</span><br><span class="line"></span><br><span class="line">    while (1) &#123;</span><br><span class="line">        // 设置GPIO引脚电平为高</span><br><span class="line">        hal_gpio_write(GPIO_PIN_0, GPIO_PIN_SET);</span><br><span class="line">        </span><br><span class="line">        // 等待一段时间</span><br><span class="line">        hal_delay(1000);</span><br><span class="line">        </span><br><span class="line">        // 设置GPIO引脚电平为低</span><br><span class="line">        hal_gpio_write(GPIO_PIN_0, GPIO_PIN_RESET);</span><br><span class="line">        </span><br><span class="line">        // 等待一段时间</span><br><span class="line">        hal_delay(1000);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个代码示例展示了如何在Baremetal环境下使用HAL控制一个GPIO引脚，实现简单的LED闪烁功能。</p>
<hr />
<p>这就是基于HAL的Baremetal开发的基础知识！如果你有任何问题，或者想要进一步探讨某个具体部分，请随时告诉我。如果你准备好继续下一个主题，可以使用**/continue**命令。🦌</p>
<p>我们将继续学习下一个主题：<strong>RTOS + Baremetal架构开发</strong>。</p>
<hr />
<h2 id="rtos-baremetal架构开发"><a class="markdownIt-Anchor" href="#rtos-baremetal架构开发"></a> RTOS + Baremetal架构开发</h2>
<h3 id="什么是rtos-baremetal架构"><a class="markdownIt-Anchor" href="#什么是rtos-baremetal架构"></a> 什么是RTOS + Baremetal架构？</h3>
<p>在RTOS（实时操作系统）和Baremetal架构的组合中，系统利用RTOS来管理和调度时间敏感的任务，同时使用Baremetal来直接控制硬件和处理低级任务。这种架构的优点是可以同时利用RTOS的实时性和Baremetal的高效性，适合需要实时响应和低级硬件控制的应用场景。</p>
<h3 id="rtos与baremetal的协作机制"><a class="markdownIt-Anchor" href="#rtos与baremetal的协作机制"></a> RTOS与Baremetal的协作机制</h3>
<p>在这种架构下，RTOS通常运行在一个或多个处理器核上，用于管理复杂的多任务环境。Baremetal代码则运行在独立的核上，直接控制特定的硬件资源或执行特定的任务。</p>
<ol>
<li><strong>任务管理</strong>
<ul>
<li>RTOS负责管理和调度多个任务，确保关键任务按时执行。它通常包含一个调度器来决定哪个任务在任何给定时间运行。</li>
<li>Baremetal代码独立于RTOS运行，通常负责特定的低级硬件操作，不参与多任务调度。</li>
</ul>
</li>
<li><strong>硬件抽象层（HAL）</strong>
<ul>
<li>在这种架构中，HAL仍然是关键组件。它为Baremetal部分提供了访问硬件的接口，也可以被RTOS使用来简化硬件控制。</li>
</ul>
</li>
<li><strong>通信机制</strong>
<ul>
<li>RTOS和Baremetal之间的通信通常通过共享内存、中断或消息队列来实现。例如，Baremetal部分可以通过触发中断来通知RTOS某个任务已经完成，或者通过共享内存区域传递数据。</li>
</ul>
</li>
</ol>
<h3 id="rtos-baremetal架构的优点"><a class="markdownIt-Anchor" href="#rtos-baremetal架构的优点"></a> RTOS + Baremetal架构的优点</h3>
<ol>
<li><strong>实时性与高效性结合</strong>：RTOS提供了对时间敏感任务的有效管理，而Baremetal部分则可以高效地执行直接的硬件操作，减少延迟。</li>
<li><strong>灵活性</strong>：这种架构允许开发者在同一系统中灵活使用RTOS和Baremetal，以应对不同类型的任务需求。</li>
<li><strong>资源优化</strong>：通过将不同的任务分配给RTOS和Baremetal部分，可以更好地利用系统资源。例如，RTOS可以处理复杂的多任务调度，而Baremetal部分则处理简单且需要快速响应的任务。</li>
</ol>
<h3 id="实际应用中的rtos-baremetal架构"><a class="markdownIt-Anchor" href="#实际应用中的rtos-baremetal架构"></a> 实际应用中的RTOS + Baremetal架构</h3>
<p>这种架构广泛应用于需要高实时性和高效硬件控制的领域，例如：</p>
<ul>
<li><strong>工业自动化</strong>：在工业控制系统中，RTOS管理着系统的整体运行和任务调度，而Baremetal部分直接控制工业设备的传感器和执行器。</li>
<li><strong>电力系统</strong>：在电力继电保护和电网控制系统中，RTOS用于管理系统的正常运行和故障处理，而Baremetal部分则实时监控电力线路状态，确保系统的稳定性。</li>
<li><strong>嵌入式设备</strong>：在一些嵌入式设备中，RTOS负责设备的主控逻辑和用户界面管理，而Baremetal部分则处理与传感器和外设的低级通信。</li>
</ul>
<h3 id="开发示例rtos任务与baremetal硬件控制"><a class="markdownIt-Anchor" href="#开发示例rtos任务与baremetal硬件控制"></a> 开发示例：RTOS任务与Baremetal硬件控制</h3>
<p>以下是一个简单的示例，展示如何在RTOS中管理任务，并使用Baremetal部分控制硬件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">COPY// RTOS任务管理部分</span><br><span class="line">#include &quot;rtos.h&quot;</span><br><span class="line">#include &quot;hal_gpio.h&quot;</span><br><span class="line"></span><br><span class="line">void task_blink_led(void *pvParameters) &#123;</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        hal_gpio_toggle(GPIO_PIN_0);</span><br><span class="line">        rtos_delay(1000);  // 延时1秒</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(void) &#123;</span><br><span class="line">    rtos_init();  // 初始化RTOS</span><br><span class="line"></span><br><span class="line">    // 创建LED闪烁任务</span><br><span class="line">    rtos_create_task(task_blink_led, &quot;Blink LED&quot;, configMINIMAL_STACK_SIZE, NULL, 1, NULL);</span><br><span class="line"></span><br><span class="line">    rtos_start_scheduler();  // 启动RTOS调度器</span><br><span class="line"></span><br><span class="line">    while (1) &#123;</span><br><span class="line">        // 在这里可以执行Baremetal代码</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Baremetal硬件控制部分</span><br><span class="line">#include &quot;hal_gpio.h&quot;</span><br><span class="line"></span><br><span class="line">int baremetal_init(void) &#123;</span><br><span class="line">    hal_gpio_init(GPIO_PIN_0);  // 初始化GPIO引脚</span><br><span class="line">    hal_gpio_set_mode(GPIO_PIN_0, GPIO_MODE_OUTPUT);  // 设置为输出模式</span><br><span class="line"></span><br><span class="line">    // 可以在这里添加更多Baremetal硬件控制代码</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个示例中，RTOS管理一个简单的任务来控制LED的闪烁，而Baremetal部分负责初始化硬件。RTOS与Baremetal部分相互独立运行，共同实现系统的功能。</p>
<hr />
<p>这就是RTOS + Baremetal架构开发的基础知识！如果你有任何问题，或者想要进一步探讨某个具体部分，请随时告诉我。如果你准备好继续下一个主题，可以使用**/continue**命令。🦌</p>
<p>我们将继续学习下一个主题：<strong>Linux + Baremetal架构开发</strong>。</p>
<hr />
<h2 id="linux-baremetal架构开发"><a class="markdownIt-Anchor" href="#linux-baremetal架构开发"></a> Linux + Baremetal架构开发</h2>
<h3 id="什么是linux-baremetal架构"><a class="markdownIt-Anchor" href="#什么是linux-baremetal架构"></a> 什么是Linux + Baremetal架构？</h3>
<p>在Linux + Baremetal架构中，系统中的一部分处理器核运行完整的Linux操作系统，用于处理复杂的多任务环境和资源密集型应用程序；同时，另一部分处理器核以Baremetal方式运行，直接控制特定硬件或执行时间敏感的任务。此架构在需要同时满足高级系统管理和低级硬件控制需求的场景中非常有用。</p>
<h3 id="linux与baremetal的协作机制"><a class="markdownIt-Anchor" href="#linux与baremetal的协作机制"></a> Linux与Baremetal的协作机制</h3>
<p>在这种架构中，Linux系统通常运行在高性能核上，管理应用程序、系统服务和外围设备。Baremetal部分则运行在低功耗核或专用核上，负责处理实时性要求较高或需要直接硬件访问的任务。</p>
<ol>
<li><strong>任务分配</strong>
<ul>
<li><strong>Linux核</strong>：负责复杂任务，如文件系统管理、网络通信、多任务调度等。</li>
<li><strong>Baremetal核</strong>：处理特定任务，如实时传感器数据采集、信号处理或关键任务的执行。</li>
</ul>
</li>
<li><strong>通信机制</strong>
<ul>
<li>Linux和Baremetal部分之间的通信可以通过多种机制实现，例如共享内存、消息传递、中断通知等。</li>
<li>常见的方式是在Linux侧设置一个内核模块或用户空间程序，通过共享内存区域与Baremetal核交换数据。</li>
</ul>
</li>
<li><strong>硬件资源管理</strong>
<ul>
<li>Linux和Baremetal通常会各自管理部分硬件资源。例如，Linux管理通用外设（如存储、网络接口），而Baremetal管理特定的外设（如高速传感器接口、专用处理单元）。</li>
</ul>
</li>
</ol>
<h3 id="linux-baremetal架构的优点"><a class="markdownIt-Anchor" href="#linux-baremetal架构的优点"></a> Linux + Baremetal架构的优点</h3>
<ol>
<li><strong>复杂任务和实时任务的分离</strong>：Linux系统擅长处理复杂、非实时任务，而Baremetal部分则专注于时间敏感的任务，两者结合可以优化整体系统性能。</li>
<li><strong>资源优化</strong>：这种架构允许在同一平台上高效利用硬件资源。Linux系统可以执行复杂的任务，同时Baremetal部分处理低级硬件控制，避免资源浪费。</li>
<li><strong>灵活性与定制化</strong>：开发者可以根据应用需求灵活配置Linux和Baremetal的职责范围，从而满足多样化的需求。</li>
</ol>
<h3 id="实际应用中的linux-baremetal架构"><a class="markdownIt-Anchor" href="#实际应用中的linux-baremetal架构"></a> 实际应用中的Linux + Baremetal架构</h3>
<p>这种架构在以下领域得到广泛应用：</p>
<ul>
<li><strong>电力系统</strong>：在电力物联网和电网控制中，Linux系统用于管理和分析大规模数据，而Baremetal部分则实时监控电力设备状态，确保系统的快速响应。</li>
<li><strong>汽车电子</strong>：在汽车电子系统中，Linux用于运行复杂的娱乐和导航系统，而Baremetal部分控制实时性要求高的传感器和执行器。</li>
<li><strong>工业控制</strong>：在工业自动化中，Linux系统管理高层次的控制任务，如网络通信和数据处理，而Baremetal部分执行实时控制任务，如传感器数据采集和机器控制。</li>
</ul>
<h3 id="开发示例linux与baremetal的通信"><a class="markdownIt-Anchor" href="#开发示例linux与baremetal的通信"></a> 开发示例：Linux与Baremetal的通信</h3>
<p>以下是一个简单的示例，展示如何通过共享内存实现Linux和Baremetal部分之间的通信：</p>
<h4 id="baremetal部分"><a class="markdownIt-Anchor" href="#baremetal部分"></a> Baremetal部分：</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">COPY#include &quot;hal_shared_memory.h&quot;</span><br><span class="line">#include &quot;hal_interrupt.h&quot;</span><br><span class="line"></span><br><span class="line">#define SHARED_MEMORY_BASE 0x80000000  // 假设的共享内存地址</span><br><span class="line">volatile uint32_t *shared_memory = (uint32_t *)SHARED_MEMORY_BASE;</span><br><span class="line"></span><br><span class="line">void baremetal_task(void) &#123;</span><br><span class="line">    // 读取共享内存中的数据</span><br><span class="line">    uint32_t data = shared_memory[0];</span><br><span class="line"></span><br><span class="line">    // 处理数据</span><br><span class="line">    data = data + 1;</span><br><span class="line"></span><br><span class="line">    // 将处理后的数据写回共享内存</span><br><span class="line">    shared_memory[1] = data;</span><br><span class="line"></span><br><span class="line">    // 触发中断通知Linux</span><br><span class="line">    hal_interrupt_trigger(LINUX_INTERRUPT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(void) &#123;</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        baremetal_task();</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="linux部分内核模块示例"><a class="markdownIt-Anchor" href="#linux部分内核模块示例"></a> Linux部分（内核模块示例）：</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">COPY#include &lt;linux/module.h&gt;</span><br><span class="line">#include &lt;linux/kernel.h&gt;</span><br><span class="line">#include &lt;linux/init.h&gt;</span><br><span class="line">#include &lt;linux/io.h&gt;</span><br><span class="line">#include &lt;linux/interrupt.h&gt;</span><br><span class="line"></span><br><span class="line">#define SHARED_MEMORY_BASE 0x80000000  // 与Baremetal部分共享的内存地址</span><br><span class="line">volatile uint32_t *shared_memory;</span><br><span class="line"></span><br><span class="line">static irqreturn_t baremetal_irq_handler(int irq, void *dev_id) &#123;</span><br><span class="line">    uint32_t data = shared_memory[1];</span><br><span class="line">    printk(KERN_INFO &quot;Received data from Baremetal: %u\n&quot;, data);</span><br><span class="line">    return IRQ_HANDLED;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static int __init linux_baremetal_init(void) &#123;</span><br><span class="line">    shared_memory = ioremap(SHARED_MEMORY_BASE, sizeof(uint32_t) * 2);</span><br><span class="line"></span><br><span class="line">    // 注册中断处理程序</span><br><span class="line">    request_irq(LINUX_INTERRUPT, baremetal_irq_handler, IRQF_SHARED, &quot;baremetal_irq&quot;, NULL);</span><br><span class="line"></span><br><span class="line">    printk(KERN_INFO &quot;Linux + Baremetal module initialized\n&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void __exit linux_baremetal_exit(void) &#123;</span><br><span class="line">    free_irq(LINUX_INTERRUPT, NULL);</span><br><span class="line">    iounmap(shared_memory);</span><br><span class="line">    printk(KERN_INFO &quot;Linux + Baremetal module exited\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(linux_baremetal_init);</span><br><span class="line">module_exit(linux_baremetal_exit);</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(&quot;GPL&quot;);</span><br><span class="line">MODULE_AUTHOR(&quot;Developer&quot;);</span><br><span class="line">MODULE_DESCRIPTION(&quot;Linux + Baremetal Communication Example&quot;);</span><br></pre></td></tr></table></figure>
<p>在这个示例中，Baremetal部分通过共享内存将处理过的数据传递给Linux，并通过中断机制通知Linux读取数据。Linux侧通过内核模块接收中断并读取共享内存中的数据，从而实现了两个系统之间的协作。</p>
<hr />
<p>这就是Linux + Baremetal架构开发的基础知识！如果你有任何问题，或者想要进一步探讨某个具体部分，请随时告诉我。如果你准备好继续下一个主题，可以使用**/continue**命令。🦌</p>
<p>我们将继续学习下一个主题：<strong>Linux + RTOS架构开发</strong>。</p>
<hr />
<h2 id="linux-rtos架构开发"><a class="markdownIt-Anchor" href="#linux-rtos架构开发"></a> Linux + RTOS架构开发</h2>
<h3 id="什么是linux-rtos架构"><a class="markdownIt-Anchor" href="#什么是linux-rtos架构"></a> 什么是Linux + RTOS架构？</h3>
<p>在Linux + RTOS（实时操作系统）架构中，系统的部分处理器核运行完整的Linux操作系统，而其他处理器核运行RTOS。这个架构结合了Linux强大的多任务处理能力和RTOS的实时性能，适用于需要同时处理复杂应用和实时任务的场景。</p>
<h3 id="linux与rtos的协作机制"><a class="markdownIt-Anchor" href="#linux与rtos的协作机制"></a> Linux与RTOS的协作机制</h3>
<p>在这种架构中，Linux系统通常负责管理和运行复杂的应用程序，如网络通信、文件系统、用户界面等。而RTOS则负责执行需要严格时间控制的任务，如实时数据处理、紧急控制任务等。</p>
<ol>
<li><strong>任务分配</strong>
<ul>
<li><strong>Linux核</strong>：负责资源密集型的任务，如处理大数据、运行复杂算法、网络通信和用户界面管理。</li>
<li><strong>RTOS核</strong>：处理实时性要求高的任务，如传感器数据采集、控制系统和时间敏感的计算任务。</li>
</ul>
</li>
<li><strong>通信机制</strong>
<ul>
<li>Linux和RTOS之间的通信通常通过共享内存、消息队列或中断等机制实现。共享内存是一种常见的方式，它允许两个系统快速交换数据。</li>
<li>中断机制可以用于Linux通知RTOS某个任务需要立即执行，或反过来通知Linux某个事件已经发生。</li>
</ul>
</li>
<li><strong>资源管理</strong>
<ul>
<li>在这种架构中，Linux和RTOS通常管理各自独立的硬件资源。例如，Linux管理网络接口、存储设备，而RTOS管理时间敏感的I/O接口，如传感器和执行器。</li>
</ul>
</li>
</ol>
<h3 id="linux-rtos架构的优点"><a class="markdownIt-Anchor" href="#linux-rtos架构的优点"></a> Linux + RTOS架构的优点</h3>
<ol>
<li><strong>实时性与复杂任务处理的结合</strong>：这种架构允许同时处理复杂的多任务应用（通过Linux）和严格的实时任务（通过RTOS），提供了灵活性和强大的功能。</li>
<li><strong>系统稳定性</strong>：通过将实时任务与复杂的非实时任务分离开来，可以提高系统的稳定性。即使Linux系统负载很高，RTOS仍能确保关键任务按时执行。</li>
<li><strong>灵活性</strong>：开发者可以根据需求灵活地配置系统，选择将哪些任务放在Linux上运行，哪些任务放在RTOS上运行。</li>
</ol>
<h3 id="实际应用中的linux-rtos架构"><a class="markdownIt-Anchor" href="#实际应用中的linux-rtos架构"></a> 实际应用中的Linux + RTOS架构</h3>
<p>这种架构广泛应用于以下领域：</p>
<ul>
<li><strong>汽车电子</strong>：在汽车控制系统中，RTOS负责处理实时的车载传感器数据和控制任务，而Linux则用于运行导航、娱乐系统等复杂应用。</li>
<li><strong>工业自动化</strong>：在工业控制系统中，RTOS负责时间敏感的控制任务，如机械臂的实时控制，而Linux负责高层次的监控和数据处理。</li>
<li><strong>医疗设备</strong>：在医疗设备中，RTOS管理实时监控和控制功能，如患者生命体征的实时监测，而Linux处理数据存储、用户界面和远程通信。</li>
</ul>
<h3 id="开发示例linux与rtos的通信"><a class="markdownIt-Anchor" href="#开发示例linux与rtos的通信"></a> 开发示例：Linux与RTOS的通信</h3>
<p>以下是一个简单的示例，展示如何通过共享内存实现Linux与RTOS之间的通信：</p>
<h4 id="rtos部分基于rt-thread的示例"><a class="markdownIt-Anchor" href="#rtos部分基于rt-thread的示例"></a> RTOS部分（基于RT-Thread的示例）：</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">COPY#include &quot;rtthread.h&quot;</span><br><span class="line">#include &quot;hal_shared_memory.h&quot;</span><br><span class="line">#include &quot;hal_interrupt.h&quot;</span><br><span class="line"></span><br><span class="line">#define SHARED_MEMORY_BASE 0x80000000  // 假设的共享内存地址</span><br><span class="line">volatile uint32_t *shared_memory = (uint32_t *)SHARED_MEMORY_BASE;</span><br><span class="line"></span><br><span class="line">void rt_thread_entry(void *parameter) &#123;</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        // 读取共享内存中的数据</span><br><span class="line">        uint32_t data = shared_memory[0];</span><br><span class="line">        </span><br><span class="line">        // 处理数据</span><br><span class="line">        data = data + 1;</span><br><span class="line">        </span><br><span class="line">        // 将处理后的数据写回共享内存</span><br><span class="line">        shared_memory[1] = data;</span><br><span class="line">        </span><br><span class="line">        // 触发中断通知Linux</span><br><span class="line">        hal_interrupt_trigger(LINUX_INTERRUPT);</span><br><span class="line">        </span><br><span class="line">        rt_thread_mdelay(1000);  // 延时1秒</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(void) &#123;</span><br><span class="line">    // 创建RTOS线程</span><br><span class="line">    rt_thread_t thread = rt_thread_create(&quot;rt_thread&quot;, rt_thread_entry, RT_NULL, 1024, 10, 10);</span><br><span class="line">    </span><br><span class="line">    if (thread != RT_NULL) &#123;</span><br><span class="line">        rt_thread_startup(thread);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="linux部分内核模块示例-2"><a class="markdownIt-Anchor" href="#linux部分内核模块示例-2"></a> Linux部分（内核模块示例）：</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">COPY#include &lt;linux/module.h&gt;</span><br><span class="line">#include &lt;linux/kernel.h&gt;</span><br><span class="line">#include &lt;linux/init.h&gt;</span><br><span class="line">#include &lt;linux/io.h&gt;</span><br><span class="line">#include &lt;linux/interrupt.h&gt;</span><br><span class="line"></span><br><span class="line">#define SHARED_MEMORY_BASE 0x80000000  // 与RTOS部分共享的内存地址</span><br><span class="line">volatile uint32_t *shared_memory;</span><br><span class="line"></span><br><span class="line">static irqreturn_t rtos_irq_handler(int irq, void *dev_id) &#123;</span><br><span class="line">    uint32_t data = shared_memory[1];</span><br><span class="line">    printk(KERN_INFO &quot;Received data from RTOS: %u\n&quot;, data);</span><br><span class="line">    return IRQ_HANDLED;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static int __init linux_rtos_init(void) &#123;</span><br><span class="line">    shared_memory = ioremap(SHARED_MEMORY_BASE, sizeof(uint32_t) * 2);</span><br><span class="line"></span><br><span class="line">    // 注册中断处理程序</span><br><span class="line">    request_irq(LINUX_INTERRUPT, rtos_irq_handler, IRQF_SHARED, &quot;rtos_irq&quot;, NULL);</span><br><span class="line"></span><br><span class="line">    printk(KERN_INFO &quot;Linux + RTOS module initialized\n&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void __exit linux_rtos_exit(void) &#123;</span><br><span class="line">    free_irq(LINUX_INTERRUPT, NULL);</span><br><span class="line">    iounmap(shared_memory);</span><br><span class="line">    printk(KERN_INFO &quot;Linux + RTOS module exited\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(linux_rtos_init);</span><br><span class="line">module_exit(linux_rtos_exit);</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(&quot;GPL&quot;);</span><br><span class="line">MODULE_AUTHOR(&quot;Developer&quot;);</span><br><span class="line">MODULE_DESCRIPTION(&quot;Linux + RTOS Communication Example&quot;);</span><br></pre></td></tr></table></figure>
<p>在这个示例中，RTOS线程通过共享内存与Linux交换数据，并通过中断机制通知Linux某个事件已完成。Linux通过内核模块接收中断并读取共享内存中的数据。</p>
<hr />
<p>这就是Linux + RTOS架构开发的基础知识！如果你有任何问题，或者想要进一步探讨某个具体部分，请随时告诉我。如果你准备好继续下一个主题，可以使用**/continue**命令。🦌</p>
<p>我们将继续学习下一个主题：<strong>AMP系统在电力和工业自动化中的应用</strong>。</p>
<hr />
<h2 id="amp系统在电力和工业自动化中的应用"><a class="markdownIt-Anchor" href="#amp系统在电力和工业自动化中的应用"></a> AMP系统在电力和工业自动化中的应用</h2>
<h3 id="什么是amp系统"><a class="markdownIt-Anchor" href="#什么是amp系统"></a> 什么是AMP系统？</h3>
<p>AMP（Asymmetric Multiprocessing）系统是一种利用异构处理器核的计算架构，系统中的不同核可能运行不同的操作系统或执行不同类型的任务。AMP系统通过合理分配任务给最合适的处理器核来优化整体性能和能效，尤其适合需要高实时性和多任务处理的场景。</p>
<h3 id="amp系统在电力行业的应用"><a class="markdownIt-Anchor" href="#amp系统在电力行业的应用"></a> AMP系统在电力行业的应用</h3>
<h4 id="1-电力物联网"><a class="markdownIt-Anchor" href="#1-电力物联网"></a> 1. <strong>电力物联网</strong></h4>
<ul>
<li><strong>数据采集与处理</strong>：在电力物联网（IoT）中，AMP系统可用于实时采集和处理来自电力设备的传感器数据。低功耗核可能运行Baremetal或RTOS，专门处理数据采集任务，而高性能核则运行Linux，负责数据分析和通信。</li>
<li><strong>远程监控与控制</strong>：AMP系统支持在高性能核上运行复杂的监控软件，同时在实时核上执行关键控制任务。例如，RTOS核可以直接控制电网设备，而Linux核则管理监控和通信。</li>
</ul>
<h4 id="2-电网继电保护"><a class="markdownIt-Anchor" href="#2-电网继电保护"></a> 2. <strong>电网继电保护</strong></h4>
<ul>
<li><strong>实时故障检测</strong>：AMP系统可以在RTOS核上实现快速的故障检测和继电保护响应，确保电力系统在出现故障时能够迅速隔离故障区，防止故障扩散。</li>
<li><strong>安全与可靠性</strong>：通过AMP架构的分离处理机制，系统能够在Linux核上执行复杂的数据分析和日志记录，而RTOS核则负责实时的安全监控，保证系统的高可靠性。</li>
</ul>
<h4 id="3-电力系统安全控制"><a class="markdownIt-Anchor" href="#3-电力系统安全控制"></a> 3. <strong>电力系统安全控制</strong></h4>
<ul>
<li><strong>多层次控制</strong>：在电力系统中，AMP架构允许不同层次的控制任务在不同核上独立运行。例如，高层次的控制任务在Linux系统中执行，而实时性要求较高的低层次控制任务则由RTOS处理。</li>
<li><strong>系统冗余</strong>：AMP系统可以设计成冗余结构，确保即使部分处理器核出现故障，其他核仍然可以接管关键控制任务，保持系统稳定运行。</li>
</ul>
<h3 id="amp系统在工业自动化中的应用"><a class="markdownIt-Anchor" href="#amp系统在工业自动化中的应用"></a> AMP系统在工业自动化中的应用</h3>
<h4 id="1-实时控制系统"><a class="markdownIt-Anchor" href="#1-实时控制系统"></a> 1. <strong>实时控制系统</strong></h4>
<ul>
<li><strong>机械控制</strong>：在工业自动化中，RTOS核可以负责机械臂、传送带等设备的实时控制，确保精确的操作时序和快速响应。而Linux核则可以运行高级任务，如生产线管理、质量监控和数据分析。</li>
<li><strong>传感器集成</strong>：AMP系统可以集成各种传感器数据，并通过不同的处理器核进行分类处理。例如，温度传感器数据可以由Baremetal核处理，确保低延迟响应，而视觉传感器数据则可以由Linux核进行复杂的图像处理。</li>
</ul>
<h4 id="2-工业网络与通信"><a class="markdownIt-Anchor" href="#2-工业网络与通信"></a> 2. <strong>工业网络与通信</strong></h4>
<ul>
<li><strong>实时数据交换</strong>：AMP系统可以通过实时核（运行RTOS）处理工业通信协议（如CAN、EtherCAT），确保实时性和数据传输的可靠性。同时，Linux核可以负责管理网络堆栈和处理来自其他系统的数据流。</li>
<li><strong>边缘计算</strong>：在工业物联网（IIoT）中，AMP系统可用于边缘计算，将部分数据处理和分析任务放在本地RTOS核上执行，减少数据传输延迟，而复杂的决策任务则交由Linux核处理。</li>
</ul>
<h4 id="3-故障诊断与维护"><a class="markdownIt-Anchor" href="#3-故障诊断与维护"></a> 3. <strong>故障诊断与维护</strong></h4>
<ul>
<li><strong>预防性维护</strong>：AMP系统可以在RTOS核上实现对设备的实时监控和诊断，及时发现潜在的故障风险。同时，Linux核可以进行历史数据分析，预测设备的维护需求。</li>
<li><strong>远程故障处理</strong>：在出现故障时，AMP系统能够通过Linux核提供远程访问和控制，而RTOS核则执行本地的紧急处理任务，确保系统的持续运行。</li>
</ul>
<h3 id="实际案例分析"><a class="markdownIt-Anchor" href="#实际案例分析"></a> 实际案例分析</h3>
<ul>
<li><strong>智能电网</strong>：在智能电网中，AMP架构被用来管理大量的分布式能源资源，实时监控电网状态，并在检测到异常时迅速做出响应。Linux核管理高级调度和通信，RTOS核处理关键的继电保护任务。</li>
<li><strong>工业4.0生产线</strong>：在工业4.0的智能生产线中，AMP系统通过实时监控设备状态和控制生产流程，提高了生产效率和产品质量。RTOS核负责设备的实时控制，而Linux核则管理整个生产线的调度和优化。</li>
</ul>
<hr />
<p>这就是AMP系统在电力和工业自动化中的应用的基础知识！如果你有任何问题，或者想要进一步探讨某个具体部分，请随时告诉我。如果你准备好继续下一个主题，可以使用**/continue**命令。🦌</p>
<h1 id="rt-thread学习"><a class="markdownIt-Anchor" href="#rt-thread学习"></a> RT-Thread学习</h1>
<p>RT-Thread是一个开源的嵌入式实时操作系统，广泛应用于物联网、工业控制、消费电子等领域。它以其轻量级、高效和模块化的特点而著称。RT-Thread提供了一个丰富的组件库，包括线程管理、内存管理、设备框架、网络栈和GUI系统，这些组件使开发者能够快速构建复杂的嵌入式系统。</p>
<h2 id="主题-rt-thread简介"><a class="markdownIt-Anchor" href="#主题-rt-thread简介"></a> <strong>主题</strong>: RT-Thread简介</h2>
<h3 id="历史与发展"><a class="markdownIt-Anchor" href="#历史与发展"></a> 历史与发展</h3>
<p>RT-Thread于2006年首次发布，旨在为资源有限的嵌入式设备提供一个灵活的操作系统。随着时间的推移，RT-Thread逐渐发展壮大，社区贡献者也越来越多。如今，RT-Thread已经成为全球最受欢迎的开源RTOS之一，被广泛用于各种嵌入式应用中。</p>
<h3 id="rt-thread的特点"><a class="markdownIt-Anchor" href="#rt-thread的特点"></a> RT-Thread的特点</h3>
<ul>
<li><strong>模块化设计</strong>: RT-Thread采用模块化设计，开发者可以根据需求裁剪系统，从而在资源受限的设备上运行。</li>
<li><strong>丰富的组件库</strong>: 提供了从基础功能到高级功能的一系列组件，涵盖了嵌入式开发的各个方面。</li>
<li><strong>支持多种架构</strong>: RT-Thread支持多种处理器架构，如ARM Cortex-M系列、RISC-V等。</li>
<li><strong>广泛的应用场景</strong>: RT-Thread被应用于物联网设备、智能家居、工业自动化等多个领域。</li>
</ul>
<h3 id="主要应用领域"><a class="markdownIt-Anchor" href="#主要应用领域"></a> 主要应用领域</h3>
<ol>
<li><strong>物联网（IoT）</strong>: RT-Thread在物联网设备中得到了广泛应用，特别是在需要低功耗和高效实时性能的场景下。</li>
<li><strong>工业控制</strong>: 在工业控制系统中，RT-Thread以其稳定性和高效性得到了认可，成为了众多工业设备的操作系统选择。</li>
<li><strong>消费电子</strong>: RT-Thread在智能家居设备、可穿戴设备等消费电子产品中也有着广泛的应用。</li>
</ol>
<h2 id="主题-rt-thread内核架构"><a class="markdownIt-Anchor" href="#主题-rt-thread内核架构"></a> <strong>主题</strong>: RT-Thread内核架构</h2>
<p>RT-Thread的内核架构是其性能和灵活性的基础。了解内核的设计理念和实现细节对于深入掌握RT-Thread非常重要。我们将从内核的关键组成部分开始，逐步探讨其设计与功能。</p>
<h4 id="1-内核概述"><a class="markdownIt-Anchor" href="#1-内核概述"></a> 1. 内核概述</h4>
<p>RT-Thread的内核是一个微内核，具有简洁、高效和可移植的特点。它主要负责以下几个方面的功能：</p>
<ul>
<li><strong>线程管理</strong>: 负责线程的创建、调度、销毁以及状态管理。</li>
<li><strong>内存管理</strong>: 提供动态内存分配、堆栈管理以及内存池的支持。</li>
<li><strong>中断处理</strong>: 处理外部中断，并将中断服务例程（ISR）与线程切换无缝集成。</li>
<li><strong>定时器管理</strong>: 提供硬件和软件定时器支持，实现周期性任务调度。</li>
</ul>
<h4 id="2-线程管理"><a class="markdownIt-Anchor" href="#2-线程管理"></a> 2. 线程管理</h4>
<p>线程管理是RT-Thread内核的核心功能之一。线程（或称任务）是RT-Thread中的基本执行单元。以下是RT-Thread的线程管理机制：</p>
<ul>
<li><strong>优先级调度</strong>: RT-Thread采用优先级调度算法，支持多级优先级，确保高优先级任务优先执行。</li>
<li><strong>时间片轮转</strong>: 对于同一优先级的线程，RT-Thread使用时间片轮转的方式调度线程，以实现公平性。</li>
<li><strong>线程状态</strong>: 每个线程可以处于以下状态之一：就绪（Ready）、运行（Running）、挂起（Suspended）、阻塞（Blocked）等。</li>
<li><strong>线程控制块（TCB）</strong>: RT-Thread通过线程控制块（TCB）来管理每个线程的状态、优先级、堆栈等信息。</li>
</ul>
<h4 id="3-内存管理"><a class="markdownIt-Anchor" href="#3-内存管理"></a> 3. 内存管理</h4>
<p>RT-Thread的内存管理模块支持多种内存管理方式，以满足不同应用场景的需求：</p>
<ul>
<li><strong>静态内存分配</strong>: 在编译时分配固定大小的内存区域，适用于资源受限的系统。</li>
<li><strong>动态内存分配</strong>: 使用堆（heap）来动态分配和释放内存，提供更大的灵活性。</li>
<li><strong>内存池</strong>: 通过预先分配的内存块（memory block）来提高内存分配和释放的效率。</li>
</ul>
<h4 id="4-中断处理"><a class="markdownIt-Anchor" href="#4-中断处理"></a> 4. 中断处理</h4>
<p>中断是嵌入式系统中非常重要的机制，用于响应外部事件。RT-Thread的中断处理机制包括：</p>
<ul>
<li><strong>中断服务例程（ISR）</strong>: 当中断发生时，RT-Thread调用对应的中断服务例程来处理事件。</li>
<li><strong>中断嵌套</strong>: 支持中断嵌套，允许更高优先级的中断在低优先级的中断处理中打断。</li>
<li><strong>中断线程化</strong>: RT-Thread允许将中断服务例程的处理推迟到线程上下文中执行，以减少中断处理的延迟。</li>
</ul>
<h4 id="5-定时器管理"><a class="markdownIt-Anchor" href="#5-定时器管理"></a> 5. 定时器管理</h4>
<p>RT-Thread提供硬件和软件定时器来支持实时任务调度：</p>
<ul>
<li><strong>硬件定时器</strong>: 直接依赖于处理器的硬件计时器，通常用于精确的时间管理。</li>
<li><strong>软件定时器</strong>: 基于系统时钟实现的软件定时器，适用于不太严格的时间要求。</li>
</ul>
<hr />
<p>RT-Thread的内核架构为其在嵌入式系统中的高效运行提供了坚实的基础。了解这些核心机制将帮助您在实际开发中更好地利用RT-Thread的功能。</p>
<p>请问您是否有任何问题？如果没有，我们可以继续学习下一节课内容：<strong>任务与线程管理</strong>。</p>
<h2 id="主题如何让rt-thread跑在rockchip上"><a class="markdownIt-Anchor" href="#主题如何让rt-thread跑在rockchip上"></a> 主题：如何让RT-Thread跑在Rockchip上</h2>
<p>要让RT-Thread运行在Rockchip的处理器上，需要经过几个关键步骤，包括环境搭建、内核移植、驱动程序开发和应用程序编写。以下是一个详细的指南，帮助您在Rockchip平台上成功运行RT-Thread。</p>
<h3 id="1-环境搭建"><a class="markdownIt-Anchor" href="#1-环境搭建"></a> 1. 环境搭建</h3>
<h4 id="11-获取开发板和芯片支持"><a class="markdownIt-Anchor" href="#11-获取开发板和芯片支持"></a> 1.1 获取开发板和芯片支持</h4>
<p>首先，您需要获取一个支持Rockchip处理器的开发板，如RK3288、RK3399等。确保开发板的硬件文档和驱动支持能够获取到。</p>
<h4 id="12-安装交叉编译工具链"><a class="markdownIt-Anchor" href="#12-安装交叉编译工具链"></a> 1.2 安装交叉编译工具链</h4>
<p>为了在ARM架构的Rockchip处理器上编译RT-Thread，您需要安装一个交叉编译工具链。通常使用的工具链是<strong>GNU ARM Toolchain</strong>，您可以在以下链接下载：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm">GNU ARM Toolchain 下载地址</a></li>
</ul>
<p>安装完成后，确认工具链路径已经正确配置到环境变量中。</p>
<h3 id="2-移植rt-thread到rockchip平台"><a class="markdownIt-Anchor" href="#2-移植rt-thread到rockchip平台"></a> 2. 移植RT-Thread到Rockchip平台</h3>
<h4 id="21-获取rt-thread源码"><a class="markdownIt-Anchor" href="#21-获取rt-thread源码"></a> 2.1 获取RT-Thread源码</h4>
<p>从RT-Thread的官方GitHub仓库克隆最新的RT-Thread源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit clone https://github.com/RT-Thread/rt-thread.git</span><br></pre></td></tr></table></figure>
<h4 id="22-配置rt-thread"><a class="markdownIt-Anchor" href="#22-配置rt-thread"></a> 2.2 配置RT-Thread</h4>
<p>进入RT-Thread源码目录，并使用<code>menuconfig</code>或<code>Kconfig</code>工具配置RT-Thread内核。配置过程中，您需要根据Rockchip的硬件特点选择合适的内核选项和驱动支持。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">COPYcd rt-thread</span><br><span class="line">scons --menuconfig</span><br></pre></td></tr></table></figure>
<p>在配置中，确保选择了ARM架构，并配置了与Rockchip处理器对应的CPU选项。</p>
<h4 id="23-添加硬件抽象层hal"><a class="markdownIt-Anchor" href="#23-添加硬件抽象层hal"></a> 2.3 添加硬件抽象层（HAL）</h4>
<p>如果RT-Thread官方没有提供对特定Rockchip芯片的支持，您需要自己编写或移植硬件抽象层（HAL）。HAL需要处理的部分包括：</p>
<ul>
<li><strong>时钟管理</strong></li>
<li><strong>中断控制</strong></li>
<li><strong>存储器映射</strong></li>
<li><strong>外设初始化</strong></li>
</ul>
<p>您可以参考RT-Thread对其他ARM Cortex-A系列芯片的移植来进行修改。</p>
<h3 id="3-驱动程序开发"><a class="markdownIt-Anchor" href="#3-驱动程序开发"></a> 3. 驱动程序开发</h3>
<p>为了让RT-Thread充分利用Rockchip的硬件功能，可能需要开发或移植一些驱动程序。关键驱动包括：</p>
<ul>
<li><strong>UART驱动</strong>：用于串口调试输出。</li>
<li><strong>定时器驱动</strong>：用于实现系统时钟和定时器功能。</li>
<li><strong>GPIO驱动</strong>：支持通用输入输出控制。</li>
<li><strong>其他外设驱动</strong>：如I2C、SPI、网络接口等。</li>
</ul>
<p>这些驱动程序通常在<code>drivers</code>目录下实现，您可以参考RT-Thread的标准驱动框架进行开发。</p>
<h3 id="4-编译与烧写"><a class="markdownIt-Anchor" href="#4-编译与烧写"></a> 4. 编译与烧写</h3>
<h4 id="41-编译rt-thread"><a class="markdownIt-Anchor" href="#41-编译rt-thread"></a> 4.1 编译RT-Thread</h4>
<p>使用SCons编译RT-Thread内核及相关组件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYscons</span><br></pre></td></tr></table></figure>
<p>编译完成后，生成的固件文件通常为<code>rtthread.bin</code>或<code>rtthread.elf</code>。</p>
<h4 id="42-烧写固件"><a class="markdownIt-Anchor" href="#42-烧写固件"></a> 4.2 烧写固件</h4>
<p>将生成的固件通过烧写工具烧录到Rockchip开发板中。对于Rockchip芯片，您可以使用工具如<code>rkflashtool</code>或<code>RKDevelopTool</code>来进行固件烧写。</p>
<h3 id="5-调试与运行"><a class="markdownIt-Anchor" href="#5-调试与运行"></a> 5. 调试与运行</h3>
<p>通过UART接口连接开发板，打开串口终端（如<code>minicom</code>或<code>Putty</code>），并重启开发板。您应该能够在终端中看到RT-Thread的启动日志。</p>
<h3 id="6-应用程序开发"><a class="markdownIt-Anchor" href="#6-应用程序开发"></a> 6. 应用程序开发</h3>
<p>在RT-Thread成功运行后，您可以开始编写自己的应用程序，充分利用RT-Thread的线程管理、内存管理等功能。应用程序可以直接在<code>application</code>目录下开发，编写完成后通过编译生成新的固件。</p>
<h3 id="7-优化与调试"><a class="markdownIt-Anchor" href="#7-优化与调试"></a> 7. 优化与调试</h3>
<p>最后，根据应用需求和性能目标，您可以进一步优化RT-Thread的配置和代码。使用RT-Thread的调试工具，进行性能分析、内存检测等工作，确保系统的稳定性和高效性。</p>
<hr />
<p>通过上述步骤，您应该能够成功地在Rockchip平台上运行RT-Thread。这个过程需要对嵌入式系统、操作系统移植和驱动开发有一定的了解。如果在移植过程中遇到问题，欢迎继续讨论或咨询相关的开发社区。</p>
<h1 id="amp源码编译"><a class="markdownIt-Anchor" href="#amp源码编译"></a> AMP源码编译</h1>
<h2 id="开发环境搭建"><a class="markdownIt-Anchor" href="#开发环境搭建"></a> 开发环境搭建</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">COPYsudo apt-get update</span><br><span class="line">sudo apt-get install clang-format astyle libncurses5-dev build-essential scons</span><br></pre></td></tr></table></figure>
<h2 id="sdk-编译"><a class="markdownIt-Anchor" href="#sdk-编译"></a> SDK 编译</h2>
<p>整体编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPY./build.sh all</span><br></pre></td></tr></table></figure>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051029337.png" alt="image-20240831130909780" />image-20240831130909780</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051029639.png" alt="image-20240831131002361" />image-20240831131002361</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051029218.png" alt="image-20240831131107616" />image-20240831131107616</p>
<p>进行单独编译前需进行过全编译，各个镜像单独编译命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">COPY./build.sh uboot  //单独编译 uboot</span><br><span class="line">./build.sh kernel  //单独编译 内核</span><br><span class="line">./build.sh amp  //单独编译 amp</span><br><span class="line">./build.sh updateimg  //打包整体 update.img 镜像</span><br></pre></td></tr></table></figure>
<p>烧写就正常的烧写即可。</p>
<h1 id="裸机和linux核心修改"><a class="markdownIt-Anchor" href="#裸机和linux核心修改"></a> 裸机和Linux核心修改</h1>
<p>然后现在用的是三个A55内核跑Linux一个A55内核跑裸机，具体现象是这样的，这是裸机核心：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051029243.png" alt="image-20240831131931925" />image-20240831131931925</p>
<p>这是那一个Linux核心内容：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051029544.png" alt="image-20240831132009133" />image-20240831132009133</p>
<p>可以看到现在只有三个核心被打印了出来。然后来看一下具体的修改，是怎样实现让这一个核心跑裸机的呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYvi device/rockchip/rk3568/rk3568_amp_linux.its</span><br></pre></td></tr></table></figure>
<p>文件内容如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">COPY</span><br><span class="line">/dts-v1/;</span><br><span class="line">/ &#123;</span><br><span class="line">        description = &quot;FIT source file for rockchip AMP&quot;;</span><br><span class="line">        #address-cells = &lt;1&gt;;</span><br><span class="line"></span><br><span class="line">        images &#123;</span><br><span class="line">                /*amp1 &#123;</span><br><span class="line">                        description  = &quot;bare-mental-core1&quot;;</span><br><span class="line">                        data         = /incbin/(&quot;cpu1.bin&quot;);</span><br><span class="line">                        type         = &quot;firmware&quot;;</span><br><span class="line">                        compression  = &quot;none&quot;;</span><br><span class="line">                        arch         = &quot;arm&quot;;</span><br><span class="line">                        cpu          = &lt;0x100&gt;;</span><br><span class="line">                        thumb        = &lt;0&gt;;</span><br><span class="line">                        hyp          = &lt;0&gt;;</span><br><span class="line">                        load         = &lt;0x01800000&gt;;</span><br><span class="line">                        udelay       = &lt;10000&gt;;</span><br><span class="line">                        hash &#123;</span><br><span class="line">                                algo = &quot;sha256&quot;;</span><br><span class="line">                        &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                amp2 &#123;</span><br><span class="line">                        description  = &quot;bare-mental-core2&quot;;</span><br><span class="line">                        data         = /incbin/(&quot;cpu2.bin&quot;);</span><br><span class="line">                        type         = &quot;firmware&quot;;</span><br><span class="line">                        compression  = &quot;none&quot;;</span><br><span class="line">                        arch         = &quot;arm&quot;;</span><br><span class="line">                        cpu          = &lt;0x200&gt;;</span><br><span class="line">                        thumb        = &lt;0&gt;;</span><br><span class="line">                        hyp          = &lt;0&gt;;</span><br><span class="line">                        load         = &lt;0x02000000&gt;;</span><br><span class="line">                        udelay       = &lt;10000&gt;;</span><br><span class="line">                        hash &#123;</span><br><span class="line">                                algo = &quot;sha256&quot;;</span><br><span class="line">                        &#125;;</span><br><span class="line">                &#125;;*/</span><br><span class="line"></span><br><span class="line">                amp3 &#123;</span><br><span class="line">                        description  = &quot;bare-mental-core3&quot;;</span><br><span class="line">                        data         = /incbin/(&quot;cpu3.bin&quot;);</span><br><span class="line">                        type         = &quot;firmware&quot;;</span><br><span class="line">                        compression  = &quot;none&quot;;</span><br><span class="line">                        arch         = &quot;arm&quot;;</span><br><span class="line">                        cpu          = &lt;0x300&gt;;</span><br><span class="line">                        thumb        = &lt;0&gt;;</span><br><span class="line">                        hyp          = &lt;0&gt;;</span><br><span class="line">                        load         = &lt;0x02800000&gt;;</span><br><span class="line">                        udelay       = &lt;10000&gt;;</span><br><span class="line">                        hash &#123;</span><br><span class="line">                                algo = &quot;sha256&quot;;</span><br><span class="line">                        &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        configurations &#123;</span><br><span class="line">                default = &quot;conf&quot;;</span><br><span class="line">                conf &#123;</span><br><span class="line">                        description = &quot;Rockchip AMP images&quot;;</span><br><span class="line">                        rollback-index = &lt;0x0&gt;;</span><br><span class="line">                        //loadables = &quot;amp1&quot;, &quot;amp2&quot;, &quot;amp3&quot;;</span><br><span class="line">                        loadables = &quot;amp3&quot;;</span><br><span class="line"></span><br><span class="line">                        signature &#123;</span><br><span class="line">                                algo = &quot;sha256,rsa2048&quot;;</span><br><span class="line">                                padding = &quot;pss&quot;;</span><br><span class="line">                                key-name-hint = &quot;dev&quot;;</span><br><span class="line">                                sign-images = &quot;loadables&quot;;</span><br><span class="line">                        &#125;;</span><br><span class="line"></span><br><span class="line">                        /* - run linux on cpu0</span><br><span class="line">                         * - it is brought up by amp(that run on U-Boot)</span><br><span class="line">                         * - it is boot entry depends on U-Boot</span><br><span class="line">                         */</span><br><span class="line">                        linux &#123;</span><br><span class="line">                                description  = &quot;linux-os&quot;;</span><br><span class="line">                                arch         = &quot;arm64&quot;;</span><br><span class="line">                                cpu          = &lt;0x000&gt;;</span><br><span class="line">                                thumb        = &lt;0&gt;;</span><br><span class="line">                                hyp          = &lt;0&gt;;</span><br><span class="line">                                udelay       = &lt;0&gt;;</span><br><span class="line">                        &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这个设备树描述文件用于生成一个 FIT（Flattened Image Tree）格式的映像文件，该文件可以包含多个固件、配置和元数据。FIT 文件格式通常用于嵌入式系统中，特别是在使用 U-Boot 引导加载器的系统中，以便管理多核处理器或多个固件的加载和执行。让我们详细解释一下这个设备树的结构和每个部分的作用。</p>
<h3 id="1-文件头部"><a class="markdownIt-Anchor" href="#1-文件头部"></a> 1. 文件头部</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">COPY/dts-v1/;</span><br><span class="line">/ &#123;</span><br><span class="line">    description = &quot;FIT source file for rockchip AMP&quot;;</span><br><span class="line">    #address-cells = &lt;1&gt;;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>/dts-v1/</strong>: 声明设备树的版本。</li>
<li><strong>description</strong>: 提供这个 FIT 文件的简要描述，表明它是为 Rockchip AMP（Asymmetric Multiprocessing）使用的。</li>
<li><strong>#address-cells = &lt;1&gt;;</strong>: 定义地址单元的大小为 1，通常在定义节点的地址时使用。</li>
</ul>
<h3 id="2-images-节点"><a class="markdownIt-Anchor" href="#2-images-节点"></a> 2. <code>images</code> 节点</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">COPYimages &#123;</span><br><span class="line">    /*amp1 &#123;</span><br><span class="line">        description  = &quot;bare-mental-core1&quot;;</span><br><span class="line">        data         = /incbin/(&quot;cpu1.bin&quot;);</span><br><span class="line">        type         = &quot;firmware&quot;;</span><br><span class="line">        compression  = &quot;none&quot;;</span><br><span class="line">        arch         = &quot;arm&quot;;</span><br><span class="line">        cpu          = &lt;0x100&gt;;</span><br><span class="line">        thumb        = &lt;0&gt;;</span><br><span class="line">        hyp          = &lt;0&gt;;</span><br><span class="line">        load         = &lt;0x01800000&gt;;</span><br><span class="line">        udelay       = &lt;10000&gt;;</span><br><span class="line">        hash &#123;</span><br><span class="line">            algo = &quot;sha256&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>images</strong>: 包含所有固件映像的节点，每个映像表示要加载到特定处理器核心的一个固件。</li>
<li><strong>amp1, amp2, amp3</strong>: 这三个节点（其中 amp1 和 amp2 被注释掉了）代表三个不同的固件映像，分别用于不同的处理器核心。
<ul>
<li><strong>description</strong>: 对应映像的描述。</li>
<li><strong>data</strong>: 通过 <code>/incbin/(&quot;filename&quot;)</code> 指令包含一个二进制文件，这里是 <code>cpu1.bin</code>、<code>cpu2.bin</code> 和 <code>cpu3.bin</code>。</li>
<li><strong>type</strong>: 映像的类型，这里是 <code>&quot;firmware&quot;</code>，表示这是一个固件映像。</li>
<li><strong>compression</strong>: 指定映像的压缩类型，这里为 <code>&quot;none&quot;</code>，即未压缩。</li>
<li><strong>arch</strong>: 目标架构，这里是 <code>&quot;arm&quot;</code>。</li>
<li><strong>cpu</strong>: 指定目标 CPU 核心，这里 <code>0x100</code>、<code>0x200</code>、<code>0x300</code> 表示不同的 CPU 核心。</li>
<li><strong>thumb</strong>: 指定是否使用 ARM 的 Thumb 模式，这里为 <code>&lt;0&gt;</code> 表示不使用。</li>
<li><strong>hyp</strong>: 指定是否使用 Hypervisor 模式，这里为 <code>&lt;0&gt;</code> 表示不使用。</li>
<li><strong>load</strong>: 指定映像在内存中的加载地址，例如 <code>0x01800000</code>。</li>
<li><strong>udelay</strong>: 延迟加载时间，单位是微秒。</li>
<li><strong>hash</strong>: 包含一个哈希节点，用于校验数据的完整性，<code>algo</code> 指定了使用的哈希算法，比如 <code>sha256</code>。</li>
</ul>
</li>
</ul>
<h3 id="3-configurations-节点"><a class="markdownIt-Anchor" href="#3-configurations-节点"></a> 3. <code>configurations</code> 节点</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">COPYconfigurations &#123;</span><br><span class="line">    default = &quot;conf&quot;;</span><br><span class="line">    conf &#123;</span><br><span class="line">        description = &quot;Rockchip AMP images&quot;;</span><br><span class="line">        rollback-index = &lt;0x0&gt;;</span><br><span class="line">        loadables = &quot;amp3&quot;;</span><br><span class="line"></span><br><span class="line">        signature &#123;</span><br><span class="line">            algo = &quot;sha256,rsa2048&quot;;</span><br><span class="line">            padding = &quot;pss&quot;;</span><br><span class="line">            key-name-hint = &quot;dev&quot;;</span><br><span class="line">            sign-images = &quot;loadables&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        linux &#123;</span><br><span class="line">            description  = &quot;linux-os&quot;;</span><br><span class="line">            arch         = &quot;arm64&quot;;</span><br><span class="line">            cpu          = &lt;0x000&gt;;</span><br><span class="line">            thumb        = &lt;0&gt;;</span><br><span class="line">            hyp          = &lt;0&gt;;</span><br><span class="line">            udelay       = &lt;0&gt;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<dl>
<dt>configurations</dt>
<dd>包含配置的节点，用于定义如何加载和管理多个映像。</dd>
</dl>
<ul>
<li><strong>default = “conf”;</strong>: 指定默认的配置节点是 <code>conf</code>。</li>
<li><strong>conf</strong>: 这是一个配置节点，定义了如何加载和管理映像。
<ul>
<li><strong>description</strong>: 配置的描述，这里为 “Rockchip AMP images”。</li>
<li><strong>rollback-index</strong>: 回滚索引，用于版本管理，通常用于确定是否需要回滚到以前的配置。</li>
<li><strong>loadables</strong>: 指定要加载的映像列表，当前仅加载 <code>amp3</code>，但注释部分显示也可以加载 <code>amp1</code> 和 <code>amp2</code>。</li>
<li><strong>signature</strong>: 包含签名信息，用于验证映像的完整性和来源。
<ul>
<li><strong>algo</strong>: 指定签名算法，这里是 <code>&quot;sha256,rsa2048&quot;</code>，表示使用 SHA-256 和 RSA 2048 位的组合。</li>
<li><strong>padding</strong>: 指定签名的填充方式，这里是 <code>&quot;pss&quot;</code>。</li>
<li><strong>key-name-hint</strong>: 签名使用的密钥名称提示，这里是 <code>&quot;dev&quot;</code>。</li>
<li><strong>sign-images</strong>: 指定要签名的映像，这里签名的是 <code>&quot;loadables&quot;</code>，即 amp3 映像。</li>
</ul>
</li>
<li><strong>linux</strong>: 定义了关于 Linux 操作系统的配置信息。
<ul>
<li><strong>description</strong>: 描述是 <code>&quot;linux-os&quot;</code>。</li>
<li><strong>arch</strong>: 指定目标架构，这里是 <code>&quot;arm64&quot;</code>。</li>
<li><strong>cpu</strong>: 指定运行 Linux 的 CPU 核心，这里是 <code>&lt;0x000&gt;</code>。</li>
<li><strong>thumb</strong>: 指定是否使用 ARM 的 Thumb 模式，这里为 <code>&lt;0&gt;</code> 表示不使用。</li>
<li><strong>hyp</strong>: 指定是否使用 Hypervisor 模式，这里为 <code>&lt;0&gt;</code> 表示不使用。</li>
<li><strong>udelay</strong>: 加载后的延迟时间，通常为 0。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h3>
<ul>
<li><strong>FIT 文件</strong> 通过 <code>images</code> 节点打包多个固件或映像文件，并通过 <code>configurations</code> 节点指定如何加载和管理这些映像。</li>
<li><strong>多核管理</strong>: 这类配置特别适用于多核系统（AMP），每个核心可以加载和运行不同的固件或裸机程序。</li>
<li><strong>签名和安全性</strong>: 使用 <code>signature</code> 节点来签名和验证加载的映像，以确保安全性和完整性。</li>
<li><strong>灵活的配置</strong>: <code>configurations</code> 节点允许用户根据不同需求配置和加载不同的映像。</li>
</ul>
<p>通过上述解释，你可以理解 FIT 文件如何用于多核处理器的固件加载和管理，以及如何通过设备树描述这种复杂的启动场景。</p>
<p>上面的fit 设备树总共有三个节点，分别对应amp0、amp1和amp2，默认情况下打开的是amp3这一个核心，如果想要打开另外两个只需要打开对应的注释即可。</p>
<p>除此之外还有另外一个内核设备树要改，不能只打开这里的注释，还需要关掉Linux CPU，不然也是无法生效的，具体的设备树为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYvi kernel/arch/arm64/boot/dts/rockchip/rk3568-evb1-ddr4-v10-linux-amp.dts</span><br></pre></td></tr></table></figure>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051029277.png" alt="image-20240831133651193" />image-20240831133651193</p>
<p>默认情况下是打开了三个Linux核心，分别为CPU0 1 2，而CPU3被用在裸机，所以应用了delete node，删掉了cpu3，如果想要改为1个Linux核心，三个裸机核心，可以改成这个样子：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051029187.png" alt="image-20240831134320679" />image-20240831134320679</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051029108.png" alt="image-20240831134306646" />image-20240831134306646</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051029471.png" alt="image-20240831134245402" />image-20240831134245402</p>
<p>现在已经确认裸机核心和Linux核心如何修改了，那他具体是如何运转的呢？我该如何利用这个裸机核心呢？这个裸机核心都能用来做什么呢？</p>
<h1 id="裸机核心开发"><a class="markdownIt-Anchor" href="#裸机核心开发"></a> 裸机核心开发</h1>
<p>在这段文档中，开发板上的各种硬件外设被测试和验证，包括GPIO、PWM、UART、SPI、以及多核控制。这些测试主要用于确保嵌入式系统中的不同外设功能正常工作。以下是对文档中各个部分的整理和简要说明：</p>
<h3 id="1-gpio-测试"><a class="markdownIt-Anchor" href="#1-gpio-测试"></a> 1. GPIO 测试</h3>
<ul>
<li>
<p><strong>目的</strong>: 测试GPIO的功能，通过控制LED灯的亮灭来验证。</p>
</li>
<li>
<p>关键代码</p>
<p>:</p>
<ul>
<li><code>HAL_PINCTRL_SetParam</code>: 配置GPIO引脚的复用功能。</li>
<li><code>HAL_GPIO_SetPinDirection</code>: 设置GPIO引脚为输出模式。</li>
<li><code>HAL_GPIO_GetPinLevel</code> 和 <code>HAL_GPIO_SetPinLevel</code>: 获取和设置GPIO引脚的电平状态。</li>
<li><strong>循环逻辑</strong>: 每隔1秒读取GPIO引脚的状态并翻转其电平状态，达到闪烁LED的效果。</li>
</ul>
</li>
</ul>
<h3 id="2-pwm-测试"><a class="markdownIt-Anchor" href="#2-pwm-测试"></a> 2. PWM 测试</h3>
<ul>
<li>
<p><strong>目的</strong>: 使用PWM控制LED灯实现呼吸灯效果。</p>
</li>
<li>
<p>关键代码</p>
<p>:</p>
<ul>
<li><code>HAL_PWM_Init</code>: 初始化PWM控制器。</li>
<li><code>HAL_IOMUX_PWM0_Config</code>: 配置PWM0的IOMUX。</li>
<li><code>HAL_PWM_SetConfig</code> 和 <code>HAL_PWM_Enable</code>: 配置PWM信号的周期和占空比，并使能PWM输出。</li>
<li><strong>呼吸灯效果</strong>: 通过增加和减少PWM的占空比，实现灯光的渐亮和渐暗效果。</li>
</ul>
</li>
</ul>
<h3 id="3-uart-测试"><a class="markdownIt-Anchor" href="#3-uart-测试"></a> 3. UART 测试</h3>
<ul>
<li>
<p><strong>目的</strong>: 测试UART9的发送和接收功能。</p>
</li>
<li>
<p><strong>硬件连接</strong>: 使用两块开发板进行串口通信，或者使用USB转TTL模块进行电脑与开发板间的通信。</p>
</li>
<li>
<p>关键代码</p>
<p>:</p>
<ul>
<li><code>HAL_UART_Init</code>: 初始化UART9配置。</li>
<li><code>HAL_UART_SerialOut</code> 和 <code>HAL_UART_SerialIn</code>: 通过UART发送和接收数据。</li>
<li><code>uart9_isr</code>: 中断处理函数，处理UART接收数据的中断。</li>
<li><strong>测试逻辑</strong>: 定期发送数据并接收返回的数据，进行显示和验证。</li>
</ul>
</li>
</ul>
<h3 id="4-spi-测试"><a class="markdownIt-Anchor" href="#4-spi-测试"></a> 4. SPI 测试</h3>
<ul>
<li>
<p><strong>目的</strong>: 通过回环测试验证SPI0的发送和接收功能。</p>
</li>
<li>
<p><strong>硬件连接</strong>: 短接SPI0的MOSI和MISO引脚。</p>
</li>
<li>
<p>关键代码</p>
<p>:</p>
<ul>
<li><code>HAL_SPI_Init</code>: 初始化SPI设备。</li>
<li><code>demo_spi_transfer</code>: 进行SPI数据的发送和接收。</li>
<li><strong>回环测试</strong>: 发送一组数据，然后通过MISO接收并验证数据的正确性。</li>
</ul>
</li>
</ul>
<h3 id="5-开关核测试"><a class="markdownIt-Anchor" href="#5-开关核测试"></a> 5. 开关核测试</h3>
<ul>
<li>
<p><strong>目的</strong>: 通过控制Linux中的命令，启用或关闭特定的CPU核，运行或停止裸机程序。</p>
</li>
<li>
<p>关键配置</p>
<p>:</p>
<ul>
<li><code>boot-on</code>: 设置为1时，系统启动时自动运行裸机程序；设置为0时，开机不启动裸机程序。</li>
</ul>
</li>
<li>
<p>操作命令</p>
<p>:</p>
<ul>
<li><code>echo off 0x300 &gt; /sys/rk_amp/boot_cpu</code>: 关闭已启动的核。</li>
<li><code>echo on 0x300 &gt; /sys/rk_amp/boot_cpu</code>: 启动已关闭的核。</li>
<li><code>echo status 0x300 &gt; /sys/rk_amp/boot_cpu</code>: 查看核的当前状态。</li>
</ul>
</li>
</ul>
<p>这些测试和操作演示了如何在iTOP-3568开发板上使用HAL库与硬件外设交互。这些代码片段和步骤为开发人员提供了调试和验证开发板功能的基础工具。</p>
<h3 id="6总结"><a class="markdownIt-Anchor" href="#6总结"></a> 6.总结</h3>
<p>每个裸机代码测试其实就是写了一个库而已，具体在/home/topeet/rk356x_amp/hal/project/rk3568/src目录，这里田创建了一个topeet_demo文件夹，具体如下所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051029222.png" alt="image-20240831140057163" />image-20240831140057163</p>
<p>而在/home/topeet/rk356x_amp/hal/project/common/GCC/Cortex-A.mk配置文件中，加入了对应的目录，具体如下所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051029213.png" alt="image-20240831140026103" />image-20240831140026103</p>
<p>然后来看这个主程序：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051029403.png" alt="image-20240831140240178" />image-20240831140240178</p>
<p>这个主程序其实就是裸机核心要运行的，我们要看的代码呢，在这六行：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051029722.png" alt="image-20240831140447549" />image-20240831140447549</p>
<p>这里的四个测试是田自己加的，取消注释就代表着启动对应得测试，行了，AMP裸机运行的框架就讲解到这里，然后来思考一下RTT，RTT算是一个实时系统，当然他肯定也是运行在裸机核心上面的，但他的运行效果是怎样的呢，他这个系统又能有什么功能呢，这个不是很清楚，先去哔哩哔哩上学习一下具体的现象，对他有个大致的认识。</p>
<h1 id="rt-thread编译"><a class="markdownIt-Anchor" href="#rt-thread编译"></a> RT-Thread编译</h1>
<p>首先要确保一个CPU核心跑裸机核心，另外三个跑Linux，也就是默认的SDK配置，然后编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">COPY./build.sh rtthread 3</span><br><span class="line">./build.sh ampimg</span><br><span class="line">./build.sh updateimg</span><br></pre></td></tr></table></figure>
<p>编译完成之后，然后在裸机的Uart4打印具体如下所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051029869.png" alt="image-20240831143351828" />image-20240831143351828</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYscons --exec-path=&quot;aarch64-linux-gnu-&quot;</span><br></pre></td></tr></table></figure>
<p>风火轮测试视频：</p>
<p><a target="_blank" rel="noopener" href="https://www.douyin.com/video/7343275757080153356">https://www.douyin.com/video/7343275757080153356</a></p>
<p>rtthread官方推文</p>
<p><a target="_blank" rel="noopener" href="https://www.elecfans.com/d/2408719.html">https://www.elecfans.com/d/2408719.html</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-07_小技巧/15_Linux系统自动换源"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/08/29/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/15_Linux%E7%B3%BB%E7%BB%9F%E8%87%AA%E5%8A%A8%E6%8D%A2%E6%BA%90/"
    >Linux系统自动换源</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/08/29/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/15_Linux%E7%B3%BB%E7%BB%9F%E8%87%AA%E5%8A%A8%E6%8D%A2%E6%BA%90/" class="article-date">
  <time datetime="2024-08-28T22:50:19.000Z" itemprop="datePublished">2024-08-29</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote>
<p>不管是用开发板、虚拟机、还是wsl，Linux的系统软件源更换都是很重要的一件事，我的常用做法是在网上搜索华为源更换源，每次都要这样操作，很是无奈，所以在机缘巧合之下，发现了这个github项目，可以自动检测国内源，测速并更换，该项目的地址为<a target="_blank" rel="noopener" href="https://github.com/RubyMetric/chsrc">https://github.com/RubyMetric/chsrc</a></p>
</blockquote>
<blockquote>
<p>我一般情况下，用下面的这些命令就可以了，后面的有需要再试了。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># x64</span><br><span class="line">curl -L https://github.com/RubyMetric/chsrc/releases/download/pre/chsrc-x64-linux -o chsrc; chmod +x ./chsrc</span><br><span class="line"></span><br><span class="line"># aarch64</span><br><span class="line">curl -L https://github.com/RubyMetric/chsrc/releases/download/pre/chsrc-aarch64-linux -o chsrc; chmod +x ./chsrc</span><br><span class="line"></span><br><span class="line">sudo chsrc set ubuntu</span><br></pre></td></tr></table></figure>
<p><strong><code>chsrc</code> 不仅是一个命令行工具，同时也是一个换源框架，它甚至使你能够在不了解C语言的情况下编写出新的换源方法(recipe)。</strong></p>
<p>立刻为一个新软件添加换源方法！[Write A Recipe Even If You Don’t Know C](<a target="_blank" rel="noopener" href="https://chai0705.github.io/2024/08/29/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/13_">https://chai0705.github.io/2024/08/29/07_小技巧/13_</a> Linux系统自动换源/doc/Write-A-Recipe-Even-If-You-Dont-Know-C.md)</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-07_小技巧/14_repo学习2"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/08/25/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/14_repo%E5%AD%A6%E4%B9%A02/"
    >vim学习</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/08/25/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/14_repo%E5%AD%A6%E4%B9%A02/" class="article-date">
  <time datetime="2024-08-24T22:50:19.000Z" itemprop="datePublished">2024-08-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="prerequisite"><a class="markdownIt-Anchor" href="#prerequisite"></a> Prerequisite</h1>
<p>在进入关于<strong>代码仓库 (Repository)</strong> 的学习之前，我们先来概述一些必要的前置知识。</p>
<p><strong>0.1 版本控制基础:</strong> 了解版本控制的基本概念，例如为什么要使用版本控制系统以及它如何帮助管理代码和文件的历史记录。</p>
<p><strong>0.2 命令行操作:</strong> 掌握基本的命令行操作，了解如何使用终端进行文件操作，这对于使用版本控制系统（如Git）至关重要。</p>
<p><strong>0.3 Git基础:</strong> 介绍Git的基本概念和命令，包括初始化仓库、提交更改、查看历史记录、分支管理等。</p>
<p><strong>0.4 远程仓库基础:</strong> 了解什么是远程仓库，以及如何将本地代码推送到远程服务器上，比如GitHub或GitLab。</p>
<p><strong>0.5 协作开发基础:</strong> 学习如何在团队中使用版本控制系统进行协作，包括如何处理冲突、分支策略以及代码审查流程。</p>
<h1 id="main-curriculum"><a class="markdownIt-Anchor" href="#main-curriculum"></a> Main Curriculum</h1>
<p>接下来，我们将为<strong>代码仓库 (Repository)</strong> 制定一个详细的学习计划：</p>
<p><strong>1.1 代码仓库的概念:</strong> 介绍代码仓库的作用、分类（如本地仓库、远程仓库）、以及它们在开发中的重要性。</p>
<p><strong>1.2 创建和初始化仓库:</strong> 学习如何从零开始创建和初始化一个代码仓库，包括本地和远程仓库的初始化。</p>
<p><strong>1.3 Git基础操作:</strong> 深入学习Git的基本操作，如添加文件、提交更改、查看日志、比较差异等。</p>
<p><strong>1.4 分支管理:</strong> 了解如何创建、合并和删除分支，掌握分支管理的最佳实践，确保代码库的整洁和有序。</p>
<p><strong>1.5 远程仓库操作:</strong> 学习如何将本地仓库与远程仓库进行连接，推送代码到远程仓库，以及从远程仓库拉取最新代码。</p>
<p><strong>1.6 协作开发:</strong> 了解团队开发中的最佳实践，如Pull Request流程、代码审查、以及如何在团队中有效协作。</p>
<p><strong>1.7 标签和版本发布:</strong> 学习如何在仓库中使用标签来标记重要的版本，并了解版本发布的基本流程。</p>
<p><strong>1.8 处理冲突:</strong> 掌握如何识别和解决在团队开发中常见的代码冲突，确保代码合并的顺利进行。</p>
<p><strong>1.9 持续集成和自动化:</strong> 了解如何使用持续集成工具（如Jenkins、GitHub Actions）自动化测试和部署流程，提升开发效率。</p>
<p><strong>1.10 优化和维护仓库:</strong> 探讨如何优化代码仓库的结构、管理仓库的大小，以及定期维护以保持仓库的高效运行。</p>
<p>请使用**“/start”**来开始课程计划。</p>
<p><strong>主题</strong>: 代码仓库 (Repository)</p>
<hr />
<h2 id="主课"><a class="markdownIt-Anchor" href="#主课"></a> 主课</h2>
<h3 id="11-代码仓库的概念"><a class="markdownIt-Anchor" href="#11-代码仓库的概念"></a> 1.1 代码仓库的概念</h3>
<p><strong>代码仓库</strong> 是一个用于存储、管理和跟踪代码和文件更改的地方。无论是个人项目还是团队协作，代码仓库都能帮助开发者更好地组织和维护代码。</p>
<h4 id="仓库的分类"><a class="markdownIt-Anchor" href="#仓库的分类"></a> 仓库的分类：</h4>
<ol>
<li><strong>本地仓库</strong>: 存储在开发者本地机器上的代码库，所有操作都在本地进行。</li>
<li><strong>远程仓库</strong>: 存储在远程服务器上的代码库，如GitHub、GitLab、Bitbucket等，允许多个开发者协同工作。</li>
</ol>
<h4 id="代码仓库的重要性"><a class="markdownIt-Anchor" href="#代码仓库的重要性"></a> 代码仓库的重要性：</h4>
<ul>
<li><strong>版本控制</strong>: 代码仓库通过版本控制系统（如Git）管理代码的每个历史版本，允许开发者回滚到之前的版本。</li>
<li><strong>协作开发</strong>: 远程仓库使多个开发者能够在同一项目中协同工作 ，每个人可以在自己的分支上开发，然后合并到主分支。</li>
<li><strong>历史记录</strong>: 通过提交历史，开发者可以查看项目的演变过程，了解每个更改背后的原因。</li>
</ul>
<hr />
<h3 id="实例讲解"><a class="markdownIt-Anchor" href="#实例讲解"></a> 实例讲解</h3>
<p>设想你正在开发一个网站项目，你的代码仓库可以帮助你：</p>
<ol>
<li><strong>跟踪更改</strong>: 你可以随时提交更改，这样如果某个功能出现问题，你可以轻松回滚到之前的版本。</li>
<li><strong>与团队成员协作</strong>: 团队成员可以在他们的分支上开发新功能，然后通过Pull Request将他们的代码合并到主分支。</li>
<li><strong>保护代码</strong>: 即使本地机器发生故障，你也可以通过远程仓库恢复你的代码。</li>
</ol>
<hr />
<p>请告诉我，如果你有任何问题或需要进一步的解释。或者你可以继续通过**/continue**来深入学习下一个主题。</p>
<h3 id="12-创建和初始化仓库"><a class="markdownIt-Anchor" href="#12-创建和初始化仓库"></a> 1.2 创建和初始化仓库</h3>
<p>现在我们来学习如何从零开始创建和初始化一个代码仓库。这个过程分为两个部分：<strong>本地仓库的创建</strong>和<strong>远程仓库的初始化</strong>。</p>
<h4 id="本地仓库的创建"><a class="markdownIt-Anchor" href="#本地仓库的创建"></a> 本地仓库的创建</h4>
<p>在开始之前，请确保你已经安装了Git，并且知道如何在命令行中操作。</p>
<ol>
<li>
<p><strong>选择一个项目目录</strong>: 首先，打开终端，导航到你想要创建仓库的目录。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYcd /path/to/your/project</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>初始化仓库</strong>: 在该目录下，运行以下命令以初始化一个新的Git仓库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit init</span><br></pre></td></tr></table></figure>
<p>这会在项目目录中创建一个名为<code>.git</code>的隐藏文件夹，Git会在其中存储所有的版本控制信息。</p>
</li>
<li>
<p><strong>添加文件到仓库</strong>: 接下来，添加文件到仓库的暂存区：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit add .</span><br></pre></td></tr></table></figure>
<p>这里的<code>.</code>代表添加当前目录下的所有文件，你也可以指定特定文件。</p>
</li>
<li>
<p><strong>提交更改</strong>: 现在，你可以提交这些更改并添加一个提交信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit commit -m &quot;Initial commit&quot;</span><br></pre></td></tr></table></figure>
<p>这将你的更改保存为仓库中的一个历史版本。</p>
</li>
</ol>
<h4 id="远程仓库的初始化"><a class="markdownIt-Anchor" href="#远程仓库的初始化"></a> 远程仓库的初始化</h4>
<ol>
<li>
<p><strong>创建远程仓库</strong>: 在GitHub、GitLab或其他平台上创建一个新的仓库。通常你只需要提供仓库的名称和描述。</p>
</li>
<li>
<p><strong>连接远程仓库</strong>: 使用Git命令行工具，将本地仓库与远程仓库进行连接。假设你使用GitHub，你可以运行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit remote add origin https://github.com/yourusername/yourrepository.git</span><br></pre></td></tr></table></figure>
<p><code>origin</code> 是远程仓库的默认名称，你可以根据需要更改。</p>
</li>
<li>
<p><strong>推送代码到远程仓库</strong>: 最后，将你的本地代码推送到远程仓库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit push -u origin master</span><br></pre></td></tr></table></figure>
<p>这会将你的所有代码和提交历史推送到远程仓库，并将本地的<code>master</code>分支与远程的<code>master</code>分支关联起来。</p>
</li>
</ol>
<hr />
<p>通过以上步骤，你现在已经成功创建并初始化了一个代码仓库，并将它与远程仓库相连接。</p>
<p>请告诉我，如果你有任何问题或需要进一步的解释。或者你可以继续通过**/continue**来深入学习下一个主题。</p>
<h3 id="13-git基础操作"><a class="markdownIt-Anchor" href="#13-git基础操作"></a> 1.3 Git基础操作</h3>
<p>现在我们已经创建并初始化了一个仓库，接下来让我们深入学习一些Git的基础操作。这些操作将帮助你有效地管理代码，并利用版本控制系统的强大功能。</p>
<h4 id="添加和提交更改"><a class="markdownIt-Anchor" href="#添加和提交更改"></a> 添加和提交更改</h4>
<p>在你对代码进行更改后，需要将这些更改添加到Git的暂存区，然后再提交到仓库。</p>
<ol>
<li>
<p><strong>查看当前状态</strong>: 在提交之前，你可以使用<code>git status</code>查看当前仓库的状态，了解哪些文件被修改了，哪些文件还没有被跟踪。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit status</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>添加更改到暂存区</strong>: 使用<code>git add</code>命令将更改添加到暂存区。你可以添加特定文件或整个目录。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit add filename.txt</span><br></pre></td></tr></table></figure>
<p>或者添加所有更改：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit add .</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>提交更改</strong>: 使用<code>git commit</code>命令将暂存区中的更改提交到仓库，并添加一个有意义的提交信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit commit -m &quot;Add new feature to handle user login&quot;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="查看提交历史"><a class="markdownIt-Anchor" href="#查看提交历史"></a> 查看提交历史</h4>
<p>Git允许你查看项目的提交历史，从而了解项目的演变过程。</p>
<ol>
<li>
<p><strong>查看提交日志</strong>: 使用<code>git log</code>命令查看提交历史。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit log</span><br></pre></td></tr></table></figure>
<p>这将显示每个提交的详细信息，包括提交ID、作者、日期和提交信息。</p>
</li>
<li>
<p><strong>简洁日志</strong>: 如果你只想查看简洁的日志，可以使用<code>--oneline</code>选项。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit log --oneline</span><br></pre></td></tr></table></figure>
<p>这将每个提交显示为一行，便于快速浏览。</p>
</li>
</ol>
<h4 id="比较差异"><a class="markdownIt-Anchor" href="#比较差异"></a> 比较差异</h4>
<p>当你想查看当前代码与前一个版本之间的差异时，可以使用<code>git diff</code>命令。</p>
<ol>
<li>
<p><strong>查看工作目录与暂存区的差异</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit diff</span><br></pre></td></tr></table></figure>
<p>这将显示自上次提交以来的所有更改。</p>
</li>
<li>
<p><strong>查看暂存区与上次提交之间的差异</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit diff --staged</span><br></pre></td></tr></table></figure>
<p>这将显示已经添加到暂存区但还没有提交的更改。</p>
</li>
<li>
<p><strong>查看两个提交之间的差异</strong>: 你可以使用提交ID来比较两个提交之间的差异。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit diff commit1_id commit2_id</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr />
<p>通过掌握这些基础操作，你可以更好地管理代码，并随时查看和审查项目的历史变化。</p>
<p>请告诉我，如果你有任何问题或需要进一步的解释。或者你可以继续通过**/continue**来深入学习下一个主题。</p>
<h3 id="14-分支管理"><a class="markdownIt-Anchor" href="#14-分支管理"></a> 1.4 分支管理</h3>
<p>在开发过程中，分支是一个非常有用的工具，它允许你在不同的开发线索中工作，而不会影响主分支上的稳定代码。通过分支管理，你可以更轻松地处理新功能开发、Bug修复以及代码审查等任务。</p>
<h4 id="创建和切换分支"><a class="markdownIt-Anchor" href="#创建和切换分支"></a> 创建和切换分支</h4>
<ol>
<li>
<p><strong>创建一个新分支</strong>: 你可以使用<code>git branch</code>命令创建一个新分支。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit branch new-feature</span><br></pre></td></tr></table></figure>
<p>这将创建一个名为<code>new-feature</code>的新分支，但当前你仍然在原来的分支上。</p>
</li>
<li>
<p><strong>切换到新分支</strong>: 使用<code>git checkout</code>命令切换到你刚刚创建的分支。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit checkout new-feature</span><br></pre></td></tr></table></figure>
<p>现在，你已经切换到<code>new-feature</code>分支，任何在这个分支上的更改都不会影响到其他分支。</p>
</li>
<li>
<p><strong>简化创建和切换分支</strong>: 你也可以使用<code>-b</code>选项一次性创建并切换到新分支。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit checkout -b new-feature</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="合并分支"><a class="markdownIt-Anchor" href="#合并分支"></a> 合并分支</h4>
<p>当你完成了在一个分支上的工作，并希望将这些更改合并回主分支时，你可以使用<code>git merge</code>命令。</p>
<ol>
<li>
<p><strong>切换回主分支</strong>: 首先，确保你已经切换回要合并到的分支（通常是<code>master</code>或<code>main</code>分支）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit checkout master</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>合并分支</strong>: 然后，使用<code>git merge</code>命令将另一个分支的更改合并到当前分支。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit merge new-feature</span><br></pre></td></tr></table></figure>
<p>这会将<code>new-feature</code>分支的更改合并到<code>master</code>分支。</p>
</li>
<li>
<p><strong>处理合并冲突</strong>: 如果两个分支修改了相同的部分，Git可能会提示合并冲突。你需要手动解决这些冲突，然后提交解决后的更改。</p>
<ul>
<li>
<p>编辑冲突的文件，解决冲突的部分。</p>
</li>
<li>
<p>使用<code>git add</code>命令将解决冲突后的文件添加到暂存区。</p>
</li>
<li>
<p>提交合并的结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit commit</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="删除分支"><a class="markdownIt-Anchor" href="#删除分支"></a> 删除分支</h4>
<p>当一个分支的工作完成并且已经成功合并，你可以删除它以保持仓库的整洁。</p>
<ol>
<li>
<p><strong>删除本地分支</strong>: 使用<code>-d</code>选项删除一个本地分支。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit branch -d new-feature</span><br></pre></td></tr></table></figure>
<p>如果该分支还没有被合并，你可以使用<code>-D</code>选项强制删除。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit branch -D new-feature</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>删除远程分支</strong>: 如果你想删除一个远程分支，可以使用以下命令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit push origin --delete new-feature</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr />
<p>通过掌握分支管理，你可以有效地管理项目的不同开发线索，并在多个开发者之间协调工作。</p>
<p>请告诉我，如果你有任何问题或需要进一步的解释。或者你可以继续通过**/continue**来深入学习下一个主题。</p>
<h3 id="15-远程仓库操作"><a class="markdownIt-Anchor" href="#15-远程仓库操作"></a> 1.5 远程仓库操作</h3>
<p>在现代软件开发中，远程仓库是团队协作的核心工具。远程仓库允许多个开发者在不同地点共同工作，并确保每个人都能访问到最新的代码版本。接下来我们将深入探讨如何有效地操作远程仓库。</p>
<h4 id="连接远程仓库"><a class="markdownIt-Anchor" href="#连接远程仓库"></a> 连接远程仓库</h4>
<ol>
<li>
<p><strong>添加远程仓库</strong>: 在初始化本地仓库后，你可以使用<code>git remote add</code>命令将其连接到一个远程仓库。通常，这个远程仓库会托管在平台上，如GitHub、GitLab或Bitbucket。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit remote add origin https://github.com/yourusername/yourrepository.git</span><br></pre></td></tr></table></figure>
<p><code>origin</code> 是远程仓库的默认名称，你可以根据需要更改。</p>
</li>
<li>
<p><strong>查看远程仓库</strong>: 使用<code>git remote -v</code>命令查看你已经配置的远程仓库。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit remote -v</span><br></pre></td></tr></table></figure>
<p>这将显示远程仓库的名称和URL。</p>
</li>
</ol>
<h4 id="推送和拉取代码"><a class="markdownIt-Anchor" href="#推送和拉取代码"></a> 推送和拉取代码</h4>
<ol>
<li>
<p><strong>推送代码到远程仓库</strong>: 当你想要将本地代码推送到远程仓库时，可以使用<code>git push</code>命令。第一次推送时，你可能需要使用<code>-u</code>选项来设置默认的上游分支。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit push -u origin master</span><br></pre></td></tr></table></figure>
<p>这将你的<code>master</code>分支的代码推送到远程仓库的<code>master</code>分支上。</p>
</li>
<li>
<p><strong>从远程仓库拉取代码</strong>: 如果其他开发者在远程仓库中做了更改，你可以使用<code>git pull</code>命令将这些更改拉取到你的本地仓库。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit pull origin master</span><br></pre></td></tr></table></figure>
<p>这会从远程的<code>master</code>分支拉取最新的代码并合并到你的本地<code>master</code>分支中。</p>
</li>
</ol>
<h4 id="克隆远程仓库"><a class="markdownIt-Anchor" href="#克隆远程仓库"></a> 克隆远程仓库</h4>
<ol>
<li>
<p><strong>克隆仓库</strong>: 当你想要从头开始在本地复制一个远程仓库时，可以使用<code>git clone</code>命令。这会将整个远程仓库下载到你的本地机器上。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit clone https://github.com/yourusername/yourrepository.git</span><br></pre></td></tr></table></figure>
<p>克隆完成后，你会得到一个包含所有分支、提交历史和文件的完整副本。</p>
</li>
</ol>
<h4 id="同步远程仓库"><a class="markdownIt-Anchor" href="#同步远程仓库"></a> 同步远程仓库</h4>
<ol>
<li>
<p><strong>获取最新的远程信息</strong>: 使用<code>git fetch</code>命令从远程仓库中获取最新的信息（如分支和提交），但不会合并到你的本地分支。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit fetch origin</span><br></pre></td></tr></table></figure>
<p>这会更新你的本地仓库，以反映远程仓库的最新状态。</p>
</li>
<li>
<p><strong>合并远程更改</strong>: 如果你想将获取的更改合并到你的当前分支中，可以使用<code>git merge</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit merge origin/master</span><br></pre></td></tr></table></figure>
<p>这会将远程<code>master</code>分支的更改合并到你当前的本地分支中。</p>
</li>
</ol>
<hr />
<p>通过掌握这些远程仓库操作，你可以更有效地与团队合作，确保每个人都能在同一个代码库上工作，并及时获得最新的更改。</p>
<p>请告诉我，如果你有任何问题或需要进一步的解释。或者你可以继续通过**/continue**来深入学习下一个主题。</p>
<h3 id="16-协作开发"><a class="markdownIt-Anchor" href="#16-协作开发"></a> 1.6 协作开发</h3>
<p>在团队中进行协作开发是版本控制系统（如Git）的重要应用场景之一。通过有效地管理分支、处理代码冲突、以及使用Pull Request流程，团队可以顺利地进行代码协作。接下来我们将深入探讨这些方面的内容。</p>
<h4 id="分支策略"><a class="markdownIt-Anchor" href="#分支策略"></a> 分支策略</h4>
<p>在协作开发中，分支策略是确保团队工作高效且不混乱的关键。常见的分支策略包括：</p>
<ol>
<li><strong>主干开发（Trunk-Based Development）</strong>: 所有的开发者都直接在<code>master</code>分支上工作并进行频繁的合并。这种方法适用于小团队，但可能会增加冲突的风险。</li>
<li><strong>Git Flow</strong>: 一种较为复杂但有条理的分支模型，包括<code>master</code>、<code>develop</code>、<code>feature</code>、<code>release</code>和<code>hotfix</code>分支。开发者在<code>feature</code>分支上工作，然后合并到<code>develop</code>。在发布版本时，代码从<code>develop</code>分支合并到<code>release</code>，最后再合并到<code>master</code>。</li>
<li><strong>GitHub Flow</strong>: 一种较为简单的模型，开发者从<code>master</code>分支创建一个新的功能分支（如<code>feature-branch</code>），完成后通过Pull Request将其合并回<code>master</code>。</li>
</ol>
<h4 id="pull-request流程"><a class="markdownIt-Anchor" href="#pull-request流程"></a> Pull Request流程</h4>
<p>Pull Request（PR）是协作开发中的重要工具。它允许开发者在合并代码之前进行代码审查，确保代码质量。</p>
<ol>
<li><strong>创建Pull Request</strong>: 当你在一个分支上完成了功能开发后，你可以在GitHub或GitLab等平台上创建一个Pull Request。</li>
<li><strong>代码审查</strong>: 其他团队成员可以查看你的代码更改，提出意见或建议，甚至要求进一步修改。</li>
<li><strong>合并Pull Request</strong>: 一旦代码审查通过并解决了所有问题，你可以将Pull Request合并到目标分支（通常是<code>master</code>或<code>develop</code>）。</li>
<li><strong>关闭分支</strong>: 合并完成后，通常会删除功能分支以保持仓库整洁。</li>
</ol>
<h4 id="处理代码冲突"><a class="markdownIt-Anchor" href="#处理代码冲突"></a> 处理代码冲突</h4>
<p>在协作开发中，不同开发者可能会在相同的文件上进行更改，从而导致代码冲突。处理冲突的步骤包括：</p>
<ol>
<li>
<p><strong>识别冲突</strong>: 当你尝试合并分支时，Git会自动检测冲突并提示需要手动解决。</p>
</li>
<li>
<p><strong>解决冲突</strong>: 打开冲突文件，你会看到冲突标记（例如<code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code>、<code>=======</code>、<code>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</code>），手动选择要保留的更改。</p>
</li>
<li>
<p><strong>提交解决后的更改</strong>: 解决冲突后，将修改的文件添加到暂存区，并提交。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">COPYgit add conflicted_file.txt</span><br><span class="line">git commit</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="协作最佳实践"><a class="markdownIt-Anchor" href="#协作最佳实践"></a> 协作最佳实践</h4>
<ol>
<li><strong>小步提交</strong>: 尽量进行小而频繁的提交，这样更容易追踪更改，并降低冲突的风险。</li>
<li><strong>保持分支同步</strong>: 经常从主分支拉取更新并合并到你的功能分支，以减少合并冲突的概率。</li>
<li><strong>清晰的提交信息</strong>: 提交信息应尽量清晰、简明扼要，解释本次更改的目的和内容。</li>
<li><strong>定期审查和重构</strong>: 定期进行代码审查和重构，保持代码质量，并确保所有团队成员都了解代码库的状态。</li>
</ol>
<hr />
<p>通过掌握这些协作开发技巧，你可以更有效地参与团队项目，确保代码质量和开发效率。</p>
<p>请告诉我，如果你有任何问题或需要进一步的解释。或者你可以继续通过**/continue**来深入学习下一个主题。</p>
<h3 id="17-标签和版本发布"><a class="markdownIt-Anchor" href="#17-标签和版本发布"></a> 1.7 标签和版本发布</h3>
<p>在代码开发过程中，标签（Tags）和版本发布是管理项目生命周期的重要工具。通过使用标签，你可以标记项目中的关键点或版本，并将这些版本发布给用户或团队成员。接下来我们将深入探讨如何在Git中使用标签和管理版本发布。</p>
<h4 id="使用标签-tags"><a class="markdownIt-Anchor" href="#使用标签-tags"></a> 使用标签 (Tags)</h4>
<p>标签用于标记仓库中的特定提交，通常用于标记版本发布点（如v1.0、v2.0）。标签有两种类型：<strong>轻量标签</strong>和<strong>注释标签</strong>。</p>
<ol>
<li>
<p><strong>创建轻量标签</strong>: 轻量标签类似于分支，但它是一个固定的标记，指向特定的提交。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit tag v1.0</span><br></pre></td></tr></table></figure>
<p>这个命令会在当前提交上创建一个名为<code>v1.0</code>的标签。</p>
</li>
<li>
<p><strong>创建注释标签</strong>: 注释标签包含额外的信息，如作者、日期和说明。它通常用于发布正式版本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit tag -a v1.0 -m &quot;Release version 1.0&quot;</span><br></pre></td></tr></table></figure>
<p>这个命令会在当前提交上创建一个注释标签，并附带一个说明信息。</p>
</li>
<li>
<p><strong>查看标签</strong>: 使用<code>git tag</code>命令可以查看所有标签。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit tag</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>推送标签到远程仓库</strong>: 标签默认不会被推送到远程仓库，你需要手动推送。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit push origin v1.0</span><br></pre></td></tr></table></figure>
<p>或者推送所有标签：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit push origin --tags</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>删除标签</strong>: 如果你需要删除一个标签，可以使用以下命令删除本地标签：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit tag -d v1.0</span><br></pre></td></tr></table></figure>
<p>然后删除远程仓库中的标签：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit push origin --delete tag v1.0</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="版本发布"><a class="markdownIt-Anchor" href="#版本发布"></a> 版本发布</h4>
<p>在软件开发中，版本发布是一个重要的里程碑。通常会在项目完成一个重要的阶段或发布新功能时进行版本发布。</p>
<ol>
<li>
<p><strong>选择一个提交点</strong>: 在发布新版本之前，选择一个稳定的提交点（通常是经过测试的主分支）进行版本标记。</p>
</li>
<li>
<p><strong>创建标签</strong>: 为这个提交点创建一个注释标签，标记为新版本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit tag -a v2.0 -m &quot;Release version 2.0&quot;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>发布版本</strong>: 使用平台（如GitHub）的发布功能，可以为这个版本创建一个发布说明，并发布给用户。</p>
</li>
<li>
<p><strong>版本号管理</strong>: 版本号通常遵循语义化版本控制（Semantic Versioning）的规则，如<code>MAJOR.MINOR.PATCH</code>。例如：</p>
<ul>
<li><strong>MAJOR</strong>: 当你进行不兼容的API更改时增加。</li>
<li><strong>MINOR</strong>: 当你增加了向后兼容的新功能时增加。</li>
<li><strong>PATCH</strong>: 当你进行向后兼容的Bug修复时增加。</li>
</ul>
</li>
</ol>
<h4 id="发布后的维护"><a class="markdownIt-Anchor" href="#发布后的维护"></a> 发布后的维护</h4>
<ol>
<li><strong>维护多个版本</strong>: 在发布新版本后，可能还需要维护旧版本。你可以使用分支来管理不同的版本线，进行Bug修复和小更新。</li>
<li><strong>热修复 (Hotfix)</strong>: 如果发布后发现了紧急问题，可以创建一个热修复分支（如<code>hotfix-v2.0.1</code>），修复后合并到主分支并发布一个补丁版本。</li>
</ol>
<hr />
<p>通过使用标签和版本发布，你可以更好地管理项目的生命周期，并确保用户或团队成员能够轻松访问不同版本的代码。</p>
<p>请告诉我，如果你有任何问题或需要进一步的解释。或者你可以继续通过**/continue**来深入学习下一个主题。</p>
<h3 id="18-处理冲突"><a class="markdownIt-Anchor" href="#18-处理冲突"></a> 1.8 处理冲突</h3>
<p>在团队协作开发中，当多个开发者同时对同一部分代码进行修改时，可能会导致代码冲突。Git无法自动合并这些更改，需要手动解决冲突。处理冲突是版本控制中的一个重要技能，确保代码库的稳定性和一致性。</p>
<h4 id="识别冲突"><a class="markdownIt-Anchor" href="#识别冲突"></a> 识别冲突</h4>
<p>当你尝试合并分支或拉取远程代码时，Git会自动检测到冲突并提示你需要手动解决。冲突通常会在以下情况下发生：</p>
<ul>
<li>不同的开发者修改了同一个文件的同一部分。</li>
<li>一个分支删除了另一个分支正在修改的文件。</li>
</ul>
<p>当冲突发生时，Git会在终端中显示类似以下的消息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">COPYAuto-merging file.txt</span><br><span class="line">CONFLICT (content): Merge conflict in file.txt</span><br><span class="line">Automatic merge failed; fix conflicts and then commit the result.</span><br></pre></td></tr></table></figure>
<h4 id="解决冲突"><a class="markdownIt-Anchor" href="#解决冲突"></a> 解决冲突</h4>
<ol>
<li>
<p><strong>打开冲突文件</strong>: 冲突文件中会显示冲突标记，以帮助你识别冲突的部分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">COPY&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line">This is the change in your current branch.</span><br><span class="line">=======</span><br><span class="line">This is the change in the branch you are merging in.</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; branch-to-merge</span><br></pre></td></tr></table></figure>
<p>以上是冲突标记的例子：</p>
<ul>
<li><code>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</code> 表示你当前分支的更改。</li>
<li><code>=======</code> 分隔了两个不同的更改。</li>
<li><code>&gt;&gt;&gt;&gt;&gt;&gt;&gt; branch-to-merge</code> 表示你正在合并的另一个分支的更改。</li>
</ul>
</li>
<li>
<p><strong>手动编辑解决冲突</strong>: 你需要手动编辑冲突文件，选择保留哪个更改，或结合两个更改。完成后，移除冲突标记。</p>
</li>
<li>
<p><strong>测试修改后的代码</strong>: 在解决冲突后，最好测试代码以确保它仍然能够正常运行，避免在合并后引入新的Bug。</p>
</li>
<li>
<p><strong>将解决后的文件添加到暂存区</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit add file.txt</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>提交解决后的更改</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit commit</span><br></pre></td></tr></table></figure>
<p>这会创建一个新的提交，记录你解决冲突的结果。</p>
</li>
</ol>
<h4 id="避免冲突的策略"><a class="markdownIt-Anchor" href="#避免冲突的策略"></a> 避免冲突的策略</h4>
<p>虽然冲突不可避免，但可以通过一些策略来减少冲突的发生：</p>
<ol>
<li>
<p><strong>频繁拉取远程更新</strong>: 定期从远程仓库拉取更新并合并到你的本地分支，可以减少冲突发生的概率。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYgit pull origin master</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>小步提交</strong>: 保持小而频繁的提交，避免在一个提交中包含太多更改。这使得在发生冲突时更容易解决。</p>
</li>
<li>
<p><strong>明确分工</strong>: 在团队中明确分工，避免多人同时修改同一文件或同一部分代码。</p>
</li>
<li>
<p><strong>使用分支</strong>: 为每个新功能或修复创建独立的分支，然后再合并回主分支。这有助于隔离不同开发者的工作。</p>
</li>
</ol>
<hr />
<p>通过掌握处理冲突的技巧，你可以更有效地解决团队开发中常见的问题，确保代码库的稳定性和一致性。</p>
<p>请告诉我，如果你有任何问题或需要进一步的解释。或者你可以继续通过**/continue**来深入学习下一个主题。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-07_小技巧/12_WSL使用小技巧"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/08/20/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/12_WSL%E4%BD%BF%E7%94%A8%E5%B0%8F%E6%8A%80%E5%B7%A7/"
    >WSL使用小技巧</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/08/20/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/12_WSL%E4%BD%BF%E7%94%A8%E5%B0%8F%E6%8A%80%E5%B7%A7/" class="article-date">
  <time datetime="2024-08-19T22:50:19.000Z" itemprop="datePublished">2024-08-20</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="wsl代理"><a class="markdownIt-Anchor" href="#wsl代理"></a> WSL代理</h1>
<p>现在不用v2ray ，而是用clash，感觉clash比v2ray强一点，下载地址和简单教程为：<a target="_blank" rel="noopener" href="https://igghelper.com/helper/?p=535">https://igghelper.com/helper/?p=535</a></p>
<p>安装之后导入代理，接下来的就是下面的一些设置了。</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043950.png" alt="image-20240819203759228" /></p>
<p>系统代理和开机自启要设置一下，如下所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043025.png" alt="image-20240819204149507" />image-20240819204149507</p>
<p>然后打开Tun模式，我测试就可以了</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043043.png" alt="image-20240819205233715" />image-20240819205233715</p>
<p>==这个tun模式指的是虚拟一个网卡，但这样的话会导致网络发生变化，从而导致一系列的问题，例如无法正常拉取==</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043016.png" alt="image-20240819213826540" />image-20240819213826540</p>
<p>所以现在正确的设置是这个地方：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043030.png" alt="image-20240819214845649" />image-20240819214845649</p>
<p>其他的就不用设置了，行了，去洗澡。</p>
<p>Clash 是一种代理工具，它可以根据配置文件的规则将网络流量通过不同的代理服务器或直接连接到目标服务器。<strong>本地直连</strong>（通常称为 “DIRECT”）是一种规则配置，意味着流量将不通过代理服务器，而是直接从你的设备连接到目标服务器。</p>
<p>选clash代理的时候尽量选美国，其他的好慢啊。</p>
<p>更新wsl内核版本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYsudo apt install linux-image-generic-hwe-22.04</span><br></pre></td></tr></table></figure>
<h1 id="windows商店打不开的解决方法"><a class="markdownIt-Anchor" href="#windows商店打不开的解决方法"></a> windows商店打不开的解决方法</h1>
<p>打开“运行”输入 inetcpl.cpl 或者“WINDOWS”+“R”键，输入 inetcpl.cpl亦可。<br />
点开高级往下拉，勾上&quot;使用TLS 1.2&quot;选项，或者点还原高级设置。</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409121422525.png" alt="在这里插入图片描述" /></p>
<h1 id="wsl压缩方法"><a class="markdownIt-Anchor" href="#wsl压缩方法"></a> WSL压缩方法</h1>
<p>PS C:\Users\Administrator\AppData\Local\Packages\CanonicalGroupLimited.Ubuntu22.04LTS_79rhkp1fndgsc\LocalState&gt; Optimize-VHD -Path .\ext4.vhdx  -Mode Full</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-07_小技巧/13_readme的使用"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/08/20/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/13_readme%E7%9A%84%E4%BD%BF%E7%94%A8/"
    >readme的使用</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/08/20/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/13_readme%E7%9A%84%E4%BD%BF%E7%94%A8/" class="article-date">
  <time datetime="2024-08-19T22:50:19.000Z" itemprop="datePublished">2024-08-20</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[ 2024-08-20 ](<a target="_blank" rel="noopener" href="https://chai0705.github.io/2024/08/20/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/11_">https://chai0705.github.io/2024/08/20/07_小技巧/11_</a> readme使用/)</p>
<p><a target="_blank" rel="noopener" href="https://chai0705.github.io/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</a></p>
<p>字数统计: 130  |   阅读时长≈ 1 分钟</p>
<ol>
<li>[问题发布](<a target="_blank" rel="noopener" href="https://chai0705.github.io/2024/08/20/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/11_">https://chai0705.github.io/2024/08/20/07_小技巧/11_</a> readme使用/#问题发布)</li>
</ol>
<h1 id="问题发布"><a class="markdownIt-Anchor" href="#问题发布"></a> 问题发布</h1>
<p>进入readme之后如下所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051042152.png" alt="image-20240820152323098" />image-20240820152323098</p>
<p>然后点击右上角的名称进入用户界面，如下所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051042196.png" alt="image-20240820152418206" />image-20240820152418206</p>
<p>然后点击这里的FAE项目，进入FAE界面如下所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051042176.png" alt="image-20240820152444567" />image-20240820152444567</p>
<p>进入FAE界面如下所示，然后点击左上角的加号即可：</p>
<p><strong><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051042169.png" alt="image-20240820152536358" />image-20240820152536358</strong></p>
<p>具体的内容填写界面如下所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051042162.png" alt="image-20240820152755600" />image-20240820152755600</p>
<p>其中只有RK芯片经销商:科通要注意一下，其他无所谓的，填写完成的表格如下所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051042119.png" alt="image-20240820152851767" />image-20240820152851767</p>
<p>然后等待RK的回复即可。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-02_瑞芯微/18_瑞芯微镜像拉取和同步"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/08/19/02_%E7%91%9E%E8%8A%AF%E5%BE%AE/18_%E7%91%9E%E8%8A%AF%E5%BE%AE%E9%95%9C%E5%83%8F%E6%8B%89%E5%8F%96%E5%92%8C%E5%90%8C%E6%AD%A5/"
    >瑞芯微镜像拉取和同步</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/08/19/02_%E7%91%9E%E8%8A%AF%E5%BE%AE/18_%E7%91%9E%E8%8A%AF%E5%BE%AE%E9%95%9C%E5%83%8F%E6%8B%89%E5%8F%96%E5%92%8C%E5%90%8C%E6%AD%A5/" class="article-date">
  <time datetime="2024-08-19T09:17:03.000Z" itemprop="datePublished">2024-08-19</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%91%9E%E8%8A%AF%E5%BE%AE/">瑞芯微</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote>
<p>仍旧是先说明一下必要情况，我是很想要这边能够直接得到瑞芯微的源码的，这样会方便很多很多，不仅仅是代码的更新上，这样我也就有动力去搭建自己的github了，一个个都没动过的源码，一点都没有想维护的动力，像现在这样也太笨了，真的就笨的不行，我不喜欢，最重要的是没有修改的痕迹，以后再看的时候依然不知道自己怎么改的，我认为这是不对的，但之前的时候都做不出这种重大的改变，没有那种破釜沉舟、一往无前的气魄，或许也是一种习惯，当我习惯这个东西了，自然而然地就用上了。</p>
</blockquote>
<h1 id="正常的镜像拉取和同步"><a class="markdownIt-Anchor" href="#正常的镜像拉取和同步"></a> 正常的镜像拉取和同步</h1>
<p>为了安全起见，这些都放在了我自己的硬盘上。</p>
<p>邮箱chai@topeet.com</p>
<p>名字 chai</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">COPYgit config --global user.email &quot;chai@topeet.com&quot;</span><br><span class="line">git config --global user.name &quot;chai&quot;</span><br></pre></td></tr></table></figure>
<p>公钥 id_rsa.pub</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPY</span><br></pre></td></tr></table></figure>
<p>私钥 id_rsa</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPY</span><br></pre></td></tr></table></figure>
<p>~/.ssh/config</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPY</span><br></pre></td></tr></table></figure>
<p>更改权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">COPYchmod 600 ~/.ssh/id_rsa</span><br><span class="line">COPYrepo init --repo-url ssh://git@www.rockchip.com.cn/repo/rk/tools/repo \</span><br><span class="line">-u ssh://git@www.rockchip.com.cn/linux/rockchip/platform/manifests \</span><br><span class="line">-b linux -m rk3588_linux_release.xml</span><br><span class="line"></span><br><span class="line">.repo/repo/repo sync -j20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">repo init --repo-url ssh://git@www.rockchip.com.cn/repo/rk/tools/repo \</span><br><span class="line">-u ssh://git@www.rockchip.com.cn/linux/rockchip/platform/manifests \</span><br><span class="line">-b linux -m rk356x_linux_release.xml</span><br></pre></td></tr></table></figure>
<p>舒舒服服，这时候我就可以同步了，真不错啊，当然以后也是在公司的电脑上进行同步，这其实也只是第一步而已，后面还有怎样能进行更好的更新我们自己的源码，其实这个机会真的不错，我是一定以及肯定的要抓住的,现在的目标是学习鲁班猫，我要构建一个自己的repo。</p>
<h1 id="测试我自己的github"><a class="markdownIt-Anchor" href="#测试我自己的github"></a> 测试我自己的github</h1>
<p>我的本意是思考一个如何在好多机器上都能修改我仓库的方法，正好因为上面的这个公钥和私钥的相关测试让我突然惊醒，我在想，github不也是同样的方式吗，都是通过公钥来判断是不是有对应的权限，所以以后我可以很方便的管理和更新我的代码和仓库。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-07_小技巧/11_repo学习"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/08/19/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/11_repo%E5%AD%A6%E4%B9%A0/"
    >repo的学习</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/08/19/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/11_repo%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time datetime="2024-08-18T22:50:19.000Z" itemprop="datePublished">2024-08-19</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote>
<p>说一下前因后果，之前学了一段时间的git，但是无论如何也没用起来，这一点让我很是不爽,为了实现能常用git我甚至还搞了一个完全的Linux系统，但还是没有用起来，这还是让我很不爽，最近开始研究野火的SDK了，发现野火是用repo来进行代码管理的，其实更上层的瑞芯微也是这样管理代码的，但我们也不知道为了什么起见，可能对应的客户不同吧，就一个板子一套镜像，我认为这是有问题的，但我并没有什么话语权，只能听安排，但是我可以自己维护一个主线，我甚至可以搞一个千兆的宽带，这一点在理，但让我搞一个新机器我又不愿意，这个以后再说，先来研究理论基础。</p>
</blockquote>
<h1 id="repo理论基础"><a class="markdownIt-Anchor" href="#repo理论基础"></a> repo理论基础</h1>
<h2 id="repo是什么"><a class="markdownIt-Anchor" href="#repo是什么"></a> repo是什么？</h2>
<p><strong>Repo是一个高级的版本库管理工具，主要用于管理Android项目的多个Git仓库</strong>。下面将非常详细地讲解Repo的各个方面：</p>
<ol>
<li><strong>起源与用途</strong>：
<ul>
<li>Repo是由Google开发并广泛使用于Android开源项目（AOSP）中的工具。</li>
<li>它旨在简化对包含多个Git仓库的大型项目的管理工作。</li>
<li>在Android项目中，Repo帮助开发者同步、管理和更新分布在多个Git仓库中的代码。</li>
</ul>
</li>
<li><strong>核心功能与特点</strong>：
<ul>
<li><strong>仓库管理</strong>：Repo能够初始化一个仓库清单（manifest），该清单描述了项目所需的所有Git仓库的位置和分支信息。</li>
<li><strong>同步操作</strong>：通过<code>repo sync</code>命令，Repo可以自动地克隆或更新所有列在清单中的Git仓库。</li>
<li><strong>分支管理</strong>：Repo支持在多个仓库之间切换分支，确保整个项目的一致性。</li>
<li><strong>状态查看</strong>：使用<code>repo status</code>可以查看所有仓库的当前状态，包括哪些文件被修改、新增或删除。</li>
<li><strong>上传与审查</strong>：Repo集成了Git的上传（<code>git push</code>）和代码审查（Gerrit）的功能，便于开发者提交更改并进行代码审查。</li>
</ul>
</li>
<li><strong>工作原理</strong>：
<ul>
<li>Repo本身是一个Python脚本，它利用Git命令来管理多个Git仓库。</li>
<li>当Repo初始化一个项目时，它会首先克隆一个特殊的Git仓库（通常称为manifest仓库），该仓库包含了项目的manifest文件。</li>
<li>Manifest文件是一个XML文件，它定义了项目中所有其他Git仓库的位置、分支和复制条件。</li>
<li>随后，Repo根据manifest文件的信息，逐一克隆或更新每个Git仓库到本地工作目录。</li>
</ul>
</li>
<li><strong>优势</strong>：
<ul>
<li><strong>简化管理</strong>：对于包含数百个Git仓库的大型项目来说，手动管理这些仓库将非常繁琐且容易出错。Repo提供了自动化的管理工具，大大简化了这一过程。</li>
<li><strong>保持一致性</strong>：Repo确保所有仓库都按照manifest文件的规定处于正确的分支和版本，从而保证了整个项目的一致性。</li>
<li><strong>提高开发效率</strong>：通过集成代码上传和审查的功能，Repo帮助开发者更快地完成开发流程。</li>
</ul>
</li>
<li><strong>使用场景</strong>：
<ul>
<li>Repo特别适用于大型、复杂且包含多个相互依赖的组件或模块的项目。</li>
<li>在Android开源项目中，Repo是不可或缺的工具，用于管理数以百计的Git仓库。</li>
<li>类似的项目，如Chrome OS和Linux内核项目，也可能使用Repo或其类似工具来管理多个Git仓库。</li>
</ul>
</li>
<li><strong>安装与配置</strong>：
<ul>
<li>Repo通常需要通过特定的脚本来安装，因为它本身是一个Python脚本。</li>
<li>安装后，需要通过Repo的<code>init</code>命令来初始化一个项目，该命令会克隆manifest仓库并设置项目的本地环境。</li>
<li>配置Repo通常涉及编辑manifest文件，以更改项目的仓库列表、分支和复制条件。</li>
</ul>
</li>
</ol>
<p>通过以上详细的讲解，你应该对Repo有了全面而深入的理解。Repo是一个强大的工具，它简化了大型项目中多个Git仓库的管理，提高了开发效率和项目一致性。</p>
<h2 id="repo的安装"><a class="markdownIt-Anchor" href="#repo的安装"></a> repo的安装</h2>
<p>repo 其实就是个python脚本，所以只需要拉取下来放到某个路径就好了，但在此之前需要先安装git，git的安装方法不再讲解，可以看前面的文档。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://storage.googleapis.com/git-repo-downloads/repo .</span><br><span class="line">wget https://raw.githubusercontent.com/esrlabs/git-repo/stable/repo .</span><br></pre></td></tr></table></figure>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043063.png" alt="image-20240817170916119" />image-20240817170916119</p>
<p>然后赋予可执行权限，拷贝到/usr/bin/目录：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043962.png" alt="image-20240817171016635" />image-20240817171016635</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043016.png" alt="image-20240817171038551" />image-20240817171038551</p>
<h2 id="repo常用命令"><a class="markdownIt-Anchor" href="#repo常用命令"></a> repo常用命令</h2>
<h3 id="repo常用命令-2"><a class="markdownIt-Anchor" href="#repo常用命令-2"></a> repo常用命令</h3>
<ol>
<li>
<p><strong>初始化repo</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo --trace init -u https://android.googlesource.com/platform/manifest -b branch_name -m default.xml</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>同步代码</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo sync</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>上传代码到远程仓库</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYrepo upload dev</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>列出分支</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYrepo branch  # 或者 repo branches</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>状态查询</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYrepo status</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>查看修改</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYrepo diff</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>撤销整个工程的本地修改</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYrepo forall -c &#x27;git reset --hard HEAD; git clean -df; git rebase --abort&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>切换整个工程模块的分支</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYrepo forall -c &#x27;git branch master&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>更新整个工程模块的代码</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPYrepo forall -c &#x27;git pull projectname&#x27;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="repo与git命令对照表"><a class="markdownIt-Anchor" href="#repo与git命令对照表"></a> repo与git命令对照表</h3>
<table>
<thead>
<tr>
<th>repo命令</th>
<th>等同git命令</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>repo init -u</td>
<td>无</td>
<td>初始化</td>
</tr>
<tr>
<td>repo sync</td>
<td>git pull</td>
<td>同步代码</td>
</tr>
<tr>
<td>repo upload</td>
<td>git push</td>
<td>上传代码</td>
</tr>
<tr>
<td>repo forall</td>
<td>无</td>
<td>多仓执行</td>
</tr>
<tr>
<td>repo start</td>
<td>git checkout -b</td>
<td>创建并切换分支</td>
</tr>
<tr>
<td>repo checkout</td>
<td>git checkout</td>
<td>切换分支</td>
</tr>
<tr>
<td>repo status</td>
<td>git status</td>
<td>状态查询</td>
</tr>
<tr>
<td>repo branches</td>
<td>git branch</td>
<td>分支查询</td>
</tr>
<tr>
<td>repo diff</td>
<td>git diff</td>
<td>文件对比</td>
</tr>
<tr>
<td>repo prune</td>
<td>git remote prune origin</td>
<td>删除合并分支</td>
</tr>
<tr>
<td>repo stage –i</td>
<td>git add --interactive</td>
<td>添加文件到暂存区</td>
</tr>
<tr>
<td>repo abandon</td>
<td>git branch -D</td>
<td>删除分支</td>
</tr>
<tr>
<td>repo version</td>
<td>无</td>
<td>查看版本号</td>
</tr>
</tbody>
</table>
<h3 id="repo-脚本参数"><a class="markdownIt-Anchor" href="#repo-脚本参数"></a> repo 脚本参数</h3>
<ul>
<li><code>--repo-url=URL</code>: repo 工具本身的 git 库地址。缺省为：<code>git://android.git.kernel.org/tools/repo.git</code></li>
<li><code>--repo-branch=REVISION</code>: 使用repo的版本库，即repo git库的分支或者里程碑名称。缺省为<code>caf-stable</code></li>
<li><code>--no-repo-verify</code>: 设定不要对repo的里程碑签名进行严格的验证。</li>
<li><code>-u</code> 或 <code>--manifest-url</code>: 设定清单库的Git服务器地址。</li>
<li><code>-b</code> 或 <code>--manifest-branch</code>: 检出清单库的特定分支。</li>
<li><code>--mirror</code>: 只在repo第一次初始化的时候使用，建立本地镜像。</li>
<li><code>-m</code> 或 <code>--manifest-name</code>: 指定清单库中的某个清单为有效的清单文件。默认为<code>default.xml</code>。</li>
<li><code>--no-tags</code>: 不获取标签（tags）。</li>
<li><code>--trace</code>: 显示repo命令的执行过程。</li>
</ul>
<h3 id="repo-help"><a class="markdownIt-Anchor" href="#repo-help"></a> repo help</h3>
<ul>
<li><code>repo help</code>：查看 <code>repo</code> 的帮助文档。</li>
<li><code>repo help sync</code>：查看 <code>sync</code> 命令的帮助文档。</li>
</ul>
<h3 id="repo-init"><a class="markdownIt-Anchor" href="#repo-init"></a> repo init</h3>
<ul>
<li><code>repo init</code> 主要用于初始化 <code>repo</code> 工具，执行的 <code>repo</code> 脚本是一个引导工具，而非下载代码的脚本。</li>
<li>该命令会克隆 <code>manifest.git</code> 到 <code>.repo/manifests/</code> 目录下（地址由 <code>-u</code> 参数指定），并在 <code>.repo/</code> 目录中生成符号链接 <code>manifest.xml</code>，指向 <code>.repo/manifests/default.xml</code>。</li>
<li>如果 <code>.repo/manifests/</code> 目录中有多个 <code>xml</code> 文件，可通过 <code>repo init -m</code> 参数指定要使用的 <code>manifest</code> 文件，默认是 <code>default.xml</code>。</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">COPYbash</span><br><span class="line">复制代码</span><br><span class="line">repo --trace init -u https://android.googlesource.com/platform/manifest -b branch_name -m default.xml &amp;&amp; repo sync &amp;&amp; repo start branch_name --all</span><br></pre></td></tr></table></figure>
<ul>
<li><code>--trace</code>：查看 <code>repo</code> 背后的具体操作。</li>
<li><code>-u</code>：指定 <code>Manifest</code> 库的 Git 访问路径。</li>
<li><code>-m</code>：指定使用的 <code>Manifest</code> 文件。</li>
<li><code>-b</code>：指定使用 <code>Manifest</code> 仓库中的某个特定分支。</li>
</ul>
<p><strong>初始化完成后生成的 <code>.repo</code> 目录结构：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">COPYbash复制代码tree .repo -L 1</span><br><span class="line">.repo</span><br><span class="line">├── manifest.xml -&gt; manifests/default.xml</span><br><span class="line">├── manifests</span><br><span class="line">├── manifests.git</span><br><span class="line">├── project-objects</span><br><span class="line">├── project.list</span><br><span class="line">├── projects</span><br><span class="line">└── repo</span><br></pre></td></tr></table></figure>
<p><strong>各文件夹的用途：</strong></p>
<ul>
<li><code>manifests</code>：清单文件的仓库。</li>
<li><code>manifests.git</code>：清单文件的 Git 裸仓库，不带工作区。</li>
<li><code>manifest.xml</code>：符号链接，指向用于初始化工作区的清单文件。</li>
<li><code>project.list</code>：包含所有项目名称的列表。</li>
<li><code>projects</code>：包含所有 <code>git project</code> 的裸仓库，文件夹的层次结构与工作区布局一致。</li>
<li><code>repo</code>：<code>repo</code> 命令的主体，推荐使用其中的 <code>repo</code> 命令。</li>
</ul>
<h3 id="repo-sync"><a class="markdownIt-Anchor" href="#repo-sync"></a> repo sync</h3>
<ul>
<li><strong>首次运行</strong>：相当于 <code>git clone</code>，会将服务器的内容完全拷贝到本地。</li>
<li><strong>后续运行</strong>：若项目已同步，则相当于执行 <code>git remote update &amp;&amp; git rebase origin/&lt;branch&gt;</code>。</li>
</ul>
<p><code>repo sync</code> 不会更新 <code>.repo/repo</code> 仓库。</p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>-j</code>：开启多线程同步，加快同步速度，默认使用4个线程。</li>
<li><code>-c, --current-branch</code>：仅同步指定的远程分支，默认同步所有远程分支。</li>
<li><code>-d, --detach</code>：脱离当前本地分支，切换到 <code>manifest.xml</code> 中设定的分支。第一次 <code>sync</code> 后通常会切换到 <code>dev</code> 分支开发，若不带此参数，可能导致本地 <code>dev</code> 分支与 <code>manifest</code> 远程分支合并，可能引发同步失败。</li>
<li><code>-f, --force-broken</code>：当某些 <code>git</code> 库同步失败时，不中断同步操作，继续同步其他 <code>git</code> 库。</li>
</ul>
<h3 id="repo-upload"><a class="markdownIt-Anchor" href="#repo-upload"></a> repo upload</h3>
<ul>
<li>类似于 <code>git push</code>。</li>
<li><strong>用法</strong>：<code>repo upload [--re --cc] [项目列表]</code></li>
<li>若无参数，<code>repo upload</code> 会搜索所有项目中的更改以进行上传。</li>
</ul>
<h3 id="repo-start"><a class="markdownIt-Anchor" href="#repo-start"></a> repo start</h3>
<ul>
<li><code>repo start</code> 是 <code>git checkout -b</code> 的封装，但 <code>repo start</code> 是基于 <code>manifest</code> 中设定的分支创建特性分支。</li>
</ul>
<p><strong>示例：</strong></p>
<ul>
<li><code>repo start stable --all</code>：假设 <code>manifest</code> 文件中设定的分支为 <code>gingerbread-stable</code>，则会在所有项目上基于该分支创建特性分支 <code>stable</code>。</li>
<li><code>repo start stable platform/build platform/bionic</code>：可以指定项目。</li>
</ul>
<h3 id="repo-forall"><a class="markdownIt-Anchor" href="#repo-forall"></a> repo forall</h3>
<ul>
<li><code>repo forall [&lt;PROJECT_LIST&gt;] -c &lt;COMMAND&gt;</code>：在每个项目中运行指定的 Shell 命令。</li>
</ul>
<p><strong>可用的环境变量：</strong></p>
<ul>
<li><code>REPO_PROJECT</code>：项目的唯一名称。</li>
<li><code>REPO_PATH</code>：客户端根目录的相对路径。</li>
<li><code>REPO_REMOTE</code>：清单中远程系统的名称。</li>
<li><code>REPO_LREV</code>：清单中的修订版本名称，已转换为本地跟踪分支。</li>
<li><code>REPO_RREV</code>：清单中的修订版本名称，与清单中的名称一致。</li>
</ul>
<p><strong>常用参数：</strong></p>
<ul>
<li><code>-c</code>：运行指定的命令。</li>
<li><code>-p</code>：输出命令结果前显示项目标头。</li>
<li><code>-v</code>：显示命令向 <code>stderr</code> 写入的消息。</li>
</ul>
<h3 id="manifest-文件"><a class="markdownIt-Anchor" href="#manifest-文件"></a> manifest 文件</h3>
<ul>
<li><code>manifest</code> 文件是 <code>repo</code> 工具的核心，记录所有 <code>git</code> 仓库的地址和分支。</li>
<li>官方文档参考：<a target="_blank" rel="noopener" href="https://github.com/GerritCodeReview/git-repo/blob/main/docs/manifest-format.md">manifest 文件格式</a>。</li>
</ul>
<p><strong>manifest 文件示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">COPY&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;manifest&gt;</span><br><span class="line">    &lt;remote /&gt;</span><br><span class="line">    &lt;default remote=&quot;origin&quot; revision=&quot;master&quot; sync-j=&quot;4&quot; /&gt;</span><br><span class="line">    &lt;project /&gt;</span><br><span class="line">    &lt;project /&gt;</span><br><span class="line">    &lt;project /&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>
<p><strong>元素说明：</strong></p>
<ul>
<li><code>remote</code>：指定使用 <code>repo upload</code> 时提交到哪个服务器，可定义一个或多个 <code>remote</code>。</li>
<li>default：包含一些缺省属性，如果 project中未指定，则使用这些属性。
<ul>
<li><code>revision</code>：Git 分支的名称，可为 <code>branch</code>、<code>tag</code> 或 <code>commit id</code>。</li>
<li><code>sync-j</code>：同步时并行任务数。</li>
<li><code>sync-c</code>：为 <code>true</code> 时，仅同步 <code>project</code> 中指定的分支。</li>
</ul>
</li>
<li>project：定义一个或多个 git 仓库。
<ul>
<li><code>name</code>：<code>git project</code> 的名字。</li>
<li><code>path</code>：本地工作区路径。</li>
<li><code>revision</code>：与 <code>default</code> 标签中的 <code>revision</code> 含义相同。</li>
</ul>
</li>
</ul>
<h1 id="repo实际用法"><a class="markdownIt-Anchor" href="#repo实际用法"></a> repo实际用法</h1>
<blockquote>
<p>我之前只用过野火的repo，今天就继续用野火的repo，使用一下</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">COPY# 创建目录</span><br><span class="line">mkdir ~/LubanCat_SDK</span><br><span class="line"></span><br><span class="line">cd ~/LubanCat_SDK</span><br><span class="line"></span><br><span class="line"># 配置姓名和邮箱</span><br><span class="line">git config --global user.email &quot;you@example.com&quot;</span><br><span class="line">git config --global user.name &quot;Your Name&quot;</span><br><span class="line">  </span><br><span class="line"># 拉取LubanCat-RK356x系列Linux_SDK</span><br><span class="line">repo init --depth=1 -u https://github.com/LubanCat/manifests.git -b linux -m rk356x_linux_release.xml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 拉取LubanCat-RK3588系列Linux_SDK</span><br><span class="line">repo init --depth=1 -u https://github.com/LubanCat/manifests.git -b linux -m rk3588_linux_release.xml</span><br><span class="line"></span><br><span class="line">#如果运行以上命令失败，提示：fatal: Cannot get https://gerrit.googlesource.com/git-repo/clone.bundle</span><br><span class="line">#则可以在以上命令中添加选项 --repo-url https://mirrors.tuna.tsinghua.edu.cn/git/git-repo</span><br></pre></td></tr></table></figure>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043976.png" alt="image-20240819093048396" />image-20240819093048396</p>
<blockquote>
<ul>
<li><code>repo init</code>: 初始化 Repo 客户端。</li>
<li><code>--depth=1</code>: 进行浅克隆（shallow clone），即只克隆最近的提交历史。这可以加速克隆过程，因为你不会获取整个项目的历史记录，只会获取最近的提交。这对于大型项目特别有用，可以节省时间和带宽。</li>
<li><code>-u https://github.com/LubanCat/manifests.git</code>: 指定清单仓库（manifest repository）的 URL。这是包含项目清单文件的 Git 仓库，清单文件定义了项目中包含的所有其他仓库。</li>
<li><code>-b linux</code>: 指定要检出的分支名。在这个例子中，<code>linux</code> 是清单仓库中的一个分支名，该分支包含了特定于该项目的清单文件。</li>
<li><code>-m rk3588_linux_release.xml</code>: 指定要使用的清单文件名。在这个例子中，<code>rk3588_linux_release.xml</code> 是清单仓库中的一个文件，它定义了项目的具体结构和配置。</li>
</ul>
<p>这个命令的作用是初始化一个 Repo 工作环境，从指定的 URL 克隆清单仓库的 <code>linux</code> 分支，并使用 <code>rk3588_linux_release.xml</code> 清单文件来配置项目。这个清单文件将包含项目中所有其他 Git 仓库的信息，以及这些仓库应该如何被检出和配置。在 <code>repo init</code> 完成之后，你通常会使用 <code>repo sync</code> 命令来同步（即克隆或更新）清单文件中定义的所有仓库。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.repo/repo/repo sync -c -j20</span><br></pre></td></tr></table></figure>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043968.png" alt="image-20240819100404978" />image-20240819100404978</p>
<p>这个命令主要做了以下几件事情：</p>
<ol>
<li><strong>同步代码</strong>：<code>repo sync</code> 命令的主要目的是从远程仓库同步代码到本地。它会拉取所有在 <code>manifest</code> 文件中定义的项目的最新代码。</li>
<li><strong>-c 选项</strong>：这个选项表示只同步当前分支。也就是说，它只会同步 manifest 文件中定义的当前分支的最新代码，而不会同步其他分支的代码。</li>
<li><strong>-j20 选项</strong>：这个选项指定了同步过程中的并发任务数。<code>-j20</code> 表示会同时运行 20 个任务来同步代码，这可以加速同步过程，但也可能增加网络和 CPU 的负载。你需要根据你的机器和网络环境来合理设置这个值。</li>
</ol>
<p>同步完成之后如下图所示：<br />
<img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043001.png" alt="image-20240819100736704" />image-20240819100736704</p>
<p>而实际的代码同步凭靠的是这个rk3588_linux5.10_stable.xml文件，该文件的内容如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">COPY&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;manifest&gt;</span><br><span class="line">  &lt;!-- &lt;remote name=&quot;origin&quot; fetch=&quot;ssh://git@gitlab.ebf.local/rockchip/linux/&quot;/&gt; --&gt;</span><br><span class="line">  &lt;remote name=&quot;origin&quot; fetch=&quot;https://github.com/LubanCat&quot;/&gt;  </span><br><span class="line"></span><br><span class="line">  &lt;default remote=&quot;origin&quot; sync-j=&quot;4&quot;/&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;project name=&quot;debian11&quot; path=&quot;debian&quot; revision=&quot;refs/tags/stable-5.10.160&quot; clone-depth=&quot;1&quot;/&gt;</span><br><span class="line">  &lt;project name=&quot;device_rockchip&quot; path=&quot;device/rockchip&quot; revision=&quot;a85039a1513b2debd79f8e7ecc59c5cca01d1530&quot; upstream=&quot;master&quot; dest-branch=&quot;master&quot;&gt;</span><br><span class="line">    &lt;linkfile src=&quot;common/mkfirmware.sh&quot; dest=&quot;mkfirmware.sh&quot;/&gt;</span><br><span class="line">    &lt;linkfile src=&quot;common/build.sh&quot; dest=&quot;build.sh&quot;/&gt;</span><br><span class="line">    &lt;linkfile src=&quot;common/rkflash.sh&quot; dest=&quot;rkflash.sh&quot;/&gt;</span><br><span class="line">    &lt;linkfile src=&quot;rk3588&quot; dest=&quot;device/rockchip/.target_product&quot;/&gt;</span><br><span class="line">  &lt;/project&gt;</span><br><span class="line">  &lt;project name=&quot;gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu&quot; path=&quot;prebuilts/gcc/linux-x86/aarch64/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu&quot; revision=&quot;adbb295a970c4b39dc487c95226fe84d2c460072&quot; upstream=&quot;master&quot; dest-branch=&quot;master&quot;/&gt;</span><br><span class="line">  &lt;project name=&quot;kernel&quot; revision=&quot;4124065a2763eb8097806289b4825c8933b82efc&quot; upstream=&quot;stable-5.10-rk3588&quot; dest-branch=&quot;stable-5.10-rk3588&quot;/&gt;</span><br><span class="line">  &lt;project name=&quot;lubancat-bin&quot; revision=&quot;da4446576b196334590e59a9ec4cb2a094980bdf&quot; upstream=&quot;rk3588&quot; dest-branch=&quot;rk3588&quot;/&gt;</span><br><span class="line">  &lt;project name=&quot;rkbin&quot; revision=&quot;2dde28de6e47f5003683cd3a20b4243c63e6b2fb&quot; upstream=&quot;main&quot; dest-branch=&quot;main&quot;/&gt;</span><br><span class="line">  &lt;project name=&quot;tools&quot; revision=&quot;210be81d659a6bc4e7a648744ae77837f394be0f&quot; upstream=&quot;master&quot; dest-branch=&quot;master&quot;&gt;</span><br><span class="line">    &lt;linkfile src=&quot;windows/RKDevTool/RKDevTool_Release/rk3588-config.cfg&quot; dest=&quot;tools/windows/RKDevTool/RKDevTool_Release/config.cfg&quot;/&gt;</span><br><span class="line">    &lt;linkfile src=&quot;windows/RKDevTool/rockdev/rk3588-package-file&quot; dest=&quot;tools/windows/RKDevTool/rockdev/package-file&quot;/&gt;</span><br><span class="line">    &lt;linkfile src=&quot;windows/RKDevTool/rockdev/rk3588-mkupdate.bat&quot; dest=&quot;tools/windows/RKDevTool/rockdev/mkupdate.bat&quot;/&gt;</span><br><span class="line">    &lt;linkfile src=&quot;linux/Linux_Pack_Firmware/rockdev/rk3588-mkupdate.sh&quot; dest=&quot;tools/linux/Linux_Pack_Firmware/rockdev/mkupdate.sh&quot;/&gt;</span><br><span class="line">    &lt;linkfile src=&quot;linux/Linux_Pack_Firmware/rockdev/rk3588-package-file&quot; dest=&quot;tools/linux/Linux_Pack_Firmware/rockdev/package-file&quot;/&gt;</span><br><span class="line">  &lt;/project&gt;</span><br><span class="line">  &lt;project name=&quot;u-boot&quot; revision=&quot;refs/tags/lbc-gen-rkr7.1&quot; clone-depth=&quot;1&quot;/&gt;</span><br><span class="line">  &lt;project name=&quot;ubuntu&quot; revision=&quot;refs/tags/stable-5.10-rk3588&quot; clone-depth=&quot;1&quot;/&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>
<p>在这个 <code>XML</code> 文件中，包含了一个 Android <code>repo</code> 工具所使用的 <code>manifest</code> 文件。它定义了多个项目的来源、分支、路径、文件链接等关键信息。下面我会详细解释这个 XML 文件的结构及各个元素的作用。</p>
<p><strong>整体结构</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">COPY&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;manifest&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</code>: 这是 XML 文件的声明，表示该文件是 XML 1.0 版本，字符编码是 <code>UTF-8</code>。</li>
<li><code>&lt;manifest&gt;</code>: 这是 XML 文件的根元素，所有项目的配置信息都在这个根元素之内。Manifest 是 <code>repo</code> 工具的核心配置文件，用于描述多 Git 仓库如何被同步、管理。</li>
</ul>
<p><strong>元素</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPY&lt;remote name=&quot;origin&quot; fetch=&quot;https://github.com/LubanCat&quot;/&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong>作用</strong>：定义远程仓库的位置。</p>
</li>
<li>
<p><strong>属性</strong>：</p>
<ul>
<li><code>name</code>: 为远程仓库命名为 <code>origin</code>，这个名字将在其他地方引用到，比如 <code>&lt;default&gt;</code> 和 <code>&lt;project&gt;</code>。</li>
<li><code>fetch</code>: 指定远程仓库的 URL。在这个例子中，代码会从 <code>https://github.com/LubanCat</code> 获取。</li>
</ul>
<blockquote>
<p>注释 <code>&lt;!-- ... --&gt;</code> 表示注释掉的部分，实际上在文件解析时会被忽略。这里可以看到原本使用的是 <code>ssh://</code> 的 URL 被注释掉，改用了 <code>https</code> 的 URL。</p>
</blockquote>
</li>
</ul>
<p><strong><code>&lt;default&gt;</code> 元素</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;default remote=&quot;origin&quot; sync-j=&quot;4&quot;/&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong>作用</strong>：设置默认的同步和远程仓库配置，适用于该清单中所有项目（除非项目本身有覆盖配置）。</p>
</li>
<li>
<p>属性</p>
<p>：</p>
<ul>
<li><code>remote</code>: 使用前面定义的 <code>origin</code> 作为默认远程仓库。</li>
<li><code>sync-j</code>: 指定在同步代码时使用的并行线程数。在这个例子中，使用 <code>4</code> 个线程并发同步，可以提高同步速度。</li>
</ul>
</li>
</ul>
<p><strong>元素</strong></p>
<p>项目的核心定义，描述要同步的 Git 仓库。可以有多个 <code>&lt;project&gt;</code> 元素，每一个都代表一个独立的 Git 仓库。</p>
<p>示例 1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;project name=&quot;debian11&quot; path=&quot;debian&quot; revision=&quot;refs/tags/stable-5.10.160&quot; clone-depth=&quot;1&quot;/&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong>作用</strong>：定义一个名为 <code>debian11</code> 的项目，这个项目是一个 Git 仓库。</p>
</li>
<li>
<p>属性</p>
<p>：</p>
<ul>
<li><code>name</code>: 仓库名，指向仓库的名称为 <code>debian11</code>。</li>
<li><code>path</code>: 项目的本地路径。在这个例子中，同步的代码将存放在 <code>debian/</code> 目录下。</li>
<li><code>revision</code>: 指定要检出的特定分支、标签或提交 ID。这里使用的是 <code>refs/tags/stable-5.10.160</code>，这意味着会同步 <code>stable-5.10.160</code> 标签的内容。</li>
<li><code>clone-depth</code>: 指定浅克隆的深度（即保留最近的 n 个提交）。这里是 <code>1</code>，表示只克隆最近一次提交历史。</li>
</ul>
</li>
</ul>
<p>示例 2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">COPY&lt;project name=&quot;device_rockchip&quot; path=&quot;device/rockchip&quot; revision=&quot;a85039a1513b2debd79f8e7ecc59c5cca01d1530&quot; upstream=&quot;master&quot; dest-branch=&quot;master&quot;&gt;</span><br><span class="line">  &lt;linkfile src=&quot;common/mkfirmware.sh&quot; dest=&quot;mkfirmware.sh&quot;/&gt;</span><br><span class="line">  &lt;linkfile src=&quot;common/build.sh&quot; dest=&quot;build.sh&quot;/&gt;</span><br><span class="line">  &lt;linkfile src=&quot;common/rkflash.sh&quot; dest=&quot;rkflash.sh&quot;/&gt;</span><br><span class="line">  &lt;linkfile src=&quot;rk3588&quot; dest=&quot;device/rockchip/.target_product&quot;/&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong>作用</strong>：定义名为 <code>device_rockchip</code> 的项目，并为其指定多个文件的链接（<code>linkfile</code> 元素）。</p>
</li>
<li>
<p><strong>属性</strong>：</p>
<ul>
<li><code>name</code>: 仓库名 <code>device_rockchip</code>。</li>
<li><code>path</code>: 项目的本地路径为 <code>device/rockchip</code>。</li>
<li><code>revision</code>: 同步到特定的提交，这里是 <code>a85039a1513b2debd79f8e7ecc59c5cca01d1530</code>。</li>
<li><code>upstream</code>: 指定该项目的上游分支是 <code>master</code>。</li>
<li><code>dest-branch</code>: 指定目标分支为 <code>master</code>。</li>
</ul>
</li>
<li>
<p><strong><code>&lt;linkfile&gt;</code> 元素</strong>：为本地项目中的某些文件创建符号链接。</p>
<ul>
<li><code>src</code>: 链接的源文件位置（在仓库中的路径）。</li>
<li><code>dest</code>: 链接的目标文件位置（在本地项目中的路径）。</li>
</ul>
<p>例如，<code>&lt;linkfile src=&quot;common/mkfirmware.sh</code></p>
</li>
</ul>
<h1 id="搭建自己的repo仓库"><a class="markdownIt-Anchor" href="#搭建自己的repo仓库"></a> 搭建自己的repo仓库</h1>
<blockquote>
<p>v2ray wsl翻墙</p>
<p><a target="_blank" rel="noopener" href="https://ivpsr.com/2484.html">https://ivpsr.com/2484.html</a></p>
</blockquote>
<p>首先，在服务端只需要建立一个仓库名为<code>manifest</code>，构建完成如下图所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043339.png" alt="image-20240819162611044" />image-20240819162611044</p>
<p>然后在本地拉取该仓库，拉取完成如下所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043360.png" alt="image-20240819162649607" />image-20240819162649607</p>
<p>然后创建一个xml文件，这个文件名可以随意取例如rk3588_linux_release.xml，内容填充如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">COPY&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;manifest&gt;</span><br><span class="line">  &lt;remote  name=&quot;origin&quot; fetch=&quot;https://github.com/chai0705&quot; /&gt;</span><br><span class="line">  &lt;default remote=&quot;origin&quot; sync-j=&quot;8&quot; /&gt;</span><br><span class="line">  &lt;project name=&quot;rootfs-build&quot; path=&quot;rootfs-build&quot; revision=&quot;main&quot; /&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>
<p>remote: 远程服务端，name为repo仓库名称，fetch 为 仓库url</p>
<p>default:设置每个项目默认的仓库和分支，remote指定了使用哪一个远程服务端</p>
<p>project: 每个项目的git仓库，path会指向下载后的仓库放在那个路径</p>
<p>name: 服务端git仓库名称，指向的是在fetch在已有的仓库名。</p>
<p>revision: 分支名称或者commit id</p>
<p>然后推送出去，即可，如下图所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043547.png" alt="image-20240819163952002" />image-20240819163952002</p>
<p>到这里就关于repo就搭建完成了，然后开始测试，输入以下命令，这里的repo可以指定一下国内源，不然太慢了，或者使用本地的repo也是可以的。</p>
<blockquote>
<p>–repo-url <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/git/git-repo">https://mirrors.tuna.tsinghua.edu.cn/git/git-repo</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">repo init -u https://github.com/chai0705/manifest -b master -m rk3588_linux_release.xml --repo-url https://mirrors.tuna.tsinghua.edu.cn/git/git-repo</span><br><span class="line"></span><br><span class="line">repo init -u git@github.com:chai0705/manifest.git -b master -m rk3588_linux_release.xml --repo-url https://mirrors.tuna.tsinghua.edu.cn/git/git-repo</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043403.png" alt="image-20240819165255782" />image-20240819165255782</p>
<p>这样就初始化成功了，然后就可以进行同步了，同步过程如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo sync -j32</span><br></pre></td></tr></table></figure>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043455.png" alt="image-20240819165407859" />image-20240819165407859</p>
<p>同步完成如下所示：</p>
<p><img src="https://chai-1301855619.cos.ap-beijing.myqcloud.com/202409051043610.png" alt="image-20240819165611921" />image-20240819165611921</p>
<p>不错啊，这个，我感觉很不错，</p>
<p>小修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">COPY&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;manifest&gt;</span><br><span class="line">  &lt;remote  name=&quot;origin&quot; fetch=&quot;https://github.com/chai0705&quot; /&gt;</span><br><span class="line">  &lt;default remote=&quot;origin&quot; sync-j=&quot;8&quot; /&gt;</span><br><span class="line">  &lt;project name=&quot;rootfs-build&quot; path=&quot;rootfs-build&quot; revision=&quot;master&quot; /&gt;</span><br><span class="line">  &lt;project name=&quot;u-boot&quot; path=&quot;u-boot&quot; revision=&quot;master&quot; /&gt;</span><br><span class="line">  &lt;project name=&quot;kernel&quot; path=&quot;kernel&quot; revision=&quot;master&quot; /&gt;</span><br><span class="line">  &lt;project name=&quot;rkbin&quot; path=&quot;rkbin&quot; revision=&quot;master&quot; /&gt;</span><br><span class="line">  &lt;project name=&quot;gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu&quot; path=&quot;prebuilts/gcc/linux-x86/aarch64/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu&quot; revision=&quot;adbb295a970c4b39dc487c95226fe84d2c460072&quot; upstream=&quot;master&quot; dest-branch=&quot;master&quot;/&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br><span class="line">COPY</span><br><span class="line">git remote add origin https://github.com/chai0705/u-boot.git</span><br><span class="line">git clone https://github.com/chai0705/kernel.git</span><br><span class="line">git push -u origin master</span><br><span class="line">COPYgit branch -m main master</span><br><span class="line">git fetch origin</span><br><span class="line">git branch -u origin/master master</span><br><span class="line">git remote set-head origin -a</span><br><span class="line">COPYexport windows_host=`cat /etc/resolv.conf|grep nameserver|awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">export ALL_PROXY=socks5://$windows_host:10810</span><br><span class="line">export HTTP_PROXY=$ALL_PROXY</span><br><span class="line">export http_proxy=$ALL_PROXY</span><br><span class="line">export HTTPS_PROXY=$ALL_PROXY</span><br><span class="line">export https_proxy=$ALL_PROXY</span><br><span class="line"></span><br><span class="line">if [ &quot;`git config --global --get proxy.https`&quot; != &quot;socks5://$windows_host:10810&quot; ]; then</span><br><span class="line">            git config --global proxy.https socks5://$windows_host:10810</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
    <article
  id="post-07_小技巧/10_各类任务耗时"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/08/18/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/10_%E5%90%84%E7%B1%BB%E4%BB%BB%E5%8A%A1%E8%80%97%E6%97%B6/"
    >各类任务耗时</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/08/18/07_%E5%B0%8F%E6%8A%80%E5%B7%A7/10_%E5%90%84%E7%B1%BB%E4%BB%BB%E5%8A%A1%E8%80%97%E6%97%B6/" class="article-date">
  <time datetime="2024-08-17T22:50:19.000Z" itemprop="datePublished">2024-08-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>​	仅以此记录工作中一些耗时的任务</p>
<h1 id="linux"><a class="markdownIt-Anchor" href="#linux"></a> Linux</h1>
<h2 id="传输linux源码"><a class="markdownIt-Anchor" href="#传输linux源码"></a> 传输Linux源码</h2>
<table>
<thead>
<tr>
<th>任务</th>
<th>耗时</th>
</tr>
</thead>
<tbody>
<tr>
<td>传输Linux源码</td>
<td>30S</td>
</tr>
</tbody>
</table>
<h2 id="解压linux源码"><a class="markdownIt-Anchor" href="#解压linux源码"></a> 解压Linux源码</h2>
<table>
<thead>
<tr>
<th>任务</th>
<th>耗时</th>
</tr>
</thead>
<tbody>
<tr>
<td>本机解压Linux源码</td>
<td>1m44</td>
</tr>
<tr>
<td>服务器解压Linux源码</td>
<td>1m32</td>
</tr>
<tr>
<td>小主机解压Linux源码</td>
<td>1m52</td>
</tr>
<tr>
<td>家里电脑解压Linux源码</td>
<td>1m28</td>
</tr>
</tbody>
</table>
<h2 id="编译linux源码"><a class="markdownIt-Anchor" href="#编译linux源码"></a> 编译Linux源码</h2>
<table>
<thead>
<tr>
<th>任务</th>
<th>耗时</th>
</tr>
</thead>
<tbody>
<tr>
<td>本机编译buildroot整体镜像</td>
<td>70m7</td>
</tr>
<tr>
<td>服务器编译buildroot整体镜像</td>
<td>54min</td>
</tr>
<tr>
<td>小主机编译buildroot整体镜像</td>
<td>92m16</td>
</tr>
<tr>
<td>本机编译buildroot</td>
<td>50m</td>
</tr>
<tr>
<td>服务器编译buildroot</td>
<td>38m41</td>
</tr>
<tr>
<td>小主机编译buildroot</td>
<td>68min</td>
</tr>
<tr>
<td>本机编译recovery</td>
<td>16min</td>
</tr>
<tr>
<td>服务器编译recovery</td>
<td>12m57</td>
</tr>
<tr>
<td>小主机编译recovery</td>
<td>21min</td>
</tr>
<tr>
<td>本机编译kernel</td>
<td>2m22</td>
</tr>
<tr>
<td>服务器编译kernel</td>
<td>1m16</td>
</tr>
<tr>
<td>小主机编译kernel</td>
<td>3m27</td>
</tr>
<tr>
<td>家里电脑buildroot整体镜像</td>
<td></td>
</tr>
<tr>
<td>家里电脑buildroot</td>
<td></td>
</tr>
<tr>
<td>家里电脑recovery</td>
<td>12m32</td>
</tr>
<tr>
<td>家里电脑kernel</td>
<td>1m12</td>
</tr>
<tr>
<td>新电脑buildroot</td>
<td>45min</td>
</tr>
<tr>
<td>新电脑recovery</td>
<td>16m21</td>
</tr>
<tr>
<td>新电脑kernel</td>
<td>1m18</td>
</tr>
</tbody>
</table>
<h2 id="打包linux源码"><a class="markdownIt-Anchor" href="#打包linux源码"></a> 打包Linux源码</h2>
<table>
<thead>
<tr>
<th>任务</th>
<th>耗时</th>
</tr>
</thead>
<tbody>
<tr>
<td>本机打包Linux镜像</td>
<td>8m21</td>
</tr>
<tr>
<td>服务器打包Linux镜像</td>
<td>3m4</td>
</tr>
<tr>
<td>小主机打包Linux镜像</td>
<td>8m28</td>
</tr>
<tr>
<td>家里电脑打包Linux镜像</td>
<td>2m57</td>
</tr>
<tr>
<td>新电脑打包Linux镜像</td>
<td>5m25</td>
</tr>
</tbody>
</table>
<p>==经过测试，我发现家里的电脑和公司的ubuntu是完全相同的，如果我买一个其实没啥用，一般情况下，如果田田不用的话，那服务器还是很快的，所以我的建议是将服务器用来编译就好了，其他就别想了，可以搞个samba，这样也可以直接连通，倒也还不错，行了先这样，就不买电脑了，确实没必要了，但是我小主机有什么用的，这一点不是很理解，我的小主机这么一想就没啥用了。我的意见是搞成all in one，这肯定很不错，正好可以学习一下pve相关的知识==</p>
<h1 id="安卓"><a class="markdownIt-Anchor" href="#安卓"></a> 安卓</h1>
<h2 id="传输安卓源码到服务器"><a class="markdownIt-Anchor" href="#传输安卓源码到服务器"></a> 传输安卓源码到服务器</h2>
<h2 id="解压安卓源码"><a class="markdownIt-Anchor" href="#解压安卓源码"></a> 解压安卓源码</h2>
<h2 id="编译安卓源码"><a class="markdownIt-Anchor" href="#编译安卓源码"></a> 编译安卓源码</h2>
<h2 id="上传安卓源码"><a class="markdownIt-Anchor" href="#上传安卓源码"></a> 上传安卓源码</h2>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
   
  
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/">上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/3/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2024
        <i class="ri-heart-fill heart_icon"></i> chai
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="热爱学习的未来酱"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E7%94%9F%E6%B4%BB">生活</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E7%91%9E%E8%8A%AF%E5%BE%AE">瑞芯微</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/Linux%E5%AD%A6%E4%B9%A0">Linux学习</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E8%AF%BB%E4%B9%A6">读书</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/C%E8%AF%AD%E8%A8%80%E9%AB%98%E7%BA%A7%E5%AD%A6%E4%B9%A0">C语言高级学习</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95">工作记录</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7">小技巧</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/shell%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0">shell编程学习</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/PCB%E5%AD%A6%E4%B9%A0">PCB学习</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0">音视频学习</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->

<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=22707008&auto=0&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    

  </div>
</body>

</html>